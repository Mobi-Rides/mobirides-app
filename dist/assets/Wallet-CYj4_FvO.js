import{u as h,j as e}from"./query-vendor-C7aRRP05.js";import{B as N,M as k,s as p,v as _,ax as T,a9 as C,y as q}from"./index-DJr5SZzu.js";import{C as o,a as m,b as x,d as u}from"./card-DMFn2_TK.js";import{T as W,w as b}from"./TopUpModal-DncJE3mJ.js";import{S as c}from"./skeleton-BhL2eYwv.js";import{r as B,u as v}from"./react-vendor-mnpoGfEl.js";import{W as w}from"./wallet-DMAM-jtb.js";import{A as y}from"./arrow-up-down-CTAHKhNN.js";import{E as F,T as M}from"./trending-down-BTx43Lfo.js";import{T as S}from"./trending-up-DmzRO2nt.js";import{a as L}from"./date-vendor-Dhms5dOu.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./credit-card-Df8bEvff.js";import"./circle-alert-rcKd2uBC.js";import"./loader-circle-B7c4mGQa.js";const E=()=>{const[n,a]=B.useState(!1),{data:t}=h({queryKey:["current-user"],queryFn:async()=>{const{data:s}=await p.auth.getUser();return s==null?void 0:s.user}}),{data:r,isLoading:l,refetch:j}=h({queryKey:["wallet-balance",t==null?void 0:t.id],queryFn:async()=>t!=null&&t.id?await b.getWalletBalance(t.id):null,enabled:!!(t!=null&&t.id)}),f=()=>{j(),a(!1)};if(l)return e.jsxs(o,{children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"Wallet Balance"]})}),e.jsxs(u,{children:[e.jsx(c,{className:"h-8 w-24 mb-2"}),e.jsx(c,{className:"h-9 w-32"})]})]});const d=(r==null?void 0:r.balance)||0,i=d<50;return e.jsxs(e.Fragment,{children:[e.jsxs(o,{className:i?"border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-950":"",children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"Wallet Balance"]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold",children:["P",d.toFixed(2)]}),i&&e.jsx("span",{className:"text-sm text-amber-600 dark:text-amber-400 font-medium",children:"Low Balance"})]}),e.jsxs(N,{onClick:()=>a(!0),size:"sm",className:"w-full",variant:i?"default":"outline",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Top Up Wallet"]})]})})]}),e.jsx(W,{isOpen:n,onClose:()=>a(!1),onSuccess:f,currentBalance:d})]})},R=()=>{const n=v(),{data:a}=h({queryKey:["current-user"],queryFn:async()=>{const{data:s}=await p.auth.getUser();return s==null?void 0:s.user}}),{data:t,isLoading:r}=h({queryKey:["wallet-transactions",a==null?void 0:a.id],queryFn:async()=>a!=null&&a.id?await b.getTransactionHistory(a.id,20):[],enabled:!!(a!=null&&a.id)}),l=s=>{switch(s){case"top_up":return e.jsx(S,{className:"h-4 w-4 text-green-500"});case"fee_deduction":case"commission_deduction":return e.jsx(M,{className:"h-4 w-4 text-red-500"});case"refund":return e.jsx(C,{className:"h-4 w-4 text-blue-500"});case"withdrawal":return e.jsx(T,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(y,{className:"h-4 w-4 text-gray-500"})}},j=s=>{switch(s){case"top_up":return"Wallet Top Up";case"fee_deduction":return"Platform Fee";case"commission_deduction":return"Commission Charge";case"refund":return"Refund";case"withdrawal":return"Withdrawal";default:return s.replace("_"," ").replace(/\b\w/g,g=>g.toUpperCase())}},f=s=>{switch(s){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},d=s=>{(s.transaction_type==="commission_deduction"||s.transaction_type==="fee_deduction")&&s.booking_id&&n(`/booking-request/${s.booking_id}`)},i=s=>(s.transaction_type==="commission_deduction"||s.transaction_type==="fee_deduction")&&s.booking_id;return r?e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(x,{children:"Recent Transactions"})}),e.jsx(u,{className:"space-y-3",children:[...Array(5)].map((s,g)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"h-8 w-8 rounded"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"h-4 w-24"}),e.jsx(c,{className:"h-3 w-32"})]})]}),e.jsx(c,{className:"h-4 w-16"})]},g))})]}):!t||t.length===0?e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(x,{children:"Recent Transactions"})}),e.jsx(u,{children:e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx(y,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No transactions yet"}),e.jsx("p",{className:"text-sm",children:"Your transaction history will appear here"})]})})]}):e.jsxs(o,{children:[e.jsx(m,{children:e.jsx(x,{children:"Recent Transactions"})}),e.jsx(u,{className:"space-y-3",children:t.map(s=>e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg transition-colors ${i(s)?"cursor-pointer hover:bg-muted/50 hover:border-primary/50":"hover:bg-muted/30"}`,onClick:()=>d(s),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded-full bg-muted",children:l(s.transaction_type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:j(s.transaction_type)}),e.jsx(_,{variant:"secondary",className:f(s.status),children:s.status}),i(s)&&e.jsx(F,{className:"h-3 w-3 text-muted-foreground"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsx("p",{className:"text-xs text-muted-foreground",children:L(new Date(s.created_at),"MMM dd, yyyy 'at' h:mm a")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-semibold ${s.amount>0?"text-green-600":"text-red-600"}`,children:[s.amount>0?"+":"","P",Math.abs(s.amount).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Balance: P",s.balance_after.toFixed(2)]})]})]},s.id))})]})},Z=()=>{const n=v(),{data:a}=h({queryKey:["profile"],queryFn:async()=>{const{data:{user:t}}=await p.auth.getUser();if(!t)throw new Error("No user found");const{data:r,error:l}=await p.from("profiles").select("role").eq("id",t.id).single();if(l)throw l;return r}});return a&&a.role!=="host"?(n("/profile"),null):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>n("/profile"),className:"p-2",children:e.jsx(q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Wallet & Earnings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your wallet balance and view transaction history"})]})]}),e.jsxs("div",{className:"grid gap-8 md:grid-cols-2",children:[e.jsx(E,{}),e.jsx(R,{})]})]})})};export{Z as default};

import{c as V,r as d,k as D,a3 as F,n as L,s as B,j as e}from"./index-B1v-fdDy.js";import{C as I}from"./card-BByP0N-G.js";import{H as O,C as Q,B as _,u as E,s as K}from"./savedCarService-CH1V1nh4.js";import{V as $}from"./VerificationRequiredDialog-BhXpjI7V.js";import{S as H}from"./separator-BMDiheLN.js";import{u as M}from"./useVerificationStatus-BsTQxagy.js";import{U}from"./users-BmNgVsFF.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=V("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"7cu91f"}]]),G=({id:a,brand:c,model:i,price_per_day:l,image_url:n,transmission:y,fuel:m,seats:x,location:s,year:P,isSaved:v=!1})=>{const[u,N]=d.useState(!1),[k,b]=d.useState(!1),[p,h]=d.useState(v),[g,j]=d.useState(!1),C=D(),o=F();M();const{data:f,isLoading:R}=L({queryKey:["car",a],queryFn:async()=>{console.log("Fetching complete car details for booking");const{data:r,error:t}=await B.from("cars").select("*").eq("id",a).single();if(t)throw console.error("Error fetching car details:",t),t;return console.log("Car details fetched:",r),r},enabled:u}),w=()=>{C(`/cars/${a}`)},S=async r=>{if(r.stopPropagation(),!g){j(!0);try{p?await E(a)&&(h(!1),o.invalidateQueries({queryKey:["saved-cars-full"]}),o.invalidateQueries({queryKey:["saved-car-ids"]})):await K(a)&&(h(!0),o.invalidateQueries({queryKey:["saved-cars-full"]}),o.invalidateQueries({queryKey:["saved-car-ids"]}))}finally{j(!1)}}},q=r=>r<=2?"Sports":r<=5?"Sedan":r<=7?"SUV":"Van";return e.jsxs(e.Fragment,{children:[e.jsxs(I,{className:"overflow-hidden cursor-pointer transition-transform hover:scale-[1.02] h-auto min-h-[20rem] sm:h-[24rem] dark:bg-gray-800 dark:border-gray-700",onClick:w,children:[e.jsxs("div",{className:"relative h-40 sm:h-48",children:[e.jsx("img",{src:n,alt:`${c} ${i}`,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:S,className:"absolute top-2 right-2 p-2 bg-white dark:bg-gray-800 rounded-full shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",disabled:g,children:e.jsx(O,{className:`w-5 h-5 ${g?"text-gray-400":p?"fill-red-500 text-red-500":"text-gray-600"}`})})]}),e.jsxs("div",{className:"p-3 sm:p-4 flex flex-col flex-1",children:[e.jsx("span",{className:"px-3 py-1 rounded-md text-xs md:text-sm bg-[#F1F0FB] dark:bg-[#352a63] text-[#7C3AED] dark:text-[#a87df8] w-fit mb-2",children:q(x)}),e.jsxs("div",{className:"flex justify-between items-start mb-2 min-h-[3rem]",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h3",{className:"font-semibold text-left break-words line-clamp-2 text-sm md:text-base dark:text-white",children:[c," ",i]})}),e.jsx("div",{className:"text-right ml-2",children:e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsxs("p",{className:"font-semibold whitespace-nowrap text-primary dark:text-primary-foreground",children:["BWP ",l]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"/day"})]})})]}),e.jsx(H,{className:"w-full my-2 sm:my-3 dark:bg-gray-700"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 sm:gap-2 mb-3 sm:mb-4 text-[0.7rem] sm:text-sm",children:[e.jsxs("div",{className:"flex items-center justify-left gap-1 text-sm text-gray-400 dark:text-gray-300",children:[e.jsx(Q,{className:"w-4 h-4 text-primary dark:text-primary-foreground"}),y]}),e.jsxs("div",{className:"flex items-center justify-left gap-1 text-sm text-gray-400 dark:text-gray-300",children:[e.jsx(A,{className:"w-4 h-4 text-primary dark:text-primary-foreground"}),m]}),e.jsxs("div",{className:"flex items-center justify-left gap-1 text-sm text-gray-400 dark:text-gray-300",children:[e.jsx(U,{className:"w-4 h-4 text-primary dark:text-primary-foreground"}),x," Seats"]})]})]})]}),u&&f&&e.jsx(_,{car:f,isOpen:u,onClose:()=>N(!1)}),e.jsx($,{isOpen:k,onClose:()=>b(!1),action:"booking",carData:f})]})},ee=({cars:a,hasMoreItems:c,isLoading:i,error:l,loadMoreRef:n,onLoadMore:y,isFetchingNextPage:m,isAuthenticated:x})=>i?e.jsx("div",{className:"text-center mt-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading cars..."})}):l?e.jsx("div",{className:"text-center mt-8",children:e.jsxs("p",{className:"text-red-500",children:["Error loading cars: ",l.message]})}):a.length===0?e.jsx("div",{className:"text-center mt-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No cars found"})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[a.map(s=>e.jsx(G,{id:s.id,brand:s.brand,model:s.model,price_per_day:s.price_per_day,image_url:s.image_url,transmission:s.transmission,fuel:s.fuel,seats:s.seats,location:s.location,year:s.year,isSaved:s.isSaved},s.id)),n&&e.jsx("div",{ref:n,className:"col-span-full h-10 flex items-center justify-center",children:m&&e.jsx("p",{className:"text-muted-foreground",children:"Loading more..."})})]});export{ee as C};

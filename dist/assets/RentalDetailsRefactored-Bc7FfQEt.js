import{c as A,M as J,n as V,r as M,s as _,J as Q,j as e,B as c,u as f,U as Z}from"./index-BAM2AQzj.js";import{N as I}from"./Navigation-DcFnTla_.js";import{a as S}from"./useQuery-BBHzqejZ.js";import{c as G}from"./handoverService-DSRl_wMq.js";import{t as j,h as X,f as T}from"./format-BOBWS5Wu.js";import{a as ee}from"./addDays-Di48Ycau.js";import{K as se,a as ae,C as te}from"./CarDescription-CbfPF1JW.js";import{B as re}from"./badge-La64XLSg.js";import{A as P}from"./arrow-left-ZSxCSMqd.js";import{C as ne}from"./circle-help-PFdpPLXW.js";import{C as q}from"./circle-alert-CkQrh4MB.js";import{C as K}from"./clock-DcRTzakL.js";import{C as g,a as y,b,d as N,e as ie}from"./card-C82ETfr4.js";import{C as le}from"./car-BcLi7tRD.js";import{M as L}from"./map-pin-CoQHT-KY.js";import{C as oe}from"./calendar-m5gla_Sa.js";import{S as ce}from"./separator-BlDr0iOF.js";import{C as de}from"./credit-card-C7ZeWo_M.js";import{T as me,a as B,b as U,c as F}from"./tooltip-BIm-gO95.js";import{S as xe}from"./star-gaaEOnOW.js";import{S as p}from"./skeleton-nH5YszIf.js";import"./ChatDrawer-CTUee0kE.js";import"./avatar-A32ilikL.js";import"./chevron-right-DpKt2Wag.js";import"./textarea-D1hXqD0k.js";import"./send-CyKCJr7A.js";import"./scroll-area-C8WYL-tw.js";import"./message-circle-BHBqJZi2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=A("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=A("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);function he(s,a){const r=j(s),i=j(a),n=E(r,i),t=Math.abs(X(r,i));r.setDate(r.getDate()-n*t);const o=+(E(r,i)===-n),l=n*(t-o);return l===0?0:l}function E(s,a){const r=s.getFullYear()-a.getFullYear()||s.getMonth()-a.getMonth()||s.getDate()-a.getDate()||s.getHours()-a.getHours()||s.getMinutes()-a.getMinutes()||s.getSeconds()-a.getSeconds()||s.getMilliseconds()-a.getMilliseconds();return r<0?-1:r>0?1:r}function pe(s,a){const r=+j(s),[i,n]=[+j(a.start),+j(a.end)].sort((t,o)=>t-o);return r>=i&&r<=n}var R=(s=>(s.PICKUP="pickup",s.RETURN="return",s))(R||{});const je=()=>{const{id:s}=J(),r=V().search.includes("print=true"),[i,n]=M.useState(!1),{data:t,isLoading:o}=S({queryKey:["rental-details",s],queryFn:async()=>{console.log("Fetching rental details for ID:",s);const{data:d,error:H}=await _.from("bookings").select(`
          *,
          renter:profiles!renter_id (
            id,
            full_name,
            avatar_url
          ),
          car:cars (
            *,
            owner:profiles!owner_id (
              id,
              full_name,
              avatar_url
            )
          )
        `).eq("id",s).single();if(H)throw H;return d}}),{data:l,isLoading:x}=S({queryKey:["current-user"],queryFn:async()=>{const{data:{user:d}}=await _.auth.getUser();return d}});M.useEffect(()=>{if(r&&t&&!o){const d=setTimeout(()=>{window.print()},500);return()=>clearTimeout(d)}},[r,t,o]);const k=t&&l&&t.renter_id===l.id,w=t&&l&&t.car.owner_id===l.id,D=t&&t.status==="confirmed"&&pe(new Date,{start:new Date(t.start_date),end:ee(new Date(t.end_date),1)}),C=t&&t.status==="completed",m=new Date,u=t?new Date(t.start_date):null,h=t?new Date(t.end_date):null,v=u&&m.getDate()===u.getDate()&&m.getMonth()===u.getMonth()&&m.getFullYear()===u.getFullYear(),Y=h&&m.getDate()===h.getDate()&&m.getMonth()===h.getMonth()&&m.getFullYear()===h.getFullYear(),z=t&&t.status==="confirmed"&&(v||Y),W=v?R.PICKUP:R.RETURN,O=t?he(new Date(t.end_date),new Date(t.start_date))+1:0;return{booking:t,isBookingLoading:o,isUserLoading:x,currentUser:l,isRenter:k,isOwner:w,isActiveRental:D,isCompletedRental:C,canHandover:z,handoverType:W,rentalDurationDays:O,isInitiatingHandover:i,handleInitiateHandover:async()=>{if(!t||!l)return null;n(!0);try{return await G(t.id,t.car.owner_id,t.renter_id)}catch(d){return console.error("Error initiating handover:",d),Q.error("Failed to initiate handover process"),null}finally{n(!1)}},id:s}},fe=({status:s,onBack:a})=>{const r=()=>{let i="outline",n=e.jsx(ne,{className:"h-3 w-3 mr-1"});switch(s){case"confirmed":i="success",n=e.jsx($,{className:"h-3 w-3 mr-1"});break;case"pending":i="warning",n=e.jsx(K,{className:"h-3 w-3 mr-1"});break;case"completed":i="default",n=e.jsx($,{className:"h-3 w-3 mr-1"});break;case"cancelled":i="destructive",n=e.jsx(q,{className:"h-3 w-3 mr-1"});break}return e.jsxs(re,{variant:i,className:"flex items-center",children:[n,e.jsx("span",{className:"capitalize",children:s})]})};return e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(c,{variant:"ghost",onClick:a,children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Back"]}),r()]})},ge=({car:s})=>{const a=f();return e.jsxs(g,{className:"overflow-hidden border-border shadow-sm",children:[e.jsx(y,{className:"p-4 bg-muted/30",children:e.jsxs(b,{className:"flex items-center gap-2 text-lg",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),"Vehicle Information"]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("img",{src:s.image_url||"/placeholder.svg",alt:`${s.brand} ${s.model}`,className:"w-full sm:w-32 h-32 sm:h-24 object-cover rounded-lg"}),e.jsxs("div",{className:"flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[s.brand," ",s.model," (",s.year,")"]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground mt-1",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:s.location})]})]}),e.jsxs("p",{className:"text-lg font-medium mt-2",children:["BWP ",s.price_per_day," per day"]})]})]})}),e.jsx(ie,{className:"p-4 bg-muted/10 border-t",children:e.jsx(c,{variant:"outline",size:"sm",onClick:()=>a(`/car/${s.id}`),className:"text-xs",children:"View Vehicle Details"})})]})},Ne=({startDate:s,endDate:a,durationDays:r})=>e.jsxs(g,{className:"dark:bg-gray-800 dark:border-gray-700",children:[e.jsx(y,{className:"pb-2",children:e.jsxs(b,{className:"text-lg flex items-center gap-2 dark:text-white",children:[e.jsx(oe,{className:"h-5 w-5 text-primary dark:text-primary-foreground"}),"Rental Duration"]})}),e.jsxs(N,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"font-medium",children:T(new Date(s),"PPP")})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"font-medium",children:T(new Date(a),"PPP")})]})]}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(K,{className:"h-4 w-4 text-muted-foreground mr-2"}),e.jsxs("span",{className:"text-sm",children:[r," day",r!==1?"s":""]})]})]})]}),we=({pricePerDay:s,durationDays:a,totalPrice:r})=>e.jsxs(g,{className:"dark:bg-gray-800 dark:border-gray-700",children:[e.jsx(y,{className:"pb-2",children:e.jsxs(b,{className:"text-lg flex items-center gap-2 dark:text-white",children:[e.jsx(de,{className:"h-5 w-5 text-primary dark:text-primary-foreground"}),"Payment Details"]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Daily Rate"}),e.jsxs("p",{children:["BWP ",s]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Duration"}),e.jsxs("p",{children:[a," day",a!==1?"s":""]})]}),e.jsx(ce,{}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("p",{children:"Total"}),e.jsxs("p",{children:["BWP ",r]})]})]})]}),ve=({bookingId:s,canHandover:a,handoverType:r,isInitiatingHandover:i,isCompletedRental:n,isActiveRental:t,isRenter:o,onHandoverInitiate:l})=>{const x=f();return e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-end pt-4",children:e.jsxs(me,{children:[(n||t)&&e.jsxs(B,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(c,{className:"w-full sm:w-auto flex items-center gap-2",onClick:()=>x(`/rental-review/${s}`),children:[e.jsx(xe,{className:"h-4 w-4"}),"Write Review"]})}),e.jsx(F,{children:e.jsx("p",{children:"Share your experience with this vehicle"})})]}),a&&e.jsxs(c,{className:"w-full sm:w-auto flex items-center gap-2",variant:"default",onClick:l,disabled:i,children:[e.jsx(se,{className:"h-4 w-4"}),i?"Initiating...":`Initiate ${r==="pickup"?"Pickup":"Return"}`]}),t&&!a&&e.jsxs(B,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(c,{className:"w-full sm:w-auto flex items-center gap-2",variant:"outline",onClick:()=>x(`/map?handover=true&bookingId=${s}&role=${o?"renter":"host"}`),children:[e.jsx(L,{className:"h-4 w-4"}),"View Handover Status"]})}),e.jsx(F,{children:e.jsx("p",{children:"See the real-time status of your car handover"})})]})]})})},ye=({user:s,role:a})=>e.jsxs(g,{className:"dark:bg-gray-800 dark:border-gray-700",children:[e.jsx(y,{className:"pb-2",children:e.jsxs(b,{className:"text-lg flex items-center gap-2 dark:text-white",children:[e.jsx(Z,{className:"h-5 w-5 text-primary dark:text-primary-foreground"}),a]})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.avatar_url?_.storage.from("avatars").getPublicUrl(s.avatar_url).data.publicUrl:"/placeholder.svg",alt:s.full_name||a,className:"w-12 h-12 rounded-full object-cover bg-muted"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.full_name||a}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Vehicle ",a]})]})]})})]}),be=()=>{const s=f();return e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(c,{variant:"ghost",onClick:()=>s(-1),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsx(p,{className:"h-8 w-48 ml-4"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{className:"h-64 w-full rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(p,{className:"h-48 w-full rounded-lg"}),e.jsx(p,{className:"h-48 w-full rounded-lg"})]}),e.jsx(p,{className:"h-48 w-full rounded-lg"})]}),e.jsx(I,{})]})},ke=()=>{const s=f();return e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[e.jsxs(c,{variant:"ghost",className:"mb-6",onClick:()=>s(-1),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsx(g,{children:e.jsx(N,{className:"py-10",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center space-y-3",children:[e.jsx(q,{className:"h-10 w-10 text-muted-foreground"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Rental details not found"}),e.jsx("p",{className:"text-muted-foreground",children:"The rental information you're looking for could not be found."}),e.jsx(c,{onClick:()=>s("/bookings"),children:"View All Bookings"})]})})}),e.jsx(I,{})]})},es=()=>{const s=f();V();const{booking:a,isBookingLoading:r,isUserLoading:i,isRenter:n,isOwner:t,isActiveRental:o,isCompletedRental:l,canHandover:x,handoverType:k,rentalDurationDays:w,isInitiatingHandover:D,handleInitiateHandover:C,id:m}=je(),u=async()=>{if(await C()){const v=n?"renter":"host";s(`/map?bookingId=${a.id}&mode=handover&role=${v}`)}};return r||i?e.jsx(be,{}):a?e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20 animate-fade-in",children:[e.jsx(fe,{status:a.status,onBack:()=>s(-1)}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Rental Details"}),l&&e.jsxs(c,{variant:"outline",size:"sm",className:"mt-2 sm:mt-0 flex items-center gap-2",onClick:()=>window.print(),children:[e.jsx(ue,{className:"h-4 w-4"}),"Download Receipt"]})]}),e.jsx(ge,{car:a.car}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n?e.jsx(ae,{ownerName:a.car.owner.full_name,avatarUrl:a.car.owner.avatar_url,ownerId:a.car.owner.id,carId:a.car.id}):e.jsx(ye,{user:a.renter,role:"Renter"}),e.jsx(Ne,{startDate:a.start_date,endDate:a.end_date,durationDays:w})]}),e.jsx(te,{description:a.car.description}),e.jsx(we,{pricePerDay:a.car.price_per_day,durationDays:w,totalPrice:a.total_price}),e.jsx(ve,{bookingId:a.id,canHandover:x,handoverType:k,isInitiatingHandover:D,isCompletedRental:l,isActiveRental:o,isRenter:n,onHandoverInitiate:u})]}),e.jsx(I,{})]}):e.jsx(ke,{})};export{es as default};

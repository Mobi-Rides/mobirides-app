import{a as V,b as D,j as e,u as K}from"./query-vendor-Bsfdn-Hb.js";import{T as $,a as J,b as T,c as t,d as G,e as d,A as W,f as X}from"./table-BXpV7wOe.js";import{r as o}from"./react-vendor-mnpoGfEl.js";import{c as Y,J as x,s as p,an as Z,I as ee,B as j,z as se,n as ae,y as re,D as ne,b as ie,d as le,e as te,m as de,f as F,b0 as ce}from"./index-DIwI39m3.js";import{C as L,d as k,a as oe,b as me}from"./card-CixI4yIN.js";import{S as y}from"./skeleton-BZzOAjk6.js";import{A as ue,b as he,c as xe,d as je,e as pe,f as fe,g as ge,h as Ae}from"./alert-dialog-BDGaGZG5.js";import{S as q,a as I,b as M,c as R,d as C}from"./select-C3KnjN1h.js";import{S as E}from"./shield-8Ut84iwF.js";import"./separator-BvlX9Scn.js";import"./sheet-DHGr4BY1.js";import"./car-C76bGp2A.js";import"./credit-card-DfVCv8fx.js";import"./message-square-CbNt_yNE.js";import"./house-Bw_DA-8N.js";import"./settings-CZLWNXEg.js";import"./log-out-EaJWxg5g.js";import"./useIsAdmin-D3Zc6ko-.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";import"./index-DXD4kVr2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=Y("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ye=()=>K({queryKey:["admins"],queryFn:async()=>{const{data:r,error:n}=await p.from("admins").select("*").order("created_at",{ascending:!1});if(n)throw n;return r||[]}}),Ce=()=>K({queryKey:["non-admin-users"],queryFn:async()=>{const{data:r,error:n}=await p.from("profiles").select("id, full_name, role").not("id","in","(SELECT id FROM admins)").order("full_name",{ascending:!0});if(n)throw n;return r||[]}}),Se=()=>{const[r,n]=o.useState(""),[Q,m]=o.useState(!1),[c,S]=o.useState(""),[N,w]=o.useState(!1),[i,f]=o.useState(null),u=V(),{data:g,isLoading:U,error:H}=ye(),{data:l}=Ce(),A=D({mutationFn:async({userId:s,isSuperAdmin:a,userEmail:h,userName:v})=>{const{error:_}=await p.from("admins").insert({id:s,email:h,full_name:v,is_super_admin:a});if(_)throw _},onSuccess:()=>{u.invalidateQueries({queryKey:["admins"]}),u.invalidateQueries({queryKey:["non-admin-users"]}),x.success("Admin added successfully"),m(!1),S(""),w(!1)},onError:s=>{x.error(`Failed to add admin: ${s.message}`)}}),O=D({mutationFn:async s=>{const{error:a}=await p.from("admins").delete().eq("id",s);if(a)throw a},onSuccess:()=>{u.invalidateQueries({queryKey:["admins"]}),u.invalidateQueries({queryKey:["non-admin-users"]}),x.success("Admin removed successfully"),f(null)},onError:s=>{x.error(`Failed to remove admin: ${s.message}`)}}),z=()=>{var h;if(!c)return;const s=l==null?void 0:l.find(v=>v.id===c);if(!s)return;const a=`${(h=s.full_name)==null?void 0:h.toLowerCase().replace(/\s+/g,".")}@example.com`;A.mutate({userId:c,isSuperAdmin:N,userEmail:a,userName:s.full_name||"Unknown User"})},B=s=>{f(s)},P=()=>{i&&O.mutate(i.id)},b=(g==null?void 0:g.filter(s=>{var a;return((a=s.full_name)==null?void 0:a.toLowerCase().includes(r.toLowerCase()))||s.email.toLowerCase().includes(r.toLowerCase())}))||[];return H?e.jsx(L,{children:e.jsx(k,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load admins"})})}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(me,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Admin Management (",b.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage platform administrators and their permissions"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ee,{placeholder:"Search admins...",value:r,onChange:s=>n(s.target.value),className:"pl-8"})]}),e.jsxs(j,{onClick:()=>m(!0),children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Admin"]})]})]})}),e.jsx(k,{children:U?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(y,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"h-4 w-[200px]"}),e.jsx(y,{className:"h-4 w-[100px]"})]})]},a))}):e.jsxs($,{children:[e.jsx(J,{children:e.jsxs(T,{children:[e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Admin Type"}),e.jsx(t,{children:"Added"}),e.jsx(t,{children:"Last Sign In"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(G,{children:b.map(s=>e.jsxs(T,{children:[e.jsx(d,{className:"font-medium",children:s.full_name||"No name"}),e.jsx(d,{children:s.email}),e.jsx(d,{children:e.jsx(ae,{variant:s.is_super_admin?"default":"secondary",children:s.is_super_admin?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Super Admin"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"Admin"]})})}),e.jsx(d,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(d,{children:s.last_sign_in_at?new Date(s.last_sign_in_at).toLocaleDateString():"Never"}),e.jsx(d,{children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>B(s),className:"text-destructive hover:text-destructive",children:e.jsx(re,{className:"h-4 w-4"})})})]},s.id))})]})})]}),e.jsx(ne,{open:Q,onOpenChange:m,children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsx(te,{children:"Add New Admin"}),e.jsx(de,{children:"Select a user to grant admin access to the platform."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"user-select",children:"Select User"}),e.jsxs(q,{value:c,onValueChange:S,children:[e.jsx(I,{children:e.jsx(M,{placeholder:"Choose a user..."})}),e.jsx(R,{children:l==null?void 0:l.map(s=>e.jsxs(C,{value:s.id,children:[s.full_name||"Unnamed User"," (",s.role,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"admin-type",children:"Admin Type"}),e.jsxs(q,{value:N?"super":"regular",onValueChange:s=>w(s==="super"),children:[e.jsx(I,{children:e.jsx(M,{})}),e.jsxs(R,{children:[e.jsx(C,{value:"regular",children:"Regular Admin"}),e.jsx(C,{value:"super",children:"Super Admin"})]})]})]})]}),e.jsxs(ce,{children:[e.jsx(j,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(j,{onClick:z,disabled:!c||A.isPending,children:A.isPending?"Adding...":"Add Admin"})]})]})}),e.jsx(ue,{open:!!i,onOpenChange:()=>f(null),children:e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsx(je,{children:"Remove Admin Access"}),e.jsxs(pe,{children:["Are you sure you want to remove admin access for ",i==null?void 0:i.full_name,"? They will no longer be able to access the admin dashboard."]})]}),e.jsxs(fe,{children:[e.jsx(ge,{children:"Cancel"}),e.jsx(Ae,{onClick:P,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove Admin"})]})]})})]})},Ve=()=>e.jsx(W,{children:e.jsx(X,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Add and manage platform administrators"})]}),e.jsx(Se,{})]})})});export{Ve as default};

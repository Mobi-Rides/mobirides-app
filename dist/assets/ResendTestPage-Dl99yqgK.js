var A=Object.defineProperty;var I=(r,t,s)=>t in r?A(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var N=(r,t,s)=>I(r,typeof t!="symbol"?t+"":t,s);import{j as e}from"./query-vendor-C7aRRP05.js";import{r as b,u as P}from"./react-vendor-mnpoGfEl.js";import{s as E,I as U,B as g,J as d,v as F,y as $}from"./index-CV3rVyoS.js";import{C as u,a as p,b as f,c as D,d as h}from"./card-BYz0HUlZ.js";import{M as O}from"./mail-BHRmIhQv.js";import{L as k}from"./loader-circle-DyIJ3h3k.js";import{P as Y}from"./play-CBsawwrg.js";import{S as q}from"./settings-CzuPzsxf.js";import{C as K}from"./circle-check-big-vUkh3tr9.js";import{C as L}from"./circle-x-BZZBE6d0.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";const C={booking_confirmation:{id:"booking-confirmation",name:"Booking Confirmation",subject:"Your MobiRides booking has been confirmed!",description:"Sent when a booking request is approved by the host"},booking_request:{id:"booking-request",name:"New Booking Request",subject:"New booking request for your vehicle",description:"Sent to hosts when they receive a new booking request"},booking_cancelled:{id:"booking-cancelled",name:"Booking Cancelled",subject:"Your MobiRides booking has been cancelled",description:"Sent when a booking is cancelled by host or renter"},payment_received:{id:"payment-received",name:"Payment Received",subject:"Payment received - MobiRides",description:"Sent when a payment is successfully processed"},payment_failed:{id:"payment-failed",name:"Payment Failed",subject:"Payment failed - Please try again",description:"Sent when a payment fails to process"},wallet_topup:{id:"wallet-topup",name:"Wallet Top-up",subject:"Your MobiRides wallet has been topped up",description:"Sent when a host successfully tops up their wallet"},handover_ready:{id:"handover-ready",name:"Vehicle Handover Ready",subject:"Your vehicle is ready for pickup/return",description:"Sent when a vehicle is ready for pickup or return"},rental_reminder:{id:"rental-reminder",name:"Rental Reminder",subject:"Reminder: Your rental starts soon",description:"Sent as a reminder before rental start time"},return_reminder:{id:"return-reminder",name:"Return Reminder",subject:"Reminder: Please return your rental vehicle",description:"Sent as a reminder before rental end time"},verification_complete:{id:"verification-complete",name:"Account Verification Complete",subject:"Your MobiRides account has been verified",description:"Sent when user identity verification is approved"},welcome_renter:{id:"welcome-renter",name:"Welcome New Renter",subject:"Welcome to MobiRides!",description:"Sent to new users who sign up as renters"},welcome_host:{id:"welcome-host",name:"Welcome New Host",subject:"Welcome to MobiRides - Start earning with your car!",description:"Sent to new users who become hosts"},password_reset:{id:"password-reset",name:"Password Reset",subject:"Reset your MobiRides password",description:"Sent when user requests password reset"},email_confirmation:{id:"email-confirmation",name:"Email Confirmation",subject:"Confirm your MobiRides account",description:"Sent to confirm user email address during signup"},system_notification:{id:"system-notification",name:"System Notification",subject:"MobiRides System Notification",description:"General system notifications and updates"}};function z(r){return C[r]}function H(){return Object.keys(C)}class J{constructor(){N(this,"baseUrl");N(this,"testEmail","test@mobirides.com");this.baseUrl="http://localhost:3001/api/test"}async testBasicEmailSending(){console.log("üß™ Testing basic email sending...");try{const{data:t,error:s}=await E.functions.invoke("resend-service",{body:{to:this.testEmail,subject:"MobiRides - Basic Email Test",html:`
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
              <h2 style="color: #7C3AED;">üöó MobiRides Email Test</h2>
              <p>This is a basic email test from the MobiRides platform.</p>
              <p><strong>Test Details:</strong></p>
              <ul>
                <li>Test Type: Basic HTML Email</li>
                <li>Timestamp: ${new Date().toISOString()}</li>
                <li>Service: Resend via Supabase Edge Function</li>
              </ul>
              <p style="color: #059669;">‚úÖ If you receive this email, the basic email functionality is working correctly!</p>
            </div>
          `,type:"basic-test"}});return s?(console.error("‚ùå Basic email test failed:",s),{success:!1,error:s.message,testName:"Basic Email Test"}):t.error?(console.error("‚ùå Basic email test failed:",t.error),{success:!1,error:t.error,testName:"Basic Email Test"}):(console.log("‚úÖ Basic email test successful:",t.id),{success:!0,messageId:t.id,testName:"Basic Email Test"})}catch(t){const s=t instanceof Error?t.message:"Unknown error occurred";return console.error("‚ùå Basic email test exception:",s),{success:!1,error:s,testName:"Basic Email Test"}}}async testTemplateBasedEmail(){console.log("üß™ Testing template-based email sending...");try{const s=z("welcome_renter"),a={name:"Test User",platform_name:"MobiRides",login_url:"https://app.mobirides.com/login",support_email:"support@mobirides.com",test_timestamp:new Date().toISOString()},{data:n,error:l}=await E.functions.invoke("resend-service",{body:{to:this.testEmail,subject:`${s.subject} - Test`,html:`
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
              <h1 style="color: #8B5CF6;">MobiRides Template Test</h1>
              <p>Hello ${a.name}! This is a template-based test email.</p>
              <div style="background-color: #f3f4f6; padding: 16px; border-radius: 8px;">
                <p><strong>Test Details:</strong></p>
                <ul>
                  <li>Template: ${s.id}</li>
                  <li>Recipient: ${this.testEmail}</li>
                  <li>Timestamp: ${a.test_timestamp}</li>
                </ul>
              </div>
            </div>
          `,type:"template-test"}});return l?(console.error("‚ùå Template email test failed:",l),{success:!1,error:l.message,testName:"Template-Based Email Test",templateUsed:s.id}):n.error?(console.error("‚ùå Template email test failed:",n.error),{success:!1,error:n.error,testName:"Template-Based Email Test",templateUsed:s.id}):(console.log("‚úÖ Template email test successful:",n.id),{success:!0,messageId:n.id,testName:"Template-Based Email Test",templateUsed:s.id})}catch(t){const s=t instanceof Error?t.message:"Unknown error occurred";return console.error("‚ùå Template email test exception:",s),{success:!1,error:s,testName:"Template-Based Email Test"}}}async testConfirmationEmail(t){console.log("üß™ Testing confirmation email (signup-style)..."),t||this.testEmail;try{const s=await fetch(`${this.baseUrl}/resend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"confirmation",to:"test@example.com",subject:"Test Confirmation Email"})}),a=await s.json();return s.ok?(console.log("‚úÖ Confirmation email test successful:",a.id),{success:!0,messageId:a.id,testName:"Confirmation Email Test"}):(console.error("‚ùå Confirmation email test failed:",a),{success:!1,error:a.message||"Failed to send confirmation email",testName:"Confirmation Email Test"})}catch(s){const a=s instanceof Error?s.message:"Unknown error occurred";return console.error("‚ùå Confirmation email test exception:",a),{success:!1,error:a,testName:"Confirmation Email Test"}}}async testBookingNotificationEmail(){console.log("üß™ Testing booking notification email...");try{const t=await fetch(`${this.baseUrl}/resend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"booking",to:"test@example.com",subject:"Test Booking Notification"})}),s=await t.json();return t.ok?(console.log("‚úÖ Booking notification test successful:",s.id),{success:!0,messageId:s.id,testName:"Booking Notification Email Test"}):(console.error("‚ùå Booking notification test failed:",s),{success:!1,error:s.message||"Failed to send booking notification",testName:"Booking Notification Email Test"})}catch(t){const s=t instanceof Error?t.message:"Unknown error occurred";return console.error("‚ùå Booking notification test exception:",s),{success:!1,error:s,testName:"Booking Notification Email Test"}}}async testConfiguration(){console.log("üß™ Testing Resend configuration...");try{const t=await fetch(`${this.baseUrl}/resend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"config"})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json(),a=t.status!==500||s.error&&!s.error.includes("RESEND_API_KEY"),n={hasResendKey:a,hasFromEmail:a,templatesCount:H().length,supabaseFunctionAvailable:!1};try{const{error:l}=await E.functions.invoke("resend-service",{body:{to:"test@example.com",subject:"Configuration Test",html:"<p>Test</p>",type:"config-test"}});n.supabaseFunctionAvailable=!0}catch(l){console.warn("Supabase function test failed:",l)}return console.log("‚úÖ Configuration test completed:",n),{success:a,config:n,testName:"Configuration Validation Test"}}catch(t){const s=t instanceof Error?t.message:"Unknown error occurred";return console.error("‚ùå Configuration test exception:",s),{success:!1,config:{hasResendKey:!1,hasFromEmail:!1,templatesCount:0,supabaseFunctionAvailable:!1},testName:"Configuration Validation Test"}}}async runAllTests(t){t&&(this.testEmail=t),console.log("üöÄ Starting comprehensive Resend email tests..."),console.log(`üìß Test emails will be sent to: ${this.testEmail}`);const s=[];let a=0,n=0;const l=await this.testConfiguration();s.push(l),l.success?a++:n++;const y=await this.testBasicEmailSending();s.push(y),y.success?a++:n++;const x=await this.testTemplateBasedEmail();s.push(x),x.success?a++:n++;const m=await this.testConfirmationEmail();s.push(m),m.success?a++:n++;const j=await this.testBookingNotificationEmail();s.push(j),j.success?a++:n++;const w={total:s.length,passed:a,failed:n};return console.log("üìä Test Summary:",w),console.log("‚úÖ Passed:",a),console.log("‚ùå Failed:",n),{success:n===0,results:s,summary:w}}setTestEmail(t){this.testEmail=t,console.log(`üìß Test email updated to: ${t}`)}}const c=new J,{testBasicEmailSending:me,testTemplateBasedEmail:de,testConfirmationEmail:ue,testBookingNotificationEmail:pe,testConfiguration:fe,runAllTests:he,setTestEmail:ge}=c,V=()=>{const[r,t]=b.useState("test@mobirides.com"),[s,a]=b.useState(!1),[n,l]=b.useState(""),[y,x]=b.useState([]),[m,j]=b.useState(null),[w,v]=b.useState(!1),R=async()=>{a(!0),x([]),j(null),v(!0);try{c.setTestEmail(r),d.info("Starting Resend email tests...",{description:`Test emails will be sent to ${r}`});const i=await c.runAllTests(r);x(i.results),j(i.summary),i.success?d.success("All tests passed!",{description:`${i.summary.passed}/${i.summary.total} tests successful`}):d.warning("Some tests failed",{description:`${i.summary.failed}/${i.summary.total} tests failed`})}catch(i){d.error("Test execution failed",{description:i instanceof Error?i.message:"Unknown error occurred"})}finally{a(!1),l("")}},T=async i=>{a(!0),l(i);try{c.setTestEmail(r);let o;switch(i){case"configuration":o=await c.testConfiguration();break;case"basic":o=await c.testBasicEmailSending();break;case"template":o=await c.testTemplateBasedEmail();break;case"confirmation":o=await c.testConfirmationEmail();break;case"booking":o=await c.testBookingNotificationEmail();break;default:throw new Error("Unknown test type")}x(M=>[...M.filter(_=>_.testName!==o.testName),o]),v(!0),o.success?d.success(`${o.testName} passed`):d.error(`${o.testName} failed`,{description:o.error})}catch(o){d.error("Test failed",{description:o instanceof Error?o.message:"Unknown error"})}finally{a(!1),l("")}},S=i=>i?e.jsx(K,{className:"h-5 w-5 text-green-500"}):e.jsx(L,{className:"h-5 w-5 text-red-500"}),B=i=>e.jsx(F,{variant:i?"default":"destructive",children:i?"PASSED":"FAILED"});return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-6 w-6 text-purple-600"}),"Resend Email Service Test Runner"]}),e.jsx(D,{children:"Test the Resend email integration for MobiRides. Make sure to use a valid email address that you can access."})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"testEmail",className:"block text-sm font-medium mb-2",children:"Test Email Address"}),e.jsx(U,{id:"testEmail",type:"email",value:r,onChange:i=>t(i.target.value),placeholder:"Enter your test email address",disabled:s})]}),e.jsx(g,{onClick:R,disabled:s||!r,className:"bg-purple-600 hover:bg-purple-700",children:s?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}),"Running Tests..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Run All Tests"]})})]}),s&&n&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(k,{className:"h-4 w-4 animate-spin"}),"Currently running: ",n]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(u,{children:[e.jsx(p,{className:"pb-3",children:e.jsxs(f,{className:"text-sm flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Configuration Test"]})}),e.jsx(h,{children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>T("configuration"),disabled:s,className:"w-full",children:"Test Config"})})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(f,{className:"text-sm",children:"Basic Email Test"})}),e.jsx(h,{children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>T("basic"),disabled:s,className:"w-full",children:"Test Basic Email"})})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(f,{className:"text-sm",children:"Template Email Test"})}),e.jsx(h,{children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>T("template"),disabled:s,className:"w-full",children:"Test Template"})})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(f,{className:"text-sm",children:"Confirmation Email"})}),e.jsx(h,{children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>T("confirmation"),disabled:s,className:"w-full",children:"Test Confirmation"})})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(f,{className:"text-sm",children:"Booking Notification"})}),e.jsx(h,{children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>T("booking"),disabled:s,className:"w-full",children:"Test Booking Email"})})]})]}),w&&(m||y.length>0)&&e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsx(f,{children:"Test Results"}),m&&e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("span",{children:["Total: ",m.total]}),e.jsxs("span",{className:"text-green-600",children:["Passed: ",m.passed]}),e.jsxs("span",{className:"text-red-600",children:["Failed: ",m.failed]})]})]}),e.jsx(h,{children:e.jsx("div",{className:"space-y-3",children:y.map((i,o)=>e.jsxs("div",{className:"flex items-start justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[S(i.success),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.testName}),i.messageId&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Message ID: ",i.messageId]}),i.templateUsed&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Template: ",i.templateUsed]}),i.error&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Error: ",i.error]}),i.config&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Templates: ",i.config.templatesCount," | Function Available: ",i.config.supabaseFunctionAvailable?"Yes":"No"]})]})]}),B(i.success)]},o))})})]})]})},xe=()=>{const r=P();return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>r(-1),className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Email Service Testing"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Test and validate Resend email integration for MobiRides"})]})]})})}),e.jsx("div",{className:"py-8",children:e.jsx(V,{})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Testing Instructions:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Enter a valid email address that you can access"}),e.jsx("li",{children:"‚Ä¢ Run individual tests to check specific functionality"}),e.jsx("li",{children:'‚Ä¢ Use "Run All Tests" to execute the complete test suite'}),e.jsx("li",{children:"‚Ä¢ Check your email inbox for test messages"}),e.jsx("li",{children:"‚Ä¢ Review test results for any configuration issues"})]})]}),e.jsxs("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"Common Issues:"}),e.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ If tests fail, check the RESEND_API_KEY in your .env file"}),e.jsx("li",{children:"‚Ä¢ Ensure the FROM_EMAIL domain is verified in Resend"}),e.jsx("li",{children:"‚Ä¢ Check browser console for detailed error messages"}),e.jsx("li",{children:"‚Ä¢ Verify Supabase edge functions are deployed and accessible"})]})]})]})]})};export{xe as default};

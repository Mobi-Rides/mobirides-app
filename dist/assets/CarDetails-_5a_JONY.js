const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/notificationService-Mb9jp89M.js","assets/index-DJr5SZzu.js","assets/query-vendor-C7aRRP05.js","assets/react-vendor-mnpoGfEl.js","assets/supabase-vendor-BOn0LdFJ.js","assets/mapbox-vendor-fnXFVHMy.js","assets/date-vendor-Dhms5dOu.js","assets/index-BLKjScHC.css"])))=>i.map(i=>d[i]);
import{j as t,a as ts,u as Fe}from"./query-vendor-C7aRRP05.js";import{c as q,s as $,J as O,af as ss,D as ze,b as qe,d as Ve,e as He,t as Nt,E as ns,B as U,a3 as St,a0 as ce,a2 as rs,ag as os,ah as as,r as Ct,m as ct,ai as lt,n as dt,aa as is,aj as cs,ak as ls,U as ds,y as us,u as fs,ad as ms,T as hs}from"./index-DJr5SZzu.js";import{S as me}from"./skeleton-BhL2eYwv.js";import{N as Oe}from"./Navigation-PKFoOZ-i.js";import{r as g,u as Pe,k as Lt,L as ut}from"./react-vendor-mnpoGfEl.js";import{_ as gs}from"./supabase-vendor-BOn0LdFJ.js";import{C as xs,P as ps,a as ys,b as bs}from"./popover-BK9ujFOl.js";import{s as ks,p as ft,a as W}from"./date-vendor-Dhms5dOu.js";import{u as Et}from"./useVerificationStatus-DbVU-ikZ.js";import{V as Mt}from"./VerificationRequiredDialog-DOCBrwgi.js";import{G as mt}from"./mapbox-gl-BjqMLktz.js";import{L as vs}from"./LocationSearchInput-DI27tYf8.js";import{m as he}from"./mapbox-vendor-fnXFVHMy.js";import{C as Pt,K as js,a as ws,b as Ns}from"./CarDescription-CwE-YILS.js";import{C as Dt}from"./clock-B-BcoQFY.js";import{C as Ue}from"./calendar-DXV6iOkH.js";import{C as Ss}from"./circle-alert-rcKd2uBC.js";import{M as Ge}from"./map-pin-ZtPByMlX.js";import{H as Cs,i as Ls,u as Es,s as Ms,C as Ps}from"./savedCarService-BmxknAfR.js";import{M as Ds}from"./message-square-CtIehbg2.js";import{C as Ke,a as Je,b as Qe,d as Ye}from"./card-DMFn2_TK.js";import{C as Is}from"./car-DLlpGS8d.js";import{C as ht}from"./camera-BcCOKkLE.js";import{S as Ts}from"./shield-CWWsRMeH.js";import{A as As}from"./arrow-right-Bms2Nl_L.js";import{S as _s}from"./star-DQurhe2X.js";import{d as Bs}from"./index-DE7TNQN2.js";import"./bell-B7yjendS.js";import"./user-CCMNZbkj.js";import"./chevron-left-B1nGMQIr.js";import"./file-text-kSIK8kmv.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=q("AirVent",[["path",{d:"M6 12H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"larmp2"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"M18.3 17.7a2.5 2.5 0 0 1-3.16 3.83 2.53 2.53 0 0 1-1.14-2V12",key:"1bo8pg"}],["path",{d:"M6.6 15.6A2 2 0 1 0 10 17v-5",key:"t9h90c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=q("Baby",[["path",{d:"M9 12h.01",key:"157uk2"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"5yv0yz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=q("Bluetooth",[["path",{d:"m7 7 10 10-5 5V2l5 5L7 17",key:"1q5490"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=q("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=q("CalendarX",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m14 14-4 4",key:"rymu2i"}],["path",{d:"m10 14 4 4",key:"3sz06r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=q("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=q("FolderTree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=q("Locate",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=q("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=q("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=q("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=q("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=q("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=q("Sofa",[["path",{d:"M20 9V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3",key:"1dgpiv"}],["path",{d:"M2 16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v1.5a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5V11a2 2 0 0 0-4 0z",key:"xacw8m"}],["path",{d:"M4 18v2",key:"jwo5n2"}],["path",{d:"M20 18v2",key:"1ar1qi"}],["path",{d:"M12 4v9",key:"oqhhn3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=q("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=q("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=q("Umbrella",[["path",{d:"M22 12a10.06 10.06 1 0 0-20 0Z",key:"1teyop"}],["path",{d:"M12 12v8a2 2 0 0 0 4 0",key:"ulpmoc"}],["path",{d:"M12 2v1",key:"11qlp1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=q("Webcam",[["circle",{cx:"12",cy:"10",r:"8",key:"1gshiw"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 22h10",key:"10w4w3"}],["path",{d:"M12 22v-4",key:"1utk9m"}]]),pt=async()=>{console.log("Checking for expired booking requests...");try{const e=ks(new Date),{data:s,error:r}=await $.from("bookings").select("*").eq("status","pending").lt("start_date",e.toISOString());if(r)throw r;if(s&&s.length>0){const{error:n}=await $.from("bookings").update({status:"expired"}).in("id",s.map(i=>i.id));if(n)throw n;console.log(`Updated ${s.length} expired booking requests`)}}catch(e){console.error("Error in handleExpiredBookings:",e instanceof Error?e.message:JSON.stringify(e,null,2))}},yt=async(e,s,r,n)=>{try{let i=$.from("bookings").select("*").eq("car_id",e).in("status",["confirmed","pending"]).or(`and(start_date.lte.${W(r,"yyyy-MM-dd")},end_date.gte.${W(s,"yyyy-MM-dd")})`);const{data:o,error:a}=await i;return a?(console.error("Error checking car availability:",a),!1):!o||o.length===0}catch(i){return console.error("Error in checkCarAvailability:",i),!1}},Ws=async e=>{try{const{data:s,error:r}=await $.from("bookings").select("start_date, end_date").eq("car_id",e).in("status",["confirmed","pending"]);if(r)return console.error("Error fetching booked dates:",r),[];const n=[];return s==null||s.forEach(i=>{const o=ft(i.start_date),a=ft(i.end_date),l=new Date(o);for(;l<=a;)n.push(new Date(l)),l.setDate(l.getDate()+1)}),n}catch(s){return console.error("Error in getBookedDates:",s),[]}},en=(e,s)=>s.some(r=>e.getDate()===r.getDate()&&e.getMonth()===r.getMonth()&&e.getFullYear()===r.getFullYear());var bt=["light","dark"],tn="(prefers-color-scheme: dark)",sn=g.createContext(void 0),nn={setTheme:e=>{},themes:[]},rn=()=>{var e;return(e=g.useContext(sn))!=null?e:nn};g.memo(({forcedTheme:e,storageKey:s,attribute:r,enableSystem:n,enableColorScheme:i,defaultTheme:o,value:a,attrs:l,nonce:d})=>{let c=o==="system",x=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${l.map(u=>`'${u}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,m=i?bt.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",f=(u,p=!1,b=!0)=>{let h=a?a[u]:u,k=p?u+"|| ''":`'${h}'`,v="";return i&&b&&!p&&bt.includes(u)&&(v+=`d.style.colorScheme = '${u}';`),r==="class"?p||h?v+=`c.add(${k})`:v+="null":h&&(v+=`d[s](n,${k})`),v},y=e?`!function(){${x}${f(e)}}()`:n?`!function(){try{${x}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${c})){var t='${tn}',m=window.matchMedia(t);if(m.media!==t||m.matches){${f("dark")}}else{${f("light")}}}else if(e){${a?`var x=${JSON.stringify(a)};`:""}${f(a?"x[e]":"e",!0)}}${c?"":"else{"+f(o,!1,!1)+"}"}${m}}catch(e){}}()`:`!function(){try{${x}var e=localStorage.getItem('${s}');if(e){${a?`var x=${JSON.stringify(a)};`:""}${f(a?"x[e]":"e",!0)}}else{${f(o,!1,!1)};}${m}}catch(t){}}();`;return g.createElement("script",{nonce:d,dangerouslySetInnerHTML:{__html:y}})});const on=({mapboxToken:e,selectedLocation:s,onMapClick:r,onMapRef:n,onGeolocateRef:i,onUserLocationUpdate:o,mapStyle:a="mapbox://styles/mapbox/streets-v12"})=>{const l=g.useRef(null),d=g.useRef(null),c=g.useRef(null),[x,m]=g.useState(!1);return g.useEffect(()=>{if(!e||!l.current||d.current)return;he.accessToken=e,d.current=new he.Map({container:l.current,style:a,center:[25.9087,-24.6541],zoom:14,interactive:!0}),d.current.addControl(new he.NavigationControl,"top-right");const f=new he.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});return d.current.addControl(f,"top-right"),i(f),f.on("geolocate",y=>{console.log("Geolocate event:",y.coords),o({latitude:y.coords.latitude,longitude:y.coords.longitude})}),f.on("error",y=>{console.error("Geolocation error:",y),O.error("Unable to access your location. Please check permissions.")}),d.current.on("load",()=>{console.log("Map loaded successfully"),m(!0),n(d.current)}),d.current.on("error",y=>{console.error("Map error:",y),O.error("Error loading map. Please refresh.")}),d.current.on("click",y=>{console.log("Map clicked at:",y.lngLat),r(y.lngLat.lng,y.lngLat.lat)}),()=>{d.current&&(d.current.remove(),d.current=null,n(null),i(null))}},[e,a,n,i,o,r]),g.useEffect(()=>{if(!(!d.current||!x)&&(c.current&&(c.current.remove(),c.current=null),s)){const f=document.createElement("div");if(f.className="location-marker",f.style.width="20px",f.style.height="20px",f.style.borderRadius="50%",f.style.backgroundColor="#ef4444",f.style.border="3px solid white",f.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.3)",f.style.cursor="pointer",f.style.animation="pulse 2s infinite",!document.querySelector("#location-marker-styles")){const y=document.createElement("style");y.id="location-marker-styles",y.textContent=`
          @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
          }
        `,document.head.appendChild(y)}c.current=new he.Marker(f,{draggable:!0}).setLngLat([s.lng,s.lat]).addTo(d.current),c.current.on("dragend",()=>{var u;const y=(u=c.current)==null?void 0:u.getLngLat();y&&(console.log("Marker dragged to:",y),r(y.lng,y.lat))}),d.current.flyTo({center:[s.lng,s.lat],zoom:16,essential:!0})}},[s,x,r]),t.jsx("div",{className:"relative w-full h-full",children:t.jsx("div",{ref:l,className:"w-full h-full"})})},an=({isOpen:e,onClose:s,onLocationSelected:r})=>{const[n,i]=g.useState(null),[o,a]=g.useState(""),l=g.useRef(null),d=g.useRef(null),[c,x]=g.useState(null),[m,f]=g.useState(!0),[y,u]=g.useState(null),{theme:p}=rn(),b=g.useCallback(async(j,N)=>{if(c)try{const M=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${N},${j}.json?access_token=${c}`)).json();M.features&&M.features.length>0&&a(M.features[0].place_name)}catch(T){console.error("Error fetching address:",T)}},[c,a]),h=g.useCallback((j,N)=>{console.log("Map clicked at:",{lat:N,lng:j}),i({lat:N,lng:j}),b(N,j)},[b]),k=g.useCallback(j=>{l.current=j},[]),v=()=>p==="dark"?"mapbox://styles/mapbox/navigation-night-v1":"mapbox://styles/mapbox/navigation-day-v1";g.useEffect(()=>{(async()=>{try{const N=await St();if(!N){O.error("Failed to get the map token");return}console.log("Mapbox token retrieved successfully"),x(N),f(!1)}catch(N){console.error("Error getting Mapbox token:",N),O.error("Failed to load map configuration")}})()},[]);const L=()=>{n?(r(n.lat,n.lng),s()):O.error("Please select a location first")},E=()=>{d.current?d.current.trigger():O.error("Geolocation not available")},C=g.useCallback(j=>{console.log("User location updated:",j),u({lat:j.latitude,lng:j.longitude}),i({lat:j.latitude,lng:j.longitude}),b(j.latitude,j.longitude)},[b]),S=j=>{const[N,T]=j.coordinates;i({lat:T,lng:N}),a(j.full_address),l.current&&l.current.flyTo({center:[N,T],zoom:16,essential:!0})};return g.useEffect(()=>{e&&(i(null),a(""),u(null))},[e]),t.jsx(ss,{children:t.jsx(ze,{open:e,onOpenChange:j=>{j||s()},children:t.jsxs(qe,{className:"sm:max-w-[700px] h-[85vh] max-h-[900px] flex flex-col overflow-hidden p-0",children:[t.jsxs(Ve,{className:"p-6 pb-4",children:[t.jsx(He,{children:"Select Pickup Location"}),t.jsx(Nt,{className:"text-sm text-muted-foreground",children:"Search for a location, click on the map, or use your current location."})]}),t.jsx("div",{className:"px-6 pb-4",children:t.jsx(vs,{placeholder:"Search for addresses, landmarks, places...",onLocationSelect:S,className:"w-full"})}),t.jsxs(ns,{className:"flex-1 overflow-auto px-6 py-2",children:[t.jsxs("div",{className:"relative w-full rounded-md overflow-hidden border border-border mb-4",style:{height:"400px",minHeight:"300px"},children:[(m||!c)&&t.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",children:t.jsx(me,{className:"w-full h-full"})}),t.jsx(on,{mapboxToken:c,selectedLocation:n,onMapClick:h,onMapRef:k,onGeolocateRef:j=>d.current=j,onUserLocationUpdate:C,mapStyle:v()}),n&&t.jsxs("div",{className:"absolute top-2 left-2 bg-background/90 p-2 rounded-md shadow-sm border border-border text-xs max-w-[200px]",children:[t.jsx("p",{className:"font-medium",children:"Selected Location"}),t.jsxs("p",{children:["Lat: ",n.lat.toFixed(6)]}),t.jsxs("p",{children:["Lng: ",n.lng.toFixed(6)]}),o&&t.jsx("p",{className:"mt-1 text-muted-foreground truncate",children:o})]}),t.jsx("div",{className:"absolute top-2 right-2",children:t.jsxs(U,{size:"sm",variant:"secondary",className:"h-8 shadow-sm",onClick:E,disabled:!c||m,children:[t.jsx(Hs,{className:"h-4 w-4 mr-1"}),"Use My Location"]})})]}),t.jsx("div",{className:"flex flex-col gap-2 mb-4",children:t.jsx("p",{className:"text-xs text-muted-foreground",children:m?"Loading map...":c?n?`Location selected${o?`: ${o}`:". Click confirm to use this location."}`:"Search for a location above, click on the map, or use your current location.":"Map configuration not available"})})]}),t.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t sticky bottom-0 bg-background",children:[t.jsx(U,{variant:"outline",onClick:s,children:"Cancel"}),t.jsx(U,{onClick:L,disabled:!n,children:"Confirm Location"})]})]})})})},It=g.forwardRef(({...e},s)=>t.jsx("nav",{ref:s,"aria-label":"breadcrumb",...e}));It.displayName="Breadcrumb";const Tt=g.forwardRef(({className:e,...s},r)=>t.jsx("ol",{ref:r,className:ce("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",e),...s}));Tt.displayName="BreadcrumbList";const At=g.forwardRef(({className:e,...s},r)=>t.jsx("li",{ref:r,className:ce("inline-flex items-center gap-1.5",e),...s}));At.displayName="BreadcrumbItem";const cn=g.forwardRef(({asChild:e,className:s,...r},n)=>{const i=e?os:"a";return t.jsx(i,{ref:n,className:ce("transition-colors hover:text-foreground",s),...r})});cn.displayName="BreadcrumbLink";const _t=g.forwardRef(({className:e,...s},r)=>t.jsx("span",{ref:r,role:"link","aria-disabled":"true","aria-current":"page",className:ce("font-normal text-foreground",e),...s}));_t.displayName="BreadcrumbPage";const Bt=({children:e,className:s,...r})=>t.jsx("li",{role:"presentation","aria-hidden":"true",className:ce("[&>svg]:size-3.5",s),...r,children:e??t.jsx(rs,{})});Bt.displayName="BreadcrumbSeparator";const Ot=({currentStep:e,bookingId:s})=>{const r=[{key:"selection",label:"Car Selection",completed:!0},{key:"confirmation",label:"Booking Details",completed:e!=="selection"},{key:"success",label:"Confirmation",completed:["success","handover"].includes(e)},{key:"handover",label:"Handover",completed:e==="handover"}],n=i=>i.completed&&e!==i.key?t.jsx(Pt,{className:"h-4 w-4 text-green-600"}):e===i.key?t.jsx(Dt,{className:"h-4 w-4 text-primary"}):t.jsx(as,{className:"h-4 w-4 text-muted-foreground"});return t.jsxs("div",{className:"p-4 bg-muted/50 border-b",children:[t.jsx(It,{children:t.jsx(Tt,{children:r.map((i,o)=>t.jsxs("div",{className:"flex items-center",children:[t.jsxs(At,{className:"flex items-center gap-2",children:[n(i),e===i.key?t.jsx(_t,{className:"font-medium",children:i.label}):t.jsx("span",{className:`text-sm ${i.completed?"text-green-600 font-medium":"text-muted-foreground"}`,children:i.label})]}),o<r.length-1&&t.jsx(Bt,{})]},i.key))})}),s&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Booking ID: ",s]})]})},ln=({isOpen:e,onClose:s,bookingData:r})=>{const n=Pe(),[i,o]=g.useState(5),a=g.useCallback(()=>{s(),n("/bookings")},[s,n]);g.useEffect(()=>{if(!e){o(5);return}const d=setInterval(()=>{o(c=>c<=1?(a(),0):c-1)},1e3);return()=>clearInterval(d)},[e,a]);const l=()=>{s()};return t.jsx(ze,{open:e,onOpenChange:l,children:t.jsxs(qe,{className:"sm:max-w-[500px] p-0",children:[t.jsx(Ot,{currentStep:"success",bookingId:r==null?void 0:r.id}),t.jsxs("div",{className:"p-6",children:[t.jsxs(Ve,{className:"text-center",children:[t.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:t.jsx(Pt,{className:"h-8 w-8 text-green-600"})}),t.jsx(He,{className:"text-xl font-semibold",children:"Booking Request Submitted!"})]}),t.jsxs("div",{className:"space-y-4 mt-6",children:[t.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[t.jsx("h3",{className:"font-medium text-sm text-muted-foreground uppercase tracking-wide",children:"Booking Details"}),r&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(Ue,{className:"h-4 w-4 text-primary"})}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:[r.carBrand," ",r.carModel]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["BWP ",r.totalPrice]})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-50 rounded-full flex items-center justify-center",children:t.jsx(Dt,{className:"h-4 w-4 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"Rental Period"}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.startDate," to ",r.endDate]})]})]})]})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"What happens next?"}),t.jsxs("ul",{className:"space-y-1 text-sm text-blue-800 dark:text-blue-200",children:[t.jsx("li",{children:"• The car owner will review your request"}),t.jsx("li",{children:"• You'll be notified once it's approved"}),t.jsx("li",{children:"• Pickup details will be shared via messages"}),t.jsx("li",{children:"• Handover process will be available on booking day"})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[t.jsx(U,{variant:"outline",onClick:l,className:"flex-1",children:"Close"}),t.jsxs(U,{onClick:a,className:"flex-1",children:["View My Bookings ",i>0&&`(${i}s)`]})]})]})]})]})})},dn=({car:e,isOpen:s,onClose:r})=>{const[n,i]=g.useState(),[o,a]=g.useState(),[l,d]=g.useState("09:00"),[c,x]=g.useState("18:00"),[m,f]=g.useState(!1),[y,u]=g.useState(!1),[p,b]=g.useState(null),[h,k]=g.useState([]),[v,L]=g.useState(!1),[E,C]=g.useState(!0),[S,j]=g.useState(!1),[N,T]=g.useState(null),[M,z]=g.useState(!1),[te,ee]=g.useState(!1),[se,le]=g.useState(null),Q=g.useRef(!0),{toast:V}=Ct(),ne=Pe(),{isVerified:ie,isLoading:G}=Et();g.useEffect(()=>{(async()=>{var F,I;const{data:P}=await $.auth.getSession(),H=(I=(F=P.session)==null?void 0:F.user)==null?void 0:I.id;Q.current&&(b(H),H&&e.owner_id===H&&u(!0))})()},[e.owner_id]),g.useEffect(()=>{s&&e.id&&((async()=>{const P=await Ws(e.id);k(P)})(),pt().catch(console.error))},[s,e.id]),g.useEffect(()=>{n&&o?(async()=>{if(n&&o&&e.id){L(!0);try{const P=await yt(e.id,n,o);C(P)}catch(P){console.error("Error checking availability:",P),C(!1)}finally{L(!1)}}})():C(!0)},[n,o,e.id]),g.useEffect(()=>(s&&pt().catch(console.error),()=>{}),[s]),g.useEffect(()=>{e.latitude&&e.longitude&&T({latitude:e.latitude,longitude:e.longitude})},[e]),g.useEffect(()=>()=>{Q.current=!1},[]);const de=async(D,P,H,F,I)=>{console.log("Creating notification:",{userId:D,type:P,content:H,carId:F,bookingId:I});const{error:w}=await $.rpc("create_booking_notification",{p_booking_id:I,p_notification_type:"booking_request",p_content:H});return w?(console.error("Error creating notification:",w.message||JSON.stringify(w,null,2)),!1):!0},ue=async()=>{var I,w,_;const{data:D,error:P}=await $.auth.getSession();if(P||!((I=D.session)!=null&&I.user)){V({title:"Session expired",description:"Please sign in again to continue with your booking",variant:"destructive"}),ne("/login");return}if(!ie&&!G){z(!0);return}if(y){V({title:"Not allowed",description:"You cannot book your own car",variant:"destructive"});return}if(!n||!o){V({title:"Error",description:"Please select both start and end dates",variant:"destructive"});return}if(!await yt(e.id,n,o)){V({title:"Not available",description:"This car is not available for the selected dates. Please choose different dates."});return}if(!N){V({title:"Error",description:"Please select a pickup location",variant:"destructive"});return}f(!0);const F=setTimeout(()=>{Q.current&&(f(!1),V({title:"Timeout",description:"Booking is taking longer than expected. Please check your bookings page.",variant:"destructive"}))},3e4);try{console.log("[BookingDialog] Starting booking process...");const{data:A}=await $.auth.getSession();if(!((w=A.session)!=null&&w.user))throw new Error("No authenticated user");const Z=(Math.ceil((o.getTime()-n.getTime())/(1e3*60*60*24))+1)*e.price_per_day;console.log("[BookingDialog] Creating booking in database...");const{data:J,error:oe}=await $.from("bookings").insert({car_id:e.id,renter_id:A.session.user.id,start_date:W(n,"yyyy-MM-dd"),end_date:W(o,"yyyy-MM-dd"),start_time:l,end_time:c,total_price:Z,latitude:N.latitude,longitude:N.longitude,status:"pending"}).select().single();if(oe)throw oe;console.log("[BookingDialog] Booking created successfully:",J.id),console.log("[BookingDialog] Creating notifications and sending Twilio alerts...");const{data:Y}=await $.from("profiles").select("full_name, phone_number").eq("id",A.session.user.id).single(),{data:X}=await $.from("profiles").select("full_name, phone_number").eq("id",e.owner_id).single(),{TwilioNotificationService:pe}=await gs(async()=>{const{TwilioNotificationService:R}=await import("./notificationService-Mb9jp89M.js");return{TwilioNotificationService:R}},__vite__mapDeps([0,1,2,3,4,5,6,7])),be=pe.getInstance(),ke={bookingId:J.id,customerName:(Y==null?void 0:Y.full_name)||"Customer",hostName:(X==null?void 0:X.full_name)||"Host",carBrand:e.brand,carModel:e.model,pickupDate:W(n,"PPP"),pickupTime:l,pickupLocation:e.location||"Pickup location",dropoffLocation:e.location||"Return location",totalAmount:Z,bookingReference:`MR-${J.id.slice(-8).toUpperCase()}`};if(Y)try{const R=await be.sendBookingConfirmation({id:A.session.user.id,name:Y.full_name||"Customer",email:A.session.user.email,phone:Y.phone_number,whatsappEnabled:!0,emailEnabled:!0},ke);console.log("✅ Renter Twilio notifications sent:",R)}catch(R){console.error("❌ Failed to send renter Twilio notifications:",R)}if(X)try{const{data:R}=await $.auth.admin.getUserById(e.owner_id),Le=await be.sendBookingConfirmation({id:e.owner_id,name:X.full_name||"Host",email:(_=R.user)==null?void 0:_.email,phone:X.phone_number,whatsappEnabled:!0,emailEnabled:!0},{...ke,customerName:X.full_name||"Host"});console.log("✅ Host Twilio notifications sent:",Le)}catch(R){console.error("❌ Failed to send host Twilio notifications:",R)}try{await de(A.session.user.id,"booking_request",`Your booking request for ${e.brand} ${e.model} from ${W(n,"PPP")} to ${W(o,"PPP")} has been submitted.`,e.id,J.id)}catch(R){console.error("Failed to create renter notification (non-blocking):",R instanceof Error?R.message:JSON.stringify(R,null,2))}try{await de(e.owner_id,"booking_request",`New booking request received for your ${e.brand} ${e.model} from ${W(n,"PPP")} to ${W(o,"PPP")}.`,e.id,J.id)}catch(R){console.error("Failed to create host notification (non-blocking):",R instanceof Error?R.message:JSON.stringify(R,null,2))}if(!Q.current)return;console.log("[BookingDialog] Booking flow completed successfully, showing success modal..."),le({id:J.id,carBrand:e.brand,carModel:e.model,startDate:W(n,"PPP"),endDate:W(o,"PPP"),totalPrice:Z}),r(),ee(!0)}catch(A){if(!Q.current)return;console.error("Booking error:",A instanceof Error?A.message:JSON.stringify(A,null,2)),V({title:"Error",description:"Failed to create booking. Please try again.",variant:"destructive"})}finally{clearTimeout(F),Q.current&&f(!1)}},re=(D,P)=>{T({latitude:D,longitude:P})},ge=()=>N?N.latitude===e.latitude&&N.longitude===e.longitude?`Default: ${e.location}`:`Custom location (${N.latitude.toFixed(4)}, ${N.longitude.toFixed(4)})`:"No location selected",xe=D=>{const P=new Date;return P.setDate(P.getDate()),P.setHours(0,0,0,0),D<P?!0:en(D,h)};return t.jsxs(t.Fragment,{children:[t.jsx(ze,{open:s,onOpenChange:r,children:t.jsxs(qe,{className:"sm:max-w-[425px] max-h-[90vh] overflow-y-auto p-0",children:[t.jsx(Ot,{currentStep:"confirmation"}),t.jsxs("div",{className:"p-6",children:[t.jsxs(Ve,{children:[t.jsxs(He,{children:["Book ",e.brand," ",e.model]}),t.jsx(Nt,{className:"text-muted-foreground",children:"Select your rental dates and pickup location"})]}),y&&t.jsxs(ct,{variant:"destructive",className:"mb-4",children:[t.jsx(Ss,{className:"h-4 w-4"}),t.jsx(lt,{children:"Not allowed"}),t.jsx(dt,{children:"You cannot book your own car. This is for other renters only."})]}),!E&&n&&o&&t.jsxs(ct,{variant:"destructive",className:"mb-4",children:[t.jsx(zs,{className:"h-4 w-4"}),t.jsx(lt,{children:"Not available"}),t.jsx(dt,{children:"This car is not available for the selected dates. Please choose different dates."})]}),t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"font-medium",children:"Select dates"}),t.jsx(xs,{mode:"range",selected:{from:n,to:o},onSelect:D=>{i(D==null?void 0:D.from),a(D==null?void 0:D.to)},numberOfMonths:1,disabled:xe,modifiers:{booked:h},modifiersStyles:{booked:{backgroundColor:"rgba(239, 68, 68, 0.1)",color:"rgb(239, 68, 68)",textDecoration:"line-through"}}})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"font-medium",children:"Pickup Location"}),t.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(Ge,{className:"h-5 w-5 text-primary mt-0.5 flex-shrink-0"}),t.jsx("div",{className:"text-sm",children:t.jsx("p",{children:ge()})})]}),t.jsx(U,{variant:"outline",size:"sm",onClick:()=>j(!0),children:"Change"})]})]}),n&&o&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"font-medium",children:"Summary"}),t.jsxs("div",{className:"text-sm space-y-1 p-4 bg-primary/5 rounded-md",children:[t.jsxs("p",{children:["Start date: ",W(n,"PPP")]}),t.jsxs("p",{children:["End date: ",W(o,"PPP")]}),t.jsx("div",{className:"border-t border-border pt-2 mt-2",children:t.jsxs("p",{className:"font-medium text-primary",children:["Total: BWP"," ",Math.ceil((o.getTime()-n.getTime())/(1e3*60*60*24)+1)*e.price_per_day]})}),t.jsx(U,{variant:"outline",size:"sm",onClick:()=>j(!0),children:"Change"})]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 pt-4 border-t",children:[t.jsx(U,{variant:"outline",onClick:r,className:"w-full sm:w-auto",children:"Cancel"}),t.jsx(U,{onClick:!ie&&!G?()=>z(!0):ue,disabled:!n||!o||m||y||v||!E||!N||G,className:"w-full sm:w-auto",variant:!ie&&!G?"outline":"default",children:m?"Booking...":v?"Checking...":G?"Checking verification...":ie?"Confirm":"Start Verification"})]})]})]})}),t.jsx(Mt,{isOpen:M,onClose:()=>z(!1),action:"booking",carData:e}),t.jsx(an,{isOpen:S,onClose:()=>j(!1),onLocationSelected:re}),t.jsx(ln,{isOpen:te,onClose:()=>ee(!1),bookingData:se})]})},un=({car:e})=>{const[s,r]=g.useState(!1),[n,i]=g.useState(!1),[o,a]=g.useState(!1),[l,d]=g.useState(!1),[c,x]=g.useState(!1),[m,f]=g.useState(!1),{isVerified:y,isLoading:u}=Et(),p=Pe(),b=ts();g.useEffect(()=>{(async()=>{var S;const{data:E}=await $.auth.getSession(),C=!!E.session;if(x(C),C&&((S=E.session)!=null&&S.user)){const j=E.session.user.id;f(j===e.owner_id)}})();const{data:{subscription:L}}=$.auth.onAuthStateChange((E,C)=>{const S=!!C;if(x(S),S&&C){const j=C.user.id;f(j===e.owner_id)}else f(!1)});return()=>L.unsubscribe()},[e.owner_id]),g.useEffect(()=>{(async()=>{if(c)try{const L=await Ls(e.id);a(L)}catch(L){console.error("Failed to check if car is saved:",L)}})()},[e.id,c]);const h=()=>{if(!c){p("/login");return}if(m){O.error("You cannot book your own vehicle");return}if(!y&&!u){i(!0);return}r(!0)},k=async()=>{if(!c){p("/login");return}if(!l){d(!0);try{o?await Es(e.id)&&(a(!1),O.success("Vehicle removed from saved list"),b.invalidateQueries({queryKey:["saved-cars-full"]}),b.invalidateQueries({queryKey:["saved-car-ids"]})):await Ms(e.id)&&(a(!0),O.success("Vehicle added to saved list"),b.invalidateQueries({queryKey:["saved-cars-full"]}),b.invalidateQueries({queryKey:["saved-car-ids"]}))}catch{O.error("An error occurred. Please try again.")}finally{d(!1)}}};return t.jsxs("div",{className:"sticky bottom-[72px] bg-background dark:bg-gray-800 p-4 rounded-t-lg border-t border-gray-200 dark:border-gray-700 shadow-lg",children:[m?t.jsxs("div",{className:"flex items-center justify-center p-2 bg-muted rounded-lg",children:[t.jsx(Js,{className:"h-5 w-5 mr-2 text-amber-500"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"You own this vehicle"})]}):t.jsxs("div",{className:"flex gap-2",children:[t.jsx(U,{variant:"outline",className:"w-12 flex-shrink-0",onClick:k,disabled:l,children:t.jsx(Cs,{className:`${o?"fill-red-500 text-red-500":"text-gray-600 dark:text-gray-400"}`})}),t.jsxs(U,{className:"flex-1 flex items-center justify-center gap-2",onClick:h,children:[t.jsx(Ue,{className:"w-5 h-5"}),"Book Now"]})]}),t.jsx(dn,{car:e,isOpen:s,onClose:()=>r(!1)}),t.jsx(Mt,{isOpen:n,onClose:()=>i(!1),action:"booking",carData:e})]})},fn=({brand:e,model:s,year:r,location:n,pricePerDay:i,ownerId:o})=>{const{id:a}=Lt(),{user:l}=is(),d=Pe(),[c,x]=g.useState(!1),[m,f]=g.useState(!0),[y,u]=g.useState(!1),{createConversation:p,isCreatingConversation:b}=cs();g.useEffect(()=>{(async()=>{var L,E;try{f(!0);const{data:C}=await $.auth.getSession(),S=(E=(L=C==null?void 0:C.session)==null?void 0:L.user)==null?void 0:E.id;if(!S||!a){x(!1);return}const{data:j}=await $.from("cars").select("owner_id").eq("id",a).single();x((j==null?void 0:j.owner_id)===S||o===S)}catch(C){console.error("Error checking car ownership:",C),x(!1)}finally{f(!1)}})()},[a]);const h=async()=>{if(!a)return;const v=`${window.location.origin}/cars/${a}`;try{navigator.share?(await navigator.share({title:`${e} ${s} (${r})`,text:`Let's rent this ${e} ${s} on Mobi Rides`,url:v}),O.success("Shared successfully")):(await navigator.clipboard.writeText(v),u(!0),O.success("Link copied to clipboard"),setTimeout(()=>{u(!1)},2e3))}catch(L){console.error("Error sharing:",L),O.error("Failed to share. Please try again.")}},k=async()=>{if(!l){O.error("Please log in to contact the owner.");return}if(!o){O.error("Owner information not available.");return}try{const v={type:"direct",participantIds:[o],title:`Chat about ${e} ${s}`};p(v),d("/messages",{state:{recipientId:o,recipientName:`${e} ${s} Owner`}}),O.success("Starting conversation...")}catch(v){console.error("Error in handleStartConversation:",v),O.error("Failed to start conversation. Please try again.")}};return t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 p-4",children:t.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-start",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl md:text-3xl text-left text-gray-700 dark:text-white font-bold",children:[e," ",s]}),t.jsxs("div",{className:"flex items-center gap-1 mt-1 text-sm md:text-base text-muted-foreground dark:text-white",children:[t.jsx(Fs,{size:16,className:"h-4 w-4 mr-1 text-blue-500"}),t.jsx("span",{className:"text-sm md:text-base text-muted-foreground",children:r})]}),t.jsxs("div",{className:"flex items-center gap-1 mt-1 ",children:[t.jsx(Ge,{size:16,className:"h-4 w-4 mr-1 text-red-500"}),t.jsx("span",{className:"text-sm md:text-base text-muted-foreground",children:n})]}),t.jsxs("div",{className:"mt-8 flex items-center gap-1",children:[t.jsxs("h2",{className:"font-bold text-lg md:text-xl  text-primary",children:["BWP ",i]}),t.jsx("p",{className:"text-xs md:text-sm text-muted-foreground dark:text-white",children:"/day"})]})]}),t.jsxs("div",{className:"flex gap-2 mt-4 md:mt-0",children:[c&&t.jsx(U,{variant:"outline",size:"icon",className:"rounded-2xl md:size-auto md:px-4 md:py-2 md:flex md:items-center md:gap-2",asChild:!0,children:t.jsxs(ut,{to:`/edit-car/${a}`,children:[t.jsx(ls,{className:"h-4 w-4 text-[#581CFA] dark:text-white"}),t.jsx("span",{className:"hidden md:inline-block",children:t.jsx("p",{className:"text-[#581CFA] dark:text-white text-xs md:text-sm lg:text-base font-semibold",children:"Edit Car"})})]})}),t.jsxs(ps,{open:y,onOpenChange:u,children:[t.jsx(ys,{asChild:!0,children:t.jsxs(U,{variant:"outline",size:"icon",className:"rounded-2xl md:size-auto md:px-4 md:py-2 md:flex md:items-center md:gap-2",onClick:h,children:[t.jsx(Ks,{className:"h-4 w-4 text-[#581CFA] dark:text-white"}),t.jsx("span",{className:"hidden md:inline-block",children:t.jsx("p",{className:"text-[#581CFA] dark:text-white text-xs md:text-sm lg:text-base font-semibold",children:"Share"})})]})}),t.jsx(bs,{className:"w-auto p-2 text-sm",children:"Link copied!"})]}),t.jsx(U,{variant:"outline",size:"icon",className:"rounded-2xl md:size-auto md:px-4 md:py-2 md:flex md:items-center md:gap-2",asChild:!0,children:t.jsxs(ut,{to:"/bookings",children:[t.jsx(Ue,{className:"h-4 w-4 text-[#581CFA] dark:text-white"}),t.jsx("span",{className:"hidden md:inline-block",children:t.jsx("p",{className:"text-[#581CFA] dark:text-white text-xs md:text-sm lg:text-base font-semibold",children:"Bookings"})})]})}),!c&&o&&t.jsxs(U,{variant:"outline",size:"icon",className:"rounded-2xl md:size-auto md:px-4 md:py-2 md:flex md:items-center md:gap-2",onClick:k,disabled:b,children:[t.jsx(Ds,{className:"h-4 w-4 text-[#581CFA] dark:text-white"}),t.jsx("span",{className:"hidden md:inline-block",children:t.jsx("p",{className:"text-[#581CFA] dark:text-white text-xs md:text-sm lg:text-base font-semibold",children:b?"Connecting...":"Contact"})})]})]})]})})},mn=({transmission:e,fuel:s,seats:r,pricePerDay:n,features:i=[],variant:o="card"})=>{const a=l=>{switch(l){case"Air Conditioning":return t.jsx(Os,{className:"h-4 w-4"});case"Bluetooth":return t.jsx($s,{className:"h-4 w-4"});case"Cruise Control":return t.jsx(mt,{className:"h-4 w-4"});case"Navigation System":return t.jsx(qs,{className:"h-4 w-4"});case"Leather Seats":return t.jsx(xt,{className:"h-4 w-4"});case"Sunroof":return t.jsx(Xs,{className:"h-4 w-4"});case"Backup Camera":return t.jsx(ht,{className:"h-4 w-4"});case"Parking Sensors":return t.jsx(Zs,{className:"h-4 w-4"});case"Keyless Entry":return t.jsx(js,{className:"h-4 w-4"});case"Push Start":return t.jsx(Us,{className:"h-4 w-4"});case"Heated Seats":return t.jsx(Ys,{className:"h-4 w-4"});case"Premium Sound":return t.jsx(Gs,{className:"h-4 w-4"});case"Third Row Seating":return t.jsx(xt,{className:"h-4 w-4"});case"Blind Spot Monitor":return t.jsx(Ts,{className:"h-4 w-4"});case"360 Degree Camera":return t.jsx(ht,{className:"h-4 w-4"});case"Apple CarPlay":return t.jsx(gt,{className:"h-4 w-4"});case"Android Auto":return t.jsx(gt,{className:"h-4 w-4"});case"Roof Rack":return t.jsx(Vs,{className:"h-4 w-4"});case"Child Seat Anchor":return t.jsx(Rs,{className:"h-4 w-4"});case"Autonomous Driving":return t.jsx(mt,{className:"h-4 w-4"});default:return t.jsx(Qs,{className:"h-4 w-4"})}};return o==="grid"?t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm text-gray-600",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Is,{className:"w-4 h-4"}),e]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("i",{className:"w-4 h-4",children:"⛽"}),s]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("i",{className:"w-4 h-4",children:"👥"}),r," Seats"]})]}):t.jsxs(Ke,{className:"dark:bg-gray-800 dark:border-gray-700",children:[t.jsx(Je,{className:"pb-2",children:t.jsx(Qe,{className:"text-base text-left text-muted-foreground dark:text-white font-medium",children:"Car Specifications"})}),t.jsxs(Ye,{children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-6",children:[t.jsxs("div",{className:"p-4 bg-muted rounded-lg text-left w-full",children:[t.jsx(Ps,{className:"w-4 h-4 text-primary dark:text-primary-foreground"}),t.jsx("p",{className:"text-base md:text-xl text-left text-gray-700 dark:text-white font-medium mt-4",children:e}),t.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Car Fuel"})]}),t.jsxs("div",{className:"p-4 bg-muted rounded-lg text-left",children:[t.jsx(ds,{className:"w-4 h-4 text-primary dark:text-primary-foreground"}),t.jsx("p",{className:"text-base md:text-xl text-left text-gray-700 dark:text-white font-medium mt-4",children:r}),t.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Passenger Seats"})]})]}),i&&i.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"mb-3 text-base text-left text-muted-foreground dark:text-white font-medium",children:"Car Features"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2",children:i.map(l=>t.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-md border bg-muted/30",children:[t.jsx("span",{className:"text-primary",children:a(l)}),t.jsx("span",{className:"text-xs md:text-sm text-muted-foreground",children:l})]},l))})]})]})]})},hn=({pricePerDay:e,transmission:s,seats:r,features:n=[]})=>t.jsx(mn,{transmission:s,fuel:"Petrol",seats:r,pricePerDay:e,features:n,variant:"card"});function gn(e){return Object.prototype.toString.call(e)==="[object Object]"}function kt(e){return gn(e)||Array.isArray(e)}function xn(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Xe(e,s){const r=Object.keys(e),n=Object.keys(s);if(r.length!==n.length)return!1;const i=JSON.stringify(Object.keys(e.breakpoints||{})),o=JSON.stringify(Object.keys(s.breakpoints||{}));return i!==o?!1:r.every(a=>{const l=e[a],d=s[a];return typeof l=="function"?`${l}`==`${d}`:!kt(l)||!kt(d)?l===d:Xe(l,d)})}function vt(e){return e.concat().sort((s,r)=>s.name>r.name?1:-1).map(s=>s.options)}function pn(e,s){if(e.length!==s.length)return!1;const r=vt(e),n=vt(s);return r.every((i,o)=>{const a=n[o];return Xe(i,a)})}function Ze(e){return typeof e=="number"}function Re(e){return typeof e=="string"}function De(e){return typeof e=="boolean"}function jt(e){return Object.prototype.toString.call(e)==="[object Object]"}function B(e){return Math.abs(e)}function We(e){return Math.sign(e)}function je(e,s){return B(e-s)}function yn(e,s){if(e===0||s===0||B(e)<=B(s))return 0;const r=je(B(e),B(s));return B(r/e)}function we(e){return Ne(e).map(Number)}function ae(e){return e[Ce(e)]}function Ce(e){return Math.max(0,e.length-1)}function et(e,s){return s===Ce(e)}function wt(e,s=0){return Array.from(Array(e),(r,n)=>s+n)}function Ne(e){return Object.keys(e)}function Rt(e,s){return[e,s].reduce((r,n)=>(Ne(n).forEach(i=>{const o=r[i],a=n[i],l=jt(o)&&jt(a);r[i]=l?Rt(o,a):a}),r),{})}function $e(e,s){return typeof s.MouseEvent<"u"&&e instanceof s.MouseEvent}function bn(e,s){const r={start:n,center:i,end:o};function n(){return 0}function i(d){return o(d)/2}function o(d){return s-d}function a(d,c){return Re(e)?r[e](d):e(s,d,c)}return{measure:a}}function Se(){let e=[];function s(i,o,a,l={passive:!0}){let d;if("addEventListener"in i)i.addEventListener(o,a,l),d=()=>i.removeEventListener(o,a,l);else{const c=i;c.addListener(a),d=()=>c.removeListener(a)}return e.push(d),n}function r(){e=e.filter(i=>i())}const n={add:s,clear:r};return n}function kn(e,s,r,n){const i=Se(),o=1e3/60;let a=null,l=0,d=0;function c(){i.add(e,"visibilitychange",()=>{e.hidden&&u()})}function x(){y(),i.clear()}function m(b){if(!d)return;a||(a=b);const h=b-a;for(a=b,l+=h;l>=o;)r(o),l-=o;const k=l/o;n(k),d&&s.requestAnimationFrame(m)}function f(){d||(d=s.requestAnimationFrame(m))}function y(){s.cancelAnimationFrame(d),a=null,l=0,d=0}function u(){a=null,l=0}return{init:c,destroy:x,start:f,stop:y,update:()=>r(o),render:n}}function vn(e,s){const r=s==="rtl",n=e==="y",i=n?"y":"x",o=n?"x":"y",a=!n&&r?-1:1,l=x(),d=m();function c(u){const{height:p,width:b}=u;return n?p:b}function x(){return n?"top":r?"right":"left"}function m(){return n?"bottom":r?"left":"right"}function f(u){return u*a}return{scroll:i,cross:o,startEdge:l,endEdge:d,measureSize:c,direction:f}}function ye(e=0,s=0){const r=B(e-s);function n(c){return c<e}function i(c){return c>s}function o(c){return n(c)||i(c)}function a(c){return o(c)?n(c)?e:s:c}function l(c){return r?c-r*Math.ceil((c-s)/r):c}return{length:r,max:s,min:e,constrain:a,reachedAny:o,reachedMax:i,reachedMin:n,removeOffset:l}}function $t(e,s,r){const{constrain:n}=ye(0,e),i=e+1;let o=a(s);function a(f){return r?B((i+f)%i):n(f)}function l(){return o}function d(f){return o=a(f),m}function c(f){return x().set(l()+f)}function x(){return $t(e,l(),r)}const m={get:l,set:d,add:c,clone:x};return m}function jn(e,s,r,n,i,o,a,l,d,c,x,m,f,y,u,p,b,h,k){const{cross:v,direction:L}=e,E=["INPUT","SELECT","TEXTAREA"],C={passive:!1},S=Se(),j=Se(),N=ye(50,225).constrain(y.measure(20)),T={mouse:300,touch:400},M={mouse:500,touch:600},z=u?43:25;let te=!1,ee=0,se=0,le=!1,Q=!1,V=!1,ne=!1;function ie(w){if(!k)return;function _(K){(De(k)||k(w,K))&&xe(K)}const A=s;S.add(A,"dragstart",K=>K.preventDefault(),C).add(A,"touchmove",()=>{},C).add(A,"touchend",()=>{}).add(A,"touchstart",_).add(A,"mousedown",_).add(A,"touchcancel",P).add(A,"contextmenu",P).add(A,"click",H,!0)}function G(){S.clear(),j.clear()}function de(){const w=ne?r:s;j.add(w,"touchmove",D,C).add(w,"touchend",P).add(w,"mousemove",D,C).add(w,"mouseup",P)}function ue(w){const _=w.nodeName||"";return E.includes(_)}function re(){return(u?M:T)[ne?"mouse":"touch"]}function ge(w,_){const A=m.add(We(w)*-1),K=x.byDistance(w,!u).distance;return u||B(w)<N?K:b&&_?K*.5:x.byIndex(A.get(),0).distance}function xe(w){const _=$e(w,n);ne=_,V=u&&_&&!w.buttons&&te,te=je(i.get(),a.get())>=2,!(_&&w.button!==0)&&(ue(w.target)||(le=!0,o.pointerDown(w),c.useFriction(0).useDuration(0),i.set(a),de(),ee=o.readPoint(w),se=o.readPoint(w,v),f.emit("pointerDown")))}function D(w){if(!$e(w,n)&&w.touches.length>=2)return P(w);const A=o.readPoint(w),K=o.readPoint(w,v),Z=je(A,ee),J=je(K,se);if(!Q&&!ne&&(!w.cancelable||(Q=Z>J,!Q)))return P(w);const oe=o.pointerMove(w);Z>p&&(V=!0),c.useFriction(.3).useDuration(.75),l.start(),i.add(L(oe)),w.preventDefault()}function P(w){const A=x.byDistance(0,!1).index!==m.get(),K=o.pointerUp(w)*re(),Z=ge(L(K),A),J=yn(K,Z),oe=z-10*J,Y=h+J/50;Q=!1,le=!1,j.clear(),c.useDuration(oe).useFriction(Y),d.distance(Z,!u),ne=!1,f.emit("pointerUp")}function H(w){V&&(w.stopPropagation(),w.preventDefault(),V=!1)}function F(){return le}return{init:ie,destroy:G,pointerDown:F}}function wn(e,s){let n,i;function o(m){return m.timeStamp}function a(m,f){const u=`client${(f||e.scroll)==="x"?"X":"Y"}`;return($e(m,s)?m:m.touches[0])[u]}function l(m){return n=m,i=m,a(m)}function d(m){const f=a(m)-a(i),y=o(m)-o(n)>170;return i=m,y&&(n=m),f}function c(m){if(!n||!i)return 0;const f=a(i)-a(n),y=o(m)-o(n),u=o(m)-o(i)>170,p=f/y;return y&&!u&&B(p)>.1?p:0}return{pointerDown:l,pointerMove:d,pointerUp:c,readPoint:a}}function Nn(){function e(r){const{offsetTop:n,offsetLeft:i,offsetWidth:o,offsetHeight:a}=r;return{top:n,right:i+o,bottom:n+a,left:i,width:o,height:a}}return{measure:e}}function Sn(e){function s(n){return e*(n/100)}return{measure:s}}function Cn(e,s,r,n,i,o,a){const l=[e].concat(n);let d,c,x=[],m=!1;function f(b){return i.measureSize(a.measure(b))}function y(b){if(!o)return;c=f(e),x=n.map(f);function h(k){for(const v of k){if(m)return;const L=v.target===e,E=n.indexOf(v.target),C=L?c:x[E],S=f(L?e:n[E]);if(B(S-C)>=.5){b.reInit(),s.emit("resize");break}}}d=new ResizeObserver(k=>{(De(o)||o(b,k))&&h(k)}),r.requestAnimationFrame(()=>{l.forEach(k=>d.observe(k))})}function u(){m=!0,d&&d.disconnect()}return{init:y,destroy:u}}function Ln(e,s,r,n,i,o){let a=0,l=0,d=i,c=o,x=e.get(),m=0;function f(C){const S=C/1e3,j=d*S,N=n.get()-e.get(),T=!d;let M=0;return T?(a=0,r.set(n),e.set(n),M=N):(r.set(e),a+=N/j,a*=c,x+=a,e.add(a*S),M=x-m),l=We(M),m=x,E}function y(){const C=n.get()-s.get();return B(C)<.001}function u(){return d}function p(){return l}function b(){return a}function h(){return v(i)}function k(){return L(o)}function v(C){return d=C,E}function L(C){return c=C,E}const E={direction:p,duration:u,velocity:b,seek:f,settled:y,useBaseFriction:k,useBaseDuration:h,useFriction:L,useDuration:v};return E}function En(e,s,r,n,i){const o=i.measure(10),a=i.measure(50),l=ye(.1,.99);let d=!1;function c(){return!(d||!e.reachedAny(r.get())||!e.reachedAny(s.get()))}function x(y){if(!c())return;const u=e.reachedMin(s.get())?"min":"max",p=B(e[u]-s.get()),b=r.get()-s.get(),h=l.constrain(p/a);r.subtract(b*h),!y&&B(b)<o&&(r.set(e.constrain(r.get())),n.useDuration(25).useBaseFriction())}function m(y){d=!y}return{shouldConstrain:c,constrain:x,toggleActive:m}}function Mn(e,s,r,n,i){const o=ye(-s+e,0),a=m(),l=x(),d=f();function c(u,p){return je(u,p)<1}function x(){const u=a[0],p=ae(a),b=a.lastIndexOf(u),h=a.indexOf(p)+1;return ye(b,h)}function m(){return r.map((u,p)=>{const{min:b,max:h}=o,k=o.constrain(u),v=!p,L=et(r,p);return v?h:L||c(b,k)?b:c(h,k)?h:k}).map(u=>parseFloat(u.toFixed(3)))}function f(){if(s<=e+i)return[o.max];if(n==="keepSnaps")return a;const{min:u,max:p}=l;return a.slice(u,p)}return{snapsContained:d,scrollContainLimit:l}}function Pn(e,s,r){const n=s[0],i=r?n-e:ae(s);return{limit:ye(i,n)}}function Dn(e,s,r,n){const o=s.min+.1,a=s.max+.1,{reachedMin:l,reachedMax:d}=ye(o,a);function c(f){return f===1?d(r.get()):f===-1?l(r.get()):!1}function x(f){if(!c(f))return;const y=e*(f*-1);n.forEach(u=>u.add(y))}return{loop:x}}function In(e){const{max:s,length:r}=e;function n(o){const a=o-s;return r?a/-r:0}return{get:n}}function Tn(e,s,r,n,i){const{startEdge:o,endEdge:a}=e,{groupSlides:l}=i,d=m().map(s.measure),c=f(),x=y();function m(){return l(n).map(p=>ae(p)[a]-p[0][o]).map(B)}function f(){return n.map(p=>r[o]-p[o]).map(p=>-B(p))}function y(){return l(c).map(p=>p[0]).map((p,b)=>p+d[b])}return{snaps:c,snapsAligned:x}}function An(e,s,r,n,i,o){const{groupSlides:a}=i,{min:l,max:d}=n,c=x();function x(){const f=a(o),y=!e||s==="keepSnaps";return r.length===1?[o]:y?f:f.slice(l,d).map((u,p,b)=>{const h=!p,k=et(b,p);if(h){const v=ae(b[0])+1;return wt(v)}if(k){const v=Ce(o)-ae(b)[0]+1;return wt(v,ae(b)[0])}return u})}return{slideRegistry:c}}function _n(e,s,r,n,i){const{reachedAny:o,removeOffset:a,constrain:l}=n;function d(u){return u.concat().sort((p,b)=>B(p)-B(b))[0]}function c(u){const p=e?a(u):l(u),b=s.map((k,v)=>({diff:x(k-p,0),index:v})).sort((k,v)=>B(k.diff)-B(v.diff)),{index:h}=b[0];return{index:h,distance:p}}function x(u,p){const b=[u,u+r,u-r];if(!e)return u;if(!p)return d(b);const h=b.filter(k=>We(k)===p);return h.length?d(h):ae(b)-r}function m(u,p){const b=s[u]-i.get(),h=x(b,p);return{index:u,distance:h}}function f(u,p){const b=i.get()+u,{index:h,distance:k}=c(b),v=!e&&o(b);if(!p||v)return{index:h,distance:u};const L=s[h]-k,E=u+x(L,0);return{index:h,distance:E}}return{byDistance:f,byIndex:m,shortcut:x}}function Bn(e,s,r,n,i,o,a){function l(m){const f=m.distance,y=m.index!==s.get();o.add(f),f&&(n.duration()?e.start():(e.update(),e.render(1),e.update())),y&&(r.set(s.get()),s.set(m.index),a.emit("select"))}function d(m,f){const y=i.byDistance(m,f);l(y)}function c(m,f){const y=s.clone().set(m),u=i.byIndex(y.get(),f);l(u)}return{distance:d,index:c}}function On(e,s,r,n,i,o,a,l){const d={passive:!0,capture:!0};let c=0;function x(y){if(!l)return;function u(p){if(new Date().getTime()-c>10)return;a.emit("slideFocusStart"),e.scrollLeft=0;const k=r.findIndex(v=>v.includes(p));Ze(k)&&(i.useDuration(0),n.index(k,0),a.emit("slideFocus"))}o.add(document,"keydown",m,!1),s.forEach((p,b)=>{o.add(p,"focus",h=>{(De(l)||l(y,h))&&u(b)},d)})}function m(y){y.code==="Tab"&&(c=new Date().getTime())}return{init:x}}function ve(e){let s=e;function r(){return s}function n(d){s=a(d)}function i(d){s+=a(d)}function o(d){s-=a(d)}function a(d){return Ze(d)?d:d.get()}return{get:r,set:n,add:i,subtract:o}}function Ft(e,s){const r=e.scroll==="x"?o:a,n=s.style;let i=!1;function o(m){return`translate3d(${m}px,0px,0px)`}function a(m){return`translate3d(0px,${m}px,0px)`}function l(m){i||(n.transform=r(e.direction(m)))}function d(m){i=!m}function c(){i||(n.transform="",s.getAttribute("style")||s.removeAttribute("style"))}return{clear:c,to:l,toggleActive:d}}function Rn(e,s,r,n,i,o,a,l,d){const x=we(i),m=we(i).reverse(),f=h().concat(k());function y(S,j){return S.reduce((N,T)=>N-i[T],j)}function u(S,j){return S.reduce((N,T)=>y(N,j)>0?N.concat([T]):N,[])}function p(S){return o.map((j,N)=>({start:j-n[N]+.5+S,end:j+s-.5+S}))}function b(S,j,N){const T=p(j);return S.map(M=>{const z=N?0:-r,te=N?r:0,ee=N?"end":"start",se=T[M][ee];return{index:M,loopPoint:se,slideLocation:ve(-1),translate:Ft(e,d[M]),target:()=>l.get()>se?z:te}})}function h(){const S=a[0],j=u(m,S);return b(j,r,!1)}function k(){const S=s-a[0]-1,j=u(x,S);return b(j,-r,!0)}function v(){return f.every(({index:S})=>{const j=x.filter(N=>N!==S);return y(j,s)<=.1})}function L(){f.forEach(S=>{const{target:j,translate:N,slideLocation:T}=S,M=j();M!==T.get()&&(N.to(M),T.set(M))})}function E(){f.forEach(S=>S.translate.clear())}return{canLoop:v,clear:E,loop:L,loopPoints:f}}function $n(e,s,r){let n,i=!1;function o(d){if(!r)return;function c(x){for(const m of x)if(m.type==="childList"){d.reInit(),s.emit("slidesChanged");break}}n=new MutationObserver(x=>{i||(De(r)||r(d,x))&&c(x)}),n.observe(e,{childList:!0})}function a(){n&&n.disconnect(),i=!0}return{init:o,destroy:a}}function Fn(e,s,r,n){const i={};let o=null,a=null,l,d=!1;function c(){l=new IntersectionObserver(u=>{d||(u.forEach(p=>{const b=s.indexOf(p.target);i[b]=p}),o=null,a=null,r.emit("slidesInView"))},{root:e.parentElement,threshold:n}),s.forEach(u=>l.observe(u))}function x(){l&&l.disconnect(),d=!0}function m(u){return Ne(i).reduce((p,b)=>{const h=parseInt(b),{isIntersecting:k}=i[h];return(u&&k||!u&&!k)&&p.push(h),p},[])}function f(u=!0){if(u&&o)return o;if(!u&&a)return a;const p=m(u);return u&&(o=p),u||(a=p),p}return{init:c,destroy:x,get:f}}function zn(e,s,r,n,i,o){const{measureSize:a,startEdge:l,endEdge:d}=e,c=r[0]&&i,x=u(),m=p(),f=r.map(a),y=b();function u(){if(!c)return 0;const k=r[0];return B(s[l]-k[l])}function p(){if(!c)return 0;const k=o.getComputedStyle(ae(n));return parseFloat(k.getPropertyValue(`margin-${d}`))}function b(){return r.map((k,v,L)=>{const E=!v,C=et(L,v);return E?f[v]+x:C?f[v]+m:L[v+1][l]-k[l]}).map(B)}return{slideSizes:f,slideSizesWithGaps:y,startGap:x,endGap:m}}function qn(e,s,r,n,i,o,a,l,d){const{startEdge:c,endEdge:x,direction:m}=e,f=Ze(r);function y(h,k){return we(h).filter(v=>v%k===0).map(v=>h.slice(v,v+k))}function u(h){return h.length?we(h).reduce((k,v,L)=>{const E=ae(k)||0,C=E===0,S=v===Ce(h),j=i[c]-o[E][c],N=i[c]-o[v][x],T=!n&&C?m(a):0,M=!n&&S?m(l):0,z=B(N-M-(j+T));return L&&z>s+d&&k.push(v),S&&k.push(h.length),k},[]).map((k,v,L)=>{const E=Math.max(L[v-1]||0);return h.slice(E,k)}):[]}function p(h){return f?y(h,r):u(h)}return{groupSlides:p}}function Vn(e,s,r,n,i,o,a){const{align:l,axis:d,direction:c,startIndex:x,loop:m,duration:f,dragFree:y,dragThreshold:u,inViewThreshold:p,slidesToScroll:b,skipSnaps:h,containScroll:k,watchResize:v,watchSlides:L,watchDrag:E,watchFocus:C}=o,S=2,j=Nn(),N=j.measure(s),T=r.map(j.measure),M=vn(d,c),z=M.measureSize(N),te=Sn(z),ee=bn(l,z),se=!m&&!!k,le=m||!!k,{slideSizes:Q,slideSizesWithGaps:V,startGap:ne,endGap:ie}=zn(M,N,T,r,le,i),G=qn(M,z,b,m,N,T,ne,ie,S),{snaps:de,snapsAligned:ue}=Tn(M,ee,N,T,G),re=-ae(de)+ae(V),{snapsContained:ge,scrollContainLimit:xe}=Mn(z,re,ue,k,S),D=se?ge:ue,{limit:P}=Pn(re,D,m),H=$t(Ce(D),x,m),F=H.clone(),I=we(r),w=({dragHandler:fe,scrollBody:Ae,scrollBounds:_e,options:{loop:Ee}},Be)=>{Ee||_e.constrain(fe.pointerDown()),Ae.seek(Be)},_=({scrollBody:fe,translate:Ae,location:_e,offsetLocation:Ee,scrollLooper:Be,slideLooper:Qt,dragHandler:Yt,animation:Xt,eventHandler:nt,scrollBounds:Zt,options:{loop:rt}},ot)=>{const at=fe.settled(),Wt=!Zt.shouldConstrain(),it=rt?at:at&&Wt;it&&!Yt.pointerDown()&&(Xt.stop(),nt.emit("settle")),it||nt.emit("scroll");const es=_e.get()*ot+oe.get()*(1-ot);Ee.set(es),rt&&(Be.loop(fe.direction()),Qt.loop()),Ae.to(Ee.get())},A=kn(n,i,fe=>w(Te,fe),fe=>_(Te,fe)),K=.68,Z=D[H.get()],J=ve(Z),oe=ve(Z),Y=ve(Z),X=ve(Z),pe=Ln(J,Y,oe,X,f,K),be=_n(m,D,re,P,X),ke=Bn(A,H,F,pe,be,X,a),R=In(P),Le=Se(),Kt=Fn(s,r,a,p),{slideRegistry:st}=An(se,k,D,xe,G,I),Jt=On(e,r,st,ke,pe,Le,a,C),Te={ownerDocument:n,ownerWindow:i,eventHandler:a,containerRect:N,slideRects:T,animation:A,axis:M,dragHandler:jn(M,e,n,i,X,wn(M,i),J,A,ke,pe,be,H,a,te,y,u,h,K,E),eventStore:Le,percentOfView:te,index:H,indexPrevious:F,limit:P,location:J,offsetLocation:Y,previousLocation:oe,options:o,resizeHandler:Cn(s,a,i,r,M,v,j),scrollBody:pe,scrollBounds:En(P,Y,X,pe,te),scrollLooper:Dn(re,P,Y,[J,Y,oe,X]),scrollProgress:R,scrollSnapList:D.map(R.get),scrollSnaps:D,scrollTarget:be,scrollTo:ke,slideLooper:Rn(M,z,re,Q,V,de,D,Y,r),slideFocus:Jt,slidesHandler:$n(s,a,L),slidesInView:Kt,slideIndexes:I,slideRegistry:st,slidesToScroll:G,target:X,translate:Ft(M,s)};return Te}function Hn(){let e={},s;function r(c){s=c}function n(c){return e[c]||[]}function i(c){return n(c).forEach(x=>x(s,c)),d}function o(c,x){return e[c]=n(c).concat([x]),d}function a(c,x){return e[c]=n(c).filter(m=>m!==x),d}function l(){e={}}const d={init:r,emit:i,off:a,on:o,clear:l};return d}const Un={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Gn(e){function s(o,a){return Rt(o,a||{})}function r(o){const a=o.breakpoints||{},l=Ne(a).filter(d=>e.matchMedia(d).matches).map(d=>a[d]).reduce((d,c)=>s(d,c),{});return s(o,l)}function n(o){return o.map(a=>Ne(a.breakpoints||{})).reduce((a,l)=>a.concat(l),[]).map(e.matchMedia)}return{mergeOptions:s,optionsAtMedia:r,optionsMediaQueries:n}}function Kn(e){let s=[];function r(o,a){return s=a.filter(({options:l})=>e.optionsAtMedia(l).active!==!1),s.forEach(l=>l.init(o,e)),a.reduce((l,d)=>Object.assign(l,{[d.name]:d}),{})}function n(){s=s.filter(o=>o.destroy())}return{init:r,destroy:n}}function Me(e,s,r){const n=e.ownerDocument,i=n.defaultView,o=Gn(i),a=Kn(o),l=Se(),d=Hn(),{mergeOptions:c,optionsAtMedia:x,optionsMediaQueries:m}=o,{on:f,off:y,emit:u}=d,p=M;let b=!1,h,k=c(Un,Me.globalOptions),v=c(k),L=[],E,C,S;function j(){const{container:I,slides:w}=v;C=(Re(I)?e.querySelector(I):I)||e.children[0];const A=Re(w)?C.querySelectorAll(w):w;S=[].slice.call(A||C.children)}function N(I){const w=Vn(e,C,S,n,i,I,d);if(I.loop&&!w.slideLooper.canLoop()){const _=Object.assign({},I,{loop:!1});return N(_)}return w}function T(I,w){b||(k=c(k,I),v=x(k),L=w||L,j(),h=N(v),m([k,...L.map(({options:_})=>_)]).forEach(_=>l.add(_,"change",M)),v.active&&(h.translate.to(h.location.get()),h.animation.init(),h.slidesInView.init(),h.slideFocus.init(F),h.eventHandler.init(F),h.resizeHandler.init(F),h.slidesHandler.init(F),h.options.loop&&h.slideLooper.loop(),C.offsetParent&&S.length&&h.dragHandler.init(F),E=a.init(F,L)))}function M(I,w){const _=G();z(),T(c({startIndex:_},I),w),d.emit("reInit")}function z(){h.dragHandler.destroy(),h.eventStore.clear(),h.translate.clear(),h.slideLooper.clear(),h.resizeHandler.destroy(),h.slidesHandler.destroy(),h.slidesInView.destroy(),h.animation.destroy(),a.destroy(),l.clear()}function te(){b||(b=!0,l.clear(),z(),d.emit("destroy"),d.clear())}function ee(I,w,_){!v.active||b||(h.scrollBody.useBaseFriction().useDuration(w===!0?0:v.duration),h.scrollTo.index(I,_||0))}function se(I){const w=h.index.add(1).get();ee(w,I,-1)}function le(I){const w=h.index.add(-1).get();ee(w,I,1)}function Q(){return h.index.add(1).get()!==G()}function V(){return h.index.add(-1).get()!==G()}function ne(){return h.scrollSnapList}function ie(){return h.scrollProgress.get(h.location.get())}function G(){return h.index.get()}function de(){return h.indexPrevious.get()}function ue(){return h.slidesInView.get()}function re(){return h.slidesInView.get(!1)}function ge(){return E}function xe(){return h}function D(){return e}function P(){return C}function H(){return S}const F={canScrollNext:Q,canScrollPrev:V,containerNode:P,internalEngine:xe,destroy:te,off:y,on:f,emit:u,plugins:ge,previousScrollSnap:de,reInit:p,rootNode:D,scrollNext:se,scrollPrev:le,scrollProgress:ie,scrollSnapList:ne,scrollTo:ee,selectedScrollSnap:G,slideNodes:H,slidesInView:ue,slidesNotInView:re};return T(s,r),setTimeout(()=>d.emit("init"),0),F}Me.globalOptions=void 0;function tt(e={},s=[]){const r=g.useRef(e),n=g.useRef(s),[i,o]=g.useState(),[a,l]=g.useState(),d=g.useCallback(()=>{i&&i.reInit(r.current,n.current)},[i]);return g.useEffect(()=>{Xe(r.current,e)||(r.current=e,d())},[e,d]),g.useEffect(()=>{pn(n.current,s)||(n.current=s,d())},[s,d]),g.useEffect(()=>{if(xn()&&a){Me.globalOptions=tt.globalOptions;const c=Me(a,r.current,n.current);return o(c),()=>c.destroy()}else o(void 0)},[a,o]),[l,i]}tt.globalOptions=void 0;const zt=g.createContext(null);function Ie(){const e=g.useContext(zt);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}const qt=g.forwardRef(({orientation:e="horizontal",opts:s,setApi:r,plugins:n,className:i,children:o,...a},l)=>{const[d,c]=tt({...s,axis:e==="horizontal"?"x":"y"},n),[x,m]=g.useState(!1),[f,y]=g.useState(!1),u=g.useCallback(k=>{k&&(m(k.canScrollPrev()),y(k.canScrollNext()))},[]),p=g.useCallback(()=>{c==null||c.scrollPrev()},[c]),b=g.useCallback(()=>{c==null||c.scrollNext()},[c]),h=g.useCallback(k=>{k.key==="ArrowLeft"?(k.preventDefault(),p()):k.key==="ArrowRight"&&(k.preventDefault(),b())},[p,b]);return g.useEffect(()=>{!c||!r||r(c)},[c,r]),g.useEffect(()=>{if(c)return u(c),c.on("reInit",u),c.on("select",u),()=>{c==null||c.off("select",u)}},[c,u]),t.jsx(zt.Provider,{value:{carouselRef:d,api:c,opts:s,orientation:e||((s==null?void 0:s.axis)==="y"?"vertical":"horizontal"),scrollPrev:p,scrollNext:b,canScrollPrev:x,canScrollNext:f},children:t.jsx("div",{ref:l,onKeyDownCapture:h,className:ce("relative",i),role:"region","aria-roledescription":"carousel",...a,children:o})})});qt.displayName="Carousel";const Vt=g.forwardRef(({className:e,...s},r)=>{const{carouselRef:n,orientation:i}=Ie();return t.jsx("div",{ref:n,className:"overflow-hidden",children:t.jsx("div",{ref:r,className:ce("flex",i==="horizontal"?"-ml-4":"-mt-4 flex-col",e),...s})})});Vt.displayName="CarouselContent";const Ht=g.forwardRef(({className:e,...s},r)=>{const{orientation:n}=Ie();return t.jsx("div",{ref:r,role:"group","aria-roledescription":"slide",className:ce("min-w-0 shrink-0 grow-0 basis-full",n==="horizontal"?"pl-4":"pt-4",e),...s})});Ht.displayName="CarouselItem";const Ut=g.forwardRef(({className:e,variant:s="outline",size:r="icon",...n},i)=>{const{orientation:o,scrollPrev:a,canScrollPrev:l}=Ie();return t.jsxs(U,{ref:i,variant:s,size:r,className:ce("absolute  h-8 w-8 rounded-full",o==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!l,onClick:a,...n,children:[t.jsx(us,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Previous slide"})]})});Ut.displayName="CarouselPrevious";const Gt=g.forwardRef(({className:e,variant:s="outline",size:r="icon",...n},i)=>{const{orientation:o,scrollNext:a,canScrollNext:l}=Ie();return t.jsxs(U,{ref:i,variant:s,size:r,className:ce("absolute h-8 w-8 rounded-full",o==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!l,onClick:a,...n,children:[t.jsx(As,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Next slide"})]})});Gt.displayName="CarouselNext";const Jn=({carId:e,mainImageUrl:s})=>{const{data:r,isLoading:n}=Fe({queryKey:["car-images",e],queryFn:async()=>{console.log("Fetching images for car:",e);const{data:i,error:o}=await $.from("car_images").select("*").eq("car_id",e);if(o)throw console.error("Error fetching car images:",o),o;const a=s?[{id:"main",image_url:s},...i||[]]:i||[];return console.log("Retrieved images:",a),a}});return n?t.jsx(me,{className:"w-full h-64 rounded-lg"}):r!=null&&r.length?t.jsxs(qt,{className:"w-full",children:[t.jsx(Vt,{children:r.map(i=>t.jsx(Ht,{children:t.jsx("img",{src:i.image_url,alt:"Car",className:"w-full h-64 object-cover rounded-lg"})},i.id))}),t.jsx(Ut,{className:"left-2"}),t.jsx(Gt,{className:"right-2"})]}):t.jsx("div",{className:"w-full h-64 bg-muted rounded-lg flex items-center justify-center",children:t.jsx("p",{className:"text-muted-foreground",children:"No images available"})})},Qn=({car:e})=>{console.log("🚀 [CarReviews] COMPONENT FUNCTION CALLED!"),console.log("🚀 [CarReviews] Car prop received:",e),console.log("🚀 [CarReviews] Car ID:",e==null?void 0:e.id),console.log("🚀 [CarReviews] Car type:",typeof e);const[s,r]=g.useState(!1),[n,i]=g.useState(0),[o,a]=g.useState("");Ct(),console.log("🔍 [CarReviews] Component mounted with car:",e),console.log("🔍 [CarReviews] Car ID:",e==null?void 0:e.id),console.log("🔍 [CarReviews] Car object keys:",Object.keys(e||{}));const{data:l,isLoading:d}=Fe({queryKey:["car-reviews",e.id],queryFn:async()=>{console.log("🔍 [CarReviews] Fetching reviews for car:",e.id),console.log("🔍 [CarReviews] Query function called");const{data:c,error:x}=await $.from("reviews").select(`
          *,
          reviewer:profiles!reviewer_id (
            full_name,
            avatar_url
          )
        `).eq("car_id",e.id).eq("review_type","car").order("created_at",{ascending:!1});if(x)throw console.error("Error fetching reviews:",x),x;return console.log("🔍 [CarReviews] Retrieved reviews:",c),c}});return console.log("🔍 [CarReviews] Query state - isLoading:",d,"reviews:",l),t.jsxs(Ke,{className:"dark:bg-gray-800 dark:border-gray-700",children:[t.jsx(Je,{className:"pb-2",children:t.jsxs(Qe,{className:"text-lg flex items-center justify-between dark:text-white",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"text-base text-left text-muted-foreground dark:text-white font-medium",children:"Reviews"})}),t.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:[(l==null?void 0:l.length)||0," ",(l==null?void 0:l.length)===1?"review":"reviews"]})]})}),t.jsx(Ye,{children:t.jsxs("div",{className:"space-y-4",children:[(l==null?void 0:l.length)===0&&t.jsx("div",{className:"text-center py-6",children:t.jsx("span",{className:"text-xs md:text-sm text-muted-foreground",children:"No reviews yet"})}),l==null?void 0:l.map(c=>t.jsxs("div",{className:"border rounded-lg p-4 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:c.reviewer.avatar_url?$.storage.from("avatars").getPublicUrl(c.reviewer.avatar_url).data.publicUrl:"/placeholder.svg",alt:c.reviewer.full_name,className:"w-8 h-8 rounded-full object-cover"}),t.jsx("span",{className:"font-medium",children:c.reviewer.full_name})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex gap-0.5 mr-2",children:Array.from({length:c.rating}).map((x,m)=>t.jsx(_s,{className:"h-4 w-4 text-yellow-500",fill:"currentColor"},m))}),t.jsx("span",{className:"text-xs text-muted-foreground",children:c.created_at?W(new Date(c.created_at),"MMM d, yyyy"):""})]})]}),c.comment&&t.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:c.comment})]},c.id))]})})]})},Yn=({latitude:e,longitude:s,location:r,mapStyle:n="mapbox://styles/mapbox/streets-v12"})=>{const i=g.useRef(null),o=g.useRef(null),a=g.useRef(null),l=g.useRef(!1),[d,c]=g.useState(null),[x,m]=g.useState(!0),f="mapbox://styles/mapbox/light-v11";return g.useEffect(()=>{(async()=>{try{const u=await St();if(!u){O.error("Failed to get the map token");return}c(u),m(!1)}catch(u){console.error("Error getting Mapbox token:",u),O.error("Failed to load map configuration")}})()},[]),g.useEffect(()=>{if(x||!i.current)return;const y=i.current;if(y.offsetWidth===0||y.offsetHeight===0){console.error("Map container has zero width or height");return}if(console.log("Initializing map with coordinates:",{longitude:s,latitude:e}),d)he.accessToken=d;else{console.error("No Mapbox token available");return}try{o.current=new he.Map({container:i.current,style:n||f,center:[s,e],zoom:13,interactive:!1}),o.current.on("load",()=>{console.log("Map loaded successfully"),a.current=new he.Marker({color:"#7C3AED"}).setLngLat([s,e]).addTo(o.current),l.current=!0}),o.current.on("style.load",()=>{console.log("Map style loaded successfully")}),o.current.on("error",u=>{var p;console.error("Map error:",u),O.error("Error loading location map"),u.error&&u.error.message.includes("style")&&n!==f&&(console.log("Attempting to load fallback style"),(p=o.current)==null||p.setStyle(f))})}catch(u){console.error("Error initializing map:",u),O.error("Could not initialize location map")}return()=>{o.current&&(o.current.remove(),o.current=null,a.current=null,l.current=!1)}},[e,s,d,n,x]),g.useEffect(()=>{o.current&&l.current&&a.current&&(o.current.setCenter([s,e]),a.current.setLngLat([s,e]))},[e,s]),g.useEffect(()=>{o.current&&l.current&&o.current.setStyle(n||f)},[n]),t.jsxs(Ke,{className:"dark:bg-gray-800 dark:border-gray-700",children:[t.jsx(Je,{className:"pb-2",children:t.jsx(Qe,{className:"text-base text-left text-muted-foreground dark:text-white font-medium",children:"Location"})}),t.jsxs(Ye,{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Ge,{size:16,className:"text-red-500 "}),t.jsx("p",{className:"text-xs md:text-sm text-left text-muted-foreground dark:text-gray-300",children:r})]}),t.jsx("div",{ref:i,className:"w-full h-40 rounded-md overflow-hidden border border-muted dark:border-gray-700"})]})]})},Xn=e=>({...e,description:e.description??"No description available",features:e.features??[],image_url:e.image_url??"/placeholder-car.jpg",latitude:e.latitude??0,longitude:e.longitude??0,is_available:e.is_available??!0}),Mr=()=>{var l,d;const{carId:e}=Lt(),{theme:s}=fs(),r=Bs.useUser();console.log("=== CarDetails component rendered ==="),console.log("Current URL:",window.location.href),console.log("carId from useParams:",e),console.log("user:",(r==null?void 0:r.id)||"not logged in");const{data:n,isLoading:i,error:o}=Fe({queryKey:["car",e],queryFn:async()=>{const{data:c,error:x}=await $.from("cars").select("*, profiles:owner_id (full_name, avatar_url)").eq("id",e).maybeSingle();if(x)throw x;if(!c)throw new Error("Car not found");return Xn(c)}});if(i)return t.jsxs("div",{className:"min-h-screen bg-background dark:bg-gray-900",children:[t.jsxs("div",{className:"container mx-auto",children:[t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[200px] w-full p-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground dark:text-gray-400 mb-3",children:"Loading vehicle details..."}),t.jsx(ms,{color:"#7c3aed",width:100})]}),t.jsxs("div",{className:"space-y-4 p-4 mt-4",children:[t.jsx(me,{className:"h-64 w-full bg-gray-200 dark:bg-gray-700"}),t.jsx(me,{className:"h-8 w-3/4 bg-gray-200 dark:bg-gray-700"}),t.jsx(me,{className:"h-4 w-1/2 bg-gray-200 dark:bg-gray-700"}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsx(me,{className:"h-20 bg-gray-200 dark:bg-gray-700"}),t.jsx(me,{className:"h-20 bg-gray-200 dark:bg-gray-700"}),t.jsx(me,{className:"h-20 bg-gray-200 dark:bg-gray-700"})]})]})]}),t.jsx(Oe,{})]});if(o||!n)return t.jsxs("div",{className:"min-h-screen bg-background dark:bg-gray-900",children:[t.jsx("div",{className:"container mx-auto",children:t.jsxs("div",{className:"p-4 text-center space-y-4",children:[t.jsx(hs,{className:"h-12 w-12 text-red-500 mx-auto"}),t.jsx("h2",{className:"text-xl font-semibold text-red-500",children:"Error loading vehicle details"}),t.jsx("p",{className:"text-muted-foreground dark:text-gray-400",children:"Please try again later"})]})}),t.jsx(Oe,{})]});const a=((l=n.profiles)==null?void 0:l.avatar_url)||null;return t.jsxs("div",{className:"min-h-screen bg-background dark:bg-gray-900 pb-20",children:[t.jsx("div",{className:"container mx-auto",children:t.jsxs("div",{className:"space-y-4 p-4",children:[t.jsx(Jn,{carId:n.id,mainImageUrl:n.image_url}),t.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[t.jsx(fn,{brand:n.brand,model:n.model,year:n.year,location:n.location,pricePerDay:n.price_per_day,ownerId:n.owner_id}),t.jsx(hn,{pricePerDay:n.price_per_day,transmission:n.transmission,seats:n.seats,features:n.features}),n.description&&t.jsx(ws,{description:n.description}),t.jsx(Yn,{latitude:n.latitude,longitude:n.longitude,location:n.location,mapStyle:s==="dark"?"mapbox://styles/mapbox/dark-v11":"mapbox://styles/mapbox/light-v11"}),t.jsx(Ns,{ownerName:((d=n.profiles)==null?void 0:d.full_name)||"Car Owner",avatarUrl:a,ownerId:n.owner_id}),console.log("[CarDetails] About to render CarReviews with car:",n),console.log("Car object keys:",n?Object.keys(n):"car is null/undefined"),t.jsx(Qn,{car:n})]}),t.jsx(un,{car:n})]})}),t.jsx(Oe,{})]})};export{Mr as default};

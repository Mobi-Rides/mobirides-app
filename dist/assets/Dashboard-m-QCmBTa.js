import{c as Q,z as Y,j as e,B as _,k as v,b as D,n as N,s as u,aA as F,aB as E,aC as j,aD as w,x as G,M as J,y as O,r as A}from"./index-B1v-fdDy.js";import{C as $,N as M}from"./Navigation-B7IoAuwX.js";import{M as X,S as Z}from"./sun-CIFifgdT.js";import{A as ee}from"./arrow-left-C5bMyyle.js";import{S as h}from"./skeleton-B5zSXtNC.js";import{C as se}from"./car-ggFPcI9D.js";import{C as L}from"./circle-check-big-BC5npB6H.js";import{C as S}from"./clock-CASyaKu3.js";import{C as H,a as z,b as U,d as W}from"./card-BByP0N-G.js";import{u as q,W as te}from"./WalletBalanceIndicator-Cudt4P0R.js";import{M as ae}from"./user-ClMVbWgE.js";import{F as K}from"./file-text-25BybcTk.js";import{f as k}from"./format-BOBWS5Wu.js";import{C as re}from"./circle-alert-B4G_r9SV.js";import{w as le}from"./TopUpModal-CVHIYnlR.js";import"./badge-CMWgFMV2.js";import"./wallet-BkmUqWq1.js";import"./plus-CDk_XeRs.js";import"./info-BxQ4NhRw.js";import"./select-DXEtncUe.js";import"./index-BdQq_4o_.js";import"./check-BnE2eJB3.js";import"./credit-card-1cqTaL7m.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=Q("CarFront",[["path",{d:"m21 8-2 2-1.5-3.7A2 2 0 0 0 15.646 5H8.4a2 2 0 0 0-1.903 1.257L5 10 3 8",key:"1imjwt"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 14h.01",key:"7oqj8z"}],["rect",{width:"18",height:"8",x:"3",y:"10",rx:"2",key:"a7itu8"}],["path",{d:"M5 18v2",key:"ppbyun"}],["path",{d:"M19 18v2",key:"gy7782"}]]);function ce(){const{theme:s,toggleTheme:a}=Y();return e.jsx(_,{variant:"ghost",size:"icon",onClick:a,"aria-label":"Toggle theme",className:"rounded-full",children:s==="light"?e.jsx(X,{className:"h-5 w-5"}):e.jsx(Z,{className:"h-5 w-5"})})}const de=()=>{const s=v();return e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"py-2 flex items-center gap-4",children:[e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>s(-1),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-foreground",children:"Dashboard"})]}),e.jsx(ce,{})]})},f=({title:s,value:a,icon:d,description:r,className:n,iconClassName:i})=>e.jsxs("div",{className:D("rounded-lg border bg-card p-4 shadow-sm dark:bg-card dark:border-border",n),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-sm text-muted-foreground",children:s}),e.jsx("div",{className:D("rounded-full p-2",i||"bg-primary/10"),children:e.jsx(d,{className:D("h-4 w-4",i?"text-white":"text-primary")})})]}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:a}),r&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r})]}),ie=()=>{const{data:s,isLoading:a}=N({queryKey:["renter-stats"],queryFn:async()=>{const{data:{user:d}}=await u.auth.getUser();if(!d)throw new Error("No user found");const{data:r,error:n}=await u.from("bookings").select("status, start_date, end_date").eq("renter_id",d.id);if(n)throw n;const i=new Date;i.setHours(0,0,0,0);const m=r.length,l=r.filter(p=>p.status==="confirmed"&&new Date(p.start_date)<=i&&new Date(p.end_date)>=i).length,t=r.filter(p=>p.status==="completed").length,o=r.filter(p=>p.status==="cancelled").length,x=r.filter(p=>p.status==="pending").length;return{total:m,active:l,completed:t,cancelled:o,pending:x}}});return a?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((d,r)=>e.jsx(h,{className:"h-24 w-full"},r))}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(f,{title:"Total Bookings",value:(s==null?void 0:s.total)||0,icon:se}),e.jsx(f,{title:"Active Trips",value:(s==null?void 0:s.active)||0,icon:$,iconClassName:"bg-blue-500"}),e.jsx(f,{title:"Completed Trips",value:(s==null?void 0:s.completed)||0,icon:L,iconClassName:"bg-green-500"}),e.jsx(f,{title:"Pending Bookings",value:(s==null?void 0:s.pending)||0,icon:S,iconClassName:"bg-amber-500"})]})},R=({bookings:s,tabType:a,emptyMessage:d,onCardClick:r})=>{const n=v(),i=q();if(!(s!=null&&s.length))return e.jsx("p",{className:"text-muted-foreground text-center py-4",children:d});const m=t=>{switch(t){case"confirmed":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"completed":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400"}},l=t=>{switch(t){case"active":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"upcoming":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400";case"past":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400"}};return e.jsx("div",{className:"grid gap-4",children:s.map(t=>e.jsx(H,{className:"cursor-pointer hover:shadow-md transition-shadow dark:bg-card dark:border-border overflow-hidden",onClick:()=>r(t.id),children:e.jsxs("div",{className:"grid grid-cols-[100px_1fr] xs:grid-cols-[120px_1fr] sm:grid-cols-[180px_1fr]",children:[e.jsx("div",{className:"h-full max-h-[100px] xs:max-h-[120px] sm:max-h-none",children:e.jsx("img",{src:t.cars.image_url,alt:`${t.cars.brand} ${t.cars.model}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(z,{className:"pb-1 sm:pb-2 p-2 sm:p-4",children:e.jsxs(U,{className:"text-sm sm:text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"truncate pr-2",children:[t.cars.brand," ",t.cars.model]}),e.jsx("span",{className:`text-xs font-normal px-2 py-1 rounded-full ${a==="active"?l("active"):m(t.status)}`,children:a==="active"?"Active":t.status})]})}),e.jsx(W,{className:"p-2 sm:p-4 pt-0",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-red-500 flex items-center gap-1",children:[e.jsx(ae,{size:16})," ",e.jsx("span",{className:"text-foreground",children:t.cars.location})]}),e.jsxs("p",{className:"text-xs sm:text-sm font-medium text-primary",children:["BWP ",t.total_price]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 sm:gap-2 pt-0 sm:pt-1",children:[e.jsxs("div",{className:"bg-muted/50 rounded-md p-1 sm:p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Pickup"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:k(new Date(t.start_date),"PP")})]}),e.jsxs("div",{className:"bg-muted/50 rounded-md p-1 sm:p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Return"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:k(new Date(t.end_date),"PP")})]})]}),a==="past"&&t.status==="completed"&&e.jsx("div",{className:"flex justify-end pt-1",children:e.jsxs(_,{variant:"outline",size:i?"sm":"default",className:"text-xs sm:text-sm h-7 sm:h-9",onClick:o=>{o.stopPropagation(),n(`/rental-details/${t.id}?print=true`)},children:[e.jsx(K,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Receipt"})]})})]})})]})]})},t.id))})},oe=()=>{const s=v();q();const{data:a,isLoading:d}=N({queryKey:["renter-bookings"],queryFn:async()=>{const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("No user found");console.log("Fetching renter bookings");const{data:o,error:x}=await u.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            location,
            image_url,
            owner_id,
            price_per_day
          ),
          reviews!reviews_booking_id_fkey (
            id
          )
        `).eq("renter_id",t.id).order("start_date",{ascending:!0});if(x)throw x;return console.log("Renter bookings:",o),o}});if(d)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((t,o)=>e.jsx(h,{className:"h-24 w-full"},o))}),e.jsx(h,{className:"h-32 w-full"}),e.jsx(h,{className:"h-32 w-full"})]});const r=new Date,n=a==null?void 0:a.filter(t=>{const o=new Date(t.end_date),x=t.reviews&&t.reviews.length>0;return t.status==="confirmed"&&new Date(t.start_date)<=r&&(o>=r||!x)}),i=a==null?void 0:a.filter(t=>(t.status==="pending"||t.status==="confirmed")&&new Date(t.start_date)>r),m=a==null?void 0:a.filter(t=>{const o=new Date(t.end_date),x=t.reviews&&t.reviews.length>0;return t.status==="completed"||t.status==="cancelled"||o<r&&x}),l=t=>{s(`/rental-details/${t}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{}),e.jsxs(F,{defaultValue:"active",className:"bg-card rounded-lg p-3 sm:p-4 shadow-sm dark:border dark:border-border",children:[e.jsxs(E,{className:"mb-4 w-full justify-start overflow-x-auto scrollbar-none",children:[e.jsx(j,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"active",children:"Active Rentals"}),e.jsx(j,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"upcoming",children:"Upcoming"}),e.jsx(j,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"past",children:"Past Rentals"})]}),e.jsx(w,{value:"active",children:e.jsx(R,{bookings:n,tabType:"active",emptyMessage:"No active rentals",onCardClick:l})}),e.jsx(w,{value:"upcoming",children:e.jsx(R,{bookings:i,tabType:"upcoming",emptyMessage:"No upcoming rentals",onCardClick:l})}),e.jsx(w,{value:"past",children:e.jsx(R,{bookings:m,tabType:"past",emptyMessage:"No past rentals",onCardClick:l})})]})]})},me=()=>{const{data:s,isLoading:a}=N({queryKey:["host-stats"],queryFn:async()=>{const{data:{user:d}}=await u.auth.getUser();if(!d)throw new Error("No user found");const{data:r,error:n}=await u.from("cars").select("id").eq("owner_id",d.id);if(n)throw n;if(!r.length)return{total:0,confirmed:0,completed:0,cancelled:0,pending:0};const i=r.map(g=>g.id),{data:m,error:l}=await u.from("bookings").select("status").in("car_id",i);if(l)throw l;const t=m.length,o=m.filter(g=>g.status==="confirmed").length,x=m.filter(g=>g.status==="pending").length,p=m.filter(g=>g.status==="completed").length,y=m.filter(g=>g.status==="cancelled").length;return{total:t,confirmed:o,completed:p,cancelled:y,pending:x}}});return a?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((d,r)=>e.jsx(h,{className:"h-24 w-full"},r))}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(f,{title:"Total Bookings",value:(s==null?void 0:s.total)||0,icon:ne}),e.jsx(f,{title:"Active Rentals",value:(s==null?void 0:s.confirmed)||0,icon:$,iconClassName:"bg-blue-500"}),e.jsx(f,{title:"Completed",value:(s==null?void 0:s.completed)||0,icon:L,iconClassName:"bg-green-500"}),e.jsx(f,{title:"Pending Requests",value:(s==null?void 0:s.pending)||0,icon:S,iconClassName:"bg-amber-500"})]})},C=({bookings:s,tabType:a,emptyMessage:d,onCardClick:r})=>{const n=v(),i=q();if(!(s!=null&&s.length))return e.jsx("p",{className:"text-muted-foreground text-center py-4",children:d});const m=l=>{switch(l){case"active":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"expired":return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400";case"completed":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400"}};return e.jsx("div",{className:"grid gap-4",children:s.map(l=>{var t;return e.jsx(H,{className:"cursor-pointer hover:shadow-md transition-shadow dark:bg-card dark:border-border overflow-hidden",onClick:()=>r(l.id),children:e.jsxs("div",{className:"grid grid-cols-[100px_1fr] xs:grid-cols-[120px_1fr] sm:grid-cols-[180px_1fr]",children:[e.jsx("div",{className:"h-full max-h-[100px] xs:max-h-[120px] sm:max-h-none",children:e.jsx("img",{src:l.cars.image_url,alt:`${l.cars.brand} ${l.cars.model}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(z,{className:"pb-1 sm:pb-2 p-2 sm:p-4",children:e.jsxs(U,{className:"text-sm sm:text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"truncate pr-2",children:[l.cars.brand," ",l.cars.model]}),e.jsxs("span",{className:`text-xs font-normal px-2 py-1 rounded-full ${m(a)}`,children:[a==="active"&&"Active",a==="pending"&&"Pending",a==="expired"&&"Expired",a==="completed"&&"Completed"]})]})}),e.jsx(W,{className:"p-2 sm:p-4 pt-0",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Rented by: ",e.jsx("span",{className:"text-foreground",children:((t=l.renter)==null?void 0:t.full_name)||"Unknown"})]}),e.jsxs("p",{className:"text-xs sm:text-sm font-medium text-primary",children:["BWP ",l.total_price]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 sm:gap-2 pt-0 sm:pt-1",children:[e.jsxs("div",{className:"bg-muted/50 rounded-md p-1 sm:p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"From"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:k(new Date(l.start_date),"PP")})]}),e.jsxs("div",{className:"bg-muted/50 rounded-md p-1 sm:p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"To"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:k(new Date(l.end_date),"PP")})]})]}),a==="expired"&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mt-2",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Request expired without response"})]}),a==="completed"&&l.status==="completed"&&e.jsx("div",{className:"flex justify-end pt-1",children:e.jsxs(_,{variant:"outline",size:i?"sm":"default",className:"text-xs sm:text-sm h-7 sm:h-9",onClick:o=>{o.stopPropagation(),n(`/rental-details/${l.id}?print=true`)},children:[e.jsx(K,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Receipt"})]})})]})})]})]})},l.id)})})},xe=()=>{const s=v();q();const{data:a,isLoading:d}=N({queryKey:["host-bookings"],queryFn:async()=>{const{data:{user:c}}=await u.auth.getUser();if(!c)throw new Error("No user found");console.log("Fetching host bookings");const{data:b,error:T}=await u.from("cars").select("id").eq("owner_id",c.id);if(T)throw T;if(!b.length)return[];const I=b.map(V=>V.id),{data:B,error:P}=await u.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            location,
            image_url,
            owner_id,
            price_per_day
          ),
          renter:profiles!renter_id (
            full_name
          )
        `).in("car_id",I).order("created_at",{ascending:!1});if(P)throw P;return console.log("Host bookings:",B),B}}),{data:r}=N({queryKey:["current-user"],queryFn:async()=>{const{data:{user:c}}=await u.auth.getUser();return c}}),{data:n}=N({queryKey:["wallet-balance",r==null?void 0:r.id],queryFn:async()=>r!=null&&r.id?await le.getWalletBalance(r.id):null,enabled:!!(r!=null&&r.id)});if(d)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[...Array(5)].map((c,b)=>e.jsx(h,{className:"h-24 w-full"},b))}),e.jsx(h,{className:"h-32 w-full"})]});const i=new Date,m=a==null?void 0:a.filter(c=>c.status==="confirmed"&&new Date(c.start_date)<=i&&new Date(c.end_date)>=i),l=a==null?void 0:a.filter(c=>c.status==="pending"),t=a==null?void 0:a.filter(c=>c.status==="expired"),o=a==null?void 0:a.filter(c=>c.status==="completed"||c.status==="confirmed"&&new Date(c.end_date)<i),x=c=>{s(`/rental-details/${c}`)},p=c=>{s(`/booking-requests/${c}`)},y=(n==null?void 0:n.balance)||0,g=y<50;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(me,{}),g&&e.jsxs(G,{variant:"destructive",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs(O,{children:["Low wallet balance (P",y.toFixed(2),"). You may not be able to accept new booking requests.",e.jsx("span",{className:"underline cursor-pointer ml-1",onClick:()=>s("/wallet"),children:"Top up your wallet"})]})]}),e.jsx("div",{className:"bg-card rounded-lg p-4 shadow-sm dark:border dark:border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Wallet Balance"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Available for booking commissions"})]}),e.jsx(te,{compact:!0})]})}),e.jsxs(F,{defaultValue:"active",className:"bg-card rounded-lg p-3 sm:p-4 shadow-sm dark:border dark:border-border",children:[e.jsxs(E,{className:"mb-4 w-full justify-start overflow-x-auto scrollbar-none",children:[e.jsx(j,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"active",children:"Active Rentals"}),e.jsx(j,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"pending",children:"Booking Requests"}),e.jsx(j,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"expired",children:"Expired Requests"}),e.jsx(j,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"completed",children:"Past Rentals"})]}),e.jsx(w,{value:"active",children:e.jsx(C,{bookings:m,tabType:"active",emptyMessage:"No active rentals",onCardClick:x})}),e.jsx(w,{value:"pending",children:e.jsx(C,{bookings:l,tabType:"pending",emptyMessage:"No booking requests",onCardClick:p})}),e.jsx(w,{value:"expired",children:e.jsx(C,{bookings:t,tabType:"expired",emptyMessage:"No expired requests",onCardClick:x})}),e.jsx(w,{value:"completed",children:e.jsx(C,{bookings:o,tabType:"completed",emptyMessage:"No completed rentals",onCardClick:x})})]})]})},Ee=()=>{const[s,a]=A.useState(null);return A.useEffect(()=>{(async()=>{const{data:{user:r}}=await u.auth.getUser();if(!r)return;console.log("Fetching user role for dashboard");const{data:n}=await u.from("profiles").select("role").eq("id",r.id).single();n!=null&&n.role&&(console.log("User role:",n.role),a(n.role))})()},[]),s?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 py-3 sm:py-4 pb-20",children:[e.jsx(de,{}),e.jsx("div",{className:"mt-2",children:s==="renter"?e.jsx(oe,{}):e.jsx(xe,{})}),e.jsx(M,{})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(h,{className:"h-8 w-48 mb-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((d,r)=>e.jsx(h,{className:"h-24 w-full"},r))}),e.jsx(h,{className:"h-32 w-full"}),e.jsx(h,{className:"h-32 w-full"})]})]}),e.jsx(M,{})]})};export{Ee as default};

import{c as V,r as i,al as ve,j as r,b as X,I as ye,B as E,X as ke,s as v,am as be,J as p,L as Ne,q as oe,t as ne,v as ie,w as ce,F as le,a1 as we,E as je,k as De,x as K,an as Q,y as ee}from"./index-B1v-fdDy.js";import{C as Se}from"./calendar-Blx7UGIQ.js";import{m as de,a as ue,s as Ce,f as S}from"./format-BOBWS5Wu.js";import{u as Te}from"./useVerificationStatus-BsTQxagy.js";import{V as Ee}from"./VerificationRequiredDialog-BhXpjI7V.js";import{S as fe}from"./scroll-area-DG1WSctR.js";import{C as _e}from"./CustomMapbox-B-n_RDKf.js";import{S as Le}from"./skeleton-B5zSXtNC.js";import{S as Pe}from"./Navigation-B7IoAuwX.js";import{M as me}from"./user-ClMVbWgE.js";import{S as te}from"./star-C2MEvl-w.js";import{C as Me}from"./clock-CASyaKu3.js";import{C as Be}from"./circle-alert-B4G_r9SV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=V("CalendarX",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m14 14-4 4",key:"rymu2i"}],["path",{d:"m10 14 4 4",key:"3sz06r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=V("CircleGauge",[["path",{d:"M15.6 2.7a10 10 0 1 0 5.7 5.7",key:"1e0p6d"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M13.4 10.6 19 5",key:"1kr7tw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=V("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=V("Locate",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]]);function re(e,t){const s=$e(e);let n;if(s.date){const l=qe(s.date,2);n=ze(l.restDateString,l.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const o=n.getTime();let f=0,u;if(s.time&&(f=Ae(s.time),isNaN(f)))return new Date(NaN);if(s.timezone){if(u=Ye(s.timezone),isNaN(u))return new Date(NaN)}else{const l=new Date(o+f),h=new Date(0);return h.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),h.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),h}return new Date(o+f+u)}const Y={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Re=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Ue=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Oe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function $e(e){const t={},a=e.split(Y.dateTimeDelimiter);let s;if(a.length>2)return t;if(/:/.test(a[0])?s=a[0]:(t.date=a[0],s=a[1],Y.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Y.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){const n=Y.timezone.exec(s);n?(t.time=s.replace(n[1],""),t.timezone=n[1]):t.time=s}return t}function qe(e,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(a);if(!s)return{year:NaN,restDateString:""};const n=s[1]?parseInt(s[1]):null,o=s[2]?parseInt(s[2]):null;return{year:o===null?n:o*100,restDateString:e.slice((s[1]||s[2]).length)}}function ze(e,t){if(t===null)return new Date(NaN);const a=e.match(Re);if(!a)return new Date(NaN);const s=!!a[4],n=A(a[1]),o=A(a[2])-1,f=A(a[3]),u=A(a[4]),l=A(a[5])-1;if(s)return We(t,u,l)?Ve(t,u,l):new Date(NaN);{const h=new Date(0);return!Ze(t,o,f)||!Je(t,n)?new Date(NaN):(h.setUTCFullYear(t,o,Math.max(n,f)),h)}}function A(e){return e?parseInt(e):1}function Ae(e){const t=e.match(Ue);if(!t)return NaN;const a=W(t[1]),s=W(t[2]),n=W(t[3]);return Ge(a,s,n)?a*de+s*ue+n*1e3:NaN}function W(e){return e&&parseFloat(e.replace(",","."))||0}function Ye(e){if(e==="Z")return 0;const t=e.match(Oe);if(!t)return 0;const a=t[1]==="+"?-1:1,s=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;return Xe(s,n)?a*(s*de+n*ue):NaN}function Ve(e,t,a){const s=new Date(0);s.setUTCFullYear(e,0,4);const n=s.getUTCDay()||7,o=(t-1)*7+a+1-n;return s.setUTCDate(s.getUTCDate()+o),s}const He=[31,null,31,30,31,30,31,31,30,31,30,31];function he(e){return e%400===0||e%4===0&&e%100!==0}function Ze(e,t,a){return t>=0&&t<=11&&a>=1&&a<=(He[t]||(he(e)?29:28))}function Je(e,t){return t>=1&&t<=(he(e)?366:365)}function We(e,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function Ge(e,t,a){return e===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&e>=0&&e<25}function Xe(e,t){return t>=0&&t<=59}const Ke=({placeholder:e="Search for a location...",onLocationSelect:t,onLocationChange:a,className:s,showRecentSearches:n=!0,showFavorites:o=!0,value:f,disabled:u=!1})=>{const[l,h]=i.useState(f||""),[O,k]=i.useState(!1),[C,I]=i.useState(null),M=i.useRef(null),j=i.useRef(null),{searchResults:_,recentSearches:L,favorites:D,isLoading:F,error:m,search:d,selectLocation:b,addToFavorites:H,removeFromFavorites:$}=ve(),P=c=>{const N=c.target.value;h(N),C&&clearTimeout(C);const q=setTimeout(()=>{N.trim()?(d(N),k(!0)):k(!1)},300);I(q)},w=c=>{h(c.name),k(!1),b(c),t(c),a==null||a(c.coordinates,c.full_address)},Z=()=>{(l.trim()||n&&L.length>0)&&k(!0)};i.useEffect(()=>{const c=N=>{j.current&&!j.current.contains(N.target)&&k(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]),i.useEffect(()=>()=>{C&&clearTimeout(C)},[C]);const R=()=>{var c;h(""),k(!1),(c=M.current)==null||c.focus()};return r.jsxs("div",{ref:j,className:X("relative w-full",s),children:[r.jsxs("div",{className:"relative",children:[r.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),r.jsx(ye,{ref:M,type:"text",placeholder:e,value:l,onChange:P,onFocus:Z,disabled:u,className:"pl-10 pr-8"}),l&&r.jsx(E,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",onClick:R,children:r.jsx(ke,{className:"h-3 w-3"})})]}),O&&r.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border border-border rounded-md shadow-lg max-h-80",children:r.jsxs(fe,{className:"max-h-80",children:[m&&r.jsx("div",{className:"p-3 text-sm text-destructive border-b",children:m}),F&&r.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"Searching..."}),_.suggestions.length>0&&r.jsxs("div",{className:"border-b",children:[r.jsx("div",{className:"p-2 text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Search Results"}),_.suggestions.map(c=>r.jsxs("button",{onClick:()=>w(c),className:"w-full px-3 py-2 text-left hover:bg-accent hover:text-accent-foreground flex items-center gap-2",children:[r.jsx(me,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"text-sm font-medium truncate",children:c.name}),r.jsx("div",{className:"text-xs text-muted-foreground truncate",children:c.full_address})]}),r.jsx(E,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 flex-shrink-0",onClick:N=>{N.stopPropagation(),D.some(q=>q.id===c.id)?$(c.id):H(c)},children:r.jsx(te,{className:X("h-3 w-3",D.some(N=>N.id===c.id)?"fill-yellow-400 text-yellow-400":"text-muted-foreground")})})]},c.id))]}),n&&L.length>0&&!l.trim()&&r.jsxs("div",{className:"border-b",children:[r.jsx("div",{className:"p-2 text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Recent Searches"}),L.slice(0,3).map(c=>r.jsxs("button",{onClick:()=>w(c),className:"w-full px-3 py-2 text-left hover:bg-accent hover:text-accent-foreground flex items-center gap-2",children:[r.jsx(Me,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"text-sm font-medium truncate",children:c.name}),r.jsx("div",{className:"text-xs text-muted-foreground truncate",children:c.full_address})]})]},c.id))]}),o&&D.length>0&&!l.trim()&&r.jsxs("div",{children:[r.jsx("div",{className:"p-2 text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Favorites"}),D.slice(0,3).map(c=>r.jsxs("button",{onClick:()=>w(c),className:"w-full px-3 py-2 text-left hover:bg-accent hover:text-accent-foreground flex items-center gap-2",children:[r.jsx(te,{className:"h-4 w-4 text-yellow-400 fill-yellow-400 flex-shrink-0"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"text-sm font-medium truncate",children:c.name}),r.jsx("div",{className:"text-xs text-muted-foreground truncate",children:c.full_address})]})]},c.id))]}),l.trim()&&!F&&_.suggestions.length===0&&!m&&r.jsxs("div",{className:"p-3 text-sm text-muted-foreground text-center",children:['No locations found for "',l,'"']})]})})]})},se=async()=>{console.log("Checking for expired booking requests...");try{const e=Ce(new Date),{data:t,error:a}=await v.from("bookings").select("*").eq("status","pending").lt("start_date",e.toISOString());if(a)throw a;if(t&&t.length>0){const{error:s}=await v.from("bookings").update({status:"expired"}).in("id",t.map(n=>n.id));if(s)throw s;console.log(`Updated ${t.length} expired booking requests`)}}catch(e){console.error("Error in handleExpiredBookings:",e instanceof Error?e.message:JSON.stringify(e,null,2))}},ae=async(e,t,a,s)=>{try{let n=v.from("bookings").select("*").eq("car_id",e).in("status",["confirmed","pending"]).or(`and(start_date.lte.${S(a,"yyyy-MM-dd")},end_date.gte.${S(t,"yyyy-MM-dd")})`);const{data:o,error:f}=await n;return f?(console.error("Error checking car availability:",f),!1):!o||o.length===0}catch(n){return console.error("Error in checkCarAvailability:",n),!1}},Qe=async e=>{try{const{data:t,error:a}=await v.from("bookings").select("start_date, end_date").eq("car_id",e).in("status",["confirmed","pending"]);if(a)return console.error("Error fetching booked dates:",a),[];const s=[];return t==null||t.forEach(n=>{const o=re(n.start_date),f=re(n.end_date),u=new Date(o);for(;u<=f;)s.push(new Date(u)),u.setDate(u.getDate()+1)}),s}catch(t){return console.error("Error in getBookedDates:",t),[]}},et=(e,t)=>t.some(a=>e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear()),tt=({isOpen:e,onClose:t,onLocationSelected:a})=>{const[s,n]=i.useState(null);i.useRef(null);const o=i.useRef(null),f=i.useRef(null),u=i.useRef(null),l=i.useRef(!1),[h,O]=i.useState(null),[k,C]=i.useState(!0),I={long:0,lat:0},[M,j]=i.useState(I);be();const _=i.useCallback((m,d)=>{j({long:m,lat:d}),n({lat:d,lng:m})},[]);i.useEffect(()=>{(async()=>{try{const d=await we();if(!d){p.error("Failed to get the map token");return}console.log("Mapbox token retrieved successfully"),O(d),C(!1)}catch(d){console.error("Error getting Mapbox token:",d),p.error("Failed to load map configuration")}})()},[]);const L=i.useCallback(m=>{const[d,b]=m.coordinates;n({lat:b,lng:d,address:m.full_address}),j({long:d,lat:b}),o.current&&(o.current.setCenter([d,b]),o.current.setZoom(15)),p.success(`Location selected: ${m.name}`)},[]),D=()=>{s?(a(s.lat,s.lng),t()):p.error("Please select a location first")},F=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(m=>{const{latitude:d,longitude:b}=m.coords;n({lat:d,lng:b}),j({long:b,lat:d}),o.current&&(o.current.setCenter([b,d]),o.current.setZoom(15)),p.success("Current location detected")},m=>{console.error("Error getting location:",m),p.error("Unable to get your current location")}):p.error("Geolocation is not supported by this browser")};return i.useEffect(()=>{e&&(n(null),f.current&&(f.current.remove(),f.current=null),l.current=!1)},[e]),i.useEffect(()=>(e&&o.current&&(console.log("Dialog opened, resizing map"),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{o.current&&(o.current.resize(),console.log("Map resize triggered"))},500)),()=>{u.current&&(clearTimeout(u.current),u.current=null)}),[e]),i.useEffect(()=>()=>{f.current&&(f.current.remove(),f.current=null),u.current&&(clearTimeout(u.current),u.current=null),o.current&&(o.current.remove(),o.current=null)},[]),r.jsx(Ne,{children:r.jsx(oe,{open:e,onOpenChange:m=>{m||t()},children:r.jsxs(ne,{className:"sm:max-w-[600px] h-[80vh] max-h-[800px] flex flex-col overflow-hidden p-0",children:[r.jsxs(ie,{className:"p-6 pb-4",children:[r.jsx(ce,{children:"Select Pickup Location"}),r.jsx(le,{className:"text-sm text-muted-foreground",children:"Search for a location or click on the map to select a pickup location."})]}),r.jsx("div",{className:"px-6 pb-4",children:r.jsx(Ke,{placeholder:"Search for a pickup location...",onLocationSelect:L,className:"w-full"})}),r.jsxs(fe,{className:"flex-1 overflow-auto px-6 py-2",children:[r.jsxs("div",{className:"relative w-full rounded-md overflow-hidden border border-border mb-4",style:{height:"400px",minHeight:"300px"},children:[(k||!h)&&r.jsx("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",children:r.jsx(Le,{className:"w-full h-full"})}),r.jsx(_e,{mapbox_token:h,longitude:M.long||0,latitude:M.lat||0,zoom:14,dpad:!0,returnLocation:_}),s&&r.jsxs("div",{className:"absolute top-2 left-2 bg-background/90 p-2 rounded-md shadow-sm border border-border text-xs",children:[r.jsxs("p",{children:["Latitude: ",s.lat.toFixed(6)]}),r.jsxs("p",{children:["Longitude: ",s.lng.toFixed(6)]}),s.address&&r.jsx("p",{className:"mt-1 text-muted-foreground",children:s.address})]}),r.jsx("div",{className:"absolute top-2 right-2",children:r.jsxs(E,{size:"sm",variant:"secondary",className:"h-8 shadow-sm",onClick:F,disabled:!h||k,children:[r.jsx(Fe,{className:"h-4 w-4 mr-1"}),"Use My Location"]})})]}),r.jsx("div",{className:"flex flex-col gap-2 mb-4",children:r.jsx("p",{className:"text-xs text-muted-foreground",children:k?"Loading map...":h?s?"Location selected. Click confirm to use this location.":"Search for a location above, click on the map, or use your current location.":"Map configuration not available"})})]}),r.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t sticky bottom-0 bg-background",children:[r.jsx(E,{variant:"outline",onClick:t,children:"Cancel"}),r.jsx(E,{onClick:D,disabled:!s,children:"Confirm Location"})]})]})})})},pt=({car:e,isOpen:t,onClose:a})=>{const[s,n]=i.useState(),[o,f]=i.useState(),[u,l]=i.useState(!1),[h,O]=i.useState(!1),[k,C]=i.useState(null),[I,M]=i.useState([]),[j,_]=i.useState(!1),[L,D]=i.useState(!0),[F,m]=i.useState(!1),[d,b]=i.useState(null),[H,$]=i.useState(!1),P=i.useRef(!0),{toast:w}=je(),Z=De(),{isVerified:R,isLoading:c}=Te();i.useEffect(()=>{(async()=>{var y,U;const{data:g}=await v.auth.getSession(),T=(U=(y=g.session)==null?void 0:y.user)==null?void 0:U.id;P.current&&(C(T),T&&e.owner_id===T&&O(!0))})()},[e.owner_id]),i.useEffect(()=>{t&&e.id&&((async()=>{const g=await Qe(e.id);M(g)})(),se().catch(console.error))},[t,e.id]),i.useEffect(()=>{s&&o?(async()=>{if(s&&o&&e.id){_(!0);try{const g=await ae(e.id,s,o);D(g)}catch(g){console.error("Error checking availability:",g),D(!1)}finally{_(!1)}}})():D(!0)},[s,o,e.id]),i.useEffect(()=>(t&&se().catch(console.error),()=>{}),[t]),i.useEffect(()=>{e.latitude&&e.longitude&&b({latitude:e.latitude,longitude:e.longitude})},[e]),i.useEffect(()=>()=>{P.current=!1},[]);const N=async(x,g,T,y,U)=>{console.log("Creating notification:",{userId:x,type:g,content:T,carId:y,bookingId:U});const{error:z}=await v.from("notifications").insert({user_id:x,type:g,content:T,related_car_id:y,related_booking_id:U});return z?(console.error("Error creating notification:",z.message||JSON.stringify(z,null,2)),!1):!0},q=async()=>{var T;if(!R&&!c){$(!0);return}if(h){w({title:"Not allowed",description:"You cannot book your own car",variant:"destructive"});return}if(!s||!o){w({title:"Error",description:"Please select both start and end dates",variant:"destructive"});return}if(!await ae(e.id,s,o)){w({title:"Not available",description:"This car is not available for the selected dates. Please choose different dates."});return}if(!d){w({title:"Error",description:"Please select a pickup location",variant:"destructive"});return}l(!0);const g=setTimeout(()=>{P.current&&(l(!1),w({title:"Timeout",description:"Booking is taking longer than expected. Please check your bookings page.",variant:"destructive"}))},3e4);try{console.log("[BookingDialog] Starting booking process...");const{data:y}=await v.auth.getSession();if(!((T=y.session)!=null&&T.user))throw new Error("No authenticated user");const z=(Math.ceil((o.getTime()-s.getTime())/(1e3*60*60*24))+1)*e.price_per_day;console.log("[BookingDialog] Creating booking in database...");const{data:J,error:G}=await v.from("bookings").insert({car_id:e.id,renter_id:y.session.user.id,start_date:S(s,"yyyy-MM-dd"),end_date:S(o,"yyyy-MM-dd"),total_price:z,latitude:d.latitude,longitude:d.longitude,status:"pending"}).select().single();if(G)throw G;console.log("[BookingDialog] Booking created successfully:",J.id),console.log("[BookingDialog] Creating notifications...");try{await N(y.session.user.id,"booking_request",`Your booking request for ${e.brand} ${e.model} from ${S(s,"PPP")} to ${S(o,"PPP")} has been submitted.`,e.id,J.id)}catch(B){console.error("Failed to create renter notification (non-blocking):",B instanceof Error?B.message:JSON.stringify(B,null,2))}try{await N(e.owner_id,"booking_request",`New booking request received for your ${e.brand} ${e.model} from ${S(s,"PPP")} to ${S(o,"PPP")}.`,e.id,J.id)}catch(B){console.error("Failed to create host notification (non-blocking):",B instanceof Error?B.message:JSON.stringify(B,null,2))}if(!P.current)return;console.log("[BookingDialog] Booking flow completed successfully, closing modal..."),w({title:"Success",description:"Your booking request has been submitted!"}),a(),Z("/bookings")}catch(y){if(!P.current)return;console.error("Booking error:",y instanceof Error?y.message:JSON.stringify(y,null,2)),w({title:"Error",description:"Failed to create booking. Please try again.",variant:"destructive"})}finally{clearTimeout(g),P.current&&l(!1)}},ge=(x,g)=>{b({latitude:x,longitude:g})},xe=()=>d?d.latitude===e.latitude&&d.longitude===e.longitude?`Default: ${e.location}`:`Custom location (${d.latitude.toFixed(4)}, ${d.longitude.toFixed(4)})`:"No location selected",pe=x=>{const g=new Date;return g.setDate(g.getDate()),g.setHours(0,0,0,0),x<g?!0:et(x,I)};return r.jsxs(r.Fragment,{children:[r.jsx(oe,{open:t,onOpenChange:a,children:r.jsxs(ne,{className:"sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[r.jsxs(ie,{children:[r.jsxs(ce,{children:["Book ",e.brand," ",e.model]}),r.jsx(le,{className:"text-muted-foreground",children:"Select your rental dates below"})]}),h&&r.jsxs(K,{variant:"destructive",className:"mb-4",children:[r.jsx(Be,{className:"h-4 w-4"}),r.jsx(Q,{children:"Not allowed"}),r.jsx(ee,{children:"You cannot book your own car. This is for other renters only."})]}),!L&&s&&o&&r.jsxs(K,{variant:"destructive",className:"mb-4",children:[r.jsx(Ie,{className:"h-4 w-4"}),r.jsx(Q,{children:"Not available"}),r.jsx(ee,{children:"This car is not available for the selected dates. Please choose different dates."})]}),r.jsxs("div",{className:"grid gap-4 py-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-medium",children:"Select dates"}),r.jsx(Se,{mode:"range",selected:{from:s,to:o},onSelect:x=>{n(x==null?void 0:x.from),f(x==null?void 0:x.to)},numberOfMonths:1,disabled:pe,modifiers:{booked:I},modifiersStyles:{booked:{backgroundColor:"rgba(239, 68, 68, 0.1)",color:"rgb(239, 68, 68)",textDecoration:"line-through"}}})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-medium",children:"Pickup Location"}),r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(me,{className:"h-5 w-5 text-primary mt-0.5 flex-shrink-0"}),r.jsx("div",{className:"text-sm",children:r.jsx("p",{children:xe()})})]}),r.jsx(E,{variant:"outline",size:"sm",onClick:()=>m(!0),children:"Change"})]})]}),s&&o&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-medium",children:"Summary"}),r.jsxs("div",{className:"text-sm space-y-1 p-4 bg-primary/5 rounded-md",children:[r.jsxs("p",{children:["Start date: ",S(s,"PPP")]}),r.jsxs("p",{children:["End date: ",S(o,"PPP")]}),r.jsx("div",{className:"border-t border-border pt-2 mt-2",children:r.jsxs("p",{className:"font-medium text-primary",children:["Total: BWP"," ",Math.ceil((o.getTime()-s.getTime())/(1e3*60*60*24)+1)*e.price_per_day]})}),r.jsx(E,{variant:"outline",size:"sm",onClick:()=>m(!0),children:"Change"})]})]})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2",children:[r.jsx(E,{variant:"outline",onClick:a,className:"w-full sm:w-auto",children:"Cancel"}),r.jsx(E,{onClick:!R&&!c?()=>$(!0):q,disabled:!s||!o||u||h||j||!L||!d||c,className:"w-full sm:w-auto",variant:!R&&!c?"outline":"default",children:u?"Booking...":j?"Checking...":c?"Checking verification...":R?"Confirm":"Start Verification"})]})]})}),r.jsx(Ee,{isOpen:H,onClose:()=>$(!1),action:"booking",carData:e}),r.jsx(tt,{isOpen:F,onClose:()=>m(!1),onLocationSelected:ge})]})},vt=async e=>{try{console.log("Saving car:",e);const{data:{session:t}}=await v.auth.getSession();if(!(t!=null&&t.user))return console.log("No active session found when trying to save car"),p.error("Please sign in to save cars"),!1;const{data:a}=await v.from("saved_cars").select("id").eq("user_id",t.user.id).eq("car_id",e).maybeSingle();if(a)return console.log("Car already saved:",e),!0;const{error:s}=await v.from("saved_cars").insert({user_id:t.user.id,car_id:e});return s?(console.error("Error saving car:",s),p.error("Failed to save car. Please try again."),!1):(p.success("Car saved to your favorites"),!0)}catch(t){return console.error("Error in saveCar:",t),p.error("An error occurred while saving the car"),!1}},yt=async e=>{try{console.log("Unsaving car:",e);const{data:{session:t}}=await v.auth.getSession();if(!(t!=null&&t.user))return console.log("No active session found when trying to unsave car"),p.error("Please sign in to manage saved cars"),!1;const{error:a}=await v.from("saved_cars").delete().eq("user_id",t.user.id).eq("car_id",e);return a?(console.error("Error unsaving car:",a),p.error("Failed to remove car from favorites. Please try again."),!1):(p.success("Car removed from your favorites"),!0)}catch(t){return console.error("Error in unsaveCar:",t),p.error("An error occurred while removing the car from favorites"),!1}},kt=async e=>{try{const{data:{session:t}}=await v.auth.getSession();if(!(t!=null&&t.user))return!1;const{data:a}=await v.from("saved_cars").select("id").eq("user_id",t.user.id).eq("car_id",e).maybeSingle();return!!a}catch(t){return console.error("Error checking if car is saved:",t),!1}};export{pt as B,gt as C,xt as H,Ke as L,kt as i,vt as s,yt as u};

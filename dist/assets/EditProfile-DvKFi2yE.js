import{j as s}from"./query-vendor-Bsfdn-Hb.js";import{r as t,u as A}from"./react-vendor-mnpoGfEl.js";import{s as c,J as u,i as $,j as k,k as I,f as v,I as j,B as L}from"./index-P3CM6KeI.js";import{S as V,a as B,b as J,c as O,d as q}from"./select-DFSr6W2K.js";import{c as R}from"./Countries-Bl9i4ru8.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";import"./index-DXD4kVr2.js";const T=({profileData:e})=>{const[d,m]=t.useState(!1),[o,g]=t.useState((e==null?void 0:e.full_name)||""),[a,i]=t.useState(e!=null&&e.phone_number?e.phone_number.slice(4):""),[l,p]=t.useState(e!=null&&e.phone_number?e.phone_number.slice(0,4):"+267"),[x,N]=t.useState((e==null?void 0:e.avatar_url)||""),[y,w]=t.useState(!1),P=A();t.useEffect(()=>{e&&(g(e.full_name||""),i(e!=null&&e.phone_number?e.phone_number.slice(4):""),p(e!=null&&e.phone_number?e.phone_number.slice(0,4):"+267"),N(e.avatar_url||""))},[e]);const f=r=>r.replace(/[^\d+]/g,""),C=async()=>{try{m(!0);const r=f(`${l}${a}`),n={id:e==null?void 0:e.id,full_name:o,phone_number:r,updated_at:new Date().toISOString(),avatar_url:x},{error:h}=await c.from("profiles").upsert(n);if(h)throw h;u.success("Profile updated successfully!"),P("/profile")}catch(r){console.error("Error updating profile:",r),u.error("Failed to update profile")}finally{m(!1)}},E=async r=>{try{if(w(!0),!r.target.files||r.target.files.length===0)throw new Error("You must select an image to upload.");const n=r.target.files[0],h=n.name.split(".").pop(),b=`${`${e==null?void 0:e.id}.${h}`}`,{error:_}=await c.storage.from("avatars").upload(b,n,{cacheControl:"3600",upsert:!1});if(_)throw _;const{data:U}=c.storage.from("avatars").getPublicUrl(b);N(U.publicUrl);const F={id:e==null?void 0:e.id,full_name:o,phone_number:f(`${l}${a}`),updated_at:new Date().toISOString(),avatar_url:b},{error:S}=await c.from("profiles").upsert(F);if(S)throw S;u.success("Avatar updated successfully!")}catch(n){console.error("Error uploading avatar:",n),u.error("Failed to upload avatar")}finally{w(!1)}};return s.jsx("div",{className:"container mx-auto mt-8 p-4",children:s.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[s.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Edit Profile"}),s.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[s.jsx($,{className:"h-24 w-24 rounded-full overflow-hidden mb-2",children:x?s.jsx(k,{src:x,alt:"Avatar"}):s.jsx(I,{children:e!=null&&e.full_name?e.full_name[0].toUpperCase():"ðŸ‘¤"})}),s.jsxs(v,{htmlFor:"avatar",className:"cursor-pointer",children:[y?"Uploading...":"Change Avatar",s.jsx(j,{type:"file",id:"avatar",accept:"image/*",className:"hidden",onChange:E,disabled:y})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(v,{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),s.jsx(j,{type:"text",id:"fullName",value:o,onChange:r=>g(r.target.value),className:"mt-1 p-2 w-full border rounded-md"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(v,{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(V,{value:l,onValueChange:p,children:[s.jsx(B,{className:"w-[140px]",children:s.jsx(J,{placeholder:"Country"})}),s.jsx(O,{children:R.map(({code:r,country:n})=>s.jsxs(q,{value:r,children:[n," (",r,")"]},r))})]}),s.jsx(j,{type:"tel",id:"phone",value:a,onChange:r=>i(f(r.target.value)),className:"mt-1 p-2 w-full border rounded-md flex-1"})]})]}),s.jsx(L,{onClick:C,disabled:d,className:"w-full bg-primary text-white rounded-md p-2 hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50",children:d?"Updating...":"Update Profile"})]})})},D=()=>{const[e,d]=t.useState(null),[m,o]=t.useState(!0);return t.useEffect(()=>{(async()=>{try{o(!0);const{data:{user:a}}=await c.auth.getUser();if(!a){console.error("User not found"),u.error("User not found. Please sign in.");return}const{data:i,error:l}=await c.from("profiles").select("*").eq("id",a.id).single();if(l)throw l;d(i)}catch(a){console.error("Error fetching profile:",a),u.error("Failed to fetch profile. Please try again.")}finally{o(!1)}})()},[]),s.jsx("div",{children:m?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("p",{children:"Loading profile..."})}):s.jsx(T,{profileData:e})})};export{D as default};

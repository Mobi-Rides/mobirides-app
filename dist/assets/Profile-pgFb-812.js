import{j as e}from"./query-vendor-C7aRRP05.js";import{c as P,m as T,n as O,u as K,s as m,B as v,U as z,o as H,p as V,q,J as w,T as Q,r as A,I as X,P as Z,D as ee,b as se,d as ae,e as te,t as re,v as G,C as le,w as L,x as $}from"./index-CV3rVyoS.js";import{u as Y,r as h}from"./react-vendor-mnpoGfEl.js";import{N as B,C as oe}from"./Navigation-NsQjHjAL.js";import{C as k,a as U,b as F,c as R,d as S}from"./card-BYz0HUlZ.js";import{S as ie}from"./switch-i6cWzisG.js";import{C as W}from"./car-Bf051nla.js";import{W as ne}from"./wallet-xYrQZcCA.js";import{B as D}from"./bell-Dr02D-Bx.js";import{S as ce}from"./settings-CzuPzsxf.js";import{S as J}from"./shield-TCFOhCsD.js";import{S as de,M as ue}from"./sun-BRX-38Uz.js";import{B as me}from"./book-open-CzPNmAlX.js";import{C as he}from"./circle-help-DLWC1Q_U.js";import{M as xe}from"./message-square-INBje8qK.js";import{L as pe}from"./log-out-BFJYZr5x.js";import{U as fe}from"./upload-COdgzhDy.js";import{F as ge,a as be,b as je,c as ve,d as ye,e as Ne}from"./form-D65NMvNm.js";import{u as we}from"./form-vendor-95UsJkpA.js";import{T as ke}from"./trending-up-CTYgwEDI.js";import{L as Se}from"./loader-circle-DyIJ3h3k.js";import{O as Ce}from"./OnlineStatusToggle-Cl59fxU-.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";import"./map-pin-DSTFqCgm.js";import"./user-BnZM330N.js";import"./index-DE7TNQN2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=P("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=P("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=P("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=P("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=P("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),Fe=()=>e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 w-32 bg-gray-200 rounded mb-6"}),e.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded-full mb-4"}),e.jsx("div",{className:"h-10 w-full max-w-sm bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-10 w-full max-w-sm bg-gray-200 rounded"})]}),e.jsx(B,{})]}),Re=a=>typeof a=="string"?a:a instanceof Error?a.message:a&&typeof a=="object"&&"message"in a?String(a.message):"An unexpected error occurred",Me=({error:a})=>e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(T,{variant:"destructive",children:e.jsx(O,{children:Re(a)})}),e.jsx(B,{})]}),_e=({fullName:a,avatarUrl:n,setActiveView:l,role:o="renter"})=>{const r=Y(),{theme:u,toggleTheme:g}=K(),b=async()=>{try{await m.auth.signOut(),w.success("Logged out successfully"),r("/login")}catch(i){console.error("Error logging out:",i),w.error("Failed to log out")}},s=()=>{l("role")},t=n?m.storage.from("avatars").getPublicUrl(n).data.publicUrl:null,d=[{icon:Ue,label:"Edit Profile",onClick:()=>l("profile"),color:"text-primary"},{icon:Ee,label:"Saved Cars",onClick:()=>r("/saved-cars")},{icon:Pe,label:"Dashboard",onClick:()=>r("/dashboard")},{icon:oe,label:"My Bookings",onClick:()=>r("/bookings"),animate:!0}],c=o==="host"?[{icon:ne,label:"Wallet & Earnings",onClick:()=>r("/wallet"),description:"Manage your wallet balance and view transaction history"}]:[],p=[...d.slice(1),...c,{icon:D,label:"Notifications",onClick:()=>r("/notifications"),description:"View your latest notifications",animate:!0}],x=[{icon:ce,label:"App Settings",onClick:()=>w("App Settings coming soon")},{icon:D,label:"Notification Preferences",onClick:()=>r("/notification-preferences")},{icon:J,label:"Privacy & Security",onClick:()=>w("Privacy settings coming soon")}],j=[{icon:me,label:"Browse Help Center",onClick:()=>r(`/help/${o}`),description:"Complete guides and tutorials"},{icon:he,label:"Quick Start Guide",onClick:()=>r(`/help/${o}/getting-started`),description:"Get started in minutes"},{icon:xe,label:"Contact Support",onClick:()=>w("Contact support coming soon"),description:"Get help from our team"},{icon:Q,label:"Report Issue",onClick:()=>w("Report issue coming soon"),description:"Report bugs or problems"}],N={label:"Log Out",onClick:b,color:"text-red-600"},C=o==="host"?"Switch to Renter":"Switch to Host",M=o==="host"?W:z;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-[96px] left-0 right-0 z-50 flex justify-center px-4",children:e.jsx(v,{type:"button",onClick:s,className:"shadow-lg rounded-full px-6 py-3 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring transition-all duration-200 bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80 transform hover:scale-105",size:"lg","aria-label":C,title:C,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(E,{className:"h-4 w-4"})]}),e.jsx("span",{className:"font-medium",children:C})]})})}),e.jsxs("div",{className:"w-full px-4 pb-20",children:[e.jsx("div",{className:"w-full mb-6",children:e.jsx("h1",{className:"text-xl sm:text-2xl text-left font-semibold text-foreground",children:"Profile Settings"})}),e.jsxs("button",{type:"button",onClick:()=>l("profile"),className:"w-full flex items-center gap-3 p-3 hover:bg-accent/70 rounded-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-ring mb-6 transition-colors","aria-label":"View and edit profile",children:[e.jsxs(H,{className:"h-10 w-10 bg-[#2B2B2B] text-white",children:[e.jsx(V,{src:t||void 0,alt:"Profile"}),e.jsx(q,{className:"text-sm font-medium",children:a==null?void 0:a.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex flex-col items-start gap-0.5",children:[e.jsx("span",{className:"text-[15px] font-medium",children:a==null?void 0:a.split(" ")[0]}),e.jsx("span",{className:"text-[13px] text-muted-foreground",children:"Show profile"})]})]}),e.jsxs(k,{className:"mb-6",children:[e.jsxs(U,{className:"pb-2",children:[e.jsx(F,{className:"text-lg text-left",children:"Vehicle & Bookings"}),e.jsxs(R,{className:"text-left",children:["Manage your saved vehicles, booking activities",o==="host"?", and wallet":""]})]}),e.jsx(S,{className:"space-y-2 pt-0",children:p.map((i,f)=>e.jsx("button",{type:"button",onClick:i.onClick,"aria-label":i.label,className:`w-full flex items-center justify-between p-3 rounded-lg hover:bg-accent/70 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring transition-colors ${i.color||"text-foreground"} ${i.animate?"animate-throb":""}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i.icon,{className:"h-5 w-5"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{children:i.label}),i.description&&e.jsx("span",{className:"text-xs text-muted-foreground",children:i.description})]})]})},f))})]}),e.jsxs(k,{className:"mb-6",children:[e.jsxs(U,{className:"pb-2",children:[e.jsx(F,{className:"text-lg text-left",children:"Account Settings"}),e.jsx(R,{className:"text-left",children:"Manage your preferences and account security"})]}),e.jsxs(S,{className:"space-y-2 pt-0",children:[e.jsxs("div",{className:"w-full flex items-center justify-between p-3 rounded-lg hover:bg-accent/70 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u==="light"?e.jsx(de,{className:"h-5 w-5"}):e.jsx(ue,{className:"h-5 w-5"}),e.jsx("span",{children:"Dark Mode"})]}),e.jsx(ie,{checked:u==="dark",onCheckedChange:g,"aria-label":`Toggle dark mode, currently ${u==="dark"?"on":"off"}`})]}),x.map((i,f)=>e.jsx("button",{type:"button",onClick:i.onClick,"aria-label":i.label,className:`w-full flex items-center justify-between p-3 rounded-lg hover:bg-accent/70 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring transition-colors ${i.color||"text-foreground"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i.icon,{className:"h-5 w-5"}),e.jsx("span",{children:i.label})]})},f))]})]}),e.jsxs(k,{className:"mb-6",children:[e.jsxs(U,{className:"pb-2",children:[e.jsx(F,{className:"text-lg text-left",children:"Help & Support"}),e.jsx(R,{className:"text-left",children:"Get assistance and learn more about MobiRides"})]}),e.jsx(S,{className:"space-y-2 pt-0",children:j.map((i,f)=>e.jsx("button",{type:"button",onClick:i.onClick,"aria-label":i.label,className:`w-full flex items-center justify-between p-3 rounded-lg hover:bg-accent/70 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring transition-colors ${i.color||"text-foreground"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i.icon,{className:"h-5 w-5"}),e.jsx("span",{children:i.label})]})},f))})]}),e.jsx("button",{type:"button",onClick:N.onClick,"aria-label":N.label,className:`w-full flex items-center justify-between p-3 rounded-lg hover:bg-accent/70 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring transition-colors ${N.color}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"h-5 w-5"}),e.jsx("span",{children:N.label})]})})]})]})},Ae=({avatarUrl:a,setAvatarUrl:n})=>{const[l,o]=h.useState(!1),{toast:r}=A(),u=async b=>{try{if(o(!0),!b.target.files||b.target.files.length===0)throw new Error("You must select an image to upload.");const s=b.target.files[0],t=s.name.split(".").pop(),d=`${Math.random()}.${t}`,{data:{session:c}}=await m.auth.getSession();if(!(c!=null&&c.user))throw new Error("No authenticated user found");console.log("Uploading avatar...");const{error:p}=await m.storage.from("avatars").upload(d,s);if(p)throw p;console.log("Avatar uploaded, updating profile...");const{error:x}=await m.from("profiles").update({avatar_url:d}).eq("id",c.user.id);if(x)throw x;n(d),console.log("Avatar update complete"),r({title:"Success",description:"Avatar uploaded successfully"})}catch(s){console.error("Error uploading avatar:",s),r({title:"Error",description:s.message||"Failed to upload avatar",variant:"destructive"})}finally{o(!1)}},g=a?m.storage.from("avatars").getPublicUrl(a).data.publicUrl:null;return e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(H,{className:"h-16 w-16",children:[e.jsx(V,{src:g||void 0,alt:"Profile Avatar"}),e.jsx(q,{children:"👤"})]}),e.jsxs(v,{variant:"outline",disabled:l,className:"relative",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:u,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:l}),e.jsx(fe,{className:"w-4 h-4 mr-2"}),l?"Uploading...":"Upload Avatar"]})]})})},Be=({initialValues:a})=>{const{toast:n}=A(),[l,o]=h.useState(!1),[r,u]=h.useState(null),g=we({defaultValues:a});h.useEffect(()=>{(async()=>{var d;console.log("Fetching phone number...");const{data:{session:t}}=await m.auth.getSession();if(console.log("Session:",t),t!=null&&t.user){const{data:{user:c}}=await m.auth.getUser();if(console.log("User metadata:",c==null?void 0:c.user_metadata),(d=c==null?void 0:c.user_metadata)!=null&&d.unverified_phone){console.log("Found phone number in metadata:",c.user_metadata.unverified_phone),u(c.user_metadata.unverified_phone);return}const{data:p,error:x}=await m.from("profiles").select("*").eq("id",t.user.id).single(),j=p;!x&&(j!=null&&j.phone_number)?(console.log("Found phone number in profiles:",j.phone_number),u(j.phone_number),await m.auth.updateUser({data:{unverified_phone:j.phone_number}})):console.log("No phone number found in either location")}else console.log("No session found")})()},[]);const b=async s=>{try{o(!0);const{data:{session:t}}=await m.auth.getSession();if(!(t!=null&&t.user))throw new Error("No authenticated user found");const d={full_name:s.full_name,updated_at:new Date().toISOString()},{error:c}=await m.from("profiles").update(d).eq("id",t.user.id);if(c)throw c;console.log("Profile updated successfully"),n({title:"Success",description:"Profile updated successfully"})}catch(t){console.error("Error updating profile:",t),n({title:"Error",description:"Failed to update profile",variant:"destructive"})}finally{o(!1)}};return e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Profile Information"}),e.jsx(ge,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(b),className:"space-y-4 max-w-sm",children:[e.jsx(be,{control:g.control,name:"full_name",render:({field:s})=>e.jsxs(je,{children:[e.jsx(ve,{children:"Full Name"}),e.jsx(ye,{children:e.jsx(X,{placeholder:"Enter your full name",...s,disabled:l})}),e.jsx(Ne,{})]})}),e.jsx(v,{type:"submit",disabled:l,children:l?"Saving...":"Save Changes"}),r&&e.jsxs("div",{className:"flex items-center gap-2 mt-4 text-sm text-muted-foreground",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsxs("span",{children:["Phone: ",r]})]})]})})]})},Ie=({avatarUrl:a,setAvatarUrl:n,initialFormValues:l,onBack:o})=>e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"ghost",onClick:o,className:"mb-6",children:"← Back to Settings"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Profile Picture"}),e.jsx(Ae,{avatarUrl:a,setAvatarUrl:n})]}),e.jsx(Be,{initialValues:l})]}),Le=[{value:"renter",title:"Renter",subtitle:"Explore & Book Cars",description:"Discover amazing vehicles from trusted hosts in your area. Book instantly and enjoy flexible rental periods.",benefits:["Browse thousands of verified cars","Instant booking confirmation","Flexible rental periods","24/7 customer support","Insurance coverage included"],features:["Save favorite cars","Rate and review hosts","Real-time availability","Secure payments"],icon:W,color:"text-blue-600",bgGradient:"from-blue-50 to-blue-100",badgeColor:"bg-blue-100 text-blue-700"},{value:"host",title:"Host",subtitle:"Share & Earn",description:"Turn your idle car into a money-making asset. List your vehicle and start earning passive income today.",benefits:["Earn up to $500+ per month","Comprehensive insurance coverage","Verified renter community","Flexible hosting schedule","Host protection guarantee"],features:["Smart pricing suggestions","Automated availability","Instant messaging","Performance analytics"],icon:z,color:"text-purple-600",bgGradient:"from-purple-50 to-purple-100",badgeColor:"bg-purple-100 text-purple-700"}],$e=({isOpen:a,onClose:n,currentRole:l,onRoleUpdate:o})=>{const[r,u]=h.useState(!1),{toast:g}=A(),b=async s=>{if(!(s===l||r))try{u(!0);const{data:{user:t}}=await m.auth.getUser();if(!t)return;console.log("Updating role to:",s);const{error:d}=await m.from("profiles").update({role:s}).eq("id",t.id);if(d)throw d;o(s),g({title:"Role Updated Successfully! 🎉",description:`Welcome to your new ${s} experience. You can switch back anytime.`}),n()}catch(t){console.error("Error updating role:",t),g({title:"Error",description:"Failed to update role. Please try again.",variant:"destructive"})}finally{u(!1)}};return e.jsx(ee,{open:a,onOpenChange:n,children:e.jsxs(se,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{className:"space-y-4 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(E,{className:"h-6 w-6 text-primary"}),e.jsx(te,{className:"text-2xl font-bold text-center",children:"Switch Your Role"})]}),e.jsx(re,{className:"text-center text-lg",children:"Choose how you want to experience MobiRides. You can switch between roles anytime."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Le.map(s=>{const t=s.icon,d=l===s.value,c=l!==s.value;return e.jsx(k,{className:`
                  relative overflow-hidden transition-all duration-300 transform hover:scale-[1.02] cursor-pointer
                  ${d?`ring-2 ring-primary bg-gradient-to-br ${s.bgGradient}`:`hover:shadow-lg bg-gradient-to-br ${s.bgGradient} hover:shadow-xl`}
                  ${r?"opacity-50 cursor-not-allowed":""}
                `,onClick:()=>!r&&b(s.value),children:e.jsxs(S,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-white shadow-sm",children:e.jsx(t,{className:`h-8 w-8 ${s.color}`})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground flex items-center space-x-2",children:[e.jsx("span",{children:s.title}),d&&e.jsx(G,{className:`${s.badgeColor} text-xs`,children:"Current"})]}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s.subtitle})]})]}),d&&e.jsx("div",{className:"flex items-center space-x-1 text-primary",children:e.jsx(le,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-4 w-4 text-primary"}),e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Key Benefits"})]}),e.jsx("ul",{className:"space-y-2",children:s.benefits.slice(0,3).map((p,x)=>e.jsxs("li",{className:"flex items-start space-x-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full mt-1.5 ${s.color.replace("text-","bg-")}`}),e.jsx("span",{children:p})]},x))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"h-4 w-4 text-primary"}),e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Features"})]}),e.jsx("ul",{className:"space-y-2",children:s.features.slice(0,2).map((p,x)=>e.jsxs("li",{className:"flex items-start space-x-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full mt-1.5 ${s.color.replace("text-","bg-")}`}),e.jsx("span",{children:p})]},x))})]}),c&&e.jsx(v,{variant:d?"default":"outline",size:"sm",className:"w-full mt-4",disabled:r,onClick:p=>{p.stopPropagation(),b(s.value)},children:r?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4 animate-spin mr-2"}),"Switching..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Switch to ",s.title]})}),d&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-primary text-sm font-medium",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs("span",{children:["You're currently a ",s.title]})]})]})},s.value)})}),e.jsx("div",{className:"text-center pt-4 border-t",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"You can switch between roles anytime from your profile settings"})})]})})},De=()=>{const[a,n]=h.useState(!1),[l,o]=h.useState("renter"),[r,u]=h.useState(!0);h.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:{user:s}}=await m.auth.getUser();if(!s)return;const{data:t}=await m.from("profiles").select("role").eq("id",s.id).maybeSingle();t!=null&&t.role&&o(t.role),u(!1)}catch(s){console.error("Error fetching role:",s),u(!1)}},b=s=>{o(s)};return r?e.jsx("div",{className:"space-y-6",children:e.jsx(k,{children:e.jsx(S,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k,{className:"overflow-hidden",children:[e.jsx(U,{className:"pb-4 bg-gradient-to-r from-primary/5 to-primary/10",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(E,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs(F,{className:"text-xl flex items-center space-x-2",children:[e.jsx("span",{children:"Your Role"}),e.jsx(G,{variant:"secondary",className:"capitalize",children:l})]}),e.jsx(R,{children:"Choose how you want to use MobiRides. Switch anytime to explore different features."})]})]})}),e.jsxs(S,{className:"space-y-6",children:[e.jsxs(T,{className:"border-primary/20 bg-primary/5",children:[e.jsx(_,{className:"h-4 w-4 text-primary"}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"font-medium text-foreground",children:["Currently active as: ",e.jsx("span",{className:"capitalize font-bold text-primary",children:l})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Renter:"})," Browse and book cars from verified hosts in your area. Perfect for occasional trips and adventures."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Host:"})," List your vehicles and earn money by renting them out to trusted renters. Turn your idle car into income."]})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(v,{onClick:()=>n(!0),className:"flex-1 h-12 text-base font-medium",size:"lg",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Switch Role"]}),e.jsxs(v,{variant:"outline",onClick:()=>n(!0),className:"flex-1 h-12 text-base",size:"lg",children:[e.jsx(_,{className:"h-5 w-5 mr-2"}),"Explore Options"]})]})]})]}),e.jsx($e,{isOpen:a,onClose:()=>n(!1),currentRole:l,onRoleUpdate:b})]})},Te=({latitude:a,longitude:n,onBack:l})=>e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"ghost",onClick:l,className:"mb-6",children:"← Back to Settings"}),e.jsx(De,{}),e.jsx("div",{className:"mt-6",children:e.jsx(Ce,{lat:a,long:n})})]}),Oe=a=>{const[n,l]=h.useState(null);return h.useEffect(()=>{const o={onEvent:r=>{if(r.type==="locationUpdate"&&r.payload){const u=r.payload;u.latitude&&l(u)}}};return L.subscribe(o),$.enableTracking(),()=>{L.unsubscribe(o),$.disableTracking()}},[]),{userLocation:n}},fs=()=>{const[a,n]=h.useState(!0),[l,o]=h.useState(null),[r,u]=h.useState(null),[g,b]=h.useState({full_name:""}),[s,t]=h.useState("menu"),[d,c]=h.useState("renter"),p=Y(),{userLocation:x}=Oe();if(h.useEffect(()=>{const C=async()=>{const{data:{session:f}}=await m.auth.getSession();if(!f){p("/login");return}},M=async()=>{try{n(!0),o(null);const{data:{session:f}}=await m.auth.getSession();if(!(f!=null&&f.user))throw new Error("No authenticated user found");console.log("Loading profile data...");const{data:y,error:I}=await m.from("profiles").select("avatar_url, full_name, role").eq("id",f.user.id).single();if(I)throw I;y&&(console.log("Profile data loaded:",{avatarUrl:y.avatar_url,fullName:y.full_name,role:y.role}),u(y.avatar_url),b({full_name:y.full_name||""}),c(y.role||"renter"))}catch(f){console.error("Error loading profile:",f),o("Failed to load profile data")}finally{n(!1)}};C(),M();const{data:{subscription:i}}=m.auth.onAuthStateChange(f=>{f==="SIGNED_OUT"&&p("/login")});return()=>{i.unsubscribe()}},[p]),a)return e.jsx(Fe,{});if(l)return e.jsx(Me,{error:l});const j=(x==null?void 0:x.latitude)||0,N=(x==null?void 0:x.longitude)||0;return e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[s==="menu"&&e.jsx(_e,{fullName:g.full_name,avatarUrl:r,setActiveView:t,role:d}),s==="profile"&&e.jsx(Ie,{avatarUrl:r,setAvatarUrl:u,initialFormValues:g,onBack:()=>t("menu")}),s==="role"&&e.jsx(Te,{latitude:j,longitude:N,onBack:()=>t("menu")}),e.jsx(B,{})]})};export{fs as default};

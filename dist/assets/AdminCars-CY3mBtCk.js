import{j as e,u as B}from"./query-vendor-Bsfdn-Hb.js";import{T as I,a as M,b as A,c as n,d as O,e as d,A as H,f as U}from"./table-LmMVSYSc.js";import{r as t}from"./react-vendor-mnpoGfEl.js";import{D as R,b as z,d as J,e as V,f as c,I as x,x as Y,B as N,s as L,J as y,an as K,n as Q,ac as X,V as $}from"./index-CEKMvnhM.js";import{C as F,d as q,a as G,b as W}from"./card-DVWWM3IP.js";import{S as D}from"./skeleton-CHo5tvc9.js";import{S as Z}from"./switch-8SvCuzOB.js";import{C as ee}from"./circle-x-CJywVQTJ.js";import"./separator-CNMPkK_g.js";import"./sheet-CcFgStQt.js";import"./car-CVWSXvWw.js";import"./credit-card-CocXzOfZ.js";import"./message-square-CfnZ98V9.js";import"./house-Bsui6dM0.js";import"./settings-Bd5GrtQ9.js";import"./log-out-C9uCL1sx.js";import"./useIsAdmin-zCX1SCL8.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";import"./index-DXD4kVr2.js";const se=({car:a,isOpen:o,onClose:p,onSuccess:v})=>{const[u,m]=t.useState(!1),[h,w]=t.useState(a.brand),[f,g]=t.useState(a.model),[j,S]=t.useState(a.year),[b,_]=t.useState(a.price_per_day),[s,i]=t.useState(a.location),[l,k]=t.useState(a.is_available),[T,E]=t.useState(a.description||""),P=async r=>{r.preventDefault(),m(!0);try{const{error:C}=await L.from("cars").update({brand:h.trim(),model:f.trim(),year:j,price_per_day:b,location:s.trim(),is_available:l,description:T.trim()||null}).eq("id",a.id);if(C)throw C;v()}catch(C){console.error("Error updating car:",C),y.error("Failed to update car")}finally{m(!1)}};return e.jsx(R,{open:o,onOpenChange:p,children:e.jsxs(z,{className:"sm:max-w-[425px]",children:[e.jsx(J,{children:e.jsx(V,{children:"Edit Car"})}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"brand",children:"Brand"}),e.jsx(x,{id:"brand",value:h,onChange:r=>w(r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"model",children:"Model"}),e.jsx(x,{id:"model",value:f,onChange:r=>g(r.target.value),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"year",children:"Year"}),e.jsx(x,{id:"year",type:"number",value:j,onChange:r=>S(parseInt(r.target.value)),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"price",children:"Price/Day (P)"}),e.jsx(x,{id:"price",type:"number",step:"0.01",value:b,onChange:r=>_(parseFloat(r.target.value)),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"location",children:"Location"}),e.jsx(x,{id:"location",value:s,onChange:r=>i(r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx(Y,{id:"description",value:T,onChange:r=>E(r.target.value),rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"available",checked:l,onCheckedChange:k}),e.jsx(c,{htmlFor:"available",children:"Available for booking"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:p,disabled:u,children:"Cancel"}),e.jsx(N,{type:"submit",disabled:u,children:u?"Updating...":"Update Car"})]})]})]})})},ae=()=>B({queryKey:["admin-cars"],queryFn:async()=>{const{data:a,error:o}=await L.from("cars").select(`
          id, brand, model, year, price_per_day, location, 
          is_available, created_at, owner_id,
          profiles:owner_id (full_name)
        `).order("created_at",{ascending:!1});if(o)throw o;return a||[]}}),re=()=>{const[a,o]=t.useState(""),[p,v]=t.useState(null),[u,m]=t.useState(!1),{data:h,isLoading:w,error:f,refetch:g}=ae(),j=(h==null?void 0:h.filter(s=>{var i,l;return s.brand.toLowerCase().includes(a.toLowerCase())||s.model.toLowerCase().includes(a.toLowerCase())||s.location.toLowerCase().includes(a.toLowerCase())||((l=(i=s.profiles)==null?void 0:i.full_name)==null?void 0:l.toLowerCase().includes(a.toLowerCase()))}))||[],S=async(s,i)=>{try{const{error:l}=await L.from("cars").update({is_available:!i}).eq("id",s);if(l)throw l;g(),y.success(`Car ${i?"disabled":"enabled"} successfully`)}catch(l){console.error("Error updating car:",l),y.error("Failed to update car status")}},b=s=>{v(s),m(!0)},_=()=>{g(),m(!1),v(null),y.success("Car updated successfully")};return f?e.jsx(F,{children:e.jsx(q,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load cars"})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(K,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search cars...",value:a,onChange:s=>o(s.target.value),className:"pl-8"})]})}),e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(W,{children:["Cars (",j.length,")"]})}),e.jsx(q,{children:w?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,i)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(D,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{className:"h-4 w-[200px]"}),e.jsx(D,{className:"h-4 w-[100px]"})]})]},i))}):e.jsxs(I,{children:[e.jsx(M,{children:e.jsxs(A,{children:[e.jsx(n,{children:"Vehicle"}),e.jsx(n,{children:"Owner"}),e.jsx(n,{children:"Location"}),e.jsx(n,{children:"Price/Day"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Added"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(O,{children:j.map(s=>{var i;return e.jsxs(A,{children:[e.jsxs(d,{className:"font-medium",children:[s.brand," ",s.model," (",s.year,")"]}),e.jsx(d,{children:((i=s.profiles)==null?void 0:i.full_name)||"Unknown"}),e.jsx(d,{children:s.location}),e.jsxs(d,{children:["P",s.price_per_day]}),e.jsx(d,{children:e.jsx(Q,{variant:s.is_available?"default":"secondary",children:s.is_available?"Available":"Disabled"})}),e.jsx(d,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>b(s),children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>S(s.id,s.is_available),children:s.is_available?e.jsx(ee,{className:"h-4 w-4 text-destructive"}):e.jsx($,{className:"h-4 w-4 text-green-600"})})]})})]},s.id)})})]})})]}),p&&e.jsx(se,{car:p,isOpen:u,onClose:()=>m(!1),onSuccess:_})]})},Se=()=>e.jsx(H,{children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Car Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage car listings, verification, and approval status"})]}),e.jsx(re,{})]})})});export{Se as default};

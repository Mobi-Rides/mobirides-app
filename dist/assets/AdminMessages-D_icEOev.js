import{j as e,u as b}from"./query-vendor-Bsfdn-Hb.js";import{T as M,a as T,b as f,c as a,d as A,e as t,A as L,f as S}from"./table-D5LMqpw8.js";import{r as F}from"./react-vendor-mnpoGfEl.js";import{an as k,I as B,n as q,B as p,y as E,s as m,J as i}from"./index-P3CM6KeI.js";import{C as g,d as w,a as R,b as D}from"./card-CfBwv9RV.js";import{S as o}from"./skeleton-B2cG361V.js";import{F as H}from"./flag-l2OHHwNP.js";import"./separator-BWndGHPr.js";import"./sheet-vE9wKzjl.js";import"./car-BJ1V2yVZ.js";import"./credit-card-Cb116MBj.js";import"./message-square-B-A4He7I.js";import"./house-CrWAd8rV.js";import"./settings-BI3euaaP.js";import"./log-out-D81onZQP.js";import"./useIsAdmin-DD5dRtCg.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";const z=()=>b({queryKey:["admin-messages"],queryFn:async()=>{const{data:c,error:l}=await m.from("messages").select(`
          id, content, created_at, status, sender_id, receiver_id, related_car_id,
          sender:profiles!sender_id (full_name),
          receiver:profiles!receiver_id (full_name),
          cars:related_car_id (brand, model)
        `).order("created_at",{ascending:!1}).limit(100);if(l)throw l;return c||[]}}),I=()=>{const[c,l]=F.useState(""),{data:d,isLoading:v,error:N,refetch:x}=z(),h=(d==null?void 0:d.filter(s=>{var r,n,u,j;return s.content.toLowerCase().includes(c.toLowerCase())||((n=(r=s.sender)==null?void 0:r.full_name)==null?void 0:n.toLowerCase().includes(c.toLowerCase()))||((j=(u=s.receiver)==null?void 0:u.full_name)==null?void 0:j.toLowerCase().includes(c.toLowerCase()))}))||[],y=s=>{switch(s){case"sent":return"default";case"read":return"secondary";case"flagged":return"destructive";default:return"outline"}},_=async s=>{try{const{error:r}=await m.from("messages").update({status:"read"}).eq("id",s);if(r)throw r;x(),i.success("Message flagged successfully")}catch(r){console.error("Error flagging message:",r),i.error("Failed to flag message")}},C=async s=>{if(confirm("Are you sure you want to delete this message?"))try{const{error:r}=await m.from("messages").delete().eq("id",s);if(r)throw r;x(),i.success("Message deleted successfully")}catch(r){console.error("Error deleting message:",r),i.error("Failed to delete message")}};return N?e.jsx(g,{children:e.jsx(w,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load messages"})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(k,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search messages...",value:c,onChange:s=>l(s.target.value),className:"pl-8"})]})}),e.jsxs(g,{children:[e.jsx(R,{children:e.jsxs(D,{children:["Messages (",h.length,")"]})}),e.jsx(w,{children:v?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,r)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(o,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"h-4 w-[200px]"}),e.jsx(o,{className:"h-4 w-[100px]"})]})]},r))}):e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(f,{children:[e.jsx(a,{children:"From"}),e.jsx(a,{children:"To"}),e.jsx(a,{children:"Message"}),e.jsx(a,{children:"Related Car"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(A,{children:h.map(s=>{var r,n;return e.jsxs(f,{children:[e.jsx(t,{className:"font-medium",children:((r=s.sender)==null?void 0:r.full_name)||"Unknown"}),e.jsx(t,{children:((n=s.receiver)==null?void 0:n.full_name)||"Unknown"}),e.jsx(t,{className:"max-w-xs",children:e.jsx("div",{className:"truncate",children:s.content})}),e.jsx(t,{children:s.cars?`${s.cars.brand} ${s.cars.model}`:"N/A"}),e.jsx(t,{children:e.jsx(q,{variant:y(s.status),children:s.status})}),e.jsx(t,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>_(s.id),disabled:s.status==="flagged",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>C(s.id),children:e.jsx(E,{className:"h-4 w-4 text-destructive"})})]})})]},s.id)})})]})})]})]})},ne=()=>e.jsx(L,{children:e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Message Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor platform communications and moderate content"})]}),e.jsx(I,{})]})})});export{ne as default};

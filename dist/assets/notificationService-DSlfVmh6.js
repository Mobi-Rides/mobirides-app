var l=Object.defineProperty;var f=(t,r,e)=>r in t?l(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e;var d=(t,r,e)=>f(t,typeof r!="symbol"?r+"":r,e);import{s as p}from"./index-BG7cKZ7G.js";import"./mapbox-vendor-fnXFVHMy.js";import"./query-vendor-C7aRRP05.js";import"./react-vendor-mnpoGfEl.js";import"./supabase-vendor-BOn0LdFJ.js";import"./date-vendor-Dhms5dOu.js";const o=class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}constructor(){console.log("üìß ResendEmailService initialized")}async sendEmail(r,e,s,c){try{const{data:n,error:i}=await p.functions.invoke("resend-service",{body:{to:r,subject:c,templateId:e,dynamicData:s,type:e}});return i?(console.error("Error sending email:",i),{success:!1,error:i.message}):n.error?(console.error("Error from resend-service function:",n.error),{success:!1,error:n.error}):{success:!0,messageId:n.id}}catch(n){return console.error("Unhandled error in sendEmail:",n),{success:!1,error:n instanceof Error?n.message:"An unknown error occurred"}}}getDefaultSubject(r){switch(r){case"booking-confirmation":return"Booking Confirmation - MobiRides";case"booking-request":return"New Booking Request - MobiRides";case"pickup-reminder":return"Pickup Reminder - MobiRides";case"return-reminder":return"Return Reminder - MobiRides";default:return"Notification from MobiRides"}}async sendBookingConfirmation(r,e,s=!1){if(!r.email)return{success:!1,error:"No email address provided"};const c={name:r.name,bookingReference:e.bookingReference,carBrand:e.carBrand,carModel:e.carModel,pickupDate:e.pickupDate,pickupTime:e.pickupTime,pickupLocation:e.pickupLocation,dropoffLocation:e.dropoffLocation,totalAmount:e.totalAmount,customerName:e.customerName,hostName:e.hostName,carImage:e.carImage||""},n=s?"ownerBookingNotification":"bookingConfirmation",i=s?`New Booking Request - ${e.carBrand} ${e.carModel}`:`Booking Confirmed - ${e.carBrand} ${e.carModel}`;return this.sendEmail(r.email,n,c,i)}async sendPickupReminder(r,e){if(!r.email)return{success:!1,error:"No email address provided"};const s={name:r.name,bookingReference:e.bookingReference,carBrand:e.carBrand,carModel:e.carModel,pickupDate:e.pickupDate,pickupTime:e.pickupTime,pickupLocation:e.pickupLocation};return this.sendEmail(r.email,"pickupReminder",s,`Pickup Reminder - ${e.carBrand} ${e.carModel}`)}async sendReturnReminder(r,e){if(!r.email)return{success:!1,error:"No email address provided"};const s={name:r.name,bookingReference:e.bookingReference,carBrand:e.carBrand,carModel:e.carModel,dropoffLocation:e.dropoffLocation};return this.sendEmail(r.email,"return-reminder",s,`Return Reminder - ${e.carBrand} ${e.carModel}`)}};d(o,"instance");let u=o;const a=class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}constructor(){console.log("üí¨ TwilioWhatsAppService initialized")}async sendWhatsApp(r,e,s){try{const{data:c,error:n}=await p.functions.invoke("send-whatsapp",{body:{to:r.startsWith("+")?r:`+${r}`,templateSid:e,variables:s}});if(n)throw n;return console.log(`‚úÖ WhatsApp sent successfully: ${c.messageId}`),{success:!0,messageId:c.messageId}}catch(c){return console.error("‚ùå WhatsApp sending failed:",c),{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}async sendBookingConfirmation(r,e,s=!1){if(!r.phone)return{success:!1,error:"No phone number provided"};const c=s?"BOOKING_REQUEST_TEMPLATE":"BOOKING_CONFIRMATION_TEMPLATE",n={1:r.name,2:e.bookingReference,3:`${e.carBrand} ${e.carModel}`,4:e.pickupDate,5:e.pickupTime,6:e.pickupLocation};return this.sendWhatsApp(r.phone,c,n)}async sendPickupReminder(r,e){if(!r.phone)return{success:!1,error:"No phone number provided"};const s={1:r.name,2:e.bookingReference,3:`${e.carBrand} ${e.carModel}`,4:e.pickupDate,5:e.pickupTime,6:e.pickupLocation};return this.sendWhatsApp(r.phone,"PICKUP_REMINDER_TEMPLATE",s)}async sendReturnReminder(r,e){if(!r.phone)return{success:!1,error:"No phone number provided"};const s={1:r.name,2:e.bookingReference,3:`${e.carBrand} ${e.carModel}`,4:e.dropoffLocation};return this.sendWhatsApp(r.phone,"RETURN_REMINDER_TEMPLATE",s)}};d(a,"instance");let m=a;u.getInstance();m.getInstance();export{u as ResendEmailService,m as TwilioWhatsAppService};

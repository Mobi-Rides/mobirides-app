import{a as Z,u as re,b as ie,j as t}from"./query-vendor-C7aRRP05.js";import{r as b,u as ae}from"./react-vendor-mnpoGfEl.js";import{c as ne,a9 as I,s as m,J as S,v as k,B as N,aw as W,K as ee,a1 as oe,a8 as ce,X as le,C as de,D as ue,ax as me,b as pe,d as _e,e as fe,f as z,I as he,ar as ge,as as ye,at as C,au as xe}from"./index-6IS4AKTX.js";import{N as U}from"./Navigation-BQmAR9Jk.js";import{C as ke,d as ve}from"./card-BUcHLe5F.js";import{N as x,n as P}from"./notificationHelpers-DZFPT44-.js";import{B as M}from"./bell-ClNaiYuo.js";import{M as O}from"./message-square-B0WUHuoz.js";import{C as be}from"./calendar-YxHZMy97.js";import{C as Ne}from"./credit-card-DzkL5K80.js";import{C as X}from"./car-2iUFJCfP.js";import{M as we}from"./map-pin-FLVtiGuW.js";import{W as je}from"./wallet-BbPQGA1b.js";import{f as $e}from"./date-vendor-Dhms5dOu.js";import{S as G}from"./switch-B8vlZbHE.js";import{S as q}from"./skeleton-CGpulx9Y.js";import{S as Ce}from"./settings-Bf-hPg48.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./user-BZvrovAH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ne("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Be=r=>{const{user:e}=I(),s=Z(),{includeExpired:i=!1,roleFilter:u}=r||{},{data:c=[],isLoading:d,error:p}=re({queryKey:["notifications",e==null?void 0:e.id],queryFn:async()=>{if(!(e!=null&&e.id))return[];let o=m.from("notifications").select(`
          *,
          bookings:related_booking_id (
            id,
            start_date,
            end_date,
            total_price,
            status,
            cars (
              id,
              brand,
              model,
              image_url
            )
          ),
          cars:related_car_id (
            id,
            brand,
            model,
            image_url
          )
        `).eq("user_id",e.id);i||(o=o.or("expires_at.is.null,expires_at.gt."+new Date().toISOString())),u&&u.length>0&&(o=o.in("role_target",u));const{data:n,error:f}=await o.order("created_at",{ascending:!1});if(f)throw f;return n||[]},enabled:!!(e!=null&&e.id)}),a=c.filter(o=>!o.is_read).length;return b.useEffect(()=>{if(!(e!=null&&e.id))return;const o=m.channel("notifications-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{s.invalidateQueries({queryKey:["notifications",e.id]})}).subscribe();return()=>{m.removeChannel(o)}},[e==null?void 0:e.id,s]),{notifications:c,unreadCount:a,isLoading:d,error:p,markAsRead:async o=>{const{error:n}=await m.from("notifications").update({is_read:!0}).eq("id",o);return n||s.invalidateQueries({queryKey:["notifications",e==null?void 0:e.id]}),{error:n}},markAllAsRead:async()=>{if(!(e!=null&&e.id))return{error:new Error("No user")};const{error:o}=await m.from("notifications").update({is_read:!0}).eq("user_id",e.id).eq("is_read",!1);return o||s.invalidateQueries({queryKey:["notifications",e.id]}),{error:o}},deleteNotification:async o=>{const{error:n}=await m.from("notifications").delete().eq("id",o);return n||s.invalidateQueries({queryKey:["notifications",e==null?void 0:e.id]}),{error:n}},cleanupExpiredNotifications:async()=>{if(!(e!=null&&e.id))return{error:new Error("No user")};try{const{error:o}=await m.rpc("cleanup_expired_notifications_enhanced");return o||s.invalidateQueries({queryKey:["notifications",e.id]}),{error:o}}catch(o){return{error:o}}},getNotificationsByRole:o=>c.filter(n=>n.role_target===o||n.role_target==="system_wide"),getUserRoleNotifications:async()=>{if(!(e!=null&&e.id))return[];const{data:o,error:n}=await m.from("profiles").select("role").eq("id",e.id).single();if(n||!o)return console.error("Error fetching user role:",n),c;const f=o.role;return c.filter(D=>{const v=D.role_target;return v==="system_wide"||v==="host_only"&&f==="host"||v==="renter_only"&&f==="renter"})}}};class Te{static async createBookingReminders(){try{const e=new Date,s=new Date(e);s.setDate(s.getDate()+1);const i=new Date(e);i.setHours(i.getHours()+2);const u=new Date(e);u.setMinutes(u.getMinutes()+30);const{data:c}=await m.from("bookings").select(`
          id,
          start_date,
          start_time,
          renter_id,
          cars (
            id,
            brand,
            model,
            owner_id
          )
        `).eq("status","confirmed").eq("start_date",s.toISOString().split("T")[0]).eq("preparation_reminder_sent",!1),{data:d}=await m.from("bookings").select(`
          id,
          start_date,
          start_time,
          renter_id,
          cars (
            id,
            brand,
            model,
            owner_id
          )
        `).eq("status","confirmed").eq("start_date",e.toISOString().split("T")[0]),{data:p}=await m.from("bookings").select(`
          id,
          start_date,
          start_time,
          renter_id,
          cars (
            id,
            brand,
            model,
            owner_id
          )
        `).eq("status","confirmed").eq("start_date",e.toISOString().split("T")[0]);if(c)for(const a of c){const _=`${a.cars.brand} ${a.cars.model}`;await m.from("notifications").insert({user_id:a.renter_id,type:"pickup_reminder_renter",title:"Pickup Reminder",description:`Your rental of ${_} starts tomorrow at ${a.start_time}. Please prepare for pickup.`,content:`Your rental of ${_} starts tomorrow at ${a.start_time}. Please prepare for pickup.`,related_booking_id:a.id,related_car_id:a.cars.id,role_target:"renter_only",metadata:{}}),await m.from("notifications").insert({user_id:a.cars.owner_id,type:"pickup_reminder_host",title:"Pickup Reminder",description:`Your ${_} rental starts tomorrow at ${a.start_time}. Please prepare for handover.`,content:`Your ${_} rental starts tomorrow at ${a.start_time}. Please prepare for handover.`,related_booking_id:a.id,related_car_id:a.cars.id,role_target:"host_only",metadata:{}}),await m.from("bookings").update({preparation_reminder_sent:!0}).eq("id",a.id)}if(d)for(const a of d){const g=(new Date(`${a.start_date}T${a.start_time}`).getTime()-e.getTime())/(1e3*60*60);if(g<=2.5&&g>=1.5){const h=`${a.cars.brand} ${a.cars.model}`;await m.from("notifications").insert({user_id:a.renter_id,type:"pickup_reminder_renter",title:"2 Hour Pickup Reminder",description:`Your rental of ${h} starts in 2 hours at ${a.start_time}. Time to head to pickup location!`,content:`Your rental of ${h} starts in 2 hours at ${a.start_time}. Time to head to pickup location!`,related_booking_id:a.id,related_car_id:a.cars.id,role_target:"renter_only",metadata:{}}),await m.from("notifications").insert({user_id:a.cars.owner_id,type:"pickup_reminder_host",title:"2 Hour Pickup Reminder",description:`Your ${h} handover is in 2 hours at ${a.start_time}. Please ensure the car is ready.`,content:`Your ${h} handover is in 2 hours at ${a.start_time}. Please ensure the car is ready.`,related_booking_id:a.id,related_car_id:a.cars.id,role_target:"host_only",metadata:{}})}}if(p)for(const a of p){const g=(new Date(`${a.start_date}T${a.start_time}`).getTime()-e.getTime())/(1e3*60);if(g<=35&&g>=25){const h=`${a.cars.brand} ${a.cars.model}`;await m.from("notifications").insert({user_id:a.renter_id,type:"pickup_reminder_renter",title:"30 Minute Pickup Reminder",description:`Your rental of ${h} starts in 30 minutes! Time for final preparations.`,content:`Your rental of ${h} starts in 30 minutes! Time for final preparations.`,related_booking_id:a.id,related_car_id:a.cars.id,role_target:"renter_only",metadata:{}}),await m.from("notifications").insert({user_id:a.cars.owner_id,type:"pickup_reminder_host",title:"30 Minute Pickup Reminder",description:`Your ${h} handover is in 30 minutes! Please be ready at the pickup location.`,content:`Your ${h} handover is in 30 minutes! Please be ready at the pickup location.`,related_booking_id:a.id,related_car_id:a.cars.id,role_target:"host_only",metadata:{}})}}}catch(e){console.error("Error creating booking reminders:",e)}}static async sendPostConfirmationGuidance(e,s){try{const{data:i}=await m.from("bookings").select(`
          id,
          start_date,
          start_time,
          renter_id,
          cars (
            id,
            brand,
            model,
            owner_id
          )
        `).eq("id",e).single();if(!i)return;const u=`${i.cars.brand} ${i.cars.model}`,c=`${i.start_date} at ${i.start_time}`;s==="host"?await m.from("notifications").insert({user_id:i.cars.owner_id,type:"booking_confirmed_host",title:"Booking Confirmed - Next Steps",description:`Booking confirmed! Next steps: 1) Prepare your ${u} for handover on ${c}. 2) Ensure fuel tank is full. 3) Clean the vehicle. 4) Be ready 15 minutes early.`,content:`Booking confirmed! Next steps: 1) Prepare your ${u} for handover on ${c}. 2) Ensure fuel tank is full. 3) Clean the vehicle. 4) Be ready 15 minutes early.`,related_booking_id:i.id,related_car_id:i.cars.id,role_target:"host_only",metadata:{}}):await m.from("notifications").insert({user_id:i.renter_id,type:"booking_confirmed_renter",title:"Booking Confirmed - Next Steps",description:`Booking confirmed! Next steps: 1) Prepare for pickup on ${c}. 2) Bring your driver's license. 3) Complete any required verification. 4) Arrive 15 minutes early.`,content:`Booking confirmed! Next steps: 1) Prepare for pickup on ${c}. 2) Bring your driver's license. 3) Complete any required verification. 4) Arrive 15 minutes early.`,related_booking_id:i.id,related_car_id:i.cars.id,role_target:"renter_only",metadata:{}})}catch(i){console.error("Error sending post-confirmation guidance:",i)}}}const Re=()=>{const r=Z(),{user:e}=I(),s=ie({mutationFn:async({bookingId:c,status:d})=>{const{error:p}=await m.from("bookings").update({status:d}).eq("id",c);if(p)throw p},onSuccess:(c,d)=>{const p=d.status==="confirmed"?"approved":"cancelled";S.success(`Booking ${p}`),d.status==="confirmed"&&e&&Te.sendPostConfirmationGuidance(d.bookingId,"host"),r.invalidateQueries({queryKey:["booking-request",d.bookingId]}),r.invalidateQueries({queryKey:["notifications"]}),r.invalidateQueries({queryKey:["bookings"]})},onError:c=>{S.error("Failed to update the booking status. Please try again.")}});return{acceptBooking:c=>{s.mutate({bookingId:c,status:"confirmed"})},declineBooking:c=>{s.mutate({bookingId:c,status:"cancelled"})},isLoading:s.status==="pending",error:s.error}};class H{static extractMetadata(e){const s=e.metadata||{},i=e.type;switch(!0){case this.isBookingType(i):return this.extractBookingMetadata(s);case this.isPaymentType(i):return this.extractPaymentMetadata(s);case this.isHandoverType(i):return this.extractHandoverMetadata(s);case this.isMessageType(i):return this.extractMessageMetadata(s);case this.isSystemType(i):return this.extractSystemMetadata(s);case this.isRentalType(i):return this.extractRentalMetadata(s);default:return s}}static getMetadataSummary(e){const s=this.extractMetadata(e),i=e.type;switch(!0){case this.isBookingType(i):return this.getBookingSummary(s);case this.isPaymentType(i):return this.getPaymentSummary(s);case this.isHandoverType(i):return this.getHandoverSummary(s);case this.isMessageType(i):return this.getMessageSummary(s);case this.isSystemType(i):return this.getSystemSummary(s);case this.isRentalType(i):return this.getRentalSummary(s);default:return[]}}static getActionButtons(e){const s=this.extractMetadata(e),i=e.type,u=[];switch(!0){case this.isBookingType(i):i==="booking_request_received"&&!e.is_read&&u.push({label:"Accept",action:"accept_booking",variant:"default",icon:"Check"},{label:"Decline",action:"decline_booking",variant:"outline",icon:"X"}),(s.booking_id||e.related_booking_id)&&u.push({label:"View Booking",action:"view_booking",variant:"outline",icon:"Eye"});break;case this.isPaymentType(i):u.push({label:"View Wallet",action:"view_wallet",variant:"outline",icon:"Wallet"}),(i.includes("failed")||i.includes("error"))&&u.push({label:"Retry Payment",action:"retry_payment",variant:"default",icon:"RefreshCw"});break;case this.isHandoverType(i):{const c=s;(c.status==="ready"||c.status==="in_progress")&&u.push({label:"View on Map",action:"view_map",variant:"default",icon:"MapPin"}),e.related_booking_id&&u.push({label:"View Booking",action:"view_booking",variant:"outline",icon:"Eye"});break}case this.isMessageType(i):u.push({label:"View Messages",action:"view_messages",variant:"default",icon:"MessageSquare"});break;case this.isRentalType(i):e.related_booking_id&&u.push({label:"View Rental",action:"view_rental",variant:"default",icon:"Car"});break}return u}static isBookingType(e){return e.includes("booking")||e.includes("request")||e.includes("confirmed")||e.includes("cancelled")}static isPaymentType(e){return e.includes("payment")||e.includes("wallet")||e.includes("topup")||e.includes("deduction")}static isHandoverType(e){return e.includes("handover")}static isMessageType(e){return e.includes("message")}static isSystemType(e){return e.includes("system")||e.includes("maintenance")}static isRentalType(e){return e.includes("rental")||e.includes("earnings")}static extractBookingMetadata(e){return{booking_id:e.booking_id,car_make:e.car_make,car_model:e.car_model,pickup_location:e.pickup_location,return_location:e.return_location,pickup_date:e.pickup_date,return_date:e.return_date,total_amount:e.total_amount,status:e.status,host_name:e.host_name,renter_name:e.renter_name}}static extractPaymentMetadata(e){return{amount:e.amount,currency:e.currency||"BWP",transaction_id:e.transaction_id,payment_method:e.payment_method,status:e.status,description:e.description,wallet_balance:e.wallet_balance}}static extractHandoverMetadata(e){return{handover_type:e.handover_type,car_make:e.car_make,car_model:e.car_model,location:e.location,status:e.status,step_name:e.step_name,progress_percentage:e.progress_percentage,estimated_time:e.estimated_time,other_party_name:e.other_party_name}}static extractMessageMetadata(e){return{sender_name:e.sender_name,conversation_id:e.conversation_id,message_preview:e.message_preview,message_type:e.message_type,attachment_count:e.attachment_count}}static extractSystemMetadata(e){return{system_event:e.system_event,severity:e.severity||"info",action_required:e.action_required,maintenance_window:e.maintenance_window}}static extractRentalMetadata(e){return{rental_id:e.rental_id,car_make:e.car_make,car_model:e.car_model,current_location:e.current_location,status:e.status,earnings:e.earnings,duration:e.duration}}static getBookingSummary(e){const s=[];return e.car_make&&e.car_model&&s.push(`Vehicle: ${e.car_make} ${e.car_model}`),e.pickup_location&&s.push(`Pickup: ${e.pickup_location}`),e.pickup_date&&s.push(`Date: ${new Date(e.pickup_date).toLocaleDateString()}`),e.total_amount&&s.push(`Amount: BWP ${e.total_amount.toFixed(2)}`),s}static getPaymentSummary(e){const s=[];return e.amount&&s.push(`Amount: ${e.currency||"BWP"} ${e.amount.toFixed(2)}`),e.payment_method&&s.push(`Method: ${e.payment_method}`),e.status&&s.push(`Status: ${e.status}`),e.wallet_balance!==void 0&&s.push(`Balance: BWP ${e.wallet_balance.toFixed(2)}`),s}static getHandoverSummary(e){const s=[];return e.car_make&&e.car_model&&s.push(`Vehicle: ${e.car_make} ${e.car_model}`),e.location&&s.push(`Location: ${e.location}`),e.status&&s.push(`Status: ${e.status.replace("_"," ").toUpperCase()}`),e.progress_percentage!==void 0&&s.push(`Progress: ${e.progress_percentage}%`),e.step_name&&s.push(`Current Step: ${e.step_name}`),s}static getMessageSummary(e){const s=[];return e.sender_name&&s.push(`From: ${e.sender_name}`),e.message_preview&&s.push(`Preview: ${e.message_preview}`),e.attachment_count&&e.attachment_count>0&&s.push(`Attachments: ${e.attachment_count}`),s}static getSystemSummary(e){const s=[];return e.severity&&s.push(`Severity: ${e.severity.toUpperCase()}`),e.action_required&&s.push("Action Required"),e.maintenance_window&&s.push(`Maintenance: ${e.maintenance_window}`),s}static getRentalSummary(e){const s=[];return e.car_make&&e.car_model&&s.push(`Vehicle: ${e.car_make} ${e.car_model}`),e.earnings&&s.push(`Earnings: BWP ${e.earnings.toFixed(2)}`),e.duration&&s.push(`Duration: ${e.duration}`),e.status&&s.push(`Status: ${e.status}`),s}}function Pe(r){return{summary:H.getMetadataSummary(r),actions:H.getActionButtons(r),metadata:H.extractMetadata(r)}}function J({notification:r,onMarkAsRead:e,onDelete:s,onAcceptBooking:i,onDeclineBooking:u,compact:c=!1}){const d=ae(),p=x.classifyNotification(r),{summary:a,actions:_}=Pe(r),w=()=>{switch(p.type){case"booking":return t.jsx(X,{className:"h-5 w-5"});case"payment":return t.jsx(Ne,{className:"h-5 w-5"});case"handover":return t.jsx(be,{className:"h-5 w-5"});case"message":return t.jsx(O,{className:"h-5 w-5"});default:return t.jsx(M,{className:"h-5 w-5"})}},g=()=>{switch(p.type){case"booking":return r.type.includes("booking_confirmed")?"text-green-600":r.type.includes("booking_cancelled")?"text-red-600":"text-blue-600";case"payment":return"text-emerald-600";case"handover":return"text-orange-600";case"message":return"text-purple-600";default:return"text-gray-600"}},h=()=>{switch(p.type){case"booking":return r.type.includes("booking_confirmed")?"default":r.type.includes("booking_cancelled")?"destructive":"secondary";case"payment":return"default";case"handover":return"secondary";case"message":return"outline";default:return"outline"}},B=()=>{!r.is_read&&e&&e(r.id),x.isHandoverNotification(r)?r.related_booking_id?d(`/map?booking=${r.related_booking_id}&handover=true`):d("/map"):x.isActiveRentalNotification(r)?r.related_booking_id?d(`/rental-details/${r.related_booking_id}`):d(`/notifications/${r.id}`):p.type==="booking"&&r.related_booking_id?d(`/bookings/${r.related_booking_id}`):p.type==="payment"||x.isPaymentNotification(r)?d("/wallet"):x.isMessageNotification(r)?d("/messages"):d(`/notifications/${r.id}`)},j=n=>{switch(n){case"accept_booking":i&&r.related_booking_id&&i(r.related_booking_id);break;case"decline_booking":u&&r.related_booking_id&&u(r.related_booking_id);break;case"view_booking":r.related_booking_id&&d(`/bookings/${r.related_booking_id}`);break;case"view_wallet":d("/wallet");break;case"view_messages":d("/messages");break;case"view_map":r.related_booking_id?d(`/map?booking=${r.related_booking_id}&handover=true`):d("/map");break;case"view_rental":r.related_booking_id&&d(`/rental-details/${r.related_booking_id}`);break;case"retry_payment":d("/wallet");break}},o=n=>{switch(n){case"Check":return t.jsx(de,{className:"h-4 w-4"});case"X":return t.jsx(le,{className:"h-4 w-4"});case"Eye":return t.jsx(W,{className:"h-4 w-4"});case"Wallet":return t.jsx(je,{className:"h-4 w-4"});case"RefreshCw":return t.jsx(ce,{className:"h-4 w-4"});case"MapPin":return t.jsx(we,{className:"h-4 w-4"});case"MessageSquare":return t.jsx(O,{className:"h-4 w-4"});case"Car":return t.jsx(X,{className:"h-4 w-4"});default:return null}};return t.jsx(ke,{className:`
        transition-all duration-200 hover:shadow-md cursor-pointer
        ${r.is_read?"hover:bg-muted/50":"border-primary/50 bg-primary/5"}
        ${c?"p-3":""}
      `,onClick:B,children:t.jsx(ve,{className:c?"p-0":"p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:`mt-1 ${g()}`,children:w()}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:`text-sm ${r.is_read?"font-medium":"font-semibold"}`,children:r.title}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.description}),a.length>0&&t.jsx("div",{className:"mt-2 space-y-1",children:a.map((n,f)=>t.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[t.jsx("span",{className:"w-1 h-1 bg-muted-foreground rounded-full"}),n]},f))}),a.length===0&&r.bookings&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[r.bookings.brand," ",r.bookings.model]})]}),t.jsxs("div",{className:"flex flex-col items-end gap-1",children:[t.jsx(k,{variant:h(),className:"text-xs",children:p.type}),t.jsx("span",{className:"text-xs text-muted-foreground",children:$e(new Date(r.created_at),{addSuffix:!0})})]})]}),!c&&t.jsxs("div",{className:"space-y-2 mt-3",onClick:n=>n.stopPropagation(),children:[_.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:_.slice(0,2).map((n,f)=>t.jsxs(N,{size:"sm",variant:n.variant||"outline",onClick:()=>j(n.action),className:"flex-1 min-w-0",children:[n.icon&&o(n.icon),n.icon&&t.jsx("span",{className:"ml-1"}),n.label]},f))}),_.length>2&&t.jsx("div",{className:"flex flex-wrap gap-2",children:_.slice(2).map((n,f)=>t.jsxs(N,{size:"sm",variant:"ghost",onClick:()=>j(n.action),className:"flex-1 min-w-0",children:[n.icon&&o(n.icon),n.icon&&t.jsx("span",{className:"ml-1"}),n.label]},f+2))}),(_.length===0||!_.some(n=>n.action==="mark_as_read")&&!_.some(n=>n.action==="delete"))&&t.jsxs("div",{className:"flex items-center gap-2",children:[!r.is_read&&e&&!_.some(n=>n.action==="mark_as_read")&&t.jsxs(N,{size:"sm",variant:"ghost",onClick:()=>e(r.id),children:[t.jsx(W,{className:"h-4 w-4 mr-1"}),"Mark as read"]}),s&&!_.some(n=>n.action==="delete")&&t.jsxs(N,{size:"sm",variant:"ghost",onClick:()=>s(r.id),children:[t.jsx(ee,{className:"h-4 w-4 mr-1"}),"Delete"]}),t.jsx("div",{className:"flex-1"}),t.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]})]})]})]})})})}const et=()=>{const{user:r}=I(),[e,s]=b.useState(!1),[i,u]=b.useState(!1),{notifications:c,unreadCount:d,isLoading:p,markAsRead:a,markAllAsRead:_,deleteNotification:w,cleanupExpiredNotifications:g,getUserRoleNotifications:h}=Be({includeExpired:e}),{acceptBooking:B,declineBooking:j}=Re(),[o,n]=b.useState(""),[f,D]=b.useState("all"),[v,Y]=b.useState(c);b.useEffect(()=>{(async()=>{if(i){const y=await h();Y(y)}else Y(c)})()},[i,c,h]);const A=v.filter(l=>{const y=P(l),T=`${y.title||""} ${y.description||""}`.toLowerCase();return o&&!T.includes(o.toLowerCase())?!1:f==="all"?!0:f==="active_rentals"?x.isActiveRentalNotification(y):x.classifyNotification(y).type===f}),E=A.filter(l=>!l.is_read),F=A.filter(l=>l.is_read),Q=async l=>{await a(l)},V=async l=>{await w(l)},te=async()=>{await _()},K=async l=>{await B(l)},L=async l=>{await j(l)},se=async()=>{try{const{error:l}=await g();l?S.error("Failed to cleanup expired notifications"):S.success("Expired notifications cleaned up successfully")}catch{S.error("Failed to cleanup expired notifications")}},$=(()=>{const l={all:v.length,booking:0,payment:0,active_rentals:0,system:0};return v.forEach(y=>{const T=P(y),R=x.classifyNotification(T);R.type==="booking"&&l.booking++,R.type==="payment"&&l.payment++,R.type==="system"&&l.system++,x.isActiveRentalNotification(T)&&l.active_rentals++}),l})();return p?t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(q,{className:"h-8 w-32"}),t.jsx(q,{className:"h-8 w-8 rounded-full"})]}),t.jsx(q,{className:"h-10 w-full"}),t.jsx("div",{className:"space-y-3",children:[...Array(5)].map((l,y)=>t.jsx(q,{className:"h-20 w-full"},y))})]}),t.jsx(U,{})]}):t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(M,{className:"h-6 w-6 text-primary"}),t.jsx("h1",{className:"text-2xl font-bold",children:"Notifications"}),d>0&&t.jsx(k,{variant:"destructive",className:"ml-2",children:d})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(ue,{children:[t.jsx(me,{asChild:!0,children:t.jsx(N,{variant:"outline",size:"sm",children:t.jsx(Ce,{className:"h-4 w-4"})})}),t.jsxs(pe,{children:[t.jsx(_e,{children:t.jsx(fe,{children:"Notification Settings"})}),t.jsx("div",{className:"p-4 space-y-6",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsx(z,{htmlFor:"include-expired",children:"Include Expired Notifications"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Show notifications that have passed their expiration date"})]}),t.jsx(G,{id:"include-expired",checked:e,onCheckedChange:s})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsx(z,{htmlFor:"role-filter",children:"Role-Based Filtering"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Only show notifications relevant to your role"})]}),t.jsx(G,{id:"role-filter",checked:i,onCheckedChange:u})]}),t.jsx("div",{className:"pt-4 border-t",children:t.jsxs(N,{onClick:se,variant:"outline",className:"w-full",disabled:p,children:[t.jsx(ee,{className:"h-4 w-4 mr-2"}),"Cleanup Expired Notifications"]})})]})})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[i&&t.jsxs(k,{variant:"outline",className:"text-xs",children:[t.jsx(Se,{className:"h-3 w-3 mr-1"}),"Role Filtered"]}),d>0&&t.jsx(N,{onClick:te,variant:"outline",size:"sm",children:"Mark all read"})]})]})]}),t.jsx("div",{className:"mb-4",children:t.jsx(he,{placeholder:"Search notifications...",value:o,onChange:l=>n(l.target.value),className:"w-full"})}),t.jsxs(ge,{value:f,onValueChange:D,className:"w-full mb-6",children:[t.jsxs(ye,{className:"grid w-full grid-cols-5",children:[t.jsxs(C,{value:"all",className:"flex items-center gap-2",children:["All",t.jsx(k,{variant:"secondary",className:"text-xs",children:$.all})]}),t.jsxs(C,{value:"booking",className:"flex items-center gap-2",children:["Bookings",t.jsx(k,{variant:"secondary",className:"text-xs",children:$.booking})]}),t.jsxs(C,{value:"payment",className:"flex items-center gap-2",children:["Payments",t.jsx(k,{variant:"secondary",className:"text-xs",children:$.payment})]}),t.jsxs(C,{value:"active_rentals",className:"flex items-center gap-2",children:["Rentals",t.jsx(k,{variant:"secondary",className:"text-xs",children:$.active_rentals})]}),t.jsxs(C,{value:"system",className:"flex items-center gap-2",children:["System",t.jsx(k,{variant:"secondary",className:"text-xs",children:$.system})]})]}),t.jsx(xe,{value:f,className:"mt-4",children:t.jsxs("div",{className:"space-y-4",children:[E.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("h3",{className:"text-sm font-medium text-muted-foreground",children:["Unread (",E.length,")"]}),E.map(l=>t.jsx(J,{notification:P(l),onMarkAsRead:Q,onDelete:V,onAcceptBooking:K,onDeclineBooking:L},`unread-${l.id}`))]}),F.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("h3",{className:"text-sm font-medium text-muted-foreground",children:["Read (",F.length,")"]}),F.map(l=>t.jsx(J,{notification:P(l),onMarkAsRead:Q,onDelete:V,onAcceptBooking:K,onDeclineBooking:L},`read-${l.id}`))]}),A.length===0&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(M,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"No notifications found"}),t.jsx("p",{className:"text-muted-foreground",children:o?"Try adjusting your search terms":f==="all"?"You're all caught up!":`No ${f} notifications found`})]})]})})]})]}),t.jsx(U,{})]})};export{et as default};

import{u as fe,j as e}from"./query-vendor-BOSMW7hd.js";import{k as We,f as we,r as m,u as z}from"./react-vendor-DmU5vXC9.js";import{a as Xe,J as k,s as h,B as b,q as le,n as _e,D as Ne,b as ye,d as ve,e as Ee,m as be,f as D,g as ee,h as se,x as Ce,aj as ke,ak as qe,af as Qe,a9 as Ze,aa as Re,al as es,ad as ue,ae as De,am as ss,ac as oe,an as ts,ah as rs,_ as Pe,ao as as,I as ns,H as is,K as W,M as X,N as Q,y as os}from"./index-ahmQo-Zq.js";import{N as me}from"./Navigation-DgaHbxsQ.js";import{c as cs,d as te,e as Te,a as q,p as I}from"./date-vendor-Dhms5dOu.js";import{K as ds,a as ls,C as us}from"./CarDescription-wjhxBLle.js";import{C as ms}from"./circle-help-uwQ3t1Gu.js";import{C as V}from"./circle-alert-C0uJq2nf.js";import{C as ge,c as hs}from"./availabilityService-D7WpCdEl.js";import{C as P}from"./clock-gtBamCUv.js";import{C as O,a as $,b as U,d as F,e as xs,c as ps}from"./card-D4VTtfVn.js";import{C as fs}from"./car-DSCKC0BN.js";import{M as re}from"./map-pin-BTmNqwoj.js";import{C as gs}from"./calendar-CpXOYIBo.js";import{S as ae}from"./separator-DIiRVttn.js";import{C as js}from"./credit-card-CbH_oHMB.js";import{C as ws}from"./calendar-D_cFmEe6.js";import{C as _s}from"./calculator-DGRxrETi.js";import{u as Ns}from"./index-CEVvJeOa.js";import{P as ce}from"./pen-line-DXVxA4-c.js";import{S as ys}from"./star-Cl6daLIe.js";import{U as vs}from"./user-7MMf2PMh.js";import{S as Y}from"./skeleton-DFMY7FuM.js";import{A as Es,e as bs,a as Cs,b as ks,c as qs,f as Rs,d as Ds,g as Ps,h as Ts}from"./alert-dialog-B2yKyWKy.js";import{C as je}from"./circle-check-big-uJiWdFVJ.js";import{C as As}from"./circle-x-DrZUKwvs.js";import{R as Ss}from"./receipt-_h3HklV_.js";import"./supabase-vendor-B3A6ooRR.js";import"./mapbox-vendor-ueN8uhVJ.js";import"./bell-D3eElkfC.js";import"./chevron-left-Dh8Ads5x.js";var de=(r=>(r.PICKUP="pickup",r.RETURN="return",r))(de||{});const Is=()=>{var pe;const{id:r}=We(),s=we().search.includes("print=true"),[a,t]=m.useState(!1),{data:i,isLoading:o}=fe({queryKey:["rental-details",r],queryFn:async()=>{console.log("Fetching rental details for ID:",r);const{data:C,error:L}=await h.from("bookings").select(`
          *,
          renter:profiles!renter_id (
            id,
            full_name,
            avatar_url
          ),
          car:cars (
            *,
            owner:profiles!owner_id (
              id,
              full_name,
              avatar_url
            )
          ),
          handover_sessions (
            id,
            handover_completed,
            created_at,
            handover_step_completion (
              step_name,
              is_completed,
              step_order
            )
          )
        `).eq("id",r).single();if(L)throw L;return C}}),{data:l,isLoading:c}=fe({queryKey:["current-user"],queryFn:async()=>{const{data:{user:C}}=await h.auth.getUser();return C}});m.useEffect(()=>{if(s&&i&&!o){const C=setTimeout(()=>{window.print()},500);return()=>clearTimeout(C)}},[s,i,o]);const u=i&&l&&i.renter_id===l.id,x=i&&l&&i.car.owner_id===l.id,p=((i==null?void 0:i.handover_sessions)||[]).sort((C,L)=>new Date(C.created_at).getTime()-new Date(L.created_at).getTime()),j=p.find(C=>{const L=C.handover_step_completion||[],ze=L.length>0&&L.every(Je=>Je.is_completed);return C.handover_completed||ze}),d=p.length>1?p[1]:null,f=d&&(d.handover_completed||((pe=d.handover_step_completion)==null?void 0:pe.length)>0&&d.handover_step_completion.every(C=>C.is_completed)),w=new Date,E=i?new Date(i.start_date):null,R=i?new Date(i.end_date):null,G=i&&cs(w,{start:new Date(i.start_date),end:te(new Date(i.end_date),1)}),M=i&&i.status==="confirmed"&&!j&&E&&w>=E,T=i&&i.status==="confirmed"&&j&&!f&&G,S=i&&i.status==="confirmed"&&j&&!f&&R&&w>=R,v=i&&(i.status==="completed"||f),ie=T,J=v;E&&w.getDate()===E.getDate()&&w.getMonth()===E.getMonth()&&(w.getFullYear(),E.getFullYear()),R&&w.getDate()===R.getDate()&&w.getMonth()===R.getMonth()&&(w.getFullYear(),R.getFullYear());const H=M,_=(T||S)&&!f,A=H||_,K=H?de.PICKUP:de.RETURN,Ye=i?Te(new Date(i.end_date),new Date(i.start_date))+1:0;return{booking:i,isBookingLoading:o,isUserLoading:c,currentUser:l,isRenter:u,isOwner:x,isActiveRental:ie,isCompletedRental:J,isPendingPickup:M,isInProgress:T,isPendingReturn:S,isCompleted:v,canHandover:A,canInitiatePickup:H,canInitiateReturn:_,handoverType:K,rentalDurationDays:Ye,isInitiatingHandover:a,handleInitiateHandover:async()=>{if(!i||!l)return null;t(!0);try{return await Xe(i.id,i.car.owner_id,i.renter_id)}catch(C){return console.error("Error initiating handover:",C),k.error("Failed to initiate handover process"),null}finally{t(!1)}},id:r}},Ms=({status:r,onBack:n})=>{const s=()=>{let a="outline",t=e.jsx(ms,{className:"h-3 w-3 mr-1"});switch(r){case"confirmed":a="success",t=e.jsx(ge,{className:"h-3 w-3 mr-1"});break;case"pending":a="warning",t=e.jsx(P,{className:"h-3 w-3 mr-1"});break;case"completed":a="default",t=e.jsx(ge,{className:"h-3 w-3 mr-1"});break;case"cancelled":a="destructive",t=e.jsx(V,{className:"h-3 w-3 mr-1"});break}return e.jsxs(_e,{variant:a,className:"flex items-center",children:[t,e.jsx("span",{className:"capitalize",children:r})]})};return e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(b,{variant:"ghost",onClick:n,children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Back"]}),s()]})},Ls=({car:r})=>{const n=z();return e.jsxs(O,{className:"overflow-hidden border-border shadow-sm",children:[e.jsx($,{className:"p-4 bg-muted/30",children:e.jsxs(U,{className:"flex items-center gap-2 text-lg",children:[e.jsx(fs,{className:"h-5 w-5 text-primary"}),"Vehicle Information"]})}),e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("img",{src:r.image_url||"/placeholder.svg",alt:`${r.brand} ${r.model}`,className:"w-full sm:w-32 h-32 sm:h-24 object-cover rounded-lg"}),e.jsxs("div",{className:"flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[r.brand," ",r.model," (",r.year,")"]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground mt-1",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:r.location})]})]}),e.jsxs("p",{className:"text-lg font-medium mt-2",children:["BWP ",r.price_per_day," per day"]})]})]})}),e.jsx(xs,{className:"p-4 bg-muted/10 border-t",children:e.jsx(b,{variant:"outline",size:"sm",onClick:()=>n(`/car/${r.id}`),className:"text-xs",children:"View Vehicle Details"})})]})},Os=({startDate:r,endDate:n,durationDays:s})=>e.jsxs(O,{className:"dark:bg-gray-800 dark:border-gray-700",children:[e.jsx($,{className:"pb-2",children:e.jsxs(U,{className:"text-lg flex items-center gap-2 dark:text-white",children:[e.jsx(gs,{className:"h-5 w-5 text-primary dark:text-primary-foreground"}),"Rental Duration"]})}),e.jsxs(F,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"font-medium",children:q(new Date(r),"PPP")})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"font-medium",children:q(new Date(n),"PPP")})]})]}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground mr-2"}),e.jsxs("span",{className:"text-sm",children:[s," day",s!==1?"s":""]})]})]})]}),Fs=({pricePerDay:r,durationDays:n,totalPrice:s})=>e.jsxs(O,{className:"dark:bg-gray-800 dark:border-gray-700",children:[e.jsx($,{className:"pb-2",children:e.jsxs(U,{className:"text-lg flex items-center gap-2 dark:text-white",children:[e.jsx(js,{className:"h-5 w-5 text-primary dark:text-primary-foreground"}),"Payment Details"]})}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Daily Rate"}),e.jsxs("p",{children:["BWP ",r]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{children:"Duration"}),e.jsxs("p",{children:[n," day",n!==1?"s":""]})]}),e.jsx(ae,{}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("p",{children:"Total"}),e.jsxs("p",{children:["BWP ",s]})]})]})]});var y=(r=>(r.PENDING="pending",r.APPROVED="approved",r.REJECTED="rejected",r.CANCELLED="cancelled",r))(y||{});class ne{static async calculateExtension(n,s){try{const{data:a,error:t}=await h.from("bookings").select(`
          id,
          end_date,
          car_id,
          cars (
            price_per_day
          )
        `).eq("id",n).single();if(t||!a)throw new Error("Booking not found");const i=I(a.end_date),o=Te(s,i);if(o<=0)return{additionalDays:0,pricePerDay:a.cars.price_per_day,additionalCost:0,totalNewCost:0,available:!1};const l=await hs(a.car_id,te(i,1),s,n),c=o*a.cars.price_per_day,{data:u}=await h.from("bookings").select("total_price").eq("id",n).single(),x=((u==null?void 0:u.total_price)||0)+c;return{additionalDays:o,pricePerDay:a.cars.price_per_day,additionalCost:c,totalNewCost:x,available:l}}catch(a){throw console.error("Error calculating extension:",a),a}}static async requestExtension(n,s){try{const{data:{user:a},error:t}=await h.auth.getUser();if(t||!a)throw new Error("User not authenticated");const i=await this.calculateExtension(n,s.newEndDate);if(!i.available)throw new Error("Car is not available for the requested extension period");const{data:o}=await h.from("bookings").select("end_date, cars(owner_id, brand, model)").eq("id",n).single();if(!o)throw new Error("Booking not found");const{data:l,error:c}=await h.from("rental_extension_requests").insert({booking_id:n,current_end_date:o.end_date,requested_end_date:q(s.newEndDate,"yyyy-MM-dd"),additional_days:i.additionalDays,additional_cost:i.additionalCost,reason:s.reason,status:y.PENDING,requested_by:a.id,requested_at:new Date().toISOString()}).select().single();if(c)throw c;return await h.from("notifications").insert({user_id:o.cars.owner_id,type:"booking_request",content:`Extension requested for ${o.cars.brand} ${o.cars.model} - ${i.additionalDays} additional days for P${i.additionalCost.toFixed(2)}`,related_booking_id:n}),k.success("Extension request submitted successfully!"),l}catch(a){throw console.error("Error requesting extension:",a),k.error(a instanceof Error?a.message:"Failed to request extension"),a}}static async handleExtensionApproval(n){try{const{data:{user:s},error:a}=await h.auth.getUser();if(a||!s)throw new Error("User not authenticated");const{data:t,error:i}=await h.from("rental_extension_requests").select(`
          *,
          bookings (
            id,
            renter_id,
            total_price,
            cars (
              brand,
              model,
              owner_id
            )
          )
        `).eq("id",n.extensionId).single();if(i||!t)throw new Error("Extension request not found");if(t.bookings.cars.owner_id!==s.id)throw new Error("Not authorized to approve this extension");const o=n.approved?y.APPROVED:y.REJECTED,{error:l}=await h.from("rental_extension_requests").update({status:o,approved_by:s.id,approved_at:new Date().toISOString(),rejected_reason:n.rejectionReason}).eq("id",n.extensionId);if(l)throw l;if(n.approved){const{error:c}=await h.from("bookings").update({end_date:t.requested_end_date,total_price:t.bookings.total_price+t.additional_cost}).eq("id",t.booking_id);c&&console.error("Error updating booking:",c),await h.from("notifications").insert({user_id:t.bookings.renter_id,type:"booking_confirmed",content:`Your extension request has been approved! Your ${t.bookings.cars.brand} ${t.bookings.cars.model} rental has been extended until ${q(I(t.requested_end_date),"MMM dd, yyyy")}`,related_booking_id:t.booking_id}),k.success("Extension request approved!")}else await h.from("notifications").insert({user_id:t.bookings.renter_id,type:"booking_cancelled",content:`Your extension request has been declined. ${n.rejectionReason||"No reason provided."}`,related_booking_id:t.booking_id}),k.success("Extension request rejected.");return!0}catch(s){return console.error("Error handling extension approval:",s),k.error(s instanceof Error?s.message:"Failed to process extension request"),!1}}static async getPendingExtensions(n){try{const{data:s,error:a}=await h.from("rental_extension_requests").select(`
          *,
          bookings (
            id,
            start_date,
            renter_id,
            cars!inner (
              owner_id,
              brand,
              model
            ),
            renter:profiles!bookings_renter_id_fkey (
              full_name,
              avatar_url
            )
          )
        `).eq("bookings.cars.owner_id",n).eq("status",y.PENDING).order("requested_at",{ascending:!1});if(a)throw a;return s||[]}catch(s){return console.error("Error fetching pending extensions:",s),[]}}static async getBookingExtensions(n){try{const{data:s,error:a}=await h.from("rental_extension_requests").select("*").eq("booking_id",n).order("requested_at",{ascending:!1});if(a)throw a;return s||[]}catch(s){return console.error("Error fetching booking extensions:",s),[]}}static async cancelExtensionRequest(n){try{const{data:{user:s},error:a}=await h.auth.getUser();if(a||!s)throw new Error("User not authenticated");const{data:t,error:i}=await h.from("rental_extension_requests").select("requested_by, status").eq("id",n).single();if(i||!t)throw new Error("Extension request not found");if(t.requested_by!==s.id)throw new Error("Not authorized to cancel this extension request");if(t.status!==y.PENDING)throw new Error("Can only cancel pending extension requests");const{error:o}=await h.from("rental_extension_requests").update({status:y.CANCELLED}).eq("id",n);if(o)throw o;return k.success("Extension request cancelled"),!0}catch(s){return console.error("Error cancelling extension request:",s),k.error(s instanceof Error?s.message:"Failed to cancel extension request"),!1}}}const Gs=({isOpen:r,onClose:n,booking:s,onExtensionRequested:a})=>{const[t,i]=m.useState(),[o,l]=m.useState(""),[c,u]=m.useState(null),[x,g]=m.useState(!1),[p,j]=m.useState(!1),[d,f]=m.useState(null),w=I(s.end_date),E=te(w,1),R=te(w,30);m.useEffect(()=>{t&&r&&G()},[t,r]);const G=async()=>{if(t){g(!0),f(null);try{const v=await ne.calculateExtension(s.id,t);u(v),v.available||f("The car is not available for the selected extension period. Please choose different dates.")}catch(v){console.error("Error calculating extension:",v),f("Failed to calculate extension cost. Please try again."),u(null)}finally{g(!1)}}},M=async()=>{if(!(!t||!c||!c.available)){j(!0),f(null);try{const v={newEndDate:t,reason:o.trim()||void 0};await ne.requestExtension(s.id,v),a(),n(),T()}catch(v){console.error("Error submitting extension request:",v),f(v instanceof Error?v.message:"Failed to submit extension request")}finally{j(!1)}}},T=()=>{i(void 0),l(""),u(null),f(null)},S=()=>{T(),n()};return e.jsx(Ne,{open:r,onOpenChange:S,children:e.jsxs(ye,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Extend Rental Period"]}),e.jsxs(be,{children:["Request to extend your rental of ",s.cars.brand," ",s.cars.model]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Current Rental"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Current End Date: ",q(w,"PPP")]}),e.jsxs("p",{children:["Price per Day: P",s.cars.price_per_day.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"extension-date",children:"Select New End Date"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(ws,{mode:"single",selected:t,onSelect:i,disabled:v=>v<E||v>R,className:"rounded-md border"})}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"You can extend up to 30 days from your current end date"})]}),t&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(ae,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("h4",{className:"font-medium",children:"Extension Cost"})]}),x?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-sm",children:"Calculating..."})]}):c?e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Additional Days:"}),e.jsxs("span",{className:"font-medium",children:[c.additionalDays," days"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Price per Day:"}),e.jsxs("span",{children:["P",c.pricePerDay.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Additional Cost:"}),e.jsxs("span",{className:"font-medium",children:["P",c.additionalCost.toFixed(2)]})]}),e.jsx(ae,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"New Total Cost:"}),e.jsxs("span",{className:"text-lg",children:["P",c.totalNewCost.toFixed(2)]})]})]}):null]}),d&&e.jsxs(ee,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(se,{children:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"reason",children:"Reason for Extension (Optional)"}),e.jsx(Ce,{id:"reason",placeholder:"Tell the host why you need to extend your rental...",value:o,onChange:v=>l(v.target.value),className:"min-h-[80px]",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o.length,"/500 characters"]})]})]}),e.jsxs(ke,{children:[e.jsx(b,{variant:"outline",onClick:S,disabled:p,children:"Cancel"}),e.jsx(b,{onClick:M,disabled:!t||!c||!c.available||x||p,className:"min-w-[120px]",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"Request Extension"})]})]})})};var he="Radio",[Hs,Ae]=Re(he),[Bs,Vs]=Hs(he),Se=m.forwardRef((r,n)=>{const{__scopeRadio:s,name:a,checked:t=!1,required:i,disabled:o,value:l="on",onCheck:c,form:u,...x}=r,[g,p]=m.useState(null),j=De(n,w=>p(w)),d=m.useRef(!1),f=g?u||!!g.closest("form"):!0;return e.jsxs(Bs,{scope:s,checked:t,disabled:o,children:[e.jsx(ue.button,{type:"button",role:"radio","aria-checked":t,"data-state":Le(t),"data-disabled":o?"":void 0,disabled:o,value:l,...x,ref:j,onClick:oe(r.onClick,w=>{t||c==null||c(),f&&(d.current=w.isPropagationStopped(),d.current||w.stopPropagation())})}),f&&e.jsx($s,{control:g,bubbles:!d.current,name:a,value:l,checked:t,required:i,disabled:o,form:u,style:{transform:"translateX(-100%)"}})]})});Se.displayName=he;var Ie="RadioIndicator",Me=m.forwardRef((r,n)=>{const{__scopeRadio:s,forceMount:a,...t}=r,i=Vs(Ie,s);return e.jsx(ts,{present:a||i.checked,children:e.jsx(ue.span,{"data-state":Le(i.checked),"data-disabled":i.disabled?"":void 0,...t,ref:n})})});Me.displayName=Ie;var $s=r=>{const{control:n,checked:s,bubbles:a=!0,...t}=r,i=m.useRef(null),o=Ns(s),l=rs(n);return m.useEffect(()=>{const c=i.current,u=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(u,"checked").set;if(o!==s&&g){const p=new Event("click",{bubbles:a});g.call(c,s),c.dispatchEvent(p)}},[o,s,a]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:s,...t,tabIndex:-1,ref:i,style:{...r.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Le(r){return r?"checked":"unchecked"}var Us=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],xe="RadioGroup",[Ks,Mt]=Re(xe,[qe,Ae]),Oe=qe(),Fe=Ae(),[Ys,zs]=Ks(xe),Ge=m.forwardRef((r,n)=>{const{__scopeRadioGroup:s,name:a,defaultValue:t,value:i,required:o=!1,disabled:l=!1,orientation:c,dir:u,loop:x=!0,onValueChange:g,...p}=r,j=Oe(s),d=Qe(u),[f,w]=Ze({prop:i,defaultProp:t,onChange:g});return e.jsx(Ys,{scope:s,name:a,required:o,disabled:l,value:f,onValueChange:w,children:e.jsx(es,{asChild:!0,...j,orientation:c,dir:d,loop:x,children:e.jsx(ue.div,{role:"radiogroup","aria-required":o,"aria-orientation":c,"data-disabled":l?"":void 0,dir:d,...p,ref:n})})})});Ge.displayName=xe;var He="RadioGroupItem",Be=m.forwardRef((r,n)=>{const{__scopeRadioGroup:s,disabled:a,...t}=r,i=zs(He,s),o=i.disabled||a,l=Oe(s),c=Fe(s),u=m.useRef(null),x=De(n,u),g=i.value===t.value,p=m.useRef(!1);return m.useEffect(()=>{const j=f=>{Us.includes(f.key)&&(p.current=!0)},d=()=>p.current=!1;return document.addEventListener("keydown",j),document.addEventListener("keyup",d),()=>{document.removeEventListener("keydown",j),document.removeEventListener("keyup",d)}},[]),e.jsx(ss,{asChild:!0,...l,focusable:!o,active:g,children:e.jsx(Se,{disabled:o,required:i.required,checked:g,...c,...t,name:i.name,ref:x,onCheck:()=>i.onValueChange(t.value),onKeyDown:oe(j=>{j.key==="Enter"&&j.preventDefault()}),onFocus:oe(t.onFocus,()=>{var j;p.current&&((j=u.current)==null||j.click())})})})});Be.displayName=He;var Js="RadioGroupIndicator",Ve=m.forwardRef((r,n)=>{const{__scopeRadioGroup:s,...a}=r,t=Fe(s);return e.jsx(Me,{...t,...a,ref:n})});Ve.displayName=Js;var $e=Ge,Ue=Be,Ws=Ve;const Ke=m.forwardRef(({className:r,...n},s)=>e.jsx($e,{className:Pe("grid gap-2",r),...n,ref:s}));Ke.displayName=$e.displayName;const Z=m.forwardRef(({className:r,...n},s)=>e.jsx(Ue,{ref:s,className:Pe("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...n,children:e.jsx(Ws,{className:"flex items-center justify-center",children:e.jsx(as,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Z.displayName=Ue.displayName;var N=(r=>(r.TIME_CHANGE="time_change",r.LOCATION_CHANGE="location_change",r.BOTH="both",r))(N||{}),B=(r=>(r.PENDING="pending",r.APPROVED="approved",r.REJECTED="rejected",r.CANCELLED="cancelled",r))(B||{});class Xs{static async validateTimeChange(n,s,a){try{const{data:t,error:i}=await h.from("bookings").select("start_date, end_date, start_time, end_time, car_id").eq("id",n).single();if(i||!t)return{isValid:!1,message:"Booking not found"};if(!s&&!a)return{isValid:!1,message:"At least one time must be changed"};const o=t.start_time||"09:00",l=t.end_time||"17:00",c=s||o,u=a||l,x=parseInt(c.split(":")[0]),g=parseInt(u.split(":")[0]);if(g<=x)return{isValid:!1,message:"End time must be after start time"};const p=g-x;return p<2?{isValid:!1,message:"Minimum rental duration is 2 hours"}:p>12?{isValid:!1,message:"Maximum rental duration is 12 hours per day"}:x<6||x>22||g<6||g>22?{isValid:!1,message:"Pickup and return times must be between 6:00 AM and 10:00 PM"}:{isValid:!0}}catch(t){return console.error("Error validating time change:",t),{isValid:!1,message:"Error validating time change"}}}static validateLocationChange(n,s){const t=(s.latitude-n.latitude)*Math.PI/180,i=(s.longitude-n.longitude)*Math.PI/180,o=Math.sin(t/2)*Math.sin(t/2)+Math.cos(n.latitude*Math.PI/180)*Math.cos(s.latitude*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2),c=6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))),u=50;return c>u?{isValid:!1,message:`New location is ${c.toFixed(1)}km away. Maximum allowed distance is ${u}km`,distanceFromOriginal:c,isReasonableDistance:!1}:{isValid:!0,distanceFromOriginal:c,isReasonableDistance:c<=10}}static async requestModification(n,s){var a,t,i;try{const{data:{user:o},error:l}=await h.auth.getUser();if(l||!o)throw new Error("User not authenticated");const{data:c,error:u}=await h.from("bookings").select(`
          start_time,
          end_time,
          latitude,
          longitude,
          cars (
            owner_id,
            brand,
            model
          )
        `).eq("id",n).single();if(u||!c)throw new Error("Booking not found");if(s.modificationType===N.TIME_CHANGE||s.modificationType===N.BOTH){const f=await this.validateTimeChange(n,s.newStartTime,s.newEndTime);if(!f.isValid)throw new Error(f.message)}if(s.modificationType===N.LOCATION_CHANGE||s.modificationType===N.BOTH){if(!s.newLocation)throw new Error("New location is required for location change");const f=this.validateLocationChange({latitude:c.latitude||0,longitude:c.longitude||0},s.newLocation);if(!f.isValid)throw new Error(f.message)}const x={booking_id:n,modification_type:s.modificationType,original_start_time:c.start_time,original_end_time:c.end_time,requested_start_time:s.newStartTime,requested_end_time:s.newEndTime,original_pickup_latitude:c.latitude,original_pickup_longitude:c.longitude,requested_pickup_latitude:(a=s.newLocation)==null?void 0:a.latitude,requested_pickup_longitude:(t=s.newLocation)==null?void 0:t.longitude,requested_pickup_address:(i=s.newLocation)==null?void 0:i.address,reason:s.reason,status:B.PENDING,requested_by:o.id,requested_at:new Date().toISOString()},{data:g,error:p}=await h.from("booking_modification_requests").insert(x).select().single();if(p)throw p;const j=s.modificationType;let d=`Modification requested for ${c.cars.brand} ${c.cars.model}`;return j===N.TIME_CHANGE?d+=" - Time change requested":j===N.LOCATION_CHANGE?d+=" - Pickup location change requested":d+=" - Time and location change requested",await h.from("notifications").insert({user_id:c.cars.owner_id,type:"booking_request",content:d,related_booking_id:n}),k.success("Modification request submitted successfully!"),g}catch(o){throw console.error("Error requesting modification:",o),k.error(o instanceof Error?o.message:"Failed to request modification"),o}}static async handleModificationApproval(n){try{const{data:{user:s},error:a}=await h.auth.getUser();if(a||!s)throw new Error("User not authenticated");const{data:t,error:i}=await h.from("booking_modification_requests").select(`
          *,
          bookings (
            id,
            renter_id,
            cars (
              brand,
              model,
              owner_id
            )
          )
        `).eq("id",n.modificationId).single();if(i||!t)throw new Error("Modification request not found");if(t.bookings.cars.owner_id!==s.id)throw new Error("Not authorized to approve this modification");const o=n.approved?B.APPROVED:B.REJECTED,{error:l}=await h.from("booking_modification_requests").update({status:o,approved_by:s.id,approved_at:new Date().toISOString(),rejected_reason:n.rejectionReason}).eq("id",n.modificationId);if(l)throw l;if(n.approved){const c={};if(t.requested_start_time&&(c.start_time=t.requested_start_time),t.requested_end_time&&(c.end_time=t.requested_end_time),t.requested_pickup_latitude&&(c.latitude=t.requested_pickup_latitude),t.requested_pickup_longitude&&(c.longitude=t.requested_pickup_longitude),Object.keys(c).length>0){const{error:u}=await h.from("bookings").update(c).eq("id",t.booking_id);u&&console.error("Error updating booking:",u)}await h.from("notifications").insert({user_id:t.bookings.renter_id,type:"booking_confirmed",content:`Your modification request has been approved for ${t.bookings.cars.brand} ${t.bookings.cars.model}!`,related_booking_id:t.booking_id}),k.success("Modification request approved!")}else await h.from("notifications").insert({user_id:t.bookings.renter_id,type:"booking_cancelled",content:`Your modification request has been declined. ${n.rejectionReason||"No reason provided."}`,related_booking_id:t.booking_id}),k.success("Modification request rejected.");return!0}catch(s){return console.error("Error handling modification approval:",s),k.error(s instanceof Error?s.message:"Failed to process modification request"),!1}}static async getBookingModifications(n){try{const{data:s,error:a}=await h.from("booking_modification_requests").select("*").eq("booking_id",n).order("requested_at",{ascending:!1});if(a)throw a;return s||[]}catch(s){return console.error("Error fetching booking modifications:",s),[]}}static async cancelModificationRequest(n){try{const{data:{user:s},error:a}=await h.auth.getUser();if(a||!s)throw new Error("User not authenticated");const{data:t,error:i}=await h.from("booking_modification_requests").select("requested_by, status").eq("id",n).single();if(i||!t)throw new Error("Modification request not found");if(t.requested_by!==s.id)throw new Error("Not authorized to cancel this modification request");if(t.status!==B.PENDING)throw new Error("Can only cancel pending modification requests");const{error:o}=await h.from("booking_modification_requests").update({status:B.CANCELLED}).eq("id",n);if(o)throw o;return k.success("Modification request cancelled"),!0}catch(s){return console.error("Error cancelling modification request:",s),k.error(s instanceof Error?s.message:"Failed to cancel modification request"),!1}}}const Qs=({isOpen:r,onClose:n,booking:s,onModificationRequested:a})=>{var J,H;const[t,i]=m.useState(N.TIME_CHANGE),[o,l]=m.useState(""),[c,u]=m.useState(""),[x,g]=m.useState({address:"",latitude:0,longitude:0}),[p,j]=m.useState(""),[d,f]=m.useState(!1),[w,E]=m.useState(null);m.useEffect(()=>{r&&(i(N.TIME_CHANGE),l(s.start_time||""),u(s.end_time||""),g({address:"",latitude:s.pickup_latitude||0,longitude:s.pickup_longitude||0}),j(""),E(null))},[r,s]);const R=async()=>{f(!0),E(null);try{const _={modificationType:t,reason:p.trim()||void 0};if((t===N.TIME_CHANGE||t===N.BOTH)&&(o!==s.start_time&&(_.newStartTime=o),c!==s.end_time&&(_.newEndTime=c)),t===N.LOCATION_CHANGE||t===N.BOTH)if(x.address.trim())_.newLocation={latitude:x.latitude,longitude:x.longitude,address:x.address.trim()};else throw new Error("Please provide a new pickup location");await Xs.requestModification(s.id,_),a(),n(),G()}catch(_){console.error("Error submitting modification request:",_),E(_ instanceof Error?_.message:"Failed to submit modification request")}finally{f(!1)}},G=()=>{i(N.TIME_CHANGE),l(""),u(""),g({address:"",latitude:0,longitude:0}),j(""),E(null)},M=()=>{G(),n()},T=()=>{const _=[];for(let A=6;A<=22;A++){const K=`${A.toString().padStart(2,"0")}:00`;_.push(e.jsx("option",{value:K,children:q(new Date(`2000-01-01T${K}`),"h:mm a")},K))}return _},S=()=>{if(t===N.LOCATION_CHANGE)return!0;const _=s.start_time||"09:00",A=s.end_time||"17:00";return o!==_||c!==A},v=()=>t===N.TIME_CHANGE?!0:x.address.trim().length>0,ie=()=>t===N.TIME_CHANGE?S():t===N.LOCATION_CHANGE?v():S()||v();return e.jsx(Ne,{open:r,onOpenChange:M,children:e.jsxs(ye,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Modify Booking"]}),e.jsxs(be,{children:["Request changes to your booking for ",s.cars.brand," ",s.cars.model]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Current Booking Details"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Date: ",q(I(s.start_date),"PPP")]}),e.jsxs("p",{children:["Time: ",q(new Date(`2000-01-01T${s.start_time||"09:00"}`),"h:mm a")," - ",q(new Date(`2000-01-01T${s.end_time||"17:00"}`),"h:mm a")]}),s.pickup_latitude&&s.pickup_longitude&&e.jsxs("p",{children:["Pickup: ",(J=s.pickup_latitude)==null?void 0:J.toFixed(6),", ",(H=s.pickup_longitude)==null?void 0:H.toFixed(6)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{children:"What would you like to change?"}),e.jsxs(Ke,{value:t,onValueChange:_=>i(_),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{value:N.TIME_CHANGE,id:"time"}),e.jsxs(D,{htmlFor:"time",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(P,{className:"h-4 w-4"}),"Pickup/Return Time"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{value:N.LOCATION_CHANGE,id:"location"}),e.jsxs(D,{htmlFor:"location",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(re,{className:"h-4 w-4"}),"Pickup Location"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{value:N.BOTH,id:"both"}),e.jsxs(D,{htmlFor:"both",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ce,{className:"h-4 w-4"}),"Both Time and Location"]})]})]})]}),e.jsx(ae,{}),(t===N.TIME_CHANGE||t===N.BOTH)&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"New Times"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"start-time",children:"Pickup Time"}),e.jsx("select",{id:"start-time",value:o,onChange:_=>l(_.target.value),className:"w-full p-2 border rounded-md",children:T()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"end-time",children:"Return Time"}),e.jsx("select",{id:"end-time",value:c,onChange:_=>u(_.target.value),className:"w-full p-2 border rounded-md",children:T()})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Available times: 6:00 AM - 10:00 PM • Minimum 2 hours • Maximum 12 hours per day"})]}),(t===N.LOCATION_CHANGE||t===N.BOTH)&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"New Pickup Location"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"location-address",children:"Address"}),e.jsx(ns,{id:"location-address",placeholder:"Enter new pickup address...",value:x.address,onChange:_=>g(A=>({...A,address:_.target.value}))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum 50km from original location. Please provide a detailed address."})]})]}),w&&e.jsxs(ee,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(se,{children:w})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"reason",children:"Reason for Modification (Optional)"}),e.jsx(Ce,{id:"reason",placeholder:"Explain why you need to make this change...",value:p,onChange:_=>j(_.target.value),className:"min-h-[80px]",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500",children:[p.length,"/500 characters"]})]})]}),e.jsxs(ke,{children:[e.jsx(b,{variant:"outline",onClick:M,disabled:d,children:"Cancel"}),e.jsx(b,{onClick:R,disabled:!ie()||d,className:"min-w-[140px]",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"Request Modification"})]})]})})},Zs=({bookingId:r,booking:n,canHandover:s,handoverType:a,isInitiatingHandover:t,isCompletedRental:i,isActiveRental:o,isRenter:l,onHandoverInitiate:c,onExtensionRequested:u})=>{const x=z(),[g,p]=m.useState(!1),[j,d]=m.useState(!1),f=()=>{p(!0)},w=()=>{d(!0)},E=()=>{u==null||u()},R=()=>{u==null||u()};return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-end pt-4",children:[e.jsxs(is,{children:[i&&e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(b,{className:"w-full sm:w-auto flex items-center gap-2",onClick:()=>x(`/rental-review/${r}`),children:[e.jsx(ys,{className:"h-4 w-4"}),"Write Review"]})}),e.jsx(Q,{children:e.jsx("p",{children:"Share your experience with this vehicle"})})]}),o&&l&&e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(b,{className:"w-full sm:w-auto flex items-center gap-2",variant:"outline",onClick:f,children:[e.jsx(P,{className:"h-4 w-4"}),"Extend Rental"]})}),e.jsx(Q,{children:e.jsx("p",{children:"Request to extend your rental period"})})]}),(o||n.status==="confirmed")&&l&&e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(b,{className:"w-full sm:w-auto flex items-center gap-2",variant:"outline",onClick:w,children:[e.jsx(ce,{className:"h-4 w-4"}),"Modify Booking"]})}),e.jsx(Q,{children:e.jsx("p",{children:"Change pickup time or location"})})]}),s&&e.jsxs(b,{className:"w-full sm:w-auto flex items-center gap-2",variant:"default",onClick:c,disabled:t,children:[e.jsx(ds,{className:"h-4 w-4"}),t?"Initiating...":`Initiate ${a==="pickup"?"Pickup":"Return"}`]}),o&&!s&&e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(b,{className:"w-full sm:w-auto flex items-center gap-2",variant:"outline",onClick:()=>x(`/map?handover=true&bookingId=${r}&role=${l?"renter":"host"}`),children:[e.jsx(re,{className:"h-4 w-4"}),"View Handover Status"]})}),e.jsx(Q,{children:e.jsx("p",{children:"See the real-time status of your car handover"})})]})]}),e.jsx(Gs,{isOpen:g,onClose:()=>p(!1),booking:n,onExtensionRequested:E}),e.jsx(Qs,{isOpen:j,onClose:()=>d(!1),booking:n,onModificationRequested:R})]})},et=({user:r,role:n})=>e.jsxs(O,{className:"dark:bg-gray-800 dark:border-gray-700",children:[e.jsx($,{className:"pb-2",children:e.jsxs(U,{className:"text-lg flex items-center gap-2 dark:text-white",children:[e.jsx(vs,{className:"h-5 w-5 text-primary dark:text-primary-foreground"}),n]})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:r.avatar_url?h.storage.from("avatars").getPublicUrl(r.avatar_url).data.publicUrl:"/placeholder.svg",alt:r.full_name||n,className:"w-12 h-12 rounded-full object-cover bg-muted"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:r.full_name||n}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Vehicle ",n]})]})]})})]}),st=()=>{const r=z();return e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(b,{variant:"ghost",onClick:()=>r(-1),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsx(Y,{className:"h-8 w-48 ml-4"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{className:"h-64 w-full rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Y,{className:"h-48 w-full rounded-lg"}),e.jsx(Y,{className:"h-48 w-full rounded-lg"})]}),e.jsx(Y,{className:"h-48 w-full rounded-lg"})]}),e.jsx(me,{})]})},tt=()=>{const r=z();return e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[e.jsxs(b,{variant:"ghost",className:"mb-6",onClick:()=>r(-1),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Back"]}),e.jsx(O,{children:e.jsx(F,{className:"py-10",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center space-y-3",children:[e.jsx(V,{className:"h-10 w-10 text-muted-foreground"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Rental details not found"}),e.jsx("p",{className:"text-muted-foreground",children:"The rental information you're looking for could not be found."}),e.jsx(b,{onClick:()=>r("/bookings"),children:"View All Bookings"})]})})}),e.jsx(me,{})]})},rt=({bookingId:r,isRenter:n,onExtensionUpdate:s})=>{const[a,t]=m.useState([]),[i,o]=m.useState(!0),[l,c]=m.useState(null);m.useEffect(()=>{u()},[r]);const u=async()=>{o(!0);try{const d=await ne.getBookingExtensions(r);t(d)}catch(d){console.error("Error loading extensions:",d)}finally{o(!1)}},x=async d=>{c(d);try{await ne.cancelExtensionRequest(d)&&(await u(),s==null||s())}catch(f){console.error("Error cancelling extension:",f)}finally{c(null)}},g=d=>{switch(d){case y.PENDING:return e.jsx(P,{className:"h-4 w-4"});case y.APPROVED:return e.jsx(je,{className:"h-4 w-4"});case y.REJECTED:return e.jsx(As,{className:"h-4 w-4"});case y.CANCELLED:return e.jsx(V,{className:"h-4 w-4"});default:return e.jsx(P,{className:"h-4 w-4"})}},p=d=>{switch(d){case y.PENDING:return"secondary";case y.APPROVED:return"default";case y.REJECTED:return"destructive";case y.CANCELLED:return"outline";default:return"secondary"}},j=d=>{switch(d){case y.PENDING:return"Pending Approval";case y.APPROVED:return"Approved";case y.REJECTED:return"Rejected";case y.CANCELLED:return"Cancelled";default:return d}};return i?e.jsxs(O,{children:[e.jsx($,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Extension Requests"]})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Loading..."})]})})]}):a.length===0?null:e.jsxs(O,{children:[e.jsxs($,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Extension Requests"]}),e.jsx(ps,{children:a.length===1?"1 extension request":`${a.length} extension requests`})]}),e.jsx(F,{className:"space-y-4",children:a.map(d=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_e,{variant:p(d.status),className:"flex items-center gap-1",children:[g(d.status),j(d.status)]}),e.jsx("span",{className:"text-sm text-gray-500",children:q(I(d.requested_at),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Current End:"}),e.jsx("p",{className:"font-medium",children:q(I(d.current_end_date),"PPP")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Requested End:"}),e.jsx("p",{className:"font-medium",children:q(I(d.requested_end_date),"PPP")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Additional Days:"}),e.jsxs("p",{className:"font-medium",children:[d.additional_days," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Additional Cost:"}),e.jsxs("p",{className:"font-medium",children:["P",d.additional_cost.toFixed(2)]})]})]}),d.reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Reason:"}),e.jsx("p",{className:"text-sm bg-gray-50 p-2 rounded mt-1",children:d.reason})]}),d.status===y.REJECTED&&d.rejected_reason&&e.jsxs(ee,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsxs(se,{children:[e.jsx("strong",{children:"Rejection Reason:"})," ",d.rejected_reason]})]}),d.status===y.APPROVED&&d.approved_at&&e.jsxs(ee,{children:[e.jsx(je,{className:"h-4 w-4"}),e.jsxs(se,{children:["Approved on ",q(I(d.approved_at),"PPP"),". Your rental period has been extended successfully."]})]}),n&&d.status===y.PENDING&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(Es,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(b,{variant:"outline",size:"sm",className:"flex items-center gap-2",disabled:l===d.id,children:l===d.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-gray-600"}),"Cancelling..."]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"h-3 w-3"}),"Cancel Request"]})})}),e.jsxs(Cs,{children:[e.jsxs(ks,{children:[e.jsx(qs,{children:"Cancel Extension Request"}),e.jsx(Rs,{children:"Are you sure you want to cancel this extension request? This action cannot be undone."})]}),e.jsxs(Ds,{children:[e.jsx(Ps,{children:"Keep Request"}),e.jsx(Ts,{onClick:()=>x(d.id),className:"bg-red-600 hover:bg-red-700",children:"Cancel Request"})]})]})]})})]},d.id))})]})},Lt=()=>{const r=z();we();const[n,s]=m.useState(0),{booking:a,isBookingLoading:t,isUserLoading:i,isRenter:o,isActiveRental:l,isCompletedRental:c,canHandover:u,handoverType:x,rentalDurationDays:g,isInitiatingHandover:p,handleInitiateHandover:j}=Is(),d=()=>{s(w=>w+1)},f=async()=>{if(await j()){const E=o?"renter":"host";r(`/map?bookingId=${a.id}&mode=handover&role=${E}`)}};return t||i?e.jsx(st,{}):a?e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20 animate-fade-in",children:[e.jsx(Ms,{status:a.status,onBack:()=>r(-1)}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Rental Details"}),c&&e.jsxs(b,{variant:"outline",size:"sm",className:"mt-2 sm:mt-0 flex items-center gap-2",onClick:()=>window.print(),children:[e.jsx(Ss,{className:"h-4 w-4"}),"Download Receipt"]})]}),e.jsx(Ls,{car:a.car}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o?e.jsx(ls,{ownerName:a.car.owner.full_name,avatarUrl:a.car.owner.avatar_url,ownerId:a.car.owner.id}):e.jsx(et,{user:a.renter,role:"Renter"}),e.jsx(Os,{startDate:a.start_date,endDate:a.end_date,durationDays:g})]}),e.jsx(us,{description:a.car.description}),e.jsx(Fs,{pricePerDay:a.car.price_per_day,durationDays:g,totalPrice:a.total_price}),e.jsx(rt,{bookingId:a.id,isRenter:o,onExtensionUpdate:d}),e.jsx(Zs,{bookingId:a.id,booking:a,canHandover:u,handoverType:x,isInitiatingHandover:p,isCompletedRental:c,isActiveRental:l,isRenter:o,onHandoverInitiate:f,onExtensionRequested:d})]}),e.jsx(me,{})]}):e.jsx(tt,{})};export{Lt as default};

import{j as e,a as le,u as ne}from"./query-vendor-BOSMW7hd.js";import{u as ee,r as x}from"./react-vendor-DmU5vXC9.js";import{i as ce,j as ie,k as de,B as p,a0 as oe,n as b,l as me,s as B,q as ue,a7 as xe,I as pe,a2 as he,a3 as ge,a4 as T,a5 as E}from"./index-ByqmTec-.js";import{C as ve,N as fe}from"./Navigation-fdodg-AN.js";import{S as O,a as X,b as G,c as J,d as u}from"./select-qP77FLvJ.js";import{C as q,d as se,a as je,b as Ne}from"./card-Dn1_7TKZ.js";import{C as we}from"./checkbox-D4Yx9lnD.js";import{M as Ce}from"./map-pin-B-9tSSOy.js";import{C as ye}from"./calendar-Cn2gPQb0.js";import{D as te}from"./dollar-sign-BxxqWD8M.js";import{C as ae}from"./circle-check-big-BdHHmxBu.js";import{C as _e}from"./circle-x-B9MBqLgQ.js";import{R as Se}from"./receipt-ByYkD0_m.js";import{e as Re,a as Y}from"./date-vendor-Dhms5dOu.js";import{C as De}from"./car-front-8yOBD_bb.js";import{C as Be}from"./clock-Dg92kA5o.js";import{T as be}from"./trending-up-CXNUhyI7.js";import{D as Z}from"./download-DURrII-i.js";import"./supabase-vendor-B3A6ooRR.js";import"./mapbox-vendor-ueN8uhVJ.js";import"./bell-sR4KUoYm.js";import"./user-CrwdbYLY.js";import"./index-CEVvJeOa.js";import"./chevron-down-CR2ALfoj.js";const F=({booking:a,isSelected:i,onSelect:f,onAction:n})=>{var A,j,$,g,c;const w=ee(),[d,C]=x.useState(null),h=async v=>{C(v),await n(a.id,v),C(null)},y=v=>{const R={pending:{label:"Pending",variant:"secondary",color:"bg-orange-100 text-orange-800"},confirmed:{label:"Confirmed",variant:"default",color:"bg-green-100 text-green-800"},completed:{label:"Completed",variant:"default",color:"bg-blue-100 text-blue-800"},cancelled:{label:"Cancelled",variant:"destructive",color:"bg-red-100 text-red-800"},expired:{label:"Expired",variant:"outline",color:"bg-gray-100 text-gray-800"}},_=R[v]||R.pending;return e.jsx(b,{variant:_.variant,className:`${_.color} animate-fade-in`,children:_.label})},m=Re(new Date(a.end_date),new Date(a.start_date))+1,S=a.total_price*(1-.15);return e.jsx(q,{className:"hover:shadow-lg transition-all duration-200 animate-fade-in",children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[a.status==="pending"&&e.jsx(we,{checked:i,onCheckedChange:f,className:"mt-1"}),e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:a.cars.image_url||"/placeholder.svg",alt:`${a.cars.brand} ${a.cars.model}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h3",{className:"font-semibold text-lg leading-tight",children:[a.cars.brand," ",a.cars.model]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Ce,{className:"h-3 w-3"}),a.cars.location]})]}),y(a.status)]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-muted/50 rounded-lg",children:[e.jsxs(ce,{className:"h-8 w-8",children:[e.jsx(ie,{src:(A=a.renter)==null?void 0:A.avatar_url}),e.jsx(de,{children:(($=(j=a.renter)==null?void 0:j.full_name)==null?void 0:$.charAt(0))||"R"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:((g=a.renter)==null?void 0:g.full_name)||"Unknown Renter"}),((c=a.renter)==null?void 0:c.phone_number)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a.renter.phone_number})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ye,{className:"h-3 w-3"}),e.jsx("span",{children:"Duration"})]}),e.jsxs("p",{className:"font-medium",children:[Y(new Date(a.start_date),"MMM dd")," - ",Y(new Date(a.end_date),"MMM dd")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m," days"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(te,{className:"h-3 w-3"}),e.jsx("span",{children:"Earnings"})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"font-bold text-primary text-base",children:["BWP ",S.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["BWP ",a.total_price.toFixed(2)," total"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{size:"sm",onClick:()=>h("approve"),disabled:d==="approve",className:"flex-1 sm:flex-none animate-scale-in",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"}),d==="approve"?"Approving...":"Approve"]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>h("decline"),disabled:d==="decline",className:"flex-1 sm:flex-none",children:[e.jsx(_e,{className:"h-3 w-3 mr-1"}),d==="decline"?"Declining...":"Decline"]})]}),a.status==="confirmed"&&e.jsx(p,{size:"sm",variant:"outline",onClick:()=>h("cancel"),disabled:d==="cancel",className:"hover-scale",children:d==="cancel"?"Cancelling...":"Cancel"}),a.status==="completed"&&e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>w(`/rental-details/${a.id}?print=true`),className:"hover-scale",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),"Receipt"]}),e.jsxs(p,{size:"sm",variant:"ghost",onClick:()=>w(`/rental-details/${a.id}`),className:"hover-scale",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"Message"]})]})]})]})})})},Ae=({bookings:a})=>{const i=x.useMemo(()=>{if(!a)return{totalBookings:0,activeRentals:0,pendingRequests:0,completedRentals:0,totalRevenue:0,netRevenue:0};const n=new Date,w=.15,d=a.filter(l=>l.status==="confirmed"&&new Date(l.start_date)<=n&&new Date(l.end_date)>=n).length,C=a.filter(l=>l.status==="pending").length,h=a.filter(l=>l.status==="completed"||l.status==="confirmed"&&new Date(l.end_date)<n).length,y=a.filter(l=>l.status==="completed"||l.status==="confirmed").reduce((l,S)=>l+S.total_price,0),m=y*(1-w);return{totalBookings:a.length,activeRentals:d,pendingRequests:C,completedRentals:h,totalRevenue:y,netRevenue:m}},[a]),f=[{title:"Total Bookings",value:i.totalBookings,icon:De,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Active Rentals",value:i.activeRentals,icon:ve,color:"text-green-600",bgColor:"bg-green-100"},{title:"Pending Requests",value:i.pendingRequests,icon:Be,color:"text-orange-600",bgColor:"bg-orange-100"},{title:"Completed",value:i.completedRentals,icon:ae,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Total Revenue",value:`BWP ${i.totalRevenue.toFixed(2)}`,icon:te,color:"text-emerald-600",bgColor:"bg-emerald-100"},{title:"Net Earnings",value:`BWP ${i.netRevenue.toFixed(2)}`,icon:be,color:"text-primary",bgColor:"bg-primary/10"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:f.map(n=>e.jsxs(q,{className:"hover:shadow-md transition-shadow animate-fade-in",children:[e.jsxs(je,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ne,{className:"text-sm font-medium text-muted-foreground",children:n.title}),e.jsx("div",{className:`p-2 rounded-full ${n.bgColor}`,children:e.jsx(n.icon,{className:`h-4 w-4 ${n.color}`})})]}),e.jsx(se,{children:e.jsx("div",{className:`text-2xl font-bold ${n.color}`,children:n.value})})]},n.title))})},ss=()=>{var M,L,z,P,k,I,H,Q,V,U,W,K;const a=ee(),{toast:i}=me(),f=le(),[n,w]=x.useState(""),[d,C]=x.useState("all"),[h,y]=x.useState("date_desc"),[m,l]=x.useState([]),[S,A]=x.useState("active"),{data:j,isLoading:$}=ne({queryKey:["host-bookings"],queryFn:async()=>{const{data:{user:s}}=await B.auth.getUser();if(!s)throw new Error("No user found");const{data:t,error:r}=await B.from("cars").select("id").eq("owner_id",s.id);if(r)throw r;if(!t.length)return[];const o=t.map(re=>re.id),{data:N,error:D}=await B.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            location,
            image_url,
            owner_id,
            price_per_day
          ),
          renter:profiles!renter_id (
            full_name,
            avatar_url,
            phone_number
          )
        `).in("car_id",o).order("created_at",{ascending:!1});if(D)throw D;return N}}),g=x.useMemo(()=>{if(!j)return[];let s=j.filter(t=>{var N,D;const r=n===""||t.cars.brand.toLowerCase().includes(n.toLowerCase())||t.cars.model.toLowerCase().includes(n.toLowerCase())||((D=(N=t.renter)==null?void 0:N.full_name)==null?void 0:D.toLowerCase().includes(n.toLowerCase()))||t.cars.location.toLowerCase().includes(n.toLowerCase()),o=d==="all"||t.status===d;return r&&o});return s.sort((t,r)=>{var o,N;switch(h){case"date_asc":return new Date(t.start_date).getTime()-new Date(r.start_date).getTime();case"date_desc":return new Date(r.start_date).getTime()-new Date(t.start_date).getTime();case"earnings_asc":return t.total_price-r.total_price;case"earnings_desc":return r.total_price-t.total_price;case"status":return t.status.localeCompare(r.status);case"renter":return(((o=t.renter)==null?void 0:o.full_name)||"").localeCompare(((N=r.renter)==null?void 0:N.full_name)||"");default:return 0}}),s},[j,n,d,h]),c=x.useMemo(()=>{if(!g)return{};const s=new Date;return{active:g.filter(t=>t.status==="confirmed"&&new Date(t.start_date)<=s&&new Date(t.end_date)>=s),pending:g.filter(t=>t.status==="pending"),expired:g.filter(t=>t.status==="expired"),completed:g.filter(t=>t.status==="completed"||t.status==="confirmed"&&new Date(t.end_date)<s)}},[g]),v=x.useCallback(async(s,t)=>{try{const r=t==="approve"?"confirmed":"cancelled",{error:o}=await B.from("bookings").update({status:r}).eq("id",s);if(o)throw o;await f.invalidateQueries({queryKey:["host-bookings"]}),i({title:"Success",description:`Booking ${t}d successfully`})}catch{i({title:"Error",description:`Failed to ${t} booking`,variant:"destructive"})}},[f,i]),R=x.useCallback(async s=>{if(m.length!==0)try{const t=s==="approve"?"confirmed":"cancelled",{error:r}=await B.from("bookings").update({status:t}).in("id",m);if(r)throw r;await f.invalidateQueries({queryKey:["host-bookings"]}),l([]),i({title:"Success",description:`${m.length} bookings ${s}d successfully`})}catch{i({title:"Error",description:`Failed to ${s} selected bookings`,variant:"destructive"})}},[m,f,i]),_=x.useCallback(s=>{i({title:"Export Started",description:`Exporting data as ${s.toUpperCase()}...`})},[i]);return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>a(-1),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"My Bookings (Host)"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your rental bookings"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>_("csv"),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"CSV"]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>_("pdf"),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),e.jsx(Ae,{bookings:j}),e.jsxs(q,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(pe,{placeholder:"Search by renter, car, or location...",value:n,onChange:s=>w(s.target.value),className:"pl-10"})]}),e.jsxs(O,{value:d,onValueChange:s=>C(s),children:[e.jsx(X,{className:"w-full sm:w-48",children:e.jsx(G,{placeholder:"Filter by status"})}),e.jsxs(J,{children:[e.jsx(u,{value:"all",children:"All Status"}),e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"confirmed",children:"Confirmed"}),e.jsx(u,{value:"completed",children:"Completed"}),e.jsx(u,{value:"cancelled",children:"Cancelled"}),e.jsx(u,{value:"expired",children:"Expired"})]})]}),e.jsxs(O,{value:h,onValueChange:s=>y(s),children:[e.jsx(X,{className:"w-full sm:w-48",children:e.jsx(G,{placeholder:"Sort by"})}),e.jsxs(J,{children:[e.jsx(u,{value:"date_desc",children:"Newest First"}),e.jsx(u,{value:"date_asc",children:"Oldest First"}),e.jsx(u,{value:"earnings_desc",children:"Highest Earnings"}),e.jsx(u,{value:"earnings_asc",children:"Lowest Earnings"}),e.jsx(u,{value:"status",children:"Status"}),e.jsx(u,{value:"renter",children:"Renter Name"})]})]})]}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsxs("span",{className:"text-sm",children:[m.length," selected"]}),e.jsx(p,{size:"sm",onClick:()=>R("approve"),children:"Approve Selected"}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>R("decline"),children:"Decline Selected"}),e.jsx(p,{size:"sm",variant:"ghost",onClick:()=>l([]),children:"Clear"})]})]}),e.jsxs(he,{value:S,onValueChange:A,className:"space-y-4",children:[e.jsxs(ge,{className:"grid w-full grid-cols-4",children:[e.jsxs(T,{value:"active",className:"relative",children:["Active Rentals",((M=c.active)==null?void 0:M.length)>0&&e.jsx(b,{variant:"secondary",className:"ml-2 h-5 px-1.5 text-xs",children:c.active.length})]}),e.jsxs(T,{value:"pending",className:"relative",children:["Requests",((L=c.pending)==null?void 0:L.length)>0&&e.jsx(b,{variant:"destructive",className:"ml-2 h-5 px-1.5 text-xs",children:c.pending.length})]}),e.jsxs(T,{value:"expired",children:["Expired",((z=c.expired)==null?void 0:z.length)>0&&e.jsx(b,{variant:"outline",className:"ml-2 h-5 px-1.5 text-xs",children:c.expired.length})]}),e.jsxs(T,{value:"completed",children:["Past Rentals",((P=c.completed)==null?void 0:P.length)>0&&e.jsx(b,{variant:"outline",className:"ml-2 h-5 px-1.5 text-xs",children:c.completed.length})]})]}),e.jsxs(E,{value:"active",className:"space-y-4",children:[(k=c.active)==null?void 0:k.map(s=>e.jsx(F,{booking:s,isSelected:m.includes(s.id),onSelect:t=>{l(t?r=>[...r,s.id]:r=>r.filter(o=>o!==s.id))},onAction:v},s.id)),((I=c.active)==null?void 0:I.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No active rentals"})]}),e.jsxs(E,{value:"pending",className:"space-y-4",children:[(H=c.pending)==null?void 0:H.map(s=>e.jsx(F,{booking:s,isSelected:m.includes(s.id),onSelect:t=>{l(t?r=>[...r,s.id]:r=>r.filter(o=>o!==s.id))},onAction:v},s.id)),((Q=c.pending)==null?void 0:Q.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No pending requests"})]}),e.jsxs(E,{value:"expired",className:"space-y-4",children:[(V=c.expired)==null?void 0:V.map(s=>e.jsx(F,{booking:s,isSelected:!1,onSelect:()=>{},onAction:v},s.id)),((U=c.expired)==null?void 0:U.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No expired requests"})]}),e.jsxs(E,{value:"completed",className:"space-y-4",children:[(W=c.completed)==null?void 0:W.map(s=>e.jsx(F,{booking:s,isSelected:!1,onSelect:()=>{},onAction:v},s.id)),((K=c.completed)==null?void 0:K.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No completed rentals"})]})]})]}),e.jsx(fe,{})]})};export{ss as HostBookings,ss as default};

import{j as e,a as oe,u as me}from"./query-vendor-C7aRRP05.js";import{u as ae,r as u}from"./react-vendor-mnpoGfEl.js";import{D as xe,b as ue,d as he,e as pe,B as h,o as je,p as fe,q as ge,ap as ve,v as D,r as Ne,s as F,y as we,ao as ye,I as Ce,S as Z,g as ee,h as se,i as te,k as j,ar as _e,as as Se,at as T,au as E}from"./index-6IS4AKTX.js";import{C as Re,N as De}from"./Navigation-BQmAR9Jk.js";import{C as B,a as q,b as $,d as z}from"./card-BUcHLe5F.js";import{C as Be}from"./checkbox-BJEVpui9.js";import{S as Me}from"./separator-D8Khi2T_.js";import{R as re}from"./receipt-DXJC7hIn.js";import{C as le}from"./calendar-YxHZMy97.js";import{M as ne}from"./map-pin-FLVtiGuW.js";import{U as be}from"./user-BZvrovAH.js";import{C as Ae}from"./car-2iUFJCfP.js";import{D as H}from"./download-BjrYy8jO.js";import{a as P,e as Fe}from"./date-vendor-Dhms5dOu.js";import{D as ce}from"./dollar-sign-63-VeiGp.js";import{C as ie}from"./circle-check-big-d5A8z5yQ.js";import{C as Pe}from"./circle-x-Du-utU7s.js";import{R as Te}from"./rotate-ccw-CFBGzNS_.js";import{C as Ee}from"./car-front-BblmI-2O.js";import{C as Le}from"./clock-CB1OvN9s.js";import{T as qe}from"./trending-up-CpfLKAUA.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./bell-ClNaiYuo.js";const $e=({isOpen:t,onClose:c,booking:i})=>{var g;const l=()=>{window.print()},y=()=>{console.log("Download receipt for booking:",i.id)},p=i.total_price||0,v=p*.1,o=p-v;return e.jsx(xe,{open:t,onOpenChange:c,children:e.jsxs(ue,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(he,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Rental Receipt"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{children:e.jsxs(q,{children:[e.jsx($,{className:"text-center text-xl",children:"MobiRides Receipt"}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["Receipt #",i.id.slice(-8).toUpperCase()]})]})}),e.jsxs(B,{children:[e.jsx(q,{children:e.jsx($,{className:"text-lg",children:"Booking Details"})}),e.jsx(z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Rental Period"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[P(new Date(i.start_date),"MMM dd, yyyy")," - ",P(new Date(i.end_date),"MMM dd, yyyy")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Pickup Location"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.cars.location||"Location not specified"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Renter"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((g=i.renter)==null?void 0:g.full_name)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Vehicle"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.cars.brand," ",i.cars.model]})]})]})]})})]}),e.jsxs(B,{children:[e.jsx(q,{children:e.jsx($,{className:"text-lg",children:"Payment Summary"})}),e.jsxs(z,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rental Subtotal"}),e.jsxs("span",{children:["BWP ",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Service Fee"}),e.jsxs("span",{children:["BWP ",v.toFixed(2)]})]}),e.jsx(Me,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["BWP ",p.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Payment completed on ",P(new Date(i.created_at),"MMM dd, yyyy")]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(h,{variant:"outline",onClick:l,children:"Print Receipt"}),e.jsxs(h,{onClick:y,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Download PDF"]})]})]})]})})},L=({booking:t,isSelected:c,onSelect:i,onAction:l})=>{var I,N,d,C,b;const y=ae(),[p,v]=u.useState(!1),[o,g]=u.useState(null),m=async f=>{g(f),await l(t.id,f),g(null)},n=f=>{if(t.early_return&&f==="completed")return e.jsxs(D,{variant:"secondary",className:"bg-purple-100 text-purple-800 animate-fade-in flex items-center gap-1",children:[e.jsx(Te,{className:"h-3 w-3"}),"Returned Early"]});const w={pending:{label:"Pending",variant:"secondary",color:"bg-orange-100 text-orange-800"},confirmed:{label:"Confirmed",variant:"default",color:"bg-green-100 text-green-800"},completed:{label:"Completed",variant:"default",color:"bg-blue-100 text-blue-800"},cancelled:{label:"Cancelled",variant:"destructive",color:"bg-red-100 text-red-800"},expired:{label:"Expired",variant:"outline",color:"bg-gray-100 text-gray-800"}},R=w[f]||w.pending;return e.jsx(D,{variant:R.variant,className:`${R.color} animate-fade-in`,children:R.label})},M=Fe(new Date(t.end_date),new Date(t.start_date))+1,S=t.total_price*(1-.15);return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"hover:shadow-lg transition-all duration-200 animate-fade-in",children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[t.status==="pending"&&e.jsx(Be,{checked:c,onCheckedChange:i,className:"mt-1"}),e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:t.cars.image_url||"/placeholder.svg",alt:`${t.cars.brand} ${t.cars.model}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h3",{className:"font-semibold text-lg leading-tight",children:[t.cars.brand," ",t.cars.model]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ne,{className:"h-3 w-3"}),t.cars.location]})]}),n(t.status)]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-muted/50 rounded-lg",children:[e.jsxs(je,{className:"h-8 w-8",children:[e.jsx(fe,{src:(I=t.renter)==null?void 0:I.avatar_url}),e.jsx(ge,{children:((d=(N=t.renter)==null?void 0:N.full_name)==null?void 0:d.charAt(0))||"R"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:((C=t.renter)==null?void 0:C.full_name)||"Unknown Renter"}),((b=t.renter)==null?void 0:b.phone_number)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.renter.phone_number})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(le,{className:"h-3 w-3"}),e.jsx("span",{children:"Duration"})]}),e.jsxs("p",{className:"font-medium",children:[P(new Date(t.start_date),"MMM dd")," - ",P(new Date(t.end_date),"MMM dd")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[M," days"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ce,{className:"h-3 w-3"}),e.jsx("span",{children:"Earnings"})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"font-bold text-primary text-base",children:["BWP ",S.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["BWP ",t.total_price.toFixed(2)," total"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{size:"sm",onClick:()=>m("approve"),disabled:o==="approve",className:"flex-1 sm:flex-none animate-scale-in",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),o==="approve"?"Approving...":"Approve"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>m("decline"),disabled:o==="decline",className:"flex-1 sm:flex-none",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),o==="decline"?"Declining...":"Decline"]})]}),t.status==="confirmed"&&e.jsx(h,{size:"sm",variant:"outline",onClick:()=>m("cancel"),disabled:o==="cancel",className:"hover-scale",children:o==="cancel"?"Cancelling...":"Cancel"}),t.status==="completed"&&e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>v(!0),className:"hover-scale",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Receipt"]}),e.jsxs(h,{size:"sm",variant:"ghost",onClick:()=>{var f,w;return y("/messages",{state:{recipientId:(f=t.renter)==null?void 0:f.id,recipientName:((w=t.renter)==null?void 0:w.full_name)||"Renter"}})},className:"hover-scale",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Message"]})]})]})]})})}),e.jsx($e,{isOpen:p,onClose:()=>v(!1),booking:t})]})},ze=({bookings:t})=>{const c=u.useMemo(()=>{if(!t)return{totalBookings:0,activeRentals:0,pendingRequests:0,completedRentals:0,totalRevenue:0,netRevenue:0};const l=new Date,y=.15,p=t.filter(n=>n.status==="confirmed"&&new Date(n.start_date)<=l&&new Date(n.end_date)>=l).length,v=t.filter(n=>n.status==="pending").length,o=t.filter(n=>n.status==="completed"||n.status==="confirmed"&&new Date(n.end_date)<l).length,g=t.filter(n=>n.status==="completed"||n.status==="confirmed").reduce((n,M)=>n+M.total_price,0),m=g*(1-y);return{totalBookings:t.length,activeRentals:p,pendingRequests:v,completedRentals:o,totalRevenue:g,netRevenue:m}},[t]),i=[{title:"Total Bookings",value:c.totalBookings,icon:Ee,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Active Rentals",value:c.activeRentals,icon:Re,color:"text-green-600",bgColor:"bg-green-100"},{title:"Pending Requests",value:c.pendingRequests,icon:Le,color:"text-orange-600",bgColor:"bg-orange-100"},{title:"Completed",value:c.completedRentals,icon:ie,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Total Revenue",value:`BWP ${c.totalRevenue.toFixed(2)}`,icon:ce,color:"text-emerald-600",bgColor:"bg-emerald-100"},{title:"Net Earnings",value:`BWP ${c.netRevenue.toFixed(2)}`,icon:qe,color:"text-primary",bgColor:"bg-primary/10"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:i.map(l=>e.jsxs(B,{className:"hover:shadow-md transition-shadow animate-fade-in",children:[e.jsxs(q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium text-muted-foreground",children:l.title}),e.jsx("div",{className:`p-2 rounded-full ${l.bgColor}`,children:e.jsx(l.icon,{className:`h-4 w-4 ${l.color}`})})]}),e.jsx(z,{children:e.jsx("div",{className:`text-2xl font-bold ${l.color}`,children:l.value})})]},l.title))})},os=()=>{var w,R,W,Q,V,K,O,k,X,G,J,Y;const t=ae(),{toast:c}=Ne(),i=oe(),[l,y]=u.useState(""),[p,v]=u.useState("all"),[o,g]=u.useState("date_desc"),[m,n]=u.useState([]),[M,U]=u.useState("active"),{data:S,isLoading:I}=me({queryKey:["host-bookings"],queryFn:async()=>{const{data:{user:s}}=await F.auth.getUser();if(!s)throw new Error("No user found");const{data:a,error:r}=await F.from("cars").select("id").eq("owner_id",s.id);if(r)throw r;if(!a.length)return[];const x=a.map(de=>de.id),{data:_,error:A}=await F.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            location,
            image_url,
            owner_id,
            price_per_day
          ),
          renter:profiles!renter_id (
            id,
            full_name,
            avatar_url,
            phone_number
          )
        `).in("car_id",x).order("created_at",{ascending:!1});if(A)throw A;return _}}),N=u.useMemo(()=>{if(!S)return[];const s=S.filter(a=>{var _,A;const r=l===""||a.cars.brand.toLowerCase().includes(l.toLowerCase())||a.cars.model.toLowerCase().includes(l.toLowerCase())||((A=(_=a.renter)==null?void 0:_.full_name)==null?void 0:A.toLowerCase().includes(l.toLowerCase()))||a.cars.location.toLowerCase().includes(l.toLowerCase()),x=p==="all"||a.status===p;return r&&x});return s.sort((a,r)=>{var x,_;switch(o){case"date_asc":return new Date(a.start_date).getTime()-new Date(r.start_date).getTime();case"date_desc":return new Date(r.start_date).getTime()-new Date(a.start_date).getTime();case"earnings_asc":return a.total_price-r.total_price;case"earnings_desc":return r.total_price-a.total_price;case"status":return a.status.localeCompare(r.status);case"renter":return(((x=a.renter)==null?void 0:x.full_name)||"").localeCompare(((_=r.renter)==null?void 0:_.full_name)||"");default:return 0}}),s},[S,l,p,o]),d=u.useMemo(()=>{if(!N)return{};const s=new Date;return{active:N.filter(a=>a.status==="confirmed"&&new Date(a.start_date)<=s&&new Date(a.end_date)>=s),pending:N.filter(a=>a.status==="pending"),expired:N.filter(a=>a.status==="expired"),completed:N.filter(a=>a.status==="completed"||a.status==="confirmed"&&new Date(a.end_date)<s)}},[N]),C=u.useCallback(async(s,a)=>{try{const r=a==="approve"?"confirmed":"cancelled",{error:x}=await F.from("bookings").update({status:r}).eq("id",s);if(x)throw x;await i.invalidateQueries({queryKey:["host-bookings"]}),c({title:"Success",description:`Booking ${a}d successfully`})}catch{c({title:"Error",description:`Failed to ${a} booking`,variant:"destructive"})}},[i,c]),b=u.useCallback(async s=>{if(m.length!==0)try{const a=s==="approve"?"confirmed":"cancelled",{error:r}=await F.from("bookings").update({status:a}).in("id",m);if(r)throw r;await i.invalidateQueries({queryKey:["host-bookings"]}),n([]),c({title:"Success",description:`${m.length} bookings ${s}d successfully`})}catch{c({title:"Error",description:`Failed to ${s} selected bookings`,variant:"destructive"})}},[m,i,c]),f=u.useCallback(s=>{c({title:"Export Started",description:`Exporting data as ${s.toUpperCase()}...`})},[c]);return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>t(-1),children:e.jsx(we,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"My Bookings (Host)"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your rental bookings"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>f("csv"),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"CSV"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>f("pdf"),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),e.jsx(ze,{bookings:S}),e.jsxs(B,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search by renter, car, or location...",value:l,onChange:s=>y(s.target.value),className:"pl-10"})]}),e.jsxs(Z,{value:p,onValueChange:s=>v(s),children:[e.jsx(ee,{className:"w-full sm:w-48",children:e.jsx(se,{placeholder:"Filter by status"})}),e.jsxs(te,{children:[e.jsx(j,{value:"all",children:"All Status"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"confirmed",children:"Confirmed"}),e.jsx(j,{value:"completed",children:"Completed"}),e.jsx(j,{value:"cancelled",children:"Cancelled"}),e.jsx(j,{value:"expired",children:"Expired"})]})]}),e.jsxs(Z,{value:o,onValueChange:s=>g(s),children:[e.jsx(ee,{className:"w-full sm:w-48",children:e.jsx(se,{placeholder:"Sort by"})}),e.jsxs(te,{children:[e.jsx(j,{value:"date_desc",children:"Newest First"}),e.jsx(j,{value:"date_asc",children:"Oldest First"}),e.jsx(j,{value:"earnings_desc",children:"Highest Earnings"}),e.jsx(j,{value:"earnings_asc",children:"Lowest Earnings"}),e.jsx(j,{value:"status",children:"Status"}),e.jsx(j,{value:"renter",children:"Renter Name"})]})]})]}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsxs("span",{className:"text-sm",children:[m.length," selected"]}),e.jsx(h,{size:"sm",onClick:()=>b("approve"),children:"Approve Selected"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>b("decline"),children:"Decline Selected"}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>n([]),children:"Clear"})]})]}),e.jsxs(_e,{value:M,onValueChange:U,className:"space-y-4",children:[e.jsxs(Se,{className:"grid w-full grid-cols-4",children:[e.jsxs(T,{value:"active",className:"relative",children:["Active Rentals",((w=d.active)==null?void 0:w.length)>0&&e.jsx(D,{variant:"secondary",className:"ml-2 h-5 px-1.5 text-xs",children:d.active.length})]}),e.jsxs(T,{value:"pending",className:"relative",children:["Requests",((R=d.pending)==null?void 0:R.length)>0&&e.jsx(D,{variant:"destructive",className:"ml-2 h-5 px-1.5 text-xs",children:d.pending.length})]}),e.jsxs(T,{value:"expired",children:["Expired",((W=d.expired)==null?void 0:W.length)>0&&e.jsx(D,{variant:"outline",className:"ml-2 h-5 px-1.5 text-xs",children:d.expired.length})]}),e.jsxs(T,{value:"completed",children:["Past Rentals",((Q=d.completed)==null?void 0:Q.length)>0&&e.jsx(D,{variant:"outline",className:"ml-2 h-5 px-1.5 text-xs",children:d.completed.length})]})]}),e.jsxs(E,{value:"active",className:"space-y-4",children:[(V=d.active)==null?void 0:V.map(s=>e.jsx(L,{booking:s,isSelected:m.includes(s.id),onSelect:a=>{n(a?r=>[...r,s.id]:r=>r.filter(x=>x!==s.id))},onAction:C},s.id)),((K=d.active)==null?void 0:K.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No active rentals"})]}),e.jsxs(E,{value:"pending",className:"space-y-4",children:[(O=d.pending)==null?void 0:O.map(s=>e.jsx(L,{booking:s,isSelected:m.includes(s.id),onSelect:a=>{n(a?r=>[...r,s.id]:r=>r.filter(x=>x!==s.id))},onAction:C},s.id)),((k=d.pending)==null?void 0:k.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No pending requests"})]}),e.jsxs(E,{value:"expired",className:"space-y-4",children:[(X=d.expired)==null?void 0:X.map(s=>e.jsx(L,{booking:s,isSelected:!1,onSelect:()=>{},onAction:C},s.id)),((G=d.expired)==null?void 0:G.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No expired requests"})]}),e.jsxs(E,{value:"completed",className:"space-y-4",children:[(J=d.completed)==null?void 0:J.map(s=>e.jsx(L,{booking:s,isSelected:!1,onSelect:()=>{},onAction:C},s.id)),((Y=d.completed)==null?void 0:Y.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No completed rentals"})]})]})]}),e.jsx(De,{})]})};export{os as HostBookings,os as default};

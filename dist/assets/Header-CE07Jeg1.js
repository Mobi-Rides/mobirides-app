import{j as e,u as F}from"./query-vendor-BOSMW7hd.js";import{u as _,f as H,r as h}from"./react-vendor-DmU5vXC9.js";import{c as M,B as N,n as B,O as R,s as j,z as V,i as P,j as G,k as q,aa as O,A as K}from"./index-BnOLzhwz.js";import{S as T,a as J,b as Q}from"./sheet-eVwRI0f7.js";import{S as W}from"./SearchFilters-BjGBlbP5.js";import{u as X}from"./useVerificationStatus-cg8ekbTX.js";import{C as L}from"./clock-C62Gyxh0.js";import{C as Y}from"./circle-check-big-Bkn7QkAB.js";import{C as Z}from"./circle-alert-FqYpxmOc.js";import{S as ee}from"./shield-DZyYQXZr.js";import{N as ae}from"./navigation-DqpSjE7a.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=M("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),se=({showText:x=!0,variant:w="badge",size:g="md"})=>{const{isVerified:o,isLoading:c,verificationData:a}=X(),v=_(),l=()=>{v("/verification")},t=c?{icon:e.jsx(L,{className:"h-3 w-3"}),text:"Checking...",variant:"outline",className:"border-blue-300 text-blue-600 hover:bg-blue-50",clickable:!1}:o?{icon:e.jsx(Y,{className:"h-3 w-3"}),text:"Verified",variant:"secondary",className:"bg-green-100 text-green-700 border-green-200",clickable:!1}:a&&a.overall_status==="pending_review"?{icon:e.jsx(L,{className:"h-3 w-3"}),text:"Under Review",variant:"secondary",className:"bg-blue-100 text-blue-700 border-blue-200",clickable:!0}:a&&a.current_step?{icon:e.jsx(Z,{className:"h-3 w-3"}),text:"In Progress",variant:"secondary",className:"bg-orange-100 text-orange-700 border-orange-200",clickable:!0}:{icon:e.jsx(ee,{className:"h-3 w-3"}),text:"Not Verified",variant:"outline",className:"border-gray-300 text-gray-600 hover:bg-gray-50",clickable:!0};return w==="button"&&t.clickable?e.jsxs(N,{variant:"outline",size:g==="md"?"default":g,onClick:l,className:`flex items-center space-x-2 ${t.className||""}`,children:[t.icon,x&&e.jsx("span",{children:t.text})]}):e.jsxs(B,{variant:t.variant,className:`flex items-center space-x-1 cursor-pointer ${t.className||""}`,onClick:t.clickable?l:void 0,children:[t.icon,x&&e.jsx("span",{children:t.text})]})},fe=({searchQuery:x,onSearchChange:w,onFiltersChange:g})=>{const o=_(),c=H(),{user:a}=R(),[v,l]=h.useState(!1),[C,t]=h.useState("signin"),[f,y]=h.useState({city:"Gaborone",country:"Botswana",loading:!0,error:null});h.useEffect(()=>{const s=async()=>{try{const r=await navigator.permissions.query({name:"geolocation"});r.state==="granted"?await n():r.state==="denied"?await k():await k()}catch{try{await n()}catch{await k()}}},n=async()=>{var r,i;try{const u=await new Promise(($,D)=>{navigator.geolocation.getCurrentPosition($,D,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),b=await fetch(`https://api.opencagedata.com/geocode/v1/json?q=${u.coords.latitude}+${u.coords.longitude}&key=4382106d8cc34d2e9c95f4dc83f23736`);if(!b.ok)throw new Error("Failed to fetch location data");const m=(i=(r=(await b.json()).results)==null?void 0:r[0])==null?void 0:i.components;m&&y({city:m.city||m.town||m.state||m.county||"Unknown",country:m.country||"Unknown",loading:!1,error:null})}catch(u){console.error("Location error:",u),y(b=>({...b,loading:!1,error:u instanceof Error?u.message:"Failed to get location"}))}},k=async()=>{try{const r=await fetch("https://ipapi.co/json/");if(!r.ok)throw new Error("Failed to fetch location data");const i=await r.json();y({city:i.city||"Gaborone",country:i.country_name||"Botswana",loading:!1,error:null})}catch(r){console.error("IP Location error:",r),y(i=>({...i,loading:!1,error:null,city:"Gaborone",country:"Botswana"}))}};s()},[]);const{data:p}=F({queryKey:["profile"],queryFn:async()=>{if(!a)return null;const{data:s}=await j.from("profiles").select("avatar_url, full_name").eq("id",a.id).single();return s},enabled:!!a}),{data:d}=F({queryKey:["notification-count"],queryFn:async()=>{if(!a)return{messages:0,notifications:0};const[s,n]=await Promise.all([j.from("messages").select("id",{count:"exact"}).eq("receiver_id",a.id).eq("status","sent"),j.from("notifications").select("id",{count:"exact"}).eq("user_id",a.id).eq("is_read",!1)]);return{messages:s.count||0,notifications:n.count||0}},refetchInterval:3e4,enabled:!!a}),S=((d==null?void 0:d.messages)||0)+((d==null?void 0:d.notifications)||0),A=p!=null&&p.avatar_url?j.storage.from("avatars").getPublicUrl(p.avatar_url).data.publicUrl:null,z=s=>{console.log("Filters changed:",s),g({...s,searchQuery:x})},U=()=>{a?o("/profile"):(t("signin"),l(!0),o(`${c.pathname}?auth=signin`,{replace:!0}))},E=()=>{l(!1),o(c.pathname,{replace:!0})};h.useEffect(()=>{const n=new URLSearchParams(c.search).get("auth");(n==="signin"||n==="signup")&&(t(n),l(!0))},[c.search]);const I=f.loading?"Loading location...":f.error?"Gaborone, Botswana":`${f.city}, ${f.country}`;return e.jsxs("header",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-900 sticky top-0 z-10 shadow-sm p-6 md:p-8 rounded-b-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsx("img",{src:"/lovable-uploads/a065be26-80b7-4e50-b683-b6afb0add925.png",alt:"Mobirides Logo",className:"h-14 w-14 cursor-pointer",onClick:()=>o("/")}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-center gap-1 text-center",children:[e.jsx(ae,{className:"text-white h-4 w-4 flex-shrink-0"}),e.jsx("h3",{className:"text-xs md:text-sm lg:text-base font-normal text-gray-500 dark:text-white truncate",children:I})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{variant:"outline",size:"icon",className:"rounded-2xl  md:size-auto md:px-4 md:py-2 md:flex md:items-center md:gap-2",onClick:()=>o("/add-car"),children:[e.jsx(V,{className:"h-4 w-4 text-[#581CFA] dark:text-white"}),e.jsx("span",{className:"hidden md:inline-block",children:e.jsx("p",{className:"text-[#581CFA] dark:text-white text-xs md:text-sm lg:text-base font-semibold",children:"Add A Car"})})]}),a&&e.jsx("div",{className:"hidden sm:block",children:e.jsx(se,{variant:"button",size:"sm"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"rounded-full bg-gray-100 flex items-center justify-center",onClick:U,children:A&&a?e.jsxs(P,{className:"h-10 w-10",children:[e.jsx(G,{src:A,alt:"Profile"}),e.jsx(q,{children:"ðŸ‘¤"})]}):e.jsx(P,{className:"h-10 w-10",children:e.jsx(q,{children:"ðŸ‘¤"})})}),S>0&&a&&e.jsx(B,{variant:"destructive",className:"absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 text-xs",children:S})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-8",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#581CFA] h-4 w-4 md:h-5 md:w-5  lg:h-6 lg:w-6"}),e.jsx("input",{type:"text",placeholder:"Search cars...",value:x,onChange:s=>w(s.target.value),className:"w-full h-12 md:h-14 pl-10 pr-4 py-2 rounded-2xl border border-gray-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 focus:outline-none focus:border-primary dark:focus:border-primary text-xs md:text-sm lg:text-base placeholder:text-xs md:placeholder:text-sm lg:placeholder:text-base dark:placeholder:text-gray-400"})]}),e.jsxs(T,{children:[e.jsx(J,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",className:"rounded-2xl w-12 md:w-14 h-12 md:h-14 flex items-center justify-center",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsx(Q,{children:e.jsx(W,{onFiltersChange:z})})]})]}),e.jsx(K,{isOpen:v,onClose:E,defaultTab:C})]})};export{fe as H};

import{j as e,u as y}from"./query-vendor-Bsfdn-Hb.js";import{T as b,a as S,b as f,c as t,d as T,e as l,A as V,f as L}from"./table-LmMVSYSc.js";import{r as A}from"./react-vendor-mnpoGfEl.js";import{an as k,I as B,n as _,B as m,V as P,ak as R,s as p,J as g}from"./index-CEKMvnhM.js";import{C as v,d as w,a as q,b as z}from"./card-DVWWM3IP.js";import{S as u}from"./skeleton-CHo5tvc9.js";import{C as E}from"./circle-x-CJywVQTJ.js";import"./separator-CNMPkK_g.js";import"./sheet-CcFgStQt.js";import"./car-CVWSXvWw.js";import"./credit-card-CocXzOfZ.js";import"./message-square-CfnZ98V9.js";import"./house-Bsui6dM0.js";import"./settings-Bd5GrtQ9.js";import"./log-out-C9uCL1sx.js";import"./useIsAdmin-zCX1SCL8.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";const F=()=>y({queryKey:["admin-verifications"],queryFn:async()=>{const{data:i,error:n}=await p.from("user_verifications").select(`
          id, user_id, overall_status, current_step, personal_info_completed,
          documents_completed, selfie_completed, phone_verified, address_confirmed,
          created_at
        `).order("created_at",{ascending:!1});if(n)throw n;return await Promise.all((i||[]).map(async o=>{const{data:d}=await p.from("profiles").select("full_name, role").eq("id",o.user_id).single();return{...o,profiles:d}}))}}),D=()=>{const[i,n]=A.useState(""),{data:c,isLoading:o,error:d,refetch:N}=F(),x=(c==null?void 0:c.filter(s=>{var r,a;return((a=(r=s.profiles)==null?void 0:r.full_name)==null?void 0:a.toLowerCase().includes(i.toLowerCase()))||s.overall_status.toLowerCase().includes(i.toLowerCase())||s.current_step.toLowerCase().includes(i.toLowerCase())}))||[],C=s=>{switch(s){case"verified":return"default";case"pending":return"secondary";case"rejected":return"destructive";case"not_started":return"outline";default:return"outline"}},h=async(s,r)=>{try{const{error:a}=await p.from("user_verifications").update({overall_status:r,completed_at:r==="verified"?new Date().toISOString():null}).eq("id",s);if(a)throw a;N(),g.success(`Verification ${r} successfully`)}catch(a){console.error("Error updating verification:",a),g.error("Failed to update verification")}},j=s=>{const r=[s.personal_info_completed,s.documents_completed,s.selfie_completed,s.phone_verified,s.address_confirmed],a=r.filter(Boolean).length;return Math.round(a/r.length*100)};return d?e.jsx(v,{children:e.jsx(w,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load verifications"})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(k,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search verifications...",value:i,onChange:s=>n(s.target.value),className:"pl-8"})]})}),e.jsxs(v,{children:[e.jsx(q,{children:e.jsxs(z,{children:["Verifications (",x.length,")"]})}),e.jsx(w,{children:o?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,r)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(u,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"h-4 w-[200px]"}),e.jsx(u,{className:"h-4 w-[100px]"})]})]},r))}):e.jsxs(b,{children:[e.jsx(S,{children:e.jsxs(f,{children:[e.jsx(t,{children:"User"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Current Step"}),e.jsx(t,{children:"Progress"}),e.jsx(t,{children:"Submitted"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(T,{children:x.map(s=>{var r,a;return e.jsxs(f,{children:[e.jsx(l,{className:"font-medium",children:((r=s.profiles)==null?void 0:r.full_name)||"Unknown"}),e.jsx(l,{children:e.jsx(_,{variant:"outline",children:((a=s.profiles)==null?void 0:a.role)||"unknown"})}),e.jsx(l,{children:e.jsx(_,{variant:C(s.overall_status),children:s.overall_status.replace("_"," ")})}),e.jsx(l,{className:"capitalize",children:s.current_step.replace("_"," ")}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 bg-secondary rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${j(s)}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[j(s),"%"]})]})}),e.jsx(l,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[s.overall_status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>h(s.id,"verified"),children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(m,{variant:"destructive",size:"sm",onClick:()=>h(s.id,"rejected"),children:[e.jsx(E,{className:"h-4 w-4 mr-1"}),"Reject"]})]}),e.jsx(m,{variant:"ghost",size:"sm",children:e.jsx(R,{className:"h-4 w-4"})})]})})]},s.id)})})]})})]})]})},le=()=>e.jsx(V,{children:e.jsx(L,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Verification Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and approve KYC documents, license verifications"})]}),e.jsx(D,{})]})})});export{le as default};

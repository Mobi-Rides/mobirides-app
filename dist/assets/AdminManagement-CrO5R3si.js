import{a as z,b as _,j as e,u as K}from"./query-vendor-C7aRRP05.js";import{T as $,a as J,b as T,c,d as G,e as o,A as W,f as X}from"./table-Dh39_vnU.js";import{r as u}from"./react-vendor-mnpoGfEl.js";import{c as Y,J as p,s as h,ao as Z,I as ee,B as f,M as se,v as ae,K as re,D as ne,b as ie,d as te,e as le,t as de,f as F,S as k,g as q,h as I,i as L,k as C,bb as ce}from"./index-6IS4AKTX.js";import{C as M,d as R,a as oe,b as me}from"./card-BUcHLe5F.js";import{S as N}from"./skeleton-CGpulx9Y.js";import{A as ue,b as he,c as xe,d as je,e as pe,f as fe,g as ge,h as Ae}from"./alert-dialog-BqvR6tA1.js";import{S as E}from"./shield-DwTXN-Nk.js";import"./separator-D8Khi2T_.js";import"./sheet-BptM62j-.js";import"./car-2iUFJCfP.js";import"./credit-card-DzkL5K80.js";import"./message-square-B0WUHuoz.js";import"./house-C9ZVp3VQ.js";import"./settings-Bf-hPg48.js";import"./log-out-CKR0Ta2u.js";import"./useIsAdmin-BrV2ffK8.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=Y("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ye=()=>K({queryKey:["admins"],queryFn:async()=>{const{data:r,error:i}=await h.from("admins").select("*").order("created_at",{ascending:!1});if(i)throw i;return r||[]}}),Ce=()=>K({queryKey:["non-admin-users"],queryFn:async()=>{const{data:r}=await h.from("admins").select("id"),i=(r==null?void 0:r.map(x=>x.id))||[];let m=h.from("profiles").select("id, full_name, role");i.length>0&&(m=m.not("id","in",`(${i.join(",")})`));const{data:t,error:n}=await m.order("full_name",{ascending:!0});if(n)throw n;return t||[]}}),Ne=()=>{const[r,i]=u.useState(""),[m,t]=u.useState(!1),[n,x]=u.useState(""),[S,w]=u.useState(!1),[l,g]=u.useState(null),j=z(),{data:A,isLoading:Q,error:U}=ye(),{data:d}=Ce(),v=_({mutationFn:async({userId:s,isSuperAdmin:a,userEmail:y,userName:V})=>{const{error:D}=await h.from("admins").insert({id:s,email:y,full_name:V,is_super_admin:a});if(D)throw D},onSuccess:()=>{j.invalidateQueries({queryKey:["admins"]}),j.invalidateQueries({queryKey:["non-admin-users"]}),p.success("Admin added successfully"),t(!1),x(""),w(!1)},onError:s=>{p.error(`Failed to add admin: ${s.message}`)}}),H=_({mutationFn:async s=>{const{error:a}=await h.from("admins").delete().eq("id",s);if(a)throw a},onSuccess:()=>{j.invalidateQueries({queryKey:["admins"]}),j.invalidateQueries({queryKey:["non-admin-users"]}),p.success("Admin removed successfully"),g(null)},onError:s=>{p.error(`Failed to remove admin: ${s.message}`)}}),B=()=>{if(!n)return;const s=d==null?void 0:d.find(y=>y.id===n);if(!s)return;v.mutate({userId:n,isSuperAdmin:S,userEmail:"admin@mobirides.com",userName:s.full_name||"Unknown User"})},O=s=>{g(s)},P=()=>{l&&H.mutate(l.id)},b=(A==null?void 0:A.filter(s=>{var a;return((a=s.full_name)==null?void 0:a.toLowerCase().includes(r.toLowerCase()))||s.email.toLowerCase().includes(r.toLowerCase())}))||[];return U?e.jsx(M,{children:e.jsx(R,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load admins"})})}):e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(me,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Admin Management (",b.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage platform administrators and their permissions"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ee,{placeholder:"Search admins...",value:r,onChange:s=>i(s.target.value),className:"pl-8"})]}),e.jsxs(f,{onClick:()=>t(!0),children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Admin"]})]})]})}),e.jsx(R,{children:Q?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(N,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"h-4 w-[200px]"}),e.jsx(N,{className:"h-4 w-[100px]"})]})]},a))}):e.jsxs($,{children:[e.jsx(J,{children:e.jsxs(T,{children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Admin Type"}),e.jsx(c,{children:"Added"}),e.jsx(c,{children:"Last Sign In"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(G,{children:b.map(s=>e.jsxs(T,{children:[e.jsx(o,{className:"font-medium",children:s.full_name||"No name"}),e.jsx(o,{children:s.email}),e.jsx(o,{children:e.jsx(ae,{variant:s.is_super_admin?"default":"secondary",children:s.is_super_admin?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Super Admin"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"Admin"]})})}),e.jsx(o,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(o,{children:s.last_sign_in_at?new Date(s.last_sign_in_at).toLocaleDateString():"Never"}),e.jsx(o,{children:e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>O(s),className:"text-destructive hover:text-destructive",children:e.jsx(re,{className:"h-4 w-4"})})})]},s.id))})]})})]}),e.jsx(ne,{open:m,onOpenChange:t,children:e.jsxs(ie,{children:[e.jsxs(te,{children:[e.jsx(le,{children:"Add New Admin"}),e.jsx(de,{children:"Select a user to grant admin access to the platform."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"user-select",children:"Select User"}),e.jsxs(k,{value:n,onValueChange:x,children:[e.jsx(q,{children:e.jsx(I,{placeholder:"Choose a user..."})}),e.jsx(L,{children:d==null?void 0:d.map(s=>e.jsxs(C,{value:s.id,children:[s.full_name||"Unnamed User"," (",s.role,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"admin-type",children:"Admin Type"}),e.jsxs(k,{value:S?"super":"regular",onValueChange:s=>w(s==="super"),children:[e.jsx(q,{children:e.jsx(I,{})}),e.jsxs(L,{children:[e.jsx(C,{value:"regular",children:"Regular Admin"}),e.jsx(C,{value:"super",children:"Super Admin"})]})]})]})]}),e.jsxs(ce,{children:[e.jsx(f,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(f,{onClick:B,disabled:!n||v.isPending,children:v.isPending?"Adding...":"Add Admin"})]})]})}),e.jsx(ue,{open:!!l,onOpenChange:()=>g(null),children:e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsx(je,{children:"Remove Admin Access"}),e.jsxs(pe,{children:["Are you sure you want to remove admin access for ",l==null?void 0:l.full_name,"? They will no longer be able to access the admin dashboard."]})]}),e.jsxs(fe,{children:[e.jsx(ge,{children:"Cancel"}),e.jsx(Ae,{onClick:P,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove Admin"})]})]})})]})},Pe=()=>e.jsx(W,{children:e.jsx(X,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Add and manage platform administrators"})]}),e.jsx(Ne,{})]})})});export{Pe as default};

import{j as e,u as E}from"./query-vendor-BOSMW7hd.js";import{T as R,a as L,b as _,c as n,d as M,e as f,A as ie,f as le}from"./table-D5NfF5K5.js";import{A as ce}from"./AdminStats-KSV17AnG.js";import{r as u,u as oe}from"./react-vendor-DmU5vXC9.js";import{B as y,a7 as F,I as O,a8 as X,s as S,J as b,n as Z,a9 as de,aa as xe,ay as me,ad as q,ac as he,aA as pe,ae as ue,aL as je}from"./index-ByqmTec-.js";import{C as T,d as A,a as I,b as k}from"./card-Dn1_7TKZ.js";import{S as g}from"./skeleton-CLXLgSMQ.js";import{P as fe,a as ve,b as V,c as ge,d as Ne,e as we,U as $}from"./UserManagementTable-D-xC24Qe.js";import{C as ee}from"./circle-check-big-BdHHmxBu.js";import{C as se}from"./circle-x-B9MBqLgQ.js";import{T as Ce}from"./trending-up-CXNUhyI7.js";import{T as ye,E as _e}from"./trending-down-gQIh8eRq.js";import{C as be}from"./chevron-down-CR2ALfoj.js";import{C as Se}from"./select-qP77FLvJ.js";import"./separator-D3RZtFXH.js";import"./sheet-DHpFSv7b.js";import"./car-DcHPLaSp.js";import"./credit-card-IpVO2Hzm.js";import"./message-square-C-ovA3oT.js";import"./house-BXQSFKXu.js";import"./settings-DxJzbhZI.js";import"./log-out-BiGn10Hz.js";import"./useIsAdmin-VZmTJr1R.js";import"./supabase-vendor-B3A6ooRR.js";import"./mapbox-vendor-ueN8uhVJ.js";import"./date-vendor-Dhms5dOu.js";import"./calendar-Cn2gPQb0.js";import"./star-Dt-lKoZi.js";import"./mail-B2le86zI.js";import"./map-pin-B-9tSSOy.js";import"./dollar-sign-BxxqWD8M.js";import"./wallet-BBXAdpKD.js";import"./user-CrwdbYLY.js";import"./file-text-4CeUdrl2.js";import"./clock-Dg92kA5o.js";import"./switch-BC4DIA0f.js";import"./index-CEVvJeOa.js";import"./alert-dialog-COW9ybb7.js";import"./shield-fAaK4GMV.js";import"./user-check-CJneZ_LO.js";import"./chevron-left-BS5IGisg.js";function Te({data:r,itemsPerPage:i=10,renderItem:o,renderHeader:h,className:c="",showLoadMore:x=!1}){const[p,m]=u.useState(1),[d,j]=u.useState(i),v=Math.ceil(r.length/i),N=u.useMemo(()=>{if(x)return r.slice(0,d);const s=(p-1)*i;return r.slice(s,s+i)},[r,p,i,x,d]),a=()=>{j(s=>Math.min(s+i,r.length))},t=x&&d<r.length;return r.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No data available"}):e.jsxs("div",{className:c,children:[h&&h(),e.jsx("div",{className:"space-y-2",children:N.map((s,l)=>o(s,l))}),x?t&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs(y,{variant:"outline",onClick:a,size:"sm",children:["Load More (",Math.min(i,r.length-d)," more)"]})}):v>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(fe,{children:e.jsxs(ve,{children:[e.jsx(V,{children:e.jsx(ge,{onClick:()=>m(s=>Math.max(s-1,1)),className:p===1?"pointer-events-none opacity-50":"cursor-pointer"})}),[...Array(Math.min(v,5))].map((s,l)=>{const w=l+1;return e.jsx(V,{children:e.jsx(Ne,{onClick:()=>m(w),isActive:p===w,className:"cursor-pointer",children:w})},w)}),e.jsx(V,{children:e.jsx(we,{onClick:()=>m(s=>Math.min(s+1,v)),className:p===v?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})}const Ae=()=>E({queryKey:["pending-cars"],queryFn:async()=>{const{data:r,error:i}=await S.from("cars").select(`
          id, brand, model, year, price_per_day, location, 
          is_available, created_at, owner_id,
          profiles:owner_id (full_name)
        `).eq("is_available",!1).order("created_at",{ascending:!1}).limit(10);if(i)throw i;return r||[]}}),H=({isPreview:r=!1,maxItems:i=5})=>{const[o,h]=u.useState(""),{data:c,isLoading:x,error:p,refetch:m}=Ae(),d=(c==null?void 0:c.filter(t=>{var s,l;return t.brand.toLowerCase().includes(o.toLowerCase())||t.model.toLowerCase().includes(o.toLowerCase())||((l=(s=t.profiles)==null?void 0:s.full_name)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))}))||[],j=r?d.slice(0,i):d,v=async t=>{try{const{error:s}=await S.from("cars").update({is_available:!0}).eq("id",t);if(s)throw s;m(),b.success("Car approved successfully")}catch(s){console.error("Error approving car:",s),b.error("Failed to approve car")}},N=async t=>{try{const{error:s}=await S.from("cars").delete().eq("id",t);if(s)throw s;m(),b.success("Car rejected and removed")}catch(s){console.error("Error rejecting car:",s),b.error("Failed to reject car")}},a=t=>{var s;return e.jsxs(_,{children:[e.jsx(f,{className:"font-medium",children:t.brand}),e.jsx(f,{children:t.model}),e.jsx(f,{children:t.year}),e.jsx(f,{children:((s=t.profiles)==null?void 0:s.full_name)||"Unknown"}),e.jsx(f,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>v(t.id),children:e.jsx(ee,{className:"h-4 w-4 text-green-600"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>N(t.id),children:e.jsx(se,{className:"h-4 w-4 text-destructive"})})]})})]},t.id)};return p?e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load pending cars"})})}):r?x?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((t,s)=>e.jsx(g,{className:"h-16 w-full"},s))}):j.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No pending car verifications"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"Make"}),e.jsx(n,{children:"Model"}),e.jsx(n,{children:"Year"}),e.jsx(n,{children:"Seller"}),e.jsx(n,{children:"Submitted At"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(M,{children:j.map(t=>a(t))})]})}):e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs(k,{children:["Car Verification Queue (",d.length,")"]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(F,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search cars...",value:o,onChange:t=>h(t.target.value),className:"pl-8"})]})]})}),e.jsxs(A,{children:[x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((t,s)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(g,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"h-4 w-[200px]"}),e.jsx(g,{className:"h-4 w-[100px]"})]})]},s))}):e.jsx(Te,{data:j,itemsPerPage:10,renderItem:t=>a(t),renderHeader:()=>e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"Make"}),e.jsx(n,{children:"Model"}),e.jsx(n,{children:"Year"}),e.jsx(n,{children:"Seller"}),e.jsx(n,{children:"Submitted At"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(M,{})]}),className:"overflow-x-auto"}),!x&&d.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No pending car verifications"})]})]})},Re=()=>E({queryKey:["pending-verifications"],queryFn:async()=>{const{data:r,error:i}=await S.from("user_verifications").select(`
          id, user_id, overall_status, current_step, created_at, personal_info
        `).in("overall_status",["pending","submitted"]).order("created_at",{ascending:!1});if(i)throw i;return r||[]}}),Q=({isPreview:r=!1,maxItems:i=5})=>{const[o,h]=u.useState(""),{data:c,isLoading:x,error:p,refetch:m}=Re(),d=(c==null?void 0:c.filter(s=>{var l;return((l=s.user_id)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))||s.overall_status.toLowerCase().includes(o.toLowerCase())}))||[],j=r?d.slice(0,i):d,v=async s=>{try{const{error:l}=await S.from("user_verifications").update({overall_status:"verified",completed_at:new Date().toISOString()}).eq("id",s);if(l)throw l;m(),b.success("Verification approved successfully")}catch(l){console.error("Error approving verification:",l),b.error("Failed to approve verification")}},N=async s=>{try{const{error:l}=await S.from("user_verifications").update({overall_status:"rejected",rejection_reasons:["Manual review rejection"]}).eq("id",s);if(l)throw l;m(),b.success("Verification rejected")}catch(l){console.error("Error rejecting verification:",l),b.error("Failed to reject verification")}},a=s=>{switch(s){case"verified":return"default";case"pending":return"secondary";case"rejected":return"destructive";case"submitted":return"outline";default:return"outline"}},t=s=>e.jsxs(_,{children:[e.jsxs(f,{className:"font-medium",children:[s.user_id.substring(0,8),"..."]}),e.jsx(f,{children:"N/A"}),e.jsx(f,{children:e.jsx(Z,{variant:a(s.overall_status),children:s.overall_status})}),e.jsx(f,{children:s.current_step}),e.jsx(f,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>v(s.id),children:e.jsx(ee,{className:"h-4 w-4 text-green-600"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>N(s.id),children:e.jsx(se,{className:"h-4 w-4 text-destructive"})})]})})]},s.id);return p?e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load pending verifications"})})}):r?x?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,l)=>e.jsx(g,{className:"h-16 w-full"},l))}):j.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No pending KYC verifications"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Current Step"}),e.jsx(n,{children:"Submitted"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(M,{children:j.map(s=>t(s))})]})}):e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs(k,{children:["KYC Verification Queue (",d.length,")"]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(F,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search verifications...",value:o,onChange:s=>h(s.target.value),className:"pl-8"})]})]})}),e.jsxs(A,{children:[x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,l)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(g,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"h-4 w-[200px]"}),e.jsx(g,{className:"h-4 w-[100px]"})]})]},l))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Current Step"}),e.jsx(n,{children:"Submitted"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(M,{children:j.map(s=>t(s))})]})}),!x&&d.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No pending KYC verifications"})]})]})},Le=()=>E({queryKey:["recent-transactions"],queryFn:async()=>{const{data:r,error:i}=await S.from("wallet_transactions").select(`
          id, transaction_type, amount, description, created_at, status, wallet_id,
          host_wallets:wallet_id (
            host_id,
            profiles:host_id (full_name)
          )
        `).order("created_at",{ascending:!1}).limit(10);if(i)throw i;return r||[]}}),G=({isPreview:r=!1,maxItems:i=5})=>{const[o,h]=u.useState(""),{data:c,isLoading:x,error:p}=Le(),m=(c==null?void 0:c.filter(a=>{var t,s,l,w;return((l=(s=(t=a.host_wallets)==null?void 0:t.profiles)==null?void 0:s.full_name)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))||a.transaction_type.toLowerCase().includes(o.toLowerCase())||((w=a.description)==null?void 0:w.toLowerCase().includes(o.toLowerCase()))}))||[],d=r?m.slice(0,i):m,j=a=>a==="credit"||a==="top_up"?e.jsx(Ce,{className:"h-4 w-4 text-green-600"}):e.jsx(ye,{className:"h-4 w-4 text-red-600"}),v=a=>a==="credit"||a==="top_up"?"text-green-600":"text-red-600",N=a=>{var t,s;return e.jsxs(_,{children:[e.jsx(f,{className:"font-medium",children:((s=(t=a.host_wallets)==null?void 0:t.profiles)==null?void 0:s.full_name)||"Unknown"}),e.jsx(f,{children:new Date(a.created_at).toLocaleDateString()}),e.jsx(f,{children:a.description||a.transaction_type}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[j(a.transaction_type),e.jsx(Z,{variant:a.transaction_type==="credit"||a.transaction_type==="top_up"?"default":"destructive",children:a.transaction_type==="commission_deduction"?"Debit":"Credit"})]})}),e.jsx(f,{children:e.jsxs("span",{className:`font-semibold ${v(a.transaction_type)}`,children:[a.transaction_type==="commission_deduction"?"-":"+","P",Math.abs(a.amount).toFixed(2)]})})]},a.id)};return p?e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load recent transactions"})})}):r?x?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((a,t)=>e.jsx(g,{className:"h-16 w-full"},t))}):d.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No recent transactions"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Description"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Amount"})]})}),e.jsx(M,{children:d.map(a=>N(a))})]})}):e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs(k,{children:["Recent Transactions (",m.length,")"]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(F,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search transactions...",value:o,onChange:a=>h(a.target.value),className:"pl-8"})]})]})}),e.jsxs(A,{children:[x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((a,t)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(g,{className:"h-6 w-6"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"h-4 w-[200px]"}),e.jsx(g,{className:"h-4 w-[100px]"})]}),e.jsx(g,{className:"h-4 w-[80px] ml-auto"})]},t))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Description"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Amount"})]})}),e.jsx(M,{children:d.map(a=>N(a))})]})}),!x&&m.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No recent transactions"})]})]})};var U="Collapsible",[Me,ys]=xe(U),[De,z]=Me(U),re=u.forwardRef((r,i)=>{const{__scopeCollapsible:o,open:h,defaultOpen:c,disabled:x,onOpenChange:p,...m}=r,[d=!1,j]=de({prop:h,defaultProp:c,onChange:p});return e.jsx(De,{scope:o,disabled:x,contentId:me(),open:d,onOpenToggle:u.useCallback(()=>j(v=>!v),[j]),children:e.jsx(q.div,{"data-state":K(d),"data-disabled":x?"":void 0,...m,ref:i})})});re.displayName=U;var te="CollapsibleTrigger",ae=u.forwardRef((r,i)=>{const{__scopeCollapsible:o,...h}=r,c=z(te,o);return e.jsx(q.button,{type:"button","aria-controls":c.contentId,"aria-expanded":c.open||!1,"data-state":K(c.open),"data-disabled":c.disabled?"":void 0,disabled:c.disabled,...h,ref:i,onClick:he(r.onClick,c.onOpenToggle)})});ae.displayName=te;var B="CollapsibleContent",ne=u.forwardRef((r,i)=>{const{forceMount:o,...h}=r,c=z(B,r.__scopeCollapsible);return e.jsx(pe,{present:o||c.open,children:({present:x})=>e.jsx(Pe,{...h,ref:i,present:x})})});ne.displayName=B;var Pe=u.forwardRef((r,i)=>{const{__scopeCollapsible:o,present:h,children:c,...x}=r,p=z(B,o),[m,d]=u.useState(h),j=u.useRef(null),v=ue(i,j),N=u.useRef(0),a=N.current,t=u.useRef(0),s=t.current,l=p.open||m,w=u.useRef(l),D=u.useRef();return u.useEffect(()=>{const C=requestAnimationFrame(()=>w.current=!1);return()=>cancelAnimationFrame(C)},[]),je(()=>{const C=j.current;if(C){D.current=D.current||{transitionDuration:C.style.transitionDuration,animationName:C.style.animationName},C.style.transitionDuration="0s",C.style.animationName="none";const Y=C.getBoundingClientRect();N.current=Y.height,t.current=Y.width,w.current||(C.style.transitionDuration=D.current.transitionDuration,C.style.animationName=D.current.animationName),d(h)}},[p.open,h]),e.jsx(q.div,{"data-state":K(p.open),"data-disabled":p.disabled?"":void 0,id:p.contentId,hidden:!l,...x,ref:v,style:{"--radix-collapsible-content-height":a?`${a}px`:void 0,"--radix-collapsible-content-width":s?`${s}px`:void 0,...r.style},children:l&&c})});function K(r){return r?"open":"closed"}var Ie=re;const J=Ie,W=ae,ke=ne,P=({title:r,children:i,previewContent:o,itemCount:h,onViewAll:c,defaultOpen:x=!1,showViewAllButton:p=!0})=>{const[m,d]=u.useState(x);return e.jsxs(T,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:"text-lg",children:r}),e.jsxs("div",{className:"flex items-center gap-2",children:[h!==void 0&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[h," items"]}),p&&c&&e.jsxs(y,{variant:"outline",size:"sm",onClick:c,className:"gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),"View All"]})]})]})}),e.jsxs(A,{children:[o&&!m&&e.jsxs("div",{className:"space-y-3",children:[o,e.jsx(J,{open:m,onOpenChange:d,children:e.jsx(W,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"w-full gap-2",children:["Show More",e.jsx(be,{className:"h-4 w-4"})]})})})]}),e.jsx(J,{open:m,onOpenChange:d,children:e.jsxs(ke,{children:[i,o&&e.jsx(W,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"w-full gap-2 mt-3",children:["Show Less",e.jsx(Se,{className:"h-4 w-4"})]})})]})})]})]})},_s=()=>{const r=oe();return e.jsx(ie,{children:e.jsx(le,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome to the Mobi Rides admin panel"})]}),e.jsx(ce,{}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(P,{title:"Car Verification Queue",onViewAll:()=>r("/admin/cars"),previewContent:e.jsx(H,{isPreview:!0,maxItems:3}),children:e.jsx(H,{})}),e.jsx(P,{title:"KYC Verification",onViewAll:()=>r("/admin/verifications"),previewContent:e.jsx(Q,{isPreview:!0,maxItems:3}),children:e.jsx(Q,{})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(P,{title:"User Management",onViewAll:()=>r("/admin/users"),previewContent:e.jsx($,{isPreview:!0,maxItems:3}),children:e.jsx($,{})}),e.jsx(P,{title:"Recent Transactions",onViewAll:()=>r("/admin/transactions"),previewContent:e.jsx(G,{isPreview:!0,maxItems:3}),children:e.jsx(G,{})})]})]})})})};export{_s as default};

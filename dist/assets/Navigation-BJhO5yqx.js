import{a as y,u as x,j as t}from"./query-vendor-C7aRRP05.js";import{f as b,r as o,L as k}from"./react-vendor-mnpoGfEl.js";import{c as _,ao as j,a0 as w,v as N,s as r}from"./index-CfXH57CA.js";import{M as q}from"./map-pin-BHt1iARb.js";import{B as I}from"./bell-vK77m_ng.js";import{U as C}from"./user-FiBtLMcV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=_("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),S=()=>{const n=b(),[v,h]=o.useState(0),i=y(),{data:c=0}=x({queryKey:["unreadMessagesCount"],queryFn:async()=>{const{data:{user:e}}=await r.auth.getUser();if(!e)return 0;const{data:a,error:s}=await r.from("conversation_participants").select("conversation_id, last_read_at").eq("user_id",e.id);if(s||!(a!=null&&a.length))return console.error("Error fetching user participations:",s),0;let p=0;for(const d of a){const m=d.last_read_at;let u=r.from("conversation_messages").select("*",{count:"exact",head:!0}).eq("conversation_id",d.conversation_id).neq("sender_id",e.id);m&&(u=u.gt("created_at",m));const{count:g,error:f}=await u;if(f){console.error("Error fetching unread messages for conversation:",d.conversation_id,f);continue}p+=g||0}return p},refetchInterval:1e4}),{data:E=0}=x({queryKey:["unreadNotificationsCount"],queryFn:async()=>{const{data:{user:e}}=await r.auth.getUser();if(!e)return 0;const{count:a,error:s}=await r.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",e.id).eq("is_read",!1);return s?(console.error("Error fetching unread notifications count:",s),0):a||0},refetchInterval:5e3});o.useEffect(()=>{(async()=>{const{data:{user:a}}=await r.auth.getUser();if(!a)return;const s=r.channel("navigation-updates").on("postgres_changes",{event:"*",schema:"public",table:"conversation_messages"},()=>{i.invalidateQueries({queryKey:["unreadMessagesCount"]})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"conversation_participants",filter:`user_id=eq.${a==null?void 0:a.id}`},()=>{i.invalidateQueries({queryKey:["unreadMessagesCount"]})}).subscribe();return()=>{r.removeChannel(s)}})()},[i]);const l=o.useMemo(()=>[{path:"/",label:"Explore",icon:t.jsx(j,{className:"w-5 h-5"}),activeIndex:0},{path:"/map",label:"Map",icon:t.jsx(q,{className:"w-5 h-5"}),activeIndex:1},{path:"/bookings",label:"Bookings",icon:t.jsx(M,{className:"w-5 h-5"}),activeIndex:2},{path:"/messages",label:"Inbox",icon:t.jsx(I,{className:"w-5 h-5"}),activeIndex:3,badge:c>0?c:void 0},{path:"/profile",label:"Profile",icon:t.jsx(C,{className:"w-5 h-5"}),activeIndex:4}],[c]);return o.useEffect(()=>{const e=l.find(a=>a.path==="/bookings"?n.pathname==="/bookings"||n.pathname==="/host-bookings"||n.pathname==="/renter-bookings":n.pathname===a.path);e&&h(e.activeIndex)},[n.pathname,l]),t.jsx("div",{className:"fixed bottom-4 left-0 right-0 z-50 flex justify-center px-4",children:t.jsx("nav",{className:"container max-w-md mx-auto bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 h-16",children:t.jsx("div",{className:"grid grid-cols-5 h-full w-full",children:l.map(e=>t.jsxs(k,{to:e.path,className:w("flex flex-col items-center justify-center h-full transition-all duration-200 px-1 relative hover-scale",v===e.activeIndex?"text-primary dark:text-primary animate-scale-in":"text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary"),onClick:()=>h(e.activeIndex),children:[t.jsxs("div",{className:"relative",children:[e.icon,e.badge&&t.jsx(N,{variant:"destructive",className:"absolute -top-2 -right-2 min-w-5 h-5 flex items-center justify-center p-0 text-xs animate-pulse",children:e.badge>99?"99+":e.badge})]}),t.jsx("span",{className:"text-xs mt-1",children:e.label})]},e.path))})})})};export{M as C,S as N};

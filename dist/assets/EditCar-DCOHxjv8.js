import{u as w,j as t}from"./query-vendor-BOSMW7hd.js";import{k as S,u as E,r as n}from"./react-vendor-DmU5vXC9.js";import{l as F,u as C,B as k,q,s as o}from"./index-ByqmTec-.js";import{N as f}from"./Navigation-fdodg-AN.js";import{C as I}from"./CarForm-CWubHY7u.js";import"./supabase-vendor-B3A6ooRR.js";import"./mapbox-vendor-ueN8uhVJ.js";import"./date-vendor-Dhms5dOu.js";import"./map-pin-B-9tSSOy.js";import"./bell-sR4KUoYm.js";import"./user-CrwdbYLY.js";import"./select-qP77FLvJ.js";import"./index-CEVvJeOa.js";import"./chevron-down-CR2ALfoj.js";import"./ImageUpload-BsQJsqxt.js";import"./camera-DAu_2Lp7.js";import"./separator-D3RZtFXH.js";import"./checkbox-D4Yx9lnD.js";const X=()=>{const{id:a}=S(),c=E(),{toast:l}=F(),{theme:P}=C(),[x,d]=n.useState(!1),[u,m]=n.useState([]),y={brand:"",model:"",year:new Date().getFullYear(),vehicle_type:"",price_per_day:"",location:"",transmission:"",fuel:"",seats:0,description:"",latitude:0,longitude:0,features:[]},{data:e,isLoading:b}=w({queryKey:["car",a],queryFn:async()=>{const{data:s,error:r}=await o.from("cars").select("*").eq("id",a).single();if(r)throw r;return s}});n.useEffect(()=>{e&&m(e.features||[])},[e]);const v=async(s,r)=>{d(!0);try{let i=e==null?void 0:e.image_url;if(r){const j=r.name.split(".").pop(),g=`${crypto.randomUUID()}.${j}`,{error:h}=await o.storage.from("car-images").upload(g,r);if(h)throw h;const{data:{publicUrl:N}}=o.storage.from("car-images").getPublicUrl(g);i=N}const{error:p}=await o.from("cars").update({image_url:i,price_per_day:parseFloat(s.price_per_day),year:parseInt(s.year.toString()),seats:parseInt(s.seats.toString()),brand:s.brand,model:s.model,vehicle_type:s.vehicle_type,location:s.location,transmission:s.transmission,fuel:s.fuel,description:s.description,features:u}).eq("id",a);if(p)throw p;l({title:"Success",description:"Your car has been updated successfully!"}),c(`/cars/${a}`)}catch(i){console.error("Error updating car:",i),l({title:"Error",description:"Failed to update your car. Please try again.",variant:"destructive"})}finally{d(!1)}};if(b)return t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsx("div",{className:"max-w-2xl mx-auto p-4",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-8 bg-muted rounded w-1/2"}),t.jsx("div",{className:"h-64 bg-muted rounded"})]})}),t.jsx(f,{})]});const _=e?{brand:e.brand,model:e.model,year:e.year,vehicle_type:e.vehicle_type,price_per_day:e.price_per_day.toString(),location:e.location,transmission:e.transmission,fuel:e.fuel,seats:e.seats,description:e.description||"",latitude:e.latitude||0,longitude:e.longitude||0,features:e.features||[]}:y;return t.jsxs("div",{className:"min-h-screen bg-background text-foreground pb-20",children:[t.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(k,{variant:"ghost",size:"icon",onClick:()=>c(-1),className:"shrink-0",children:t.jsx(q,{className:"h-5 w-5"})}),t.jsx("h1",{className:"text-2xl font-semibold",children:"Edit Car"})]}),t.jsx(I,{initialData:_,selectedFeatures:u,onFeaturesChange:m,isEdit:!0,carId:a,onSubmit:v,isSubmitting:x})]}),t.jsx(f,{})]})};export{X as default};

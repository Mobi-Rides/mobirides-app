var i=Object.defineProperty;var u=(o,s,e)=>s in o?i(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var m=(o,s,e)=>u(o,typeof s!="symbol"?s+"":s,e);import{s as l}from"./index-DJr5SZzu.js";import"./mapbox-vendor-fnXFVHMy.js";import"./query-vendor-C7aRRP05.js";import"./react-vendor-mnpoGfEl.js";import"./supabase-vendor-BOn0LdFJ.js";import"./date-vendor-Dhms5dOu.js";const n=class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}constructor(){console.log("üöÄ TwilioNotificationService initialized")}async sendWhatsApp(s,e,t){try{const{data:a,error:r}=await l.functions.invoke("send-whatsapp",{body:{to:s.startsWith("+")?s:`+${s}`,templateSid:e,variables:t}});if(r)throw r;return console.log(`‚úÖ WhatsApp sent successfully: ${a.messageId}`),{success:!0,messageId:a.messageId}}catch(a){return console.error("‚ùå WhatsApp sending failed:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}async sendEmail(s,e,t,a){try{const{data:r,error:c}=await l.functions.invoke("send-email",{body:{to:s,templateId:e,dynamicData:{...t,companyName:"MobiRides",supportEmail:"support@mobirides.com",year:new Date().getFullYear()},subject:a}});if(c)throw c;return console.log(`‚úÖ Email sent successfully to ${s}`),{success:!0,messageId:r.messageId}}catch(r){return console.error("‚ùå Email sending failed:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async sendBookingConfirmation(s,e){const t={};if(s.whatsappEnabled&&s.phone){const a=await this.sendWhatsApp(s.phone,"BOOKING_CONFIRMATION_TEMPLATE",{1:s.name,2:e.bookingReference,3:`${e.carBrand} ${e.carModel}`,4:e.pickupDate,5:e.pickupTime,6:e.pickupLocation});t.whatsapp=a}if(s.emailEnabled&&s.email){const a=await this.sendEmail(s.email,"booking-confirmation",{customerName:s.name,bookingReference:e.bookingReference,carDetails:`${e.carBrand} ${e.carModel}`,pickupDate:e.pickupDate,pickupTime:e.pickupTime,pickupLocation:e.pickupLocation,dropoffLocation:e.dropoffLocation,totalAmount:e.totalAmount,hostName:e.hostName});t.email=a}return t}async sendPickupReminder(s,e,t){const a={},r=t===24?"tomorrow":`in ${t} hours`;if(s.whatsappEnabled&&s.phone){const c=await this.sendWhatsApp(s.phone,"PICKUP_REMINDER_TEMPLATE",{1:s.name,2:`${e.carBrand} ${e.carModel}`,3:r,4:e.pickupLocation,5:e.pickupTime});a.whatsapp=c}return a}async sendEarlyReturnNotification(s,e,t){const a={};if(s.whatsappEnabled&&s.phone){const r=await this.sendWhatsApp(s.phone,"EARLY_RETURN_TEMPLATE",{1:s.name,2:e.bookingReference,3:`${e.carBrand} ${e.carModel}`,4:t,5:e.hostName});a.whatsapp=r}if(s.emailEnabled&&s.email){const r=await this.sendEmail(s.email,"early-return-notification",{customerName:s.name,bookingReference:e.bookingReference,carDetails:`${e.carBrand} ${e.carModel}`,actualReturnDate:t,originalEndDate:e.pickupDate,hostName:e.hostName,totalAmount:e.totalAmount},"Early Return Notification - Booking Completed");a.email=r}return a}};m(n,"instance");let p=n;export{p as TwilioNotificationService};

var U=Object.defineProperty;var V=(o,n,i)=>n in o?U(o,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[n]=i;var N=(o,n,i)=>V(o,typeof n!="symbol"?n+"":n,i);import{j as e}from"./query-vendor-C7aRRP05.js";import{r as w}from"./react-vendor-mnpoGfEl.js";import{C as h,a as T,b as x,c as p,d as j}from"./card-BYz0HUlZ.js";import{f as k,I as E,B as f,z as O,a8 as A,v as B}from"./index-CV3rVyoS.js";import{S}from"./settings-CzuPzsxf.js";import{C as g}from"./clock-DmPI1L3z.js";import{C as R}from"./circle-check-big-vUkh3tr9.js";import{M as b}from"./mail-BHRmIhQv.js";import{C as D}from"./circle-x-BZZBE6d0.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";class J{constructor(){N(this,"baseUrl");N(this,"testEmail","test@mobirides.com");this.baseUrl="http://localhost:3001/api"}setTestEmail(n){this.testEmail=n}async testSendConfirmationEmail(n){console.log("🧪 Testing send confirmation email via backend API...");const i=n||this.testEmail;try{const r=await fetch(`${this.baseUrl}/email/confirm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"send",email:i,fullName:"Test User",password:"testpassword123",phoneNumber:"+26771234567"})}),t=await r.json();return!r.ok||!t.success?(console.error("❌ Send confirmation email test failed:",t.error),{success:!1,error:t.error||"Failed to send confirmation email",testName:"Send Confirmation Email Test"}):(console.log("✅ Send confirmation email test successful:",t.messageId),{success:!0,messageId:t.messageId,token:t.token,testName:"Send Confirmation Email Test"})}catch(r){const t=r instanceof Error?r.message:"Unknown error occurred";return console.error("❌ Send confirmation email test exception:",t),{success:!1,error:t,testName:"Send Confirmation Email Test"}}}async testVerifyConfirmationToken(n){console.log("🧪 Testing verify confirmation token via backend API...");try{const i=await fetch(`${this.baseUrl}/email/confirm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"verify",token:n})}),r=await i.json();return!i.ok||!r.success?(console.error("❌ Verify confirmation token test failed:",r.error),{success:!1,error:r.error||"Failed to verify confirmation token",testName:"Verify Confirmation Token Test"}):(console.log("✅ Verify confirmation token test successful:",r.userData),{success:!0,testName:"Verify Confirmation Token Test"})}catch(i){const r=i instanceof Error?i.message:"Unknown error occurred";return console.error("❌ Verify confirmation token test exception:",r),{success:!1,error:r,testName:"Verify Confirmation Token Test"}}}async testResendConfirmationEmail(n){console.log("🧪 Testing resend confirmation email via backend API...");const i=n||this.testEmail;try{const r=await fetch(`${this.baseUrl}/email/confirm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"resend",email:i})}),t=await r.json();return!r.ok||!t.success?(console.error("❌ Resend confirmation email test failed:",t.error),{success:!1,error:t.error||"Failed to resend confirmation email",testName:"Resend Confirmation Email Test"}):(console.log("✅ Resend confirmation email test successful:",t.messageId),{success:!0,messageId:t.messageId,testName:"Resend Confirmation Email Test"})}catch(r){const t=r instanceof Error?r.message:"Unknown error occurred";return console.error("❌ Resend confirmation email test exception:",t),{success:!1,error:t,testName:"Resend Confirmation Email Test"}}}async testFullConfirmationFlow(n){console.log("🚀 Testing full email confirmation flow...");const i=n||this.testEmail,r=[],t=await this.testSendConfirmationEmail(i);r.push(t);let u;if(t.success&&t.token){u=t.token;const d=await this.testVerifyConfirmationToken(u);r.push(d)}const l=await this.testResendConfirmationEmail(i);r.push(l);const a={total:r.length,passed:r.filter(d=>d.success).length,failed:r.filter(d=>!d.success).length},C=a.failed===0;return console.log("📊 Full confirmation flow test summary:",a),{success:C,results:r,summary:a}}async testSMTPConfiguration(){console.log("🧪 Testing SMTP configuration...");try{const n=await this.testSendConfirmationEmail("test@example.com");return n.success?{success:!0,testName:"SMTP Configuration Test",messageId:n.messageId}:{success:!1,error:n.error&&(n.error.includes("SMTP")||n.error.includes("authentication")||n.error.includes("EAUTH")||n.error.includes("Invalid login")||n.error.includes("ENOTFOUND"))?n.error:"SMTP configuration appears to be working, but email sending failed",testName:"SMTP Configuration Test"}}catch(n){const i=n instanceof Error?n.message:"Unknown error occurred";return console.error("❌ SMTP configuration test exception:",i),{success:!1,error:i,testName:"SMTP Configuration Test"}}}}const c=new J,{testSendConfirmationEmail:ee,testVerifyConfirmationToken:se,testResendConfirmationEmail:te,testFullConfirmationFlow:ne,testSMTPConfiguration:re,setTestEmail:ie}=c,ae=()=>{const[o,n]=w.useState("test@mobirides.com"),[i,r]=w.useState(""),[t,u]=w.useState({isRunning:!1,results:[],currentTest:""}),l=s=>{u(m=>({...m,...s}))},a=s=>{u(m=>({...m,results:[...m.results,s]}))},C=()=>{u({isRunning:!1,results:[],currentTest:"",fullFlowResults:void 0})},d=async()=>{l({isRunning:!0,currentTest:"Send Confirmation Email"});try{c.setTestEmail(o);const s=await c.testSendConfirmationEmail(o);a(s),s.success&&s.token&&r(s.token)}catch(s){a({success:!1,error:s instanceof Error?s.message:"Unknown error",testName:"Send Confirmation Email Test"})}finally{l({isRunning:!1,currentTest:""})}},v=async()=>{if(!i.trim()){a({success:!1,error:"Please provide a token to verify",testName:"Verify Confirmation Token Test"});return}l({isRunning:!0,currentTest:"Verify Confirmation Token"});try{const s=await c.testVerifyConfirmationToken(i);a(s)}catch(s){a({success:!1,error:s instanceof Error?s.message:"Unknown error",testName:"Verify Confirmation Token Test"})}finally{l({isRunning:!1,currentTest:""})}},F=async()=>{l({isRunning:!0,currentTest:"Resend Confirmation Email"});try{c.setTestEmail(o);const s=await c.testResendConfirmationEmail(o);a(s)}catch(s){a({success:!1,error:s instanceof Error?s.message:"Unknown error",testName:"Resend Confirmation Email Test"})}finally{l({isRunning:!1,currentTest:""})}},P=async()=>{l({isRunning:!0,currentTest:"SMTP Configuration Test"});try{const s=await c.testSMTPConfiguration();a(s)}catch(s){a({success:!1,error:s instanceof Error?s.message:"Unknown error",testName:"SMTP Configuration Test"})}finally{l({isRunning:!1,currentTest:""})}},M=async()=>{l({isRunning:!0,currentTest:"Full Confirmation Flow"});try{c.setTestEmail(o);const s=await c.testFullConfirmationFlow(o);l({fullFlowResults:s}),s.results.forEach(m=>a(m))}catch(s){a({success:!1,error:s instanceof Error?s.message:"Unknown error",testName:"Full Confirmation Flow Test"})}finally{l({isRunning:!1,currentTest:""})}},I=s=>s?e.jsx(R,{className:"h-4 w-4 text-green-500"}):e.jsx(D,{className:"h-4 w-4 text-red-500"}),y=s=>e.jsx(B,{variant:s?"default":"destructive",children:s?"PASS":"FAIL"});return e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Email Confirmation Test Suite"}),e.jsx("p",{className:"text-muted-foreground",children:"Test the email confirmation service with SMTP configuration (smtp.resend.com:2465)"})]}),e.jsxs(h,{className:"mb-6",children:[e.jsxs(T,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Test Configuration"]}),e.jsx(p,{children:"Configure test parameters before running tests"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"testEmail",children:"Test Email Address"}),e.jsx(E,{id:"testEmail",type:"email",value:o,onChange:s=>n(s.target.value),placeholder:"test@mobirides.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"testToken",children:"Confirmation Token (for verify test)"}),e.jsx(E,{id:"testToken",value:i,onChange:s=>r(s.target.value),placeholder:"Token from send test..."})]})]}),e.jsx(f,{onClick:C,variant:"outline",className:"w-full",disabled:t.isRunning,children:"Clear Results"})]})]}),e.jsxs(h,{className:"mb-6",children:[e.jsxs(T,{children:[e.jsx(x,{children:"Individual Tests"}),e.jsx(p,{children:"Run specific email confirmation tests"})]}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(f,{onClick:d,disabled:t.isRunning,className:"flex items-center gap-2",children:[t.currentTest==="Send Confirmation Email"?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsx(O,{className:"h-4 w-4"}),"Send Email"]}),e.jsxs(f,{onClick:v,disabled:t.isRunning||!i.trim(),variant:"outline",className:"flex items-center gap-2",children:[t.currentTest==="Verify Confirmation Token"?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsx(R,{className:"h-4 w-4"}),"Verify Token"]}),e.jsxs(f,{onClick:F,disabled:t.isRunning,variant:"outline",className:"flex items-center gap-2",children:[t.currentTest==="Resend Confirmation Email"?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsx(A,{className:"h-4 w-4"}),"Resend Email"]}),e.jsxs(f,{onClick:P,disabled:t.isRunning,variant:"outline",className:"flex items-center gap-2",children:[t.currentTest==="SMTP Configuration Test"?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsx(S,{className:"h-4 w-4"}),"Test SMTP"]})]})})]}),e.jsxs(h,{className:"mb-6",children:[e.jsxs(T,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"Full Confirmation Flow Test"]}),e.jsx(p,{children:"Run the complete email confirmation workflow"})]}),e.jsxs(j,{children:[e.jsxs(f,{onClick:M,disabled:t.isRunning,className:"w-full flex items-center gap-2",size:"lg",children:[t.currentTest==="Full Confirmation Flow"?e.jsx(g,{className:"h-5 w-5 animate-spin"}):e.jsx(b,{className:"h-5 w-5"}),"Run Full Flow Test"]}),t.fullFlowResults&&e.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Flow Test Summary"}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("span",{children:["Total: ",t.fullFlowResults.summary.total]}),e.jsxs("span",{className:"text-green-600",children:["Passed: ",t.fullFlowResults.summary.passed]}),e.jsxs("span",{className:"text-red-600",children:["Failed: ",t.fullFlowResults.summary.failed]})]}),e.jsx("div",{className:"mt-2",children:y(t.fullFlowResults.success)})]})]})]}),t.results.length>0&&e.jsxs(h,{children:[e.jsxs(T,{children:[e.jsx(x,{children:"Test Results"}),e.jsx(p,{children:"Results from executed tests"})]}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:t.results.map((s,m)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[I(s.success),e.jsx("h4",{className:"font-semibold",children:s.testName})]}),y(s.success)]}),s.messageId&&e.jsxs("div",{className:"text-sm text-muted-foreground mb-1",children:[e.jsx("strong",{children:"Message ID:"})," ",s.messageId]}),s.token&&e.jsxs("div",{className:"text-sm text-muted-foreground mb-1",children:[e.jsx("strong",{children:"Token:"})," ",e.jsx("code",{className:"bg-muted px-1 rounded",children:s.token})]}),s.error&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded mt-2",children:[e.jsx("strong",{children:"Error:"})," ",s.error]})]},m))})})]}),t.isRunning&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-primary text-primary-foreground px-4 py-2 rounded-lg shadow-lg flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 animate-spin"}),"Running: ",t.currentTest]})]})};export{ae as default};

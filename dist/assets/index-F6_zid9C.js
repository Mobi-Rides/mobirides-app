var NU=Object.defineProperty;var qk=e=>{throw TypeError(e)};var FU=(e,t,i)=>t in e?NU(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var s1=(e,t,i)=>FU(e,typeof t!="symbol"?t+"":t,i),JS=(e,t,i)=>t.has(e)||qk("Cannot "+i);var nt=(e,t,i)=>(JS(e,t,"read from private field"),i?i.call(e):t.get(e)),Hr=(e,t,i)=>t.has(e)?qk("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),Sr=(e,t,i,a)=>(JS(e,t,"write to private field"),a?a.call(e,i):t.set(e,i),i),wn=(e,t,i)=>(JS(e,t,"access private method"),i);var a1=(e,t,i,a)=>({set _(d){Sr(e,t,d,i)},get _(){return nt(e,t,a)}});function jU(e,t){for(var i=0;i<t.length;i++){const a=t[i];if(typeof a!="string"&&!Array.isArray(a)){for(const d in a)if(d!=="default"&&!(d in e)){const _=Object.getOwnPropertyDescriptor(a,d);_&&Object.defineProperty(e,d,_.get?_:{enumerable:!0,get:()=>a[d]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const _ of d)if(_.type==="childList")for(const b of _.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&a(b)}).observe(document,{childList:!0,subtree:!0});function i(d){const _={};return d.integrity&&(_.integrity=d.integrity),d.referrerPolicy&&(_.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?_.credentials="include":d.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function a(d){if(d.ep)return;d.ep=!0;const _=i(d);fetch(d.href,_)}})();var ua=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function r3(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function BU(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function a(){return this instanceof a?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(a){var d=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(i,a,d.get?d:{enumerable:!0,get:function(){return e[a]}})}),i}var W4={exports:{}},iw={},Z4={exports:{}},kn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U0=Symbol.for("react.element"),UU=Symbol.for("react.portal"),VU=Symbol.for("react.fragment"),$U=Symbol.for("react.strict_mode"),GU=Symbol.for("react.profiler"),HU=Symbol.for("react.provider"),qU=Symbol.for("react.context"),WU=Symbol.for("react.forward_ref"),ZU=Symbol.for("react.suspense"),YU=Symbol.for("react.memo"),XU=Symbol.for("react.lazy"),Wk=Symbol.iterator;function KU(e){return e===null||typeof e!="object"?null:(e=Wk&&e[Wk]||e["@@iterator"],typeof e=="function"?e:null)}var Y4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},X4=Object.assign,K4={};function _g(e,t,i){this.props=e,this.context=t,this.refs=K4,this.updater=i||Y4}_g.prototype.isReactComponent={};_g.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};_g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function J4(){}J4.prototype=_g.prototype;function n3(e,t,i){this.props=e,this.context=t,this.refs=K4,this.updater=i||Y4}var i3=n3.prototype=new J4;i3.constructor=n3;X4(i3,_g.prototype);i3.isPureReactComponent=!0;var Zk=Array.isArray,Q4=Object.prototype.hasOwnProperty,o3={current:null},eL={key:!0,ref:!0,__self:!0,__source:!0};function tL(e,t,i){var a,d={},_=null,b=null;if(t!=null)for(a in t.ref!==void 0&&(b=t.ref),t.key!==void 0&&(_=""+t.key),t)Q4.call(t,a)&&!eL.hasOwnProperty(a)&&(d[a]=t[a]);var o=arguments.length-2;if(o===1)d.children=i;else if(1<o){for(var k=Array(o),O=0;O<o;O++)k[O]=arguments[O+2];d.children=k}if(e&&e.defaultProps)for(a in o=e.defaultProps,o)d[a]===void 0&&(d[a]=o[a]);return{$$typeof:U0,type:e,key:_,ref:b,props:d,_owner:o3.current}}function JU(e,t){return{$$typeof:U0,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function s3(e){return typeof e=="object"&&e!==null&&e.$$typeof===U0}function QU(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var Yk=/\/+/g;function QS(e,t){return typeof e=="object"&&e!==null&&e.key!=null?QU(""+e.key):t.toString(36)}function B1(e,t,i,a,d){var _=typeof e;(_==="undefined"||_==="boolean")&&(e=null);var b=!1;if(e===null)b=!0;else switch(_){case"string":case"number":b=!0;break;case"object":switch(e.$$typeof){case U0:case UU:b=!0}}if(b)return b=e,d=d(b),e=a===""?"."+QS(b,0):a,Zk(d)?(i="",e!=null&&(i=e.replace(Yk,"$&/")+"/"),B1(d,t,i,"",function(O){return O})):d!=null&&(s3(d)&&(d=JU(d,i+(!d.key||b&&b.key===d.key?"":(""+d.key).replace(Yk,"$&/")+"/")+e)),t.push(d)),1;if(b=0,a=a===""?".":a+":",Zk(e))for(var o=0;o<e.length;o++){_=e[o];var k=a+QS(_,o);b+=B1(_,t,i,k,d)}else if(k=KU(e),typeof k=="function")for(e=k.call(e),o=0;!(_=e.next()).done;)_=_.value,k=a+QS(_,o++),b+=B1(_,t,i,k,d);else if(_==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return b}function l1(e,t,i){if(e==null)return e;var a=[],d=0;return B1(e,a,"","",function(_){return t.call(i,_,d++)}),a}function eV(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var vs={current:null},U1={transition:null},tV={ReactCurrentDispatcher:vs,ReactCurrentBatchConfig:U1,ReactCurrentOwner:o3};function rL(){throw Error("act(...) is not supported in production builds of React.")}kn.Children={map:l1,forEach:function(e,t,i){l1(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return l1(e,function(){t++}),t},toArray:function(e){return l1(e,function(t){return t})||[]},only:function(e){if(!s3(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};kn.Component=_g;kn.Fragment=VU;kn.Profiler=GU;kn.PureComponent=n3;kn.StrictMode=$U;kn.Suspense=ZU;kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tV;kn.act=rL;kn.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=X4({},e.props),d=e.key,_=e.ref,b=e._owner;if(t!=null){if(t.ref!==void 0&&(_=t.ref,b=o3.current),t.key!==void 0&&(d=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(k in t)Q4.call(t,k)&&!eL.hasOwnProperty(k)&&(a[k]=t[k]===void 0&&o!==void 0?o[k]:t[k])}var k=arguments.length-2;if(k===1)a.children=i;else if(1<k){o=Array(k);for(var O=0;O<k;O++)o[O]=arguments[O+2];a.children=o}return{$$typeof:U0,type:e.type,key:d,ref:_,props:a,_owner:b}};kn.createContext=function(e){return e={$$typeof:qU,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:HU,_context:e},e.Consumer=e};kn.createElement=tL;kn.createFactory=function(e){var t=tL.bind(null,e);return t.type=e,t};kn.createRef=function(){return{current:null}};kn.forwardRef=function(e){return{$$typeof:WU,render:e}};kn.isValidElement=s3;kn.lazy=function(e){return{$$typeof:XU,_payload:{_status:-1,_result:e},_init:eV}};kn.memo=function(e,t){return{$$typeof:YU,type:e,compare:t===void 0?null:t}};kn.startTransition=function(e){var t=U1.transition;U1.transition={};try{e()}finally{U1.transition=t}};kn.unstable_act=rL;kn.useCallback=function(e,t){return vs.current.useCallback(e,t)};kn.useContext=function(e){return vs.current.useContext(e)};kn.useDebugValue=function(){};kn.useDeferredValue=function(e){return vs.current.useDeferredValue(e)};kn.useEffect=function(e,t){return vs.current.useEffect(e,t)};kn.useId=function(){return vs.current.useId()};kn.useImperativeHandle=function(e,t,i){return vs.current.useImperativeHandle(e,t,i)};kn.useInsertionEffect=function(e,t){return vs.current.useInsertionEffect(e,t)};kn.useLayoutEffect=function(e,t){return vs.current.useLayoutEffect(e,t)};kn.useMemo=function(e,t){return vs.current.useMemo(e,t)};kn.useReducer=function(e,t,i){return vs.current.useReducer(e,t,i)};kn.useRef=function(e){return vs.current.useRef(e)};kn.useState=function(e){return vs.current.useState(e)};kn.useSyncExternalStore=function(e,t,i){return vs.current.useSyncExternalStore(e,t,i)};kn.useTransition=function(){return vs.current.useTransition()};kn.version="18.3.1";Z4.exports=kn;var Y=Z4.exports;const Fe=r3(Y),nL=jU({__proto__:null,default:Fe},[Y]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rV=Y,nV=Symbol.for("react.element"),iV=Symbol.for("react.fragment"),oV=Object.prototype.hasOwnProperty,sV=rV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,aV={key:!0,ref:!0,__self:!0,__source:!0};function iL(e,t,i){var a,d={},_=null,b=null;i!==void 0&&(_=""+i),t.key!==void 0&&(_=""+t.key),t.ref!==void 0&&(b=t.ref);for(a in t)oV.call(t,a)&&!aV.hasOwnProperty(a)&&(d[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps,t)d[a]===void 0&&(d[a]=t[a]);return{$$typeof:nV,type:e,key:_,ref:b,props:d,_owner:sV.current}}iw.Fragment=iV;iw.jsx=iL;iw.jsxs=iL;W4.exports=iw;var L=W4.exports,oL={exports:{}},fa={},sL={exports:{}},aL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(st,yt){var ir=st.length;st.push(yt);e:for(;0<ir;){var yr=ir-1>>>1,Wr=st[yr];if(0<d(Wr,yt))st[yr]=yt,st[ir]=Wr,ir=yr;else break e}}function i(st){return st.length===0?null:st[0]}function a(st){if(st.length===0)return null;var yt=st[0],ir=st.pop();if(ir!==yt){st[0]=ir;e:for(var yr=0,Wr=st.length,rr=Wr>>>1;yr<rr;){var dn=2*(yr+1)-1,Dn=st[dn],sn=dn+1,cr=st[sn];if(0>d(Dn,ir))sn<Wr&&0>d(cr,Dn)?(st[yr]=cr,st[sn]=ir,yr=sn):(st[yr]=Dn,st[dn]=ir,yr=dn);else if(sn<Wr&&0>d(cr,ir))st[yr]=cr,st[sn]=ir,yr=sn;else break e}}return yt}function d(st,yt){var ir=st.sortIndex-yt.sortIndex;return ir!==0?ir:st.id-yt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;e.unstable_now=function(){return _.now()}}else{var b=Date,o=b.now();e.unstable_now=function(){return b.now()-o}}var k=[],O=[],z=1,F=null,G=3,ee=!1,J=!1,te=!1,oe=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(st){for(var yt=i(O);yt!==null;){if(yt.callback===null)a(O);else if(yt.startTime<=st)a(O),yt.sortIndex=yt.expirationTime,t(k,yt);else break;yt=i(O)}}function he(st){if(te=!1,ue(st),!J)if(i(k)!==null)J=!0,jt(Ie);else{var yt=i(O);yt!==null&&Ct(he,yt.startTime-st)}}function Ie(st,yt){J=!1,te&&(te=!1,X(Ze),Ze=-1),ee=!0;var ir=G;try{for(ue(yt),F=i(k);F!==null&&(!(F.expirationTime>yt)||st&&!qe());){var yr=F.callback;if(typeof yr=="function"){F.callback=null,G=F.priorityLevel;var Wr=yr(F.expirationTime<=yt);yt=e.unstable_now(),typeof Wr=="function"?F.callback=Wr:F===i(k)&&a(k),ue(yt)}else a(k);F=i(k)}if(F!==null)var rr=!0;else{var dn=i(O);dn!==null&&Ct(he,dn.startTime-yt),rr=!1}return rr}finally{F=null,G=ir,ee=!1}}var Je=!1,Ce=null,Ze=-1,et=5,Ge=-1;function qe(){return!(e.unstable_now()-Ge<et)}function _t(){if(Ce!==null){var st=e.unstable_now();Ge=st;var yt=!0;try{yt=Ce(!0,st)}finally{yt?Rt():(Je=!1,Ce=null)}}else Je=!1}var Rt;if(typeof Q=="function")Rt=function(){Q(_t)};else if(typeof MessageChannel<"u"){var Wt=new MessageChannel,wt=Wt.port2;Wt.port1.onmessage=_t,Rt=function(){wt.postMessage(null)}}else Rt=function(){oe(_t,0)};function jt(st){Ce=st,Je||(Je=!0,Rt())}function Ct(st,yt){Ze=oe(function(){st(e.unstable_now())},yt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(st){st.callback=null},e.unstable_continueExecution=function(){J||ee||(J=!0,jt(Ie))},e.unstable_forceFrameRate=function(st){0>st||125<st?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):et=0<st?Math.floor(1e3/st):5},e.unstable_getCurrentPriorityLevel=function(){return G},e.unstable_getFirstCallbackNode=function(){return i(k)},e.unstable_next=function(st){switch(G){case 1:case 2:case 3:var yt=3;break;default:yt=G}var ir=G;G=yt;try{return st()}finally{G=ir}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(st,yt){switch(st){case 1:case 2:case 3:case 4:case 5:break;default:st=3}var ir=G;G=st;try{return yt()}finally{G=ir}},e.unstable_scheduleCallback=function(st,yt,ir){var yr=e.unstable_now();switch(typeof ir=="object"&&ir!==null?(ir=ir.delay,ir=typeof ir=="number"&&0<ir?yr+ir:yr):ir=yr,st){case 1:var Wr=-1;break;case 2:Wr=250;break;case 5:Wr=1073741823;break;case 4:Wr=1e4;break;default:Wr=5e3}return Wr=ir+Wr,st={id:z++,callback:yt,priorityLevel:st,startTime:ir,expirationTime:Wr,sortIndex:-1},ir>yr?(st.sortIndex=ir,t(O,st),i(k)===null&&st===i(O)&&(te?(X(Ze),Ze=-1):te=!0,Ct(he,ir-yr))):(st.sortIndex=Wr,t(k,st),J||ee||(J=!0,jt(Ie))),st},e.unstable_shouldYield=qe,e.unstable_wrapCallback=function(st){var yt=G;return function(){var ir=G;G=yt;try{return st.apply(this,arguments)}finally{G=ir}}}})(aL);sL.exports=aL;var lV=sL.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cV=Y,da=lV;function er(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lL=new Set,o0={};function Pf(e,t){tg(e,t),tg(e+"Capture",t)}function tg(e,t){for(o0[e]=t,e=0;e<t.length;e++)lL.add(t[e])}var Xc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lE=Object.prototype.hasOwnProperty,uV=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Xk={},Kk={};function dV(e){return lE.call(Kk,e)?!0:lE.call(Xk,e)?!1:uV.test(e)?Kk[e]=!0:(Xk[e]=!0,!1)}function hV(e,t,i,a){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return a?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function fV(e,t,i,a){if(t===null||typeof t>"u"||hV(e,t,i,a))return!0;if(a)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function xs(e,t,i,a,d,_,b){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=a,this.attributeNamespace=d,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=_,this.removeEmptyString=b}var Vo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Vo[e]=new xs(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Vo[t]=new xs(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Vo[e]=new xs(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Vo[e]=new xs(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Vo[e]=new xs(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Vo[e]=new xs(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Vo[e]=new xs(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Vo[e]=new xs(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Vo[e]=new xs(e,5,!1,e.toLowerCase(),null,!1,!1)});var a3=/[\-:]([a-z])/g;function l3(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(a3,l3);Vo[t]=new xs(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(a3,l3);Vo[t]=new xs(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(a3,l3);Vo[t]=new xs(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Vo[e]=new xs(e,1,!1,e.toLowerCase(),null,!1,!1)});Vo.xlinkHref=new xs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Vo[e]=new xs(e,1,!1,e.toLowerCase(),null,!0,!0)});function c3(e,t,i,a){var d=Vo.hasOwnProperty(t)?Vo[t]:null;(d!==null?d.type!==0:a||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(fV(t,i,d,a)&&(i=null),a||d===null?dV(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):d.mustUseProperty?e[d.propertyName]=i===null?d.type===3?!1:"":i:(t=d.attributeName,a=d.attributeNamespace,i===null?e.removeAttribute(t):(d=d.type,i=d===3||d===4&&i===!0?"":""+i,a?e.setAttributeNS(a,t,i):e.setAttribute(t,i))))}var iu=cV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c1=Symbol.for("react.element"),ym=Symbol.for("react.portal"),vm=Symbol.for("react.fragment"),u3=Symbol.for("react.strict_mode"),cE=Symbol.for("react.profiler"),cL=Symbol.for("react.provider"),uL=Symbol.for("react.context"),d3=Symbol.for("react.forward_ref"),uE=Symbol.for("react.suspense"),dE=Symbol.for("react.suspense_list"),h3=Symbol.for("react.memo"),sd=Symbol.for("react.lazy"),dL=Symbol.for("react.offscreen"),Jk=Symbol.iterator;function gy(e){return e===null||typeof e!="object"?null:(e=Jk&&e[Jk]||e["@@iterator"],typeof e=="function"?e:null)}var Bi=Object.assign,eT;function Oy(e){if(eT===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);eT=t&&t[1]||""}return`
`+eT+e}var tT=!1;function rT(e,t){if(!e||tT)return"";tT=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(O){var a=O}Reflect.construct(e,[],t)}else{try{t.call()}catch(O){a=O}e.call(t.prototype)}else{try{throw Error()}catch(O){a=O}e()}}catch(O){if(O&&a&&typeof O.stack=="string"){for(var d=O.stack.split(`
`),_=a.stack.split(`
`),b=d.length-1,o=_.length-1;1<=b&&0<=o&&d[b]!==_[o];)o--;for(;1<=b&&0<=o;b--,o--)if(d[b]!==_[o]){if(b!==1||o!==1)do if(b--,o--,0>o||d[b]!==_[o]){var k=`
`+d[b].replace(" at new "," at ");return e.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",e.displayName)),k}while(1<=b&&0<=o);break}}}finally{tT=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?Oy(e):""}function pV(e){switch(e.tag){case 5:return Oy(e.type);case 16:return Oy("Lazy");case 13:return Oy("Suspense");case 19:return Oy("SuspenseList");case 0:case 2:case 15:return e=rT(e.type,!1),e;case 11:return e=rT(e.type.render,!1),e;case 1:return e=rT(e.type,!0),e;default:return""}}function hE(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case vm:return"Fragment";case ym:return"Portal";case cE:return"Profiler";case u3:return"StrictMode";case uE:return"Suspense";case dE:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case uL:return(e.displayName||"Context")+".Consumer";case cL:return(e._context.displayName||"Context")+".Provider";case d3:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case h3:return t=e.displayName||null,t!==null?t:hE(e.type)||"Memo";case sd:t=e._payload,e=e._init;try{return hE(e(t))}catch{}}return null}function mV(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hE(t);case 8:return t===u3?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Nd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function hL(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function gV(e){var t=hL(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var d=i.get,_=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return d.call(this)},set:function(b){a=""+b,_.call(this,b)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return a},setValue:function(b){a=""+b},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function u1(e){e._valueTracker||(e._valueTracker=gV(e))}function fL(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),a="";return e&&(a=hL(e)?e.checked?"true":"false":e.value),e=a,e!==i?(t.setValue(e),!0):!1}function ab(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function fE(e,t){var i=t.checked;return Bi({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function Qk(e,t){var i=t.defaultValue==null?"":t.defaultValue,a=t.checked!=null?t.checked:t.defaultChecked;i=Nd(t.value!=null?t.value:i),e._wrapperState={initialChecked:a,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function pL(e,t){t=t.checked,t!=null&&c3(e,"checked",t,!1)}function pE(e,t){pL(e,t);var i=Nd(t.value),a=t.type;if(i!=null)a==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?mE(e,t.type,i):t.hasOwnProperty("defaultValue")&&mE(e,t.type,Nd(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function eR(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!(a!=="submit"&&a!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function mE(e,t,i){(t!=="number"||ab(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var zy=Array.isArray;function km(e,t,i,a){if(e=e.options,t){t={};for(var d=0;d<i.length;d++)t["$"+i[d]]=!0;for(i=0;i<e.length;i++)d=t.hasOwnProperty("$"+e[i].value),e[i].selected!==d&&(e[i].selected=d),d&&a&&(e[i].defaultSelected=!0)}else{for(i=""+Nd(i),t=null,d=0;d<e.length;d++){if(e[d].value===i){e[d].selected=!0,a&&(e[d].defaultSelected=!0);return}t!==null||e[d].disabled||(t=e[d])}t!==null&&(t.selected=!0)}}function gE(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(er(91));return Bi({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function tR(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(er(92));if(zy(i)){if(1<i.length)throw Error(er(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:Nd(i)}}function mL(e,t){var i=Nd(t.value),a=Nd(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),a!=null&&(e.defaultValue=""+a)}function rR(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function gL(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _E(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?gL(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var d1,_L=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,a,d){MSApp.execUnsafeLocalFunction(function(){return e(t,i,a,d)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(d1=d1||document.createElement("div"),d1.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=d1.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function s0(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Gy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_V=["Webkit","ms","Moz","O"];Object.keys(Gy).forEach(function(e){_V.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Gy[t]=Gy[e]})});function yL(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||Gy.hasOwnProperty(e)&&Gy[e]?(""+t).trim():t+"px"}function vL(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var a=i.indexOf("--")===0,d=yL(i,t[i],a);i==="float"&&(i="cssFloat"),a?e.setProperty(i,d):e[i]=d}}var yV=Bi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yE(e,t){if(t){if(yV[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(er(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(er(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(er(61))}if(t.style!=null&&typeof t.style!="object")throw Error(er(62))}}function vE(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xE=null;function f3(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var bE=null,Rm=null,Dm=null;function nR(e){if(e=G0(e)){if(typeof bE!="function")throw Error(er(280));var t=e.stateNode;t&&(t=cw(t),bE(e.stateNode,e.type,t))}}function xL(e){Rm?Dm?Dm.push(e):Dm=[e]:Rm=e}function bL(){if(Rm){var e=Rm,t=Dm;if(Dm=Rm=null,nR(e),t)for(e=0;e<t.length;e++)nR(t[e])}}function wL(e,t){return e(t)}function SL(){}var nT=!1;function TL(e,t,i){if(nT)return e(t,i);nT=!0;try{return wL(e,t,i)}finally{nT=!1,(Rm!==null||Dm!==null)&&(SL(),bL())}}function a0(e,t){var i=e.stateNode;if(i===null)return null;var a=cw(i);if(a===null)return null;i=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(er(231,t,typeof i));return i}var wE=!1;if(Xc)try{var _y={};Object.defineProperty(_y,"passive",{get:function(){wE=!0}}),window.addEventListener("test",_y,_y),window.removeEventListener("test",_y,_y)}catch{wE=!1}function vV(e,t,i,a,d,_,b,o,k){var O=Array.prototype.slice.call(arguments,3);try{t.apply(i,O)}catch(z){this.onError(z)}}var Hy=!1,lb=null,cb=!1,SE=null,xV={onError:function(e){Hy=!0,lb=e}};function bV(e,t,i,a,d,_,b,o,k){Hy=!1,lb=null,vV.apply(xV,arguments)}function wV(e,t,i,a,d,_,b,o,k){if(bV.apply(this,arguments),Hy){if(Hy){var O=lb;Hy=!1,lb=null}else throw Error(er(198));cb||(cb=!0,SE=O)}}function Af(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function EL(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function iR(e){if(Af(e)!==e)throw Error(er(188))}function SV(e){var t=e.alternate;if(!t){if(t=Af(e),t===null)throw Error(er(188));return t!==e?null:e}for(var i=e,a=t;;){var d=i.return;if(d===null)break;var _=d.alternate;if(_===null){if(a=d.return,a!==null){i=a;continue}break}if(d.child===_.child){for(_=d.child;_;){if(_===i)return iR(d),e;if(_===a)return iR(d),t;_=_.sibling}throw Error(er(188))}if(i.return!==a.return)i=d,a=_;else{for(var b=!1,o=d.child;o;){if(o===i){b=!0,i=d,a=_;break}if(o===a){b=!0,a=d,i=_;break}o=o.sibling}if(!b){for(o=_.child;o;){if(o===i){b=!0,i=_,a=d;break}if(o===a){b=!0,a=_,i=d;break}o=o.sibling}if(!b)throw Error(er(189))}}if(i.alternate!==a)throw Error(er(190))}if(i.tag!==3)throw Error(er(188));return i.stateNode.current===i?e:t}function CL(e){return e=SV(e),e!==null?ML(e):null}function ML(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=ML(e);if(t!==null)return t;e=e.sibling}return null}var PL=da.unstable_scheduleCallback,oR=da.unstable_cancelCallback,TV=da.unstable_shouldYield,EV=da.unstable_requestPaint,Qi=da.unstable_now,CV=da.unstable_getCurrentPriorityLevel,p3=da.unstable_ImmediatePriority,AL=da.unstable_UserBlockingPriority,ub=da.unstable_NormalPriority,MV=da.unstable_LowPriority,IL=da.unstable_IdlePriority,ow=null,tc=null;function PV(e){if(tc&&typeof tc.onCommitFiberRoot=="function")try{tc.onCommitFiberRoot(ow,e,void 0,(e.current.flags&128)===128)}catch{}}var pl=Math.clz32?Math.clz32:kV,AV=Math.log,IV=Math.LN2;function kV(e){return e>>>=0,e===0?32:31-(AV(e)/IV|0)|0}var h1=64,f1=4194304;function Ny(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function db(e,t){var i=e.pendingLanes;if(i===0)return 0;var a=0,d=e.suspendedLanes,_=e.pingedLanes,b=i&268435455;if(b!==0){var o=b&~d;o!==0?a=Ny(o):(_&=b,_!==0&&(a=Ny(_)))}else b=i&~d,b!==0?a=Ny(b):_!==0&&(a=Ny(_));if(a===0)return 0;if(t!==0&&t!==a&&!(t&d)&&(d=a&-a,_=t&-t,d>=_||d===16&&(_&4194240)!==0))return t;if(a&4&&(a|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=a;0<t;)i=31-pl(t),d=1<<i,a|=e[i],t&=~d;return a}function RV(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function DV(e,t){for(var i=e.suspendedLanes,a=e.pingedLanes,d=e.expirationTimes,_=e.pendingLanes;0<_;){var b=31-pl(_),o=1<<b,k=d[b];k===-1?(!(o&i)||o&a)&&(d[b]=RV(o,t)):k<=t&&(e.expiredLanes|=o),_&=~o}}function TE(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function kL(){var e=h1;return h1<<=1,!(h1&4194240)&&(h1=64),e}function iT(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function V0(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-pl(t),e[t]=i}function LV(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<i;){var d=31-pl(i),_=1<<d;t[d]=0,a[d]=-1,e[d]=-1,i&=~_}}function m3(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var a=31-pl(i),d=1<<a;d&t|e[a]&t&&(e[a]|=t),i&=~d}}var ai=0;function RL(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var DL,g3,LL,OL,zL,EE=!1,p1=[],Ed=null,Cd=null,Md=null,l0=new Map,c0=new Map,cd=[],OV="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sR(e,t){switch(e){case"focusin":case"focusout":Ed=null;break;case"dragenter":case"dragleave":Cd=null;break;case"mouseover":case"mouseout":Md=null;break;case"pointerover":case"pointerout":l0.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":c0.delete(t.pointerId)}}function yy(e,t,i,a,d,_){return e===null||e.nativeEvent!==_?(e={blockedOn:t,domEventName:i,eventSystemFlags:a,nativeEvent:_,targetContainers:[d]},t!==null&&(t=G0(t),t!==null&&g3(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,d!==null&&t.indexOf(d)===-1&&t.push(d),e)}function zV(e,t,i,a,d){switch(t){case"focusin":return Ed=yy(Ed,e,t,i,a,d),!0;case"dragenter":return Cd=yy(Cd,e,t,i,a,d),!0;case"mouseover":return Md=yy(Md,e,t,i,a,d),!0;case"pointerover":var _=d.pointerId;return l0.set(_,yy(l0.get(_)||null,e,t,i,a,d)),!0;case"gotpointercapture":return _=d.pointerId,c0.set(_,yy(c0.get(_)||null,e,t,i,a,d)),!0}return!1}function NL(e){var t=Zh(e.target);if(t!==null){var i=Af(t);if(i!==null){if(t=i.tag,t===13){if(t=EL(i),t!==null){e.blockedOn=t,zL(e.priority,function(){LL(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function V1(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=CE(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var a=new i.constructor(i.type,i);xE=a,i.target.dispatchEvent(a),xE=null}else return t=G0(i),t!==null&&g3(t),e.blockedOn=i,!1;t.shift()}return!0}function aR(e,t,i){V1(e)&&i.delete(t)}function NV(){EE=!1,Ed!==null&&V1(Ed)&&(Ed=null),Cd!==null&&V1(Cd)&&(Cd=null),Md!==null&&V1(Md)&&(Md=null),l0.forEach(aR),c0.forEach(aR)}function vy(e,t){e.blockedOn===t&&(e.blockedOn=null,EE||(EE=!0,da.unstable_scheduleCallback(da.unstable_NormalPriority,NV)))}function u0(e){function t(d){return vy(d,e)}if(0<p1.length){vy(p1[0],e);for(var i=1;i<p1.length;i++){var a=p1[i];a.blockedOn===e&&(a.blockedOn=null)}}for(Ed!==null&&vy(Ed,e),Cd!==null&&vy(Cd,e),Md!==null&&vy(Md,e),l0.forEach(t),c0.forEach(t),i=0;i<cd.length;i++)a=cd[i],a.blockedOn===e&&(a.blockedOn=null);for(;0<cd.length&&(i=cd[0],i.blockedOn===null);)NL(i),i.blockedOn===null&&cd.shift()}var Lm=iu.ReactCurrentBatchConfig,hb=!0;function FV(e,t,i,a){var d=ai,_=Lm.transition;Lm.transition=null;try{ai=1,_3(e,t,i,a)}finally{ai=d,Lm.transition=_}}function jV(e,t,i,a){var d=ai,_=Lm.transition;Lm.transition=null;try{ai=4,_3(e,t,i,a)}finally{ai=d,Lm.transition=_}}function _3(e,t,i,a){if(hb){var d=CE(e,t,i,a);if(d===null)pT(e,t,a,fb,i),sR(e,a);else if(zV(d,e,t,i,a))a.stopPropagation();else if(sR(e,a),t&4&&-1<OV.indexOf(e)){for(;d!==null;){var _=G0(d);if(_!==null&&DL(_),_=CE(e,t,i,a),_===null&&pT(e,t,a,fb,i),_===d)break;d=_}d!==null&&a.stopPropagation()}else pT(e,t,a,null,i)}}var fb=null;function CE(e,t,i,a){if(fb=null,e=f3(a),e=Zh(e),e!==null)if(t=Af(e),t===null)e=null;else if(i=t.tag,i===13){if(e=EL(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return fb=e,null}function FL(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(CV()){case p3:return 1;case AL:return 4;case ub:case MV:return 16;case IL:return 536870912;default:return 16}default:return 16}}var wd=null,y3=null,$1=null;function jL(){if($1)return $1;var e,t=y3,i=t.length,a,d="value"in wd?wd.value:wd.textContent,_=d.length;for(e=0;e<i&&t[e]===d[e];e++);var b=i-e;for(a=1;a<=b&&t[i-a]===d[_-a];a++);return $1=d.slice(e,1<a?1-a:void 0)}function G1(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function m1(){return!0}function lR(){return!1}function pa(e){function t(i,a,d,_,b){this._reactName=i,this._targetInst=d,this.type=a,this.nativeEvent=_,this.target=b,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(_):_[o]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?m1:lR,this.isPropagationStopped=lR,this}return Bi(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=m1)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=m1)},persist:function(){},isPersistent:m1}),t}var yg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},v3=pa(yg),$0=Bi({},yg,{view:0,detail:0}),BV=pa($0),oT,sT,xy,sw=Bi({},$0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:x3,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==xy&&(xy&&e.type==="mousemove"?(oT=e.screenX-xy.screenX,sT=e.screenY-xy.screenY):sT=oT=0,xy=e),oT)},movementY:function(e){return"movementY"in e?e.movementY:sT}}),cR=pa(sw),UV=Bi({},sw,{dataTransfer:0}),VV=pa(UV),$V=Bi({},$0,{relatedTarget:0}),aT=pa($V),GV=Bi({},yg,{animationName:0,elapsedTime:0,pseudoElement:0}),HV=pa(GV),qV=Bi({},yg,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),WV=pa(qV),ZV=Bi({},yg,{data:0}),uR=pa(ZV),YV={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},XV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},KV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function JV(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=KV[e])?!!t[e]:!1}function x3(){return JV}var QV=Bi({},$0,{key:function(e){if(e.key){var t=YV[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=G1(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?XV[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:x3,charCode:function(e){return e.type==="keypress"?G1(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?G1(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),e9=pa(QV),t9=Bi({},sw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dR=pa(t9),r9=Bi({},$0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:x3}),n9=pa(r9),i9=Bi({},yg,{propertyName:0,elapsedTime:0,pseudoElement:0}),o9=pa(i9),s9=Bi({},sw,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),a9=pa(s9),l9=[9,13,27,32],b3=Xc&&"CompositionEvent"in window,qy=null;Xc&&"documentMode"in document&&(qy=document.documentMode);var c9=Xc&&"TextEvent"in window&&!qy,BL=Xc&&(!b3||qy&&8<qy&&11>=qy),hR=" ",fR=!1;function UL(e,t){switch(e){case"keyup":return l9.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function VL(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var xm=!1;function u9(e,t){switch(e){case"compositionend":return VL(t);case"keypress":return t.which!==32?null:(fR=!0,hR);case"textInput":return e=t.data,e===hR&&fR?null:e;default:return null}}function d9(e,t){if(xm)return e==="compositionend"||!b3&&UL(e,t)?(e=jL(),$1=y3=wd=null,xm=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return BL&&t.locale!=="ko"?null:t.data;default:return null}}var h9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pR(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!h9[e.type]:t==="textarea"}function $L(e,t,i,a){xL(a),t=pb(t,"onChange"),0<t.length&&(i=new v3("onChange","change",null,i,a),e.push({event:i,listeners:t}))}var Wy=null,d0=null;function f9(e){eO(e,0)}function aw(e){var t=Sm(e);if(fL(t))return e}function p9(e,t){if(e==="change")return t}var GL=!1;if(Xc){var lT;if(Xc){var cT="oninput"in document;if(!cT){var mR=document.createElement("div");mR.setAttribute("oninput","return;"),cT=typeof mR.oninput=="function"}lT=cT}else lT=!1;GL=lT&&(!document.documentMode||9<document.documentMode)}function gR(){Wy&&(Wy.detachEvent("onpropertychange",HL),d0=Wy=null)}function HL(e){if(e.propertyName==="value"&&aw(d0)){var t=[];$L(t,d0,e,f3(e)),TL(f9,t)}}function m9(e,t,i){e==="focusin"?(gR(),Wy=t,d0=i,Wy.attachEvent("onpropertychange",HL)):e==="focusout"&&gR()}function g9(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return aw(d0)}function _9(e,t){if(e==="click")return aw(t)}function y9(e,t){if(e==="input"||e==="change")return aw(t)}function v9(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var yl=typeof Object.is=="function"?Object.is:v9;function h0(e,t){if(yl(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(a=0;a<i.length;a++){var d=i[a];if(!lE.call(t,d)||!yl(e[d],t[d]))return!1}return!0}function _R(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function yR(e,t){var i=_R(e);e=0;for(var a;i;){if(i.nodeType===3){if(a=e+i.textContent.length,e<=t&&a>=t)return{node:i,offset:t-e};e=a}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=_R(i)}}function qL(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?qL(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function WL(){for(var e=window,t=ab();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=ab(e.document)}return t}function w3(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function x9(e){var t=WL(),i=e.focusedElem,a=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&qL(i.ownerDocument.documentElement,i)){if(a!==null&&w3(i)){if(t=a.start,e=a.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var d=i.textContent.length,_=Math.min(a.start,d);a=a.end===void 0?_:Math.min(a.end,d),!e.extend&&_>a&&(d=a,a=_,_=d),d=yR(i,_);var b=yR(i,a);d&&b&&(e.rangeCount!==1||e.anchorNode!==d.node||e.anchorOffset!==d.offset||e.focusNode!==b.node||e.focusOffset!==b.offset)&&(t=t.createRange(),t.setStart(d.node,d.offset),e.removeAllRanges(),_>a?(e.addRange(t),e.extend(b.node,b.offset)):(t.setEnd(b.node,b.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var b9=Xc&&"documentMode"in document&&11>=document.documentMode,bm=null,ME=null,Zy=null,PE=!1;function vR(e,t,i){var a=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;PE||bm==null||bm!==ab(a)||(a=bm,"selectionStart"in a&&w3(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Zy&&h0(Zy,a)||(Zy=a,a=pb(ME,"onSelect"),0<a.length&&(t=new v3("onSelect","select",null,t,i),e.push({event:t,listeners:a}),t.target=bm)))}function g1(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var wm={animationend:g1("Animation","AnimationEnd"),animationiteration:g1("Animation","AnimationIteration"),animationstart:g1("Animation","AnimationStart"),transitionend:g1("Transition","TransitionEnd")},uT={},ZL={};Xc&&(ZL=document.createElement("div").style,"AnimationEvent"in window||(delete wm.animationend.animation,delete wm.animationiteration.animation,delete wm.animationstart.animation),"TransitionEvent"in window||delete wm.transitionend.transition);function lw(e){if(uT[e])return uT[e];if(!wm[e])return e;var t=wm[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in ZL)return uT[e]=t[i];return e}var YL=lw("animationend"),XL=lw("animationiteration"),KL=lw("animationstart"),JL=lw("transitionend"),QL=new Map,xR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $d(e,t){QL.set(e,t),Pf(t,[e])}for(var dT=0;dT<xR.length;dT++){var hT=xR[dT],w9=hT.toLowerCase(),S9=hT[0].toUpperCase()+hT.slice(1);$d(w9,"on"+S9)}$d(YL,"onAnimationEnd");$d(XL,"onAnimationIteration");$d(KL,"onAnimationStart");$d("dblclick","onDoubleClick");$d("focusin","onFocus");$d("focusout","onBlur");$d(JL,"onTransitionEnd");tg("onMouseEnter",["mouseout","mouseover"]);tg("onMouseLeave",["mouseout","mouseover"]);tg("onPointerEnter",["pointerout","pointerover"]);tg("onPointerLeave",["pointerout","pointerover"]);Pf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Pf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Pf("onBeforeInput",["compositionend","keypress","textInput","paste"]);Pf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Pf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Pf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fy="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),T9=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fy));function bR(e,t,i){var a=e.type||"unknown-event";e.currentTarget=i,wV(a,t,void 0,e),e.currentTarget=null}function eO(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var a=e[i],d=a.event;a=a.listeners;e:{var _=void 0;if(t)for(var b=a.length-1;0<=b;b--){var o=a[b],k=o.instance,O=o.currentTarget;if(o=o.listener,k!==_&&d.isPropagationStopped())break e;bR(d,o,O),_=k}else for(b=0;b<a.length;b++){if(o=a[b],k=o.instance,O=o.currentTarget,o=o.listener,k!==_&&d.isPropagationStopped())break e;bR(d,o,O),_=k}}}if(cb)throw e=SE,cb=!1,SE=null,e}function Ei(e,t){var i=t[DE];i===void 0&&(i=t[DE]=new Set);var a=e+"__bubble";i.has(a)||(tO(t,e,2,!1),i.add(a))}function fT(e,t,i){var a=0;t&&(a|=4),tO(i,e,a,t)}var _1="_reactListening"+Math.random().toString(36).slice(2);function f0(e){if(!e[_1]){e[_1]=!0,lL.forEach(function(i){i!=="selectionchange"&&(T9.has(i)||fT(i,!1,e),fT(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[_1]||(t[_1]=!0,fT("selectionchange",!1,t))}}function tO(e,t,i,a){switch(FL(t)){case 1:var d=FV;break;case 4:d=jV;break;default:d=_3}i=d.bind(null,t,i,e),d=void 0,!wE||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(d=!0),a?d!==void 0?e.addEventListener(t,i,{capture:!0,passive:d}):e.addEventListener(t,i,!0):d!==void 0?e.addEventListener(t,i,{passive:d}):e.addEventListener(t,i,!1)}function pT(e,t,i,a,d){var _=a;if(!(t&1)&&!(t&2)&&a!==null)e:for(;;){if(a===null)return;var b=a.tag;if(b===3||b===4){var o=a.stateNode.containerInfo;if(o===d||o.nodeType===8&&o.parentNode===d)break;if(b===4)for(b=a.return;b!==null;){var k=b.tag;if((k===3||k===4)&&(k=b.stateNode.containerInfo,k===d||k.nodeType===8&&k.parentNode===d))return;b=b.return}for(;o!==null;){if(b=Zh(o),b===null)return;if(k=b.tag,k===5||k===6){a=_=b;continue e}o=o.parentNode}}a=a.return}TL(function(){var O=_,z=f3(i),F=[];e:{var G=QL.get(e);if(G!==void 0){var ee=v3,J=e;switch(e){case"keypress":if(G1(i)===0)break e;case"keydown":case"keyup":ee=e9;break;case"focusin":J="focus",ee=aT;break;case"focusout":J="blur",ee=aT;break;case"beforeblur":case"afterblur":ee=aT;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ee=cR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ee=VV;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ee=n9;break;case YL:case XL:case KL:ee=HV;break;case JL:ee=o9;break;case"scroll":ee=BV;break;case"wheel":ee=a9;break;case"copy":case"cut":case"paste":ee=WV;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ee=dR}var te=(t&4)!==0,oe=!te&&e==="scroll",X=te?G!==null?G+"Capture":null:G;te=[];for(var Q=O,ue;Q!==null;){ue=Q;var he=ue.stateNode;if(ue.tag===5&&he!==null&&(ue=he,X!==null&&(he=a0(Q,X),he!=null&&te.push(p0(Q,he,ue)))),oe)break;Q=Q.return}0<te.length&&(G=new ee(G,J,null,i,z),F.push({event:G,listeners:te}))}}if(!(t&7)){e:{if(G=e==="mouseover"||e==="pointerover",ee=e==="mouseout"||e==="pointerout",G&&i!==xE&&(J=i.relatedTarget||i.fromElement)&&(Zh(J)||J[Kc]))break e;if((ee||G)&&(G=z.window===z?z:(G=z.ownerDocument)?G.defaultView||G.parentWindow:window,ee?(J=i.relatedTarget||i.toElement,ee=O,J=J?Zh(J):null,J!==null&&(oe=Af(J),J!==oe||J.tag!==5&&J.tag!==6)&&(J=null)):(ee=null,J=O),ee!==J)){if(te=cR,he="onMouseLeave",X="onMouseEnter",Q="mouse",(e==="pointerout"||e==="pointerover")&&(te=dR,he="onPointerLeave",X="onPointerEnter",Q="pointer"),oe=ee==null?G:Sm(ee),ue=J==null?G:Sm(J),G=new te(he,Q+"leave",ee,i,z),G.target=oe,G.relatedTarget=ue,he=null,Zh(z)===O&&(te=new te(X,Q+"enter",J,i,z),te.target=ue,te.relatedTarget=oe,he=te),oe=he,ee&&J)t:{for(te=ee,X=J,Q=0,ue=te;ue;ue=om(ue))Q++;for(ue=0,he=X;he;he=om(he))ue++;for(;0<Q-ue;)te=om(te),Q--;for(;0<ue-Q;)X=om(X),ue--;for(;Q--;){if(te===X||X!==null&&te===X.alternate)break t;te=om(te),X=om(X)}te=null}else te=null;ee!==null&&wR(F,G,ee,te,!1),J!==null&&oe!==null&&wR(F,oe,J,te,!0)}}e:{if(G=O?Sm(O):window,ee=G.nodeName&&G.nodeName.toLowerCase(),ee==="select"||ee==="input"&&G.type==="file")var Ie=p9;else if(pR(G))if(GL)Ie=y9;else{Ie=g9;var Je=m9}else(ee=G.nodeName)&&ee.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(Ie=_9);if(Ie&&(Ie=Ie(e,O))){$L(F,Ie,i,z);break e}Je&&Je(e,G,O),e==="focusout"&&(Je=G._wrapperState)&&Je.controlled&&G.type==="number"&&mE(G,"number",G.value)}switch(Je=O?Sm(O):window,e){case"focusin":(pR(Je)||Je.contentEditable==="true")&&(bm=Je,ME=O,Zy=null);break;case"focusout":Zy=ME=bm=null;break;case"mousedown":PE=!0;break;case"contextmenu":case"mouseup":case"dragend":PE=!1,vR(F,i,z);break;case"selectionchange":if(b9)break;case"keydown":case"keyup":vR(F,i,z)}var Ce;if(b3)e:{switch(e){case"compositionstart":var Ze="onCompositionStart";break e;case"compositionend":Ze="onCompositionEnd";break e;case"compositionupdate":Ze="onCompositionUpdate";break e}Ze=void 0}else xm?UL(e,i)&&(Ze="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Ze="onCompositionStart");Ze&&(BL&&i.locale!=="ko"&&(xm||Ze!=="onCompositionStart"?Ze==="onCompositionEnd"&&xm&&(Ce=jL()):(wd=z,y3="value"in wd?wd.value:wd.textContent,xm=!0)),Je=pb(O,Ze),0<Je.length&&(Ze=new uR(Ze,e,null,i,z),F.push({event:Ze,listeners:Je}),Ce?Ze.data=Ce:(Ce=VL(i),Ce!==null&&(Ze.data=Ce)))),(Ce=c9?u9(e,i):d9(e,i))&&(O=pb(O,"onBeforeInput"),0<O.length&&(z=new uR("onBeforeInput","beforeinput",null,i,z),F.push({event:z,listeners:O}),z.data=Ce))}eO(F,t)})}function p0(e,t,i){return{instance:e,listener:t,currentTarget:i}}function pb(e,t){for(var i=t+"Capture",a=[];e!==null;){var d=e,_=d.stateNode;d.tag===5&&_!==null&&(d=_,_=a0(e,i),_!=null&&a.unshift(p0(e,_,d)),_=a0(e,t),_!=null&&a.push(p0(e,_,d))),e=e.return}return a}function om(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wR(e,t,i,a,d){for(var _=t._reactName,b=[];i!==null&&i!==a;){var o=i,k=o.alternate,O=o.stateNode;if(k!==null&&k===a)break;o.tag===5&&O!==null&&(o=O,d?(k=a0(i,_),k!=null&&b.unshift(p0(i,k,o))):d||(k=a0(i,_),k!=null&&b.push(p0(i,k,o)))),i=i.return}b.length!==0&&e.push({event:t,listeners:b})}var E9=/\r\n?/g,C9=/\u0000|\uFFFD/g;function SR(e){return(typeof e=="string"?e:""+e).replace(E9,`
`).replace(C9,"")}function y1(e,t,i){if(t=SR(t),SR(e)!==t&&i)throw Error(er(425))}function mb(){}var AE=null,IE=null;function kE(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var RE=typeof setTimeout=="function"?setTimeout:void 0,M9=typeof clearTimeout=="function"?clearTimeout:void 0,TR=typeof Promise=="function"?Promise:void 0,P9=typeof queueMicrotask=="function"?queueMicrotask:typeof TR<"u"?function(e){return TR.resolve(null).then(e).catch(A9)}:RE;function A9(e){setTimeout(function(){throw e})}function mT(e,t){var i=t,a=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(a===0){e.removeChild(d),u0(t);return}a--}else i!=="$"&&i!=="$?"&&i!=="$!"||a++;i=d}while(i);u0(t)}function Pd(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function ER(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var vg=Math.random().toString(36).slice(2),Kl="__reactFiber$"+vg,m0="__reactProps$"+vg,Kc="__reactContainer$"+vg,DE="__reactEvents$"+vg,I9="__reactListeners$"+vg,k9="__reactHandles$"+vg;function Zh(e){var t=e[Kl];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Kc]||i[Kl]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=ER(e);e!==null;){if(i=e[Kl])return i;e=ER(e)}return t}e=i,i=e.parentNode}return null}function G0(e){return e=e[Kl]||e[Kc],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Sm(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(er(33))}function cw(e){return e[m0]||null}var LE=[],Tm=-1;function Gd(e){return{current:e}}function Ci(e){0>Tm||(e.current=LE[Tm],LE[Tm]=null,Tm--)}function _i(e,t){Tm++,LE[Tm]=e.current,e.current=t}var Fd={},os=Gd(Fd),Bs=Gd(!1),mf=Fd;function rg(e,t){var i=e.type.contextTypes;if(!i)return Fd;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var d={},_;for(_ in i)d[_]=t[_];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=d),d}function Us(e){return e=e.childContextTypes,e!=null}function gb(){Ci(Bs),Ci(os)}function CR(e,t,i){if(os.current!==Fd)throw Error(er(168));_i(os,t),_i(Bs,i)}function rO(e,t,i){var a=e.stateNode;if(t=t.childContextTypes,typeof a.getChildContext!="function")return i;a=a.getChildContext();for(var d in a)if(!(d in t))throw Error(er(108,mV(e)||"Unknown",d));return Bi({},i,a)}function _b(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Fd,mf=os.current,_i(os,e),_i(Bs,Bs.current),!0}function MR(e,t,i){var a=e.stateNode;if(!a)throw Error(er(169));i?(e=rO(e,t,mf),a.__reactInternalMemoizedMergedChildContext=e,Ci(Bs),Ci(os),_i(os,e)):Ci(Bs),_i(Bs,i)}var Uc=null,uw=!1,gT=!1;function nO(e){Uc===null?Uc=[e]:Uc.push(e)}function R9(e){uw=!0,nO(e)}function Hd(){if(!gT&&Uc!==null){gT=!0;var e=0,t=ai;try{var i=Uc;for(ai=1;e<i.length;e++){var a=i[e];do a=a(!0);while(a!==null)}Uc=null,uw=!1}catch(d){throw Uc!==null&&(Uc=Uc.slice(e+1)),PL(p3,Hd),d}finally{ai=t,gT=!1}}return null}var Em=[],Cm=0,yb=null,vb=0,Ca=[],Ma=0,gf=null,$c=1,Gc="";function jh(e,t){Em[Cm++]=vb,Em[Cm++]=yb,yb=e,vb=t}function iO(e,t,i){Ca[Ma++]=$c,Ca[Ma++]=Gc,Ca[Ma++]=gf,gf=e;var a=$c;e=Gc;var d=32-pl(a)-1;a&=~(1<<d),i+=1;var _=32-pl(t)+d;if(30<_){var b=d-d%5;_=(a&(1<<b)-1).toString(32),a>>=b,d-=b,$c=1<<32-pl(t)+d|i<<d|a,Gc=_+e}else $c=1<<_|i<<d|a,Gc=e}function S3(e){e.return!==null&&(jh(e,1),iO(e,1,0))}function T3(e){for(;e===yb;)yb=Em[--Cm],Em[Cm]=null,vb=Em[--Cm],Em[Cm]=null;for(;e===gf;)gf=Ca[--Ma],Ca[Ma]=null,Gc=Ca[--Ma],Ca[Ma]=null,$c=Ca[--Ma],Ca[Ma]=null}var la=null,aa=null,Ai=!1,ul=null;function oO(e,t){var i=Pa(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function PR(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,la=e,aa=Pd(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,la=e,aa=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=gf!==null?{id:$c,overflow:Gc}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Pa(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,la=e,aa=null,!0):!1;default:return!1}}function OE(e){return(e.mode&1)!==0&&(e.flags&128)===0}function zE(e){if(Ai){var t=aa;if(t){var i=t;if(!PR(e,t)){if(OE(e))throw Error(er(418));t=Pd(i.nextSibling);var a=la;t&&PR(e,t)?oO(a,i):(e.flags=e.flags&-4097|2,Ai=!1,la=e)}}else{if(OE(e))throw Error(er(418));e.flags=e.flags&-4097|2,Ai=!1,la=e}}}function AR(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;la=e}function v1(e){if(e!==la)return!1;if(!Ai)return AR(e),Ai=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!kE(e.type,e.memoizedProps)),t&&(t=aa)){if(OE(e))throw sO(),Error(er(418));for(;t;)oO(e,t),t=Pd(t.nextSibling)}if(AR(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(er(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){aa=Pd(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}aa=null}}else aa=la?Pd(e.stateNode.nextSibling):null;return!0}function sO(){for(var e=aa;e;)e=Pd(e.nextSibling)}function ng(){aa=la=null,Ai=!1}function E3(e){ul===null?ul=[e]:ul.push(e)}var D9=iu.ReactCurrentBatchConfig;function by(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(er(309));var a=i.stateNode}if(!a)throw Error(er(147,e));var d=a,_=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===_?t.ref:(t=function(b){var o=d.refs;b===null?delete o[_]:o[_]=b},t._stringRef=_,t)}if(typeof e!="string")throw Error(er(284));if(!i._owner)throw Error(er(290,e))}return e}function x1(e,t){throw e=Object.prototype.toString.call(t),Error(er(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function IR(e){var t=e._init;return t(e._payload)}function aO(e){function t(X,Q){if(e){var ue=X.deletions;ue===null?(X.deletions=[Q],X.flags|=16):ue.push(Q)}}function i(X,Q){if(!e)return null;for(;Q!==null;)t(X,Q),Q=Q.sibling;return null}function a(X,Q){for(X=new Map;Q!==null;)Q.key!==null?X.set(Q.key,Q):X.set(Q.index,Q),Q=Q.sibling;return X}function d(X,Q){return X=Rd(X,Q),X.index=0,X.sibling=null,X}function _(X,Q,ue){return X.index=ue,e?(ue=X.alternate,ue!==null?(ue=ue.index,ue<Q?(X.flags|=2,Q):ue):(X.flags|=2,Q)):(X.flags|=1048576,Q)}function b(X){return e&&X.alternate===null&&(X.flags|=2),X}function o(X,Q,ue,he){return Q===null||Q.tag!==6?(Q=ST(ue,X.mode,he),Q.return=X,Q):(Q=d(Q,ue),Q.return=X,Q)}function k(X,Q,ue,he){var Ie=ue.type;return Ie===vm?z(X,Q,ue.props.children,he,ue.key):Q!==null&&(Q.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===sd&&IR(Ie)===Q.type)?(he=d(Q,ue.props),he.ref=by(X,Q,ue),he.return=X,he):(he=K1(ue.type,ue.key,ue.props,null,X.mode,he),he.ref=by(X,Q,ue),he.return=X,he)}function O(X,Q,ue,he){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ue.containerInfo||Q.stateNode.implementation!==ue.implementation?(Q=TT(ue,X.mode,he),Q.return=X,Q):(Q=d(Q,ue.children||[]),Q.return=X,Q)}function z(X,Q,ue,he,Ie){return Q===null||Q.tag!==7?(Q=lf(ue,X.mode,he,Ie),Q.return=X,Q):(Q=d(Q,ue),Q.return=X,Q)}function F(X,Q,ue){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=ST(""+Q,X.mode,ue),Q.return=X,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case c1:return ue=K1(Q.type,Q.key,Q.props,null,X.mode,ue),ue.ref=by(X,null,Q),ue.return=X,ue;case ym:return Q=TT(Q,X.mode,ue),Q.return=X,Q;case sd:var he=Q._init;return F(X,he(Q._payload),ue)}if(zy(Q)||gy(Q))return Q=lf(Q,X.mode,ue,null),Q.return=X,Q;x1(X,Q)}return null}function G(X,Q,ue,he){var Ie=Q!==null?Q.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return Ie!==null?null:o(X,Q,""+ue,he);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case c1:return ue.key===Ie?k(X,Q,ue,he):null;case ym:return ue.key===Ie?O(X,Q,ue,he):null;case sd:return Ie=ue._init,G(X,Q,Ie(ue._payload),he)}if(zy(ue)||gy(ue))return Ie!==null?null:z(X,Q,ue,he,null);x1(X,ue)}return null}function ee(X,Q,ue,he,Ie){if(typeof he=="string"&&he!==""||typeof he=="number")return X=X.get(ue)||null,o(Q,X,""+he,Ie);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case c1:return X=X.get(he.key===null?ue:he.key)||null,k(Q,X,he,Ie);case ym:return X=X.get(he.key===null?ue:he.key)||null,O(Q,X,he,Ie);case sd:var Je=he._init;return ee(X,Q,ue,Je(he._payload),Ie)}if(zy(he)||gy(he))return X=X.get(ue)||null,z(Q,X,he,Ie,null);x1(Q,he)}return null}function J(X,Q,ue,he){for(var Ie=null,Je=null,Ce=Q,Ze=Q=0,et=null;Ce!==null&&Ze<ue.length;Ze++){Ce.index>Ze?(et=Ce,Ce=null):et=Ce.sibling;var Ge=G(X,Ce,ue[Ze],he);if(Ge===null){Ce===null&&(Ce=et);break}e&&Ce&&Ge.alternate===null&&t(X,Ce),Q=_(Ge,Q,Ze),Je===null?Ie=Ge:Je.sibling=Ge,Je=Ge,Ce=et}if(Ze===ue.length)return i(X,Ce),Ai&&jh(X,Ze),Ie;if(Ce===null){for(;Ze<ue.length;Ze++)Ce=F(X,ue[Ze],he),Ce!==null&&(Q=_(Ce,Q,Ze),Je===null?Ie=Ce:Je.sibling=Ce,Je=Ce);return Ai&&jh(X,Ze),Ie}for(Ce=a(X,Ce);Ze<ue.length;Ze++)et=ee(Ce,X,Ze,ue[Ze],he),et!==null&&(e&&et.alternate!==null&&Ce.delete(et.key===null?Ze:et.key),Q=_(et,Q,Ze),Je===null?Ie=et:Je.sibling=et,Je=et);return e&&Ce.forEach(function(qe){return t(X,qe)}),Ai&&jh(X,Ze),Ie}function te(X,Q,ue,he){var Ie=gy(ue);if(typeof Ie!="function")throw Error(er(150));if(ue=Ie.call(ue),ue==null)throw Error(er(151));for(var Je=Ie=null,Ce=Q,Ze=Q=0,et=null,Ge=ue.next();Ce!==null&&!Ge.done;Ze++,Ge=ue.next()){Ce.index>Ze?(et=Ce,Ce=null):et=Ce.sibling;var qe=G(X,Ce,Ge.value,he);if(qe===null){Ce===null&&(Ce=et);break}e&&Ce&&qe.alternate===null&&t(X,Ce),Q=_(qe,Q,Ze),Je===null?Ie=qe:Je.sibling=qe,Je=qe,Ce=et}if(Ge.done)return i(X,Ce),Ai&&jh(X,Ze),Ie;if(Ce===null){for(;!Ge.done;Ze++,Ge=ue.next())Ge=F(X,Ge.value,he),Ge!==null&&(Q=_(Ge,Q,Ze),Je===null?Ie=Ge:Je.sibling=Ge,Je=Ge);return Ai&&jh(X,Ze),Ie}for(Ce=a(X,Ce);!Ge.done;Ze++,Ge=ue.next())Ge=ee(Ce,X,Ze,Ge.value,he),Ge!==null&&(e&&Ge.alternate!==null&&Ce.delete(Ge.key===null?Ze:Ge.key),Q=_(Ge,Q,Ze),Je===null?Ie=Ge:Je.sibling=Ge,Je=Ge);return e&&Ce.forEach(function(_t){return t(X,_t)}),Ai&&jh(X,Ze),Ie}function oe(X,Q,ue,he){if(typeof ue=="object"&&ue!==null&&ue.type===vm&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case c1:e:{for(var Ie=ue.key,Je=Q;Je!==null;){if(Je.key===Ie){if(Ie=ue.type,Ie===vm){if(Je.tag===7){i(X,Je.sibling),Q=d(Je,ue.props.children),Q.return=X,X=Q;break e}}else if(Je.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===sd&&IR(Ie)===Je.type){i(X,Je.sibling),Q=d(Je,ue.props),Q.ref=by(X,Je,ue),Q.return=X,X=Q;break e}i(X,Je);break}else t(X,Je);Je=Je.sibling}ue.type===vm?(Q=lf(ue.props.children,X.mode,he,ue.key),Q.return=X,X=Q):(he=K1(ue.type,ue.key,ue.props,null,X.mode,he),he.ref=by(X,Q,ue),he.return=X,X=he)}return b(X);case ym:e:{for(Je=ue.key;Q!==null;){if(Q.key===Je)if(Q.tag===4&&Q.stateNode.containerInfo===ue.containerInfo&&Q.stateNode.implementation===ue.implementation){i(X,Q.sibling),Q=d(Q,ue.children||[]),Q.return=X,X=Q;break e}else{i(X,Q);break}else t(X,Q);Q=Q.sibling}Q=TT(ue,X.mode,he),Q.return=X,X=Q}return b(X);case sd:return Je=ue._init,oe(X,Q,Je(ue._payload),he)}if(zy(ue))return J(X,Q,ue,he);if(gy(ue))return te(X,Q,ue,he);x1(X,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,Q!==null&&Q.tag===6?(i(X,Q.sibling),Q=d(Q,ue),Q.return=X,X=Q):(i(X,Q),Q=ST(ue,X.mode,he),Q.return=X,X=Q),b(X)):i(X,Q)}return oe}var ig=aO(!0),lO=aO(!1),xb=Gd(null),bb=null,Mm=null,C3=null;function M3(){C3=Mm=bb=null}function P3(e){var t=xb.current;Ci(xb),e._currentValue=t}function NE(e,t,i){for(;e!==null;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,a!==null&&(a.childLanes|=t)):a!==null&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===i)break;e=e.return}}function Om(e,t){bb=e,C3=Mm=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Fs=!0),e.firstContext=null)}function Ia(e){var t=e._currentValue;if(C3!==e)if(e={context:e,memoizedValue:t,next:null},Mm===null){if(bb===null)throw Error(er(308));Mm=e,bb.dependencies={lanes:0,firstContext:e}}else Mm=Mm.next=e;return t}var Yh=null;function A3(e){Yh===null?Yh=[e]:Yh.push(e)}function cO(e,t,i,a){var d=t.interleaved;return d===null?(i.next=i,A3(t)):(i.next=d.next,d.next=i),t.interleaved=i,Jc(e,a)}function Jc(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var ad=!1;function I3(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uO(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function qc(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ad(e,t,i){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,Wn&2){var d=a.pending;return d===null?t.next=t:(t.next=d.next,d.next=t),a.pending=t,Jc(e,i)}return d=a.interleaved,d===null?(t.next=t,A3(a)):(t.next=d.next,d.next=t),a.interleaved=t,Jc(e,i)}function H1(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var a=t.lanes;a&=e.pendingLanes,i|=a,t.lanes=i,m3(e,i)}}function kR(e,t){var i=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,i===a)){var d=null,_=null;if(i=i.firstBaseUpdate,i!==null){do{var b={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};_===null?d=_=b:_=_.next=b,i=i.next}while(i!==null);_===null?d=_=t:_=_.next=t}else d=_=t;i={baseState:a.baseState,firstBaseUpdate:d,lastBaseUpdate:_,shared:a.shared,effects:a.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function wb(e,t,i,a){var d=e.updateQueue;ad=!1;var _=d.firstBaseUpdate,b=d.lastBaseUpdate,o=d.shared.pending;if(o!==null){d.shared.pending=null;var k=o,O=k.next;k.next=null,b===null?_=O:b.next=O,b=k;var z=e.alternate;z!==null&&(z=z.updateQueue,o=z.lastBaseUpdate,o!==b&&(o===null?z.firstBaseUpdate=O:o.next=O,z.lastBaseUpdate=k))}if(_!==null){var F=d.baseState;b=0,z=O=k=null,o=_;do{var G=o.lane,ee=o.eventTime;if((a&G)===G){z!==null&&(z=z.next={eventTime:ee,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var J=e,te=o;switch(G=t,ee=i,te.tag){case 1:if(J=te.payload,typeof J=="function"){F=J.call(ee,F,G);break e}F=J;break e;case 3:J.flags=J.flags&-65537|128;case 0:if(J=te.payload,G=typeof J=="function"?J.call(ee,F,G):J,G==null)break e;F=Bi({},F,G);break e;case 2:ad=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,G=d.effects,G===null?d.effects=[o]:G.push(o))}else ee={eventTime:ee,lane:G,tag:o.tag,payload:o.payload,callback:o.callback,next:null},z===null?(O=z=ee,k=F):z=z.next=ee,b|=G;if(o=o.next,o===null){if(o=d.shared.pending,o===null)break;G=o,o=G.next,G.next=null,d.lastBaseUpdate=G,d.shared.pending=null}}while(!0);if(z===null&&(k=F),d.baseState=k,d.firstBaseUpdate=O,d.lastBaseUpdate=z,t=d.shared.interleaved,t!==null){d=t;do b|=d.lane,d=d.next;while(d!==t)}else _===null&&(d.shared.lanes=0);yf|=b,e.lanes=b,e.memoizedState=F}}function RR(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var a=e[t],d=a.callback;if(d!==null){if(a.callback=null,a=i,typeof d!="function")throw Error(er(191,d));d.call(a)}}}var H0={},rc=Gd(H0),g0=Gd(H0),_0=Gd(H0);function Xh(e){if(e===H0)throw Error(er(174));return e}function k3(e,t){switch(_i(_0,t),_i(g0,e),_i(rc,H0),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_E(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_E(t,e)}Ci(rc),_i(rc,t)}function og(){Ci(rc),Ci(g0),Ci(_0)}function dO(e){Xh(_0.current);var t=Xh(rc.current),i=_E(t,e.type);t!==i&&(_i(g0,e),_i(rc,i))}function R3(e){g0.current===e&&(Ci(rc),Ci(g0))}var zi=Gd(0);function Sb(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var _T=[];function D3(){for(var e=0;e<_T.length;e++)_T[e]._workInProgressVersionPrimary=null;_T.length=0}var q1=iu.ReactCurrentDispatcher,yT=iu.ReactCurrentBatchConfig,_f=0,Fi=null,xo=null,Ao=null,Tb=!1,Yy=!1,y0=0,L9=0;function ts(){throw Error(er(321))}function L3(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!yl(e[i],t[i]))return!1;return!0}function O3(e,t,i,a,d,_){if(_f=_,Fi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,q1.current=e===null||e.memoizedState===null?F9:j9,e=i(a,d),Yy){_=0;do{if(Yy=!1,y0=0,25<=_)throw Error(er(301));_+=1,Ao=xo=null,t.updateQueue=null,q1.current=B9,e=i(a,d)}while(Yy)}if(q1.current=Eb,t=xo!==null&&xo.next!==null,_f=0,Ao=xo=Fi=null,Tb=!1,t)throw Error(er(300));return e}function z3(){var e=y0!==0;return y0=0,e}function ql(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ao===null?Fi.memoizedState=Ao=e:Ao=Ao.next=e,Ao}function ka(){if(xo===null){var e=Fi.alternate;e=e!==null?e.memoizedState:null}else e=xo.next;var t=Ao===null?Fi.memoizedState:Ao.next;if(t!==null)Ao=t,xo=e;else{if(e===null)throw Error(er(310));xo=e,e={memoizedState:xo.memoizedState,baseState:xo.baseState,baseQueue:xo.baseQueue,queue:xo.queue,next:null},Ao===null?Fi.memoizedState=Ao=e:Ao=Ao.next=e}return Ao}function v0(e,t){return typeof t=="function"?t(e):t}function vT(e){var t=ka(),i=t.queue;if(i===null)throw Error(er(311));i.lastRenderedReducer=e;var a=xo,d=a.baseQueue,_=i.pending;if(_!==null){if(d!==null){var b=d.next;d.next=_.next,_.next=b}a.baseQueue=d=_,i.pending=null}if(d!==null){_=d.next,a=a.baseState;var o=b=null,k=null,O=_;do{var z=O.lane;if((_f&z)===z)k!==null&&(k=k.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),a=O.hasEagerState?O.eagerState:e(a,O.action);else{var F={lane:z,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};k===null?(o=k=F,b=a):k=k.next=F,Fi.lanes|=z,yf|=z}O=O.next}while(O!==null&&O!==_);k===null?b=a:k.next=o,yl(a,t.memoizedState)||(Fs=!0),t.memoizedState=a,t.baseState=b,t.baseQueue=k,i.lastRenderedState=a}if(e=i.interleaved,e!==null){d=e;do _=d.lane,Fi.lanes|=_,yf|=_,d=d.next;while(d!==e)}else d===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function xT(e){var t=ka(),i=t.queue;if(i===null)throw Error(er(311));i.lastRenderedReducer=e;var a=i.dispatch,d=i.pending,_=t.memoizedState;if(d!==null){i.pending=null;var b=d=d.next;do _=e(_,b.action),b=b.next;while(b!==d);yl(_,t.memoizedState)||(Fs=!0),t.memoizedState=_,t.baseQueue===null&&(t.baseState=_),i.lastRenderedState=_}return[_,a]}function hO(){}function fO(e,t){var i=Fi,a=ka(),d=t(),_=!yl(a.memoizedState,d);if(_&&(a.memoizedState=d,Fs=!0),a=a.queue,N3(gO.bind(null,i,a,e),[e]),a.getSnapshot!==t||_||Ao!==null&&Ao.memoizedState.tag&1){if(i.flags|=2048,x0(9,mO.bind(null,i,a,d,t),void 0,null),ko===null)throw Error(er(349));_f&30||pO(i,t,d)}return d}function pO(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Fi.updateQueue,t===null?(t={lastEffect:null,stores:null},Fi.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function mO(e,t,i,a){t.value=i,t.getSnapshot=a,_O(t)&&yO(e)}function gO(e,t,i){return i(function(){_O(t)&&yO(e)})}function _O(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!yl(e,i)}catch{return!0}}function yO(e){var t=Jc(e,1);t!==null&&ml(t,e,1,-1)}function DR(e){var t=ql();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:v0,lastRenderedState:e},t.queue=e,e=e.dispatch=N9.bind(null,Fi,e),[t.memoizedState,e]}function x0(e,t,i,a){return e={tag:e,create:t,destroy:i,deps:a,next:null},t=Fi.updateQueue,t===null?(t={lastEffect:null,stores:null},Fi.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(a=i.next,i.next=e,e.next=a,t.lastEffect=e)),e}function vO(){return ka().memoizedState}function W1(e,t,i,a){var d=ql();Fi.flags|=e,d.memoizedState=x0(1|t,i,void 0,a===void 0?null:a)}function dw(e,t,i,a){var d=ka();a=a===void 0?null:a;var _=void 0;if(xo!==null){var b=xo.memoizedState;if(_=b.destroy,a!==null&&L3(a,b.deps)){d.memoizedState=x0(t,i,_,a);return}}Fi.flags|=e,d.memoizedState=x0(1|t,i,_,a)}function LR(e,t){return W1(8390656,8,e,t)}function N3(e,t){return dw(2048,8,e,t)}function xO(e,t){return dw(4,2,e,t)}function bO(e,t){return dw(4,4,e,t)}function wO(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function SO(e,t,i){return i=i!=null?i.concat([e]):null,dw(4,4,wO.bind(null,t,e),i)}function F3(){}function TO(e,t){var i=ka();t=t===void 0?null:t;var a=i.memoizedState;return a!==null&&t!==null&&L3(t,a[1])?a[0]:(i.memoizedState=[e,t],e)}function EO(e,t){var i=ka();t=t===void 0?null:t;var a=i.memoizedState;return a!==null&&t!==null&&L3(t,a[1])?a[0]:(e=e(),i.memoizedState=[e,t],e)}function CO(e,t,i){return _f&21?(yl(i,t)||(i=kL(),Fi.lanes|=i,yf|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Fs=!0),e.memoizedState=i)}function O9(e,t){var i=ai;ai=i!==0&&4>i?i:4,e(!0);var a=yT.transition;yT.transition={};try{e(!1),t()}finally{ai=i,yT.transition=a}}function MO(){return ka().memoizedState}function z9(e,t,i){var a=kd(e);if(i={lane:a,action:i,hasEagerState:!1,eagerState:null,next:null},PO(e))AO(t,i);else if(i=cO(e,t,i,a),i!==null){var d=ys();ml(i,e,a,d),IO(i,t,a)}}function N9(e,t,i){var a=kd(e),d={lane:a,action:i,hasEagerState:!1,eagerState:null,next:null};if(PO(e))AO(t,d);else{var _=e.alternate;if(e.lanes===0&&(_===null||_.lanes===0)&&(_=t.lastRenderedReducer,_!==null))try{var b=t.lastRenderedState,o=_(b,i);if(d.hasEagerState=!0,d.eagerState=o,yl(o,b)){var k=t.interleaved;k===null?(d.next=d,A3(t)):(d.next=k.next,k.next=d),t.interleaved=d;return}}catch{}finally{}i=cO(e,t,d,a),i!==null&&(d=ys(),ml(i,e,a,d),IO(i,t,a))}}function PO(e){var t=e.alternate;return e===Fi||t!==null&&t===Fi}function AO(e,t){Yy=Tb=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function IO(e,t,i){if(i&4194240){var a=t.lanes;a&=e.pendingLanes,i|=a,t.lanes=i,m3(e,i)}}var Eb={readContext:Ia,useCallback:ts,useContext:ts,useEffect:ts,useImperativeHandle:ts,useInsertionEffect:ts,useLayoutEffect:ts,useMemo:ts,useReducer:ts,useRef:ts,useState:ts,useDebugValue:ts,useDeferredValue:ts,useTransition:ts,useMutableSource:ts,useSyncExternalStore:ts,useId:ts,unstable_isNewReconciler:!1},F9={readContext:Ia,useCallback:function(e,t){return ql().memoizedState=[e,t===void 0?null:t],e},useContext:Ia,useEffect:LR,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,W1(4194308,4,wO.bind(null,t,e),i)},useLayoutEffect:function(e,t){return W1(4194308,4,e,t)},useInsertionEffect:function(e,t){return W1(4,2,e,t)},useMemo:function(e,t){var i=ql();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var a=ql();return t=i!==void 0?i(t):t,a.memoizedState=a.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},a.queue=e,e=e.dispatch=z9.bind(null,Fi,e),[a.memoizedState,e]},useRef:function(e){var t=ql();return e={current:e},t.memoizedState=e},useState:DR,useDebugValue:F3,useDeferredValue:function(e){return ql().memoizedState=e},useTransition:function(){var e=DR(!1),t=e[0];return e=O9.bind(null,e[1]),ql().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var a=Fi,d=ql();if(Ai){if(i===void 0)throw Error(er(407));i=i()}else{if(i=t(),ko===null)throw Error(er(349));_f&30||pO(a,t,i)}d.memoizedState=i;var _={value:i,getSnapshot:t};return d.queue=_,LR(gO.bind(null,a,_,e),[e]),a.flags|=2048,x0(9,mO.bind(null,a,_,i,t),void 0,null),i},useId:function(){var e=ql(),t=ko.identifierPrefix;if(Ai){var i=Gc,a=$c;i=(a&~(1<<32-pl(a)-1)).toString(32)+i,t=":"+t+"R"+i,i=y0++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=L9++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},j9={readContext:Ia,useCallback:TO,useContext:Ia,useEffect:N3,useImperativeHandle:SO,useInsertionEffect:xO,useLayoutEffect:bO,useMemo:EO,useReducer:vT,useRef:vO,useState:function(){return vT(v0)},useDebugValue:F3,useDeferredValue:function(e){var t=ka();return CO(t,xo.memoizedState,e)},useTransition:function(){var e=vT(v0)[0],t=ka().memoizedState;return[e,t]},useMutableSource:hO,useSyncExternalStore:fO,useId:MO,unstable_isNewReconciler:!1},B9={readContext:Ia,useCallback:TO,useContext:Ia,useEffect:N3,useImperativeHandle:SO,useInsertionEffect:xO,useLayoutEffect:bO,useMemo:EO,useReducer:xT,useRef:vO,useState:function(){return xT(v0)},useDebugValue:F3,useDeferredValue:function(e){var t=ka();return xo===null?t.memoizedState=e:CO(t,xo.memoizedState,e)},useTransition:function(){var e=xT(v0)[0],t=ka().memoizedState;return[e,t]},useMutableSource:hO,useSyncExternalStore:fO,useId:MO,unstable_isNewReconciler:!1};function sl(e,t){if(e&&e.defaultProps){t=Bi({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function FE(e,t,i,a){t=e.memoizedState,i=i(a,t),i=i==null?t:Bi({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var hw={isMounted:function(e){return(e=e._reactInternals)?Af(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var a=ys(),d=kd(e),_=qc(a,d);_.payload=t,i!=null&&(_.callback=i),t=Ad(e,_,d),t!==null&&(ml(t,e,d,a),H1(t,e,d))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var a=ys(),d=kd(e),_=qc(a,d);_.tag=1,_.payload=t,i!=null&&(_.callback=i),t=Ad(e,_,d),t!==null&&(ml(t,e,d,a),H1(t,e,d))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ys(),a=kd(e),d=qc(i,a);d.tag=2,t!=null&&(d.callback=t),t=Ad(e,d,a),t!==null&&(ml(t,e,a,i),H1(t,e,a))}};function OR(e,t,i,a,d,_,b){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,_,b):t.prototype&&t.prototype.isPureReactComponent?!h0(i,a)||!h0(d,_):!0}function kO(e,t,i){var a=!1,d=Fd,_=t.contextType;return typeof _=="object"&&_!==null?_=Ia(_):(d=Us(t)?mf:os.current,a=t.contextTypes,_=(a=a!=null)?rg(e,d):Fd),t=new t(i,_),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=hw,e.stateNode=t,t._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=d,e.__reactInternalMemoizedMaskedChildContext=_),t}function zR(e,t,i,a){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,a),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,a),t.state!==e&&hw.enqueueReplaceState(t,t.state,null)}function jE(e,t,i,a){var d=e.stateNode;d.props=i,d.state=e.memoizedState,d.refs={},I3(e);var _=t.contextType;typeof _=="object"&&_!==null?d.context=Ia(_):(_=Us(t)?mf:os.current,d.context=rg(e,_)),d.state=e.memoizedState,_=t.getDerivedStateFromProps,typeof _=="function"&&(FE(e,t,_,i),d.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(t=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),t!==d.state&&hw.enqueueReplaceState(d,d.state,null),wb(e,i,d,a),d.state=e.memoizedState),typeof d.componentDidMount=="function"&&(e.flags|=4194308)}function sg(e,t){try{var i="",a=t;do i+=pV(a),a=a.return;while(a);var d=i}catch(_){d=`
Error generating stack: `+_.message+`
`+_.stack}return{value:e,source:t,stack:d,digest:null}}function bT(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function BE(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var U9=typeof WeakMap=="function"?WeakMap:Map;function RO(e,t,i){i=qc(-1,i),i.tag=3,i.payload={element:null};var a=t.value;return i.callback=function(){Mb||(Mb=!0,XE=a),BE(e,t)},i}function DO(e,t,i){i=qc(-1,i),i.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var d=t.value;i.payload=function(){return a(d)},i.callback=function(){BE(e,t)}}var _=e.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(i.callback=function(){BE(e,t),typeof a!="function"&&(Id===null?Id=new Set([this]):Id.add(this));var b=t.stack;this.componentDidCatch(t.value,{componentStack:b!==null?b:""})}),i}function NR(e,t,i){var a=e.pingCache;if(a===null){a=e.pingCache=new U9;var d=new Set;a.set(t,d)}else d=a.get(t),d===void 0&&(d=new Set,a.set(t,d));d.has(i)||(d.add(i),e=t7.bind(null,e,t,i),t.then(e,e))}function FR(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function jR(e,t,i,a,d){return e.mode&1?(e.flags|=65536,e.lanes=d,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=qc(-1,1),t.tag=2,Ad(i,t,1))),i.lanes|=1),e)}var V9=iu.ReactCurrentOwner,Fs=!1;function ms(e,t,i,a){t.child=e===null?lO(t,null,i,a):ig(t,e.child,i,a)}function BR(e,t,i,a,d){i=i.render;var _=t.ref;return Om(t,d),a=O3(e,t,i,a,_,d),i=z3(),e!==null&&!Fs?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~d,Qc(e,t,d)):(Ai&&i&&S3(t),t.flags|=1,ms(e,t,a,d),t.child)}function UR(e,t,i,a,d){if(e===null){var _=i.type;return typeof _=="function"&&!q3(_)&&_.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=_,LO(e,t,_,a,d)):(e=K1(i.type,null,a,t,t.mode,d),e.ref=t.ref,e.return=t,t.child=e)}if(_=e.child,!(e.lanes&d)){var b=_.memoizedProps;if(i=i.compare,i=i!==null?i:h0,i(b,a)&&e.ref===t.ref)return Qc(e,t,d)}return t.flags|=1,e=Rd(_,a),e.ref=t.ref,e.return=t,t.child=e}function LO(e,t,i,a,d){if(e!==null){var _=e.memoizedProps;if(h0(_,a)&&e.ref===t.ref)if(Fs=!1,t.pendingProps=a=_,(e.lanes&d)!==0)e.flags&131072&&(Fs=!0);else return t.lanes=e.lanes,Qc(e,t,d)}return UE(e,t,i,a,d)}function OO(e,t,i){var a=t.pendingProps,d=a.children,_=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},_i(Am,oa),oa|=i;else{if(!(i&1073741824))return e=_!==null?_.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,_i(Am,oa),oa|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=_!==null?_.baseLanes:i,_i(Am,oa),oa|=a}else _!==null?(a=_.baseLanes|i,t.memoizedState=null):a=i,_i(Am,oa),oa|=a;return ms(e,t,d,i),t.child}function zO(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function UE(e,t,i,a,d){var _=Us(i)?mf:os.current;return _=rg(t,_),Om(t,d),i=O3(e,t,i,a,_,d),a=z3(),e!==null&&!Fs?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~d,Qc(e,t,d)):(Ai&&a&&S3(t),t.flags|=1,ms(e,t,i,d),t.child)}function VR(e,t,i,a,d){if(Us(i)){var _=!0;_b(t)}else _=!1;if(Om(t,d),t.stateNode===null)Z1(e,t),kO(t,i,a),jE(t,i,a,d),a=!0;else if(e===null){var b=t.stateNode,o=t.memoizedProps;b.props=o;var k=b.context,O=i.contextType;typeof O=="object"&&O!==null?O=Ia(O):(O=Us(i)?mf:os.current,O=rg(t,O));var z=i.getDerivedStateFromProps,F=typeof z=="function"||typeof b.getSnapshotBeforeUpdate=="function";F||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(o!==a||k!==O)&&zR(t,b,a,O),ad=!1;var G=t.memoizedState;b.state=G,wb(t,a,b,d),k=t.memoizedState,o!==a||G!==k||Bs.current||ad?(typeof z=="function"&&(FE(t,i,z,a),k=t.memoizedState),(o=ad||OR(t,i,o,a,G,k,O))?(F||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(t.flags|=4194308)):(typeof b.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=k),b.props=a,b.state=k,b.context=O,a=o):(typeof b.componentDidMount=="function"&&(t.flags|=4194308),a=!1)}else{b=t.stateNode,uO(e,t),o=t.memoizedProps,O=t.type===t.elementType?o:sl(t.type,o),b.props=O,F=t.pendingProps,G=b.context,k=i.contextType,typeof k=="object"&&k!==null?k=Ia(k):(k=Us(i)?mf:os.current,k=rg(t,k));var ee=i.getDerivedStateFromProps;(z=typeof ee=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(o!==F||G!==k)&&zR(t,b,a,k),ad=!1,G=t.memoizedState,b.state=G,wb(t,a,b,d);var J=t.memoizedState;o!==F||G!==J||Bs.current||ad?(typeof ee=="function"&&(FE(t,i,ee,a),J=t.memoizedState),(O=ad||OR(t,i,O,a,G,J,k)||!1)?(z||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(a,J,k),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(a,J,k)),typeof b.componentDidUpdate=="function"&&(t.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof b.componentDidUpdate!="function"||o===e.memoizedProps&&G===e.memoizedState||(t.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&G===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=J),b.props=a,b.state=J,b.context=k,a=O):(typeof b.componentDidUpdate!="function"||o===e.memoizedProps&&G===e.memoizedState||(t.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&G===e.memoizedState||(t.flags|=1024),a=!1)}return VE(e,t,i,a,_,d)}function VE(e,t,i,a,d,_){zO(e,t);var b=(t.flags&128)!==0;if(!a&&!b)return d&&MR(t,i,!1),Qc(e,t,_);a=t.stateNode,V9.current=t;var o=b&&typeof i.getDerivedStateFromError!="function"?null:a.render();return t.flags|=1,e!==null&&b?(t.child=ig(t,e.child,null,_),t.child=ig(t,null,o,_)):ms(e,t,o,_),t.memoizedState=a.state,d&&MR(t,i,!0),t.child}function NO(e){var t=e.stateNode;t.pendingContext?CR(e,t.pendingContext,t.pendingContext!==t.context):t.context&&CR(e,t.context,!1),k3(e,t.containerInfo)}function $R(e,t,i,a,d){return ng(),E3(d),t.flags|=256,ms(e,t,i,a),t.child}var $E={dehydrated:null,treeContext:null,retryLane:0};function GE(e){return{baseLanes:e,cachePool:null,transitions:null}}function FO(e,t,i){var a=t.pendingProps,d=zi.current,_=!1,b=(t.flags&128)!==0,o;if((o=b)||(o=e!==null&&e.memoizedState===null?!1:(d&2)!==0),o?(_=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(d|=1),_i(zi,d&1),e===null)return zE(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(b=a.children,e=a.fallback,_?(a=t.mode,_=t.child,b={mode:"hidden",children:b},!(a&1)&&_!==null?(_.childLanes=0,_.pendingProps=b):_=mw(b,a,0,null),e=lf(e,a,i,null),_.return=t,e.return=t,_.sibling=e,t.child=_,t.child.memoizedState=GE(i),t.memoizedState=$E,e):j3(t,b));if(d=e.memoizedState,d!==null&&(o=d.dehydrated,o!==null))return $9(e,t,b,a,o,d,i);if(_){_=a.fallback,b=t.mode,d=e.child,o=d.sibling;var k={mode:"hidden",children:a.children};return!(b&1)&&t.child!==d?(a=t.child,a.childLanes=0,a.pendingProps=k,t.deletions=null):(a=Rd(d,k),a.subtreeFlags=d.subtreeFlags&14680064),o!==null?_=Rd(o,_):(_=lf(_,b,i,null),_.flags|=2),_.return=t,a.return=t,a.sibling=_,t.child=a,a=_,_=t.child,b=e.child.memoizedState,b=b===null?GE(i):{baseLanes:b.baseLanes|i,cachePool:null,transitions:b.transitions},_.memoizedState=b,_.childLanes=e.childLanes&~i,t.memoizedState=$E,a}return _=e.child,e=_.sibling,a=Rd(_,{mode:"visible",children:a.children}),!(t.mode&1)&&(a.lanes=i),a.return=t,a.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=a,t.memoizedState=null,a}function j3(e,t){return t=mw({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function b1(e,t,i,a){return a!==null&&E3(a),ig(t,e.child,null,i),e=j3(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function $9(e,t,i,a,d,_,b){if(i)return t.flags&256?(t.flags&=-257,a=bT(Error(er(422))),b1(e,t,b,a)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(_=a.fallback,d=t.mode,a=mw({mode:"visible",children:a.children},d,0,null),_=lf(_,d,b,null),_.flags|=2,a.return=t,_.return=t,a.sibling=_,t.child=a,t.mode&1&&ig(t,e.child,null,b),t.child.memoizedState=GE(b),t.memoizedState=$E,_);if(!(t.mode&1))return b1(e,t,b,null);if(d.data==="$!"){if(a=d.nextSibling&&d.nextSibling.dataset,a)var o=a.dgst;return a=o,_=Error(er(419)),a=bT(_,a,void 0),b1(e,t,b,a)}if(o=(b&e.childLanes)!==0,Fs||o){if(a=ko,a!==null){switch(b&-b){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(a.suspendedLanes|b)?0:d,d!==0&&d!==_.retryLane&&(_.retryLane=d,Jc(e,d),ml(a,e,d,-1))}return H3(),a=bT(Error(er(421))),b1(e,t,b,a)}return d.data==="$?"?(t.flags|=128,t.child=e.child,t=r7.bind(null,e),d._reactRetry=t,null):(e=_.treeContext,aa=Pd(d.nextSibling),la=t,Ai=!0,ul=null,e!==null&&(Ca[Ma++]=$c,Ca[Ma++]=Gc,Ca[Ma++]=gf,$c=e.id,Gc=e.overflow,gf=t),t=j3(t,a.children),t.flags|=4096,t)}function GR(e,t,i){e.lanes|=t;var a=e.alternate;a!==null&&(a.lanes|=t),NE(e.return,t,i)}function wT(e,t,i,a,d){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:i,tailMode:d}:(_.isBackwards=t,_.rendering=null,_.renderingStartTime=0,_.last=a,_.tail=i,_.tailMode=d)}function jO(e,t,i){var a=t.pendingProps,d=a.revealOrder,_=a.tail;if(ms(e,t,a.children,i),a=zi.current,a&2)a=a&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&GR(e,i,t);else if(e.tag===19)GR(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(_i(zi,a),!(t.mode&1))t.memoizedState=null;else switch(d){case"forwards":for(i=t.child,d=null;i!==null;)e=i.alternate,e!==null&&Sb(e)===null&&(d=i),i=i.sibling;i=d,i===null?(d=t.child,t.child=null):(d=i.sibling,i.sibling=null),wT(t,!1,d,i,_);break;case"backwards":for(i=null,d=t.child,t.child=null;d!==null;){if(e=d.alternate,e!==null&&Sb(e)===null){t.child=d;break}e=d.sibling,d.sibling=i,i=d,d=e}wT(t,!0,i,null,_);break;case"together":wT(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Z1(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Qc(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),yf|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(er(153));if(t.child!==null){for(e=t.child,i=Rd(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Rd(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function G9(e,t,i){switch(t.tag){case 3:NO(t),ng();break;case 5:dO(t);break;case 1:Us(t.type)&&_b(t);break;case 4:k3(t,t.stateNode.containerInfo);break;case 10:var a=t.type._context,d=t.memoizedProps.value;_i(xb,a._currentValue),a._currentValue=d;break;case 13:if(a=t.memoizedState,a!==null)return a.dehydrated!==null?(_i(zi,zi.current&1),t.flags|=128,null):i&t.child.childLanes?FO(e,t,i):(_i(zi,zi.current&1),e=Qc(e,t,i),e!==null?e.sibling:null);_i(zi,zi.current&1);break;case 19:if(a=(i&t.childLanes)!==0,e.flags&128){if(a)return jO(e,t,i);t.flags|=128}if(d=t.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),_i(zi,zi.current),a)break;return null;case 22:case 23:return t.lanes=0,OO(e,t,i)}return Qc(e,t,i)}var BO,HE,UO,VO;BO=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};HE=function(){};UO=function(e,t,i,a){var d=e.memoizedProps;if(d!==a){e=t.stateNode,Xh(rc.current);var _=null;switch(i){case"input":d=fE(e,d),a=fE(e,a),_=[];break;case"select":d=Bi({},d,{value:void 0}),a=Bi({},a,{value:void 0}),_=[];break;case"textarea":d=gE(e,d),a=gE(e,a),_=[];break;default:typeof d.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=mb)}yE(i,a);var b;i=null;for(O in d)if(!a.hasOwnProperty(O)&&d.hasOwnProperty(O)&&d[O]!=null)if(O==="style"){var o=d[O];for(b in o)o.hasOwnProperty(b)&&(i||(i={}),i[b]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(o0.hasOwnProperty(O)?_||(_=[]):(_=_||[]).push(O,null));for(O in a){var k=a[O];if(o=d!=null?d[O]:void 0,a.hasOwnProperty(O)&&k!==o&&(k!=null||o!=null))if(O==="style")if(o){for(b in o)!o.hasOwnProperty(b)||k&&k.hasOwnProperty(b)||(i||(i={}),i[b]="");for(b in k)k.hasOwnProperty(b)&&o[b]!==k[b]&&(i||(i={}),i[b]=k[b])}else i||(_||(_=[]),_.push(O,i)),i=k;else O==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,o=o?o.__html:void 0,k!=null&&o!==k&&(_=_||[]).push(O,k)):O==="children"?typeof k!="string"&&typeof k!="number"||(_=_||[]).push(O,""+k):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(o0.hasOwnProperty(O)?(k!=null&&O==="onScroll"&&Ei("scroll",e),_||o===k||(_=[])):(_=_||[]).push(O,k))}i&&(_=_||[]).push("style",i);var O=_;(t.updateQueue=O)&&(t.flags|=4)}};VO=function(e,t,i,a){i!==a&&(t.flags|=4)};function wy(e,t){if(!Ai)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function rs(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,a=0;if(t)for(var d=e.child;d!==null;)i|=d.lanes|d.childLanes,a|=d.subtreeFlags&14680064,a|=d.flags&14680064,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)i|=d.lanes|d.childLanes,a|=d.subtreeFlags,a|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=a,e.childLanes=i,t}function H9(e,t,i){var a=t.pendingProps;switch(T3(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rs(t),null;case 1:return Us(t.type)&&gb(),rs(t),null;case 3:return a=t.stateNode,og(),Ci(Bs),Ci(os),D3(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(v1(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,ul!==null&&(QE(ul),ul=null))),HE(e,t),rs(t),null;case 5:R3(t);var d=Xh(_0.current);if(i=t.type,e!==null&&t.stateNode!=null)UO(e,t,i,a,d),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!a){if(t.stateNode===null)throw Error(er(166));return rs(t),null}if(e=Xh(rc.current),v1(t)){a=t.stateNode,i=t.type;var _=t.memoizedProps;switch(a[Kl]=t,a[m0]=_,e=(t.mode&1)!==0,i){case"dialog":Ei("cancel",a),Ei("close",a);break;case"iframe":case"object":case"embed":Ei("load",a);break;case"video":case"audio":for(d=0;d<Fy.length;d++)Ei(Fy[d],a);break;case"source":Ei("error",a);break;case"img":case"image":case"link":Ei("error",a),Ei("load",a);break;case"details":Ei("toggle",a);break;case"input":Qk(a,_),Ei("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!_.multiple},Ei("invalid",a);break;case"textarea":tR(a,_),Ei("invalid",a)}yE(i,_),d=null;for(var b in _)if(_.hasOwnProperty(b)){var o=_[b];b==="children"?typeof o=="string"?a.textContent!==o&&(_.suppressHydrationWarning!==!0&&y1(a.textContent,o,e),d=["children",o]):typeof o=="number"&&a.textContent!==""+o&&(_.suppressHydrationWarning!==!0&&y1(a.textContent,o,e),d=["children",""+o]):o0.hasOwnProperty(b)&&o!=null&&b==="onScroll"&&Ei("scroll",a)}switch(i){case"input":u1(a),eR(a,_,!0);break;case"textarea":u1(a),rR(a);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(a.onclick=mb)}a=d,t.updateQueue=a,a!==null&&(t.flags|=4)}else{b=d.nodeType===9?d:d.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=gL(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=b.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=b.createElement(i,{is:a.is}):(e=b.createElement(i),i==="select"&&(b=e,a.multiple?b.multiple=!0:a.size&&(b.size=a.size))):e=b.createElementNS(e,i),e[Kl]=t,e[m0]=a,BO(e,t,!1,!1),t.stateNode=e;e:{switch(b=vE(i,a),i){case"dialog":Ei("cancel",e),Ei("close",e),d=a;break;case"iframe":case"object":case"embed":Ei("load",e),d=a;break;case"video":case"audio":for(d=0;d<Fy.length;d++)Ei(Fy[d],e);d=a;break;case"source":Ei("error",e),d=a;break;case"img":case"image":case"link":Ei("error",e),Ei("load",e),d=a;break;case"details":Ei("toggle",e),d=a;break;case"input":Qk(e,a),d=fE(e,a),Ei("invalid",e);break;case"option":d=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},d=Bi({},a,{value:void 0}),Ei("invalid",e);break;case"textarea":tR(e,a),d=gE(e,a),Ei("invalid",e);break;default:d=a}yE(i,d),o=d;for(_ in o)if(o.hasOwnProperty(_)){var k=o[_];_==="style"?vL(e,k):_==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,k!=null&&_L(e,k)):_==="children"?typeof k=="string"?(i!=="textarea"||k!=="")&&s0(e,k):typeof k=="number"&&s0(e,""+k):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(o0.hasOwnProperty(_)?k!=null&&_==="onScroll"&&Ei("scroll",e):k!=null&&c3(e,_,k,b))}switch(i){case"input":u1(e),eR(e,a,!1);break;case"textarea":u1(e),rR(e);break;case"option":a.value!=null&&e.setAttribute("value",""+Nd(a.value));break;case"select":e.multiple=!!a.multiple,_=a.value,_!=null?km(e,!!a.multiple,_,!1):a.defaultValue!=null&&km(e,!!a.multiple,a.defaultValue,!0);break;default:typeof d.onClick=="function"&&(e.onclick=mb)}switch(i){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return rs(t),null;case 6:if(e&&t.stateNode!=null)VO(e,t,e.memoizedProps,a);else{if(typeof a!="string"&&t.stateNode===null)throw Error(er(166));if(i=Xh(_0.current),Xh(rc.current),v1(t)){if(a=t.stateNode,i=t.memoizedProps,a[Kl]=t,(_=a.nodeValue!==i)&&(e=la,e!==null))switch(e.tag){case 3:y1(a.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&y1(a.nodeValue,i,(e.mode&1)!==0)}_&&(t.flags|=4)}else a=(i.nodeType===9?i:i.ownerDocument).createTextNode(a),a[Kl]=t,t.stateNode=a}return rs(t),null;case 13:if(Ci(zi),a=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ai&&aa!==null&&t.mode&1&&!(t.flags&128))sO(),ng(),t.flags|=98560,_=!1;else if(_=v1(t),a!==null&&a.dehydrated!==null){if(e===null){if(!_)throw Error(er(318));if(_=t.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(er(317));_[Kl]=t}else ng(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;rs(t),_=!1}else ul!==null&&(QE(ul),ul=null),_=!0;if(!_)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(t.child.flags|=8192,t.mode&1&&(e===null||zi.current&1?wo===0&&(wo=3):H3())),t.updateQueue!==null&&(t.flags|=4),rs(t),null);case 4:return og(),HE(e,t),e===null&&f0(t.stateNode.containerInfo),rs(t),null;case 10:return P3(t.type._context),rs(t),null;case 17:return Us(t.type)&&gb(),rs(t),null;case 19:if(Ci(zi),_=t.memoizedState,_===null)return rs(t),null;if(a=(t.flags&128)!==0,b=_.rendering,b===null)if(a)wy(_,!1);else{if(wo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(b=Sb(e),b!==null){for(t.flags|=128,wy(_,!1),a=b.updateQueue,a!==null&&(t.updateQueue=a,t.flags|=4),t.subtreeFlags=0,a=i,i=t.child;i!==null;)_=i,e=a,_.flags&=14680066,b=_.alternate,b===null?(_.childLanes=0,_.lanes=e,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=b.childLanes,_.lanes=b.lanes,_.child=b.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=b.memoizedProps,_.memoizedState=b.memoizedState,_.updateQueue=b.updateQueue,_.type=b.type,e=b.dependencies,_.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return _i(zi,zi.current&1|2),t.child}e=e.sibling}_.tail!==null&&Qi()>ag&&(t.flags|=128,a=!0,wy(_,!1),t.lanes=4194304)}else{if(!a)if(e=Sb(b),e!==null){if(t.flags|=128,a=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),wy(_,!0),_.tail===null&&_.tailMode==="hidden"&&!b.alternate&&!Ai)return rs(t),null}else 2*Qi()-_.renderingStartTime>ag&&i!==1073741824&&(t.flags|=128,a=!0,wy(_,!1),t.lanes=4194304);_.isBackwards?(b.sibling=t.child,t.child=b):(i=_.last,i!==null?i.sibling=b:t.child=b,_.last=b)}return _.tail!==null?(t=_.tail,_.rendering=t,_.tail=t.sibling,_.renderingStartTime=Qi(),t.sibling=null,i=zi.current,_i(zi,a?i&1|2:i&1),t):(rs(t),null);case 22:case 23:return G3(),a=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(t.flags|=8192),a&&t.mode&1?oa&1073741824&&(rs(t),t.subtreeFlags&6&&(t.flags|=8192)):rs(t),null;case 24:return null;case 25:return null}throw Error(er(156,t.tag))}function q9(e,t){switch(T3(t),t.tag){case 1:return Us(t.type)&&gb(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return og(),Ci(Bs),Ci(os),D3(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return R3(t),null;case 13:if(Ci(zi),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(er(340));ng()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ci(zi),null;case 4:return og(),null;case 10:return P3(t.type._context),null;case 22:case 23:return G3(),null;case 24:return null;default:return null}}var w1=!1,is=!1,W9=typeof WeakSet=="function"?WeakSet:Set,Cr=null;function Pm(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(a){qi(e,t,a)}else i.current=null}function qE(e,t,i){try{i()}catch(a){qi(e,t,a)}}var HR=!1;function Z9(e,t){if(AE=hb,e=WL(),w3(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var a=i.getSelection&&i.getSelection();if(a&&a.rangeCount!==0){i=a.anchorNode;var d=a.anchorOffset,_=a.focusNode;a=a.focusOffset;try{i.nodeType,_.nodeType}catch{i=null;break e}var b=0,o=-1,k=-1,O=0,z=0,F=e,G=null;t:for(;;){for(var ee;F!==i||d!==0&&F.nodeType!==3||(o=b+d),F!==_||a!==0&&F.nodeType!==3||(k=b+a),F.nodeType===3&&(b+=F.nodeValue.length),(ee=F.firstChild)!==null;)G=F,F=ee;for(;;){if(F===e)break t;if(G===i&&++O===d&&(o=b),G===_&&++z===a&&(k=b),(ee=F.nextSibling)!==null)break;F=G,G=F.parentNode}F=ee}i=o===-1||k===-1?null:{start:o,end:k}}else i=null}i=i||{start:0,end:0}}else i=null;for(IE={focusedElem:e,selectionRange:i},hb=!1,Cr=t;Cr!==null;)if(t=Cr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Cr=e;else for(;Cr!==null;){t=Cr;try{var J=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(J!==null){var te=J.memoizedProps,oe=J.memoizedState,X=t.stateNode,Q=X.getSnapshotBeforeUpdate(t.elementType===t.type?te:sl(t.type,te),oe);X.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var ue=t.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(er(163))}}catch(he){qi(t,t.return,he)}if(e=t.sibling,e!==null){e.return=t.return,Cr=e;break}Cr=t.return}return J=HR,HR=!1,J}function Xy(e,t,i){var a=t.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&e)===e){var _=d.destroy;d.destroy=void 0,_!==void 0&&qE(t,i,_)}d=d.next}while(d!==a)}}function fw(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var a=i.create;i.destroy=a()}i=i.next}while(i!==t)}}function WE(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function $O(e){var t=e.alternate;t!==null&&(e.alternate=null,$O(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Kl],delete t[m0],delete t[DE],delete t[I9],delete t[k9])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function GO(e){return e.tag===5||e.tag===3||e.tag===4}function qR(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||GO(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ZE(e,t,i){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=mb));else if(a!==4&&(e=e.child,e!==null))for(ZE(e,t,i),e=e.sibling;e!==null;)ZE(e,t,i),e=e.sibling}function YE(e,t,i){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(YE(e,t,i),e=e.sibling;e!==null;)YE(e,t,i),e=e.sibling}var Bo=null,ll=!1;function Ju(e,t,i){for(i=i.child;i!==null;)HO(e,t,i),i=i.sibling}function HO(e,t,i){if(tc&&typeof tc.onCommitFiberUnmount=="function")try{tc.onCommitFiberUnmount(ow,i)}catch{}switch(i.tag){case 5:is||Pm(i,t);case 6:var a=Bo,d=ll;Bo=null,Ju(e,t,i),Bo=a,ll=d,Bo!==null&&(ll?(e=Bo,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):Bo.removeChild(i.stateNode));break;case 18:Bo!==null&&(ll?(e=Bo,i=i.stateNode,e.nodeType===8?mT(e.parentNode,i):e.nodeType===1&&mT(e,i),u0(e)):mT(Bo,i.stateNode));break;case 4:a=Bo,d=ll,Bo=i.stateNode.containerInfo,ll=!0,Ju(e,t,i),Bo=a,ll=d;break;case 0:case 11:case 14:case 15:if(!is&&(a=i.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){d=a=a.next;do{var _=d,b=_.destroy;_=_.tag,b!==void 0&&(_&2||_&4)&&qE(i,t,b),d=d.next}while(d!==a)}Ju(e,t,i);break;case 1:if(!is&&(Pm(i,t),a=i.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=i.memoizedProps,a.state=i.memoizedState,a.componentWillUnmount()}catch(o){qi(i,t,o)}Ju(e,t,i);break;case 21:Ju(e,t,i);break;case 22:i.mode&1?(is=(a=is)||i.memoizedState!==null,Ju(e,t,i),is=a):Ju(e,t,i);break;default:Ju(e,t,i)}}function WR(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new W9),t.forEach(function(a){var d=n7.bind(null,e,a);i.has(a)||(i.add(a),a.then(d,d))})}}function nl(e,t){var i=t.deletions;if(i!==null)for(var a=0;a<i.length;a++){var d=i[a];try{var _=e,b=t,o=b;e:for(;o!==null;){switch(o.tag){case 5:Bo=o.stateNode,ll=!1;break e;case 3:Bo=o.stateNode.containerInfo,ll=!0;break e;case 4:Bo=o.stateNode.containerInfo,ll=!0;break e}o=o.return}if(Bo===null)throw Error(er(160));HO(_,b,d),Bo=null,ll=!1;var k=d.alternate;k!==null&&(k.return=null),d.return=null}catch(O){qi(d,t,O)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)qO(t,e),t=t.sibling}function qO(e,t){var i=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(nl(t,e),Gl(e),a&4){try{Xy(3,e,e.return),fw(3,e)}catch(te){qi(e,e.return,te)}try{Xy(5,e,e.return)}catch(te){qi(e,e.return,te)}}break;case 1:nl(t,e),Gl(e),a&512&&i!==null&&Pm(i,i.return);break;case 5:if(nl(t,e),Gl(e),a&512&&i!==null&&Pm(i,i.return),e.flags&32){var d=e.stateNode;try{s0(d,"")}catch(te){qi(e,e.return,te)}}if(a&4&&(d=e.stateNode,d!=null)){var _=e.memoizedProps,b=i!==null?i.memoizedProps:_,o=e.type,k=e.updateQueue;if(e.updateQueue=null,k!==null)try{o==="input"&&_.type==="radio"&&_.name!=null&&pL(d,_),vE(o,b);var O=vE(o,_);for(b=0;b<k.length;b+=2){var z=k[b],F=k[b+1];z==="style"?vL(d,F):z==="dangerouslySetInnerHTML"?_L(d,F):z==="children"?s0(d,F):c3(d,z,F,O)}switch(o){case"input":pE(d,_);break;case"textarea":mL(d,_);break;case"select":var G=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!_.multiple;var ee=_.value;ee!=null?km(d,!!_.multiple,ee,!1):G!==!!_.multiple&&(_.defaultValue!=null?km(d,!!_.multiple,_.defaultValue,!0):km(d,!!_.multiple,_.multiple?[]:"",!1))}d[m0]=_}catch(te){qi(e,e.return,te)}}break;case 6:if(nl(t,e),Gl(e),a&4){if(e.stateNode===null)throw Error(er(162));d=e.stateNode,_=e.memoizedProps;try{d.nodeValue=_}catch(te){qi(e,e.return,te)}}break;case 3:if(nl(t,e),Gl(e),a&4&&i!==null&&i.memoizedState.isDehydrated)try{u0(t.containerInfo)}catch(te){qi(e,e.return,te)}break;case 4:nl(t,e),Gl(e);break;case 13:nl(t,e),Gl(e),d=e.child,d.flags&8192&&(_=d.memoizedState!==null,d.stateNode.isHidden=_,!_||d.alternate!==null&&d.alternate.memoizedState!==null||(V3=Qi())),a&4&&WR(e);break;case 22:if(z=i!==null&&i.memoizedState!==null,e.mode&1?(is=(O=is)||z,nl(t,e),is=O):nl(t,e),Gl(e),a&8192){if(O=e.memoizedState!==null,(e.stateNode.isHidden=O)&&!z&&e.mode&1)for(Cr=e,z=e.child;z!==null;){for(F=Cr=z;Cr!==null;){switch(G=Cr,ee=G.child,G.tag){case 0:case 11:case 14:case 15:Xy(4,G,G.return);break;case 1:Pm(G,G.return);var J=G.stateNode;if(typeof J.componentWillUnmount=="function"){a=G,i=G.return;try{t=a,J.props=t.memoizedProps,J.state=t.memoizedState,J.componentWillUnmount()}catch(te){qi(a,i,te)}}break;case 5:Pm(G,G.return);break;case 22:if(G.memoizedState!==null){YR(F);continue}}ee!==null?(ee.return=G,Cr=ee):YR(F)}z=z.sibling}e:for(z=null,F=e;;){if(F.tag===5){if(z===null){z=F;try{d=F.stateNode,O?(_=d.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(o=F.stateNode,k=F.memoizedProps.style,b=k!=null&&k.hasOwnProperty("display")?k.display:null,o.style.display=yL("display",b))}catch(te){qi(e,e.return,te)}}}else if(F.tag===6){if(z===null)try{F.stateNode.nodeValue=O?"":F.memoizedProps}catch(te){qi(e,e.return,te)}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===e)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===e)break e;for(;F.sibling===null;){if(F.return===null||F.return===e)break e;z===F&&(z=null),F=F.return}z===F&&(z=null),F.sibling.return=F.return,F=F.sibling}}break;case 19:nl(t,e),Gl(e),a&4&&WR(e);break;case 21:break;default:nl(t,e),Gl(e)}}function Gl(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(GO(i)){var a=i;break e}i=i.return}throw Error(er(160))}switch(a.tag){case 5:var d=a.stateNode;a.flags&32&&(s0(d,""),a.flags&=-33);var _=qR(e);YE(e,_,d);break;case 3:case 4:var b=a.stateNode.containerInfo,o=qR(e);ZE(e,o,b);break;default:throw Error(er(161))}}catch(k){qi(e,e.return,k)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Y9(e,t,i){Cr=e,WO(e)}function WO(e,t,i){for(var a=(e.mode&1)!==0;Cr!==null;){var d=Cr,_=d.child;if(d.tag===22&&a){var b=d.memoizedState!==null||w1;if(!b){var o=d.alternate,k=o!==null&&o.memoizedState!==null||is;o=w1;var O=is;if(w1=b,(is=k)&&!O)for(Cr=d;Cr!==null;)b=Cr,k=b.child,b.tag===22&&b.memoizedState!==null?XR(d):k!==null?(k.return=b,Cr=k):XR(d);for(;_!==null;)Cr=_,WO(_),_=_.sibling;Cr=d,w1=o,is=O}ZR(e)}else d.subtreeFlags&8772&&_!==null?(_.return=d,Cr=_):ZR(e)}}function ZR(e){for(;Cr!==null;){var t=Cr;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:is||fw(5,t);break;case 1:var a=t.stateNode;if(t.flags&4&&!is)if(i===null)a.componentDidMount();else{var d=t.elementType===t.type?i.memoizedProps:sl(t.type,i.memoizedProps);a.componentDidUpdate(d,i.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var _=t.updateQueue;_!==null&&RR(t,_,a);break;case 3:var b=t.updateQueue;if(b!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}RR(t,b,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var k=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":k.autoFocus&&i.focus();break;case"img":k.src&&(i.src=k.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var O=t.alternate;if(O!==null){var z=O.memoizedState;if(z!==null){var F=z.dehydrated;F!==null&&u0(F)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(er(163))}is||t.flags&512&&WE(t)}catch(G){qi(t,t.return,G)}}if(t===e){Cr=null;break}if(i=t.sibling,i!==null){i.return=t.return,Cr=i;break}Cr=t.return}}function YR(e){for(;Cr!==null;){var t=Cr;if(t===e){Cr=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Cr=i;break}Cr=t.return}}function XR(e){for(;Cr!==null;){var t=Cr;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{fw(4,t)}catch(k){qi(t,i,k)}break;case 1:var a=t.stateNode;if(typeof a.componentDidMount=="function"){var d=t.return;try{a.componentDidMount()}catch(k){qi(t,d,k)}}var _=t.return;try{WE(t)}catch(k){qi(t,_,k)}break;case 5:var b=t.return;try{WE(t)}catch(k){qi(t,b,k)}}}catch(k){qi(t,t.return,k)}if(t===e){Cr=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Cr=o;break}Cr=t.return}}var X9=Math.ceil,Cb=iu.ReactCurrentDispatcher,B3=iu.ReactCurrentOwner,Aa=iu.ReactCurrentBatchConfig,Wn=0,ko=null,so=null,Uo=0,oa=0,Am=Gd(0),wo=0,b0=null,yf=0,pw=0,U3=0,Ky=null,zs=null,V3=0,ag=1/0,Fc=null,Mb=!1,XE=null,Id=null,S1=!1,Sd=null,Pb=0,Jy=0,KE=null,Y1=-1,X1=0;function ys(){return Wn&6?Qi():Y1!==-1?Y1:Y1=Qi()}function kd(e){return e.mode&1?Wn&2&&Uo!==0?Uo&-Uo:D9.transition!==null?(X1===0&&(X1=kL()),X1):(e=ai,e!==0||(e=window.event,e=e===void 0?16:FL(e.type)),e):1}function ml(e,t,i,a){if(50<Jy)throw Jy=0,KE=null,Error(er(185));V0(e,i,a),(!(Wn&2)||e!==ko)&&(e===ko&&(!(Wn&2)&&(pw|=i),wo===4&&ud(e,Uo)),Vs(e,a),i===1&&Wn===0&&!(t.mode&1)&&(ag=Qi()+500,uw&&Hd()))}function Vs(e,t){var i=e.callbackNode;DV(e,t);var a=db(e,e===ko?Uo:0);if(a===0)i!==null&&oR(i),e.callbackNode=null,e.callbackPriority=0;else if(t=a&-a,e.callbackPriority!==t){if(i!=null&&oR(i),t===1)e.tag===0?R9(KR.bind(null,e)):nO(KR.bind(null,e)),P9(function(){!(Wn&6)&&Hd()}),i=null;else{switch(RL(a)){case 1:i=p3;break;case 4:i=AL;break;case 16:i=ub;break;case 536870912:i=IL;break;default:i=ub}i=tz(i,ZO.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function ZO(e,t){if(Y1=-1,X1=0,Wn&6)throw Error(er(327));var i=e.callbackNode;if(zm()&&e.callbackNode!==i)return null;var a=db(e,e===ko?Uo:0);if(a===0)return null;if(a&30||a&e.expiredLanes||t)t=Ab(e,a);else{t=a;var d=Wn;Wn|=2;var _=XO();(ko!==e||Uo!==t)&&(Fc=null,ag=Qi()+500,af(e,t));do try{Q9();break}catch(o){YO(e,o)}while(!0);M3(),Cb.current=_,Wn=d,so!==null?t=0:(ko=null,Uo=0,t=wo)}if(t!==0){if(t===2&&(d=TE(e),d!==0&&(a=d,t=JE(e,d))),t===1)throw i=b0,af(e,0),ud(e,a),Vs(e,Qi()),i;if(t===6)ud(e,a);else{if(d=e.current.alternate,!(a&30)&&!K9(d)&&(t=Ab(e,a),t===2&&(_=TE(e),_!==0&&(a=_,t=JE(e,_))),t===1))throw i=b0,af(e,0),ud(e,a),Vs(e,Qi()),i;switch(e.finishedWork=d,e.finishedLanes=a,t){case 0:case 1:throw Error(er(345));case 2:Bh(e,zs,Fc);break;case 3:if(ud(e,a),(a&130023424)===a&&(t=V3+500-Qi(),10<t)){if(db(e,0)!==0)break;if(d=e.suspendedLanes,(d&a)!==a){ys(),e.pingedLanes|=e.suspendedLanes&d;break}e.timeoutHandle=RE(Bh.bind(null,e,zs,Fc),t);break}Bh(e,zs,Fc);break;case 4:if(ud(e,a),(a&4194240)===a)break;for(t=e.eventTimes,d=-1;0<a;){var b=31-pl(a);_=1<<b,b=t[b],b>d&&(d=b),a&=~_}if(a=d,a=Qi()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*X9(a/1960))-a,10<a){e.timeoutHandle=RE(Bh.bind(null,e,zs,Fc),a);break}Bh(e,zs,Fc);break;case 5:Bh(e,zs,Fc);break;default:throw Error(er(329))}}}return Vs(e,Qi()),e.callbackNode===i?ZO.bind(null,e):null}function JE(e,t){var i=Ky;return e.current.memoizedState.isDehydrated&&(af(e,t).flags|=256),e=Ab(e,t),e!==2&&(t=zs,zs=i,t!==null&&QE(t)),e}function QE(e){zs===null?zs=e:zs.push.apply(zs,e)}function K9(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var a=0;a<i.length;a++){var d=i[a],_=d.getSnapshot;d=d.value;try{if(!yl(_(),d))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ud(e,t){for(t&=~U3,t&=~pw,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-pl(t),a=1<<i;e[i]=-1,t&=~a}}function KR(e){if(Wn&6)throw Error(er(327));zm();var t=db(e,0);if(!(t&1))return Vs(e,Qi()),null;var i=Ab(e,t);if(e.tag!==0&&i===2){var a=TE(e);a!==0&&(t=a,i=JE(e,a))}if(i===1)throw i=b0,af(e,0),ud(e,t),Vs(e,Qi()),i;if(i===6)throw Error(er(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Bh(e,zs,Fc),Vs(e,Qi()),null}function $3(e,t){var i=Wn;Wn|=1;try{return e(t)}finally{Wn=i,Wn===0&&(ag=Qi()+500,uw&&Hd())}}function vf(e){Sd!==null&&Sd.tag===0&&!(Wn&6)&&zm();var t=Wn;Wn|=1;var i=Aa.transition,a=ai;try{if(Aa.transition=null,ai=1,e)return e()}finally{ai=a,Aa.transition=i,Wn=t,!(Wn&6)&&Hd()}}function G3(){oa=Am.current,Ci(Am)}function af(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,M9(i)),so!==null)for(i=so.return;i!==null;){var a=i;switch(T3(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&gb();break;case 3:og(),Ci(Bs),Ci(os),D3();break;case 5:R3(a);break;case 4:og();break;case 13:Ci(zi);break;case 19:Ci(zi);break;case 10:P3(a.type._context);break;case 22:case 23:G3()}i=i.return}if(ko=e,so=e=Rd(e.current,null),Uo=oa=t,wo=0,b0=null,U3=pw=yf=0,zs=Ky=null,Yh!==null){for(t=0;t<Yh.length;t++)if(i=Yh[t],a=i.interleaved,a!==null){i.interleaved=null;var d=a.next,_=i.pending;if(_!==null){var b=_.next;_.next=d,a.next=b}i.pending=a}Yh=null}return e}function YO(e,t){do{var i=so;try{if(M3(),q1.current=Eb,Tb){for(var a=Fi.memoizedState;a!==null;){var d=a.queue;d!==null&&(d.pending=null),a=a.next}Tb=!1}if(_f=0,Ao=xo=Fi=null,Yy=!1,y0=0,B3.current=null,i===null||i.return===null){wo=1,b0=t,so=null;break}e:{var _=e,b=i.return,o=i,k=t;if(t=Uo,o.flags|=32768,k!==null&&typeof k=="object"&&typeof k.then=="function"){var O=k,z=o,F=z.tag;if(!(z.mode&1)&&(F===0||F===11||F===15)){var G=z.alternate;G?(z.updateQueue=G.updateQueue,z.memoizedState=G.memoizedState,z.lanes=G.lanes):(z.updateQueue=null,z.memoizedState=null)}var ee=FR(b);if(ee!==null){ee.flags&=-257,jR(ee,b,o,_,t),ee.mode&1&&NR(_,O,t),t=ee,k=O;var J=t.updateQueue;if(J===null){var te=new Set;te.add(k),t.updateQueue=te}else J.add(k);break e}else{if(!(t&1)){NR(_,O,t),H3();break e}k=Error(er(426))}}else if(Ai&&o.mode&1){var oe=FR(b);if(oe!==null){!(oe.flags&65536)&&(oe.flags|=256),jR(oe,b,o,_,t),E3(sg(k,o));break e}}_=k=sg(k,o),wo!==4&&(wo=2),Ky===null?Ky=[_]:Ky.push(_),_=b;do{switch(_.tag){case 3:_.flags|=65536,t&=-t,_.lanes|=t;var X=RO(_,k,t);kR(_,X);break e;case 1:o=k;var Q=_.type,ue=_.stateNode;if(!(_.flags&128)&&(typeof Q.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(Id===null||!Id.has(ue)))){_.flags|=65536,t&=-t,_.lanes|=t;var he=DO(_,o,t);kR(_,he);break e}}_=_.return}while(_!==null)}JO(i)}catch(Ie){t=Ie,so===i&&i!==null&&(so=i=i.return);continue}break}while(!0)}function XO(){var e=Cb.current;return Cb.current=Eb,e===null?Eb:e}function H3(){(wo===0||wo===3||wo===2)&&(wo=4),ko===null||!(yf&268435455)&&!(pw&268435455)||ud(ko,Uo)}function Ab(e,t){var i=Wn;Wn|=2;var a=XO();(ko!==e||Uo!==t)&&(Fc=null,af(e,t));do try{J9();break}catch(d){YO(e,d)}while(!0);if(M3(),Wn=i,Cb.current=a,so!==null)throw Error(er(261));return ko=null,Uo=0,wo}function J9(){for(;so!==null;)KO(so)}function Q9(){for(;so!==null&&!TV();)KO(so)}function KO(e){var t=ez(e.alternate,e,oa);e.memoizedProps=e.pendingProps,t===null?JO(e):so=t,B3.current=null}function JO(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=q9(i,t),i!==null){i.flags&=32767,so=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{wo=6,so=null;return}}else if(i=H9(i,t,oa),i!==null){so=i;return}if(t=t.sibling,t!==null){so=t;return}so=t=e}while(t!==null);wo===0&&(wo=5)}function Bh(e,t,i){var a=ai,d=Aa.transition;try{Aa.transition=null,ai=1,e7(e,t,i,a)}finally{Aa.transition=d,ai=a}return null}function e7(e,t,i,a){do zm();while(Sd!==null);if(Wn&6)throw Error(er(327));i=e.finishedWork;var d=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(er(177));e.callbackNode=null,e.callbackPriority=0;var _=i.lanes|i.childLanes;if(LV(e,_),e===ko&&(so=ko=null,Uo=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||S1||(S1=!0,tz(ub,function(){return zm(),null})),_=(i.flags&15990)!==0,i.subtreeFlags&15990||_){_=Aa.transition,Aa.transition=null;var b=ai;ai=1;var o=Wn;Wn|=4,B3.current=null,Z9(e,i),qO(i,e),x9(IE),hb=!!AE,IE=AE=null,e.current=i,Y9(i),EV(),Wn=o,ai=b,Aa.transition=_}else e.current=i;if(S1&&(S1=!1,Sd=e,Pb=d),_=e.pendingLanes,_===0&&(Id=null),PV(i.stateNode),Vs(e,Qi()),t!==null)for(a=e.onRecoverableError,i=0;i<t.length;i++)d=t[i],a(d.value,{componentStack:d.stack,digest:d.digest});if(Mb)throw Mb=!1,e=XE,XE=null,e;return Pb&1&&e.tag!==0&&zm(),_=e.pendingLanes,_&1?e===KE?Jy++:(Jy=0,KE=e):Jy=0,Hd(),null}function zm(){if(Sd!==null){var e=RL(Pb),t=Aa.transition,i=ai;try{if(Aa.transition=null,ai=16>e?16:e,Sd===null)var a=!1;else{if(e=Sd,Sd=null,Pb=0,Wn&6)throw Error(er(331));var d=Wn;for(Wn|=4,Cr=e.current;Cr!==null;){var _=Cr,b=_.child;if(Cr.flags&16){var o=_.deletions;if(o!==null){for(var k=0;k<o.length;k++){var O=o[k];for(Cr=O;Cr!==null;){var z=Cr;switch(z.tag){case 0:case 11:case 15:Xy(8,z,_)}var F=z.child;if(F!==null)F.return=z,Cr=F;else for(;Cr!==null;){z=Cr;var G=z.sibling,ee=z.return;if($O(z),z===O){Cr=null;break}if(G!==null){G.return=ee,Cr=G;break}Cr=ee}}}var J=_.alternate;if(J!==null){var te=J.child;if(te!==null){J.child=null;do{var oe=te.sibling;te.sibling=null,te=oe}while(te!==null)}}Cr=_}}if(_.subtreeFlags&2064&&b!==null)b.return=_,Cr=b;else e:for(;Cr!==null;){if(_=Cr,_.flags&2048)switch(_.tag){case 0:case 11:case 15:Xy(9,_,_.return)}var X=_.sibling;if(X!==null){X.return=_.return,Cr=X;break e}Cr=_.return}}var Q=e.current;for(Cr=Q;Cr!==null;){b=Cr;var ue=b.child;if(b.subtreeFlags&2064&&ue!==null)ue.return=b,Cr=ue;else e:for(b=Q;Cr!==null;){if(o=Cr,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:fw(9,o)}}catch(Ie){qi(o,o.return,Ie)}if(o===b){Cr=null;break e}var he=o.sibling;if(he!==null){he.return=o.return,Cr=he;break e}Cr=o.return}}if(Wn=d,Hd(),tc&&typeof tc.onPostCommitFiberRoot=="function")try{tc.onPostCommitFiberRoot(ow,e)}catch{}a=!0}return a}finally{ai=i,Aa.transition=t}}return!1}function JR(e,t,i){t=sg(i,t),t=RO(e,t,1),e=Ad(e,t,1),t=ys(),e!==null&&(V0(e,1,t),Vs(e,t))}function qi(e,t,i){if(e.tag===3)JR(e,e,i);else for(;t!==null;){if(t.tag===3){JR(t,e,i);break}else if(t.tag===1){var a=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Id===null||!Id.has(a))){e=sg(i,e),e=DO(t,e,1),t=Ad(t,e,1),e=ys(),t!==null&&(V0(t,1,e),Vs(t,e));break}}t=t.return}}function t7(e,t,i){var a=e.pingCache;a!==null&&a.delete(t),t=ys(),e.pingedLanes|=e.suspendedLanes&i,ko===e&&(Uo&i)===i&&(wo===4||wo===3&&(Uo&130023424)===Uo&&500>Qi()-V3?af(e,0):U3|=i),Vs(e,t)}function QO(e,t){t===0&&(e.mode&1?(t=f1,f1<<=1,!(f1&130023424)&&(f1=4194304)):t=1);var i=ys();e=Jc(e,t),e!==null&&(V0(e,t,i),Vs(e,i))}function r7(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),QO(e,i)}function n7(e,t){var i=0;switch(e.tag){case 13:var a=e.stateNode,d=e.memoizedState;d!==null&&(i=d.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(er(314))}a!==null&&a.delete(t),QO(e,i)}var ez;ez=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Bs.current)Fs=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Fs=!1,G9(e,t,i);Fs=!!(e.flags&131072)}else Fs=!1,Ai&&t.flags&1048576&&iO(t,vb,t.index);switch(t.lanes=0,t.tag){case 2:var a=t.type;Z1(e,t),e=t.pendingProps;var d=rg(t,os.current);Om(t,i),d=O3(null,t,a,e,d,i);var _=z3();return t.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Us(a)?(_=!0,_b(t)):_=!1,t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,I3(t),d.updater=hw,t.stateNode=d,d._reactInternals=t,jE(t,a,e,i),t=VE(null,t,a,!0,_,i)):(t.tag=0,Ai&&_&&S3(t),ms(null,t,d,i),t=t.child),t;case 16:a=t.elementType;e:{switch(Z1(e,t),e=t.pendingProps,d=a._init,a=d(a._payload),t.type=a,d=t.tag=o7(a),e=sl(a,e),d){case 0:t=UE(null,t,a,e,i);break e;case 1:t=VR(null,t,a,e,i);break e;case 11:t=BR(null,t,a,e,i);break e;case 14:t=UR(null,t,a,sl(a.type,e),i);break e}throw Error(er(306,a,""))}return t;case 0:return a=t.type,d=t.pendingProps,d=t.elementType===a?d:sl(a,d),UE(e,t,a,d,i);case 1:return a=t.type,d=t.pendingProps,d=t.elementType===a?d:sl(a,d),VR(e,t,a,d,i);case 3:e:{if(NO(t),e===null)throw Error(er(387));a=t.pendingProps,_=t.memoizedState,d=_.element,uO(e,t),wb(t,a,null,i);var b=t.memoizedState;if(a=b.element,_.isDehydrated)if(_={element:a,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},t.updateQueue.baseState=_,t.memoizedState=_,t.flags&256){d=sg(Error(er(423)),t),t=$R(e,t,a,i,d);break e}else if(a!==d){d=sg(Error(er(424)),t),t=$R(e,t,a,i,d);break e}else for(aa=Pd(t.stateNode.containerInfo.firstChild),la=t,Ai=!0,ul=null,i=lO(t,null,a,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(ng(),a===d){t=Qc(e,t,i);break e}ms(e,t,a,i)}t=t.child}return t;case 5:return dO(t),e===null&&zE(t),a=t.type,d=t.pendingProps,_=e!==null?e.memoizedProps:null,b=d.children,kE(a,d)?b=null:_!==null&&kE(a,_)&&(t.flags|=32),zO(e,t),ms(e,t,b,i),t.child;case 6:return e===null&&zE(t),null;case 13:return FO(e,t,i);case 4:return k3(t,t.stateNode.containerInfo),a=t.pendingProps,e===null?t.child=ig(t,null,a,i):ms(e,t,a,i),t.child;case 11:return a=t.type,d=t.pendingProps,d=t.elementType===a?d:sl(a,d),BR(e,t,a,d,i);case 7:return ms(e,t,t.pendingProps,i),t.child;case 8:return ms(e,t,t.pendingProps.children,i),t.child;case 12:return ms(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(a=t.type._context,d=t.pendingProps,_=t.memoizedProps,b=d.value,_i(xb,a._currentValue),a._currentValue=b,_!==null)if(yl(_.value,b)){if(_.children===d.children&&!Bs.current){t=Qc(e,t,i);break e}}else for(_=t.child,_!==null&&(_.return=t);_!==null;){var o=_.dependencies;if(o!==null){b=_.child;for(var k=o.firstContext;k!==null;){if(k.context===a){if(_.tag===1){k=qc(-1,i&-i),k.tag=2;var O=_.updateQueue;if(O!==null){O=O.shared;var z=O.pending;z===null?k.next=k:(k.next=z.next,z.next=k),O.pending=k}}_.lanes|=i,k=_.alternate,k!==null&&(k.lanes|=i),NE(_.return,i,t),o.lanes|=i;break}k=k.next}}else if(_.tag===10)b=_.type===t.type?null:_.child;else if(_.tag===18){if(b=_.return,b===null)throw Error(er(341));b.lanes|=i,o=b.alternate,o!==null&&(o.lanes|=i),NE(b,i,t),b=_.sibling}else b=_.child;if(b!==null)b.return=_;else for(b=_;b!==null;){if(b===t){b=null;break}if(_=b.sibling,_!==null){_.return=b.return,b=_;break}b=b.return}_=b}ms(e,t,d.children,i),t=t.child}return t;case 9:return d=t.type,a=t.pendingProps.children,Om(t,i),d=Ia(d),a=a(d),t.flags|=1,ms(e,t,a,i),t.child;case 14:return a=t.type,d=sl(a,t.pendingProps),d=sl(a.type,d),UR(e,t,a,d,i);case 15:return LO(e,t,t.type,t.pendingProps,i);case 17:return a=t.type,d=t.pendingProps,d=t.elementType===a?d:sl(a,d),Z1(e,t),t.tag=1,Us(a)?(e=!0,_b(t)):e=!1,Om(t,i),kO(t,a,d),jE(t,a,d,i),VE(null,t,a,!0,e,i);case 19:return jO(e,t,i);case 22:return OO(e,t,i)}throw Error(er(156,t.tag))};function tz(e,t){return PL(e,t)}function i7(e,t,i,a){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pa(e,t,i,a){return new i7(e,t,i,a)}function q3(e){return e=e.prototype,!(!e||!e.isReactComponent)}function o7(e){if(typeof e=="function")return q3(e)?1:0;if(e!=null){if(e=e.$$typeof,e===d3)return 11;if(e===h3)return 14}return 2}function Rd(e,t){var i=e.alternate;return i===null?(i=Pa(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function K1(e,t,i,a,d,_){var b=2;if(a=e,typeof e=="function")q3(e)&&(b=1);else if(typeof e=="string")b=5;else e:switch(e){case vm:return lf(i.children,d,_,t);case u3:b=8,d|=8;break;case cE:return e=Pa(12,i,t,d|2),e.elementType=cE,e.lanes=_,e;case uE:return e=Pa(13,i,t,d),e.elementType=uE,e.lanes=_,e;case dE:return e=Pa(19,i,t,d),e.elementType=dE,e.lanes=_,e;case dL:return mw(i,d,_,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case cL:b=10;break e;case uL:b=9;break e;case d3:b=11;break e;case h3:b=14;break e;case sd:b=16,a=null;break e}throw Error(er(130,e==null?e:typeof e,""))}return t=Pa(b,i,t,d),t.elementType=e,t.type=a,t.lanes=_,t}function lf(e,t,i,a){return e=Pa(7,e,a,t),e.lanes=i,e}function mw(e,t,i,a){return e=Pa(22,e,a,t),e.elementType=dL,e.lanes=i,e.stateNode={isHidden:!1},e}function ST(e,t,i){return e=Pa(6,e,null,t),e.lanes=i,e}function TT(e,t,i){return t=Pa(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function s7(e,t,i,a,d){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=iT(0),this.expirationTimes=iT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=iT(0),this.identifierPrefix=a,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function W3(e,t,i,a,d,_,b,o,k){return e=new s7(e,t,i,o,k),t===1?(t=1,_===!0&&(t|=8)):t=0,_=Pa(3,null,null,t),e.current=_,_.stateNode=e,_.memoizedState={element:a,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},I3(_),e}function a7(e,t,i){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ym,key:a==null?null:""+a,children:e,containerInfo:t,implementation:i}}function rz(e){if(!e)return Fd;e=e._reactInternals;e:{if(Af(e)!==e||e.tag!==1)throw Error(er(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Us(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(er(171))}if(e.tag===1){var i=e.type;if(Us(i))return rO(e,i,t)}return t}function nz(e,t,i,a,d,_,b,o,k){return e=W3(i,a,!0,e,d,_,b,o,k),e.context=rz(null),i=e.current,a=ys(),d=kd(i),_=qc(a,d),_.callback=t??null,Ad(i,_,d),e.current.lanes=d,V0(e,d,a),Vs(e,a),e}function gw(e,t,i,a){var d=t.current,_=ys(),b=kd(d);return i=rz(i),t.context===null?t.context=i:t.pendingContext=i,t=qc(_,b),t.payload={element:e},a=a===void 0?null:a,a!==null&&(t.callback=a),e=Ad(d,t,b),e!==null&&(ml(e,d,b,_),H1(e,d,b)),b}function Ib(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function QR(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function Z3(e,t){QR(e,t),(e=e.alternate)&&QR(e,t)}function l7(){return null}var iz=typeof reportError=="function"?reportError:function(e){console.error(e)};function Y3(e){this._internalRoot=e}_w.prototype.render=Y3.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(er(409));gw(e,t,null,null)};_w.prototype.unmount=Y3.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;vf(function(){gw(null,e,null,null)}),t[Kc]=null}};function _w(e){this._internalRoot=e}_w.prototype.unstable_scheduleHydration=function(e){if(e){var t=OL();e={blockedOn:null,target:e,priority:t};for(var i=0;i<cd.length&&t!==0&&t<cd[i].priority;i++);cd.splice(i,0,e),i===0&&NL(e)}};function X3(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function yw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function eD(){}function c7(e,t,i,a,d){if(d){if(typeof a=="function"){var _=a;a=function(){var O=Ib(b);_.call(O)}}var b=nz(t,a,e,0,null,!1,!1,"",eD);return e._reactRootContainer=b,e[Kc]=b.current,f0(e.nodeType===8?e.parentNode:e),vf(),b}for(;d=e.lastChild;)e.removeChild(d);if(typeof a=="function"){var o=a;a=function(){var O=Ib(k);o.call(O)}}var k=W3(e,0,!1,null,null,!1,!1,"",eD);return e._reactRootContainer=k,e[Kc]=k.current,f0(e.nodeType===8?e.parentNode:e),vf(function(){gw(t,k,i,a)}),k}function vw(e,t,i,a,d){var _=i._reactRootContainer;if(_){var b=_;if(typeof d=="function"){var o=d;d=function(){var k=Ib(b);o.call(k)}}gw(t,b,e,d)}else b=c7(i,t,e,d,a);return Ib(b)}DL=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=Ny(t.pendingLanes);i!==0&&(m3(t,i|1),Vs(t,Qi()),!(Wn&6)&&(ag=Qi()+500,Hd()))}break;case 13:vf(function(){var a=Jc(e,1);if(a!==null){var d=ys();ml(a,e,1,d)}}),Z3(e,1)}};g3=function(e){if(e.tag===13){var t=Jc(e,134217728);if(t!==null){var i=ys();ml(t,e,134217728,i)}Z3(e,134217728)}};LL=function(e){if(e.tag===13){var t=kd(e),i=Jc(e,t);if(i!==null){var a=ys();ml(i,e,t,a)}Z3(e,t)}};OL=function(){return ai};zL=function(e,t){var i=ai;try{return ai=e,t()}finally{ai=i}};bE=function(e,t,i){switch(t){case"input":if(pE(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var a=i[t];if(a!==e&&a.form===e.form){var d=cw(a);if(!d)throw Error(er(90));fL(a),pE(a,d)}}}break;case"textarea":mL(e,i);break;case"select":t=i.value,t!=null&&km(e,!!i.multiple,t,!1)}};wL=$3;SL=vf;var u7={usingClientEntryPoint:!1,Events:[G0,Sm,cw,xL,bL,$3]},Sy={findFiberByHostInstance:Zh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},d7={bundleType:Sy.bundleType,version:Sy.version,rendererPackageName:Sy.rendererPackageName,rendererConfig:Sy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:iu.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=CL(e),e===null?null:e.stateNode},findFiberByHostInstance:Sy.findFiberByHostInstance||l7,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var T1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!T1.isDisabled&&T1.supportsFiber)try{ow=T1.inject(d7),tc=T1}catch{}}fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=u7;fa.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!X3(t))throw Error(er(200));return a7(e,t,null,i)};fa.createRoot=function(e,t){if(!X3(e))throw Error(er(299));var i=!1,a="",d=iz;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(d=t.onRecoverableError)),t=W3(e,1,!1,null,null,i,!1,a,d),e[Kc]=t.current,f0(e.nodeType===8?e.parentNode:e),new Y3(t)};fa.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(er(188)):(e=Object.keys(e).join(","),Error(er(268,e)));return e=CL(t),e=e===null?null:e.stateNode,e};fa.flushSync=function(e){return vf(e)};fa.hydrate=function(e,t,i){if(!yw(t))throw Error(er(200));return vw(null,e,t,!0,i)};fa.hydrateRoot=function(e,t,i){if(!X3(e))throw Error(er(405));var a=i!=null&&i.hydratedSources||null,d=!1,_="",b=iz;if(i!=null&&(i.unstable_strictMode===!0&&(d=!0),i.identifierPrefix!==void 0&&(_=i.identifierPrefix),i.onRecoverableError!==void 0&&(b=i.onRecoverableError)),t=nz(t,null,e,1,i??null,d,!1,_,b),e[Kc]=t.current,f0(e),a)for(e=0;e<a.length;e++)i=a[e],d=i._getVersion,d=d(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,d]:t.mutableSourceEagerHydrationData.push(i,d);return new _w(t)};fa.render=function(e,t,i){if(!yw(t))throw Error(er(200));return vw(null,e,t,!1,i)};fa.unmountComponentAtNode=function(e){if(!yw(e))throw Error(er(40));return e._reactRootContainer?(vf(function(){vw(null,null,e,!1,function(){e._reactRootContainer=null,e[Kc]=null})}),!0):!1};fa.unstable_batchedUpdates=$3;fa.unstable_renderSubtreeIntoContainer=function(e,t,i,a){if(!yw(i))throw Error(er(200));if(e==null||e._reactInternals===void 0)throw Error(er(38));return vw(e,t,i,!1,a)};fa.version="18.3.1-next-f1338f8080-20240426";function oz(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oz)}catch(e){console.error(e)}}oz(),oL.exports=fa;var xg=oL.exports;const h7=r3(xg);var sz,tD=xg;sz=tD.createRoot,tD.hydrateRoot;var bg=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},xf=typeof window>"u"||"Deno"in globalThis;function Sa(){}function f7(e,t){return typeof e=="function"?e(t):e}function eC(e){return typeof e=="number"&&e>=0&&e!==1/0}function az(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Nm(e,t){return typeof e=="function"?e(t):e}function dl(e,t){return typeof e=="function"?e(t):e}function rD(e,t){const{type:i="all",exact:a,fetchStatus:d,predicate:_,queryKey:b,stale:o}=e;if(b){if(a){if(t.queryHash!==K3(b,t.options))return!1}else if(!w0(t.queryKey,b))return!1}if(i!=="all"){const k=t.isActive();if(i==="active"&&!k||i==="inactive"&&k)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||d&&d!==t.state.fetchStatus||_&&!_(t))}function nD(e,t){const{exact:i,status:a,predicate:d,mutationKey:_}=e;if(_){if(!t.options.mutationKey)return!1;if(i){if(bf(t.options.mutationKey)!==bf(_))return!1}else if(!w0(t.options.mutationKey,_))return!1}return!(a&&t.state.status!==a||d&&!d(t))}function K3(e,t){return((t==null?void 0:t.queryKeyHashFn)||bf)(e)}function bf(e){return JSON.stringify(e,(t,i)=>tC(i)?Object.keys(i).sort().reduce((a,d)=>(a[d]=i[d],a),{}):i)}function w0(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?!Object.keys(t).some(i=>!w0(e[i],t[i])):!1}function lz(e,t){if(e===t)return e;const i=iD(e)&&iD(t);if(i||tC(e)&&tC(t)){const a=i?e:Object.keys(e),d=a.length,_=i?t:Object.keys(t),b=_.length,o=i?[]:{};let k=0;for(let O=0;O<b;O++){const z=i?O:_[O];(!i&&a.includes(z)||i)&&e[z]===void 0&&t[z]===void 0?(o[z]=void 0,k++):(o[z]=lz(e[z],t[z]),o[z]===e[z]&&e[z]!==void 0&&k++)}return d===b&&k===d?e:o}return t}function kb(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}function iD(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function tC(e){if(!oD(e))return!1;const t=e.constructor;if(t===void 0)return!0;const i=t.prototype;return!(!oD(i)||!i.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function oD(e){return Object.prototype.toString.call(e)==="[object Object]"}function p7(e){return new Promise(t=>{setTimeout(t,e)})}function rC(e,t,i){return typeof i.structuralSharing=="function"?i.structuralSharing(e,t):i.structuralSharing!==!1?lz(e,t):t}function m7(e,t,i=0){const a=[...e,t];return i&&a.length>i?a.slice(1):a}function g7(e,t,i=0){const a=[t,...e];return i&&a.length>i?a.slice(0,-1):a}var J3=Symbol();function cz(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===J3?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var Qh,fd,Vm,N4,_7=(N4=class extends bg{constructor(){super();Hr(this,Qh);Hr(this,fd);Hr(this,Vm);Sr(this,Vm,t=>{if(!xf&&window.addEventListener){const i=()=>t();return window.addEventListener("visibilitychange",i,!1),()=>{window.removeEventListener("visibilitychange",i)}}})}onSubscribe(){nt(this,fd)||this.setEventListener(nt(this,Vm))}onUnsubscribe(){var t;this.hasListeners()||((t=nt(this,fd))==null||t.call(this),Sr(this,fd,void 0))}setEventListener(t){var i;Sr(this,Vm,t),(i=nt(this,fd))==null||i.call(this),Sr(this,fd,t(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(t){nt(this,Qh)!==t&&(Sr(this,Qh,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(i=>{i(t)})}isFocused(){var t;return typeof nt(this,Qh)=="boolean"?nt(this,Qh):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Qh=new WeakMap,fd=new WeakMap,Vm=new WeakMap,N4),Q3=new _7,$m,pd,Gm,F4,y7=(F4=class extends bg{constructor(){super();Hr(this,$m,!0);Hr(this,pd);Hr(this,Gm);Sr(this,Gm,t=>{if(!xf&&window.addEventListener){const i=()=>t(!0),a=()=>t(!1);return window.addEventListener("online",i,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",a)}}})}onSubscribe(){nt(this,pd)||this.setEventListener(nt(this,Gm))}onUnsubscribe(){var t;this.hasListeners()||((t=nt(this,pd))==null||t.call(this),Sr(this,pd,void 0))}setEventListener(t){var i;Sr(this,Gm,t),(i=nt(this,pd))==null||i.call(this),Sr(this,pd,t(this.setOnline.bind(this)))}setOnline(t){nt(this,$m)!==t&&(Sr(this,$m,t),this.listeners.forEach(a=>{a(t)}))}isOnline(){return nt(this,$m)}},$m=new WeakMap,pd=new WeakMap,Gm=new WeakMap,F4),Rb=new y7;function nC(){let e,t;const i=new Promise((d,_)=>{e=d,t=_});i.status="pending",i.catch(()=>{});function a(d){Object.assign(i,d),delete i.resolve,delete i.reject}return i.resolve=d=>{a({status:"fulfilled",value:d}),e(d)},i.reject=d=>{a({status:"rejected",reason:d}),t(d)},i}function v7(e){return Math.min(1e3*2**e,3e4)}function uz(e){return(e??"online")==="online"?Rb.isOnline():!0}var dz=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function ET(e){return e instanceof dz}function hz(e){let t=!1,i=0,a=!1,d;const _=nC(),b=te=>{var oe;a||(G(new dz(te)),(oe=e.abort)==null||oe.call(e))},o=()=>{t=!0},k=()=>{t=!1},O=()=>Q3.isFocused()&&(e.networkMode==="always"||Rb.isOnline())&&e.canRun(),z=()=>uz(e.networkMode)&&e.canRun(),F=te=>{var oe;a||(a=!0,(oe=e.onSuccess)==null||oe.call(e,te),d==null||d(),_.resolve(te))},G=te=>{var oe;a||(a=!0,(oe=e.onError)==null||oe.call(e,te),d==null||d(),_.reject(te))},ee=()=>new Promise(te=>{var oe;d=X=>{(a||O())&&te(X)},(oe=e.onPause)==null||oe.call(e)}).then(()=>{var te;d=void 0,a||(te=e.onContinue)==null||te.call(e)}),J=()=>{if(a)return;let te;const oe=i===0?e.initialPromise:void 0;try{te=oe??e.fn()}catch(X){te=Promise.reject(X)}Promise.resolve(te).then(F).catch(X=>{var Je;if(a)return;const Q=e.retry??(xf?0:3),ue=e.retryDelay??v7,he=typeof ue=="function"?ue(i,X):ue,Ie=Q===!0||typeof Q=="number"&&i<Q||typeof Q=="function"&&Q(i,X);if(t||!Ie){G(X);return}i++,(Je=e.onFail)==null||Je.call(e,i,X),p7(he).then(()=>O()?void 0:ee()).then(()=>{t?G(X):J()})})};return{promise:_,cancel:b,continue:()=>(d==null||d(),_),cancelRetry:o,continueRetry:k,canStart:z,start:()=>(z()?J():ee().then(J),_)}}function x7(){let e=[],t=0,i=o=>{o()},a=o=>{o()},d=o=>setTimeout(o,0);const _=o=>{t?e.push(o):d(()=>{i(o)})},b=()=>{const o=e;e=[],o.length&&d(()=>{a(()=>{o.forEach(k=>{i(k)})})})};return{batch:o=>{let k;t++;try{k=o()}finally{t--,t||b()}return k},batchCalls:o=>(...k)=>{_(()=>{o(...k)})},schedule:_,setNotifyFunction:o=>{i=o},setBatchNotifyFunction:o=>{a=o},setScheduler:o=>{d=o}}}var bo=x7(),ef,j4,fz=(j4=class{constructor(){Hr(this,ef)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),eC(this.gcTime)&&Sr(this,ef,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(xf?1/0:5*60*1e3))}clearGcTimeout(){nt(this,ef)&&(clearTimeout(nt(this,ef)),Sr(this,ef,void 0))}},ef=new WeakMap,j4),Hm,qm,wa,ns,N0,tf,al,Nc,B4,b7=(B4=class extends fz{constructor(t){super();Hr(this,al);Hr(this,Hm);Hr(this,qm);Hr(this,wa);Hr(this,ns);Hr(this,N0);Hr(this,tf);Sr(this,tf,!1),Sr(this,N0,t.defaultOptions),this.setOptions(t.options),this.observers=[],Sr(this,wa,t.cache),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Sr(this,Hm,w7(this.options)),this.state=t.state??nt(this,Hm),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=nt(this,ns))==null?void 0:t.promise}setOptions(t){this.options={...nt(this,N0),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&nt(this,wa).remove(this)}setData(t,i){const a=rC(this.state.data,t,this.options);return wn(this,al,Nc).call(this,{data:a,type:"success",dataUpdatedAt:i==null?void 0:i.updatedAt,manual:i==null?void 0:i.manual}),a}setState(t,i){wn(this,al,Nc).call(this,{type:"setState",state:t,setStateOptions:i})}cancel(t){var a,d;const i=(a=nt(this,ns))==null?void 0:a.promise;return(d=nt(this,ns))==null||d.cancel(t),i?i.then(Sa).catch(Sa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(nt(this,Hm))}isActive(){return this.observers.some(t=>dl(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===J3||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!az(this.state.dataUpdatedAt,t)}onFocus(){var i;const t=this.observers.find(a=>a.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(i=nt(this,ns))==null||i.continue()}onOnline(){var i;const t=this.observers.find(a=>a.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(i=nt(this,ns))==null||i.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),nt(this,wa).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(i=>i!==t),this.observers.length||(nt(this,ns)&&(nt(this,tf)?nt(this,ns).cancel({revert:!0}):nt(this,ns).cancelRetry()),this.scheduleGc()),nt(this,wa).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||wn(this,al,Nc).call(this,{type:"invalidate"})}fetch(t,i){var k,O,z;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(i!=null&&i.cancelRefetch))this.cancel({silent:!0});else if(nt(this,ns))return nt(this,ns).continueRetry(),nt(this,ns).promise}if(t&&this.setOptions(t),!this.options.queryFn){const F=this.observers.find(G=>G.options.queryFn);F&&this.setOptions(F.options)}const a=new AbortController,d=F=>{Object.defineProperty(F,"signal",{enumerable:!0,get:()=>(Sr(this,tf,!0),a.signal)})},_=()=>{const F=cz(this.options,i),G={queryKey:this.queryKey,meta:this.meta};return d(G),Sr(this,tf,!1),this.options.persister?this.options.persister(F,G,this):F(G)},b={fetchOptions:i,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:_};d(b),(k=this.options.behavior)==null||k.onFetch(b,this),Sr(this,qm,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((O=b.fetchOptions)==null?void 0:O.meta))&&wn(this,al,Nc).call(this,{type:"fetch",meta:(z=b.fetchOptions)==null?void 0:z.meta});const o=F=>{var G,ee,J,te;ET(F)&&F.silent||wn(this,al,Nc).call(this,{type:"error",error:F}),ET(F)||((ee=(G=nt(this,wa).config).onError)==null||ee.call(G,F,this),(te=(J=nt(this,wa).config).onSettled)==null||te.call(J,this.state.data,F,this)),this.scheduleGc()};return Sr(this,ns,hz({initialPromise:i==null?void 0:i.initialPromise,fn:b.fetchFn,abort:a.abort.bind(a),onSuccess:F=>{var G,ee,J,te;if(F===void 0){o(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(F)}catch(oe){o(oe);return}(ee=(G=nt(this,wa).config).onSuccess)==null||ee.call(G,F,this),(te=(J=nt(this,wa).config).onSettled)==null||te.call(J,F,this.state.error,this),this.scheduleGc()},onError:o,onFail:(F,G)=>{wn(this,al,Nc).call(this,{type:"failed",failureCount:F,error:G})},onPause:()=>{wn(this,al,Nc).call(this,{type:"pause"})},onContinue:()=>{wn(this,al,Nc).call(this,{type:"continue"})},retry:b.options.retry,retryDelay:b.options.retryDelay,networkMode:b.options.networkMode,canRun:()=>!0})),nt(this,ns).start()}},Hm=new WeakMap,qm=new WeakMap,wa=new WeakMap,ns=new WeakMap,N0=new WeakMap,tf=new WeakMap,al=new WeakSet,Nc=function(t){const i=a=>{switch(t.type){case"failed":return{...a,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...pz(a.data,this.options),fetchMeta:t.meta??null};case"success":return{...a,data:t.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const d=t.error;return ET(d)&&d.revert&&nt(this,qm)?{...nt(this,qm),fetchStatus:"idle"}:{...a,error:d,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:d,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...t.state}}};this.state=i(this.state),bo.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),nt(this,wa).notify({query:this,type:"updated",action:t})})},B4);function pz(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:uz(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function w7(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,i=t!==void 0,a=i?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}var Wl,U4,S7=(U4=class extends bg{constructor(t={}){super();Hr(this,Wl);this.config=t,Sr(this,Wl,new Map)}build(t,i,a){const d=i.queryKey,_=i.queryHash??K3(d,i);let b=this.get(_);return b||(b=new b7({cache:this,queryKey:d,queryHash:_,options:t.defaultQueryOptions(i),state:a,defaultOptions:t.getQueryDefaults(d)}),this.add(b)),b}add(t){nt(this,Wl).has(t.queryHash)||(nt(this,Wl).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const i=nt(this,Wl).get(t.queryHash);i&&(t.destroy(),i===t&&nt(this,Wl).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){bo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return nt(this,Wl).get(t)}getAll(){return[...nt(this,Wl).values()]}find(t){const i={exact:!0,...t};return this.getAll().find(a=>rD(i,a))}findAll(t={}){const i=this.getAll();return Object.keys(t).length>0?i.filter(a=>rD(t,a)):i}notify(t){bo.batch(()=>{this.listeners.forEach(i=>{i(t)})})}onFocus(){bo.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){bo.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Wl=new WeakMap,U4),Zl,fs,rf,Yl,rd,V4,T7=(V4=class extends fz{constructor(t){super();Hr(this,Yl);Hr(this,Zl);Hr(this,fs);Hr(this,rf);this.mutationId=t.mutationId,Sr(this,fs,t.mutationCache),Sr(this,Zl,[]),this.state=t.state||mz(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){nt(this,Zl).includes(t)||(nt(this,Zl).push(t),this.clearGcTimeout(),nt(this,fs).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Sr(this,Zl,nt(this,Zl).filter(i=>i!==t)),this.scheduleGc(),nt(this,fs).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){nt(this,Zl).length||(this.state.status==="pending"?this.scheduleGc():nt(this,fs).remove(this))}continue(){var t;return((t=nt(this,rf))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var d,_,b,o,k,O,z,F,G,ee,J,te,oe,X,Q,ue,he,Ie,Je,Ce;Sr(this,rf,hz({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(Ze,et)=>{wn(this,Yl,rd).call(this,{type:"failed",failureCount:Ze,error:et})},onPause:()=>{wn(this,Yl,rd).call(this,{type:"pause"})},onContinue:()=>{wn(this,Yl,rd).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>nt(this,fs).canRun(this)}));const i=this.state.status==="pending",a=!nt(this,rf).canStart();try{if(!i){wn(this,Yl,rd).call(this,{type:"pending",variables:t,isPaused:a}),await((_=(d=nt(this,fs).config).onMutate)==null?void 0:_.call(d,t,this));const et=await((o=(b=this.options).onMutate)==null?void 0:o.call(b,t));et!==this.state.context&&wn(this,Yl,rd).call(this,{type:"pending",context:et,variables:t,isPaused:a})}const Ze=await nt(this,rf).start();return await((O=(k=nt(this,fs).config).onSuccess)==null?void 0:O.call(k,Ze,t,this.state.context,this)),await((F=(z=this.options).onSuccess)==null?void 0:F.call(z,Ze,t,this.state.context)),await((ee=(G=nt(this,fs).config).onSettled)==null?void 0:ee.call(G,Ze,null,this.state.variables,this.state.context,this)),await((te=(J=this.options).onSettled)==null?void 0:te.call(J,Ze,null,t,this.state.context)),wn(this,Yl,rd).call(this,{type:"success",data:Ze}),Ze}catch(Ze){try{throw await((X=(oe=nt(this,fs).config).onError)==null?void 0:X.call(oe,Ze,t,this.state.context,this)),await((ue=(Q=this.options).onError)==null?void 0:ue.call(Q,Ze,t,this.state.context)),await((Ie=(he=nt(this,fs).config).onSettled)==null?void 0:Ie.call(he,void 0,Ze,this.state.variables,this.state.context,this)),await((Ce=(Je=this.options).onSettled)==null?void 0:Ce.call(Je,void 0,Ze,t,this.state.context)),Ze}finally{wn(this,Yl,rd).call(this,{type:"error",error:Ze})}}finally{nt(this,fs).runNext(this)}}},Zl=new WeakMap,fs=new WeakMap,rf=new WeakMap,Yl=new WeakSet,rd=function(t){const i=a=>{switch(t.type){case"failed":return{...a,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...a,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:t.error,failureCount:a.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=i(this.state),bo.batch(()=>{nt(this,Zl).forEach(a=>{a.onMutationUpdate(t)}),nt(this,fs).notify({mutation:this,type:"updated",action:t})})},V4);function mz(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ia,F0,$4,E7=($4=class extends bg{constructor(t={}){super();Hr(this,ia);Hr(this,F0);this.config=t,Sr(this,ia,new Map),Sr(this,F0,Date.now())}build(t,i,a){const d=new T7({mutationCache:this,mutationId:++a1(this,F0)._,options:t.defaultMutationOptions(i),state:a});return this.add(d),d}add(t){const i=E1(t),a=nt(this,ia).get(i)??[];a.push(t),nt(this,ia).set(i,a),this.notify({type:"added",mutation:t})}remove(t){var a;const i=E1(t);if(nt(this,ia).has(i)){const d=(a=nt(this,ia).get(i))==null?void 0:a.filter(_=>_!==t);d&&(d.length===0?nt(this,ia).delete(i):nt(this,ia).set(i,d))}this.notify({type:"removed",mutation:t})}canRun(t){var a;const i=(a=nt(this,ia).get(E1(t)))==null?void 0:a.find(d=>d.state.status==="pending");return!i||i===t}runNext(t){var a;const i=(a=nt(this,ia).get(E1(t)))==null?void 0:a.find(d=>d!==t&&d.state.isPaused);return(i==null?void 0:i.continue())??Promise.resolve()}clear(){bo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}getAll(){return[...nt(this,ia).values()].flat()}find(t){const i={exact:!0,...t};return this.getAll().find(a=>nD(i,a))}findAll(t={}){return this.getAll().filter(i=>nD(t,i))}notify(t){bo.batch(()=>{this.listeners.forEach(i=>{i(t)})})}resumePausedMutations(){const t=this.getAll().filter(i=>i.state.isPaused);return bo.batch(()=>Promise.all(t.map(i=>i.continue().catch(Sa))))}},ia=new WeakMap,F0=new WeakMap,$4);function E1(e){var t;return((t=e.options.scope)==null?void 0:t.id)??String(e.mutationId)}function Db(e){return{onFetch:(t,i)=>{var z,F,G,ee,J;const a=t.options,d=(G=(F=(z=t.fetchOptions)==null?void 0:z.meta)==null?void 0:F.fetchMore)==null?void 0:G.direction,_=((ee=t.state.data)==null?void 0:ee.pages)||[],b=((J=t.state.data)==null?void 0:J.pageParams)||[];let o={pages:[],pageParams:[]},k=0;const O=async()=>{let te=!1;const oe=ue=>{Object.defineProperty(ue,"signal",{enumerable:!0,get:()=>(t.signal.aborted?te=!0:t.signal.addEventListener("abort",()=>{te=!0}),t.signal)})},X=cz(t.options,t.fetchOptions),Q=async(ue,he,Ie)=>{if(te)return Promise.reject();if(he==null&&ue.pages.length)return Promise.resolve(ue);const Je={queryKey:t.queryKey,pageParam:he,direction:Ie?"backward":"forward",meta:t.options.meta};oe(Je);const Ce=await X(Je),{maxPages:Ze}=t.options,et=Ie?g7:m7;return{pages:et(ue.pages,Ce,Ze),pageParams:et(ue.pageParams,he,Ze)}};if(d&&_.length){const ue=d==="backward",he=ue?gz:iC,Ie={pages:_,pageParams:b},Je=he(a,Ie);o=await Q(Ie,Je,ue)}else{const ue=e??_.length;do{const he=k===0?b[0]??a.initialPageParam:iC(a,o);if(k>0&&he==null)break;o=await Q(o,he),k++}while(k<ue)}return o};t.options.persister?t.fetchFn=()=>{var te,oe;return(oe=(te=t.options).persister)==null?void 0:oe.call(te,O,{queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i)}:t.fetchFn=O}}}function iC(e,{pages:t,pageParams:i}){const a=t.length-1;return t.length>0?e.getNextPageParam(t[a],t,i[a],i):void 0}function gz(e,{pages:t,pageParams:i}){var a;return t.length>0?(a=e.getPreviousPageParam)==null?void 0:a.call(e,t[0],t,i[0],i):void 0}function C7(e,t){return t?iC(e,t)!=null:!1}function M7(e,t){return!t||!e.getPreviousPageParam?!1:gz(e,t)!=null}var Hi,md,gd,Wm,Zm,_d,Ym,Xm,G4,P7=(G4=class{constructor(e={}){Hr(this,Hi);Hr(this,md);Hr(this,gd);Hr(this,Wm);Hr(this,Zm);Hr(this,_d);Hr(this,Ym);Hr(this,Xm);Sr(this,Hi,e.queryCache||new S7),Sr(this,md,e.mutationCache||new E7),Sr(this,gd,e.defaultOptions||{}),Sr(this,Wm,new Map),Sr(this,Zm,new Map),Sr(this,_d,0)}mount(){a1(this,_d)._++,nt(this,_d)===1&&(Sr(this,Ym,Q3.subscribe(async e=>{e&&(await this.resumePausedMutations(),nt(this,Hi).onFocus())})),Sr(this,Xm,Rb.subscribe(async e=>{e&&(await this.resumePausedMutations(),nt(this,Hi).onOnline())})))}unmount(){var e,t;a1(this,_d)._--,nt(this,_d)===0&&((e=nt(this,Ym))==null||e.call(this),Sr(this,Ym,void 0),(t=nt(this,Xm))==null||t.call(this),Sr(this,Xm,void 0))}isFetching(e){return nt(this,Hi).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return nt(this,md).findAll({...e,status:"pending"}).length}getQueryData(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=nt(this,Hi).get(t.queryHash))==null?void 0:i.state.data}ensureQueryData(e){const t=this.getQueryData(e.queryKey);if(t===void 0)return this.fetchQuery(e);{const i=this.defaultQueryOptions(e),a=nt(this,Hi).build(this,i);return e.revalidateIfStale&&a.isStaleByTime(Nm(i.staleTime,a))&&this.prefetchQuery(i),Promise.resolve(t)}}getQueriesData(e){return nt(this,Hi).findAll(e).map(({queryKey:t,state:i})=>{const a=i.data;return[t,a]})}setQueryData(e,t,i){const a=this.defaultQueryOptions({queryKey:e}),d=nt(this,Hi).get(a.queryHash),_=d==null?void 0:d.state.data,b=f7(t,_);if(b!==void 0)return nt(this,Hi).build(this,a).setData(b,{...i,manual:!0})}setQueriesData(e,t,i){return bo.batch(()=>nt(this,Hi).findAll(e).map(({queryKey:a})=>[a,this.setQueryData(a,t,i)]))}getQueryState(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=nt(this,Hi).get(t.queryHash))==null?void 0:i.state}removeQueries(e){const t=nt(this,Hi);bo.batch(()=>{t.findAll(e).forEach(i=>{t.remove(i)})})}resetQueries(e,t){const i=nt(this,Hi),a={type:"active",...e};return bo.batch(()=>(i.findAll(e).forEach(d=>{d.reset()}),this.refetchQueries(a,t)))}cancelQueries(e={},t={}){const i={revert:!0,...t},a=bo.batch(()=>nt(this,Hi).findAll(e).map(d=>d.cancel(i)));return Promise.all(a).then(Sa).catch(Sa)}invalidateQueries(e={},t={}){return bo.batch(()=>{if(nt(this,Hi).findAll(e).forEach(a=>{a.invalidate()}),e.refetchType==="none")return Promise.resolve();const i={...e,type:e.refetchType??e.type??"active"};return this.refetchQueries(i,t)})}refetchQueries(e={},t){const i={...t,cancelRefetch:(t==null?void 0:t.cancelRefetch)??!0},a=bo.batch(()=>nt(this,Hi).findAll(e).filter(d=>!d.isDisabled()).map(d=>{let _=d.fetch(void 0,i);return i.throwOnError||(_=_.catch(Sa)),d.state.fetchStatus==="paused"?Promise.resolve():_}));return Promise.all(a).then(Sa)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const i=nt(this,Hi).build(this,t);return i.isStaleByTime(Nm(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Sa).catch(Sa)}fetchInfiniteQuery(e){return e.behavior=Db(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Sa).catch(Sa)}ensureInfiniteQueryData(e){return e.behavior=Db(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Rb.isOnline()?nt(this,md).resumePausedMutations():Promise.resolve()}getQueryCache(){return nt(this,Hi)}getMutationCache(){return nt(this,md)}getDefaultOptions(){return nt(this,gd)}setDefaultOptions(e){Sr(this,gd,e)}setQueryDefaults(e,t){nt(this,Wm).set(bf(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...nt(this,Wm).values()];let i={};return t.forEach(a=>{w0(e,a.queryKey)&&(i={...i,...a.defaultOptions})}),i}setMutationDefaults(e,t){nt(this,Zm).set(bf(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...nt(this,Zm).values()];let i={};return t.forEach(a=>{w0(e,a.mutationKey)&&(i={...i,...a.defaultOptions})}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t={...nt(this,gd).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=K3(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.enabled!==!0&&t.queryFn===J3&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...nt(this,gd).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){nt(this,Hi).clear(),nt(this,md).clear()}},Hi=new WeakMap,md=new WeakMap,gd=new WeakMap,Wm=new WeakMap,Zm=new WeakMap,_d=new WeakMap,Ym=new WeakMap,Xm=new WeakMap,G4),Ds,Un,j0,ps,nf,Km,yd,Xl,B0,Jm,Qm,of,sf,vd,eg,ii,jy,oC,sC,aC,lC,cC,uC,dC,yz,H4,_z=(H4=class extends bg{constructor(t,i){super();Hr(this,ii);Hr(this,Ds);Hr(this,Un);Hr(this,j0);Hr(this,ps);Hr(this,nf);Hr(this,Km);Hr(this,yd);Hr(this,Xl);Hr(this,B0);Hr(this,Jm);Hr(this,Qm);Hr(this,of);Hr(this,sf);Hr(this,vd);Hr(this,eg,new Set);this.options=i,Sr(this,Ds,t),Sr(this,Xl,null),Sr(this,yd,nC()),this.options.experimental_prefetchInRender||nt(this,yd).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(i)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(nt(this,Un).addObserver(this),sD(nt(this,Un),this.options)?wn(this,ii,jy).call(this):this.updateResult(),wn(this,ii,lC).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return hC(nt(this,Un),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return hC(nt(this,Un),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,wn(this,ii,cC).call(this),wn(this,ii,uC).call(this),nt(this,Un).removeObserver(this)}setOptions(t,i){const a=this.options,d=nt(this,Un);if(this.options=nt(this,Ds).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof dl(this.options.enabled,nt(this,Un))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");wn(this,ii,dC).call(this),nt(this,Un).setOptions(this.options),a._defaulted&&!kb(this.options,a)&&nt(this,Ds).getQueryCache().notify({type:"observerOptionsUpdated",query:nt(this,Un),observer:this});const _=this.hasListeners();_&&aD(nt(this,Un),d,this.options,a)&&wn(this,ii,jy).call(this),this.updateResult(i),_&&(nt(this,Un)!==d||dl(this.options.enabled,nt(this,Un))!==dl(a.enabled,nt(this,Un))||Nm(this.options.staleTime,nt(this,Un))!==Nm(a.staleTime,nt(this,Un)))&&wn(this,ii,oC).call(this);const b=wn(this,ii,sC).call(this);_&&(nt(this,Un)!==d||dl(this.options.enabled,nt(this,Un))!==dl(a.enabled,nt(this,Un))||b!==nt(this,vd))&&wn(this,ii,aC).call(this,b)}getOptimisticResult(t){const i=nt(this,Ds).getQueryCache().build(nt(this,Ds),t),a=this.createResult(i,t);return I7(this,a)&&(Sr(this,ps,a),Sr(this,Km,this.options),Sr(this,nf,nt(this,Un).state)),a}getCurrentResult(){return nt(this,ps)}trackResult(t,i){const a={};return Object.keys(t).forEach(d=>{Object.defineProperty(a,d,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(d),i==null||i(d),t[d])})}),a}trackProp(t){nt(this,eg).add(t)}getCurrentQuery(){return nt(this,Un)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const i=nt(this,Ds).defaultQueryOptions(t),a=nt(this,Ds).getQueryCache().build(nt(this,Ds),i);return a.fetch().then(()=>this.createResult(a,i))}fetch(t){return wn(this,ii,jy).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),nt(this,ps)))}createResult(t,i){var Ze;const a=nt(this,Un),d=this.options,_=nt(this,ps),b=nt(this,nf),o=nt(this,Km),O=t!==a?t.state:nt(this,j0),{state:z}=t;let F={...z},G=!1,ee;if(i._optimisticResults){const et=this.hasListeners(),Ge=!et&&sD(t,i),qe=et&&aD(t,a,i,d);(Ge||qe)&&(F={...F,...pz(z.data,t.options)}),i._optimisticResults==="isRestoring"&&(F.fetchStatus="idle")}let{error:J,errorUpdatedAt:te,status:oe}=F;if(i.select&&F.data!==void 0)if(_&&F.data===(b==null?void 0:b.data)&&i.select===nt(this,B0))ee=nt(this,Jm);else try{Sr(this,B0,i.select),ee=i.select(F.data),ee=rC(_==null?void 0:_.data,ee,i),Sr(this,Jm,ee),Sr(this,Xl,null)}catch(et){Sr(this,Xl,et)}else ee=F.data;if(i.placeholderData!==void 0&&ee===void 0&&oe==="pending"){let et;if(_!=null&&_.isPlaceholderData&&i.placeholderData===(o==null?void 0:o.placeholderData))et=_.data;else if(et=typeof i.placeholderData=="function"?i.placeholderData((Ze=nt(this,Qm))==null?void 0:Ze.state.data,nt(this,Qm)):i.placeholderData,i.select&&et!==void 0)try{et=i.select(et),Sr(this,Xl,null)}catch(Ge){Sr(this,Xl,Ge)}et!==void 0&&(oe="success",ee=rC(_==null?void 0:_.data,et,i),G=!0)}nt(this,Xl)&&(J=nt(this,Xl),ee=nt(this,Jm),te=Date.now(),oe="error");const X=F.fetchStatus==="fetching",Q=oe==="pending",ue=oe==="error",he=Q&&X,Ie=ee!==void 0,Ce={status:oe,fetchStatus:F.fetchStatus,isPending:Q,isSuccess:oe==="success",isError:ue,isInitialLoading:he,isLoading:he,data:ee,dataUpdatedAt:F.dataUpdatedAt,error:J,errorUpdatedAt:te,failureCount:F.fetchFailureCount,failureReason:F.fetchFailureReason,errorUpdateCount:F.errorUpdateCount,isFetched:F.dataUpdateCount>0||F.errorUpdateCount>0,isFetchedAfterMount:F.dataUpdateCount>O.dataUpdateCount||F.errorUpdateCount>O.errorUpdateCount,isFetching:X,isRefetching:X&&!Q,isLoadingError:ue&&!Ie,isPaused:F.fetchStatus==="paused",isPlaceholderData:G,isRefetchError:ue&&Ie,isStale:eM(t,i),refetch:this.refetch,promise:nt(this,yd)};if(this.options.experimental_prefetchInRender){const et=_t=>{Ce.status==="error"?_t.reject(Ce.error):Ce.data!==void 0&&_t.resolve(Ce.data)},Ge=()=>{const _t=Sr(this,yd,Ce.promise=nC());et(_t)},qe=nt(this,yd);switch(qe.status){case"pending":t.queryHash===a.queryHash&&et(qe);break;case"fulfilled":(Ce.status==="error"||Ce.data!==qe.value)&&Ge();break;case"rejected":(Ce.status!=="error"||Ce.error!==qe.reason)&&Ge();break}}return Ce}updateResult(t){const i=nt(this,ps),a=this.createResult(nt(this,Un),this.options);if(Sr(this,nf,nt(this,Un).state),Sr(this,Km,this.options),nt(this,nf).data!==void 0&&Sr(this,Qm,nt(this,Un)),kb(a,i))return;Sr(this,ps,a);const d={},_=()=>{if(!i)return!0;const{notifyOnChangeProps:b}=this.options,o=typeof b=="function"?b():b;if(o==="all"||!o&&!nt(this,eg).size)return!0;const k=new Set(o??nt(this,eg));return this.options.throwOnError&&k.add("error"),Object.keys(nt(this,ps)).some(O=>{const z=O;return nt(this,ps)[z]!==i[z]&&k.has(z)})};(t==null?void 0:t.listeners)!==!1&&_()&&(d.listeners=!0),wn(this,ii,yz).call(this,{...d,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&wn(this,ii,lC).call(this)}},Ds=new WeakMap,Un=new WeakMap,j0=new WeakMap,ps=new WeakMap,nf=new WeakMap,Km=new WeakMap,yd=new WeakMap,Xl=new WeakMap,B0=new WeakMap,Jm=new WeakMap,Qm=new WeakMap,of=new WeakMap,sf=new WeakMap,vd=new WeakMap,eg=new WeakMap,ii=new WeakSet,jy=function(t){wn(this,ii,dC).call(this);let i=nt(this,Un).fetch(this.options,t);return t!=null&&t.throwOnError||(i=i.catch(Sa)),i},oC=function(){wn(this,ii,cC).call(this);const t=Nm(this.options.staleTime,nt(this,Un));if(xf||nt(this,ps).isStale||!eC(t))return;const a=az(nt(this,ps).dataUpdatedAt,t)+1;Sr(this,of,setTimeout(()=>{nt(this,ps).isStale||this.updateResult()},a))},sC=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(nt(this,Un)):this.options.refetchInterval)??!1},aC=function(t){wn(this,ii,uC).call(this),Sr(this,vd,t),!(xf||dl(this.options.enabled,nt(this,Un))===!1||!eC(nt(this,vd))||nt(this,vd)===0)&&Sr(this,sf,setInterval(()=>{(this.options.refetchIntervalInBackground||Q3.isFocused())&&wn(this,ii,jy).call(this)},nt(this,vd)))},lC=function(){wn(this,ii,oC).call(this),wn(this,ii,aC).call(this,wn(this,ii,sC).call(this))},cC=function(){nt(this,of)&&(clearTimeout(nt(this,of)),Sr(this,of,void 0))},uC=function(){nt(this,sf)&&(clearInterval(nt(this,sf)),Sr(this,sf,void 0))},dC=function(){const t=nt(this,Ds).getQueryCache().build(nt(this,Ds),this.options);if(t===nt(this,Un))return;const i=nt(this,Un);Sr(this,Un,t),Sr(this,j0,t.state),this.hasListeners()&&(i==null||i.removeObserver(this),t.addObserver(this))},yz=function(t){bo.batch(()=>{t.listeners&&this.listeners.forEach(i=>{i(nt(this,ps))}),nt(this,Ds).getQueryCache().notify({query:nt(this,Un),type:"observerResultsUpdated"})})},H4);function A7(e,t){return dl(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function sD(e,t){return A7(e,t)||e.state.data!==void 0&&hC(e,t,t.refetchOnMount)}function hC(e,t,i){if(dl(t.enabled,e)!==!1){const a=typeof i=="function"?i(e):i;return a==="always"||a!==!1&&eM(e,t)}return!1}function aD(e,t,i,a){return(e!==t||dl(a.enabled,e)===!1)&&(!i.suspense||e.state.status!=="error")&&eM(e,i)}function eM(e,t){return dl(t.enabled,e)!==!1&&e.isStaleByTime(Nm(t.staleTime,e))}function I7(e,t){return!kb(e.getCurrentResult(),t)}var k7=class extends _z{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e,t){super.setOptions({...e,behavior:Db()},t)}getOptimisticResult(e){return e.behavior=Db(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var J,te;const{state:i}=e,a=super.createResult(e,t),{isFetching:d,isRefetching:_,isError:b,isRefetchError:o}=a,k=(te=(J=i.fetchMeta)==null?void 0:J.fetchMore)==null?void 0:te.direction,O=b&&k==="forward",z=d&&k==="forward",F=b&&k==="backward",G=d&&k==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:C7(t,i.data),hasPreviousPage:M7(t,i.data),isFetchNextPageError:O,isFetchingNextPage:z,isFetchPreviousPageError:F,isFetchingPreviousPage:G,isRefetchError:o&&!O&&!F,isRefetching:_&&!z&&!G}}},xd,bd,Ls,Vc,Yc,J1,fC,q4,R7=(q4=class extends bg{constructor(i,a){super();Hr(this,Yc);Hr(this,xd);Hr(this,bd);Hr(this,Ls);Hr(this,Vc);Sr(this,xd,i),this.setOptions(a),this.bindMethods(),wn(this,Yc,J1).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(i){var d;const a=this.options;this.options=nt(this,xd).defaultMutationOptions(i),kb(this.options,a)||nt(this,xd).getMutationCache().notify({type:"observerOptionsUpdated",mutation:nt(this,Ls),observer:this}),a!=null&&a.mutationKey&&this.options.mutationKey&&bf(a.mutationKey)!==bf(this.options.mutationKey)?this.reset():((d=nt(this,Ls))==null?void 0:d.state.status)==="pending"&&nt(this,Ls).setOptions(this.options)}onUnsubscribe(){var i;this.hasListeners()||(i=nt(this,Ls))==null||i.removeObserver(this)}onMutationUpdate(i){wn(this,Yc,J1).call(this),wn(this,Yc,fC).call(this,i)}getCurrentResult(){return nt(this,bd)}reset(){var i;(i=nt(this,Ls))==null||i.removeObserver(this),Sr(this,Ls,void 0),wn(this,Yc,J1).call(this),wn(this,Yc,fC).call(this)}mutate(i,a){var d;return Sr(this,Vc,a),(d=nt(this,Ls))==null||d.removeObserver(this),Sr(this,Ls,nt(this,xd).getMutationCache().build(nt(this,xd),this.options)),nt(this,Ls).addObserver(this),nt(this,Ls).execute(i)}},xd=new WeakMap,bd=new WeakMap,Ls=new WeakMap,Vc=new WeakMap,Yc=new WeakSet,J1=function(){var a;const i=((a=nt(this,Ls))==null?void 0:a.state)??mz();Sr(this,bd,{...i,isPending:i.status==="pending",isSuccess:i.status==="success",isError:i.status==="error",isIdle:i.status==="idle",mutate:this.mutate,reset:this.reset})},fC=function(i){bo.batch(()=>{var a,d,_,b,o,k,O,z;if(nt(this,Vc)&&this.hasListeners()){const F=nt(this,bd).variables,G=nt(this,bd).context;(i==null?void 0:i.type)==="success"?((d=(a=nt(this,Vc)).onSuccess)==null||d.call(a,i.data,F,G),(b=(_=nt(this,Vc)).onSettled)==null||b.call(_,i.data,null,F,G)):(i==null?void 0:i.type)==="error"&&((k=(o=nt(this,Vc)).onError)==null||k.call(o,i.error,F,G),(z=(O=nt(this,Vc)).onSettled)==null||z.call(O,void 0,i.error,F,G))}this.listeners.forEach(F=>{F(nt(this,bd))})})},q4),vz=Y.createContext(void 0),wg=e=>{const t=Y.useContext(vz);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},D7=({client:e,children:t})=>(Y.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),L.jsx(vz.Provider,{value:e,children:t})),xz=Y.createContext(!1),L7=()=>Y.useContext(xz);xz.Provider;function O7(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var z7=Y.createContext(O7()),N7=()=>Y.useContext(z7);function bz(e,t){return typeof e=="function"?e(...t):!!e}function wz(){}var F7=(e,t)=>{(e.suspense||e.throwOnError)&&(t.isReset()||(e.retryOnMount=!1))},j7=e=>{Y.useEffect(()=>{e.clearReset()},[e])},B7=({result:e,errorResetBoundary:t,throwOnError:i,query:a})=>e.isError&&!t.isReset()&&!e.isFetching&&a&&bz(i,[e.error,a]),U7=e=>{e.suspense&&(e.staleTime===void 0&&(e.staleTime=1e3),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3)))},V7=(e,t)=>e.isLoading&&e.isFetching&&!t,$7=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,lD=(e,t,i)=>t.fetchOptimistic(e).catch(()=>{i.clearReset()});function Sz(e,t,i){var z,F,G,ee,J;const a=wg(),d=L7(),_=N7(),b=a.defaultQueryOptions(e);(F=(z=a.getDefaultOptions().queries)==null?void 0:z._experimental_beforeQuery)==null||F.call(z,b),b._optimisticResults=d?"isRestoring":"optimistic",U7(b),F7(b,_),j7(_);const o=!a.getQueryCache().get(b.queryHash),[k]=Y.useState(()=>new t(a,b)),O=k.getOptimisticResult(b);if(Y.useSyncExternalStore(Y.useCallback(te=>{const oe=d?()=>{}:k.subscribe(bo.batchCalls(te));return k.updateResult(),oe},[k,d]),()=>k.getCurrentResult(),()=>k.getCurrentResult()),Y.useEffect(()=>{k.setOptions(b,{listeners:!1})},[b,k]),$7(b,O))throw lD(b,k,_);if(B7({result:O,errorResetBoundary:_,throwOnError:b.throwOnError,query:a.getQueryCache().get(b.queryHash)}))throw O.error;if((ee=(G=a.getDefaultOptions().queries)==null?void 0:G._experimental_afterQuery)==null||ee.call(G,b,O),b.experimental_prefetchInRender&&!xf&&V7(O,d)){const te=o?lD(b,k,_):(J=a.getQueryCache().get(b.queryHash))==null?void 0:J.promise;te==null||te.catch(wz).finally(()=>{k.updateResult()})}return b.notifyOnChangeProps?O:k.trackResult(O)}function Ro(e,t){return Sz(e,_z)}function G7(e,t){const i=wg(),[a]=Y.useState(()=>new R7(i,e));Y.useEffect(()=>{a.setOptions(e)},[a,e]);const d=Y.useSyncExternalStore(Y.useCallback(b=>a.subscribe(bo.batchCalls(b)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),_=Y.useCallback((b,o)=>{a.mutate(b,o).catch(wz)},[a]);if(d.error&&bz(a.options.throwOnError,[d.error]))throw d.error;return{...d,mutate:_,mutateAsync:d.mutate}}function H7(e,t){return Sz(e,k7)}/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function S0(){return S0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},S0.apply(this,arguments)}var Td;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Td||(Td={}));const cD="popstate";function q7(e){e===void 0&&(e={});function t(a,d){let{pathname:_,search:b,hash:o}=a.location;return pC("",{pathname:_,search:b,hash:o},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function i(a,d){return typeof d=="string"?d:Lb(d)}return Z7(t,i,null,e)}function ji(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Tz(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function W7(){return Math.random().toString(36).substr(2,8)}function uD(e,t){return{usr:e.state,key:e.key,idx:t}}function pC(e,t,i,a){return i===void 0&&(i=null),S0({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Sg(t):t,{state:i,key:t&&t.key||a||W7()})}function Lb(e){let{pathname:t="/",search:i="",hash:a=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),a&&a!=="#"&&(t+=a.charAt(0)==="#"?a:"#"+a),t}function Sg(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let a=e.indexOf("?");a>=0&&(t.search=e.substr(a),e=e.substr(0,a)),e&&(t.pathname=e)}return t}function Z7(e,t,i,a){a===void 0&&(a={});let{window:d=document.defaultView,v5Compat:_=!1}=a,b=d.history,o=Td.Pop,k=null,O=z();O==null&&(O=0,b.replaceState(S0({},b.state,{idx:O}),""));function z(){return(b.state||{idx:null}).idx}function F(){o=Td.Pop;let oe=z(),X=oe==null?null:oe-O;O=oe,k&&k({action:o,location:te.location,delta:X})}function G(oe,X){o=Td.Push;let Q=pC(te.location,oe,X);O=z()+1;let ue=uD(Q,O),he=te.createHref(Q);try{b.pushState(ue,"",he)}catch(Ie){if(Ie instanceof DOMException&&Ie.name==="DataCloneError")throw Ie;d.location.assign(he)}_&&k&&k({action:o,location:te.location,delta:1})}function ee(oe,X){o=Td.Replace;let Q=pC(te.location,oe,X);O=z();let ue=uD(Q,O),he=te.createHref(Q);b.replaceState(ue,"",he),_&&k&&k({action:o,location:te.location,delta:0})}function J(oe){let X=d.location.origin!=="null"?d.location.origin:d.location.href,Q=typeof oe=="string"?oe:Lb(oe);return Q=Q.replace(/ $/,"%20"),ji(X,"No window.location.(origin|href) available to create URL for href: "+Q),new URL(Q,X)}let te={get action(){return o},get location(){return e(d,b)},listen(oe){if(k)throw new Error("A history only accepts one active listener");return d.addEventListener(cD,F),k=oe,()=>{d.removeEventListener(cD,F),k=null}},createHref(oe){return t(d,oe)},createURL:J,encodeLocation(oe){let X=J(oe);return{pathname:X.pathname,search:X.search,hash:X.hash}},push:G,replace:ee,go(oe){return b.go(oe)}};return te}var dD;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(dD||(dD={}));function Y7(e,t,i){return i===void 0&&(i="/"),X7(e,t,i,!1)}function X7(e,t,i,a){let d=typeof t=="string"?Sg(t):t,_=lg(d.pathname||"/",i);if(_==null)return null;let b=Ez(e);K7(b);let o=null;for(let k=0;o==null&&k<b.length;++k){let O=l$(_);o=s$(b[k],O,a)}return o}function Ez(e,t,i,a){t===void 0&&(t=[]),i===void 0&&(i=[]),a===void 0&&(a="");let d=(_,b,o)=>{let k={relativePath:o===void 0?_.path||"":o,caseSensitive:_.caseSensitive===!0,childrenIndex:b,route:_};k.relativePath.startsWith("/")&&(ji(k.relativePath.startsWith(a),'Absolute route path "'+k.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),k.relativePath=k.relativePath.slice(a.length));let O=Dd([a,k.relativePath]),z=i.concat(k);_.children&&_.children.length>0&&(ji(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+O+'".')),Ez(_.children,t,z,O)),!(_.path==null&&!_.index)&&t.push({path:O,score:i$(O,_.index),routesMeta:z})};return e.forEach((_,b)=>{var o;if(_.path===""||!((o=_.path)!=null&&o.includes("?")))d(_,b);else for(let k of Cz(_.path))d(_,b,k)}),t}function Cz(e){let t=e.split("/");if(t.length===0)return[];let[i,...a]=t,d=i.endsWith("?"),_=i.replace(/\?$/,"");if(a.length===0)return d?[_,""]:[_];let b=Cz(a.join("/")),o=[];return o.push(...b.map(k=>k===""?_:[_,k].join("/"))),d&&o.push(...b),o.map(k=>e.startsWith("/")&&k===""?"/":k)}function K7(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:o$(t.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}const J7=/^:[\w-]+$/,Q7=3,e$=2,t$=1,r$=10,n$=-2,hD=e=>e==="*";function i$(e,t){let i=e.split("/"),a=i.length;return i.some(hD)&&(a+=n$),t&&(a+=e$),i.filter(d=>!hD(d)).reduce((d,_)=>d+(J7.test(_)?Q7:_===""?t$:r$),a)}function o$(e,t){return e.length===t.length&&e.slice(0,-1).every((a,d)=>a===t[d])?e[e.length-1]-t[t.length-1]:0}function s$(e,t,i){let{routesMeta:a}=e,d={},_="/",b=[];for(let o=0;o<a.length;++o){let k=a[o],O=o===a.length-1,z=_==="/"?t:t.slice(_.length)||"/",F=Ob({path:k.relativePath,caseSensitive:k.caseSensitive,end:O},z),G=k.route;if(!F&&O&&i&&!a[a.length-1].route.index&&(F=Ob({path:k.relativePath,caseSensitive:k.caseSensitive,end:!1},z)),!F)return null;Object.assign(d,F.params),b.push({params:d,pathname:Dd([_,F.pathname]),pathnameBase:h$(Dd([_,F.pathnameBase])),route:G}),F.pathnameBase!=="/"&&(_=Dd([_,F.pathnameBase]))}return b}function Ob(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,a]=a$(e.path,e.caseSensitive,e.end),d=t.match(i);if(!d)return null;let _=d[0],b=_.replace(/(.)\/+$/,"$1"),o=d.slice(1);return{params:a.reduce((O,z,F)=>{let{paramName:G,isOptional:ee}=z;if(G==="*"){let te=o[F]||"";b=_.slice(0,_.length-te.length).replace(/(.)\/+$/,"$1")}const J=o[F];return ee&&!J?O[G]=void 0:O[G]=(J||"").replace(/%2F/g,"/"),O},{}),pathname:_,pathnameBase:b,pattern:e}}function a$(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),Tz(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let a=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(b,o,k)=>(a.push({paramName:o,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(a.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,t?void 0:"i"),a]}function l$(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Tz(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function lg(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,a=e.charAt(i);return a&&a!=="/"?null:e.slice(i)||"/"}function c$(e,t){t===void 0&&(t="/");let{pathname:i,search:a="",hash:d=""}=typeof e=="string"?Sg(e):e;return{pathname:i?i.startsWith("/")?i:u$(i,t):t,search:f$(a),hash:p$(d)}}function u$(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?i.length>1&&i.pop():d!=="."&&i.push(d)}),i.length>1?i.join("/"):"/"}function CT(e,t,i,a){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function d$(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function tM(e,t){let i=d$(e);return t?i.map((a,d)=>d===i.length-1?a.pathname:a.pathnameBase):i.map(a=>a.pathnameBase)}function rM(e,t,i,a){a===void 0&&(a=!1);let d;typeof e=="string"?d=Sg(e):(d=S0({},e),ji(!d.pathname||!d.pathname.includes("?"),CT("?","pathname","search",d)),ji(!d.pathname||!d.pathname.includes("#"),CT("#","pathname","hash",d)),ji(!d.search||!d.search.includes("#"),CT("#","search","hash",d)));let _=e===""||d.pathname==="",b=_?"/":d.pathname,o;if(b==null)o=i;else{let F=t.length-1;if(!a&&b.startsWith("..")){let G=b.split("/");for(;G[0]==="..";)G.shift(),F-=1;d.pathname=G.join("/")}o=F>=0?t[F]:"/"}let k=c$(d,o),O=b&&b!=="/"&&b.endsWith("/"),z=(_||b===".")&&i.endsWith("/");return!k.pathname.endsWith("/")&&(O||z)&&(k.pathname+="/"),k}const Dd=e=>e.join("/").replace(/\/\/+/g,"/"),h$=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),f$=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,p$=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function m$(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Mz=["post","put","patch","delete"];new Set(Mz);const g$=["get",...Mz];new Set(g$);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function T0(){return T0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},T0.apply(this,arguments)}const xw=Y.createContext(null),Pz=Y.createContext(null),ou=Y.createContext(null),bw=Y.createContext(null),su=Y.createContext({outlet:null,matches:[],isDataRoute:!1}),Az=Y.createContext(null);function _$(e,t){let{relative:i}=t===void 0?{}:t;Tg()||ji(!1);let{basename:a,navigator:d}=Y.useContext(ou),{hash:_,pathname:b,search:o}=ww(e,{relative:i}),k=b;return a!=="/"&&(k=b==="/"?a:Dd([a,b])),d.createHref({pathname:k,search:o,hash:_})}function Tg(){return Y.useContext(bw)!=null}function qd(){return Tg()||ji(!1),Y.useContext(bw).location}function Iz(e){Y.useContext(ou).static||Y.useLayoutEffect(e)}function $o(){let{isDataRoute:e}=Y.useContext(su);return e?I$():y$()}function y$(){Tg()||ji(!1);let e=Y.useContext(xw),{basename:t,future:i,navigator:a}=Y.useContext(ou),{matches:d}=Y.useContext(su),{pathname:_}=qd(),b=JSON.stringify(tM(d,i.v7_relativeSplatPath)),o=Y.useRef(!1);return Iz(()=>{o.current=!0}),Y.useCallback(function(O,z){if(z===void 0&&(z={}),!o.current)return;if(typeof O=="number"){a.go(O);return}let F=rM(O,JSON.parse(b),_,z.relative==="path");e==null&&t!=="/"&&(F.pathname=F.pathname==="/"?t:Dd([t,F.pathname])),(z.replace?a.replace:a.push)(F,z.state,z)},[t,a,b,_,e])}function q0(){let{matches:e}=Y.useContext(su),t=e[e.length-1];return t?t.params:{}}function ww(e,t){let{relative:i}=t===void 0?{}:t,{future:a}=Y.useContext(ou),{matches:d}=Y.useContext(su),{pathname:_}=qd(),b=JSON.stringify(tM(d,a.v7_relativeSplatPath));return Y.useMemo(()=>rM(e,JSON.parse(b),_,i==="path"),[e,b,_,i])}function v$(e,t){return x$(e,t)}function x$(e,t,i,a){Tg()||ji(!1);let{navigator:d}=Y.useContext(ou),{matches:_}=Y.useContext(su),b=_[_.length-1],o=b?b.params:{};b&&b.pathname;let k=b?b.pathnameBase:"/";b&&b.route;let O=qd(),z;if(t){var F;let oe=typeof t=="string"?Sg(t):t;k==="/"||(F=oe.pathname)!=null&&F.startsWith(k)||ji(!1),z=oe}else z=O;let G=z.pathname||"/",ee=G;if(k!=="/"){let oe=k.replace(/^\//,"").split("/");ee="/"+G.replace(/^\//,"").split("/").slice(oe.length).join("/")}let J=Y7(e,{pathname:ee}),te=E$(J&&J.map(oe=>Object.assign({},oe,{params:Object.assign({},o,oe.params),pathname:Dd([k,d.encodeLocation?d.encodeLocation(oe.pathname).pathname:oe.pathname]),pathnameBase:oe.pathnameBase==="/"?k:Dd([k,d.encodeLocation?d.encodeLocation(oe.pathnameBase).pathname:oe.pathnameBase])})),_,i,a);return t&&te?Y.createElement(bw.Provider,{value:{location:T0({pathname:"/",search:"",hash:"",state:null,key:"default"},z),navigationType:Td.Pop}},te):te}function b$(){let e=A$(),t=m$(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Y.createElement(Y.Fragment,null,Y.createElement("h2",null,"Unexpected Application Error!"),Y.createElement("h3",{style:{fontStyle:"italic"}},t),i?Y.createElement("pre",{style:d},i):null,null)}const w$=Y.createElement(b$,null);class S$ extends Y.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?Y.createElement(su.Provider,{value:this.props.routeContext},Y.createElement(Az.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function T$(e){let{routeContext:t,match:i,children:a}=e,d=Y.useContext(xw);return d&&d.static&&d.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=i.route.id),Y.createElement(su.Provider,{value:t},a)}function E$(e,t,i,a){var d;if(t===void 0&&(t=[]),i===void 0&&(i=null),a===void 0&&(a=null),e==null){var _;if(!i)return null;if(i.errors)e=i.matches;else if((_=a)!=null&&_.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let b=e,o=(d=i)==null?void 0:d.errors;if(o!=null){let z=b.findIndex(F=>F.route.id&&(o==null?void 0:o[F.route.id])!==void 0);z>=0||ji(!1),b=b.slice(0,Math.min(b.length,z+1))}let k=!1,O=-1;if(i&&a&&a.v7_partialHydration)for(let z=0;z<b.length;z++){let F=b[z];if((F.route.HydrateFallback||F.route.hydrateFallbackElement)&&(O=z),F.route.id){let{loaderData:G,errors:ee}=i,J=F.route.loader&&G[F.route.id]===void 0&&(!ee||ee[F.route.id]===void 0);if(F.route.lazy||J){k=!0,O>=0?b=b.slice(0,O+1):b=[b[0]];break}}}return b.reduceRight((z,F,G)=>{let ee,J=!1,te=null,oe=null;i&&(ee=o&&F.route.id?o[F.route.id]:void 0,te=F.route.errorElement||w$,k&&(O<0&&G===0?(J=!0,oe=null):O===G&&(J=!0,oe=F.route.hydrateFallbackElement||null)));let X=t.concat(b.slice(0,G+1)),Q=()=>{let ue;return ee?ue=te:J?ue=oe:F.route.Component?ue=Y.createElement(F.route.Component,null):F.route.element?ue=F.route.element:ue=z,Y.createElement(T$,{match:F,routeContext:{outlet:z,matches:X,isDataRoute:i!=null},children:ue})};return i&&(F.route.ErrorBoundary||F.route.errorElement||G===0)?Y.createElement(S$,{location:i.location,revalidation:i.revalidation,component:te,error:ee,children:Q(),routeContext:{outlet:null,matches:X,isDataRoute:!0}}):Q()},null)}var kz=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(kz||{}),zb=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(zb||{});function C$(e){let t=Y.useContext(xw);return t||ji(!1),t}function M$(e){let t=Y.useContext(Pz);return t||ji(!1),t}function P$(e){let t=Y.useContext(su);return t||ji(!1),t}function Rz(e){let t=P$(),i=t.matches[t.matches.length-1];return i.route.id||ji(!1),i.route.id}function A$(){var e;let t=Y.useContext(Az),i=M$(zb.UseRouteError),a=Rz(zb.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[a]}function I$(){let{router:e}=C$(kz.UseNavigateStable),t=Rz(zb.UseNavigateStable),i=Y.useRef(!1);return Iz(()=>{i.current=!0}),Y.useCallback(function(d,_){_===void 0&&(_={}),i.current&&(typeof d=="number"?e.navigate(d):e.navigate(d,T0({fromRouteId:t},_)))},[e,t])}function k$(e){let{to:t,replace:i,state:a,relative:d}=e;Tg()||ji(!1);let{future:_,static:b}=Y.useContext(ou),{matches:o}=Y.useContext(su),{pathname:k}=qd(),O=$o(),z=rM(t,tM(o,_.v7_relativeSplatPath),k,d==="path"),F=JSON.stringify(z);return Y.useEffect(()=>O(JSON.parse(F),{replace:i,state:a,relative:d}),[O,F,d,i,a]),null}function hs(e){ji(!1)}function R$(e){let{basename:t="/",children:i=null,location:a,navigationType:d=Td.Pop,navigator:_,static:b=!1,future:o}=e;Tg()&&ji(!1);let k=t.replace(/^\/*/,"/"),O=Y.useMemo(()=>({basename:k,navigator:_,static:b,future:T0({v7_relativeSplatPath:!1},o)}),[k,o,_,b]);typeof a=="string"&&(a=Sg(a));let{pathname:z="/",search:F="",hash:G="",state:ee=null,key:J="default"}=a,te=Y.useMemo(()=>{let oe=lg(z,k);return oe==null?null:{location:{pathname:oe,search:F,hash:G,state:ee,key:J},navigationType:d}},[k,z,F,G,ee,J,d]);return te==null?null:Y.createElement(ou.Provider,{value:O},Y.createElement(bw.Provider,{children:i,value:te}))}function D$(e){let{children:t,location:i}=e;return v$(mC(t),i)}new Promise(()=>{});function mC(e,t){t===void 0&&(t=[]);let i=[];return Y.Children.forEach(e,(a,d)=>{if(!Y.isValidElement(a))return;let _=[...t,d];if(a.type===Y.Fragment){i.push.apply(i,mC(a.props.children,_));return}a.type!==hs&&ji(!1),!a.props.index||!a.props.children||ji(!1);let b={id:a.props.id||_.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(b.children=mC(a.props.children,_)),i.push(b)}),i}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Nb(){return Nb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Nb.apply(this,arguments)}function Dz(e,t){if(e==null)return{};var i={},a=Object.keys(e),d,_;for(_=0;_<a.length;_++)d=a[_],!(t.indexOf(d)>=0)&&(i[d]=e[d]);return i}function L$(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function O$(e,t){return e.button===0&&(!t||t==="_self")&&!L$(e)}const z$=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],N$=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],F$="6";try{window.__reactRouterVersion=F$}catch{}const j$=Y.createContext({isTransitioning:!1}),B$="startTransition",fD=nL[B$];function U$(e){let{basename:t,children:i,future:a,window:d}=e,_=Y.useRef();_.current==null&&(_.current=q7({window:d,v5Compat:!0}));let b=_.current,[o,k]=Y.useState({action:b.action,location:b.location}),{v7_startTransition:O}=a||{},z=Y.useCallback(F=>{O&&fD?fD(()=>k(F)):k(F)},[k,O]);return Y.useLayoutEffect(()=>b.listen(z),[b,z]),Y.createElement(R$,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:b,future:a})}const V$=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",$$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cf=Y.forwardRef(function(t,i){let{onClick:a,relative:d,reloadDocument:_,replace:b,state:o,target:k,to:O,preventScrollReset:z,viewTransition:F}=t,G=Dz(t,z$),{basename:ee}=Y.useContext(ou),J,te=!1;if(typeof O=="string"&&$$.test(O)&&(J=O,V$))try{let ue=new URL(window.location.href),he=O.startsWith("//")?new URL(ue.protocol+O):new URL(O),Ie=lg(he.pathname,ee);he.origin===ue.origin&&Ie!=null?O=Ie+he.search+he.hash:te=!0}catch{}let oe=_$(O,{relative:d}),X=q$(O,{replace:b,state:o,target:k,preventScrollReset:z,relative:d,viewTransition:F});function Q(ue){a&&a(ue),ue.defaultPrevented||X(ue)}return Y.createElement("a",Nb({},G,{href:J||oe,onClick:te||_?a:Q,ref:i,target:k}))}),G$=Y.forwardRef(function(t,i){let{"aria-current":a="page",caseSensitive:d=!1,className:_="",end:b=!1,style:o,to:k,viewTransition:O,children:z}=t,F=Dz(t,N$),G=ww(k,{relative:F.relative}),ee=qd(),J=Y.useContext(Pz),{navigator:te,basename:oe}=Y.useContext(ou),X=J!=null&&W$(G)&&O===!0,Q=te.encodeLocation?te.encodeLocation(G).pathname:G.pathname,ue=ee.pathname,he=J&&J.navigation&&J.navigation.location?J.navigation.location.pathname:null;d||(ue=ue.toLowerCase(),he=he?he.toLowerCase():null,Q=Q.toLowerCase()),he&&oe&&(he=lg(he,oe)||he);const Ie=Q!=="/"&&Q.endsWith("/")?Q.length-1:Q.length;let Je=ue===Q||!b&&ue.startsWith(Q)&&ue.charAt(Ie)==="/",Ce=he!=null&&(he===Q||!b&&he.startsWith(Q)&&he.charAt(Q.length)==="/"),Ze={isActive:Je,isPending:Ce,isTransitioning:X},et=Je?a:void 0,Ge;typeof _=="function"?Ge=_(Ze):Ge=[_,Je?"active":null,Ce?"pending":null,X?"transitioning":null].filter(Boolean).join(" ");let qe=typeof o=="function"?o(Ze):o;return Y.createElement(cf,Nb({},F,{"aria-current":et,className:Ge,ref:i,style:qe,to:k,viewTransition:O}),typeof z=="function"?z(Ze):z)});var gC;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(gC||(gC={}));var pD;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(pD||(pD={}));function H$(e){let t=Y.useContext(xw);return t||ji(!1),t}function q$(e,t){let{target:i,replace:a,state:d,preventScrollReset:_,relative:b,viewTransition:o}=t===void 0?{}:t,k=$o(),O=qd(),z=ww(e,{relative:b});return Y.useCallback(F=>{if(O$(F,i)){F.preventDefault();let G=a!==void 0?a:Lb(O)===Lb(z);k(e,{replace:G,state:d,preventScrollReset:_,relative:b,viewTransition:o})}},[O,k,z,a,d,i,e,_,b,o])}function W$(e,t){t===void 0&&(t={});let i=Y.useContext(j$);i==null&&ji(!1);let{basename:a}=H$(gC.useViewTransitionState),d=ww(e,{relative:t.relative});if(!i.isTransitioning)return!1;let _=lg(i.currentLocation.pathname,a)||i.currentLocation.pathname,b=lg(i.nextLocation.pathname,a)||i.nextLocation.pathname;return Ob(d.pathname,b)!=null||Ob(d.pathname,_)!=null}function Lz(e){var t,i,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(t=0;t<d;t++)e[t]&&(i=Lz(e[t]))&&(a&&(a+=" "),a+=i)}else for(i in e)e[i]&&(a&&(a+=" "),a+=i);return a}function Oz(){for(var e,t,i=0,a="",d=arguments.length;i<d;i++)(e=arguments[i])&&(t=Lz(e))&&(a&&(a+=" "),a+=t);return a}const nM="-",Z$=e=>{const t=X$(e),{conflictingClassGroups:i,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:b=>{const o=b.split(nM);return o[0]===""&&o.length!==1&&o.shift(),zz(o,t)||Y$(b)},getConflictingClassGroupIds:(b,o)=>{const k=i[b]||[];return o&&a[b]?[...k,...a[b]]:k}}},zz=(e,t)=>{var b;if(e.length===0)return t.classGroupId;const i=e[0],a=t.nextPart.get(i),d=a?zz(e.slice(1),a):void 0;if(d)return d;if(t.validators.length===0)return;const _=e.join(nM);return(b=t.validators.find(({validator:o})=>o(_)))==null?void 0:b.classGroupId},mD=/^\[(.+)\]$/,Y$=e=>{if(mD.test(e)){const t=mD.exec(e)[1],i=t==null?void 0:t.substring(0,t.indexOf(":"));if(i)return"arbitrary.."+i}},X$=e=>{const{theme:t,prefix:i}=e,a={nextPart:new Map,validators:[]};return J$(Object.entries(e.classGroups),i).forEach(([_,b])=>{_C(b,a,_,t)}),a},_C=(e,t,i,a)=>{e.forEach(d=>{if(typeof d=="string"){const _=d===""?t:gD(t,d);_.classGroupId=i;return}if(typeof d=="function"){if(K$(d)){_C(d(a),t,i,a);return}t.validators.push({validator:d,classGroupId:i});return}Object.entries(d).forEach(([_,b])=>{_C(b,gD(t,_),i,a)})})},gD=(e,t)=>{let i=e;return t.split(nM).forEach(a=>{i.nextPart.has(a)||i.nextPart.set(a,{nextPart:new Map,validators:[]}),i=i.nextPart.get(a)}),i},K$=e=>e.isThemeGetter,J$=(e,t)=>t?e.map(([i,a])=>{const d=a.map(_=>typeof _=="string"?t+_:typeof _=="object"?Object.fromEntries(Object.entries(_).map(([b,o])=>[t+b,o])):_);return[i,d]}):e,Q$=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,i=new Map,a=new Map;const d=(_,b)=>{i.set(_,b),t++,t>e&&(t=0,a=i,i=new Map)};return{get(_){let b=i.get(_);if(b!==void 0)return b;if((b=a.get(_))!==void 0)return d(_,b),b},set(_,b){i.has(_)?i.set(_,b):d(_,b)}}},Nz="!",eG=e=>{const{separator:t,experimentalParseClassName:i}=e,a=t.length===1,d=t[0],_=t.length,b=o=>{const k=[];let O=0,z=0,F;for(let oe=0;oe<o.length;oe++){let X=o[oe];if(O===0){if(X===d&&(a||o.slice(oe,oe+_)===t)){k.push(o.slice(z,oe)),z=oe+_;continue}if(X==="/"){F=oe;continue}}X==="["?O++:X==="]"&&O--}const G=k.length===0?o:o.substring(z),ee=G.startsWith(Nz),J=ee?G.substring(1):G,te=F&&F>z?F-z:void 0;return{modifiers:k,hasImportantModifier:ee,baseClassName:J,maybePostfixModifierPosition:te}};return i?o=>i({className:o,parseClassName:b}):b},tG=e=>{if(e.length<=1)return e;const t=[];let i=[];return e.forEach(a=>{a[0]==="["?(t.push(...i.sort(),a),i=[]):i.push(a)}),t.push(...i.sort()),t},rG=e=>({cache:Q$(e.cacheSize),parseClassName:eG(e),...Z$(e)}),nG=/\s+/,iG=(e,t)=>{const{parseClassName:i,getClassGroupId:a,getConflictingClassGroupIds:d}=t,_=[],b=e.trim().split(nG);let o="";for(let k=b.length-1;k>=0;k-=1){const O=b[k],{modifiers:z,hasImportantModifier:F,baseClassName:G,maybePostfixModifierPosition:ee}=i(O);let J=!!ee,te=a(J?G.substring(0,ee):G);if(!te){if(!J){o=O+(o.length>0?" "+o:o);continue}if(te=a(G),!te){o=O+(o.length>0?" "+o:o);continue}J=!1}const oe=tG(z).join(":"),X=F?oe+Nz:oe,Q=X+te;if(_.includes(Q))continue;_.push(Q);const ue=d(te,J);for(let he=0;he<ue.length;++he){const Ie=ue[he];_.push(X+Ie)}o=O+(o.length>0?" "+o:o)}return o};function oG(){let e=0,t,i,a="";for(;e<arguments.length;)(t=arguments[e++])&&(i=Fz(t))&&(a&&(a+=" "),a+=i);return a}const Fz=e=>{if(typeof e=="string")return e;let t,i="";for(let a=0;a<e.length;a++)e[a]&&(t=Fz(e[a]))&&(i&&(i+=" "),i+=t);return i};function sG(e,...t){let i,a,d,_=b;function b(k){const O=t.reduce((z,F)=>F(z),e());return i=rG(O),a=i.cache.get,d=i.cache.set,_=o,o(k)}function o(k){const O=a(k);if(O)return O;const z=iG(k,i);return d(k,z),z}return function(){return _(oG.apply(null,arguments))}}const Ti=e=>{const t=i=>i[e]||[];return t.isThemeGetter=!0,t},jz=/^\[(?:([a-z-]+):)?(.+)\]$/i,aG=/^\d+\/\d+$/,lG=new Set(["px","full","screen"]),cG=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,uG=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,dG=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,hG=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,fG=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Lc=e=>Fm(e)||lG.has(e)||aG.test(e),Qu=e=>Eg(e,"length",bG),Fm=e=>!!e&&!Number.isNaN(Number(e)),MT=e=>Eg(e,"number",Fm),Ty=e=>!!e&&Number.isInteger(Number(e)),pG=e=>e.endsWith("%")&&Fm(e.slice(0,-1)),bn=e=>jz.test(e),ed=e=>cG.test(e),mG=new Set(["length","size","percentage"]),gG=e=>Eg(e,mG,Bz),_G=e=>Eg(e,"position",Bz),yG=new Set(["image","url"]),vG=e=>Eg(e,yG,SG),xG=e=>Eg(e,"",wG),Ey=()=>!0,Eg=(e,t,i)=>{const a=jz.exec(e);return a?a[1]?typeof t=="string"?a[1]===t:t.has(a[1]):i(a[2]):!1},bG=e=>uG.test(e)&&!dG.test(e),Bz=()=>!1,wG=e=>hG.test(e),SG=e=>fG.test(e),TG=()=>{const e=Ti("colors"),t=Ti("spacing"),i=Ti("blur"),a=Ti("brightness"),d=Ti("borderColor"),_=Ti("borderRadius"),b=Ti("borderSpacing"),o=Ti("borderWidth"),k=Ti("contrast"),O=Ti("grayscale"),z=Ti("hueRotate"),F=Ti("invert"),G=Ti("gap"),ee=Ti("gradientColorStops"),J=Ti("gradientColorStopPositions"),te=Ti("inset"),oe=Ti("margin"),X=Ti("opacity"),Q=Ti("padding"),ue=Ti("saturate"),he=Ti("scale"),Ie=Ti("sepia"),Je=Ti("skew"),Ce=Ti("space"),Ze=Ti("translate"),et=()=>["auto","contain","none"],Ge=()=>["auto","hidden","clip","visible","scroll"],qe=()=>["auto",bn,t],_t=()=>[bn,t],Rt=()=>["",Lc,Qu],Wt=()=>["auto",Fm,bn],wt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],jt=()=>["solid","dashed","dotted","double","none"],Ct=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],st=()=>["start","end","center","between","around","evenly","stretch"],yt=()=>["","0",bn],ir=()=>["auto","avoid","all","avoid-page","page","left","right","column"],yr=()=>[Fm,bn];return{cacheSize:500,separator:":",theme:{colors:[Ey],spacing:[Lc,Qu],blur:["none","",ed,bn],brightness:yr(),borderColor:[e],borderRadius:["none","","full",ed,bn],borderSpacing:_t(),borderWidth:Rt(),contrast:yr(),grayscale:yt(),hueRotate:yr(),invert:yt(),gap:_t(),gradientColorStops:[e],gradientColorStopPositions:[pG,Qu],inset:qe(),margin:qe(),opacity:yr(),padding:_t(),saturate:yr(),scale:yr(),sepia:yt(),skew:yr(),space:_t(),translate:_t()},classGroups:{aspect:[{aspect:["auto","square","video",bn]}],container:["container"],columns:[{columns:[ed]}],"break-after":[{"break-after":ir()}],"break-before":[{"break-before":ir()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...wt(),bn]}],overflow:[{overflow:Ge()}],"overflow-x":[{"overflow-x":Ge()}],"overflow-y":[{"overflow-y":Ge()}],overscroll:[{overscroll:et()}],"overscroll-x":[{"overscroll-x":et()}],"overscroll-y":[{"overscroll-y":et()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[te]}],"inset-x":[{"inset-x":[te]}],"inset-y":[{"inset-y":[te]}],start:[{start:[te]}],end:[{end:[te]}],top:[{top:[te]}],right:[{right:[te]}],bottom:[{bottom:[te]}],left:[{left:[te]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ty,bn]}],basis:[{basis:qe()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",bn]}],grow:[{grow:yt()}],shrink:[{shrink:yt()}],order:[{order:["first","last","none",Ty,bn]}],"grid-cols":[{"grid-cols":[Ey]}],"col-start-end":[{col:["auto",{span:["full",Ty,bn]},bn]}],"col-start":[{"col-start":Wt()}],"col-end":[{"col-end":Wt()}],"grid-rows":[{"grid-rows":[Ey]}],"row-start-end":[{row:["auto",{span:[Ty,bn]},bn]}],"row-start":[{"row-start":Wt()}],"row-end":[{"row-end":Wt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",bn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",bn]}],gap:[{gap:[G]}],"gap-x":[{"gap-x":[G]}],"gap-y":[{"gap-y":[G]}],"justify-content":[{justify:["normal",...st()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...st(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...st(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Q]}],px:[{px:[Q]}],py:[{py:[Q]}],ps:[{ps:[Q]}],pe:[{pe:[Q]}],pt:[{pt:[Q]}],pr:[{pr:[Q]}],pb:[{pb:[Q]}],pl:[{pl:[Q]}],m:[{m:[oe]}],mx:[{mx:[oe]}],my:[{my:[oe]}],ms:[{ms:[oe]}],me:[{me:[oe]}],mt:[{mt:[oe]}],mr:[{mr:[oe]}],mb:[{mb:[oe]}],ml:[{ml:[oe]}],"space-x":[{"space-x":[Ce]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ce]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",bn,t]}],"min-w":[{"min-w":[bn,t,"min","max","fit"]}],"max-w":[{"max-w":[bn,t,"none","full","min","max","fit","prose",{screen:[ed]},ed]}],h:[{h:[bn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[bn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[bn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[bn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",ed,Qu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",MT]}],"font-family":[{font:[Ey]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",bn]}],"line-clamp":[{"line-clamp":["none",Fm,MT]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Lc,bn]}],"list-image":[{"list-image":["none",bn]}],"list-style-type":[{list:["none","disc","decimal",bn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[X]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[X]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...jt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Lc,Qu]}],"underline-offset":[{"underline-offset":["auto",Lc,bn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:_t()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",bn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",bn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[X]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...wt(),_G]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",gG]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},vG]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[J]}],"gradient-via-pos":[{via:[J]}],"gradient-to-pos":[{to:[J]}],"gradient-from":[{from:[ee]}],"gradient-via":[{via:[ee]}],"gradient-to":[{to:[ee]}],rounded:[{rounded:[_]}],"rounded-s":[{"rounded-s":[_]}],"rounded-e":[{"rounded-e":[_]}],"rounded-t":[{"rounded-t":[_]}],"rounded-r":[{"rounded-r":[_]}],"rounded-b":[{"rounded-b":[_]}],"rounded-l":[{"rounded-l":[_]}],"rounded-ss":[{"rounded-ss":[_]}],"rounded-se":[{"rounded-se":[_]}],"rounded-ee":[{"rounded-ee":[_]}],"rounded-es":[{"rounded-es":[_]}],"rounded-tl":[{"rounded-tl":[_]}],"rounded-tr":[{"rounded-tr":[_]}],"rounded-br":[{"rounded-br":[_]}],"rounded-bl":[{"rounded-bl":[_]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[X]}],"border-style":[{border:[...jt(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[X]}],"divide-style":[{divide:jt()}],"border-color":[{border:[d]}],"border-color-x":[{"border-x":[d]}],"border-color-y":[{"border-y":[d]}],"border-color-s":[{"border-s":[d]}],"border-color-e":[{"border-e":[d]}],"border-color-t":[{"border-t":[d]}],"border-color-r":[{"border-r":[d]}],"border-color-b":[{"border-b":[d]}],"border-color-l":[{"border-l":[d]}],"divide-color":[{divide:[d]}],"outline-style":[{outline:["",...jt()]}],"outline-offset":[{"outline-offset":[Lc,bn]}],"outline-w":[{outline:[Lc,Qu]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Rt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[X]}],"ring-offset-w":[{"ring-offset":[Lc,Qu]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",ed,xG]}],"shadow-color":[{shadow:[Ey]}],opacity:[{opacity:[X]}],"mix-blend":[{"mix-blend":[...Ct(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ct()}],filter:[{filter:["","none"]}],blur:[{blur:[i]}],brightness:[{brightness:[a]}],contrast:[{contrast:[k]}],"drop-shadow":[{"drop-shadow":["","none",ed,bn]}],grayscale:[{grayscale:[O]}],"hue-rotate":[{"hue-rotate":[z]}],invert:[{invert:[F]}],saturate:[{saturate:[ue]}],sepia:[{sepia:[Ie]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[i]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[k]}],"backdrop-grayscale":[{"backdrop-grayscale":[O]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[z]}],"backdrop-invert":[{"backdrop-invert":[F]}],"backdrop-opacity":[{"backdrop-opacity":[X]}],"backdrop-saturate":[{"backdrop-saturate":[ue]}],"backdrop-sepia":[{"backdrop-sepia":[Ie]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[b]}],"border-spacing-x":[{"border-spacing-x":[b]}],"border-spacing-y":[{"border-spacing-y":[b]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",bn]}],duration:[{duration:yr()}],ease:[{ease:["linear","in","out","in-out",bn]}],delay:[{delay:yr()}],animate:[{animate:["none","spin","ping","pulse","bounce",bn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[he]}],"scale-x":[{"scale-x":[he]}],"scale-y":[{"scale-y":[he]}],rotate:[{rotate:[Ty,bn]}],"translate-x":[{"translate-x":[Ze]}],"translate-y":[{"translate-y":[Ze]}],"skew-x":[{"skew-x":[Je]}],"skew-y":[{"skew-y":[Je]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",bn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",bn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":_t()}],"scroll-mx":[{"scroll-mx":_t()}],"scroll-my":[{"scroll-my":_t()}],"scroll-ms":[{"scroll-ms":_t()}],"scroll-me":[{"scroll-me":_t()}],"scroll-mt":[{"scroll-mt":_t()}],"scroll-mr":[{"scroll-mr":_t()}],"scroll-mb":[{"scroll-mb":_t()}],"scroll-ml":[{"scroll-ml":_t()}],"scroll-p":[{"scroll-p":_t()}],"scroll-px":[{"scroll-px":_t()}],"scroll-py":[{"scroll-py":_t()}],"scroll-ps":[{"scroll-ps":_t()}],"scroll-pe":[{"scroll-pe":_t()}],"scroll-pt":[{"scroll-pt":_t()}],"scroll-pr":[{"scroll-pr":_t()}],"scroll-pb":[{"scroll-pb":_t()}],"scroll-pl":[{"scroll-pl":_t()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",bn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Lc,Qu,MT]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},EG=sG(TG);function _r(...e){return EG(Oz(e))}const C1=[{id:"1",name:"Mercedes",logo_url:"/lovable-uploads/20b26fd6-f9f4-41a4-92ad-fa89b23d550a.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"2",name:"Range Rover",logo_url:"/lovable-uploads/5d0fc73a-ec2c-49fd-9df9-c3830953bff2.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"3",name:"BMW",logo_url:"/lovable-uploads/48a404b4-eb67-41a1-a871-1aac9e63b593.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"4",name:"Ford",logo_url:"/lovable-uploads/ae1ca97d-b526-4528-aee1-ded897ae8104.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"5",name:"Toyota",logo_url:"/lovable-uploads/a4381118-18b6-449d-b488-361109d8fe18.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"6",name:"Mazda",logo_url:"/lovable-uploads/58c1573d-83c6-4203-a665-c5d46b8babd8.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"7",name:"Nissan",logo_url:"/lovable-uploads/33445c94-40ae-4ebd-94e7-8946c1f0fea7.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"8",name:"Volkswagen",logo_url:"/lovable-uploads/4c2133f4-1dcb-40ba-93ad-942445cfb8c7.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"9",name:"Honda",logo_url:"/lovable-uploads/68572b00-e59e-40d5-b244-51d908224722.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"10",name:"Audi",logo_url:"/lovable-uploads/574a84d0-4eb3-4bf9-bc39-d352211f4e36.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];function CG(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function Uz(...e){return t=>e.forEach(i=>CG(i,t))}function Qn(...e){return Y.useCallback(Uz(...e),e)}var eu=Y.forwardRef((e,t)=>{const{children:i,...a}=e,d=Y.Children.toArray(i),_=d.find(PG);if(_){const b=_.props.children,o=d.map(k=>k===_?Y.Children.count(b)>1?Y.Children.only(null):Y.isValidElement(b)?b.props.children:null:k);return L.jsx(yC,{...a,ref:t,children:Y.isValidElement(b)?Y.cloneElement(b,void 0,o):null})}return L.jsx(yC,{...a,ref:t,children:i})});eu.displayName="Slot";var yC=Y.forwardRef((e,t)=>{const{children:i,...a}=e;if(Y.isValidElement(i)){const d=IG(i);return Y.cloneElement(i,{...AG(a,i.props),ref:t?Uz(t,d):d})}return Y.Children.count(i)>1?Y.Children.only(null):null});yC.displayName="SlotClone";var MG=({children:e})=>L.jsx(L.Fragment,{children:e});function PG(e){return Y.isValidElement(e)&&e.type===MG}function AG(e,t){const i={...t};for(const a in t){const d=e[a],_=t[a];/^on[A-Z]/.test(a)?d&&_?i[a]=(...o)=>{_(...o),d(...o)}:d&&(i[a]=d):a==="style"?i[a]={...d,..._}:a==="className"&&(i[a]=[d,_].filter(Boolean).join(" "))}return{...e,...i}}function IG(e){var a,d;let t=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(d=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:d.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}const _D=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,yD=Oz,W0=(e,t)=>i=>{var a;if((t==null?void 0:t.variants)==null)return yD(e,i==null?void 0:i.class,i==null?void 0:i.className);const{variants:d,defaultVariants:_}=t,b=Object.keys(d).map(O=>{const z=i==null?void 0:i[O],F=_==null?void 0:_[O];if(z===null)return null;const G=_D(z)||_D(F);return d[O][G]}),o=i&&Object.entries(i).reduce((O,z)=>{let[F,G]=z;return G===void 0||(O[F]=G),O},{}),k=t==null||(a=t.compoundVariants)===null||a===void 0?void 0:a.reduce((O,z)=>{let{class:F,className:G,...ee}=z;return Object.entries(ee).every(J=>{let[te,oe]=J;return Array.isArray(oe)?oe.includes({..._,...o}[te]):{..._,...o}[te]===oe})?[...O,F,G]:O},[]);return yD(e,b,k,i==null?void 0:i.class,i==null?void 0:i.className)},vC=W0("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),on=Y.forwardRef(({className:e,variant:t,size:i,asChild:a=!1,...d},_)=>{const b=a?eu:"button";return L.jsx(b,{className:_r(vC({variant:t,size:i,className:e})),ref:_,...d})});on.displayName="Button";const kG=({selectedBrand:e,onSelectBrand:t})=>{const[i,a]=Y.useState(!1);console.log("Rendering BrandFilter with brands:",C1);const d=i?C1:C1.slice(0,4);return L.jsxs("div",{className:"space-y-4",children:[L.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 scrollbar-hide",children:d.map(_=>L.jsxs("button",{onClick:()=>t(_.name===e?null:_.name),className:_r("flex flex-col items-center min-w-[144px] p-6 rounded-lg transition-all",e===_.name?"bg-primary text-white":"bg-secondary hover:bg-accent"),children:[L.jsx("img",{src:_.logo_url,alt:`${_.name} logo`,className:"w-16 h-16 object-contain"}),L.jsx("span",{className:"text-sm mt-3 font-medium",children:_.name})]},_.id))}),C1.length>4&&L.jsx("div",{className:"flex justify-center",children:L.jsx(on,{variant:"ghost",onClick:()=>a(!i),className:"text-primary",children:i?"Show Less":"See All"})})]})};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RG=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Vz=(...e)=>e.filter((t,i,a)=>!!t&&t.trim()!==""&&a.indexOf(t)===i).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var DG={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LG=Y.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:d="",children:_,iconNode:b,...o},k)=>Y.createElement("svg",{ref:k,...DG,width:t,height:t,stroke:e,strokeWidth:a?Number(i)*24/Number(t):i,className:Vz("lucide",d),...o},[...b.map(([O,z])=>Y.createElement(O,z)),...Array.isArray(_)?_:[_]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=(e,t)=>{const i=Y.forwardRef(({className:a,...d},_)=>Y.createElement(LG,{ref:_,iconNode:t,className:Vz(`lucide-${RG(e)}`,a),...d}));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z0=Rn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $z=Rn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OG=Rn("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gz=Rn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hz=Rn("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xC=Rn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zG=Rn("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NG=Rn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qz=Rn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wz=Rn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zz=Rn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FG=Rn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jG=Rn("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BG=Rn("CircleGauge",[["path",{d:"M15.6 2.7a10 10 0 1 0 5.7 5.7",key:"1e0p6d"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M13.4 10.6 19 5",key:"1kr7tw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UG=Rn("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VG=Rn("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $G=Rn("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"7cu91f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GG=Rn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HG=Rn("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qG=Rn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WG=Rn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZG=Rn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YG=Rn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yz=Rn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XG=Rn("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KG=Rn("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xz=Rn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JG=Rn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QG=Rn("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kz=Rn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eH=Rn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tH=Rn("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bC=Rn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rH=Rn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nH=Rn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iH=Rn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=Rn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),So=()=>{const e=[{icon:HG,label:"Home",path:"/"},{icon:XG,label:"Map",path:"/map"},{icon:GG,label:"Saved",path:"/saved-cars"},{icon:Kz,label:"More",path:"/more"},{icon:nH,label:"Profile",path:"/profile"}];return L.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 z-50",children:L.jsx("div",{className:"flex justify-between items-center max-w-md mx-auto",children:e.map(({icon:t,label:i,path:a})=>L.jsxs(G$,{to:a,className:({isActive:d})=>`flex flex-col items-center p-2 ${d?"text-primary":"text-gray-500 hover:text-primary"}`,children:[L.jsx(t,{className:"w-6 h-6"}),L.jsx("span",{className:"text-xs mt-1",children:i})]},a))})})};var wC=new Map,M1=new WeakMap,vD=0,oH=void 0;function sH(e){return e?(M1.has(e)||(vD+=1,M1.set(e,vD.toString())),M1.get(e)):"0"}function aH(e){return Object.keys(e).sort().filter(t=>e[t]!==void 0).map(t=>`${t}_${t==="root"?sH(e.root):e[t]}`).toString()}function lH(e){const t=aH(e);let i=wC.get(t);if(!i){const a=new Map;let d;const _=new IntersectionObserver(b=>{b.forEach(o=>{var k;const O=o.isIntersecting&&d.some(z=>o.intersectionRatio>=z);e.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=O),(k=a.get(o.target))==null||k.forEach(z=>{z(O,o)})})},e);d=_.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:_,elements:a},wC.set(t,i)}return i}function cH(e,t,i={},a=oH){if(typeof window.IntersectionObserver>"u"&&a!==void 0){const k=e.getBoundingClientRect();return t(a,{isIntersecting:a,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:k,intersectionRect:k,rootBounds:k}),()=>{}}const{id:d,observer:_,elements:b}=lH(i),o=b.get(e)||[];return b.has(e)||b.set(e,o),o.push(t),_.observe(e),function(){o.splice(o.indexOf(t),1),o.length===0&&(b.delete(e),_.unobserve(e)),b.size===0&&(_.disconnect(),wC.delete(d))}}function uH({threshold:e,delay:t,trackVisibility:i,rootMargin:a,root:d,triggerOnce:_,skip:b,initialInView:o,fallbackInView:k,onChange:O}={}){var z;const[F,G]=Y.useState(null),ee=Y.useRef(O),[J,te]=Y.useState({inView:!!o,entry:void 0});ee.current=O,Y.useEffect(()=>{if(b||!F)return;let ue;return ue=cH(F,(he,Ie)=>{te({inView:he,entry:Ie}),ee.current&&ee.current(he,Ie),Ie.isIntersecting&&_&&ue&&(ue(),ue=void 0)},{root:d,rootMargin:a,threshold:e,trackVisibility:i,delay:t},k),()=>{ue&&ue()}},[Array.isArray(e)?e.toString():e,F,d,a,_,b,i,k,t]);const oe=(z=J.entry)==null?void 0:z.target,X=Y.useRef(void 0);!F&&oe&&!_&&!b&&X.current!==oe&&(X.current=oe,te({inView:!!o,entry:void 0}));const Q=[G,J.inView,J.entry];return Q.ref=Q[0],Q.inView=Q[1],Q.entry=Q[2],Q}const dH="modulepreload",hH=function(e){return"/"+e},xD={},cg=function(t,i,a){let d=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const b=document.querySelector("meta[property=csp-nonce]"),o=(b==null?void 0:b.nonce)||(b==null?void 0:b.getAttribute("nonce"));d=Promise.allSettled(i.map(k=>{if(k=hH(k),k in xD)return;xD[k]=!0;const O=k.endsWith(".css"),z=O?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${k}"]${z}`))return;const F=document.createElement("link");if(F.rel=O?"stylesheet":dH,O||(F.as="script"),F.crossOrigin="",F.href=k,o&&F.setAttribute("nonce",o),document.head.appendChild(F),O)return new Promise((G,ee)=>{F.addEventListener("load",G),F.addEventListener("error",()=>ee(new Error(`Unable to preload CSS for ${k}`)))})}))}function _(b){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=b,window.dispatchEvent(o),!o.defaultPrevented)throw b}return d.then(b=>{for(const o of b||[])o.status==="rejected"&&_(o.reason);return t().catch(_)})},fH=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>cg(async()=>{const{default:a}=await Promise.resolve().then(()=>Cg);return{default:a}},void 0).then(({default:a})=>a(...i)):t=fetch,(...i)=>t(...i)};class oM extends Error{constructor(t,i="FunctionsError",a){super(t),this.name=i,this.context=a}}class pH extends oM{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class mH extends oM{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class gH extends oM{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var SC;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(SC||(SC={}));var _H=function(e,t,i,a){function d(_){return _ instanceof i?_:new i(function(b){b(_)})}return new(i||(i=Promise))(function(_,b){function o(z){try{O(a.next(z))}catch(F){b(F)}}function k(z){try{O(a.throw(z))}catch(F){b(F)}}function O(z){z.done?_(z.value):d(z.value).then(o,k)}O((a=a.apply(e,t||[])).next())})};class yH{constructor(t,{headers:i={},customFetch:a,region:d=SC.Any}={}){this.url=t,this.headers=i,this.region=d,this.fetch=fH(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,i={}){var a;return _H(this,void 0,void 0,function*(){try{const{headers:d,method:_,body:b}=i;let o={},{region:k}=i;k||(k=this.region),k&&k!=="any"&&(o["x-region"]=k);let O;b&&(d&&!Object.prototype.hasOwnProperty.call(d,"Content-Type")||!d)&&(typeof Blob<"u"&&b instanceof Blob||b instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",O=b):typeof b=="string"?(o["Content-Type"]="text/plain",O=b):typeof FormData<"u"&&b instanceof FormData?O=b:(o["Content-Type"]="application/json",O=JSON.stringify(b)));const z=yield this.fetch(`${this.url}/${t}`,{method:_||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),d),body:O}).catch(J=>{throw new pH(J)}),F=z.headers.get("x-relay-error");if(F&&F==="true")throw new mH(z);if(!z.ok)throw new gH(z);let G=((a=z.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),ee;return G==="application/json"?ee=yield z.json():G==="application/octet-stream"?ee=yield z.blob():G==="text/event-stream"?ee=z:G==="multipart/form-data"?ee=yield z.formData():ee=yield z.text(),{data:ee,error:null}}catch(d){return{data:null,error:d}}})}}var Ns={},sM={},Sw={},Y0={},Tw={},Ew={},vH=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ug=vH();const xH=ug.fetch,Jz=ug.fetch.bind(ug),Qz=ug.Headers,bH=ug.Request,wH=ug.Response,Cg=Object.freeze(Object.defineProperty({__proto__:null,Headers:Qz,Request:bH,Response:wH,default:Jz,fetch:xH},Symbol.toStringTag,{value:"Module"})),SH=BU(Cg);var Cw={};Object.defineProperty(Cw,"__esModule",{value:!0});let TH=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};Cw.default=TH;var e5=ua&&ua.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ew,"__esModule",{value:!0});const EH=e5(SH),CH=e5(Cw);let MH=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=EH.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,i){return this.headers=Object.assign({},this.headers),this.headers[t]=i,this}then(t,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let d=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async _=>{var b,o,k;let O=null,z=null,F=null,G=_.status,ee=_.statusText;if(_.ok){if(this.method!=="HEAD"){const X=await _.text();X===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?z=X:z=JSON.parse(X))}const te=(b=this.headers.Prefer)===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),oe=(o=_.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");te&&oe&&oe.length>1&&(F=parseInt(oe[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(z)&&(z.length>1?(O={code:"PGRST116",details:`Results contain ${z.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},z=null,F=null,G=406,ee="Not Acceptable"):z.length===1?z=z[0]:z=null)}else{const te=await _.text();try{O=JSON.parse(te),Array.isArray(O)&&_.status===404&&(z=[],O=null,G=200,ee="OK")}catch{_.status===404&&te===""?(G=204,ee="No Content"):O={message:te}}if(O&&this.isMaybeSingle&&(!((k=O==null?void 0:O.details)===null||k===void 0)&&k.includes("0 rows"))&&(O=null,G=200,ee="OK"),O&&this.shouldThrowOnError)throw new CH.default(O)}return{error:O,data:z,count:F,status:G,statusText:ee}});return this.shouldThrowOnError||(d=d.catch(_=>{var b,o,k;return{error:{message:`${(b=_==null?void 0:_.name)!==null&&b!==void 0?b:"FetchError"}: ${_==null?void 0:_.message}`,details:`${(o=_==null?void 0:_.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(k=_==null?void 0:_.code)!==null&&k!==void 0?k:""}`},data:null,count:null,status:0,statusText:""}})),d.then(t,i)}};Ew.default=MH;var PH=ua&&ua.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Tw,"__esModule",{value:!0});const AH=PH(Ew);let IH=class extends AH.default{select(t){let i=!1;const a=(t??"*").split("").map(d=>/\s/.test(d)&&!i?"":(d==='"'&&(i=!i),d)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:i=!0,nullsFirst:a,foreignTable:d,referencedTable:_=d}={}){const b=_?`${_}.order`:"order",o=this.url.searchParams.get(b);return this.url.searchParams.set(b,`${o?`${o},`:""}${t}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:i,referencedTable:a=i}={}){const d=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(d,`${t}`),this}range(t,i,{foreignTable:a,referencedTable:d=a}={}){const _=typeof d>"u"?"offset":`${d}.offset`,b=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(_,`${t}`),this.url.searchParams.set(b,`${i-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:i=!1,settings:a=!1,buffers:d=!1,wal:_=!1,format:b="text"}={}){var o;const k=[t?"analyze":null,i?"verbose":null,a?"settings":null,d?"buffers":null,_?"wal":null].filter(Boolean).join("|"),O=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${b}; for="${O}"; options=${k};`,b==="json"?this:this}rollback(){var t;return((t=this.headers.Prefer)!==null&&t!==void 0?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Tw.default=IH;var kH=ua&&ua.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Y0,"__esModule",{value:!0});const RH=kH(Tw);let DH=class extends RH.default{eq(t,i){return this.url.searchParams.append(t,`eq.${i}`),this}neq(t,i){return this.url.searchParams.append(t,`neq.${i}`),this}gt(t,i){return this.url.searchParams.append(t,`gt.${i}`),this}gte(t,i){return this.url.searchParams.append(t,`gte.${i}`),this}lt(t,i){return this.url.searchParams.append(t,`lt.${i}`),this}lte(t,i){return this.url.searchParams.append(t,`lte.${i}`),this}like(t,i){return this.url.searchParams.append(t,`like.${i}`),this}likeAllOf(t,i){return this.url.searchParams.append(t,`like(all).{${i.join(",")}}`),this}likeAnyOf(t,i){return this.url.searchParams.append(t,`like(any).{${i.join(",")}}`),this}ilike(t,i){return this.url.searchParams.append(t,`ilike.${i}`),this}ilikeAllOf(t,i){return this.url.searchParams.append(t,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(t,i){return this.url.searchParams.append(t,`ilike(any).{${i.join(",")}}`),this}is(t,i){return this.url.searchParams.append(t,`is.${i}`),this}in(t,i){const a=Array.from(new Set(i)).map(d=>typeof d=="string"&&new RegExp("[,()]").test(d)?`"${d}"`:`${d}`).join(",");return this.url.searchParams.append(t,`in.(${a})`),this}contains(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cs.{${i.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(i)}`),this}containedBy(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cd.{${i.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(i)}`),this}rangeGt(t,i){return this.url.searchParams.append(t,`sr.${i}`),this}rangeGte(t,i){return this.url.searchParams.append(t,`nxl.${i}`),this}rangeLt(t,i){return this.url.searchParams.append(t,`sl.${i}`),this}rangeLte(t,i){return this.url.searchParams.append(t,`nxr.${i}`),this}rangeAdjacent(t,i){return this.url.searchParams.append(t,`adj.${i}`),this}overlaps(t,i){return typeof i=="string"?this.url.searchParams.append(t,`ov.${i}`):this.url.searchParams.append(t,`ov.{${i.join(",")}}`),this}textSearch(t,i,{config:a,type:d}={}){let _="";d==="plain"?_="pl":d==="phrase"?_="ph":d==="websearch"&&(_="w");const b=a===void 0?"":`(${a})`;return this.url.searchParams.append(t,`${_}fts${b}.${i}`),this}match(t){return Object.entries(t).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(t,i,a){return this.url.searchParams.append(t,`not.${i}.${a}`),this}or(t,{foreignTable:i,referencedTable:a=i}={}){const d=a?`${a}.or`:"or";return this.url.searchParams.append(d,`(${t})`),this}filter(t,i,a){return this.url.searchParams.append(t,`${i}.${a}`),this}};Y0.default=DH;var LH=ua&&ua.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Sw,"__esModule",{value:!0});const Cy=LH(Y0);let OH=class{constructor(t,{headers:i={},schema:a,fetch:d}){this.url=t,this.headers=i,this.schema=a,this.fetch=d}select(t,{head:i=!1,count:a}={}){const d=i?"HEAD":"GET";let _=!1;const b=(t??"*").split("").map(o=>/\s/.test(o)&&!_?"":(o==='"'&&(_=!_),o)).join("");return this.url.searchParams.set("select",b),a&&(this.headers.Prefer=`count=${a}`),new Cy.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:i,defaultToNull:a=!0}={}){const d="POST",_=[];if(this.headers.Prefer&&_.push(this.headers.Prefer),i&&_.push(`count=${i}`),a||_.push("missing=default"),this.headers.Prefer=_.join(","),Array.isArray(t)){const b=t.reduce((o,k)=>o.concat(Object.keys(k)),[]);if(b.length>0){const o=[...new Set(b)].map(k=>`"${k}"`);this.url.searchParams.set("columns",o.join(","))}}return new Cy.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:i,ignoreDuplicates:a=!1,count:d,defaultToNull:_=!0}={}){const b="POST",o=[`resolution=${a?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&o.push(this.headers.Prefer),d&&o.push(`count=${d}`),_||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(t)){const k=t.reduce((O,z)=>O.concat(Object.keys(z)),[]);if(k.length>0){const O=[...new Set(k)].map(z=>`"${z}"`);this.url.searchParams.set("columns",O.join(","))}}return new Cy.default({method:b,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:i}={}){const a="PATCH",d=[];return this.headers.Prefer&&d.push(this.headers.Prefer),i&&d.push(`count=${i}`),this.headers.Prefer=d.join(","),new Cy.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const i="DELETE",a=[];return t&&a.push(`count=${t}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new Cy.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Sw.default=OH;var Mw={},Pw={};Object.defineProperty(Pw,"__esModule",{value:!0});Pw.version=void 0;Pw.version="0.0.0-automated";Object.defineProperty(Mw,"__esModule",{value:!0});Mw.DEFAULT_HEADERS=void 0;const zH=Pw;Mw.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${zH.version}`};var t5=ua&&ua.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(sM,"__esModule",{value:!0});const NH=t5(Sw),FH=t5(Y0),jH=Mw;let BH=class r5{constructor(t,{headers:i={},schema:a,fetch:d}={}){this.url=t,this.headers=Object.assign(Object.assign({},jH.DEFAULT_HEADERS),i),this.schemaName=a,this.fetch=d}from(t){const i=new URL(`${this.url}/${t}`);return new NH.default(i,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new r5(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,i={},{head:a=!1,get:d=!1,count:_}={}){let b;const o=new URL(`${this.url}/rpc/${t}`);let k;a||d?(b=a?"HEAD":"GET",Object.entries(i).filter(([z,F])=>F!==void 0).map(([z,F])=>[z,Array.isArray(F)?`{${F.join(",")}}`:`${F}`]).forEach(([z,F])=>{o.searchParams.append(z,F)})):(b="POST",k=i);const O=Object.assign({},this.headers);return _&&(O.Prefer=`count=${_}`),new FH.default({method:b,url:o,headers:O,schema:this.schemaName,body:k,fetch:this.fetch,allowEmpty:!1})}};sM.default=BH;var Mg=ua&&ua.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ns,"__esModule",{value:!0});Ns.PostgrestError=Ns.PostgrestBuilder=Ns.PostgrestTransformBuilder=Ns.PostgrestFilterBuilder=Ns.PostgrestQueryBuilder=Ns.PostgrestClient=void 0;const n5=Mg(sM);Ns.PostgrestClient=n5.default;const i5=Mg(Sw);Ns.PostgrestQueryBuilder=i5.default;const o5=Mg(Y0);Ns.PostgrestFilterBuilder=o5.default;const s5=Mg(Tw);Ns.PostgrestTransformBuilder=s5.default;const a5=Mg(Ew);Ns.PostgrestBuilder=a5.default;const l5=Mg(Cw);Ns.PostgrestError=l5.default;var UH=Ns.default={PostgrestClient:n5.default,PostgrestQueryBuilder:i5.default,PostgrestFilterBuilder:o5.default,PostgrestTransformBuilder:s5.default,PostgrestBuilder:a5.default,PostgrestError:l5.default};const{PostgrestClient:VH,PostgrestQueryBuilder:Xie,PostgrestFilterBuilder:Kie,PostgrestTransformBuilder:Jie,PostgrestBuilder:Qie,PostgrestError:eoe}=UH,$H="2.11.2",GH={"X-Client-Info":`realtime-js/${$H}`},HH="1.0.0",c5=1e4,qH=1e3;var jm;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(jm||(jm={}));var na;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(na||(na={}));var cl;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(cl||(cl={}));var TC;(function(e){e.websocket="websocket"})(TC||(TC={}));var $h;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})($h||($h={}));class WH{constructor(){this.HEADER_LENGTH=1}decode(t,i){return t.constructor===ArrayBuffer?i(this._binaryDecode(t)):i(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const i=new DataView(t),a=new TextDecoder;return this._decodeBroadcast(t,i,a)}_decodeBroadcast(t,i,a){const d=i.getUint8(1),_=i.getUint8(2);let b=this.HEADER_LENGTH+2;const o=a.decode(t.slice(b,b+d));b=b+d;const k=a.decode(t.slice(b,b+_));b=b+_;const O=JSON.parse(a.decode(t.slice(b,t.byteLength)));return{ref:null,topic:o,event:k,payload:O}}}class u5{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var gi;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(gi||(gi={}));const bD=(e,t,i={})=>{var a;const d=(a=i.skipTypes)!==null&&a!==void 0?a:[];return Object.keys(t).reduce((_,b)=>(_[b]=ZH(b,e,t,d),_),{})},ZH=(e,t,i,a)=>{const d=t.find(o=>o.name===e),_=d==null?void 0:d.type,b=i[e];return _&&!a.includes(_)?d5(_,b):EC(b)},d5=(e,t)=>{if(e.charAt(0)==="_"){const i=e.slice(1,e.length);return JH(t,i)}switch(e){case gi.bool:return YH(t);case gi.float4:case gi.float8:case gi.int2:case gi.int4:case gi.int8:case gi.numeric:case gi.oid:return XH(t);case gi.json:case gi.jsonb:return KH(t);case gi.timestamp:return QH(t);case gi.abstime:case gi.date:case gi.daterange:case gi.int4range:case gi.int8range:case gi.money:case gi.reltime:case gi.text:case gi.time:case gi.timestamptz:case gi.timetz:case gi.tsrange:case gi.tstzrange:return EC(t);default:return EC(t)}},EC=e=>e,YH=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},XH=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},KH=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},JH=(e,t)=>{if(typeof e!="string")return e;const i=e.length-1,a=e[i];if(e[0]==="{"&&a==="}"){let _;const b=e.slice(1,i);try{_=JSON.parse("["+b+"]")}catch{_=b?b.split(","):[]}return _.map(o=>d5(t,o))}return e},QH=e=>typeof e=="string"?e.replace(" ","T"):e,h5=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class PT{constructor(t,i,a={},d=c5){this.channel=t,this.event=i,this.payload=a,this.timeout=d,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var a;return this._hasReceived(t)&&i((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var wD;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(wD||(wD={}));class Qy{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=(i==null?void 0:i.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},d=>{const{onJoin:_,onLeave:b,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qy.syncState(this.state,d,_,b),this.pendingDiffs.forEach(k=>{this.state=Qy.syncDiff(this.state,k,_,b)}),this.pendingDiffs=[],o()}),this.channel._on(a.diff,{},d=>{const{onJoin:_,onLeave:b,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(d):(this.state=Qy.syncDiff(this.state,d,_,b),o())}),this.onJoin((d,_,b)=>{this.channel._trigger("presence",{event:"join",key:d,currentPresences:_,newPresences:b})}),this.onLeave((d,_,b)=>{this.channel._trigger("presence",{event:"leave",key:d,currentPresences:_,leftPresences:b})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,a,d){const _=this.cloneDeep(t),b=this.transformState(i),o={},k={};return this.map(_,(O,z)=>{b[O]||(k[O]=z)}),this.map(b,(O,z)=>{const F=_[O];if(F){const G=z.map(oe=>oe.presence_ref),ee=F.map(oe=>oe.presence_ref),J=z.filter(oe=>ee.indexOf(oe.presence_ref)<0),te=F.filter(oe=>G.indexOf(oe.presence_ref)<0);J.length>0&&(o[O]=J),te.length>0&&(k[O]=te)}else o[O]=z}),this.syncDiff(_,{joins:o,leaves:k},a,d)}static syncDiff(t,i,a,d){const{joins:_,leaves:b}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return a||(a=()=>{}),d||(d=()=>{}),this.map(_,(o,k)=>{var O;const z=(O=t[o])!==null&&O!==void 0?O:[];if(t[o]=this.cloneDeep(k),z.length>0){const F=t[o].map(ee=>ee.presence_ref),G=z.filter(ee=>F.indexOf(ee.presence_ref)<0);t[o].unshift(...G)}a(o,z,k)}),this.map(b,(o,k)=>{let O=t[o];if(!O)return;const z=k.map(F=>F.presence_ref);O=O.filter(F=>z.indexOf(F.presence_ref)<0),t[o]=O,d(o,O,k),O.length===0&&delete t[o]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(a=>i(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,a)=>{const d=t[a];return"metas"in d?i[a]=d.metas.map(_=>(_.presence_ref=_.phx_ref,delete _.phx_ref,delete _.phx_ref_prev,_)):i[a]=d,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var SD;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(SD||(SD={}));var TD;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(TD||(TD={}));var jc;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(jc||(jc={}));class aM{constructor(t,i={config:{}},a){this.topic=t,this.params=i,this.socket=a,this.bindings={},this.state=na.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new PT(this,cl.join,this.params,this.timeout),this.rejoinTimer=new u5(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=na.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=na.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=na.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=na.errored,this.rejoinTimer.scheduleTimeout())}),this._on(cl.reply,{},(d,_)=>{this._trigger(this._replyEventName(_),d)}),this.presence=new Qy(this),this.broadcastEndpointURL=h5(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,i=this.timeout){var a,d;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:_,presence:b,private:o}}=this.params;this._onError(z=>t==null?void 0:t(jc.CHANNEL_ERROR,z)),this._onClose(()=>t==null?void 0:t(jc.CLOSED));const k={},O={broadcast:_,presence:b,postgres_changes:(d=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(z=>z.filter))!==null&&d!==void 0?d:[],private:o};this.socket.accessTokenValue&&(k.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:O},k)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:z})=>{var F;if(this.socket.setAuth(),z===void 0){t==null||t(jc.SUBSCRIBED);return}else{const G=this.bindings.postgres_changes,ee=(F=G==null?void 0:G.length)!==null&&F!==void 0?F:0,J=[];for(let te=0;te<ee;te++){const oe=G[te],{filter:{event:X,schema:Q,table:ue,filter:he}}=oe,Ie=z&&z[te];if(Ie&&Ie.event===X&&Ie.schema===Q&&Ie.table===ue&&Ie.filter===he)J.push(Object.assign(Object.assign({},oe),{id:Ie.id}));else{this.unsubscribe(),t==null||t(jc.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=J,t&&t(jc.SUBSCRIBED);return}}).receive("error",z=>{t==null||t(jc.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(z).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(jc.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,a){return this._on(t,i,a)}async send(t,i={}){var a,d;if(!this._canPush()&&t.type==="broadcast"){const{event:_,payload:b}=t,k={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:_,payload:b,private:this.private}]})};try{const O=await this._fetchWithTimeout(this.broadcastEndpointURL,k,(a=i.timeout)!==null&&a!==void 0?a:this.timeout);return await((d=O.body)===null||d===void 0?void 0:d.cancel()),O.ok?"ok":"error"}catch(O){return O.name==="AbortError"?"timed out":"error"}}else return new Promise(_=>{var b,o,k;const O=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((k=(o=(b=this.params)===null||b===void 0?void 0:b.config)===null||o===void 0?void 0:o.broadcast)===null||k===void 0)&&k.ack)&&_("ok"),O.receive("ok",()=>_("ok")),O.receive("error",()=>_("error")),O.receive("timeout",()=>_("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=na.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(cl.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(a=>{const d=new PT(this,cl.leave,{},t);d.receive("ok",()=>{i(),a("ok")}).receive("timeout",()=>{i(),a("timed out")}).receive("error",()=>{a("error")}),d.send(),this._canPush()||d.trigger("ok",{})})}async _fetchWithTimeout(t,i,a){const d=new AbortController,_=setTimeout(()=>d.abort(),a),b=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:d.signal}));return clearTimeout(_),b}_push(t,i,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let d=new PT(this,t,i,a);return this._canPush()?d.send():(d.startTimeout(),this.pushBuffer.push(d)),d}_onMessage(t,i,a){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,a){var d,_;const b=t.toLocaleLowerCase(),{close:o,error:k,leave:O,join:z}=cl;if(a&&[o,k,O,z].indexOf(b)>=0&&a!==this._joinRef())return;let G=this._onMessage(b,i,a);if(i&&!G)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(b)?(d=this.bindings.postgres_changes)===null||d===void 0||d.filter(ee=>{var J,te,oe;return((J=ee.filter)===null||J===void 0?void 0:J.event)==="*"||((oe=(te=ee.filter)===null||te===void 0?void 0:te.event)===null||oe===void 0?void 0:oe.toLocaleLowerCase())===b}).map(ee=>ee.callback(G,a)):(_=this.bindings[b])===null||_===void 0||_.filter(ee=>{var J,te,oe,X,Q,ue;if(["broadcast","presence","postgres_changes"].includes(b))if("id"in ee){const he=ee.id,Ie=(J=ee.filter)===null||J===void 0?void 0:J.event;return he&&((te=i.ids)===null||te===void 0?void 0:te.includes(he))&&(Ie==="*"||(Ie==null?void 0:Ie.toLocaleLowerCase())===((oe=i.data)===null||oe===void 0?void 0:oe.type.toLocaleLowerCase()))}else{const he=(Q=(X=ee==null?void 0:ee.filter)===null||X===void 0?void 0:X.event)===null||Q===void 0?void 0:Q.toLocaleLowerCase();return he==="*"||he===((ue=i==null?void 0:i.event)===null||ue===void 0?void 0:ue.toLocaleLowerCase())}else return ee.type.toLocaleLowerCase()===b}).map(ee=>{if(typeof G=="object"&&"ids"in G){const J=G.data,{schema:te,table:oe,commit_timestamp:X,type:Q,errors:ue}=J;G=Object.assign(Object.assign({},{schema:te,table:oe,commit_timestamp:X,eventType:Q,new:{},old:{},errors:ue}),this._getPayloadRecords(J))}ee.callback(G,a)})}_isClosed(){return this.state===na.closed}_isJoined(){return this.state===na.joined}_isJoining(){return this.state===na.joining}_isLeaving(){return this.state===na.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,a){const d=t.toLocaleLowerCase(),_={type:d,filter:i,callback:a};return this.bindings[d]?this.bindings[d].push(_):this.bindings[d]=[_],this}_off(t,i){const a=t.toLocaleLowerCase();return this.bindings[a]=this.bindings[a].filter(d=>{var _;return!(((_=d.type)===null||_===void 0?void 0:_.toLocaleLowerCase())===a&&aM.isEqual(d.filter,i))}),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(t[a]!==i[a])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(cl.close,{},t)}_onError(t){this._on(cl.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=na.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=bD(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=bD(t.columns,t.old_record)),i}}const eq=()=>{},tq=typeof WebSocket<"u",rq=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class nq{constructor(t,i){var a;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=GH,this.params={},this.timeout=c5,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=eq,this.conn=null,this.sendBuffer=[],this.serializer=new WH,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=_=>{let b;return _?b=_:typeof fetch>"u"?b=(...o)=>cg(async()=>{const{default:k}=await Promise.resolve().then(()=>Cg);return{default:k}},void 0).then(({default:k})=>k(...o)):b=fetch,(...o)=>b(...o)},this.endPoint=`${t}/${TC.websocket}`,this.httpEndpoint=h5(t),i!=null&&i.transport?this.transport=i.transport:this.transport=null,i!=null&&i.params&&(this.params=i.params),i!=null&&i.headers&&(this.headers=Object.assign(Object.assign({},this.headers),i.headers)),i!=null&&i.timeout&&(this.timeout=i.timeout),i!=null&&i.logger&&(this.logger=i.logger),i!=null&&i.heartbeatIntervalMs&&(this.heartbeatIntervalMs=i.heartbeatIntervalMs);const d=(a=i==null?void 0:i.params)===null||a===void 0?void 0:a.apikey;if(d&&(this.accessTokenValue=d,this.apiKey=d),this.reconnectAfterMs=i!=null&&i.reconnectAfterMs?i.reconnectAfterMs:_=>[1e3,2e3,5e3,1e4][_-1]||1e4,this.encode=i!=null&&i.encode?i.encode:(_,b)=>b(JSON.stringify(_)),this.decode=i!=null&&i.decode?i.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new u5(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(i==null?void 0:i.fetch),i!=null&&i.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(i==null?void 0:i.worker)||!1,this.workerUrl=i==null?void 0:i.workerUrl}this.accessToken=(i==null?void 0:i.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(tq){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new iq(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),cg(async()=>{const{default:t}=await import("./browser-C7uoVMBt.js").then(i=>i.b);return{default:t}},[]).then(({default:t})=>{this.conn=new t(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:HH}))}disconnect(t,i){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,i??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.disconnect(),t}log(t,i,a){this.logger(t,i,a)}connectionState(){switch(this.conn&&this.conn.readyState){case jm.connecting:return $h.Connecting;case jm.open:return $h.Open;case jm.closing:return $h.Closing;default:return $h.Closed}}isConnected(){return this.connectionState()===$h.Open}channel(t,i={config:{}}){const a=new aM(`realtime:${t}`,i,this);return this.channels.push(a),a}push(t){const{topic:i,event:a,payload:d,ref:_}=t,b=()=>{this.encode(t,o=>{var k;(k=this.conn)===null||k===void 0||k.send(o)})};this.log("push",`${i} ${a} (${_})`,d),this.isConnected()?b():this.sendBuffer.push(b)}async setAuth(t=null){let i=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(i){let a=null;try{a=JSON.parse(atob(i.split(".")[1]))}catch{}if(a&&a.exp&&!(Math.floor(Date.now()/1e3)-a.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`);this.accessTokenValue=i,this.channels.forEach(d=>{i&&d.updateJoinPayload({access_token:i}),d.joinedOnce&&d._isJoined()&&d._push(cl.access_token,{access_token:i})})}}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(qH,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i._joinRef()!==t._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_onConnMessage(t){this.decode(t.data,i=>{let{topic:a,event:d,payload:_,ref:b}=i;b&&b===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${_.status||""} ${a} ${d} ${b&&"("+b+")"||""}`,_),this.channels.filter(o=>o._isMember(a)).forEach(o=>o._trigger(d,_,b)),this.stateChangeCallbacks.message.forEach(o=>o(i))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this.workerRef.terminate()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(t=>t())}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(i=>i(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(i=>i(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(cl.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const a=t.match(/\?/)?"&":"?",d=new URLSearchParams(i);return`${t}${a}${d}`}_workerObjectUrl(t){let i;if(t)i=t;else{const a=new Blob([rq],{type:"application/javascript"});i=URL.createObjectURL(a)}return i}}class iq{constructor(t,i,a){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=jm.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=a.close}}class lM extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Po(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class oq extends lM{constructor(t,i){super(t),this.name="StorageApiError",this.status=i}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class CC extends lM{constructor(t,i){super(t),this.name="StorageUnknownError",this.originalError=i}}var sq=function(e,t,i,a){function d(_){return _ instanceof i?_:new i(function(b){b(_)})}return new(i||(i=Promise))(function(_,b){function o(z){try{O(a.next(z))}catch(F){b(F)}}function k(z){try{O(a.throw(z))}catch(F){b(F)}}function O(z){z.done?_(z.value):d(z.value).then(o,k)}O((a=a.apply(e,t||[])).next())})};const f5=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>cg(async()=>{const{default:a}=await Promise.resolve().then(()=>Cg);return{default:a}},void 0).then(({default:a})=>a(...i)):t=fetch,(...i)=>t(...i)},aq=()=>sq(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield cg(()=>Promise.resolve().then(()=>Cg),void 0)).Response:Response}),MC=e=>{if(Array.isArray(e))return e.map(i=>MC(i));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([i,a])=>{const d=i.replace(/([-_][a-z])/gi,_=>_.toUpperCase().replace(/[-_]/g,""));t[d]=MC(a)}),t};var If=function(e,t,i,a){function d(_){return _ instanceof i?_:new i(function(b){b(_)})}return new(i||(i=Promise))(function(_,b){function o(z){try{O(a.next(z))}catch(F){b(F)}}function k(z){try{O(a.throw(z))}catch(F){b(F)}}function O(z){z.done?_(z.value):d(z.value).then(o,k)}O((a=a.apply(e,t||[])).next())})};const AT=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),lq=(e,t,i)=>If(void 0,void 0,void 0,function*(){const a=yield aq();e instanceof a&&!(i!=null&&i.noResolveJson)?e.json().then(d=>{t(new oq(AT(d),e.status||500))}).catch(d=>{t(new CC(AT(d),d))}):t(new CC(AT(e),e))}),cq=(e,t,i,a)=>{const d={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?d:(d.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),a&&(d.body=JSON.stringify(a)),Object.assign(Object.assign({},d),i))};function X0(e,t,i,a,d,_){return If(this,void 0,void 0,function*(){return new Promise((b,o)=>{e(i,cq(t,a,d,_)).then(k=>{if(!k.ok)throw k;return a!=null&&a.noResolveJson?k:k.json()}).then(k=>b(k)).catch(k=>lq(k,o,a))})})}function Fb(e,t,i,a){return If(this,void 0,void 0,function*(){return X0(e,"GET",t,i,a)})}function ld(e,t,i,a,d){return If(this,void 0,void 0,function*(){return X0(e,"POST",t,a,d,i)})}function uq(e,t,i,a,d){return If(this,void 0,void 0,function*(){return X0(e,"PUT",t,a,d,i)})}function dq(e,t,i,a){return If(this,void 0,void 0,function*(){return X0(e,"HEAD",t,Object.assign(Object.assign({},i),{noResolveJson:!0}),a)})}function p5(e,t,i,a,d){return If(this,void 0,void 0,function*(){return X0(e,"DELETE",t,a,d,i)})}var ks=function(e,t,i,a){function d(_){return _ instanceof i?_:new i(function(b){b(_)})}return new(i||(i=Promise))(function(_,b){function o(z){try{O(a.next(z))}catch(F){b(F)}}function k(z){try{O(a.throw(z))}catch(F){b(F)}}function O(z){z.done?_(z.value):d(z.value).then(o,k)}O((a=a.apply(e,t||[])).next())})};const hq={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ED={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class fq{constructor(t,i={},a,d){this.url=t,this.headers=i,this.bucketId=a,this.fetch=f5(d)}uploadOrUpdate(t,i,a,d){return ks(this,void 0,void 0,function*(){try{let _;const b=Object.assign(Object.assign({},ED),d);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(b.upsert)});const k=b.metadata;typeof Blob<"u"&&a instanceof Blob?(_=new FormData,_.append("cacheControl",b.cacheControl),k&&_.append("metadata",this.encodeMetadata(k)),_.append("",a)):typeof FormData<"u"&&a instanceof FormData?(_=a,_.append("cacheControl",b.cacheControl),k&&_.append("metadata",this.encodeMetadata(k))):(_=a,o["cache-control"]=`max-age=${b.cacheControl}`,o["content-type"]=b.contentType,k&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(k)))),d!=null&&d.headers&&(o=Object.assign(Object.assign({},o),d.headers));const O=this._removeEmptyFolders(i),z=this._getFinalPath(O),F=yield this.fetch(`${this.url}/object/${z}`,Object.assign({method:t,body:_,headers:o},b!=null&&b.duplex?{duplex:b.duplex}:{})),G=yield F.json();return F.ok?{data:{path:O,id:G.Id,fullPath:G.Key},error:null}:{data:null,error:G}}catch(_){if(Po(_))return{data:null,error:_};throw _}})}upload(t,i,a){return ks(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,i,a)})}uploadToSignedUrl(t,i,a,d){return ks(this,void 0,void 0,function*(){const _=this._removeEmptyFolders(t),b=this._getFinalPath(_),o=new URL(this.url+`/object/upload/sign/${b}`);o.searchParams.set("token",i);try{let k;const O=Object.assign({upsert:ED.upsert},d),z=Object.assign(Object.assign({},this.headers),{"x-upsert":String(O.upsert)});typeof Blob<"u"&&a instanceof Blob?(k=new FormData,k.append("cacheControl",O.cacheControl),k.append("",a)):typeof FormData<"u"&&a instanceof FormData?(k=a,k.append("cacheControl",O.cacheControl)):(k=a,z["cache-control"]=`max-age=${O.cacheControl}`,z["content-type"]=O.contentType);const F=yield this.fetch(o.toString(),{method:"PUT",body:k,headers:z}),G=yield F.json();return F.ok?{data:{path:_,fullPath:G.Key},error:null}:{data:null,error:G}}catch(k){if(Po(k))return{data:null,error:k};throw k}})}createSignedUploadUrl(t,i){return ks(this,void 0,void 0,function*(){try{let a=this._getFinalPath(t);const d=Object.assign({},this.headers);i!=null&&i.upsert&&(d["x-upsert"]="true");const _=yield ld(this.fetch,`${this.url}/object/upload/sign/${a}`,{},{headers:d}),b=new URL(this.url+_.url),o=b.searchParams.get("token");if(!o)throw new lM("No token returned by API");return{data:{signedUrl:b.toString(),path:t,token:o},error:null}}catch(a){if(Po(a))return{data:null,error:a};throw a}})}update(t,i,a){return ks(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,i,a)})}move(t,i,a){return ks(this,void 0,void 0,function*(){try{return{data:yield ld(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers}),error:null}}catch(d){if(Po(d))return{data:null,error:d};throw d}})}copy(t,i,a){return ks(this,void 0,void 0,function*(){try{return{data:{path:(yield ld(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers})).Key},error:null}}catch(d){if(Po(d))return{data:null,error:d};throw d}})}createSignedUrl(t,i,a){return ks(this,void 0,void 0,function*(){try{let d=this._getFinalPath(t),_=yield ld(this.fetch,`${this.url}/object/sign/${d}`,Object.assign({expiresIn:i},a!=null&&a.transform?{transform:a.transform}:{}),{headers:this.headers});const b=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return _={signedUrl:encodeURI(`${this.url}${_.signedURL}${b}`)},{data:_,error:null}}catch(d){if(Po(d))return{data:null,error:d};throw d}})}createSignedUrls(t,i,a){return ks(this,void 0,void 0,function*(){try{const d=yield ld(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:t},{headers:this.headers}),_=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return{data:d.map(b=>Object.assign(Object.assign({},b),{signedUrl:b.signedURL?encodeURI(`${this.url}${b.signedURL}${_}`):null})),error:null}}catch(d){if(Po(d))return{data:null,error:d};throw d}})}download(t,i){return ks(this,void 0,void 0,function*(){const d=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",_=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),b=_?`?${_}`:"";try{const o=this._getFinalPath(t);return{data:yield(yield Fb(this.fetch,`${this.url}/${d}/${o}${b}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(Po(o))return{data:null,error:o};throw o}})}info(t){return ks(this,void 0,void 0,function*(){const i=this._getFinalPath(t);try{const a=yield Fb(this.fetch,`${this.url}/object/info/${i}`,{headers:this.headers});return{data:MC(a),error:null}}catch(a){if(Po(a))return{data:null,error:a};throw a}})}exists(t){return ks(this,void 0,void 0,function*(){const i=this._getFinalPath(t);try{return yield dq(this.fetch,`${this.url}/object/${i}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(Po(a)&&a instanceof CC){const d=a.originalError;if([400,404].includes(d==null?void 0:d.status))return{data:!1,error:a}}throw a}})}getPublicUrl(t,i){const a=this._getFinalPath(t),d=[],_=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";_!==""&&d.push(_);const o=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",k=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});k!==""&&d.push(k);let O=d.join("&");return O!==""&&(O=`?${O}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${a}${O}`)}}}remove(t){return ks(this,void 0,void 0,function*(){try{return{data:yield p5(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(i){if(Po(i))return{data:null,error:i};throw i}})}list(t,i,a){return ks(this,void 0,void 0,function*(){try{const d=Object.assign(Object.assign(Object.assign({},hq),i),{prefix:t||""});return{data:yield ld(this.fetch,`${this.url}/object/list/${this.bucketId}`,d,{headers:this.headers},a),error:null}}catch(d){if(Po(d))return{data:null,error:d};throw d}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const i=[];return t.width&&i.push(`width=${t.width}`),t.height&&i.push(`height=${t.height}`),t.resize&&i.push(`resize=${t.resize}`),t.format&&i.push(`format=${t.format}`),t.quality&&i.push(`quality=${t.quality}`),i.join("&")}}const pq="2.7.1",mq={"X-Client-Info":`storage-js/${pq}`};var sm=function(e,t,i,a){function d(_){return _ instanceof i?_:new i(function(b){b(_)})}return new(i||(i=Promise))(function(_,b){function o(z){try{O(a.next(z))}catch(F){b(F)}}function k(z){try{O(a.throw(z))}catch(F){b(F)}}function O(z){z.done?_(z.value):d(z.value).then(o,k)}O((a=a.apply(e,t||[])).next())})};class gq{constructor(t,i={},a){this.url=t,this.headers=Object.assign(Object.assign({},mq),i),this.fetch=f5(a)}listBuckets(){return sm(this,void 0,void 0,function*(){try{return{data:yield Fb(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(Po(t))return{data:null,error:t};throw t}})}getBucket(t){return sm(this,void 0,void 0,function*(){try{return{data:yield Fb(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(i){if(Po(i))return{data:null,error:i};throw i}})}createBucket(t,i={public:!1}){return sm(this,void 0,void 0,function*(){try{return{data:yield ld(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(Po(a))return{data:null,error:a};throw a}})}updateBucket(t,i){return sm(this,void 0,void 0,function*(){try{return{data:yield uq(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(Po(a))return{data:null,error:a};throw a}})}emptyBucket(t){return sm(this,void 0,void 0,function*(){try{return{data:yield ld(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(Po(i))return{data:null,error:i};throw i}})}deleteBucket(t){return sm(this,void 0,void 0,function*(){try{return{data:yield p5(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(i){if(Po(i))return{data:null,error:i};throw i}})}}class _q extends gq{constructor(t,i={},a){super(t,i,a)}from(t){return new fq(this.url,this.headers,t,this.fetch)}}const yq="2.47.10";let By="";typeof Deno<"u"?By="deno":typeof document<"u"?By="web":typeof navigator<"u"&&navigator.product==="ReactNative"?By="react-native":By="node";const vq={"X-Client-Info":`supabase-js-${By}/${yq}`},xq={headers:vq},bq={schema:"public"},wq={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Sq={};var Tq=function(e,t,i,a){function d(_){return _ instanceof i?_:new i(function(b){b(_)})}return new(i||(i=Promise))(function(_,b){function o(z){try{O(a.next(z))}catch(F){b(F)}}function k(z){try{O(a.throw(z))}catch(F){b(F)}}function O(z){z.done?_(z.value):d(z.value).then(o,k)}O((a=a.apply(e,t||[])).next())})};const Eq=e=>{let t;return e?t=e:typeof fetch>"u"?t=Jz:t=fetch,(...i)=>t(...i)},Cq=()=>typeof Headers>"u"?Qz:Headers,Mq=(e,t,i)=>{const a=Eq(i),d=Cq();return(_,b)=>Tq(void 0,void 0,void 0,function*(){var o;const k=(o=yield t())!==null&&o!==void 0?o:e;let O=new d(b==null?void 0:b.headers);return O.has("apikey")||O.set("apikey",e),O.has("Authorization")||O.set("Authorization",`Bearer ${k}`),a(_,Object.assign(Object.assign({},b),{headers:O}))})};var Pq=function(e,t,i,a){function d(_){return _ instanceof i?_:new i(function(b){b(_)})}return new(i||(i=Promise))(function(_,b){function o(z){try{O(a.next(z))}catch(F){b(F)}}function k(z){try{O(a.throw(z))}catch(F){b(F)}}function O(z){z.done?_(z.value):d(z.value).then(o,k)}O((a=a.apply(e,t||[])).next())})};function Aq(e){return e.replace(/\/$/,"")}function Iq(e,t){const{db:i,auth:a,realtime:d,global:_}=e,{db:b,auth:o,realtime:k,global:O}=t,z={db:Object.assign(Object.assign({},b),i),auth:Object.assign(Object.assign({},o),a),realtime:Object.assign(Object.assign({},k),d),global:Object.assign(Object.assign({},O),_),accessToken:()=>Pq(this,void 0,void 0,function*(){return""})};return e.accessToken?z.accessToken=e.accessToken:delete z.accessToken,z}const m5="2.67.3",kq="http://localhost:9999",Rq="supabase.auth.token",Dq={"X-Client-Info":`gotrue-js/${m5}`},CD=10,PC="X-Supabase-Api-Version",g5={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Lq(e){return Math.round(Date.now()/1e3)+e}function Oq(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const Hl=()=>typeof window<"u"&&typeof document<"u",Nh={tested:!1,writable:!1},e0=()=>{if(!Hl())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Nh.tested)return Nh.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Nh.tested=!0,Nh.writable=!0}catch{Nh.tested=!0,Nh.writable=!1}return Nh.writable};function zq(e){const t={},i=new URL(e);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((d,_)=>{t[_]=d})}catch{}return i.searchParams.forEach((a,d)=>{t[d]=a}),t}const _5=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>cg(async()=>{const{default:a}=await Promise.resolve().then(()=>Cg);return{default:a}},void 0).then(({default:a})=>a(...i)):t=fetch,(...i)=>t(...i)},Nq=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",y5=async(e,t,i)=>{await e.setItem(t,JSON.stringify(i))},P1=async(e,t)=>{const i=await e.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},A1=async(e,t)=>{await e.removeItem(t)};function Fq(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i="",a,d,_,b,o,k,O,z=0;for(e=e.replace("-","+").replace("_","/");z<e.length;)b=t.indexOf(e.charAt(z++)),o=t.indexOf(e.charAt(z++)),k=t.indexOf(e.charAt(z++)),O=t.indexOf(e.charAt(z++)),a=b<<2|o>>4,d=(o&15)<<4|k>>2,_=(k&3)<<6|O,i=i+String.fromCharCode(a),k!=64&&d!=0&&(i=i+String.fromCharCode(d)),O!=64&&_!=0&&(i=i+String.fromCharCode(_));return i}class Aw{constructor(){this.promise=new Aw.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}Aw.promiseConstructor=Promise;function MD(e){const t=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,i=e.split(".");if(i.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!t.test(i[1]))throw new Error("JWT is not valid: payload is not in base64url format");const a=i[1];return JSON.parse(Fq(a))}async function jq(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Bq(e,t){return new Promise((a,d)=>{(async()=>{for(let _=0;_<1/0;_++)try{const b=await e(_);if(!t(_,null,b)){a(b);return}}catch(b){if(!t(_,b)){d(b);return}}})()})}function Uq(e){return("0"+e.toString(16)).substr(-2)}function Vq(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=i.length;let d="";for(let _=0;_<56;_++)d+=i.charAt(Math.floor(Math.random()*a));return d}return crypto.getRandomValues(t),Array.from(t,Uq).join("")}async function $q(e){const i=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",i),d=new Uint8Array(a);return Array.from(d).map(_=>String.fromCharCode(_)).join("")}function Gq(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Hq(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const i=await $q(e);return Gq(i)}async function am(e,t,i=!1){const a=Vq();let d=a;i&&(d+="/PASSWORD_RECOVERY"),await y5(e,`${t}-code-verifier`,d);const _=await Hq(a);return[_,a===_?"plain":"s256"]}const qq=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Wq(e){const t=e.headers.get(PC);if(!t||!t.match(qq))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}class cM extends Error{constructor(t,i,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=a}}function Sn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class Zq extends cM{constructor(t,i,a){super(t,i,a),this.name="AuthApiError",this.status=i,this.code=a}}function Yq(e){return Sn(e)&&e.name==="AuthApiError"}class v5 extends cM{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class kf extends cM{constructor(t,i,a,d){super(t,a,d),this.name=i,this.status=a}}class nd extends kf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Xq(e){return Sn(e)&&e.name==="AuthSessionMissingError"}class IT extends kf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class I1 extends kf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class k1 extends kf{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Kq(e){return Sn(e)&&e.name==="AuthImplicitGrantRedirectError"}class PD extends kf{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AC extends kf{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function kT(e){return Sn(e)&&e.name==="AuthRetryableFetchError"}class AD extends kf{constructor(t,i,a){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=a}}var Jq=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(e);d<a.length;d++)t.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(e,a[d])&&(i[a[d]]=e[a[d]]);return i};const Uh=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Qq=[502,503,504];async function ID(e){var t;if(!Nq(e))throw new AC(Uh(e),0);if(Qq.includes(e.status))throw new AC(Uh(e),e.status);let i;try{i=await e.json()}catch(_){throw new v5(Uh(_),_)}let a;const d=Wq(e);if(d&&d.getTime()>=g5["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?a=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(a=i.error_code),a){if(a==="weak_password")throw new AD(Uh(i),e.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new nd}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((_,b)=>_&&typeof b=="string",!0))throw new AD(Uh(i),e.status,i.weak_password.reasons);throw new Zq(Uh(i),e.status||500,a)}const eW=(e,t,i,a)=>{const d={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?d:(d.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),d.body=JSON.stringify(a),Object.assign(Object.assign({},d),i))};async function Vn(e,t,i,a){var d;const _=Object.assign({},a==null?void 0:a.headers);_[PC]||(_[PC]=g5["2024-01-01"].name),a!=null&&a.jwt&&(_.Authorization=`Bearer ${a.jwt}`);const b=(d=a==null?void 0:a.query)!==null&&d!==void 0?d:{};a!=null&&a.redirectTo&&(b.redirect_to=a.redirectTo);const o=Object.keys(b).length?"?"+new URLSearchParams(b).toString():"",k=await tW(e,t,i+o,{headers:_,noResolveJson:a==null?void 0:a.noResolveJson},{},a==null?void 0:a.body);return a!=null&&a.xform?a==null?void 0:a.xform(k):{data:Object.assign({},k),error:null}}async function tW(e,t,i,a,d,_){const b=eW(t,a,d,_);let o;try{o=await e(i,Object.assign({},b))}catch(k){throw console.error(k),new AC(Uh(k),0)}if(o.ok||await ID(o),a!=null&&a.noResolveJson)return o;try{return await o.json()}catch(k){await ID(k)}}function id(e){var t;let i=null;oW(e)&&(i=Object.assign({},e),e.expires_at||(i.expires_at=Lq(e.expires_in)));const a=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:i,user:a},error:null}}function kD(e){const t=id(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0)&&(t.data.weak_password=e.weak_password),t}function dd(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function rW(e){return{data:e,error:null}}function nW(e){const{action_link:t,email_otp:i,hashed_token:a,redirect_to:d,verification_type:_}=e,b=Jq(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:i,hashed_token:a,redirect_to:d,verification_type:_},k=Object.assign({},b);return{data:{properties:o,user:k},error:null}}function iW(e){return e}function oW(e){return e.access_token&&e.refresh_token&&e.expires_in}var sW=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(e);d<a.length;d++)t.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(e,a[d])&&(i[a[d]]=e[a[d]]);return i};class aW{constructor({url:t="",headers:i={},fetch:a}){this.url=t,this.headers=i,this.fetch=_5(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,i="global"){try{return await Vn(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(Sn(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,i={}){try{return await Vn(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:dd})}catch(a){if(Sn(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:i}=t,a=sW(t,["options"]),d=Object.assign(Object.assign({},a),i);return"newEmail"in a&&(d.new_email=a==null?void 0:a.newEmail,delete d.newEmail),await Vn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:d,headers:this.headers,xform:nW,redirectTo:i==null?void 0:i.redirectTo})}catch(i){if(Sn(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await Vn(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:dd})}catch(i){if(Sn(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,a,d,_,b,o,k;try{const O={nextPage:null,lastPage:0,total:0},z=await Vn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t==null?void 0:t.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(_=(d=t==null?void 0:t.perPage)===null||d===void 0?void 0:d.toString())!==null&&_!==void 0?_:""},xform:iW});if(z.error)throw z.error;const F=await z.json(),G=(b=z.headers.get("x-total-count"))!==null&&b!==void 0?b:0,ee=(k=(o=z.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&k!==void 0?k:[];return ee.length>0&&(ee.forEach(J=>{const te=parseInt(J.split(";")[0].split("=")[1].substring(0,1)),oe=JSON.parse(J.split(";")[1].split("=")[1]);O[`${oe}Page`]=te}),O.total=parseInt(G)),{data:Object.assign(Object.assign({},F),O),error:null}}catch(O){if(Sn(O))return{data:{users:[]},error:O};throw O}}async getUserById(t){try{return await Vn(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:dd})}catch(i){if(Sn(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){try{return await Vn(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:dd})}catch(a){if(Sn(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,i=!1){try{return await Vn(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:dd})}catch(a){if(Sn(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){try{const{data:i,error:a}=await Vn(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:d=>({data:{factors:d},error:null})});return{data:i,error:a}}catch(i){if(Sn(i))return{data:null,error:i};throw i}}async _deleteFactor(t){try{return{data:await Vn(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(Sn(i))return{data:null,error:i};throw i}}}const lW={getItem:e=>e0()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{e0()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{e0()&&globalThis.localStorage.removeItem(e)}};function RD(e={}){return{getItem:t=>e[t]||null,setItem:(t,i)=>{e[t]=i},removeItem:t=>{delete e[t]}}}function cW(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const lm={debug:!!(globalThis&&e0()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class x5 extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class uW extends x5{}async function dW(e,t,i){lm.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const a=new globalThis.AbortController;return t>0&&setTimeout(()=>{a.abort(),lm.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async d=>{if(d){lm.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,d.name);try{return await i()}finally{lm.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,d.name)}}else{if(t===0)throw lm.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new uW(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(lm.debug)try{const _=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(_,null,"  "))}catch(_){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",_)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}cW();const hW={url:kq,storageKey:Rq,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Dq,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},My=30*1e3,DD=3;async function LD(e,t,i){return await i()}class E0{constructor(t){var i,a;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=E0.nextInstanceID,E0.nextInstanceID+=1,this.instanceID>0&&Hl()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const d=Object.assign(Object.assign({},hW),t);if(this.logDebugMessages=!!d.debug,typeof d.debug=="function"&&(this.logger=d.debug),this.persistSession=d.persistSession,this.storageKey=d.storageKey,this.autoRefreshToken=d.autoRefreshToken,this.admin=new aW({url:d.url,headers:d.headers,fetch:d.fetch}),this.url=d.url,this.headers=d.headers,this.fetch=_5(d.fetch),this.lock=d.lock||LD,this.detectSessionInUrl=d.detectSessionInUrl,this.flowType=d.flowType,this.hasCustomAuthorizationHeader=d.hasCustomAuthorizationHeader,d.lock?this.lock=d.lock:Hl()&&(!((i=globalThis==null?void 0:globalThis.navigator)===null||i===void 0)&&i.locks)?this.lock=dW:this.lock=LD,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?d.storage?this.storage=d.storage:e0()?this.storage=lW:(this.memoryStorage={},this.storage=RD(this.memoryStorage)):(this.memoryStorage={},this.storage=RD(this.memoryStorage)),Hl()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(_){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",_)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async _=>{this._debug("received broadcast notification from other tab or client",_),await this._notifyAllSubscribers(_.data.event,_.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${m5}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const i=zq(window.location.href);let a="none";if(this._isImplicitGrantCallback(i)?a="implicit":await this._isPKCECallback(i)&&(a="pkce"),Hl()&&this.detectSessionInUrl&&a!=="none"){const{data:d,error:_}=await this._getSessionFromURL(i,a);if(_){if(this._debug("#_initialize()","error detecting session from URL",_),Kq(_)){const k=(t=_.details)===null||t===void 0?void 0:t.code;if(k==="identity_already_exists"||k==="identity_not_found"||k==="single_identity_not_deletable")return{error:_}}return await this._removeSession(),{error:_}}const{session:b,redirectType:o}=d;return this._debug("#_initialize()","detected session in URL",b,"redirect type",o),await this._saveSession(b),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",b):await this._notifyAllSubscribers("SIGNED_IN",b)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return Sn(i)?{error:i}:{error:new v5("Unexpected error during initialization",i)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,a,d;try{const _=await Vn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(i=t==null?void 0:t.options)===null||i===void 0?void 0:i.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(d=t==null?void 0:t.options)===null||d===void 0?void 0:d.captchaToken}},xform:id}),{data:b,error:o}=_;if(o||!b)return{data:{user:null,session:null},error:o};const k=b.session,O=b.user;return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",k)),{data:{user:O,session:k},error:null}}catch(_){if(Sn(_))return{data:{user:null,session:null},error:_};throw _}}async signUp(t){var i,a,d;try{let _;if("email"in t){const{email:z,password:F,options:G}=t;let ee=null,J=null;this.flowType==="pkce"&&([ee,J]=await am(this.storage,this.storageKey)),_=await Vn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:G==null?void 0:G.emailRedirectTo,body:{email:z,password:F,data:(i=G==null?void 0:G.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:G==null?void 0:G.captchaToken},code_challenge:ee,code_challenge_method:J},xform:id})}else if("phone"in t){const{phone:z,password:F,options:G}=t;_=await Vn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:z,password:F,data:(a=G==null?void 0:G.data)!==null&&a!==void 0?a:{},channel:(d=G==null?void 0:G.channel)!==null&&d!==void 0?d:"sms",gotrue_meta_security:{captcha_token:G==null?void 0:G.captchaToken}},xform:id})}else throw new I1("You must provide either an email or phone number and a password");const{data:b,error:o}=_;if(o||!b)return{data:{user:null,session:null},error:o};const k=b.session,O=b.user;return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",k)),{data:{user:O,session:k},error:null}}catch(_){if(Sn(_))return{data:{user:null,session:null},error:_};throw _}}async signInWithPassword(t){try{let i;if("email"in t){const{email:_,password:b,options:o}=t;i=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:_,password:b,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:kD})}else if("phone"in t){const{phone:_,password:b,options:o}=t;i=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:_,password:b,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:kD})}else throw new I1("You must provide either an email or phone number and a password");const{data:a,error:d}=i;return d?{data:{user:null,session:null},error:d}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new IT}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:d})}catch(i){if(Sn(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOAuth(t){var i,a,d,_;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(d=t.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:(_=t.options)===null||_===void 0?void 0:_.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async _exchangeCodeForSession(t){const i=await P1(this.storage,`${this.storageKey}-code-verifier`),[a,d]=(i??"").split("/");try{const{data:_,error:b}=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:id});if(await A1(this.storage,`${this.storageKey}-code-verifier`),b)throw b;return!_||!_.session||!_.user?{data:{user:null,session:null,redirectType:null},error:new IT}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:Object.assign(Object.assign({},_),{redirectType:d??null}),error:b})}catch(_){if(Sn(_))return{data:{user:null,session:null,redirectType:null},error:_};throw _}}async signInWithIdToken(t){try{const{options:i,provider:a,token:d,access_token:_,nonce:b}=t,o=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:d,access_token:_,nonce:b,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:id}),{data:k,error:O}=o;return O?{data:{user:null,session:null},error:O}:!k||!k.session||!k.user?{data:{user:null,session:null},error:new IT}:(k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("SIGNED_IN",k.session)),{data:k,error:O})}catch(i){if(Sn(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOtp(t){var i,a,d,_,b;try{if("email"in t){const{email:o,options:k}=t;let O=null,z=null;this.flowType==="pkce"&&([O,z]=await am(this.storage,this.storageKey));const{error:F}=await Vn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(i=k==null?void 0:k.data)!==null&&i!==void 0?i:{},create_user:(a=k==null?void 0:k.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:k==null?void 0:k.captchaToken},code_challenge:O,code_challenge_method:z},redirectTo:k==null?void 0:k.emailRedirectTo});return{data:{user:null,session:null},error:F}}if("phone"in t){const{phone:o,options:k}=t,{data:O,error:z}=await Vn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(d=k==null?void 0:k.data)!==null&&d!==void 0?d:{},create_user:(_=k==null?void 0:k.shouldCreateUser)!==null&&_!==void 0?_:!0,gotrue_meta_security:{captcha_token:k==null?void 0:k.captchaToken},channel:(b=k==null?void 0:k.channel)!==null&&b!==void 0?b:"sms"}});return{data:{user:null,session:null,messageId:O==null?void 0:O.message_id},error:z}}throw new I1("You must provide either an email or phone number.")}catch(o){if(Sn(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var i,a;try{let d,_;"options"in t&&(d=(i=t.options)===null||i===void 0?void 0:i.redirectTo,_=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:b,error:o}=await Vn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:_}}),redirectTo:d,xform:id});if(o)throw o;if(!b)throw new Error("An error occurred on token verification.");const k=b.session,O=b.user;return k!=null&&k.access_token&&(await this._saveSession(k),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",k)),{data:{user:O,session:k},error:null}}catch(d){if(Sn(d))return{data:{user:null,session:null},error:d};throw d}}async signInWithSSO(t){var i,a,d;try{let _=null,b=null;return this.flowType==="pkce"&&([_,b]=await am(this.storage,this.storageKey)),await Vn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&a!==void 0?a:void 0}),!((d=t==null?void 0:t.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:_,code_challenge_method:b}),headers:this.headers,xform:rW})}catch(_){if(Sn(_))return{data:null,error:_};throw _}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;if(a)throw a;if(!i)throw new nd;const{error:d}=await Vn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:d}})}catch(t){if(Sn(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:a,type:d,options:_}=t,{error:b}=await Vn(this.fetch,"POST",i,{headers:this.headers,body:{email:a,type:d,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken}},redirectTo:_==null?void 0:_.emailRedirectTo});return{data:{user:null,session:null},error:b}}else if("phone"in t){const{phone:a,type:d,options:_}=t,{data:b,error:o}=await Vn(this.fetch,"POST",i,{headers:this.headers,body:{phone:a,type:d,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken}}});return{data:{user:null,session:null,messageId:b==null?void 0:b.message_id},error:o}}throw new I1("You must provide either an email or phone number and a type")}catch(i){if(Sn(i))return{data:{user:null,session:null},error:i};throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),d=(async()=>(await a,await i()))();return this.pendingInLock.push((async()=>{try{await d}catch{}})()),d}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=i();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const d=[...this.pendingInLock];await Promise.all(d),this.pendingInLock.splice(0,d.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await P1(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.storage.isServer){let b=this.suppressGetSessionWarning;t=new Proxy(t,{get:(k,O,z)=>(!b&&O==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),b=!0,this.suppressGetSessionWarning=!0),Reflect.get(k,O,z))})}return{data:{session:t},error:null}}const{session:d,error:_}=await this._callRefreshToken(t.refresh_token);return _?{data:{session:null},error:_}:{data:{session:d},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await Vn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:dd}):await this._useSession(async i=>{var a,d,_;const{data:b,error:o}=i;if(o)throw o;return!(!((a=b.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new nd}:await Vn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(_=(d=b.session)===null||d===void 0?void 0:d.access_token)!==null&&_!==void 0?_:void 0,xform:dd})})}catch(i){if(Sn(i))return Xq(i)&&(await this._removeSession(),await A1(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:i};throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async a=>{const{data:d,error:_}=a;if(_)throw _;if(!d.session)throw new nd;const b=d.session;let o=null,k=null;this.flowType==="pkce"&&t.email!=null&&([o,k]=await am(this.storage,this.storageKey));const{data:O,error:z}=await Vn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i==null?void 0:i.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:k}),jwt:b.access_token,xform:dd});if(z)throw z;return b.user=O.user,await this._saveSession(b),await this._notifyAllSubscribers("USER_UPDATED",b),{data:{user:b.user},error:null}})}catch(a){if(Sn(a))return{data:{user:null},error:a};throw a}}_decodeJWT(t){return MD(t)}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new nd;const i=Date.now()/1e3;let a=i,d=!0,_=null;const b=MD(t.access_token);if(b.exp&&(a=b.exp,d=a<=i),d){const{session:o,error:k}=await this._callRefreshToken(t.refresh_token);if(k)return{data:{user:null,session:null},error:k};if(!o)return{data:{user:null,session:null},error:null};_=o}else{const{data:o,error:k}=await this._getUser(t.access_token);if(k)throw k;_={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:a-i,expires_at:a},await this._saveSession(_),await this._notifyAllSubscribers("SIGNED_IN",_)}return{data:{user:_.user,session:_},error:null}}catch(i){if(Sn(i))return{data:{session:null,user:null},error:i};throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var a;if(!t){const{data:b,error:o}=i;if(o)throw o;t=(a=b.session)!==null&&a!==void 0?a:void 0}if(!(t!=null&&t.refresh_token))throw new nd;const{session:d,error:_}=await this._callRefreshToken(t.refresh_token);return _?{data:{user:null,session:null},error:_}:d?{data:{user:d.user,session:d},error:null}:{data:{user:null,session:null},error:null}})}catch(i){if(Sn(i))return{data:{user:null,session:null},error:i};throw i}}async _getSessionFromURL(t,i){try{if(!Hl())throw new k1("No browser detected.");if(t.error||t.error_description||t.error_code)throw new k1(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new PD("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new k1("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new PD("No code detected.");const{data:Q,error:ue}=await this._exchangeCodeForSession(t.code);if(ue)throw ue;const he=new URL(window.location.href);return he.searchParams.delete("code"),window.history.replaceState(window.history.state,"",he.toString()),{data:{session:Q.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:d,access_token:_,refresh_token:b,expires_in:o,expires_at:k,token_type:O}=t;if(!_||!o||!b||!O)throw new k1("No session defined in URL");const z=Math.round(Date.now()/1e3),F=parseInt(o);let G=z+F;k&&(G=parseInt(k));const ee=G-z;ee*1e3<=My&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${ee}s, should have been closer to ${F}s`);const J=G-F;z-J>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",J,G,z):z-J<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",J,G,z);const{data:te,error:oe}=await this._getUser(_);if(oe)throw oe;const X={provider_token:a,provider_refresh_token:d,access_token:_,expires_in:F,expires_at:G,refresh_token:b,token_type:O,user:te.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:X,redirectType:t.type},error:null}}catch(a){if(Sn(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await P1(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var a;const{data:d,error:_}=i;if(_)return{error:_};const b=(a=d.session)===null||a===void 0?void 0:a.access_token;if(b){const{error:o}=await this.admin.signOut(b,t);if(o&&!(Yq(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return t!=="others"&&(await this._removeSession(),await A1(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const i=Oq(),a={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async i=>{var a,d;try{const{data:{session:_},error:b}=i;if(b)throw b;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",_)),this._debug("INITIAL_SESSION","callback id",t,"session",_)}catch(_){await((d=this.stateChangeEmitters.get(t))===null||d===void 0?void 0:d.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",_),console.error(_)}})}async resetPasswordForEmail(t,i={}){let a=null,d=null;this.flowType==="pkce"&&([a,d]=await am(this.storage,this.storageKey,!0));try{return await Vn(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:d,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(_){if(Sn(_))return{data:null,error:_};throw _}}async getUserIdentities(){var t;try{const{data:i,error:a}=await this.getUser();if(a)throw a;return{data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(i){if(Sn(i))return{data:null,error:i};throw i}}async linkIdentity(t){var i;try{const{data:a,error:d}=await this._useSession(async _=>{var b,o,k,O,z;const{data:F,error:G}=_;if(G)throw G;const ee=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(b=t.options)===null||b===void 0?void 0:b.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(k=t.options)===null||k===void 0?void 0:k.queryParams,skipBrowserRedirect:!0});return await Vn(this.fetch,"GET",ee,{headers:this.headers,jwt:(z=(O=F.session)===null||O===void 0?void 0:O.access_token)!==null&&z!==void 0?z:void 0})});if(d)throw d;return Hl()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(a==null?void 0:a.url),{data:{provider:t.provider,url:a==null?void 0:a.url},error:null}}catch(a){if(Sn(a))return{data:{provider:t.provider,url:null},error:a};throw a}}async unlinkIdentity(t){try{return await this._useSession(async i=>{var a,d;const{data:_,error:b}=i;if(b)throw b;return await Vn(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(d=(a=_.session)===null||a===void 0?void 0:a.access_token)!==null&&d!==void 0?d:void 0})})}catch(i){if(Sn(i))return{data:null,error:i};throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const a=Date.now();return await Bq(async d=>(d>0&&await jq(200*Math.pow(2,d-1)),this._debug(i,"refreshing attempt",d),await Vn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:id})),(d,_)=>{const b=200*Math.pow(2,d);return _&&kT(_)&&Date.now()+b-a<My})}catch(a){if(this._debug(i,"error",a),Sn(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",a),Hl()&&!i.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const a=await P1(this.storage,this.storageKey);if(this._debug(i,"session from storage",a),!this._isValidSession(a)){this._debug(i,"session is not valid"),a!==null&&await this._removeSession();return}const d=Math.round(Date.now()/1e3),_=((t=a.expires_at)!==null&&t!==void 0?t:1/0)<d+CD;if(this._debug(i,`session has${_?"":" not"} expired with margin of ${CD}s`),_){if(this.autoRefreshToken&&a.refresh_token){const{error:b}=await this._callRefreshToken(a.refresh_token);b&&(console.error(b),kT(b)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",b),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(i,"error",a),console.error(a);return}finally{this._debug(i,"end")}}async _callRefreshToken(t){var i,a;if(!t)throw new nd;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const d=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(d,"begin");try{this.refreshingDeferred=new Aw;const{data:_,error:b}=await this._refreshAccessToken(t);if(b)throw b;if(!_.session)throw new nd;await this._saveSession(_.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",_.session);const o={session:_.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(_){if(this._debug(d,"error",_),Sn(_)){const b={session:null,error:_};return kT(_)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(b),b}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(_),_}finally{this.refreshingDeferred=null,this._debug(d,"end")}}async _notifyAllSubscribers(t,i,a=!0){const d=`#_notifyAllSubscribers(${t})`;this._debug(d,"begin",i,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:i});const _=[],b=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,i)}catch(k){_.push(k)}});if(await Promise.all(b),_.length>0){for(let o=0;o<_.length;o+=1)console.error(_[o]);throw _[0]}}finally{this._debug(d,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await y5(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await A1(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Hl()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),My);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:a}}=i;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const d=Math.floor((a.expires_at*1e3-t)/My);this._debug("#_autoRefreshTokenTick()",`access token expires in ${d} ticks, a tick lasts ${My}ms, refresh threshold is ${DD} ticks`),d<=DD&&await this._callRefreshToken(a.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof x5)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Hl()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,a){const d=[`provider=${encodeURIComponent(i)}`];if(a!=null&&a.redirectTo&&d.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a!=null&&a.scopes&&d.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[_,b]=await am(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(_)}`,code_challenge_method:`${encodeURIComponent(b)}`});d.push(o.toString())}if(a!=null&&a.queryParams){const _=new URLSearchParams(a.queryParams);d.push(_.toString())}return a!=null&&a.skipBrowserRedirect&&d.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${d.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var a;const{data:d,error:_}=i;return _?{data:null,error:_}:await Vn(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token})})}catch(i){if(Sn(i))return{data:null,error:i};throw i}}async _enroll(t){try{return await this._useSession(async i=>{var a,d;const{data:_,error:b}=i;if(b)return{data:null,error:b};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:k,error:O}=await Vn(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(a=_==null?void 0:_.session)===null||a===void 0?void 0:a.access_token});return O?{data:null,error:O}:(t.factorType==="totp"&&(!((d=k==null?void 0:k.totp)===null||d===void 0)&&d.qr_code)&&(k.totp.qr_code=`data:image/svg+xml;utf-8,${k.totp.qr_code}`),{data:k,error:null})})}catch(i){if(Sn(i))return{data:null,error:i};throw i}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:d,error:_}=i;if(_)return{data:null,error:_};const{data:b,error:o}=await Vn(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+b.expires_in},b)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",b),{data:b,error:o})})}catch(i){if(Sn(i))return{data:null,error:i};throw i}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:d,error:_}=i;return _?{data:null,error:_}:await Vn(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token})})}catch(i){if(Sn(i))return{data:null,error:i};throw i}})}async _challengeAndVerify(t){const{data:i,error:a}=await this._challenge({factorId:t.factorId});return a?{data:null,error:a}:await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){const{data:{user:t},error:i}=await this.getUser();if(i)return{data:null,error:i};const a=(t==null?void 0:t.factors)||[],d=a.filter(b=>b.factor_type==="totp"&&b.status==="verified"),_=a.filter(b=>b.factor_type==="phone"&&b.status==="verified");return{data:{all:a,totp:d,phone:_},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var i,a;const{data:{session:d},error:_}=t;if(_)return{data:null,error:_};if(!d)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const b=this._decodeJWT(d.access_token);let o=null;b.aal&&(o=b.aal);let k=o;((a=(i=d.user.factors)===null||i===void 0?void 0:i.filter(F=>F.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(k="aal2");const z=b.amr||[];return{data:{currentLevel:o,nextLevel:k,currentAuthenticationMethods:z},error:null}}))}}E0.nextInstanceID=0;const fW=E0;class pW extends fW{constructor(t){super(t)}}var mW=function(e,t,i,a){function d(_){return _ instanceof i?_:new i(function(b){b(_)})}return new(i||(i=Promise))(function(_,b){function o(z){try{O(a.next(z))}catch(F){b(F)}}function k(z){try{O(a.throw(z))}catch(F){b(F)}}function O(z){z.done?_(z.value):d(z.value).then(o,k)}O((a=a.apply(e,t||[])).next())})};class gW{constructor(t,i,a){var d,_,b;if(this.supabaseUrl=t,this.supabaseKey=i,!t)throw new Error("supabaseUrl is required.");if(!i)throw new Error("supabaseKey is required.");const o=Aq(t);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const k=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,O={db:bq,realtime:Sq,auth:Object.assign(Object.assign({},wq),{storageKey:k}),global:xq},z=Iq(a??{},O);this.storageKey=(d=z.auth.storageKey)!==null&&d!==void 0?d:"",this.headers=(_=z.global.headers)!==null&&_!==void 0?_:{},z.accessToken?(this.accessToken=z.accessToken,this.auth=new Proxy({},{get:(F,G)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(G)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((b=z.auth)!==null&&b!==void 0?b:{},this.headers,z.global.fetch),this.fetch=Mq(i,this._getAccessToken.bind(this),z.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},z.realtime)),this.rest=new VH(`${o}/rest/v1`,{headers:this.headers,schema:z.db.schema,fetch:this.fetch}),z.accessToken||this._listenForAuthEvents()}get functions(){return new yH(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new _q(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,i={},a={}){return this.rest.rpc(t,i,a)}channel(t,i={config:{}}){return this.realtime.channel(t,i)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,i;return mW(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:a}=yield this.auth.getSession();return(i=(t=a.session)===null||t===void 0?void 0:t.access_token)!==null&&i!==void 0?i:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:a,storage:d,storageKey:_,flowType:b,lock:o,debug:k},O,z){var F;const G={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new pW({url:this.authUrl,headers:Object.assign(Object.assign({},G),O),storageKey:_,autoRefreshToken:t,persistSession:i,detectSessionInUrl:a,storage:d,flowType:b,lock:o,debug:k,fetch:z,hasCustomAuthorizationHeader:(F="Authorization"in this.headers)!==null&&F!==void 0?F:!1})}_initRealtimeClient(t){return new nq(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,a)=>{this._handleTokenChanged(i,"CLIENT",a==null?void 0:a.access_token)})}_handleTokenChanged(t,i,a){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==a?this.changedAccessToken=a:t==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const _W=(e,t,i)=>new gW(e,t,i),yW="https://putjowciegpzdheideaf.supabase.co",vW="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB1dGpvd2NpZWdwemRoZWlkZWFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ5NTQ5MTQsImV4cCI6MjA1MDUzMDkxNH0.p3UPDQc4Y9r1BbMB4cPssPKNvoj5fbf9b9M40x6724o",Qt=_W(yW,vW),RT=10,xW=async({pageParam:e=0,filters:t,searchParams:i})=>{console.log("Starting car fetch with params:",{pageParam:e,filters:t,searchParams:i});let a=Qt.from("cars").select("*",{count:"exact"});a=a.range(e*RT,(e+1)*RT-1),i!=null&&i.searchTerm&&(console.log("Applying search term:",i.searchTerm),a=a.or(`brand.ilike.%${i.searchTerm}%,model.ilike.%${i.searchTerm}%`)),i!=null&&i.brand&&(console.log("Filtering by brand:",i.brand),a=a.eq("brand",i.brand)),t!=null&&t.model&&(a=a.ilike("model",`%${t.model}%`)),t!=null&&t.year&&(a=a.eq("year",t.year)),t!=null&&t.minPrice&&(a=a.gte("price_per_day",t.minPrice)),t!=null&&t.maxPrice&&(a=a.lte("price_per_day",t.maxPrice)),t!=null&&t.vehicleType&&(a=a.eq("vehicle_type",t.vehicleType)),t!=null&&t.location&&(a=a.ilike("location",`%${t.location}%`)),(t==null?void 0:t.sortBy)==="price"&&(a=a.order("price_per_day",{ascending:t.sortOrder==="asc"})),console.log("Executing Supabase query...");const{data:d,error:_,count:b}=await a;if(_)throw console.error("Error fetching cars:",_),_;return console.log("Cars fetched successfully:",{count:b,dataLength:d==null?void 0:d.length}),{data:d||[],nextPage:d&&d.length===RT?e+1:void 0,count:b}};function Fr(e,t,{checkForDefaultPrevented:i=!0}={}){return function(d){if(e==null||e(d),i===!1||!d.defaultPrevented)return t==null?void 0:t(d)}}function bW(e,t){const i=Y.createContext(t),a=_=>{const{children:b,...o}=_,k=Y.useMemo(()=>o,Object.values(o));return L.jsx(i.Provider,{value:k,children:b})};a.displayName=e+"Provider";function d(_){const b=Y.useContext(i);if(b)return b;if(t!==void 0)return t;throw new Error(`\`${_}\` must be used within \`${e}\``)}return[a,d]}function Rf(e,t=[]){let i=[];function a(_,b){const o=Y.createContext(b),k=i.length;i=[...i,b];const O=F=>{var X;const{scope:G,children:ee,...J}=F,te=((X=G==null?void 0:G[e])==null?void 0:X[k])||o,oe=Y.useMemo(()=>J,Object.values(J));return L.jsx(te.Provider,{value:oe,children:ee})};O.displayName=_+"Provider";function z(F,G){var te;const ee=((te=G==null?void 0:G[e])==null?void 0:te[k])||o,J=Y.useContext(ee);if(J)return J;if(b!==void 0)return b;throw new Error(`\`${F}\` must be used within \`${_}\``)}return[O,z]}const d=()=>{const _=i.map(b=>Y.createContext(b));return function(o){const k=(o==null?void 0:o[e])||_;return Y.useMemo(()=>({[`__scope${e}`]:{...o,[e]:k}}),[o,k])}};return d.scopeName=e,[a,wW(d,...t)]}function wW(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(_){const b=a.reduce((o,{useScope:k,scopeName:O})=>{const F=k(_)[`__scope${O}`];return{...o,...F}},{});return Y.useMemo(()=>({[`__scope${t.scopeName}`]:b}),[b])}};return i.scopeName=t.scopeName,i}var Do=globalThis!=null&&globalThis.document?Y.useLayoutEffect:()=>{},SW=nL.useId||(()=>{}),TW=0;function Wc(e){const[t,i]=Y.useState(SW());return Do(()=>{i(a=>a??String(TW++))},[e]),t?`radix-${t}`:""}function Io(e){const t=Y.useRef(e);return Y.useEffect(()=>{t.current=e}),Y.useMemo(()=>(...i)=>{var a;return(a=t.current)==null?void 0:a.call(t,...i)},[])}function wf({prop:e,defaultProp:t,onChange:i=()=>{}}){const[a,d]=EW({defaultProp:t,onChange:i}),_=e!==void 0,b=_?e:a,o=Io(i),k=Y.useCallback(O=>{if(_){const F=typeof O=="function"?O(e):O;F!==e&&o(F)}else d(O)},[_,e,d,o]);return[b,k]}function EW({defaultProp:e,onChange:t}){const i=Y.useState(e),[a]=i,d=Y.useRef(a),_=Io(t);return Y.useEffect(()=>{d.current!==a&&(_(a),d.current=a)},[a,d,_]),i}var CW=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ln=CW.reduce((e,t)=>{const i=Y.forwardRef((a,d)=>{const{asChild:_,...b}=a,o=_?eu:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),L.jsx(o,{...b,ref:d})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{});function MW(e,t){e&&xg.flushSync(()=>e.dispatchEvent(t))}function PW(e,t=globalThis==null?void 0:globalThis.document){const i=Io(e);Y.useEffect(()=>{const a=d=>{d.key==="Escape"&&i(d)};return t.addEventListener("keydown",a,{capture:!0}),()=>t.removeEventListener("keydown",a,{capture:!0})},[i,t])}var AW="DismissableLayer",IC="dismissableLayer.update",IW="dismissableLayer.pointerDownOutside",kW="dismissableLayer.focusOutside",OD,b5=Y.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),K0=Y.forwardRef((e,t)=>{const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:a,onPointerDownOutside:d,onFocusOutside:_,onInteractOutside:b,onDismiss:o,...k}=e,O=Y.useContext(b5),[z,F]=Y.useState(null),G=(z==null?void 0:z.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ee]=Y.useState({}),J=Qn(t,Ce=>F(Ce)),te=Array.from(O.layers),[oe]=[...O.layersWithOutsidePointerEventsDisabled].slice(-1),X=te.indexOf(oe),Q=z?te.indexOf(z):-1,ue=O.layersWithOutsidePointerEventsDisabled.size>0,he=Q>=X,Ie=LW(Ce=>{const Ze=Ce.target,et=[...O.branches].some(Ge=>Ge.contains(Ze));!he||et||(d==null||d(Ce),b==null||b(Ce),Ce.defaultPrevented||o==null||o())},G),Je=OW(Ce=>{const Ze=Ce.target;[...O.branches].some(Ge=>Ge.contains(Ze))||(_==null||_(Ce),b==null||b(Ce),Ce.defaultPrevented||o==null||o())},G);return PW(Ce=>{Q===O.layers.size-1&&(a==null||a(Ce),!Ce.defaultPrevented&&o&&(Ce.preventDefault(),o()))},G),Y.useEffect(()=>{if(z)return i&&(O.layersWithOutsidePointerEventsDisabled.size===0&&(OD=G.body.style.pointerEvents,G.body.style.pointerEvents="none"),O.layersWithOutsidePointerEventsDisabled.add(z)),O.layers.add(z),zD(),()=>{i&&O.layersWithOutsidePointerEventsDisabled.size===1&&(G.body.style.pointerEvents=OD)}},[z,G,i,O]),Y.useEffect(()=>()=>{z&&(O.layers.delete(z),O.layersWithOutsidePointerEventsDisabled.delete(z),zD())},[z,O]),Y.useEffect(()=>{const Ce=()=>ee({});return document.addEventListener(IC,Ce),()=>document.removeEventListener(IC,Ce)},[]),L.jsx(ln.div,{...k,ref:J,style:{pointerEvents:ue?he?"auto":"none":void 0,...e.style},onFocusCapture:Fr(e.onFocusCapture,Je.onFocusCapture),onBlurCapture:Fr(e.onBlurCapture,Je.onBlurCapture),onPointerDownCapture:Fr(e.onPointerDownCapture,Ie.onPointerDownCapture)})});K0.displayName=AW;var RW="DismissableLayerBranch",DW=Y.forwardRef((e,t)=>{const i=Y.useContext(b5),a=Y.useRef(null),d=Qn(t,a);return Y.useEffect(()=>{const _=a.current;if(_)return i.branches.add(_),()=>{i.branches.delete(_)}},[i.branches]),L.jsx(ln.div,{...e,ref:d})});DW.displayName=RW;function LW(e,t=globalThis==null?void 0:globalThis.document){const i=Io(e),a=Y.useRef(!1),d=Y.useRef(()=>{});return Y.useEffect(()=>{const _=o=>{if(o.target&&!a.current){let k=function(){w5(IW,i,O,{discrete:!0})};const O={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",d.current),d.current=k,t.addEventListener("click",d.current,{once:!0})):k()}else t.removeEventListener("click",d.current);a.current=!1},b=window.setTimeout(()=>{t.addEventListener("pointerdown",_)},0);return()=>{window.clearTimeout(b),t.removeEventListener("pointerdown",_),t.removeEventListener("click",d.current)}},[t,i]),{onPointerDownCapture:()=>a.current=!0}}function OW(e,t=globalThis==null?void 0:globalThis.document){const i=Io(e),a=Y.useRef(!1);return Y.useEffect(()=>{const d=_=>{_.target&&!a.current&&w5(kW,i,{originalEvent:_},{discrete:!1})};return t.addEventListener("focusin",d),()=>t.removeEventListener("focusin",d)},[t,i]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function zD(){const e=new CustomEvent(IC);document.dispatchEvent(e)}function w5(e,t,i,{discrete:a}){const d=i.originalEvent.target,_=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:i});t&&d.addEventListener(e,t,{once:!0}),a?MW(d,_):d.dispatchEvent(_)}var DT="focusScope.autoFocusOnMount",LT="focusScope.autoFocusOnUnmount",ND={bubbles:!1,cancelable:!0},zW="FocusScope",Iw=Y.forwardRef((e,t)=>{const{loop:i=!1,trapped:a=!1,onMountAutoFocus:d,onUnmountAutoFocus:_,...b}=e,[o,k]=Y.useState(null),O=Io(d),z=Io(_),F=Y.useRef(null),G=Qn(t,te=>k(te)),ee=Y.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Y.useEffect(()=>{if(a){let te=function(ue){if(ee.paused||!o)return;const he=ue.target;o.contains(he)?F.current=he:od(F.current,{select:!0})},oe=function(ue){if(ee.paused||!o)return;const he=ue.relatedTarget;he!==null&&(o.contains(he)||od(F.current,{select:!0}))},X=function(ue){if(document.activeElement===document.body)for(const Ie of ue)Ie.removedNodes.length>0&&od(o)};document.addEventListener("focusin",te),document.addEventListener("focusout",oe);const Q=new MutationObserver(X);return o&&Q.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",te),document.removeEventListener("focusout",oe),Q.disconnect()}}},[a,o,ee.paused]),Y.useEffect(()=>{if(o){jD.add(ee);const te=document.activeElement;if(!o.contains(te)){const X=new CustomEvent(DT,ND);o.addEventListener(DT,O),o.dispatchEvent(X),X.defaultPrevented||(NW(VW(S5(o)),{select:!0}),document.activeElement===te&&od(o))}return()=>{o.removeEventListener(DT,O),setTimeout(()=>{const X=new CustomEvent(LT,ND);o.addEventListener(LT,z),o.dispatchEvent(X),X.defaultPrevented||od(te??document.body,{select:!0}),o.removeEventListener(LT,z),jD.remove(ee)},0)}}},[o,O,z,ee]);const J=Y.useCallback(te=>{if(!i&&!a||ee.paused)return;const oe=te.key==="Tab"&&!te.altKey&&!te.ctrlKey&&!te.metaKey,X=document.activeElement;if(oe&&X){const Q=te.currentTarget,[ue,he]=FW(Q);ue&&he?!te.shiftKey&&X===he?(te.preventDefault(),i&&od(ue,{select:!0})):te.shiftKey&&X===ue&&(te.preventDefault(),i&&od(he,{select:!0})):X===Q&&te.preventDefault()}},[i,a,ee.paused]);return L.jsx(ln.div,{tabIndex:-1,...b,ref:G,onKeyDown:J})});Iw.displayName=zW;function NW(e,{select:t=!1}={}){const i=document.activeElement;for(const a of e)if(od(a,{select:t}),document.activeElement!==i)return}function FW(e){const t=S5(e),i=FD(t,e),a=FD(t.reverse(),e);return[i,a]}function S5(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const d=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||d?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function FD(e,t){for(const i of e)if(!jW(i,{upTo:t}))return i}function jW(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function BW(e){return e instanceof HTMLInputElement&&"select"in e}function od(e,{select:t=!1}={}){if(e&&e.focus){const i=document.activeElement;e.focus({preventScroll:!0}),e!==i&&BW(e)&&t&&e.select()}}var jD=UW();function UW(){let e=[];return{add(t){const i=e[0];t!==i&&(i==null||i.pause()),e=BD(e,t),e.unshift(t)},remove(t){var i;e=BD(e,t),(i=e[0])==null||i.resume()}}}function BD(e,t){const i=[...e],a=i.indexOf(t);return a!==-1&&i.splice(a,1),i}function VW(e){return e.filter(t=>t.tagName!=="A")}var $W="Portal",kw=Y.forwardRef((e,t)=>{var o;const{container:i,...a}=e,[d,_]=Y.useState(!1);Do(()=>_(!0),[]);const b=i||d&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return b?h7.createPortal(L.jsx(ln.div,{...a,ref:t}),b):null});kw.displayName=$W;function GW(e,t){return Y.useReducer((i,a)=>t[i][a]??i,e)}var Ra=e=>{const{present:t,children:i}=e,a=HW(t),d=typeof i=="function"?i({present:a.isPresent}):Y.Children.only(i),_=Qn(a.ref,qW(d));return typeof i=="function"||a.isPresent?Y.cloneElement(d,{ref:_}):null};Ra.displayName="Presence";function HW(e){const[t,i]=Y.useState(),a=Y.useRef({}),d=Y.useRef(e),_=Y.useRef("none"),b=e?"mounted":"unmounted",[o,k]=GW(b,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Y.useEffect(()=>{const O=R1(a.current);_.current=o==="mounted"?O:"none"},[o]),Do(()=>{const O=a.current,z=d.current;if(z!==e){const G=_.current,ee=R1(O);e?k("MOUNT"):ee==="none"||(O==null?void 0:O.display)==="none"?k("UNMOUNT"):k(z&&G!==ee?"ANIMATION_OUT":"UNMOUNT"),d.current=e}},[e,k]),Do(()=>{if(t){let O;const z=t.ownerDocument.defaultView??window,F=ee=>{const te=R1(a.current).includes(ee.animationName);if(ee.target===t&&te&&(k("ANIMATION_END"),!d.current)){const oe=t.style.animationFillMode;t.style.animationFillMode="forwards",O=z.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=oe)})}},G=ee=>{ee.target===t&&(_.current=R1(a.current))};return t.addEventListener("animationstart",G),t.addEventListener("animationcancel",F),t.addEventListener("animationend",F),()=>{z.clearTimeout(O),t.removeEventListener("animationstart",G),t.removeEventListener("animationcancel",F),t.removeEventListener("animationend",F)}}else k("ANIMATION_END")},[t,k]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:Y.useCallback(O=>{O&&(a.current=getComputedStyle(O)),i(O)},[])}}function R1(e){return(e==null?void 0:e.animationName)||"none"}function qW(e){var a,d;let t=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(d=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:d.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var OT=0;function uM(){Y.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??UD()),document.body.insertAdjacentElement("beforeend",e[1]??UD()),OT++,()=>{OT===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),OT--}},[])}function UD(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Jl=function(){return Jl=Object.assign||function(t){for(var i,a=1,d=arguments.length;a<d;a++){i=arguments[a];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(t[_]=i[_])}return t},Jl.apply(this,arguments)};function T5(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(e);d<a.length;d++)t.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(e,a[d])&&(i[a[d]]=e[a[d]]);return i}function WW(e,t,i){if(i||arguments.length===2)for(var a=0,d=t.length,_;a<d;a++)(_||!(a in t))&&(_||(_=Array.prototype.slice.call(t,0,a)),_[a]=t[a]);return e.concat(_||Array.prototype.slice.call(t))}var Q1="right-scroll-bar-position",eb="width-before-scroll-bar",ZW="with-scroll-bars-hidden",YW="--removed-body-scroll-bar-size";function zT(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function XW(e,t){var i=Y.useState(function(){return{value:e,callback:t,facade:{get current(){return i.value},set current(a){var d=i.value;d!==a&&(i.value=a,i.callback(a,d))}}}})[0];return i.callback=t,i.facade}var KW=typeof window<"u"?Y.useLayoutEffect:Y.useEffect,VD=new WeakMap;function JW(e,t){var i=XW(null,function(a){return e.forEach(function(d){return zT(d,a)})});return KW(function(){var a=VD.get(i);if(a){var d=new Set(a),_=new Set(e),b=i.current;d.forEach(function(o){_.has(o)||zT(o,null)}),_.forEach(function(o){d.has(o)||zT(o,b)})}VD.set(i,e)},[e]),i}function QW(e){return e}function eZ(e,t){t===void 0&&(t=QW);var i=[],a=!1,d={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:e},useMedium:function(_){var b=t(_,a);return i.push(b),function(){i=i.filter(function(o){return o!==b})}},assignSyncMedium:function(_){for(a=!0;i.length;){var b=i;i=[],b.forEach(_)}i={push:function(o){return _(o)},filter:function(){return i}}},assignMedium:function(_){a=!0;var b=[];if(i.length){var o=i;i=[],o.forEach(_),b=i}var k=function(){var z=b;b=[],z.forEach(_)},O=function(){return Promise.resolve().then(k)};O(),i={push:function(z){b.push(z),O()},filter:function(z){return b=b.filter(z),i}}}};return d}function tZ(e){e===void 0&&(e={});var t=eZ(null);return t.options=Jl({async:!0,ssr:!1},e),t}var E5=function(e){var t=e.sideCar,i=T5(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return Y.createElement(a,Jl({},i))};E5.isSideCarExport=!0;function rZ(e,t){return e.useMedium(t),E5}var C5=tZ(),NT=function(){},Rw=Y.forwardRef(function(e,t){var i=Y.useRef(null),a=Y.useState({onScrollCapture:NT,onWheelCapture:NT,onTouchMoveCapture:NT}),d=a[0],_=a[1],b=e.forwardProps,o=e.children,k=e.className,O=e.removeScrollBar,z=e.enabled,F=e.shards,G=e.sideCar,ee=e.noIsolation,J=e.inert,te=e.allowPinchZoom,oe=e.as,X=oe===void 0?"div":oe,Q=e.gapMode,ue=T5(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),he=G,Ie=JW([i,t]),Je=Jl(Jl({},ue),d);return Y.createElement(Y.Fragment,null,z&&Y.createElement(he,{sideCar:C5,removeScrollBar:O,shards:F,noIsolation:ee,inert:J,setCallbacks:_,allowPinchZoom:!!te,lockRef:i,gapMode:Q}),b?Y.cloneElement(Y.Children.only(o),Jl(Jl({},Je),{ref:Ie})):Y.createElement(X,Jl({},Je,{className:k,ref:Ie}),o))});Rw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Rw.classNames={fullWidth:eb,zeroRight:Q1};var nZ=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function iZ(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=nZ();return t&&e.setAttribute("nonce",t),e}function oZ(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function sZ(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var aZ=function(){var e=0,t=null;return{add:function(i){e==0&&(t=iZ())&&(oZ(t,i),sZ(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},lZ=function(){var e=aZ();return function(t,i){Y.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&i])}},M5=function(){var e=lZ(),t=function(i){var a=i.styles,d=i.dynamic;return e(a,d),null};return t},cZ={left:0,top:0,right:0,gap:0},FT=function(e){return parseInt(e||"",10)||0},uZ=function(e){var t=window.getComputedStyle(document.body),i=t[e==="padding"?"paddingLeft":"marginLeft"],a=t[e==="padding"?"paddingTop":"marginTop"],d=t[e==="padding"?"paddingRight":"marginRight"];return[FT(i),FT(a),FT(d)]},dZ=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return cZ;var t=uZ(e),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-i+t[2]-t[0])}},hZ=M5(),Bm="data-scroll-locked",fZ=function(e,t,i,a){var d=e.left,_=e.top,b=e.right,o=e.gap;return i===void 0&&(i="margin"),`
  .`.concat(ZW,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(o,"px ").concat(a,`;
  }
  body[`).concat(Bm,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(d,`px;
    padding-top: `).concat(_,`px;
    padding-right: `).concat(b,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(o,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Q1,` {
    right: `).concat(o,"px ").concat(a,`;
  }
  
  .`).concat(eb,` {
    margin-right: `).concat(o,"px ").concat(a,`;
  }
  
  .`).concat(Q1," .").concat(Q1,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(eb," .").concat(eb,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(Bm,`] {
    `).concat(YW,": ").concat(o,`px;
  }
`)},$D=function(){var e=parseInt(document.body.getAttribute(Bm)||"0",10);return isFinite(e)?e:0},pZ=function(){Y.useEffect(function(){return document.body.setAttribute(Bm,($D()+1).toString()),function(){var e=$D()-1;e<=0?document.body.removeAttribute(Bm):document.body.setAttribute(Bm,e.toString())}},[])},mZ=function(e){var t=e.noRelative,i=e.noImportant,a=e.gapMode,d=a===void 0?"margin":a;pZ();var _=Y.useMemo(function(){return dZ(d)},[d]);return Y.createElement(hZ,{styles:fZ(_,!t,d,i?"":"!important")})},kC=!1;if(typeof window<"u")try{var D1=Object.defineProperty({},"passive",{get:function(){return kC=!0,!0}});window.addEventListener("test",D1,D1),window.removeEventListener("test",D1,D1)}catch{kC=!1}var cm=kC?{passive:!1}:!1,gZ=function(e){return e.tagName==="TEXTAREA"},P5=function(e,t){if(!(e instanceof Element))return!1;var i=window.getComputedStyle(e);return i[t]!=="hidden"&&!(i.overflowY===i.overflowX&&!gZ(e)&&i[t]==="visible")},_Z=function(e){return P5(e,"overflowY")},yZ=function(e){return P5(e,"overflowX")},GD=function(e,t){var i=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var d=A5(e,a);if(d){var _=I5(e,a),b=_[1],o=_[2];if(b>o)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},vZ=function(e){var t=e.scrollTop,i=e.scrollHeight,a=e.clientHeight;return[t,i,a]},xZ=function(e){var t=e.scrollLeft,i=e.scrollWidth,a=e.clientWidth;return[t,i,a]},A5=function(e,t){return e==="v"?_Z(t):yZ(t)},I5=function(e,t){return e==="v"?vZ(t):xZ(t)},bZ=function(e,t){return e==="h"&&t==="rtl"?-1:1},wZ=function(e,t,i,a,d){var _=bZ(e,window.getComputedStyle(t).direction),b=_*a,o=i.target,k=t.contains(o),O=!1,z=b>0,F=0,G=0;do{var ee=I5(e,o),J=ee[0],te=ee[1],oe=ee[2],X=te-oe-_*J;(J||X)&&A5(e,o)&&(F+=X,G+=J),o instanceof ShadowRoot?o=o.host:o=o.parentNode}while(!k&&o!==document.body||k&&(t.contains(o)||t===o));return(z&&(Math.abs(F)<1||!d)||!z&&(Math.abs(G)<1||!d))&&(O=!0),O},L1=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},HD=function(e){return[e.deltaX,e.deltaY]},qD=function(e){return e&&"current"in e?e.current:e},SZ=function(e,t){return e[0]===t[0]&&e[1]===t[1]},TZ=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},EZ=0,um=[];function CZ(e){var t=Y.useRef([]),i=Y.useRef([0,0]),a=Y.useRef(),d=Y.useState(EZ++)[0],_=Y.useState(M5)[0],b=Y.useRef(e);Y.useEffect(function(){b.current=e},[e]),Y.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(d));var te=WW([e.lockRef.current],(e.shards||[]).map(qD),!0).filter(Boolean);return te.forEach(function(oe){return oe.classList.add("allow-interactivity-".concat(d))}),function(){document.body.classList.remove("block-interactivity-".concat(d)),te.forEach(function(oe){return oe.classList.remove("allow-interactivity-".concat(d))})}}},[e.inert,e.lockRef.current,e.shards]);var o=Y.useCallback(function(te,oe){if("touches"in te&&te.touches.length===2||te.type==="wheel"&&te.ctrlKey)return!b.current.allowPinchZoom;var X=L1(te),Q=i.current,ue="deltaX"in te?te.deltaX:Q[0]-X[0],he="deltaY"in te?te.deltaY:Q[1]-X[1],Ie,Je=te.target,Ce=Math.abs(ue)>Math.abs(he)?"h":"v";if("touches"in te&&Ce==="h"&&Je.type==="range")return!1;var Ze=GD(Ce,Je);if(!Ze)return!0;if(Ze?Ie=Ce:(Ie=Ce==="v"?"h":"v",Ze=GD(Ce,Je)),!Ze)return!1;if(!a.current&&"changedTouches"in te&&(ue||he)&&(a.current=Ie),!Ie)return!0;var et=a.current||Ie;return wZ(et,oe,te,et==="h"?ue:he,!0)},[]),k=Y.useCallback(function(te){var oe=te;if(!(!um.length||um[um.length-1]!==_)){var X="deltaY"in oe?HD(oe):L1(oe),Q=t.current.filter(function(Ie){return Ie.name===oe.type&&(Ie.target===oe.target||oe.target===Ie.shadowParent)&&SZ(Ie.delta,X)})[0];if(Q&&Q.should){oe.cancelable&&oe.preventDefault();return}if(!Q){var ue=(b.current.shards||[]).map(qD).filter(Boolean).filter(function(Ie){return Ie.contains(oe.target)}),he=ue.length>0?o(oe,ue[0]):!b.current.noIsolation;he&&oe.cancelable&&oe.preventDefault()}}},[]),O=Y.useCallback(function(te,oe,X,Q){var ue={name:te,delta:oe,target:X,should:Q,shadowParent:MZ(X)};t.current.push(ue),setTimeout(function(){t.current=t.current.filter(function(he){return he!==ue})},1)},[]),z=Y.useCallback(function(te){i.current=L1(te),a.current=void 0},[]),F=Y.useCallback(function(te){O(te.type,HD(te),te.target,o(te,e.lockRef.current))},[]),G=Y.useCallback(function(te){O(te.type,L1(te),te.target,o(te,e.lockRef.current))},[]);Y.useEffect(function(){return um.push(_),e.setCallbacks({onScrollCapture:F,onWheelCapture:F,onTouchMoveCapture:G}),document.addEventListener("wheel",k,cm),document.addEventListener("touchmove",k,cm),document.addEventListener("touchstart",z,cm),function(){um=um.filter(function(te){return te!==_}),document.removeEventListener("wheel",k,cm),document.removeEventListener("touchmove",k,cm),document.removeEventListener("touchstart",z,cm)}},[]);var ee=e.removeScrollBar,J=e.inert;return Y.createElement(Y.Fragment,null,J?Y.createElement(_,{styles:TZ(d)}):null,ee?Y.createElement(mZ,{gapMode:e.gapMode}):null)}function MZ(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const PZ=rZ(C5,CZ);var Dw=Y.forwardRef(function(e,t){return Y.createElement(Rw,Jl({},e,{ref:t,sideCar:PZ}))});Dw.classNames=Rw.classNames;var AZ=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},dm=new WeakMap,O1=new WeakMap,z1={},jT=0,k5=function(e){return e&&(e.host||k5(e.parentNode))},IZ=function(e,t){return t.map(function(i){if(e.contains(i))return i;var a=k5(i);return a&&e.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",e,". Doing nothing"),null)}).filter(function(i){return!!i})},kZ=function(e,t,i,a){var d=IZ(t,Array.isArray(e)?e:[e]);z1[i]||(z1[i]=new WeakMap);var _=z1[i],b=[],o=new Set,k=new Set(d),O=function(F){!F||o.has(F)||(o.add(F),O(F.parentNode))};d.forEach(O);var z=function(F){!F||k.has(F)||Array.prototype.forEach.call(F.children,function(G){if(o.has(G))z(G);else try{var ee=G.getAttribute(a),J=ee!==null&&ee!=="false",te=(dm.get(G)||0)+1,oe=(_.get(G)||0)+1;dm.set(G,te),_.set(G,oe),b.push(G),te===1&&J&&O1.set(G,!0),oe===1&&G.setAttribute(i,"true"),J||G.setAttribute(a,"true")}catch(X){console.error("aria-hidden: cannot operate on ",G,X)}})};return z(t),o.clear(),jT++,function(){b.forEach(function(F){var G=dm.get(F)-1,ee=_.get(F)-1;dm.set(F,G),_.set(F,ee),G||(O1.has(F)||F.removeAttribute(a),O1.delete(F)),ee||F.removeAttribute(i)}),jT--,jT||(dm=new WeakMap,dm=new WeakMap,O1=new WeakMap,z1={})}},dM=function(e,t,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(e)?e:[e]),d=AZ(e);return d?(a.push.apply(a,Array.from(d.querySelectorAll("[aria-live]"))),kZ(a,d,i,"aria-hidden")):function(){return null}},hM="Dialog",[R5,toe]=Rf(hM),[RZ,Sl]=R5(hM),D5=e=>{const{__scopeDialog:t,children:i,open:a,defaultOpen:d,onOpenChange:_,modal:b=!0}=e,o=Y.useRef(null),k=Y.useRef(null),[O=!1,z]=wf({prop:a,defaultProp:d,onChange:_});return L.jsx(RZ,{scope:t,triggerRef:o,contentRef:k,contentId:Wc(),titleId:Wc(),descriptionId:Wc(),open:O,onOpenChange:z,onOpenToggle:Y.useCallback(()=>z(F=>!F),[z]),modal:b,children:i})};D5.displayName=hM;var L5="DialogTrigger",O5=Y.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Sl(L5,i),_=Qn(t,d.triggerRef);return L.jsx(ln.button,{type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":mM(d.open),...a,ref:_,onClick:Fr(e.onClick,d.onOpenToggle)})});O5.displayName=L5;var fM="DialogPortal",[DZ,z5]=R5(fM,{forceMount:void 0}),N5=e=>{const{__scopeDialog:t,forceMount:i,children:a,container:d}=e,_=Sl(fM,t);return L.jsx(DZ,{scope:t,forceMount:i,children:Y.Children.map(a,b=>L.jsx(Ra,{present:i||_.open,children:L.jsx(kw,{asChild:!0,container:d,children:b})}))})};N5.displayName=fM;var jb="DialogOverlay",F5=Y.forwardRef((e,t)=>{const i=z5(jb,e.__scopeDialog),{forceMount:a=i.forceMount,...d}=e,_=Sl(jb,e.__scopeDialog);return _.modal?L.jsx(Ra,{present:a||_.open,children:L.jsx(LZ,{...d,ref:t})}):null});F5.displayName=jb;var LZ=Y.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Sl(jb,i);return L.jsx(Dw,{as:eu,allowPinchZoom:!0,shards:[d.contentRef],children:L.jsx(ln.div,{"data-state":mM(d.open),...a,ref:t,style:{pointerEvents:"auto",...a.style}})})}),Sf="DialogContent",j5=Y.forwardRef((e,t)=>{const i=z5(Sf,e.__scopeDialog),{forceMount:a=i.forceMount,...d}=e,_=Sl(Sf,e.__scopeDialog);return L.jsx(Ra,{present:a||_.open,children:_.modal?L.jsx(OZ,{...d,ref:t}):L.jsx(zZ,{...d,ref:t})})});j5.displayName=Sf;var OZ=Y.forwardRef((e,t)=>{const i=Sl(Sf,e.__scopeDialog),a=Y.useRef(null),d=Qn(t,i.contentRef,a);return Y.useEffect(()=>{const _=a.current;if(_)return dM(_)},[]),L.jsx(B5,{...e,ref:d,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fr(e.onCloseAutoFocus,_=>{var b;_.preventDefault(),(b=i.triggerRef.current)==null||b.focus()}),onPointerDownOutside:Fr(e.onPointerDownOutside,_=>{const b=_.detail.originalEvent,o=b.button===0&&b.ctrlKey===!0;(b.button===2||o)&&_.preventDefault()}),onFocusOutside:Fr(e.onFocusOutside,_=>_.preventDefault())})}),zZ=Y.forwardRef((e,t)=>{const i=Sl(Sf,e.__scopeDialog),a=Y.useRef(!1),d=Y.useRef(!1);return L.jsx(B5,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:_=>{var b,o;(b=e.onCloseAutoFocus)==null||b.call(e,_),_.defaultPrevented||(a.current||(o=i.triggerRef.current)==null||o.focus(),_.preventDefault()),a.current=!1,d.current=!1},onInteractOutside:_=>{var k,O;(k=e.onInteractOutside)==null||k.call(e,_),_.defaultPrevented||(a.current=!0,_.detail.originalEvent.type==="pointerdown"&&(d.current=!0));const b=_.target;((O=i.triggerRef.current)==null?void 0:O.contains(b))&&_.preventDefault(),_.detail.originalEvent.type==="focusin"&&d.current&&_.preventDefault()}})}),B5=Y.forwardRef((e,t)=>{const{__scopeDialog:i,trapFocus:a,onOpenAutoFocus:d,onCloseAutoFocus:_,...b}=e,o=Sl(Sf,i),k=Y.useRef(null),O=Qn(t,k);return uM(),L.jsxs(L.Fragment,{children:[L.jsx(Iw,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:d,onUnmountAutoFocus:_,children:L.jsx(K0,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":mM(o.open),...b,ref:O,onDismiss:()=>o.onOpenChange(!1)})}),L.jsxs(L.Fragment,{children:[L.jsx(NZ,{titleId:o.titleId}),L.jsx(jZ,{contentRef:k,descriptionId:o.descriptionId})]})]})}),pM="DialogTitle",U5=Y.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Sl(pM,i);return L.jsx(ln.h2,{id:d.titleId,...a,ref:t})});U5.displayName=pM;var V5="DialogDescription",$5=Y.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Sl(V5,i);return L.jsx(ln.p,{id:d.descriptionId,...a,ref:t})});$5.displayName=V5;var G5="DialogClose",H5=Y.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Sl(G5,i);return L.jsx(ln.button,{type:"button",...a,ref:t,onClick:Fr(e.onClick,()=>d.onOpenChange(!1))})});H5.displayName=G5;function mM(e){return e?"open":"closed"}var q5="DialogTitleWarning",[roe,W5]=bW(q5,{contentName:Sf,titleName:pM,docsSlug:"dialog"}),NZ=({titleId:e})=>{const t=W5(q5),i=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return Y.useEffect(()=>{e&&(document.getElementById(e)||console.error(i))},[i,e]),null},FZ="DialogDescriptionWarning",jZ=({contentRef:e,descriptionId:t})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${W5(FZ).contentName}}.`;return Y.useEffect(()=>{var _;const d=(_=e.current)==null?void 0:_.getAttribute("aria-describedby");t&&d&&(document.getElementById(t)||console.warn(a))},[a,e,t]),null},gM=D5,_M=O5,yM=N5,J0=F5,Q0=j5,ev=U5,tv=$5,vM=H5;const BZ=gM,UZ=_M,VZ=yM,Z5=Y.forwardRef(({className:e,...t},i)=>L.jsx(J0,{className:_r("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:i}));Z5.displayName=J0.displayName;const $Z=W0("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Y5=Y.forwardRef(({side:e="right",className:t,children:i,...a},d)=>L.jsxs(VZ,{children:[L.jsx(Z5,{}),L.jsxs(Q0,{ref:d,className:_r($Z({side:e}),t),...a,children:[i,L.jsxs(vM,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[L.jsx(iM,{className:"h-4 w-4"}),L.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Y5.displayName=Q0.displayName;const GZ=Y.forwardRef(({className:e,...t},i)=>L.jsx(ev,{ref:i,className:_r("text-lg font-semibold text-foreground",e),...t}));GZ.displayName=ev.displayName;const HZ=Y.forwardRef(({className:e,...t},i)=>L.jsx(tv,{ref:i,className:_r("text-sm text-muted-foreground",e),...t}));HZ.displayName=tv.displayName;function Zn(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function ha(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function gs(e,t){const i=Zn(e);return isNaN(t)?ha(e,NaN):(t&&i.setDate(i.getDate()+t),i)}function vl(e,t){const i=Zn(e);if(isNaN(t))return ha(e,NaN);if(!t)return i;const a=i.getDate(),d=ha(e,i.getTime());d.setMonth(i.getMonth()+t+1,0);const _=d.getDate();return a>=_?d:(i.setFullYear(d.getFullYear(),d.getMonth(),a),i)}const xM=6048e5,qZ=864e5;let WZ={};function rv(){return WZ}function ic(e,t){var o,k,O,z;const i=rv(),a=(t==null?void 0:t.weekStartsOn)??((k=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:k.weekStartsOn)??i.weekStartsOn??((z=(O=i.locale)==null?void 0:O.options)==null?void 0:z.weekStartsOn)??0,d=Zn(e),_=d.getDay(),b=(_<a?7:0)+_-a;return d.setDate(d.getDate()-b),d.setHours(0,0,0,0),d}function Tf(e){return ic(e,{weekStartsOn:1})}function X5(e){const t=Zn(e),i=t.getFullYear(),a=ha(e,0);a.setFullYear(i+1,0,4),a.setHours(0,0,0,0);const d=Tf(a),_=ha(e,0);_.setFullYear(i,0,4),_.setHours(0,0,0,0);const b=Tf(_);return t.getTime()>=d.getTime()?i+1:t.getTime()>=b.getTime()?i:i-1}function dg(e){const t=Zn(e);return t.setHours(0,0,0,0),t}function Bb(e){const t=Zn(e),i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return i.setUTCFullYear(t.getFullYear()),+e-+i}function Ql(e,t){const i=dg(e),a=dg(t),d=+i-Bb(i),_=+a-Bb(a);return Math.round((d-_)/qZ)}function ZZ(e){const t=X5(e),i=ha(e,0);return i.setFullYear(t,0,4),i.setHours(0,0,0,0),Tf(i)}function RC(e,t){const i=t*7;return gs(e,i)}function YZ(e,t){return vl(e,t*12)}function XZ(e){let t;return e.forEach(function(i){const a=Zn(i);(t===void 0||t<a||isNaN(Number(a)))&&(t=a)}),t||new Date(NaN)}function KZ(e){let t;return e.forEach(i=>{const a=Zn(i);(!t||t>a||isNaN(+a))&&(t=a)}),t||new Date(NaN)}function js(e,t){const i=dg(e),a=dg(t);return+i==+a}function bM(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function JZ(e){if(!bM(e)&&typeof e!="number")return!1;const t=Zn(e);return!isNaN(Number(t))}function C0(e,t){const i=Zn(e),a=Zn(t),d=i.getFullYear()-a.getFullYear(),_=i.getMonth()-a.getMonth();return d*12+_}function QZ(e,t,i){const a=ic(e,i),d=ic(t,i),_=+a-Bb(a),b=+d-Bb(d);return Math.round((_-b)/xM)}function wM(e){const t=Zn(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(23,59,59,999),t}function $s(e){const t=Zn(e);return t.setDate(1),t.setHours(0,0,0,0),t}function K5(e){const t=Zn(e),i=ha(e,0);return i.setFullYear(t.getFullYear(),0,1),i.setHours(0,0,0,0),i}function SM(e,t){var o,k,O,z;const i=rv(),a=(t==null?void 0:t.weekStartsOn)??((k=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:k.weekStartsOn)??i.weekStartsOn??((z=(O=i.locale)==null?void 0:O.options)==null?void 0:z.weekStartsOn)??0,d=Zn(e),_=d.getDay(),b=(_<a?-7:0)+6-(_-a);return d.setDate(d.getDate()+b),d.setHours(23,59,59,999),d}function J5(e){return SM(e,{weekStartsOn:1})}const eY={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},tY=(e,t,i)=>{let a;const d=eY[e];return typeof d=="string"?a=d:t===1?a=d.one:a=d.other.replace("{{count}}",t.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a};function BT(e){return(t={})=>{const i=t.width?String(t.width):e.defaultWidth;return e.formats[i]||e.formats[e.defaultWidth]}}const rY={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},nY={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},iY={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},oY={date:BT({formats:rY,defaultWidth:"full"}),time:BT({formats:nY,defaultWidth:"full"}),dateTime:BT({formats:iY,defaultWidth:"full"})},sY={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},aY=(e,t,i,a)=>sY[e];function Py(e){return(t,i)=>{const a=i!=null&&i.context?String(i.context):"standalone";let d;if(a==="formatting"&&e.formattingValues){const b=e.defaultFormattingWidth||e.defaultWidth,o=i!=null&&i.width?String(i.width):b;d=e.formattingValues[o]||e.formattingValues[b]}else{const b=e.defaultWidth,o=i!=null&&i.width?String(i.width):e.defaultWidth;d=e.values[o]||e.values[b]}const _=e.argumentCallback?e.argumentCallback(t):t;return d[_]}}const lY={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},cY={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},uY={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dY={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},hY={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},fY={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pY=(e,t)=>{const i=Number(e),a=i%100;if(a>20||a<10)switch(a%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},mY={ordinalNumber:pY,era:Py({values:lY,defaultWidth:"wide"}),quarter:Py({values:cY,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Py({values:uY,defaultWidth:"wide"}),day:Py({values:dY,defaultWidth:"wide"}),dayPeriod:Py({values:hY,defaultWidth:"wide",formattingValues:fY,defaultFormattingWidth:"wide"})};function Ay(e){return(t,i={})=>{const a=i.width,d=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],_=t.match(d);if(!_)return null;const b=_[0],o=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],k=Array.isArray(o)?_Y(o,F=>F.test(b)):gY(o,F=>F.test(b));let O;O=e.valueCallback?e.valueCallback(k):k,O=i.valueCallback?i.valueCallback(O):O;const z=t.slice(b.length);return{value:O,rest:z}}}function gY(e,t){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t(e[i]))return i}function _Y(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i}function yY(e){return(t,i={})=>{const a=t.match(e.matchPattern);if(!a)return null;const d=a[0],_=t.match(e.parsePattern);if(!_)return null;let b=e.valueCallback?e.valueCallback(_[0]):_[0];b=i.valueCallback?i.valueCallback(b):b;const o=t.slice(d.length);return{value:b,rest:o}}}const vY=/^(\d+)(th|st|nd|rd)?/i,xY=/\d+/i,bY={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},wY={any:[/^b/i,/^(a|c)/i]},SY={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},TY={any:[/1/i,/2/i,/3/i,/4/i]},EY={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},CY={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},MY={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},PY={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},AY={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},IY={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},kY={ordinalNumber:yY({matchPattern:vY,parsePattern:xY,valueCallback:e=>parseInt(e,10)}),era:Ay({matchPatterns:bY,defaultMatchWidth:"wide",parsePatterns:wY,defaultParseWidth:"any"}),quarter:Ay({matchPatterns:SY,defaultMatchWidth:"wide",parsePatterns:TY,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Ay({matchPatterns:EY,defaultMatchWidth:"wide",parsePatterns:CY,defaultParseWidth:"any"}),day:Ay({matchPatterns:MY,defaultMatchWidth:"wide",parsePatterns:PY,defaultParseWidth:"any"}),dayPeriod:Ay({matchPatterns:AY,defaultMatchWidth:"any",parsePatterns:IY,defaultParseWidth:"any"})},Q5={code:"en-US",formatDistance:tY,formatLong:oY,formatRelative:aY,localize:mY,match:kY,options:{weekStartsOn:0,firstWeekContainsDate:1}};function RY(e){const t=Zn(e);return Ql(t,K5(t))+1}function eN(e){const t=Zn(e),i=+Tf(t)-+ZZ(t);return Math.round(i/xM)+1}function tN(e,t){var z,F,G,ee;const i=Zn(e),a=i.getFullYear(),d=rv(),_=(t==null?void 0:t.firstWeekContainsDate)??((F=(z=t==null?void 0:t.locale)==null?void 0:z.options)==null?void 0:F.firstWeekContainsDate)??d.firstWeekContainsDate??((ee=(G=d.locale)==null?void 0:G.options)==null?void 0:ee.firstWeekContainsDate)??1,b=ha(e,0);b.setFullYear(a+1,0,_),b.setHours(0,0,0,0);const o=ic(b,t),k=ha(e,0);k.setFullYear(a,0,_),k.setHours(0,0,0,0);const O=ic(k,t);return i.getTime()>=o.getTime()?a+1:i.getTime()>=O.getTime()?a:a-1}function DY(e,t){var o,k,O,z;const i=rv(),a=(t==null?void 0:t.firstWeekContainsDate)??((k=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:k.firstWeekContainsDate)??i.firstWeekContainsDate??((z=(O=i.locale)==null?void 0:O.options)==null?void 0:z.firstWeekContainsDate)??1,d=tN(e,t),_=ha(e,0);return _.setFullYear(d,0,a),_.setHours(0,0,0,0),ic(_,t)}function rN(e,t){const i=Zn(e),a=+ic(i,t)-+DY(i,t);return Math.round(a/xM)+1}function si(e,t){const i=e<0?"-":"",a=Math.abs(e).toString().padStart(t,"0");return i+a}const td={y(e,t){const i=e.getFullYear(),a=i>0?i:1-i;return si(t==="yy"?a%100:a,t.length)},M(e,t){const i=e.getMonth();return t==="M"?String(i+1):si(i+1,2)},d(e,t){return si(e.getDate(),t.length)},a(e,t){const i=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(e,t){return si(e.getHours()%12||12,t.length)},H(e,t){return si(e.getHours(),t.length)},m(e,t){return si(e.getMinutes(),t.length)},s(e,t){return si(e.getSeconds(),t.length)},S(e,t){const i=t.length,a=e.getMilliseconds(),d=Math.trunc(a*Math.pow(10,i-3));return si(d,t.length)}},hm={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},WD={G:function(e,t,i){const a=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return i.era(a,{width:"abbreviated"});case"GGGGG":return i.era(a,{width:"narrow"});case"GGGG":default:return i.era(a,{width:"wide"})}},y:function(e,t,i){if(t==="yo"){const a=e.getFullYear(),d=a>0?a:1-a;return i.ordinalNumber(d,{unit:"year"})}return td.y(e,t)},Y:function(e,t,i,a){const d=tN(e,a),_=d>0?d:1-d;if(t==="YY"){const b=_%100;return si(b,2)}return t==="Yo"?i.ordinalNumber(_,{unit:"year"}):si(_,t.length)},R:function(e,t){const i=X5(e);return si(i,t.length)},u:function(e,t){const i=e.getFullYear();return si(i,t.length)},Q:function(e,t,i){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return si(a,2);case"Qo":return i.ordinalNumber(a,{unit:"quarter"});case"QQQ":return i.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,i){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return si(a,2);case"qo":return i.ordinalNumber(a,{unit:"quarter"});case"qqq":return i.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,i){const a=e.getMonth();switch(t){case"M":case"MM":return td.M(e,t);case"Mo":return i.ordinalNumber(a+1,{unit:"month"});case"MMM":return i.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,i){const a=e.getMonth();switch(t){case"L":return String(a+1);case"LL":return si(a+1,2);case"Lo":return i.ordinalNumber(a+1,{unit:"month"});case"LLL":return i.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,i,a){const d=rN(e,a);return t==="wo"?i.ordinalNumber(d,{unit:"week"}):si(d,t.length)},I:function(e,t,i){const a=eN(e);return t==="Io"?i.ordinalNumber(a,{unit:"week"}):si(a,t.length)},d:function(e,t,i){return t==="do"?i.ordinalNumber(e.getDate(),{unit:"date"}):td.d(e,t)},D:function(e,t,i){const a=RY(e);return t==="Do"?i.ordinalNumber(a,{unit:"dayOfYear"}):si(a,t.length)},E:function(e,t,i){const a=e.getDay();switch(t){case"E":case"EE":case"EEE":return i.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(a,{width:"short",context:"formatting"});case"EEEE":default:return i.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,i,a){const d=e.getDay(),_=(d-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(_);case"ee":return si(_,2);case"eo":return i.ordinalNumber(_,{unit:"day"});case"eee":return i.day(d,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(d,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(d,{width:"short",context:"formatting"});case"eeee":default:return i.day(d,{width:"wide",context:"formatting"})}},c:function(e,t,i,a){const d=e.getDay(),_=(d-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(_);case"cc":return si(_,t.length);case"co":return i.ordinalNumber(_,{unit:"day"});case"ccc":return i.day(d,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(d,{width:"narrow",context:"standalone"});case"cccccc":return i.day(d,{width:"short",context:"standalone"});case"cccc":default:return i.day(d,{width:"wide",context:"standalone"})}},i:function(e,t,i){const a=e.getDay(),d=a===0?7:a;switch(t){case"i":return String(d);case"ii":return si(d,t.length);case"io":return i.ordinalNumber(d,{unit:"day"});case"iii":return i.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(a,{width:"short",context:"formatting"});case"iiii":default:return i.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,i){const d=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(e,t,i){const a=e.getHours();let d;switch(a===12?d=hm.noon:a===0?d=hm.midnight:d=a/12>=1?"pm":"am",t){case"b":case"bb":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(e,t,i){const a=e.getHours();let d;switch(a>=17?d=hm.evening:a>=12?d=hm.afternoon:a>=4?d=hm.morning:d=hm.night,t){case"B":case"BB":case"BBB":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(e,t,i){if(t==="ho"){let a=e.getHours()%12;return a===0&&(a=12),i.ordinalNumber(a,{unit:"hour"})}return td.h(e,t)},H:function(e,t,i){return t==="Ho"?i.ordinalNumber(e.getHours(),{unit:"hour"}):td.H(e,t)},K:function(e,t,i){const a=e.getHours()%12;return t==="Ko"?i.ordinalNumber(a,{unit:"hour"}):si(a,t.length)},k:function(e,t,i){let a=e.getHours();return a===0&&(a=24),t==="ko"?i.ordinalNumber(a,{unit:"hour"}):si(a,t.length)},m:function(e,t,i){return t==="mo"?i.ordinalNumber(e.getMinutes(),{unit:"minute"}):td.m(e,t)},s:function(e,t,i){return t==="so"?i.ordinalNumber(e.getSeconds(),{unit:"second"}):td.s(e,t)},S:function(e,t){return td.S(e,t)},X:function(e,t,i){const a=e.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return YD(a);case"XXXX":case"XX":return Vh(a);case"XXXXX":case"XXX":default:return Vh(a,":")}},x:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"x":return YD(a);case"xxxx":case"xx":return Vh(a);case"xxxxx":case"xxx":default:return Vh(a,":")}},O:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+ZD(a,":");case"OOOO":default:return"GMT"+Vh(a,":")}},z:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+ZD(a,":");case"zzzz":default:return"GMT"+Vh(a,":")}},t:function(e,t,i){const a=Math.trunc(e.getTime()/1e3);return si(a,t.length)},T:function(e,t,i){const a=e.getTime();return si(a,t.length)}};function ZD(e,t=""){const i=e>0?"-":"+",a=Math.abs(e),d=Math.trunc(a/60),_=a%60;return _===0?i+String(d):i+String(d)+t+si(_,2)}function YD(e,t){return e%60===0?(e>0?"-":"+")+si(Math.abs(e)/60,2):Vh(e,t)}function Vh(e,t=""){const i=e>0?"-":"+",a=Math.abs(e),d=si(Math.trunc(a/60),2),_=si(a%60,2);return i+d+t+_}const XD=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},nN=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},LY=(e,t)=>{const i=e.match(/(P+)(p+)?/)||[],a=i[1],d=i[2];if(!d)return XD(e,t);let _;switch(a){case"P":_=t.dateTime({width:"short"});break;case"PP":_=t.dateTime({width:"medium"});break;case"PPP":_=t.dateTime({width:"long"});break;case"PPPP":default:_=t.dateTime({width:"full"});break}return _.replace("{{date}}",XD(a,t)).replace("{{time}}",nN(d,t))},OY={p:nN,P:LY},zY=/^D+$/,NY=/^Y+$/,FY=["D","DD","YY","YYYY"];function jY(e){return zY.test(e)}function BY(e){return NY.test(e)}function UY(e,t,i){const a=VY(e,t,i);if(console.warn(a),FY.includes(e))throw new RangeError(a)}function VY(e,t,i){const a=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${a} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const $Y=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,GY=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,HY=/^'([^]*?)'?$/,qY=/''/g,WY=/[a-zA-Z]/;function In(e,t,i){var z,F,G,ee,J,te,oe,X;const a=rv(),d=(i==null?void 0:i.locale)??a.locale??Q5,_=(i==null?void 0:i.firstWeekContainsDate)??((F=(z=i==null?void 0:i.locale)==null?void 0:z.options)==null?void 0:F.firstWeekContainsDate)??a.firstWeekContainsDate??((ee=(G=a.locale)==null?void 0:G.options)==null?void 0:ee.firstWeekContainsDate)??1,b=(i==null?void 0:i.weekStartsOn)??((te=(J=i==null?void 0:i.locale)==null?void 0:J.options)==null?void 0:te.weekStartsOn)??a.weekStartsOn??((X=(oe=a.locale)==null?void 0:oe.options)==null?void 0:X.weekStartsOn)??0,o=Zn(e);if(!JZ(o))throw new RangeError("Invalid time value");let k=t.match(GY).map(Q=>{const ue=Q[0];if(ue==="p"||ue==="P"){const he=OY[ue];return he(Q,d.formatLong)}return Q}).join("").match($Y).map(Q=>{if(Q==="''")return{isToken:!1,value:"'"};const ue=Q[0];if(ue==="'")return{isToken:!1,value:ZY(Q)};if(WD[ue])return{isToken:!0,value:Q};if(ue.match(WY))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ue+"`");return{isToken:!1,value:Q}});d.localize.preprocessor&&(k=d.localize.preprocessor(o,k));const O={firstWeekContainsDate:_,weekStartsOn:b,locale:d};return k.map(Q=>{if(!Q.isToken)return Q.value;const ue=Q.value;(!(i!=null&&i.useAdditionalWeekYearTokens)&&BY(ue)||!(i!=null&&i.useAdditionalDayOfYearTokens)&&jY(ue))&&UY(ue,t,String(e));const he=WD[ue[0]];return he(o,ue,d.localize,O)}).join("")}function ZY(e){const t=e.match(HY);return t?t[1].replace(qY,"'"):e}function YY(e){const t=Zn(e),i=t.getFullYear(),a=t.getMonth(),d=ha(e,0);return d.setFullYear(i,a+1,0),d.setHours(0,0,0,0),d.getDate()}function XY(e){return Math.trunc(+Zn(e)/1e3)}function KY(e){const t=Zn(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(0,0,0,0),t}function JY(e,t){return QZ(KY(e),$s(e),t)+1}function DC(e,t){const i=Zn(e),a=Zn(t);return i.getTime()>a.getTime()}function iN(e,t){const i=Zn(e),a=Zn(t);return+i<+a}function TM(e,t){const i=Zn(e),a=Zn(t);return i.getFullYear()===a.getFullYear()&&i.getMonth()===a.getMonth()}function QY(e,t){const i=Zn(e),a=Zn(t);return i.getFullYear()===a.getFullYear()}function UT(e,t){return gs(e,-t)}function VT(e,t){const i=Zn(e),a=i.getFullYear(),d=i.getDate(),_=ha(e,0);_.setFullYear(a,t,15),_.setHours(0,0,0,0);const b=YY(_);return i.setMonth(t,Math.min(d,b)),i}function KD(e,t){const i=Zn(e);return isNaN(+i)?ha(e,NaN):(i.setFullYear(t),i)}var Jr=function(){return Jr=Object.assign||function(t){for(var i,a=1,d=arguments.length;a<d;a++){i=arguments[a];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(t[_]=i[_])}return t},Jr.apply(this,arguments)};function eX(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(e);d<a.length;d++)t.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(e,a[d])&&(i[a[d]]=e[a[d]]);return i}function oN(e,t,i){for(var a=0,d=t.length,_;a<d;a++)(_||!(a in t))&&(_||(_=Array.prototype.slice.call(t,0,a)),_[a]=t[a]);return e.concat(_||Array.prototype.slice.call(t))}function nv(e){return e.mode==="multiple"}function iv(e){return e.mode==="range"}function Lw(e){return e.mode==="single"}var tX={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function rX(e,t){return In(e,"LLLL y",t)}function nX(e,t){return In(e,"d",t)}function iX(e,t){return In(e,"LLLL",t)}function oX(e){return"".concat(e)}function sX(e,t){return In(e,"cccccc",t)}function aX(e,t){return In(e,"yyyy",t)}var lX=Object.freeze({__proto__:null,formatCaption:rX,formatDay:nX,formatMonthCaption:iX,formatWeekNumber:oX,formatWeekdayName:sX,formatYearCaption:aX}),cX=function(e,t,i){return In(e,"do MMMM (EEEE)",i)},uX=function(){return"Month: "},dX=function(){return"Go to next month"},hX=function(){return"Go to previous month"},fX=function(e,t){return In(e,"cccc",t)},pX=function(e){return"Week n. ".concat(e)},mX=function(){return"Year: "},gX=Object.freeze({__proto__:null,labelDay:cX,labelMonthDropdown:uX,labelNext:dX,labelPrevious:hX,labelWeekNumber:pX,labelWeekday:fX,labelYearDropdown:mX});function _X(){var e="buttons",t=tX,i=Q5,a={},d={},_=1,b={},o=new Date;return{captionLayout:e,classNames:t,formatters:lX,labels:gX,locale:i,modifiersClassNames:a,modifiers:d,numberOfMonths:_,styles:b,today:o,mode:"default"}}function yX(e){var t=e.fromYear,i=e.toYear,a=e.fromMonth,d=e.toMonth,_=e.fromDate,b=e.toDate;return a?_=$s(a):t&&(_=new Date(t,0,1)),d?b=wM(d):i&&(b=new Date(i,11,31)),{fromDate:_?dg(_):void 0,toDate:b?dg(b):void 0}}var sN=Y.createContext(void 0);function vX(e){var t,i=e.initialProps,a=_X(),d=yX(i),_=d.fromDate,b=d.toDate,o=(t=i.captionLayout)!==null&&t!==void 0?t:a.captionLayout;o!=="buttons"&&(!_||!b)&&(o="buttons");var k;(Lw(i)||nv(i)||iv(i))&&(k=i.onSelect);var O=Jr(Jr(Jr({},a),i),{captionLayout:o,classNames:Jr(Jr({},a.classNames),i.classNames),components:Jr({},i.components),formatters:Jr(Jr({},a.formatters),i.formatters),fromDate:_,labels:Jr(Jr({},a.labels),i.labels),mode:i.mode||a.mode,modifiers:Jr(Jr({},a.modifiers),i.modifiers),modifiersClassNames:Jr(Jr({},a.modifiersClassNames),i.modifiersClassNames),onSelect:k,styles:Jr(Jr({},a.styles),i.styles),toDate:b});return L.jsx(sN.Provider,{value:O,children:e.children})}function yi(){var e=Y.useContext(sN);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function aN(e){var t=yi(),i=t.locale,a=t.classNames,d=t.styles,_=t.formatters.formatCaption;return L.jsx("div",{className:a.caption_label,style:d.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:_(e.displayMonth,{locale:i})})}function xX(e){return L.jsx("svg",Jr({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:L.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function lN(e){var t,i,a=e.onChange,d=e.value,_=e.children,b=e.caption,o=e.className,k=e.style,O=yi(),z=(i=(t=O.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&i!==void 0?i:xX;return L.jsxs("div",{className:o,style:k,children:[L.jsx("span",{className:O.classNames.vhidden,children:e["aria-label"]}),L.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:O.classNames.dropdown,style:O.styles.dropdown,value:d,onChange:a,children:_}),L.jsxs("div",{className:O.classNames.caption_label,style:O.styles.caption_label,"aria-hidden":"true",children:[b,L.jsx(z,{className:O.classNames.dropdown_icon,style:O.styles.dropdown_icon})]})]})}function bX(e){var t,i=yi(),a=i.fromDate,d=i.toDate,_=i.styles,b=i.locale,o=i.formatters.formatMonthCaption,k=i.classNames,O=i.components,z=i.labels.labelMonthDropdown;if(!a)return L.jsx(L.Fragment,{});if(!d)return L.jsx(L.Fragment,{});var F=[];if(QY(a,d))for(var G=$s(a),ee=a.getMonth();ee<=d.getMonth();ee++)F.push(VT(G,ee));else for(var G=$s(new Date),ee=0;ee<=11;ee++)F.push(VT(G,ee));var J=function(oe){var X=Number(oe.target.value),Q=VT($s(e.displayMonth),X);e.onChange(Q)},te=(t=O==null?void 0:O.Dropdown)!==null&&t!==void 0?t:lN;return L.jsx(te,{name:"months","aria-label":z(),className:k.dropdown_month,style:_.dropdown_month,onChange:J,value:e.displayMonth.getMonth(),caption:o(e.displayMonth,{locale:b}),children:F.map(function(oe){return L.jsx("option",{value:oe.getMonth(),children:o(oe,{locale:b})},oe.getMonth())})})}function wX(e){var t,i=e.displayMonth,a=yi(),d=a.fromDate,_=a.toDate,b=a.locale,o=a.styles,k=a.classNames,O=a.components,z=a.formatters.formatYearCaption,F=a.labels.labelYearDropdown,G=[];if(!d)return L.jsx(L.Fragment,{});if(!_)return L.jsx(L.Fragment,{});for(var ee=d.getFullYear(),J=_.getFullYear(),te=ee;te<=J;te++)G.push(KD(K5(new Date),te));var oe=function(Q){var ue=KD($s(i),Number(Q.target.value));e.onChange(ue)},X=(t=O==null?void 0:O.Dropdown)!==null&&t!==void 0?t:lN;return L.jsx(X,{name:"years","aria-label":F(),className:k.dropdown_year,style:o.dropdown_year,onChange:oe,value:i.getFullYear(),caption:z(i,{locale:b}),children:G.map(function(Q){return L.jsx("option",{value:Q.getFullYear(),children:z(Q,{locale:b})},Q.getFullYear())})})}function SX(e,t){var i=Y.useState(e),a=i[0],d=i[1],_=t===void 0?a:t;return[_,d]}function TX(e){var t=e.month,i=e.defaultMonth,a=e.today,d=t||i||a||new Date,_=e.toDate,b=e.fromDate,o=e.numberOfMonths,k=o===void 0?1:o;if(_&&C0(_,d)<0){var O=-1*(k-1);d=vl(_,O)}return b&&C0(d,b)<0&&(d=b),$s(d)}function EX(){var e=yi(),t=TX(e),i=SX(t,e.month),a=i[0],d=i[1],_=function(b){var o;if(!e.disableNavigation){var k=$s(b);d(k),(o=e.onMonthChange)===null||o===void 0||o.call(e,k)}};return[a,_]}function CX(e,t){for(var i=t.reverseMonths,a=t.numberOfMonths,d=$s(e),_=$s(vl(d,a)),b=C0(_,d),o=[],k=0;k<b;k++){var O=vl(d,k);o.push(O)}return i&&(o=o.reverse()),o}function MX(e,t){if(!t.disableNavigation){var i=t.toDate,a=t.pagedNavigation,d=t.numberOfMonths,_=d===void 0?1:d,b=a?_:1,o=$s(e);if(!i)return vl(o,b);var k=C0(i,e);if(!(k<_))return vl(o,b)}}function PX(e,t){if(!t.disableNavigation){var i=t.fromDate,a=t.pagedNavigation,d=t.numberOfMonths,_=d===void 0?1:d,b=a?_:1,o=$s(e);if(!i)return vl(o,-b);var k=C0(o,i);if(!(k<=0))return vl(o,-b)}}var cN=Y.createContext(void 0);function AX(e){var t=yi(),i=EX(),a=i[0],d=i[1],_=CX(a,t),b=MX(a,t),o=PX(a,t),k=function(F){return _.some(function(G){return TM(F,G)})},O=function(F,G){k(F)||(G&&iN(F,G)?d(vl(F,1+t.numberOfMonths*-1)):d(F))},z={currentMonth:a,displayMonths:_,goToMonth:d,goToDate:O,previousMonth:o,nextMonth:b,isDateDisplayed:k};return L.jsx(cN.Provider,{value:z,children:e.children})}function ov(){var e=Y.useContext(cN);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function JD(e){var t,i=yi(),a=i.classNames,d=i.styles,_=i.components,b=ov().goToMonth,o=function(z){b(vl(z,e.displayIndex?-e.displayIndex:0))},k=(t=_==null?void 0:_.CaptionLabel)!==null&&t!==void 0?t:aN,O=L.jsx(k,{id:e.id,displayMonth:e.displayMonth});return L.jsxs("div",{className:a.caption_dropdowns,style:d.caption_dropdowns,children:[L.jsx("div",{className:a.vhidden,children:O}),L.jsx(bX,{onChange:o,displayMonth:e.displayMonth}),L.jsx(wX,{onChange:o,displayMonth:e.displayMonth})]})}function IX(e){return L.jsx("svg",Jr({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:L.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function kX(e){return L.jsx("svg",Jr({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:L.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Ub=Y.forwardRef(function(e,t){var i=yi(),a=i.classNames,d=i.styles,_=[a.button_reset,a.button];e.className&&_.push(e.className);var b=_.join(" "),o=Jr(Jr({},d.button_reset),d.button);return e.style&&Object.assign(o,e.style),L.jsx("button",Jr({},e,{ref:t,type:"button",className:b,style:o}))});function RX(e){var t,i,a=yi(),d=a.dir,_=a.locale,b=a.classNames,o=a.styles,k=a.labels,O=k.labelPrevious,z=k.labelNext,F=a.components;if(!e.nextMonth&&!e.previousMonth)return L.jsx(L.Fragment,{});var G=O(e.previousMonth,{locale:_}),ee=[b.nav_button,b.nav_button_previous].join(" "),J=z(e.nextMonth,{locale:_}),te=[b.nav_button,b.nav_button_next].join(" "),oe=(t=F==null?void 0:F.IconRight)!==null&&t!==void 0?t:kX,X=(i=F==null?void 0:F.IconLeft)!==null&&i!==void 0?i:IX;return L.jsxs("div",{className:b.nav,style:o.nav,children:[!e.hidePrevious&&L.jsx(Ub,{name:"previous-month","aria-label":G,className:ee,style:o.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:d==="rtl"?L.jsx(oe,{className:b.nav_icon,style:o.nav_icon}):L.jsx(X,{className:b.nav_icon,style:o.nav_icon})}),!e.hideNext&&L.jsx(Ub,{name:"next-month","aria-label":J,className:te,style:o.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:d==="rtl"?L.jsx(X,{className:b.nav_icon,style:o.nav_icon}):L.jsx(oe,{className:b.nav_icon,style:o.nav_icon})})]})}function QD(e){var t=yi().numberOfMonths,i=ov(),a=i.previousMonth,d=i.nextMonth,_=i.goToMonth,b=i.displayMonths,o=b.findIndex(function(J){return TM(e.displayMonth,J)}),k=o===0,O=o===b.length-1,z=t>1&&(k||!O),F=t>1&&(O||!k),G=function(){a&&_(a)},ee=function(){d&&_(d)};return L.jsx(RX,{displayMonth:e.displayMonth,hideNext:z,hidePrevious:F,nextMonth:d,previousMonth:a,onPreviousClick:G,onNextClick:ee})}function DX(e){var t,i=yi(),a=i.classNames,d=i.disableNavigation,_=i.styles,b=i.captionLayout,o=i.components,k=(t=o==null?void 0:o.CaptionLabel)!==null&&t!==void 0?t:aN,O;return d?O=L.jsx(k,{id:e.id,displayMonth:e.displayMonth}):b==="dropdown"?O=L.jsx(JD,{displayMonth:e.displayMonth,id:e.id}):b==="dropdown-buttons"?O=L.jsxs(L.Fragment,{children:[L.jsx(JD,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),L.jsx(QD,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):O=L.jsxs(L.Fragment,{children:[L.jsx(k,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),L.jsx(QD,{displayMonth:e.displayMonth,id:e.id})]}),L.jsx("div",{className:a.caption,style:_.caption,children:O})}function LX(e){var t=yi(),i=t.footer,a=t.styles,d=t.classNames.tfoot;return i?L.jsx("tfoot",{className:d,style:a.tfoot,children:L.jsx("tr",{children:L.jsx("td",{colSpan:8,children:i})})}):L.jsx(L.Fragment,{})}function OX(e,t,i){for(var a=i?Tf(new Date):ic(new Date,{locale:e,weekStartsOn:t}),d=[],_=0;_<7;_++){var b=gs(a,_);d.push(b)}return d}function zX(){var e=yi(),t=e.classNames,i=e.styles,a=e.showWeekNumber,d=e.locale,_=e.weekStartsOn,b=e.ISOWeek,o=e.formatters.formatWeekdayName,k=e.labels.labelWeekday,O=OX(d,_,b);return L.jsxs("tr",{style:i.head_row,className:t.head_row,children:[a&&L.jsx("td",{style:i.head_cell,className:t.head_cell}),O.map(function(z,F){return L.jsx("th",{scope:"col",className:t.head_cell,style:i.head_cell,"aria-label":k(z,{locale:d}),children:o(z,{locale:d})},F)})]})}function NX(){var e,t=yi(),i=t.classNames,a=t.styles,d=t.components,_=(e=d==null?void 0:d.HeadRow)!==null&&e!==void 0?e:zX;return L.jsx("thead",{style:a.head,className:i.head,children:L.jsx(_,{})})}function FX(e){var t=yi(),i=t.locale,a=t.formatters.formatDay;return L.jsx(L.Fragment,{children:a(e.date,{locale:i})})}var EM=Y.createContext(void 0);function jX(e){if(!nv(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return L.jsx(EM.Provider,{value:t,children:e.children})}return L.jsx(BX,{initialProps:e.initialProps,children:e.children})}function BX(e){var t=e.initialProps,i=e.children,a=t.selected,d=t.min,_=t.max,b=function(O,z,F){var G,ee;(G=t.onDayClick)===null||G===void 0||G.call(t,O,z,F);var J=!!(z.selected&&d&&(a==null?void 0:a.length)===d);if(!J){var te=!!(!z.selected&&_&&(a==null?void 0:a.length)===_);if(!te){var oe=a?oN([],a):[];if(z.selected){var X=oe.findIndex(function(Q){return js(O,Q)});oe.splice(X,1)}else oe.push(O);(ee=t.onSelect)===null||ee===void 0||ee.call(t,oe,O,z,F)}}},o={disabled:[]};a&&o.disabled.push(function(O){var z=_&&a.length>_-1,F=a.some(function(G){return js(G,O)});return!!(z&&!F)});var k={selected:a,onDayClick:b,modifiers:o};return L.jsx(EM.Provider,{value:k,children:i})}function CM(){var e=Y.useContext(EM);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function UX(e,t){var i=t||{},a=i.from,d=i.to;return a&&d?js(d,e)&&js(a,e)?void 0:js(d,e)?{from:d,to:void 0}:js(a,e)?void 0:DC(a,e)?{from:e,to:d}:{from:a,to:e}:d?DC(e,d)?{from:d,to:e}:{from:e,to:d}:a?iN(e,a)?{from:e,to:a}:{from:a,to:e}:{from:e,to:void 0}}var MM=Y.createContext(void 0);function VX(e){if(!iv(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return L.jsx(MM.Provider,{value:t,children:e.children})}return L.jsx($X,{initialProps:e.initialProps,children:e.children})}function $X(e){var t=e.initialProps,i=e.children,a=t.selected,d=a||{},_=d.from,b=d.to,o=t.min,k=t.max,O=function(ee,J,te){var oe,X;(oe=t.onDayClick)===null||oe===void 0||oe.call(t,ee,J,te);var Q=UX(ee,a);(X=t.onSelect)===null||X===void 0||X.call(t,Q,ee,J,te)},z={range_start:[],range_end:[],range_middle:[],disabled:[]};if(_?(z.range_start=[_],b?(z.range_end=[b],js(_,b)||(z.range_middle=[{after:_,before:b}])):z.range_end=[_]):b&&(z.range_start=[b],z.range_end=[b]),o&&(_&&!b&&z.disabled.push({after:UT(_,o-1),before:gs(_,o-1)}),_&&b&&z.disabled.push({after:_,before:gs(_,o-1)}),!_&&b&&z.disabled.push({after:UT(b,o-1),before:gs(b,o-1)})),k){if(_&&!b&&(z.disabled.push({before:gs(_,-k+1)}),z.disabled.push({after:gs(_,k-1)})),_&&b){var F=Ql(b,_)+1,G=k-F;z.disabled.push({before:UT(_,G)}),z.disabled.push({after:gs(b,G)})}!_&&b&&(z.disabled.push({before:gs(b,-k+1)}),z.disabled.push({after:gs(b,k-1)}))}return L.jsx(MM.Provider,{value:{selected:a,onDayClick:O,modifiers:z},children:i})}function PM(){var e=Y.useContext(MM);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function tb(e){return Array.isArray(e)?oN([],e):e!==void 0?[e]:[]}function GX(e){var t={};return Object.entries(e).forEach(function(i){var a=i[0],d=i[1];t[a]=tb(d)}),t}var xl;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(xl||(xl={}));var HX=xl.Selected,Oc=xl.Disabled,qX=xl.Hidden,WX=xl.Today,$T=xl.RangeEnd,GT=xl.RangeMiddle,HT=xl.RangeStart,ZX=xl.Outside;function YX(e,t,i){var a,d=(a={},a[HX]=tb(e.selected),a[Oc]=tb(e.disabled),a[qX]=tb(e.hidden),a[WX]=[e.today],a[$T]=[],a[GT]=[],a[HT]=[],a[ZX]=[],a);return e.fromDate&&d[Oc].push({before:e.fromDate}),e.toDate&&d[Oc].push({after:e.toDate}),nv(e)?d[Oc]=d[Oc].concat(t.modifiers[Oc]):iv(e)&&(d[Oc]=d[Oc].concat(i.modifiers[Oc]),d[HT]=i.modifiers[HT],d[GT]=i.modifiers[GT],d[$T]=i.modifiers[$T]),d}var uN=Y.createContext(void 0);function XX(e){var t=yi(),i=CM(),a=PM(),d=YX(t,i,a),_=GX(t.modifiers),b=Jr(Jr({},d),_);return L.jsx(uN.Provider,{value:b,children:e.children})}function dN(){var e=Y.useContext(uN);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function KX(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function JX(e){return!!(e&&typeof e=="object"&&"from"in e)}function QX(e){return!!(e&&typeof e=="object"&&"after"in e)}function eK(e){return!!(e&&typeof e=="object"&&"before"in e)}function tK(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function rK(e,t){var i,a=t.from,d=t.to;if(a&&d){var _=Ql(d,a)<0;_&&(i=[d,a],a=i[0],d=i[1]);var b=Ql(e,a)>=0&&Ql(d,e)>=0;return b}return d?js(d,e):a?js(a,e):!1}function nK(e){return bM(e)}function iK(e){return Array.isArray(e)&&e.every(bM)}function oK(e,t){return t.some(function(i){if(typeof i=="boolean")return i;if(nK(i))return js(e,i);if(iK(i))return i.includes(e);if(JX(i))return rK(e,i);if(tK(i))return i.dayOfWeek.includes(e.getDay());if(KX(i)){var a=Ql(i.before,e),d=Ql(i.after,e),_=a>0,b=d<0,o=DC(i.before,i.after);return o?b&&_:_||b}return QX(i)?Ql(e,i.after)>0:eK(i)?Ql(i.before,e)>0:typeof i=="function"?i(e):!1})}function AM(e,t,i){var a=Object.keys(t).reduce(function(_,b){var o=t[b];return oK(e,o)&&_.push(b),_},[]),d={};return a.forEach(function(_){return d[_]=!0}),i&&!TM(e,i)&&(d.outside=!0),d}function sK(e,t){for(var i=$s(e[0]),a=wM(e[e.length-1]),d,_,b=i;b<=a;){var o=AM(b,t),k=!o.disabled&&!o.hidden;if(!k){b=gs(b,1);continue}if(o.selected)return b;o.today&&!_&&(_=b),d||(d=b),b=gs(b,1)}return _||d}var aK=365;function hN(e,t){var i=t.moveBy,a=t.direction,d=t.context,_=t.modifiers,b=t.retry,o=b===void 0?{count:0,lastFocused:e}:b,k=d.weekStartsOn,O=d.fromDate,z=d.toDate,F=d.locale,G={day:gs,week:RC,month:vl,year:YZ,startOfWeek:function(oe){return d.ISOWeek?Tf(oe):ic(oe,{locale:F,weekStartsOn:k})},endOfWeek:function(oe){return d.ISOWeek?J5(oe):SM(oe,{locale:F,weekStartsOn:k})}},ee=G[i](e,a==="after"?1:-1);a==="before"&&O?ee=XZ([O,ee]):a==="after"&&z&&(ee=KZ([z,ee]));var J=!0;if(_){var te=AM(ee,_);J=!te.disabled&&!te.hidden}return J?ee:o.count>aK?o.lastFocused:hN(ee,{moveBy:i,direction:a,context:d,modifiers:_,retry:Jr(Jr({},o),{count:o.count+1})})}var fN=Y.createContext(void 0);function lK(e){var t=ov(),i=dN(),a=Y.useState(),d=a[0],_=a[1],b=Y.useState(),o=b[0],k=b[1],O=sK(t.displayMonths,i),z=d??(o&&t.isDateDisplayed(o))?o:O,F=function(){k(d),_(void 0)},G=function(oe){_(oe)},ee=yi(),J=function(oe,X){if(d){var Q=hN(d,{moveBy:oe,direction:X,context:ee,modifiers:i});js(d,Q)||(t.goToDate(Q,d),G(Q))}},te={focusedDay:d,focusTarget:z,blur:F,focus:G,focusDayAfter:function(){return J("day","after")},focusDayBefore:function(){return J("day","before")},focusWeekAfter:function(){return J("week","after")},focusWeekBefore:function(){return J("week","before")},focusMonthBefore:function(){return J("month","before")},focusMonthAfter:function(){return J("month","after")},focusYearBefore:function(){return J("year","before")},focusYearAfter:function(){return J("year","after")},focusStartOfWeek:function(){return J("startOfWeek","before")},focusEndOfWeek:function(){return J("endOfWeek","after")}};return L.jsx(fN.Provider,{value:te,children:e.children})}function IM(){var e=Y.useContext(fN);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function cK(e,t){var i=dN(),a=AM(e,i,t);return a}var kM=Y.createContext(void 0);function uK(e){if(!Lw(e.initialProps)){var t={selected:void 0};return L.jsx(kM.Provider,{value:t,children:e.children})}return L.jsx(dK,{initialProps:e.initialProps,children:e.children})}function dK(e){var t=e.initialProps,i=e.children,a=function(_,b,o){var k,O,z;if((k=t.onDayClick)===null||k===void 0||k.call(t,_,b,o),b.selected&&!t.required){(O=t.onSelect)===null||O===void 0||O.call(t,void 0,_,b,o);return}(z=t.onSelect)===null||z===void 0||z.call(t,_,_,b,o)},d={selected:t.selected,onDayClick:a};return L.jsx(kM.Provider,{value:d,children:i})}function pN(){var e=Y.useContext(kM);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function hK(e,t){var i=yi(),a=pN(),d=CM(),_=PM(),b=IM(),o=b.focusDayAfter,k=b.focusDayBefore,O=b.focusWeekAfter,z=b.focusWeekBefore,F=b.blur,G=b.focus,ee=b.focusMonthBefore,J=b.focusMonthAfter,te=b.focusYearBefore,oe=b.focusYearAfter,X=b.focusStartOfWeek,Q=b.focusEndOfWeek,ue=function(Ct){var st,yt,ir,yr;Lw(i)?(st=a.onDayClick)===null||st===void 0||st.call(a,e,t,Ct):nv(i)?(yt=d.onDayClick)===null||yt===void 0||yt.call(d,e,t,Ct):iv(i)?(ir=_.onDayClick)===null||ir===void 0||ir.call(_,e,t,Ct):(yr=i.onDayClick)===null||yr===void 0||yr.call(i,e,t,Ct)},he=function(Ct){var st;G(e),(st=i.onDayFocus)===null||st===void 0||st.call(i,e,t,Ct)},Ie=function(Ct){var st;F(),(st=i.onDayBlur)===null||st===void 0||st.call(i,e,t,Ct)},Je=function(Ct){var st;(st=i.onDayMouseEnter)===null||st===void 0||st.call(i,e,t,Ct)},Ce=function(Ct){var st;(st=i.onDayMouseLeave)===null||st===void 0||st.call(i,e,t,Ct)},Ze=function(Ct){var st;(st=i.onDayPointerEnter)===null||st===void 0||st.call(i,e,t,Ct)},et=function(Ct){var st;(st=i.onDayPointerLeave)===null||st===void 0||st.call(i,e,t,Ct)},Ge=function(Ct){var st;(st=i.onDayTouchCancel)===null||st===void 0||st.call(i,e,t,Ct)},qe=function(Ct){var st;(st=i.onDayTouchEnd)===null||st===void 0||st.call(i,e,t,Ct)},_t=function(Ct){var st;(st=i.onDayTouchMove)===null||st===void 0||st.call(i,e,t,Ct)},Rt=function(Ct){var st;(st=i.onDayTouchStart)===null||st===void 0||st.call(i,e,t,Ct)},Wt=function(Ct){var st;(st=i.onDayKeyUp)===null||st===void 0||st.call(i,e,t,Ct)},wt=function(Ct){var st;switch(Ct.key){case"ArrowLeft":Ct.preventDefault(),Ct.stopPropagation(),i.dir==="rtl"?o():k();break;case"ArrowRight":Ct.preventDefault(),Ct.stopPropagation(),i.dir==="rtl"?k():o();break;case"ArrowDown":Ct.preventDefault(),Ct.stopPropagation(),O();break;case"ArrowUp":Ct.preventDefault(),Ct.stopPropagation(),z();break;case"PageUp":Ct.preventDefault(),Ct.stopPropagation(),Ct.shiftKey?te():ee();break;case"PageDown":Ct.preventDefault(),Ct.stopPropagation(),Ct.shiftKey?oe():J();break;case"Home":Ct.preventDefault(),Ct.stopPropagation(),X();break;case"End":Ct.preventDefault(),Ct.stopPropagation(),Q();break}(st=i.onDayKeyDown)===null||st===void 0||st.call(i,e,t,Ct)},jt={onClick:ue,onFocus:he,onBlur:Ie,onKeyDown:wt,onKeyUp:Wt,onMouseEnter:Je,onMouseLeave:Ce,onPointerEnter:Ze,onPointerLeave:et,onTouchCancel:Ge,onTouchEnd:qe,onTouchMove:_t,onTouchStart:Rt};return jt}function fK(){var e=yi(),t=pN(),i=CM(),a=PM(),d=Lw(e)?t.selected:nv(e)?i.selected:iv(e)?a.selected:void 0;return d}function pK(e){return Object.values(xl).includes(e)}function mK(e,t){var i=[e.classNames.day];return Object.keys(t).forEach(function(a){var d=e.modifiersClassNames[a];if(d)i.push(d);else if(pK(a)){var _=e.classNames["day_".concat(a)];_&&i.push(_)}}),i}function gK(e,t){var i=Jr({},e.styles.day);return Object.keys(t).forEach(function(a){var d;i=Jr(Jr({},i),(d=e.modifiersStyles)===null||d===void 0?void 0:d[a])}),i}function _K(e,t,i){var a,d,_,b=yi(),o=IM(),k=cK(e,t),O=hK(e,k),z=fK(),F=!!(b.onDayClick||b.mode!=="default");Y.useEffect(function(){var Je;k.outside||o.focusedDay&&F&&js(o.focusedDay,e)&&((Je=i.current)===null||Je===void 0||Je.focus())},[o.focusedDay,e,i,F,k.outside]);var G=mK(b,k).join(" "),ee=gK(b,k),J=!!(k.outside&&!b.showOutsideDays||k.hidden),te=(_=(d=b.components)===null||d===void 0?void 0:d.DayContent)!==null&&_!==void 0?_:FX,oe=L.jsx(te,{date:e,displayMonth:t,activeModifiers:k}),X={style:ee,className:G,children:oe,role:"gridcell"},Q=o.focusTarget&&js(o.focusTarget,e)&&!k.outside,ue=o.focusedDay&&js(o.focusedDay,e),he=Jr(Jr(Jr({},X),(a={disabled:k.disabled,role:"gridcell"},a["aria-selected"]=k.selected,a.tabIndex=ue||Q?0:-1,a)),O),Ie={isButton:F,isHidden:J,activeModifiers:k,selectedDays:z,buttonProps:he,divProps:X};return Ie}function yK(e){var t=Y.useRef(null),i=_K(e.date,e.displayMonth,t);return i.isHidden?L.jsx("div",{role:"gridcell"}):i.isButton?L.jsx(Ub,Jr({name:"day",ref:t},i.buttonProps)):L.jsx("div",Jr({},i.divProps))}function vK(e){var t=e.number,i=e.dates,a=yi(),d=a.onWeekNumberClick,_=a.styles,b=a.classNames,o=a.locale,k=a.labels.labelWeekNumber,O=a.formatters.formatWeekNumber,z=O(Number(t),{locale:o});if(!d)return L.jsx("span",{className:b.weeknumber,style:_.weeknumber,children:z});var F=k(Number(t),{locale:o}),G=function(ee){d(t,i,ee)};return L.jsx(Ub,{name:"week-number","aria-label":F,className:b.weeknumber,style:_.weeknumber,onClick:G,children:z})}function xK(e){var t,i,a=yi(),d=a.styles,_=a.classNames,b=a.showWeekNumber,o=a.components,k=(t=o==null?void 0:o.Day)!==null&&t!==void 0?t:yK,O=(i=o==null?void 0:o.WeekNumber)!==null&&i!==void 0?i:vK,z;return b&&(z=L.jsx("td",{className:_.cell,style:d.cell,children:L.jsx(O,{number:e.weekNumber,dates:e.dates})})),L.jsxs("tr",{className:_.row,style:d.row,children:[z,e.dates.map(function(F){return L.jsx("td",{className:_.cell,style:d.cell,role:"presentation",children:L.jsx(k,{displayMonth:e.displayMonth,date:F})},XY(F))})]})}function e4(e,t,i){for(var a=i!=null&&i.ISOWeek?J5(t):SM(t,i),d=i!=null&&i.ISOWeek?Tf(e):ic(e,i),_=Ql(a,d),b=[],o=0;o<=_;o++)b.push(gs(d,o));var k=b.reduce(function(O,z){var F=i!=null&&i.ISOWeek?eN(z):rN(z,i),G=O.find(function(ee){return ee.weekNumber===F});return G?(G.dates.push(z),O):(O.push({weekNumber:F,dates:[z]}),O)},[]);return k}function bK(e,t){var i=e4($s(e),wM(e),t);if(t!=null&&t.useFixedWeeks){var a=JY(e,t);if(a<6){var d=i[i.length-1],_=d.dates[d.dates.length-1],b=RC(_,6-a),o=e4(RC(_,1),b,t);i.push.apply(i,o)}}return i}function wK(e){var t,i,a,d=yi(),_=d.locale,b=d.classNames,o=d.styles,k=d.hideHead,O=d.fixedWeeks,z=d.components,F=d.weekStartsOn,G=d.firstWeekContainsDate,ee=d.ISOWeek,J=bK(e.displayMonth,{useFixedWeeks:!!O,ISOWeek:ee,locale:_,weekStartsOn:F,firstWeekContainsDate:G}),te=(t=z==null?void 0:z.Head)!==null&&t!==void 0?t:NX,oe=(i=z==null?void 0:z.Row)!==null&&i!==void 0?i:xK,X=(a=z==null?void 0:z.Footer)!==null&&a!==void 0?a:LX;return L.jsxs("table",{id:e.id,className:b.table,style:o.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!k&&L.jsx(te,{}),L.jsx("tbody",{className:b.tbody,style:o.tbody,children:J.map(function(Q){return L.jsx(oe,{displayMonth:e.displayMonth,dates:Q.dates,weekNumber:Q.weekNumber},Q.weekNumber)})}),L.jsx(X,{displayMonth:e.displayMonth})]})}function SK(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var TK=SK()?Y.useLayoutEffect:Y.useEffect,qT=!1,EK=0;function t4(){return"react-day-picker-".concat(++EK)}function CK(e){var t,i=e??(qT?t4():null),a=Y.useState(i),d=a[0],_=a[1];return TK(function(){d===null&&_(t4())},[]),Y.useEffect(function(){qT===!1&&(qT=!0)},[]),(t=e??d)!==null&&t!==void 0?t:void 0}function MK(e){var t,i,a=yi(),d=a.dir,_=a.classNames,b=a.styles,o=a.components,k=ov().displayMonths,O=CK(a.id?"".concat(a.id,"-").concat(e.displayIndex):void 0),z=a.id?"".concat(a.id,"-grid-").concat(e.displayIndex):void 0,F=[_.month],G=b.month,ee=e.displayIndex===0,J=e.displayIndex===k.length-1,te=!ee&&!J;d==="rtl"&&(t=[ee,J],J=t[0],ee=t[1]),ee&&(F.push(_.caption_start),G=Jr(Jr({},G),b.caption_start)),J&&(F.push(_.caption_end),G=Jr(Jr({},G),b.caption_end)),te&&(F.push(_.caption_between),G=Jr(Jr({},G),b.caption_between));var oe=(i=o==null?void 0:o.Caption)!==null&&i!==void 0?i:DX;return L.jsxs("div",{className:F.join(" "),style:G,children:[L.jsx(oe,{id:O,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),L.jsx(wK,{id:z,"aria-labelledby":O,displayMonth:e.displayMonth})]},e.displayIndex)}function PK(e){var t=yi(),i=t.classNames,a=t.styles;return L.jsx("div",{className:i.months,style:a.months,children:e.children})}function AK(e){var t,i,a=e.initialProps,d=yi(),_=IM(),b=ov(),o=Y.useState(!1),k=o[0],O=o[1];Y.useEffect(function(){d.initialFocus&&_.focusTarget&&(k||(_.focus(_.focusTarget),O(!0)))},[d.initialFocus,k,_.focus,_.focusTarget,_]);var z=[d.classNames.root,d.className];d.numberOfMonths>1&&z.push(d.classNames.multiple_months),d.showWeekNumber&&z.push(d.classNames.with_weeknumber);var F=Jr(Jr({},d.styles.root),d.style),G=Object.keys(a).filter(function(J){return J.startsWith("data-")}).reduce(function(J,te){var oe;return Jr(Jr({},J),(oe={},oe[te]=a[te],oe))},{}),ee=(i=(t=a.components)===null||t===void 0?void 0:t.Months)!==null&&i!==void 0?i:PK;return L.jsx("div",Jr({className:z.join(" "),style:F,dir:d.dir,id:d.id,nonce:a.nonce,title:a.title,lang:a.lang},G,{children:L.jsx(ee,{children:b.displayMonths.map(function(J,te){return L.jsx(MK,{displayIndex:te,displayMonth:J},te)})})}))}function IK(e){var t=e.children,i=eX(e,["children"]);return L.jsx(vX,{initialProps:i,children:L.jsx(AX,{children:L.jsx(uK,{initialProps:i,children:L.jsx(jX,{initialProps:i,children:L.jsx(VX,{initialProps:i,children:L.jsx(XX,{children:L.jsx(lK,{children:t})})})})})})})}function kK(e){return L.jsx(IK,Jr({},e,{children:L.jsx(AK,{initialProps:e})}))}function M0({className:e,classNames:t,showOutsideDays:i=!0,...a}){return L.jsx(kK,{showOutsideDays:i,className:_r("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:_r(vC({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:_r(vC({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...d})=>L.jsx(Wz,{className:"h-4 w-4"}),IconRight:({...d})=>L.jsx(Zz,{className:"h-4 w-4"})},...a})}M0.displayName="Calendar";const RK=["top","right","bottom","left"],jd=Math.min,sa=Math.max,Vb=Math.round,N1=Math.floor,Bd=e=>({x:e,y:e}),DK={left:"right",right:"left",bottom:"top",top:"bottom"},LK={start:"end",end:"start"};function LC(e,t,i){return sa(e,jd(t,i))}function tu(e,t){return typeof e=="function"?e(t):e}function ru(e){return e.split("-")[0]}function Pg(e){return e.split("-")[1]}function RM(e){return e==="x"?"y":"x"}function DM(e){return e==="y"?"height":"width"}function Ud(e){return["top","bottom"].includes(ru(e))?"y":"x"}function LM(e){return RM(Ud(e))}function OK(e,t,i){i===void 0&&(i=!1);const a=Pg(e),d=LM(e),_=DM(d);let b=d==="x"?a===(i?"end":"start")?"right":"left":a==="start"?"bottom":"top";return t.reference[_]>t.floating[_]&&(b=$b(b)),[b,$b(b)]}function zK(e){const t=$b(e);return[OC(e),t,OC(t)]}function OC(e){return e.replace(/start|end/g,t=>LK[t])}function NK(e,t,i){const a=["left","right"],d=["right","left"],_=["top","bottom"],b=["bottom","top"];switch(e){case"top":case"bottom":return i?t?d:a:t?a:d;case"left":case"right":return t?_:b;default:return[]}}function FK(e,t,i,a){const d=Pg(e);let _=NK(ru(e),i==="start",a);return d&&(_=_.map(b=>b+"-"+d),t&&(_=_.concat(_.map(OC)))),_}function $b(e){return e.replace(/left|right|bottom|top/g,t=>DK[t])}function jK(e){return{top:0,right:0,bottom:0,left:0,...e}}function mN(e){return typeof e!="number"?jK(e):{top:e,right:e,bottom:e,left:e}}function Gb(e){const{x:t,y:i,width:a,height:d}=e;return{width:a,height:d,top:i,left:t,right:t+a,bottom:i+d,x:t,y:i}}function r4(e,t,i){let{reference:a,floating:d}=e;const _=Ud(t),b=LM(t),o=DM(b),k=ru(t),O=_==="y",z=a.x+a.width/2-d.width/2,F=a.y+a.height/2-d.height/2,G=a[o]/2-d[o]/2;let ee;switch(k){case"top":ee={x:z,y:a.y-d.height};break;case"bottom":ee={x:z,y:a.y+a.height};break;case"right":ee={x:a.x+a.width,y:F};break;case"left":ee={x:a.x-d.width,y:F};break;default:ee={x:a.x,y:a.y}}switch(Pg(t)){case"start":ee[b]-=G*(i&&O?-1:1);break;case"end":ee[b]+=G*(i&&O?-1:1);break}return ee}const BK=async(e,t,i)=>{const{placement:a="bottom",strategy:d="absolute",middleware:_=[],platform:b}=i,o=_.filter(Boolean),k=await(b.isRTL==null?void 0:b.isRTL(t));let O=await b.getElementRects({reference:e,floating:t,strategy:d}),{x:z,y:F}=r4(O,a,k),G=a,ee={},J=0;for(let te=0;te<o.length;te++){const{name:oe,fn:X}=o[te],{x:Q,y:ue,data:he,reset:Ie}=await X({x:z,y:F,initialPlacement:a,placement:G,strategy:d,middlewareData:ee,rects:O,platform:b,elements:{reference:e,floating:t}});z=Q??z,F=ue??F,ee={...ee,[oe]:{...ee[oe],...he}},Ie&&J<=50&&(J++,typeof Ie=="object"&&(Ie.placement&&(G=Ie.placement),Ie.rects&&(O=Ie.rects===!0?await b.getElementRects({reference:e,floating:t,strategy:d}):Ie.rects),{x:z,y:F}=r4(O,G,k)),te=-1)}return{x:z,y:F,placement:G,strategy:d,middlewareData:ee}};async function P0(e,t){var i;t===void 0&&(t={});const{x:a,y:d,platform:_,rects:b,elements:o,strategy:k}=e,{boundary:O="clippingAncestors",rootBoundary:z="viewport",elementContext:F="floating",altBoundary:G=!1,padding:ee=0}=tu(t,e),J=mN(ee),oe=o[G?F==="floating"?"reference":"floating":F],X=Gb(await _.getClippingRect({element:(i=await(_.isElement==null?void 0:_.isElement(oe)))==null||i?oe:oe.contextElement||await(_.getDocumentElement==null?void 0:_.getDocumentElement(o.floating)),boundary:O,rootBoundary:z,strategy:k})),Q=F==="floating"?{x:a,y:d,width:b.floating.width,height:b.floating.height}:b.reference,ue=await(_.getOffsetParent==null?void 0:_.getOffsetParent(o.floating)),he=await(_.isElement==null?void 0:_.isElement(ue))?await(_.getScale==null?void 0:_.getScale(ue))||{x:1,y:1}:{x:1,y:1},Ie=Gb(_.convertOffsetParentRelativeRectToViewportRelativeRect?await _.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:Q,offsetParent:ue,strategy:k}):Q);return{top:(X.top-Ie.top+J.top)/he.y,bottom:(Ie.bottom-X.bottom+J.bottom)/he.y,left:(X.left-Ie.left+J.left)/he.x,right:(Ie.right-X.right+J.right)/he.x}}const UK=e=>({name:"arrow",options:e,async fn(t){const{x:i,y:a,placement:d,rects:_,platform:b,elements:o,middlewareData:k}=t,{element:O,padding:z=0}=tu(e,t)||{};if(O==null)return{};const F=mN(z),G={x:i,y:a},ee=LM(d),J=DM(ee),te=await b.getDimensions(O),oe=ee==="y",X=oe?"top":"left",Q=oe?"bottom":"right",ue=oe?"clientHeight":"clientWidth",he=_.reference[J]+_.reference[ee]-G[ee]-_.floating[J],Ie=G[ee]-_.reference[ee],Je=await(b.getOffsetParent==null?void 0:b.getOffsetParent(O));let Ce=Je?Je[ue]:0;(!Ce||!await(b.isElement==null?void 0:b.isElement(Je)))&&(Ce=o.floating[ue]||_.floating[J]);const Ze=he/2-Ie/2,et=Ce/2-te[J]/2-1,Ge=jd(F[X],et),qe=jd(F[Q],et),_t=Ge,Rt=Ce-te[J]-qe,Wt=Ce/2-te[J]/2+Ze,wt=LC(_t,Wt,Rt),jt=!k.arrow&&Pg(d)!=null&&Wt!==wt&&_.reference[J]/2-(Wt<_t?Ge:qe)-te[J]/2<0,Ct=jt?Wt<_t?Wt-_t:Wt-Rt:0;return{[ee]:G[ee]+Ct,data:{[ee]:wt,centerOffset:Wt-wt-Ct,...jt&&{alignmentOffset:Ct}},reset:jt}}}),VK=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var i,a;const{placement:d,middlewareData:_,rects:b,initialPlacement:o,platform:k,elements:O}=t,{mainAxis:z=!0,crossAxis:F=!0,fallbackPlacements:G,fallbackStrategy:ee="bestFit",fallbackAxisSideDirection:J="none",flipAlignment:te=!0,...oe}=tu(e,t);if((i=_.arrow)!=null&&i.alignmentOffset)return{};const X=ru(d),Q=Ud(o),ue=ru(o)===o,he=await(k.isRTL==null?void 0:k.isRTL(O.floating)),Ie=G||(ue||!te?[$b(o)]:zK(o)),Je=J!=="none";!G&&Je&&Ie.push(...FK(o,te,J,he));const Ce=[o,...Ie],Ze=await P0(t,oe),et=[];let Ge=((a=_.flip)==null?void 0:a.overflows)||[];if(z&&et.push(Ze[X]),F){const Wt=OK(d,b,he);et.push(Ze[Wt[0]],Ze[Wt[1]])}if(Ge=[...Ge,{placement:d,overflows:et}],!et.every(Wt=>Wt<=0)){var qe,_t;const Wt=(((qe=_.flip)==null?void 0:qe.index)||0)+1,wt=Ce[Wt];if(wt)return{data:{index:Wt,overflows:Ge},reset:{placement:wt}};let jt=(_t=Ge.filter(Ct=>Ct.overflows[0]<=0).sort((Ct,st)=>Ct.overflows[1]-st.overflows[1])[0])==null?void 0:_t.placement;if(!jt)switch(ee){case"bestFit":{var Rt;const Ct=(Rt=Ge.filter(st=>{if(Je){const yt=Ud(st.placement);return yt===Q||yt==="y"}return!0}).map(st=>[st.placement,st.overflows.filter(yt=>yt>0).reduce((yt,ir)=>yt+ir,0)]).sort((st,yt)=>st[1]-yt[1])[0])==null?void 0:Rt[0];Ct&&(jt=Ct);break}case"initialPlacement":jt=o;break}if(d!==jt)return{reset:{placement:jt}}}return{}}}};function n4(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function i4(e){return RK.some(t=>e[t]>=0)}const $K=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:i}=t,{strategy:a="referenceHidden",...d}=tu(e,t);switch(a){case"referenceHidden":{const _=await P0(t,{...d,elementContext:"reference"}),b=n4(_,i.reference);return{data:{referenceHiddenOffsets:b,referenceHidden:i4(b)}}}case"escaped":{const _=await P0(t,{...d,altBoundary:!0}),b=n4(_,i.floating);return{data:{escapedOffsets:b,escaped:i4(b)}}}default:return{}}}}};async function GK(e,t){const{placement:i,platform:a,elements:d}=e,_=await(a.isRTL==null?void 0:a.isRTL(d.floating)),b=ru(i),o=Pg(i),k=Ud(i)==="y",O=["left","top"].includes(b)?-1:1,z=_&&k?-1:1,F=tu(t,e);let{mainAxis:G,crossAxis:ee,alignmentAxis:J}=typeof F=="number"?{mainAxis:F,crossAxis:0,alignmentAxis:null}:{mainAxis:F.mainAxis||0,crossAxis:F.crossAxis||0,alignmentAxis:F.alignmentAxis};return o&&typeof J=="number"&&(ee=o==="end"?J*-1:J),k?{x:ee*z,y:G*O}:{x:G*O,y:ee*z}}const HK=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var i,a;const{x:d,y:_,placement:b,middlewareData:o}=t,k=await GK(t,e);return b===((i=o.offset)==null?void 0:i.placement)&&(a=o.arrow)!=null&&a.alignmentOffset?{}:{x:d+k.x,y:_+k.y,data:{...k,placement:b}}}}},qK=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:i,y:a,placement:d}=t,{mainAxis:_=!0,crossAxis:b=!1,limiter:o={fn:oe=>{let{x:X,y:Q}=oe;return{x:X,y:Q}}},...k}=tu(e,t),O={x:i,y:a},z=await P0(t,k),F=Ud(ru(d)),G=RM(F);let ee=O[G],J=O[F];if(_){const oe=G==="y"?"top":"left",X=G==="y"?"bottom":"right",Q=ee+z[oe],ue=ee-z[X];ee=LC(Q,ee,ue)}if(b){const oe=F==="y"?"top":"left",X=F==="y"?"bottom":"right",Q=J+z[oe],ue=J-z[X];J=LC(Q,J,ue)}const te=o.fn({...t,[G]:ee,[F]:J});return{...te,data:{x:te.x-i,y:te.y-a,enabled:{[G]:_,[F]:b}}}}}},WK=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:i,y:a,placement:d,rects:_,middlewareData:b}=t,{offset:o=0,mainAxis:k=!0,crossAxis:O=!0}=tu(e,t),z={x:i,y:a},F=Ud(d),G=RM(F);let ee=z[G],J=z[F];const te=tu(o,t),oe=typeof te=="number"?{mainAxis:te,crossAxis:0}:{mainAxis:0,crossAxis:0,...te};if(k){const ue=G==="y"?"height":"width",he=_.reference[G]-_.floating[ue]+oe.mainAxis,Ie=_.reference[G]+_.reference[ue]-oe.mainAxis;ee<he?ee=he:ee>Ie&&(ee=Ie)}if(O){var X,Q;const ue=G==="y"?"width":"height",he=["top","left"].includes(ru(d)),Ie=_.reference[F]-_.floating[ue]+(he&&((X=b.offset)==null?void 0:X[F])||0)+(he?0:oe.crossAxis),Je=_.reference[F]+_.reference[ue]+(he?0:((Q=b.offset)==null?void 0:Q[F])||0)-(he?oe.crossAxis:0);J<Ie?J=Ie:J>Je&&(J=Je)}return{[G]:ee,[F]:J}}}},ZK=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var i,a;const{placement:d,rects:_,platform:b,elements:o}=t,{apply:k=()=>{},...O}=tu(e,t),z=await P0(t,O),F=ru(d),G=Pg(d),ee=Ud(d)==="y",{width:J,height:te}=_.floating;let oe,X;F==="top"||F==="bottom"?(oe=F,X=G===(await(b.isRTL==null?void 0:b.isRTL(o.floating))?"start":"end")?"left":"right"):(X=F,oe=G==="end"?"top":"bottom");const Q=te-z.top-z.bottom,ue=J-z.left-z.right,he=jd(te-z[oe],Q),Ie=jd(J-z[X],ue),Je=!t.middlewareData.shift;let Ce=he,Ze=Ie;if((i=t.middlewareData.shift)!=null&&i.enabled.x&&(Ze=ue),(a=t.middlewareData.shift)!=null&&a.enabled.y&&(Ce=Q),Je&&!G){const Ge=sa(z.left,0),qe=sa(z.right,0),_t=sa(z.top,0),Rt=sa(z.bottom,0);ee?Ze=J-2*(Ge!==0||qe!==0?Ge+qe:sa(z.left,z.right)):Ce=te-2*(_t!==0||Rt!==0?_t+Rt:sa(z.top,z.bottom))}await k({...t,availableWidth:Ze,availableHeight:Ce});const et=await b.getDimensions(o.floating);return J!==et.width||te!==et.height?{reset:{rects:!0}}:{}}}};function Ow(){return typeof window<"u"}function Ag(e){return gN(e)?(e.nodeName||"").toLowerCase():"#document"}function ca(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function ac(e){var t;return(t=(gN(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function gN(e){return Ow()?e instanceof Node||e instanceof ca(e).Node:!1}function bl(e){return Ow()?e instanceof Element||e instanceof ca(e).Element:!1}function oc(e){return Ow()?e instanceof HTMLElement||e instanceof ca(e).HTMLElement:!1}function o4(e){return!Ow()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof ca(e).ShadowRoot}function sv(e){const{overflow:t,overflowX:i,overflowY:a,display:d}=wl(e);return/auto|scroll|overlay|hidden|clip/.test(t+a+i)&&!["inline","contents"].includes(d)}function YK(e){return["table","td","th"].includes(Ag(e))}function zw(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function OM(e){const t=zM(),i=bl(e)?wl(e):e;return i.transform!=="none"||i.perspective!=="none"||(i.containerType?i.containerType!=="normal":!1)||!t&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!t&&(i.filter?i.filter!=="none":!1)||["transform","perspective","filter"].some(a=>(i.willChange||"").includes(a))||["paint","layout","strict","content"].some(a=>(i.contain||"").includes(a))}function XK(e){let t=Vd(e);for(;oc(t)&&!hg(t);){if(OM(t))return t;if(zw(t))return null;t=Vd(t)}return null}function zM(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function hg(e){return["html","body","#document"].includes(Ag(e))}function wl(e){return ca(e).getComputedStyle(e)}function Nw(e){return bl(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Vd(e){if(Ag(e)==="html")return e;const t=e.assignedSlot||e.parentNode||o4(e)&&e.host||ac(e);return o4(t)?t.host:t}function _N(e){const t=Vd(e);return hg(t)?e.ownerDocument?e.ownerDocument.body:e.body:oc(t)&&sv(t)?t:_N(t)}function A0(e,t,i){var a;t===void 0&&(t=[]),i===void 0&&(i=!0);const d=_N(e),_=d===((a=e.ownerDocument)==null?void 0:a.body),b=ca(d);if(_){const o=zC(b);return t.concat(b,b.visualViewport||[],sv(d)?d:[],o&&i?A0(o):[])}return t.concat(d,A0(d,[],i))}function zC(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function yN(e){const t=wl(e);let i=parseFloat(t.width)||0,a=parseFloat(t.height)||0;const d=oc(e),_=d?e.offsetWidth:i,b=d?e.offsetHeight:a,o=Vb(i)!==_||Vb(a)!==b;return o&&(i=_,a=b),{width:i,height:a,$:o}}function NM(e){return bl(e)?e:e.contextElement}function Um(e){const t=NM(e);if(!oc(t))return Bd(1);const i=t.getBoundingClientRect(),{width:a,height:d,$:_}=yN(t);let b=(_?Vb(i.width):i.width)/a,o=(_?Vb(i.height):i.height)/d;return(!b||!Number.isFinite(b))&&(b=1),(!o||!Number.isFinite(o))&&(o=1),{x:b,y:o}}const KK=Bd(0);function vN(e){const t=ca(e);return!zM()||!t.visualViewport?KK:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function JK(e,t,i){return t===void 0&&(t=!1),!i||t&&i!==ca(e)?!1:t}function Ef(e,t,i,a){t===void 0&&(t=!1),i===void 0&&(i=!1);const d=e.getBoundingClientRect(),_=NM(e);let b=Bd(1);t&&(a?bl(a)&&(b=Um(a)):b=Um(e));const o=JK(_,i,a)?vN(_):Bd(0);let k=(d.left+o.x)/b.x,O=(d.top+o.y)/b.y,z=d.width/b.x,F=d.height/b.y;if(_){const G=ca(_),ee=a&&bl(a)?ca(a):a;let J=G,te=zC(J);for(;te&&a&&ee!==J;){const oe=Um(te),X=te.getBoundingClientRect(),Q=wl(te),ue=X.left+(te.clientLeft+parseFloat(Q.paddingLeft))*oe.x,he=X.top+(te.clientTop+parseFloat(Q.paddingTop))*oe.y;k*=oe.x,O*=oe.y,z*=oe.x,F*=oe.y,k+=ue,O+=he,J=ca(te),te=zC(J)}}return Gb({width:z,height:F,x:k,y:O})}function QK(e){let{elements:t,rect:i,offsetParent:a,strategy:d}=e;const _=d==="fixed",b=ac(a),o=t?zw(t.floating):!1;if(a===b||o&&_)return i;let k={scrollLeft:0,scrollTop:0},O=Bd(1);const z=Bd(0),F=oc(a);if((F||!F&&!_)&&((Ag(a)!=="body"||sv(b))&&(k=Nw(a)),oc(a))){const G=Ef(a);O=Um(a),z.x=G.x+a.clientLeft,z.y=G.y+a.clientTop}return{width:i.width*O.x,height:i.height*O.y,x:i.x*O.x-k.scrollLeft*O.x+z.x,y:i.y*O.y-k.scrollTop*O.y+z.y}}function eJ(e){return Array.from(e.getClientRects())}function NC(e,t){const i=Nw(e).scrollLeft;return t?t.left+i:Ef(ac(e)).left+i}function tJ(e){const t=ac(e),i=Nw(e),a=e.ownerDocument.body,d=sa(t.scrollWidth,t.clientWidth,a.scrollWidth,a.clientWidth),_=sa(t.scrollHeight,t.clientHeight,a.scrollHeight,a.clientHeight);let b=-i.scrollLeft+NC(e);const o=-i.scrollTop;return wl(a).direction==="rtl"&&(b+=sa(t.clientWidth,a.clientWidth)-d),{width:d,height:_,x:b,y:o}}function rJ(e,t){const i=ca(e),a=ac(e),d=i.visualViewport;let _=a.clientWidth,b=a.clientHeight,o=0,k=0;if(d){_=d.width,b=d.height;const O=zM();(!O||O&&t==="fixed")&&(o=d.offsetLeft,k=d.offsetTop)}return{width:_,height:b,x:o,y:k}}function nJ(e,t){const i=Ef(e,!0,t==="fixed"),a=i.top+e.clientTop,d=i.left+e.clientLeft,_=oc(e)?Um(e):Bd(1),b=e.clientWidth*_.x,o=e.clientHeight*_.y,k=d*_.x,O=a*_.y;return{width:b,height:o,x:k,y:O}}function s4(e,t,i){let a;if(t==="viewport")a=rJ(e,i);else if(t==="document")a=tJ(ac(e));else if(bl(t))a=nJ(t,i);else{const d=vN(e);a={...t,x:t.x-d.x,y:t.y-d.y}}return Gb(a)}function xN(e,t){const i=Vd(e);return i===t||!bl(i)||hg(i)?!1:wl(i).position==="fixed"||xN(i,t)}function iJ(e,t){const i=t.get(e);if(i)return i;let a=A0(e,[],!1).filter(o=>bl(o)&&Ag(o)!=="body"),d=null;const _=wl(e).position==="fixed";let b=_?Vd(e):e;for(;bl(b)&&!hg(b);){const o=wl(b),k=OM(b);!k&&o.position==="fixed"&&(d=null),(_?!k&&!d:!k&&o.position==="static"&&!!d&&["absolute","fixed"].includes(d.position)||sv(b)&&!k&&xN(e,b))?a=a.filter(z=>z!==b):d=o,b=Vd(b)}return t.set(e,a),a}function oJ(e){let{element:t,boundary:i,rootBoundary:a,strategy:d}=e;const b=[...i==="clippingAncestors"?zw(t)?[]:iJ(t,this._c):[].concat(i),a],o=b[0],k=b.reduce((O,z)=>{const F=s4(t,z,d);return O.top=sa(F.top,O.top),O.right=jd(F.right,O.right),O.bottom=jd(F.bottom,O.bottom),O.left=sa(F.left,O.left),O},s4(t,o,d));return{width:k.right-k.left,height:k.bottom-k.top,x:k.left,y:k.top}}function sJ(e){const{width:t,height:i}=yN(e);return{width:t,height:i}}function aJ(e,t,i){const a=oc(t),d=ac(t),_=i==="fixed",b=Ef(e,!0,_,t);let o={scrollLeft:0,scrollTop:0};const k=Bd(0);if(a||!a&&!_)if((Ag(t)!=="body"||sv(d))&&(o=Nw(t)),a){const ee=Ef(t,!0,_,t);k.x=ee.x+t.clientLeft,k.y=ee.y+t.clientTop}else d&&(k.x=NC(d));let O=0,z=0;if(d&&!a&&!_){const ee=d.getBoundingClientRect();z=ee.top+o.scrollTop,O=ee.left+o.scrollLeft-NC(d,ee)}const F=b.left+o.scrollLeft-k.x-O,G=b.top+o.scrollTop-k.y-z;return{x:F,y:G,width:b.width,height:b.height}}function WT(e){return wl(e).position==="static"}function a4(e,t){if(!oc(e)||wl(e).position==="fixed")return null;if(t)return t(e);let i=e.offsetParent;return ac(e)===i&&(i=i.ownerDocument.body),i}function bN(e,t){const i=ca(e);if(zw(e))return i;if(!oc(e)){let d=Vd(e);for(;d&&!hg(d);){if(bl(d)&&!WT(d))return d;d=Vd(d)}return i}let a=a4(e,t);for(;a&&YK(a)&&WT(a);)a=a4(a,t);return a&&hg(a)&&WT(a)&&!OM(a)?i:a||XK(e)||i}const lJ=async function(e){const t=this.getOffsetParent||bN,i=this.getDimensions,a=await i(e.floating);return{reference:aJ(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function cJ(e){return wl(e).direction==="rtl"}const uJ={convertOffsetParentRelativeRectToViewportRelativeRect:QK,getDocumentElement:ac,getClippingRect:oJ,getOffsetParent:bN,getElementRects:lJ,getClientRects:eJ,getDimensions:sJ,getScale:Um,isElement:bl,isRTL:cJ};function dJ(e,t){let i=null,a;const d=ac(e);function _(){var o;clearTimeout(a),(o=i)==null||o.disconnect(),i=null}function b(o,k){o===void 0&&(o=!1),k===void 0&&(k=1),_();const{left:O,top:z,width:F,height:G}=e.getBoundingClientRect();if(o||t(),!F||!G)return;const ee=N1(z),J=N1(d.clientWidth-(O+F)),te=N1(d.clientHeight-(z+G)),oe=N1(O),Q={rootMargin:-ee+"px "+-J+"px "+-te+"px "+-oe+"px",threshold:sa(0,jd(1,k))||1};let ue=!0;function he(Ie){const Je=Ie[0].intersectionRatio;if(Je!==k){if(!ue)return b();Je?b(!1,Je):a=setTimeout(()=>{b(!1,1e-7)},1e3)}ue=!1}try{i=new IntersectionObserver(he,{...Q,root:d.ownerDocument})}catch{i=new IntersectionObserver(he,Q)}i.observe(e)}return b(!0),_}function hJ(e,t,i,a){a===void 0&&(a={});const{ancestorScroll:d=!0,ancestorResize:_=!0,elementResize:b=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:k=!1}=a,O=NM(e),z=d||_?[...O?A0(O):[],...A0(t)]:[];z.forEach(X=>{d&&X.addEventListener("scroll",i,{passive:!0}),_&&X.addEventListener("resize",i)});const F=O&&o?dJ(O,i):null;let G=-1,ee=null;b&&(ee=new ResizeObserver(X=>{let[Q]=X;Q&&Q.target===O&&ee&&(ee.unobserve(t),cancelAnimationFrame(G),G=requestAnimationFrame(()=>{var ue;(ue=ee)==null||ue.observe(t)})),i()}),O&&!k&&ee.observe(O),ee.observe(t));let J,te=k?Ef(e):null;k&&oe();function oe(){const X=Ef(e);te&&(X.x!==te.x||X.y!==te.y||X.width!==te.width||X.height!==te.height)&&i(),te=X,J=requestAnimationFrame(oe)}return i(),()=>{var X;z.forEach(Q=>{d&&Q.removeEventListener("scroll",i),_&&Q.removeEventListener("resize",i)}),F==null||F(),(X=ee)==null||X.disconnect(),ee=null,k&&cancelAnimationFrame(J)}}const fJ=HK,pJ=qK,mJ=VK,gJ=ZK,_J=$K,l4=UK,yJ=WK,vJ=(e,t,i)=>{const a=new Map,d={platform:uJ,...i},_={...d.platform,_c:a};return BK(e,t,{...d,platform:_})};var rb=typeof document<"u"?Y.useLayoutEffect:Y.useEffect;function Hb(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let i,a,d;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(i=e.length,i!==t.length)return!1;for(a=i;a--!==0;)if(!Hb(e[a],t[a]))return!1;return!0}if(d=Object.keys(e),i=d.length,i!==Object.keys(t).length)return!1;for(a=i;a--!==0;)if(!{}.hasOwnProperty.call(t,d[a]))return!1;for(a=i;a--!==0;){const _=d[a];if(!(_==="_owner"&&e.$$typeof)&&!Hb(e[_],t[_]))return!1}return!0}return e!==e&&t!==t}function wN(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function c4(e,t){const i=wN(e);return Math.round(t*i)/i}function ZT(e){const t=Y.useRef(e);return rb(()=>{t.current=e}),t}function xJ(e){e===void 0&&(e={});const{placement:t="bottom",strategy:i="absolute",middleware:a=[],platform:d,elements:{reference:_,floating:b}={},transform:o=!0,whileElementsMounted:k,open:O}=e,[z,F]=Y.useState({x:0,y:0,strategy:i,placement:t,middlewareData:{},isPositioned:!1}),[G,ee]=Y.useState(a);Hb(G,a)||ee(a);const[J,te]=Y.useState(null),[oe,X]=Y.useState(null),Q=Y.useCallback(st=>{st!==Je.current&&(Je.current=st,te(st))},[]),ue=Y.useCallback(st=>{st!==Ce.current&&(Ce.current=st,X(st))},[]),he=_||J,Ie=b||oe,Je=Y.useRef(null),Ce=Y.useRef(null),Ze=Y.useRef(z),et=k!=null,Ge=ZT(k),qe=ZT(d),_t=ZT(O),Rt=Y.useCallback(()=>{if(!Je.current||!Ce.current)return;const st={placement:t,strategy:i,middleware:G};qe.current&&(st.platform=qe.current),vJ(Je.current,Ce.current,st).then(yt=>{const ir={...yt,isPositioned:_t.current!==!1};Wt.current&&!Hb(Ze.current,ir)&&(Ze.current=ir,xg.flushSync(()=>{F(ir)}))})},[G,t,i,qe,_t]);rb(()=>{O===!1&&Ze.current.isPositioned&&(Ze.current.isPositioned=!1,F(st=>({...st,isPositioned:!1})))},[O]);const Wt=Y.useRef(!1);rb(()=>(Wt.current=!0,()=>{Wt.current=!1}),[]),rb(()=>{if(he&&(Je.current=he),Ie&&(Ce.current=Ie),he&&Ie){if(Ge.current)return Ge.current(he,Ie,Rt);Rt()}},[he,Ie,Rt,Ge,et]);const wt=Y.useMemo(()=>({reference:Je,floating:Ce,setReference:Q,setFloating:ue}),[Q,ue]),jt=Y.useMemo(()=>({reference:he,floating:Ie}),[he,Ie]),Ct=Y.useMemo(()=>{const st={position:i,left:0,top:0};if(!jt.floating)return st;const yt=c4(jt.floating,z.x),ir=c4(jt.floating,z.y);return o?{...st,transform:"translate("+yt+"px, "+ir+"px)",...wN(jt.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:yt,top:ir}},[i,o,jt.floating,z.x,z.y]);return Y.useMemo(()=>({...z,update:Rt,refs:wt,elements:jt,floatingStyles:Ct}),[z,Rt,wt,jt,Ct])}const bJ=e=>{function t(i){return{}.hasOwnProperty.call(i,"current")}return{name:"arrow",options:e,fn(i){const{element:a,padding:d}=typeof e=="function"?e(i):e;return a&&t(a)?a.current!=null?l4({element:a.current,padding:d}).fn(i):{}:a?l4({element:a,padding:d}).fn(i):{}}}},wJ=(e,t)=>({...fJ(e),options:[e,t]}),SJ=(e,t)=>({...pJ(e),options:[e,t]}),TJ=(e,t)=>({...yJ(e),options:[e,t]}),EJ=(e,t)=>({...mJ(e),options:[e,t]}),CJ=(e,t)=>({...gJ(e),options:[e,t]}),MJ=(e,t)=>({..._J(e),options:[e,t]}),PJ=(e,t)=>({...bJ(e),options:[e,t]});var AJ="Arrow",SN=Y.forwardRef((e,t)=>{const{children:i,width:a=10,height:d=5,..._}=e;return L.jsx(ln.svg,{..._,ref:t,width:a,height:d,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?i:L.jsx("polygon",{points:"0,0 30,0 15,10"})})});SN.displayName=AJ;var IJ=SN;function kJ(e,t=[]){let i=[];function a(_,b){const o=Y.createContext(b),k=i.length;i=[...i,b];function O(F){const{scope:G,children:ee,...J}=F,te=(G==null?void 0:G[e][k])||o,oe=Y.useMemo(()=>J,Object.values(J));return L.jsx(te.Provider,{value:oe,children:ee})}function z(F,G){const ee=(G==null?void 0:G[e][k])||o,J=Y.useContext(ee);if(J)return J;if(b!==void 0)return b;throw new Error(`\`${F}\` must be used within \`${_}\``)}return O.displayName=_+"Provider",[O,z]}const d=()=>{const _=i.map(b=>Y.createContext(b));return function(o){const k=(o==null?void 0:o[e])||_;return Y.useMemo(()=>({[`__scope${e}`]:{...o,[e]:k}}),[o,k])}};return d.scopeName=e,[a,RJ(d,...t)]}function RJ(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(_){const b=a.reduce((o,{useScope:k,scopeName:O})=>{const F=k(_)[`__scope${O}`];return{...o,...F}},{});return Y.useMemo(()=>({[`__scope${t.scopeName}`]:b}),[b])}};return i.scopeName=t.scopeName,i}function DJ(e){const[t,i]=Y.useState(void 0);return Do(()=>{if(e){i({width:e.offsetWidth,height:e.offsetHeight});const a=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;const _=d[0];let b,o;if("borderBoxSize"in _){const k=_.borderBoxSize,O=Array.isArray(k)?k[0]:k;b=O.inlineSize,o=O.blockSize}else b=e.offsetWidth,o=e.offsetHeight;i({width:b,height:o})});return a.observe(e,{box:"border-box"}),()=>a.unobserve(e)}else i(void 0)},[e]),t}var FM="Popper",[TN,Ig]=kJ(FM),[LJ,EN]=TN(FM),CN=e=>{const{__scopePopper:t,children:i}=e,[a,d]=Y.useState(null);return L.jsx(LJ,{scope:t,anchor:a,onAnchorChange:d,children:i})};CN.displayName=FM;var MN="PopperAnchor",PN=Y.forwardRef((e,t)=>{const{__scopePopper:i,virtualRef:a,...d}=e,_=EN(MN,i),b=Y.useRef(null),o=Qn(t,b);return Y.useEffect(()=>{_.onAnchorChange((a==null?void 0:a.current)||b.current)}),a?null:L.jsx(ln.div,{...d,ref:o})});PN.displayName=MN;var jM="PopperContent",[OJ,zJ]=TN(jM),AN=Y.forwardRef((e,t)=>{var cr,Lr,cn,Me,fr,Yt;const{__scopePopper:i,side:a="bottom",sideOffset:d=0,align:_="center",alignOffset:b=0,arrowPadding:o=0,avoidCollisions:k=!0,collisionBoundary:O=[],collisionPadding:z=0,sticky:F="partial",hideWhenDetached:G=!1,updatePositionStrategy:ee="optimized",onPlaced:J,...te}=e,oe=EN(jM,i),[X,Q]=Y.useState(null),ue=Qn(t,tr=>Q(tr)),[he,Ie]=Y.useState(null),Je=DJ(he),Ce=(Je==null?void 0:Je.width)??0,Ze=(Je==null?void 0:Je.height)??0,et=a+(_!=="center"?"-"+_:""),Ge=typeof z=="number"?z:{top:0,right:0,bottom:0,left:0,...z},qe=Array.isArray(O)?O:[O],_t=qe.length>0,Rt={padding:Ge,boundary:qe.filter(FJ),altBoundary:_t},{refs:Wt,floatingStyles:wt,placement:jt,isPositioned:Ct,middlewareData:st}=xJ({strategy:"fixed",placement:et,whileElementsMounted:(...tr)=>hJ(...tr,{animationFrame:ee==="always"}),elements:{reference:oe.anchor},middleware:[wJ({mainAxis:d+Ze,alignmentAxis:b}),k&&SJ({mainAxis:!0,crossAxis:!1,limiter:F==="partial"?TJ():void 0,...Rt}),k&&EJ({...Rt}),CJ({...Rt,apply:({elements:tr,rects:vt,availableWidth:Mn,availableHeight:hn})=>{const{width:ei,height:je}=vt.reference,dt=tr.floating.style;dt.setProperty("--radix-popper-available-width",`${Mn}px`),dt.setProperty("--radix-popper-available-height",`${hn}px`),dt.setProperty("--radix-popper-anchor-width",`${ei}px`),dt.setProperty("--radix-popper-anchor-height",`${je}px`)}}),he&&PJ({element:he,padding:o}),jJ({arrowWidth:Ce,arrowHeight:Ze}),G&&MJ({strategy:"referenceHidden",...Rt})]}),[yt,ir]=RN(jt),yr=Io(J);Do(()=>{Ct&&(yr==null||yr())},[Ct,yr]);const Wr=(cr=st.arrow)==null?void 0:cr.x,rr=(Lr=st.arrow)==null?void 0:Lr.y,dn=((cn=st.arrow)==null?void 0:cn.centerOffset)!==0,[Dn,sn]=Y.useState();return Do(()=>{X&&sn(window.getComputedStyle(X).zIndex)},[X]),L.jsx("div",{ref:Wt.setFloating,"data-radix-popper-content-wrapper":"",style:{...wt,transform:Ct?wt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Dn,"--radix-popper-transform-origin":[(Me=st.transformOrigin)==null?void 0:Me.x,(fr=st.transformOrigin)==null?void 0:fr.y].join(" "),...((Yt=st.hide)==null?void 0:Yt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:L.jsx(OJ,{scope:i,placedSide:yt,onArrowChange:Ie,arrowX:Wr,arrowY:rr,shouldHideArrow:dn,children:L.jsx(ln.div,{"data-side":yt,"data-align":ir,...te,ref:ue,style:{...te.style,animation:Ct?void 0:"none"}})})})});AN.displayName=jM;var IN="PopperArrow",NJ={top:"bottom",right:"left",bottom:"top",left:"right"},kN=Y.forwardRef(function(t,i){const{__scopePopper:a,...d}=t,_=zJ(IN,a),b=NJ[_.placedSide];return L.jsx("span",{ref:_.onArrowChange,style:{position:"absolute",left:_.arrowX,top:_.arrowY,[b]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[_.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[_.placedSide],visibility:_.shouldHideArrow?"hidden":void 0},children:L.jsx(IJ,{...d,ref:i,style:{...d.style,display:"block"}})})});kN.displayName=IN;function FJ(e){return e!==null}var jJ=e=>({name:"transformOrigin",options:e,fn(t){var oe,X,Q;const{placement:i,rects:a,middlewareData:d}=t,b=((oe=d.arrow)==null?void 0:oe.centerOffset)!==0,o=b?0:e.arrowWidth,k=b?0:e.arrowHeight,[O,z]=RN(i),F={start:"0%",center:"50%",end:"100%"}[z],G=(((X=d.arrow)==null?void 0:X.x)??0)+o/2,ee=(((Q=d.arrow)==null?void 0:Q.y)??0)+k/2;let J="",te="";return O==="bottom"?(J=b?F:`${G}px`,te=`${-k}px`):O==="top"?(J=b?F:`${G}px`,te=`${a.floating.height+k}px`):O==="right"?(J=`${-k}px`,te=b?F:`${ee}px`):O==="left"&&(J=`${a.floating.width+k}px`,te=b?F:`${ee}px`),{data:{x:J,y:te}}}});function RN(e){const[t,i="center"]=e.split("-");return[t,i]}var BM=CN,Fw=PN,UM=AN,VM=kN,$M="Popover",[DN,noe]=Rf($M,[Ig]),av=Ig(),[BJ,Wd]=DN($M),LN=e=>{const{__scopePopover:t,children:i,open:a,defaultOpen:d,onOpenChange:_,modal:b=!1}=e,o=av(t),k=Y.useRef(null),[O,z]=Y.useState(!1),[F=!1,G]=wf({prop:a,defaultProp:d,onChange:_});return L.jsx(BM,{...o,children:L.jsx(BJ,{scope:t,contentId:Wc(),triggerRef:k,open:F,onOpenChange:G,onOpenToggle:Y.useCallback(()=>G(ee=>!ee),[G]),hasCustomAnchor:O,onCustomAnchorAdd:Y.useCallback(()=>z(!0),[]),onCustomAnchorRemove:Y.useCallback(()=>z(!1),[]),modal:b,children:i})})};LN.displayName=$M;var ON="PopoverAnchor",UJ=Y.forwardRef((e,t)=>{const{__scopePopover:i,...a}=e,d=Wd(ON,i),_=av(i),{onCustomAnchorAdd:b,onCustomAnchorRemove:o}=d;return Y.useEffect(()=>(b(),()=>o()),[b,o]),L.jsx(Fw,{..._,...a,ref:t})});UJ.displayName=ON;var zN="PopoverTrigger",NN=Y.forwardRef((e,t)=>{const{__scopePopover:i,...a}=e,d=Wd(zN,i),_=av(i),b=Qn(t,d.triggerRef),o=L.jsx(ln.button,{type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":VN(d.open),...a,ref:b,onClick:Fr(e.onClick,d.onOpenToggle)});return d.hasCustomAnchor?o:L.jsx(Fw,{asChild:!0,..._,children:o})});NN.displayName=zN;var GM="PopoverPortal",[VJ,$J]=DN(GM,{forceMount:void 0}),FN=e=>{const{__scopePopover:t,forceMount:i,children:a,container:d}=e,_=Wd(GM,t);return L.jsx(VJ,{scope:t,forceMount:i,children:L.jsx(Ra,{present:i||_.open,children:L.jsx(kw,{asChild:!0,container:d,children:a})})})};FN.displayName=GM;var fg="PopoverContent",jN=Y.forwardRef((e,t)=>{const i=$J(fg,e.__scopePopover),{forceMount:a=i.forceMount,...d}=e,_=Wd(fg,e.__scopePopover);return L.jsx(Ra,{present:a||_.open,children:_.modal?L.jsx(GJ,{...d,ref:t}):L.jsx(HJ,{...d,ref:t})})});jN.displayName=fg;var GJ=Y.forwardRef((e,t)=>{const i=Wd(fg,e.__scopePopover),a=Y.useRef(null),d=Qn(t,a),_=Y.useRef(!1);return Y.useEffect(()=>{const b=a.current;if(b)return dM(b)},[]),L.jsx(Dw,{as:eu,allowPinchZoom:!0,children:L.jsx(BN,{...e,ref:d,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fr(e.onCloseAutoFocus,b=>{var o;b.preventDefault(),_.current||(o=i.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Fr(e.onPointerDownOutside,b=>{const o=b.detail.originalEvent,k=o.button===0&&o.ctrlKey===!0,O=o.button===2||k;_.current=O},{checkForDefaultPrevented:!1}),onFocusOutside:Fr(e.onFocusOutside,b=>b.preventDefault(),{checkForDefaultPrevented:!1})})})}),HJ=Y.forwardRef((e,t)=>{const i=Wd(fg,e.__scopePopover),a=Y.useRef(!1),d=Y.useRef(!1);return L.jsx(BN,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:_=>{var b,o;(b=e.onCloseAutoFocus)==null||b.call(e,_),_.defaultPrevented||(a.current||(o=i.triggerRef.current)==null||o.focus(),_.preventDefault()),a.current=!1,d.current=!1},onInteractOutside:_=>{var k,O;(k=e.onInteractOutside)==null||k.call(e,_),_.defaultPrevented||(a.current=!0,_.detail.originalEvent.type==="pointerdown"&&(d.current=!0));const b=_.target;((O=i.triggerRef.current)==null?void 0:O.contains(b))&&_.preventDefault(),_.detail.originalEvent.type==="focusin"&&d.current&&_.preventDefault()}})}),BN=Y.forwardRef((e,t)=>{const{__scopePopover:i,trapFocus:a,onOpenAutoFocus:d,onCloseAutoFocus:_,disableOutsidePointerEvents:b,onEscapeKeyDown:o,onPointerDownOutside:k,onFocusOutside:O,onInteractOutside:z,...F}=e,G=Wd(fg,i),ee=av(i);return uM(),L.jsx(Iw,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:d,onUnmountAutoFocus:_,children:L.jsx(K0,{asChild:!0,disableOutsidePointerEvents:b,onInteractOutside:z,onEscapeKeyDown:o,onPointerDownOutside:k,onFocusOutside:O,onDismiss:()=>G.onOpenChange(!1),children:L.jsx(UM,{"data-state":VN(G.open),role:"dialog",id:G.contentId,...ee,...F,ref:t,style:{...F.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),UN="PopoverClose",qJ=Y.forwardRef((e,t)=>{const{__scopePopover:i,...a}=e,d=Wd(UN,i);return L.jsx(ln.button,{type:"button",...a,ref:t,onClick:Fr(e.onClick,()=>d.onOpenChange(!1))})});qJ.displayName=UN;var WJ="PopoverArrow",ZJ=Y.forwardRef((e,t)=>{const{__scopePopover:i,...a}=e,d=av(i);return L.jsx(VM,{...d,...a,ref:t})});ZJ.displayName=WJ;function VN(e){return e?"open":"closed"}var YJ=LN,XJ=NN,KJ=FN,$N=jN;const FC=YJ,jC=XJ,qb=Y.forwardRef(({className:e,align:t="center",sideOffset:i=4,...a},d)=>L.jsx(KJ,{children:L.jsx($N,{ref:d,align:t,sideOffset:i,className:_r("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));qb.displayName=$N.displayName;function BC(e,[t,i]){return Math.min(i,Math.max(t,e))}function JJ(e,t=[]){let i=[];function a(_,b){const o=Y.createContext(b),k=i.length;i=[...i,b];function O(F){const{scope:G,children:ee,...J}=F,te=(G==null?void 0:G[e][k])||o,oe=Y.useMemo(()=>J,Object.values(J));return L.jsx(te.Provider,{value:oe,children:ee})}function z(F,G){const ee=(G==null?void 0:G[e][k])||o,J=Y.useContext(ee);if(J)return J;if(b!==void 0)return b;throw new Error(`\`${F}\` must be used within \`${_}\``)}return O.displayName=_+"Provider",[O,z]}const d=()=>{const _=i.map(b=>Y.createContext(b));return function(o){const k=(o==null?void 0:o[e])||_;return Y.useMemo(()=>({[`__scope${e}`]:{...o,[e]:k}}),[o,k])}};return d.scopeName=e,[a,QJ(d,...t)]}function QJ(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(_){const b=a.reduce((o,{useScope:k,scopeName:O})=>{const F=k(_)[`__scope${O}`];return{...o,...F}},{});return Y.useMemo(()=>({[`__scope${t.scopeName}`]:b}),[b])}};return i.scopeName=t.scopeName,i}function GN(e){const t=e+"CollectionProvider",[i,a]=JJ(t),[d,_]=i(t,{collectionRef:{current:null},itemMap:new Map}),b=ee=>{const{scope:J,children:te}=ee,oe=Fe.useRef(null),X=Fe.useRef(new Map).current;return L.jsx(d,{scope:J,itemMap:X,collectionRef:oe,children:te})};b.displayName=t;const o=e+"CollectionSlot",k=Fe.forwardRef((ee,J)=>{const{scope:te,children:oe}=ee,X=_(o,te),Q=Qn(J,X.collectionRef);return L.jsx(eu,{ref:Q,children:oe})});k.displayName=o;const O=e+"CollectionItemSlot",z="data-radix-collection-item",F=Fe.forwardRef((ee,J)=>{const{scope:te,children:oe,...X}=ee,Q=Fe.useRef(null),ue=Qn(J,Q),he=_(O,te);return Fe.useEffect(()=>(he.itemMap.set(Q,{ref:Q,...X}),()=>void he.itemMap.delete(Q))),L.jsx(eu,{[z]:"",ref:ue,children:oe})});F.displayName=O;function G(ee){const J=_(e+"CollectionConsumer",ee);return Fe.useCallback(()=>{const oe=J.collectionRef.current;if(!oe)return[];const X=Array.from(oe.querySelectorAll(`[${z}]`));return Array.from(J.itemMap.values()).sort((he,Ie)=>X.indexOf(he.ref.current)-X.indexOf(Ie.ref.current))},[J.collectionRef,J.itemMap])}return[{Provider:b,Slot:k,ItemSlot:F},G,a]}var eQ=Y.createContext(void 0);function jw(e){const t=Y.useContext(eQ);return e||t||"ltr"}function tQ(e){const t=Y.useRef({value:e,previous:e});return Y.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var rQ="VisuallyHidden",HN=Y.forwardRef((e,t)=>L.jsx(ln.span,{...e,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}));HN.displayName=rQ;var nQ=[" ","Enter","ArrowUp","ArrowDown"],iQ=[" ","Enter"],lv="Select",[Bw,Uw,oQ]=GN(lv),[kg,ioe]=Rf(lv,[oQ,Ig]),Vw=Ig(),[sQ,Zd]=kg(lv),[aQ,lQ]=kg(lv),qN=e=>{const{__scopeSelect:t,children:i,open:a,defaultOpen:d,onOpenChange:_,value:b,defaultValue:o,onValueChange:k,dir:O,name:z,autoComplete:F,disabled:G,required:ee,form:J}=e,te=Vw(t),[oe,X]=Y.useState(null),[Q,ue]=Y.useState(null),[he,Ie]=Y.useState(!1),Je=jw(O),[Ce=!1,Ze]=wf({prop:a,defaultProp:d,onChange:_}),[et,Ge]=wf({prop:b,defaultProp:o,onChange:k}),qe=Y.useRef(null),_t=oe?J||!!oe.closest("form"):!0,[Rt,Wt]=Y.useState(new Set),wt=Array.from(Rt).map(jt=>jt.props.value).join(";");return L.jsx(BM,{...te,children:L.jsxs(sQ,{required:ee,scope:t,trigger:oe,onTriggerChange:X,valueNode:Q,onValueNodeChange:ue,valueNodeHasChildren:he,onValueNodeHasChildrenChange:Ie,contentId:Wc(),value:et,onValueChange:Ge,open:Ce,onOpenChange:Ze,dir:Je,triggerPointerDownPosRef:qe,disabled:G,children:[L.jsx(Bw.Provider,{scope:t,children:L.jsx(aQ,{scope:e.__scopeSelect,onNativeOptionAdd:Y.useCallback(jt=>{Wt(Ct=>new Set(Ct).add(jt))},[]),onNativeOptionRemove:Y.useCallback(jt=>{Wt(Ct=>{const st=new Set(Ct);return st.delete(jt),st})},[]),children:i})}),_t?L.jsxs(_F,{"aria-hidden":!0,required:ee,tabIndex:-1,name:z,autoComplete:F,value:et,onChange:jt=>Ge(jt.target.value),disabled:G,form:J,children:[et===void 0?L.jsx("option",{value:""}):null,Array.from(Rt)]},wt):null]})})};qN.displayName=lv;var WN="SelectTrigger",ZN=Y.forwardRef((e,t)=>{const{__scopeSelect:i,disabled:a=!1,...d}=e,_=Vw(i),b=Zd(WN,i),o=b.disabled||a,k=Qn(t,b.onTriggerChange),O=Uw(i),z=Y.useRef("touch"),[F,G,ee]=yF(te=>{const oe=O().filter(ue=>!ue.disabled),X=oe.find(ue=>ue.value===b.value),Q=vF(oe,te,X);Q!==void 0&&b.onValueChange(Q.value)}),J=te=>{o||(b.onOpenChange(!0),ee()),te&&(b.triggerPointerDownPosRef.current={x:Math.round(te.pageX),y:Math.round(te.pageY)})};return L.jsx(Fw,{asChild:!0,..._,children:L.jsx(ln.button,{type:"button",role:"combobox","aria-controls":b.contentId,"aria-expanded":b.open,"aria-required":b.required,"aria-autocomplete":"none",dir:b.dir,"data-state":b.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":gF(b.value)?"":void 0,...d,ref:k,onClick:Fr(d.onClick,te=>{te.currentTarget.focus(),z.current!=="mouse"&&J(te)}),onPointerDown:Fr(d.onPointerDown,te=>{z.current=te.pointerType;const oe=te.target;oe.hasPointerCapture(te.pointerId)&&oe.releasePointerCapture(te.pointerId),te.button===0&&te.ctrlKey===!1&&te.pointerType==="mouse"&&(J(te),te.preventDefault())}),onKeyDown:Fr(d.onKeyDown,te=>{const oe=F.current!=="";!(te.ctrlKey||te.altKey||te.metaKey)&&te.key.length===1&&G(te.key),!(oe&&te.key===" ")&&nQ.includes(te.key)&&(J(),te.preventDefault())})})})});ZN.displayName=WN;var YN="SelectValue",XN=Y.forwardRef((e,t)=>{const{__scopeSelect:i,className:a,style:d,children:_,placeholder:b="",...o}=e,k=Zd(YN,i),{onValueNodeHasChildrenChange:O}=k,z=_!==void 0,F=Qn(t,k.onValueNodeChange);return Do(()=>{O(z)},[O,z]),L.jsx(ln.span,{...o,ref:F,style:{pointerEvents:"none"},children:gF(k.value)?L.jsx(L.Fragment,{children:b}):_})});XN.displayName=YN;var cQ="SelectIcon",KN=Y.forwardRef((e,t)=>{const{__scopeSelect:i,children:a,...d}=e;return L.jsx(ln.span,{"aria-hidden":!0,...d,ref:t,children:a||""})});KN.displayName=cQ;var uQ="SelectPortal",JN=e=>L.jsx(kw,{asChild:!0,...e});JN.displayName=uQ;var Cf="SelectContent",QN=Y.forwardRef((e,t)=>{const i=Zd(Cf,e.__scopeSelect),[a,d]=Y.useState();if(Do(()=>{d(new DocumentFragment)},[]),!i.open){const _=a;return _?xg.createPortal(L.jsx(eF,{scope:e.__scopeSelect,children:L.jsx(Bw.Slot,{scope:e.__scopeSelect,children:L.jsx("div",{children:e.children})})}),_):null}return L.jsx(tF,{...e,ref:t})});QN.displayName=Cf;var il=10,[eF,Yd]=kg(Cf),dQ="SelectContentImpl",tF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,position:a="item-aligned",onCloseAutoFocus:d,onEscapeKeyDown:_,onPointerDownOutside:b,side:o,sideOffset:k,align:O,alignOffset:z,arrowPadding:F,collisionBoundary:G,collisionPadding:ee,sticky:J,hideWhenDetached:te,avoidCollisions:oe,...X}=e,Q=Zd(Cf,i),[ue,he]=Y.useState(null),[Ie,Je]=Y.useState(null),Ce=Qn(t,cr=>he(cr)),[Ze,et]=Y.useState(null),[Ge,qe]=Y.useState(null),_t=Uw(i),[Rt,Wt]=Y.useState(!1),wt=Y.useRef(!1);Y.useEffect(()=>{if(ue)return dM(ue)},[ue]),uM();const jt=Y.useCallback(cr=>{const[Lr,...cn]=_t().map(Yt=>Yt.ref.current),[Me]=cn.slice(-1),fr=document.activeElement;for(const Yt of cr)if(Yt===fr||(Yt==null||Yt.scrollIntoView({block:"nearest"}),Yt===Lr&&Ie&&(Ie.scrollTop=0),Yt===Me&&Ie&&(Ie.scrollTop=Ie.scrollHeight),Yt==null||Yt.focus(),document.activeElement!==fr))return},[_t,Ie]),Ct=Y.useCallback(()=>jt([Ze,ue]),[jt,Ze,ue]);Y.useEffect(()=>{Rt&&Ct()},[Rt,Ct]);const{onOpenChange:st,triggerPointerDownPosRef:yt}=Q;Y.useEffect(()=>{if(ue){let cr={x:0,y:0};const Lr=Me=>{var fr,Yt;cr={x:Math.abs(Math.round(Me.pageX)-(((fr=yt.current)==null?void 0:fr.x)??0)),y:Math.abs(Math.round(Me.pageY)-(((Yt=yt.current)==null?void 0:Yt.y)??0))}},cn=Me=>{cr.x<=10&&cr.y<=10?Me.preventDefault():ue.contains(Me.target)||st(!1),document.removeEventListener("pointermove",Lr),yt.current=null};return yt.current!==null&&(document.addEventListener("pointermove",Lr),document.addEventListener("pointerup",cn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Lr),document.removeEventListener("pointerup",cn,{capture:!0})}}},[ue,st,yt]),Y.useEffect(()=>{const cr=()=>st(!1);return window.addEventListener("blur",cr),window.addEventListener("resize",cr),()=>{window.removeEventListener("blur",cr),window.removeEventListener("resize",cr)}},[st]);const[ir,yr]=yF(cr=>{const Lr=_t().filter(fr=>!fr.disabled),cn=Lr.find(fr=>fr.ref.current===document.activeElement),Me=vF(Lr,cr,cn);Me&&setTimeout(()=>Me.ref.current.focus())}),Wr=Y.useCallback((cr,Lr,cn)=>{const Me=!wt.current&&!cn;(Q.value!==void 0&&Q.value===Lr||Me)&&(et(cr),Me&&(wt.current=!0))},[Q.value]),rr=Y.useCallback(()=>ue==null?void 0:ue.focus(),[ue]),dn=Y.useCallback((cr,Lr,cn)=>{const Me=!wt.current&&!cn;(Q.value!==void 0&&Q.value===Lr||Me)&&qe(cr)},[Q.value]),Dn=a==="popper"?UC:rF,sn=Dn===UC?{side:o,sideOffset:k,align:O,alignOffset:z,arrowPadding:F,collisionBoundary:G,collisionPadding:ee,sticky:J,hideWhenDetached:te,avoidCollisions:oe}:{};return L.jsx(eF,{scope:i,content:ue,viewport:Ie,onViewportChange:Je,itemRefCallback:Wr,selectedItem:Ze,onItemLeave:rr,itemTextRefCallback:dn,focusSelectedItem:Ct,selectedItemText:Ge,position:a,isPositioned:Rt,searchRef:ir,children:L.jsx(Dw,{as:eu,allowPinchZoom:!0,children:L.jsx(Iw,{asChild:!0,trapped:Q.open,onMountAutoFocus:cr=>{cr.preventDefault()},onUnmountAutoFocus:Fr(d,cr=>{var Lr;(Lr=Q.trigger)==null||Lr.focus({preventScroll:!0}),cr.preventDefault()}),children:L.jsx(K0,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:_,onPointerDownOutside:b,onFocusOutside:cr=>cr.preventDefault(),onDismiss:()=>Q.onOpenChange(!1),children:L.jsx(Dn,{role:"listbox",id:Q.contentId,"data-state":Q.open?"open":"closed",dir:Q.dir,onContextMenu:cr=>cr.preventDefault(),...X,...sn,onPlaced:()=>Wt(!0),ref:Ce,style:{display:"flex",flexDirection:"column",outline:"none",...X.style},onKeyDown:Fr(X.onKeyDown,cr=>{const Lr=cr.ctrlKey||cr.altKey||cr.metaKey;if(cr.key==="Tab"&&cr.preventDefault(),!Lr&&cr.key.length===1&&yr(cr.key),["ArrowUp","ArrowDown","Home","End"].includes(cr.key)){let Me=_t().filter(fr=>!fr.disabled).map(fr=>fr.ref.current);if(["ArrowUp","End"].includes(cr.key)&&(Me=Me.slice().reverse()),["ArrowUp","ArrowDown"].includes(cr.key)){const fr=cr.target,Yt=Me.indexOf(fr);Me=Me.slice(Yt+1)}setTimeout(()=>jt(Me)),cr.preventDefault()}})})})})})})});tF.displayName=dQ;var hQ="SelectItemAlignedPosition",rF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,onPlaced:a,...d}=e,_=Zd(Cf,i),b=Yd(Cf,i),[o,k]=Y.useState(null),[O,z]=Y.useState(null),F=Qn(t,Ce=>z(Ce)),G=Uw(i),ee=Y.useRef(!1),J=Y.useRef(!0),{viewport:te,selectedItem:oe,selectedItemText:X,focusSelectedItem:Q}=b,ue=Y.useCallback(()=>{if(_.trigger&&_.valueNode&&o&&O&&te&&oe&&X){const Ce=_.trigger.getBoundingClientRect(),Ze=O.getBoundingClientRect(),et=_.valueNode.getBoundingClientRect(),Ge=X.getBoundingClientRect();if(_.dir!=="rtl"){const fr=Ge.left-Ze.left,Yt=et.left-fr,tr=Ce.left-Yt,vt=Ce.width+tr,Mn=Math.max(vt,Ze.width),hn=window.innerWidth-il,ei=BC(Yt,[il,Math.max(il,hn-Mn)]);o.style.minWidth=vt+"px",o.style.left=ei+"px"}else{const fr=Ze.right-Ge.right,Yt=window.innerWidth-et.right-fr,tr=window.innerWidth-Ce.right-Yt,vt=Ce.width+tr,Mn=Math.max(vt,Ze.width),hn=window.innerWidth-il,ei=BC(Yt,[il,Math.max(il,hn-Mn)]);o.style.minWidth=vt+"px",o.style.right=ei+"px"}const qe=G(),_t=window.innerHeight-il*2,Rt=te.scrollHeight,Wt=window.getComputedStyle(O),wt=parseInt(Wt.borderTopWidth,10),jt=parseInt(Wt.paddingTop,10),Ct=parseInt(Wt.borderBottomWidth,10),st=parseInt(Wt.paddingBottom,10),yt=wt+jt+Rt+st+Ct,ir=Math.min(oe.offsetHeight*5,yt),yr=window.getComputedStyle(te),Wr=parseInt(yr.paddingTop,10),rr=parseInt(yr.paddingBottom,10),dn=Ce.top+Ce.height/2-il,Dn=_t-dn,sn=oe.offsetHeight/2,cr=oe.offsetTop+sn,Lr=wt+jt+cr,cn=yt-Lr;if(Lr<=dn){const fr=qe.length>0&&oe===qe[qe.length-1].ref.current;o.style.bottom="0px";const Yt=O.clientHeight-te.offsetTop-te.offsetHeight,tr=Math.max(Dn,sn+(fr?rr:0)+Yt+Ct),vt=Lr+tr;o.style.height=vt+"px"}else{const fr=qe.length>0&&oe===qe[0].ref.current;o.style.top="0px";const tr=Math.max(dn,wt+te.offsetTop+(fr?Wr:0)+sn)+cn;o.style.height=tr+"px",te.scrollTop=Lr-dn+te.offsetTop}o.style.margin=`${il}px 0`,o.style.minHeight=ir+"px",o.style.maxHeight=_t+"px",a==null||a(),requestAnimationFrame(()=>ee.current=!0)}},[G,_.trigger,_.valueNode,o,O,te,oe,X,_.dir,a]);Do(()=>ue(),[ue]);const[he,Ie]=Y.useState();Do(()=>{O&&Ie(window.getComputedStyle(O).zIndex)},[O]);const Je=Y.useCallback(Ce=>{Ce&&J.current===!0&&(ue(),Q==null||Q(),J.current=!1)},[ue,Q]);return L.jsx(pQ,{scope:i,contentWrapper:o,shouldExpandOnScrollRef:ee,onScrollButtonChange:Je,children:L.jsx("div",{ref:k,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:he},children:L.jsx(ln.div,{...d,ref:F,style:{boxSizing:"border-box",maxHeight:"100%",...d.style}})})})});rF.displayName=hQ;var fQ="SelectPopperPosition",UC=Y.forwardRef((e,t)=>{const{__scopeSelect:i,align:a="start",collisionPadding:d=il,..._}=e,b=Vw(i);return L.jsx(UM,{...b,..._,ref:t,align:a,collisionPadding:d,style:{boxSizing:"border-box",..._.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});UC.displayName=fQ;var[pQ,HM]=kg(Cf,{}),VC="SelectViewport",nF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,nonce:a,...d}=e,_=Yd(VC,i),b=HM(VC,i),o=Qn(t,_.onViewportChange),k=Y.useRef(0);return L.jsxs(L.Fragment,{children:[L.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),L.jsx(Bw.Slot,{scope:i,children:L.jsx(ln.div,{"data-radix-select-viewport":"",role:"presentation",...d,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...d.style},onScroll:Fr(d.onScroll,O=>{const z=O.currentTarget,{contentWrapper:F,shouldExpandOnScrollRef:G}=b;if(G!=null&&G.current&&F){const ee=Math.abs(k.current-z.scrollTop);if(ee>0){const J=window.innerHeight-il*2,te=parseFloat(F.style.minHeight),oe=parseFloat(F.style.height),X=Math.max(te,oe);if(X<J){const Q=X+ee,ue=Math.min(J,Q),he=Q-ue;F.style.height=ue+"px",F.style.bottom==="0px"&&(z.scrollTop=he>0?he:0,F.style.justifyContent="flex-end")}}}k.current=z.scrollTop})})})]})});nF.displayName=VC;var iF="SelectGroup",[mQ,gQ]=kg(iF),_Q=Y.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,d=Wc();return L.jsx(mQ,{scope:i,id:d,children:L.jsx(ln.div,{role:"group","aria-labelledby":d,...a,ref:t})})});_Q.displayName=iF;var oF="SelectLabel",sF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,d=gQ(oF,i);return L.jsx(ln.div,{id:d.id,...a,ref:t})});sF.displayName=oF;var Wb="SelectItem",[yQ,aF]=kg(Wb),lF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,value:a,disabled:d=!1,textValue:_,...b}=e,o=Zd(Wb,i),k=Yd(Wb,i),O=o.value===a,[z,F]=Y.useState(_??""),[G,ee]=Y.useState(!1),J=Qn(t,Q=>{var ue;return(ue=k.itemRefCallback)==null?void 0:ue.call(k,Q,a,d)}),te=Wc(),oe=Y.useRef("touch"),X=()=>{d||(o.onValueChange(a),o.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return L.jsx(yQ,{scope:i,value:a,disabled:d,textId:te,isSelected:O,onItemTextChange:Y.useCallback(Q=>{F(ue=>ue||((Q==null?void 0:Q.textContent)??"").trim())},[]),children:L.jsx(Bw.ItemSlot,{scope:i,value:a,disabled:d,textValue:z,children:L.jsx(ln.div,{role:"option","aria-labelledby":te,"data-highlighted":G?"":void 0,"aria-selected":O&&G,"data-state":O?"checked":"unchecked","aria-disabled":d||void 0,"data-disabled":d?"":void 0,tabIndex:d?void 0:-1,...b,ref:J,onFocus:Fr(b.onFocus,()=>ee(!0)),onBlur:Fr(b.onBlur,()=>ee(!1)),onClick:Fr(b.onClick,()=>{oe.current!=="mouse"&&X()}),onPointerUp:Fr(b.onPointerUp,()=>{oe.current==="mouse"&&X()}),onPointerDown:Fr(b.onPointerDown,Q=>{oe.current=Q.pointerType}),onPointerMove:Fr(b.onPointerMove,Q=>{var ue;oe.current=Q.pointerType,d?(ue=k.onItemLeave)==null||ue.call(k):oe.current==="mouse"&&Q.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Fr(b.onPointerLeave,Q=>{var ue;Q.currentTarget===document.activeElement&&((ue=k.onItemLeave)==null||ue.call(k))}),onKeyDown:Fr(b.onKeyDown,Q=>{var he;((he=k.searchRef)==null?void 0:he.current)!==""&&Q.key===" "||(iQ.includes(Q.key)&&X(),Q.key===" "&&Q.preventDefault())})})})})});lF.displayName=Wb;var Uy="SelectItemText",cF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,className:a,style:d,..._}=e,b=Zd(Uy,i),o=Yd(Uy,i),k=aF(Uy,i),O=lQ(Uy,i),[z,F]=Y.useState(null),G=Qn(t,X=>F(X),k.onItemTextChange,X=>{var Q;return(Q=o.itemTextRefCallback)==null?void 0:Q.call(o,X,k.value,k.disabled)}),ee=z==null?void 0:z.textContent,J=Y.useMemo(()=>L.jsx("option",{value:k.value,disabled:k.disabled,children:ee},k.value),[k.disabled,k.value,ee]),{onNativeOptionAdd:te,onNativeOptionRemove:oe}=O;return Do(()=>(te(J),()=>oe(J)),[te,oe,J]),L.jsxs(L.Fragment,{children:[L.jsx(ln.span,{id:k.textId,..._,ref:G}),k.isSelected&&b.valueNode&&!b.valueNodeHasChildren?xg.createPortal(_.children,b.valueNode):null]})});cF.displayName=Uy;var uF="SelectItemIndicator",dF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e;return aF(uF,i).isSelected?L.jsx(ln.span,{"aria-hidden":!0,...a,ref:t}):null});dF.displayName=uF;var $C="SelectScrollUpButton",hF=Y.forwardRef((e,t)=>{const i=Yd($C,e.__scopeSelect),a=HM($C,e.__scopeSelect),[d,_]=Y.useState(!1),b=Qn(t,a.onScrollButtonChange);return Do(()=>{if(i.viewport&&i.isPositioned){let o=function(){const O=k.scrollTop>0;_(O)};const k=i.viewport;return o(),k.addEventListener("scroll",o),()=>k.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),d?L.jsx(pF,{...e,ref:b,onAutoScroll:()=>{const{viewport:o,selectedItem:k}=i;o&&k&&(o.scrollTop=o.scrollTop-k.offsetHeight)}}):null});hF.displayName=$C;var GC="SelectScrollDownButton",fF=Y.forwardRef((e,t)=>{const i=Yd(GC,e.__scopeSelect),a=HM(GC,e.__scopeSelect),[d,_]=Y.useState(!1),b=Qn(t,a.onScrollButtonChange);return Do(()=>{if(i.viewport&&i.isPositioned){let o=function(){const O=k.scrollHeight-k.clientHeight,z=Math.ceil(k.scrollTop)<O;_(z)};const k=i.viewport;return o(),k.addEventListener("scroll",o),()=>k.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),d?L.jsx(pF,{...e,ref:b,onAutoScroll:()=>{const{viewport:o,selectedItem:k}=i;o&&k&&(o.scrollTop=o.scrollTop+k.offsetHeight)}}):null});fF.displayName=GC;var pF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,onAutoScroll:a,...d}=e,_=Yd("SelectScrollButton",i),b=Y.useRef(null),o=Uw(i),k=Y.useCallback(()=>{b.current!==null&&(window.clearInterval(b.current),b.current=null)},[]);return Y.useEffect(()=>()=>k(),[k]),Do(()=>{var z;const O=o().find(F=>F.ref.current===document.activeElement);(z=O==null?void 0:O.ref.current)==null||z.scrollIntoView({block:"nearest"})},[o]),L.jsx(ln.div,{"aria-hidden":!0,...d,ref:t,style:{flexShrink:0,...d.style},onPointerDown:Fr(d.onPointerDown,()=>{b.current===null&&(b.current=window.setInterval(a,50))}),onPointerMove:Fr(d.onPointerMove,()=>{var O;(O=_.onItemLeave)==null||O.call(_),b.current===null&&(b.current=window.setInterval(a,50))}),onPointerLeave:Fr(d.onPointerLeave,()=>{k()})})}),vQ="SelectSeparator",mF=Y.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e;return L.jsx(ln.div,{"aria-hidden":!0,...a,ref:t})});mF.displayName=vQ;var HC="SelectArrow",xQ=Y.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,d=Vw(i),_=Zd(HC,i),b=Yd(HC,i);return _.open&&b.position==="popper"?L.jsx(VM,{...d,...a,ref:t}):null});xQ.displayName=HC;function gF(e){return e===""||e===void 0}var _F=Y.forwardRef((e,t)=>{const{value:i,...a}=e,d=Y.useRef(null),_=Qn(t,d),b=tQ(i);return Y.useEffect(()=>{const o=d.current,k=window.HTMLSelectElement.prototype,z=Object.getOwnPropertyDescriptor(k,"value").set;if(b!==i&&z){const F=new Event("change",{bubbles:!0});z.call(o,i),o.dispatchEvent(F)}},[b,i]),L.jsx(HN,{asChild:!0,children:L.jsx("select",{...a,ref:_,defaultValue:i})})});_F.displayName="BubbleSelect";function yF(e){const t=Io(e),i=Y.useRef(""),a=Y.useRef(0),d=Y.useCallback(b=>{const o=i.current+b;t(o),function k(O){i.current=O,window.clearTimeout(a.current),O!==""&&(a.current=window.setTimeout(()=>k(""),1e3))}(o)},[t]),_=Y.useCallback(()=>{i.current="",window.clearTimeout(a.current)},[]);return Y.useEffect(()=>()=>window.clearTimeout(a.current),[]),[i,d,_]}function vF(e,t,i){const d=t.length>1&&Array.from(t).every(O=>O===t[0])?t[0]:t,_=i?e.indexOf(i):-1;let b=bQ(e,Math.max(_,0));d.length===1&&(b=b.filter(O=>O!==i));const k=b.find(O=>O.textValue.toLowerCase().startsWith(d.toLowerCase()));return k!==i?k:void 0}function bQ(e,t){return e.map((i,a)=>e[(t+a)%e.length])}var wQ=qN,xF=ZN,SQ=XN,TQ=KN,EQ=JN,bF=QN,CQ=nF,wF=sF,SF=lF,MQ=cF,PQ=dF,TF=hF,EF=fF,CF=mF;const I0=wQ,k0=SQ,pg=Y.forwardRef(({className:e,children:t,...i},a)=>L.jsxs(xF,{ref:a,className:_r("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...i,children:[t,L.jsx(TQ,{asChild:!0,children:L.jsx(qz,{className:"h-4 w-4 opacity-50"})})]}));pg.displayName=xF.displayName;const MF=Y.forwardRef(({className:e,...t},i)=>L.jsx(TF,{ref:i,className:_r("flex cursor-default items-center justify-center py-1",e),...t,children:L.jsx(FG,{className:"h-4 w-4"})}));MF.displayName=TF.displayName;const PF=Y.forwardRef(({className:e,...t},i)=>L.jsx(EF,{ref:i,className:_r("flex cursor-default items-center justify-center py-1",e),...t,children:L.jsx(qz,{className:"h-4 w-4"})}));PF.displayName=EF.displayName;const mg=Y.forwardRef(({className:e,children:t,position:i="popper",...a},d)=>L.jsx(EQ,{children:L.jsxs(bF,{ref:d,className:_r("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:i,...a,children:[L.jsx(MF,{}),L.jsx(CQ,{className:_r("p-1",i==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),L.jsx(PF,{})]})}));mg.displayName=bF.displayName;const AQ=Y.forwardRef(({className:e,...t},i)=>L.jsx(wF,{ref:i,className:_r("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));AQ.displayName=wF.displayName;const hl=Y.forwardRef(({className:e,children:t,...i},a)=>L.jsxs(SF,{ref:a,className:_r("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...i,children:[L.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:L.jsx(PQ,{children:L.jsx(NG,{className:"h-4 w-4"})})}),L.jsx(MQ,{children:t})]}));hl.displayName=SF.displayName;const IQ=Y.forwardRef(({className:e,...t},i)=>L.jsx(CF,{ref:i,className:_r("-mx-1 my-1 h-px bg-muted",e),...t}));IQ.displayName=CF.displayName;const lo=Y.forwardRef(({className:e,type:t,...i},a)=>L.jsx("input",{type:t,className:_r("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...i}));lo.displayName="Input";var kQ="Label",AF=Y.forwardRef((e,t)=>L.jsx(ln.label,{...e,ref:t,onMouseDown:i=>{var d;i.target.closest("button, input, select, textarea")||((d=e.onMouseDown)==null||d.call(e,i),!i.defaultPrevented&&i.detail>1&&i.preventDefault())}}));AF.displayName=kQ;var IF=AF;const RQ=W0("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ao=Y.forwardRef(({className:e,...t},i)=>L.jsx(IF,{ref:i,className:_r(RQ(),e),...t}));ao.displayName=IF.displayName;const DQ=({onFiltersChange:e})=>{const[t,i]=Y.useState({startDate:void 0,endDate:void 0,vehicleType:void 0,location:"",sortBy:"distance",sortOrder:"asc",model:void 0,year:void 0,minPrice:void 0,maxPrice:void 0,searchQuery:""}),a=(d,_)=>{console.log(`Updating filter ${d} with value:`,_);const b={...t,[d]:_};i(b),e(b)};return L.jsxs("div",{className:"flex flex-col gap-4 p-4 bg-white",children:[L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{children:[L.jsx(ao,{htmlFor:"model",children:"Model"}),L.jsx(lo,{id:"model",placeholder:"Search by model...",value:t.model||"",onChange:d=>a("model",d.target.value)})]}),L.jsxs("div",{children:[L.jsx(ao,{htmlFor:"year",children:"Year"}),L.jsx(lo,{id:"year",type:"number",placeholder:"Search by year...",value:t.year||"",onChange:d=>a("year",d.target.value?parseInt(d.target.value):void 0)})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[L.jsxs("div",{children:[L.jsx(ao,{htmlFor:"minPrice",children:"Min Price (BWP)"}),L.jsx(lo,{id:"minPrice",type:"number",placeholder:"Min price...",value:t.minPrice||"",onChange:d=>a("minPrice",d.target.value?parseInt(d.target.value):void 0)})]}),L.jsxs("div",{children:[L.jsx(ao,{htmlFor:"maxPrice",children:"Max Price (BWP)"}),L.jsx(lo,{id:"maxPrice",type:"number",placeholder:"Max price...",value:t.maxPrice||"",onChange:d=>a("maxPrice",d.target.value?parseInt(d.target.value):void 0)})]})]})]}),L.jsxs(FC,{children:[L.jsx(jC,{asChild:!0,children:L.jsxs(on,{variant:"outline",className:"w-full",children:[L.jsx(xC,{className:"mr-2 h-4 w-4"}),t.startDate&&t.endDate?`${In(t.startDate,"PP")} - ${In(t.endDate,"PP")}`:"Select dates"]})}),L.jsx(qb,{className:"w-auto p-0",align:"start",children:L.jsx(M0,{mode:"range",selected:{from:t.startDate,to:t.endDate},onSelect:d=>{a("startDate",d==null?void 0:d.from),a("endDate",d==null?void 0:d.to)},numberOfMonths:2})})]}),L.jsxs(I0,{value:t.vehicleType,onValueChange:d=>a("vehicleType",d),children:[L.jsx(pg,{children:L.jsx(k0,{placeholder:"Vehicle type"})}),L.jsx(mg,{children:["Basic","Standard","Executive","4x4","SUV","Electric","Exotic"].map(d=>L.jsx(hl,{value:d,children:d},d))})]}),L.jsxs("div",{className:"relative",children:[L.jsx(Yz,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),L.jsx("input",{type:"text",placeholder:"Enter pickup location",className:"w-full pl-10 pr-4 py-2 border rounded-md",value:t.location,onChange:d=>a("location",d.target.value)})]}),L.jsxs("div",{className:"flex gap-2",children:[L.jsxs(I0,{value:t.sortBy,onValueChange:d=>a("sortBy",d),children:[L.jsx(pg,{className:"flex-1",children:L.jsx(k0,{placeholder:"Sort by"})}),L.jsxs(mg,{children:[L.jsx(hl,{value:"distance",children:"Distance"}),L.jsx(hl,{value:"price",children:"Price"})]})]}),L.jsx(on,{variant:"ghost",size:"icon",onClick:()=>a("sortOrder",t.sortOrder==="asc"?"desc":"asc"),children:L.jsx(OG,{className:`h-4 w-4 ${t.sortOrder==="desc"?"rotate-180":""}`})})]})]})};var qM="Avatar",[LQ,ooe]=Rf(qM),[OQ,kF]=LQ(qM),RF=Y.forwardRef((e,t)=>{const{__scopeAvatar:i,...a}=e,[d,_]=Y.useState("idle");return L.jsx(OQ,{scope:i,imageLoadingStatus:d,onImageLoadingStatusChange:_,children:L.jsx(ln.span,{...a,ref:t})})});RF.displayName=qM;var DF="AvatarImage",LF=Y.forwardRef((e,t)=>{const{__scopeAvatar:i,src:a,onLoadingStatusChange:d=()=>{},..._}=e,b=kF(DF,i),o=zQ(a,_.referrerPolicy),k=Io(O=>{d(O),b.onImageLoadingStatusChange(O)});return Do(()=>{o!=="idle"&&k(o)},[o,k]),o==="loaded"?L.jsx(ln.img,{..._,ref:t,src:a}):null});LF.displayName=DF;var OF="AvatarFallback",zF=Y.forwardRef((e,t)=>{const{__scopeAvatar:i,delayMs:a,...d}=e,_=kF(OF,i),[b,o]=Y.useState(a===void 0);return Y.useEffect(()=>{if(a!==void 0){const k=window.setTimeout(()=>o(!0),a);return()=>window.clearTimeout(k)}},[a]),b&&_.imageLoadingStatus!=="loaded"?L.jsx(ln.span,{...d,ref:t}):null});zF.displayName=OF;function zQ(e,t){const[i,a]=Y.useState("idle");return Do(()=>{if(!e){a("error");return}let d=!0;const _=new window.Image,b=o=>()=>{d&&a(o)};return a("loading"),_.onload=b("loaded"),_.onerror=b("error"),_.src=e,t&&(_.referrerPolicy=t),()=>{d=!1}},[e,t]),i}var NF=RF,FF=LF,jF=zF;const R0=Y.forwardRef(({className:e,...t},i)=>L.jsx(NF,{ref:i,className:_r("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));R0.displayName=NF.displayName;const $w=Y.forwardRef(({className:e,...t},i)=>L.jsx(FF,{ref:i,className:_r("aspect-square h-full w-full",e),...t}));$w.displayName=FF.displayName;const D0=Y.forwardRef(({className:e,...t},i)=>L.jsx(jF,{ref:i,className:_r("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));D0.displayName=jF.displayName;const NQ=W0("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function WM({className:e,variant:t,...i}){return L.jsx("div",{className:_r(NQ({variant:t}),e),...i})}const BF=({searchQuery:e,onSearchChange:t,onFiltersChange:i})=>{const a=$o(),{data:d}=Ro({queryKey:["profile"],queryFn:async()=>{const{data:{user:O}}=await Qt.auth.getUser();if(!O)return null;const{data:z}=await Qt.from("profiles").select("avatar_url, full_name").eq("id",O.id).single();return z}}),{data:_}=Ro({queryKey:["notification-count"],queryFn:async()=>{const{data:{user:O}}=await Qt.auth.getUser();if(!O)return{messages:0,notifications:0};const[z,F]=await Promise.all([Qt.from("messages").select("id",{count:"exact"}).eq("receiver_id",O.id).eq("status","sent"),Qt.from("notifications").select("id",{count:"exact"}).eq("user_id",O.id).eq("is_read",!1)]);return{messages:z.count||0,notifications:F.count||0}},refetchInterval:3e4}),b=((_==null?void 0:_.messages)||0)+((_==null?void 0:_.notifications)||0),o=d!=null&&d.avatar_url?Qt.storage.from("avatars").getPublicUrl(d.avatar_url).data.publicUrl:null,k=O=>{console.log("Filters changed:",O),i({...O,searchQuery:e})};return L.jsxs("header",{className:"bg-white p-4 sticky top-0 z-10 shadow-sm",children:[L.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[L.jsx("img",{src:"/lovable-uploads/9bb8c367-3153-4561-870a-faadfe15b30c.png",alt:"Mobirides Logo",className:"h-14 w-14 cursor-pointer",onClick:()=>a("/")}),L.jsx("div",{className:"flex-1",children:L.jsx("h1",{className:"text-xl font-semibold",children:"Gaborone, Botswana"})}),L.jsx(on,{variant:"outline",size:"icon",className:"rounded-full",onClick:()=>a("/add-car"),children:L.jsx(Xz,{className:"h-4 w-4"})}),L.jsxs("div",{className:"relative",children:[L.jsx("button",{className:"rounded-full bg-gray-100 flex items-center justify-center",onClick:()=>a("/profile"),children:o?L.jsxs(R0,{className:"h-10 w-10",children:[L.jsx($w,{src:o,alt:"Profile"}),L.jsx(D0,{children:""})]}):L.jsx(R0,{className:"h-10 w-10",children:L.jsx(D0,{children:""})})}),b>0&&L.jsx(WM,{variant:"destructive",className:"absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 text-xs",children:b})]})]}),L.jsxs("div",{className:"flex gap-2",children:[L.jsxs("div",{className:"relative flex-1",children:[L.jsx(JG,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),L.jsx("input",{type:"text",placeholder:"Search cars...",value:e,onChange:O=>t(O.target.value),className:"w-full pl-10 pr-4 py-2 rounded-full border border-gray-200 focus:outline-none focus:border-primary"})]}),L.jsxs(BZ,{children:[L.jsx(UZ,{asChild:!0,children:L.jsx(on,{variant:"outline",size:"icon",className:"rounded-full",children:L.jsx(tH,{className:"h-4 w-4"})})}),L.jsx(Y5,{children:L.jsx(DQ,{onFiltersChange:k})})]})]})]})},Ld=Y.forwardRef(({className:e,...t},i)=>L.jsx("div",{ref:i,className:_r("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Ld.displayName="Card";const uf=Y.forwardRef(({className:e,...t},i)=>L.jsx("div",{ref:i,className:_r("flex flex-col space-y-1.5 p-6",e),...t}));uf.displayName="CardHeader";const df=Y.forwardRef(({className:e,...t},i)=>L.jsx("h3",{ref:i,className:_r("text-2xl font-semibold leading-none tracking-tight",e),...t}));df.displayName="CardTitle";const FQ=Y.forwardRef(({className:e,...t},i)=>L.jsx("p",{ref:i,className:_r("text-sm text-muted-foreground",e),...t}));FQ.displayName="CardDescription";const hf=Y.forwardRef(({className:e,...t},i)=>L.jsx("div",{ref:i,className:_r("p-6 pt-0",e),...t}));hf.displayName="CardContent";const jQ=Y.forwardRef(({className:e,...t},i)=>L.jsx("div",{ref:i,className:_r("flex items-center p-6 pt-0",e),...t}));jQ.displayName="CardFooter";const UF=gM,BQ=_M,UQ=yM,VF=Y.forwardRef(({className:e,...t},i)=>L.jsx(J0,{ref:i,className:_r("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));VF.displayName=J0.displayName;const ZM=Y.forwardRef(({className:e,children:t,...i},a)=>L.jsxs(UQ,{children:[L.jsx(VF,{}),L.jsxs(Q0,{ref:a,className:_r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[t,L.jsxs(vM,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[L.jsx(iM,{className:"h-4 w-4"}),L.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ZM.displayName=Q0.displayName;const YM=({className:e,...t})=>L.jsx("div",{className:_r("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});YM.displayName="DialogHeader";const XM=Y.forwardRef(({className:e,...t},i)=>L.jsx(ev,{ref:i,className:_r("text-lg font-semibold leading-none tracking-tight",e),...t}));XM.displayName=ev.displayName;const VQ=Y.forwardRef(({className:e,...t},i)=>L.jsx(tv,{ref:i,className:_r("text-sm text-muted-foreground",e),...t}));VQ.displayName=tv.displayName;const $Q=1,GQ=1e6;let YT=0;function HQ(){return YT=(YT+1)%Number.MAX_SAFE_INTEGER,YT.toString()}const XT=new Map,u4=e=>{if(XT.has(e))return;const t=setTimeout(()=>{XT.delete(e),t0({type:"REMOVE_TOAST",toastId:e})},GQ);XT.set(e,t)},qQ=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,$Q)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(i=>i.id===t.toast.id?{...i,...t.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=t;return i?u4(i):e.toasts.forEach(a=>{u4(a.id)}),{...e,toasts:e.toasts.map(a=>a.id===i||i===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(i=>i.id!==t.toastId)}}},nb=[];let ib={toasts:[]};function t0(e){ib=qQ(ib,e),nb.forEach(t=>{t(ib)})}function WQ({...e}){const t=HQ(),i=d=>t0({type:"UPDATE_TOAST",toast:{...d,id:t}}),a=()=>t0({type:"DISMISS_TOAST",toastId:t});return t0({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:d=>{d||a()}}}),{id:t,dismiss:a,update:i}}function Tl(){const[e,t]=Y.useState(ib);return Y.useEffect(()=>(nb.push(t),()=>{const i=nb.indexOf(t);i>-1&&nb.splice(i,1)}),[e]),{...e,toast:WQ,dismiss:i=>t0({type:"DISMISS_TOAST",toastId:i})}}const $F=({car:e,isOpen:t,onClose:i})=>{const[a,d]=Y.useState(),[_,b]=Y.useState(),[o,k]=Y.useState(!1),{toast:O}=Tl(),z=$o(),F=async(ee,J,te,oe,X)=>{console.log("Creating notification:",{userId:ee,type:J,content:te,carId:oe,bookingId:X});const{error:Q}=await Qt.from("notifications").insert({user_id:ee,type:J,content:te,related_car_id:oe,related_booking_id:X});if(Q)throw console.error("Error creating notification:",Q),Q},G=async()=>{var ee;if(!a||!_){O({title:"Error",description:"Please select both start and end dates",variant:"destructive"});return}k(!0);try{const{data:J}=await Qt.auth.getSession();if(!((ee=J.session)!=null&&ee.user))throw new Error("No authenticated user");const oe=Math.ceil((_.getTime()-a.getTime())/(1e3*60*60*24))*e.price_per_day,{data:X,error:Q}=await Qt.from("bookings").insert({car_id:e.id,renter_id:J.session.user.id,start_date:In(a,"yyyy-MM-dd"),end_date:In(_,"yyyy-MM-dd"),total_price:oe}).select().single();if(Q)throw Q;await F(J.session.user.id,"booking_request",`Your booking request for ${e.brand} ${e.model} from ${In(a,"PPP")} to ${In(_,"PPP")} has been submitted.`,e.id,X.id),await F(e.owner_id,"booking_request",`New booking request received for your ${e.brand} ${e.model} from ${In(a,"PPP")} to ${In(_,"PPP")}.`,e.id,X.id),O({title:"Success",description:"Your booking request has been submitted!"}),i(),z("/bookings")}catch(J){console.error("Booking error:",J),O({title:"Error",description:"Failed to create booking. Please try again.",variant:"destructive"})}finally{k(!1)}};return L.jsx(UF,{open:t,onOpenChange:i,children:L.jsxs(ZM,{className:"sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[L.jsx(YM,{children:L.jsxs(XM,{children:["Book ",e.brand," ",e.model]})}),L.jsxs("div",{className:"grid gap-4 py-4",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsx("h4",{className:"font-medium",children:"Select dates"}),L.jsx(M0,{mode:"range",selected:{from:a,to:_},onSelect:ee=>{d(ee==null?void 0:ee.from),b(ee==null?void 0:ee.to)},numberOfMonths:1,disabled:ee=>ee<new Date})]}),a&&_&&L.jsxs("div",{className:"space-y-2",children:[L.jsx("h4",{className:"font-medium",children:"Summary"}),L.jsxs("div",{className:"text-sm space-y-1",children:[L.jsxs("p",{children:["Start date: ",In(a,"PPP")]}),L.jsxs("p",{children:["End date: ",In(_,"PPP")]}),L.jsxs("p",{className:"font-medium",children:["Total: BWP ",Math.ceil((_.getTime()-a.getTime())/(1e3*60*60*24))*e.price_per_day]})]})]})]}),L.jsxs("div",{className:"flex justify-end gap-2",children:[L.jsx(on,{variant:"outline",onClick:i,children:"Cancel"}),L.jsx(on,{onClick:G,disabled:!a||!_||o,children:o?"Booking...":"Confirm"})]})]})})},ZQ=({id:e,brand:t,model:i,price_per_day:a,image_url:d,transmission:_,fuel:b,seats:o,location:k,year:O,onSaveToggle:z,isSaved:F})=>{const[G,ee]=Y.useState(!1),J=$o(),{data:te}=Ro({queryKey:["car",e],queryFn:async()=>{console.log("Fetching complete car details for booking");const{data:he,error:Ie}=await Qt.from("cars").select("*").eq("id",e).single();if(Ie)throw console.error("Error fetching car details:",Ie),Ie;return console.log("Car details fetched:",he),he},enabled:G}),oe=()=>{J(`/cars/${e}`)},X=async he=>{he.stopPropagation(),ee(!0)},Q=he=>{he.stopPropagation(),z==null||z()},ue=he=>he<=2?"Sports":he<=5?"Sedan":he<=7?"SUV":"Van";return L.jsxs(L.Fragment,{children:[L.jsxs(Ld,{className:"overflow-hidden cursor-pointer transition-transform hover:scale-[1.02] h-[28rem]",onClick:oe,children:[L.jsxs("div",{className:"relative h-48",children:[L.jsx("img",{src:d,alt:`${t} ${i}`,className:"w-full h-full object-cover"}),z&&L.jsx("button",{onClick:Q,className:"absolute top-2 right-2 p-2 bg-white rounded-full shadow-md hover:bg-gray-100",children:F?"":""})]}),L.jsxs("div",{className:"p-4 flex flex-col h-[calc(28rem-12rem)]",children:[L.jsx("span",{className:"px-3 py-1 rounded-full text-sm bg-[#F1F0FB] text-[#7C3AED] w-fit mb-2",children:ue(o)}),L.jsxs("div",{className:"flex justify-between items-start mb-2",children:[L.jsxs("div",{className:"flex-1",children:[L.jsxs("h3",{className:"font-semibold text-left break-words line-clamp-2",children:[t," ",i]}),L.jsx("p",{className:"text-sm text-gray-500 text-left",children:O})]}),L.jsx("div",{className:"text-right ml-2",children:L.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[L.jsxs("p",{className:"font-semibold whitespace-nowrap text-primary",children:["BWP ",a]}),L.jsx("p",{className:"text-xs text-gray-500",children:"/day"})]})})]}),L.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[L.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-gray-600",children:[L.jsx(BG,{className:"w-4 h-4 text-primary"}),_]}),L.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-gray-600",children:[L.jsx($G,{className:"w-4 h-4 text-primary"}),b]}),L.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-gray-600",children:[L.jsx(iH,{className:"w-4 h-4 text-primary"}),o]})]}),L.jsxs("div",{className:"mt-auto flex justify-between items-center",children:[L.jsx(WM,{variant:"secondary",className:"truncate max-w-[150px]",children:k}),L.jsx(on,{onClick:X,children:"Book now"})]})]})]}),G&&te&&L.jsx($F,{car:te,isOpen:G,onClose:()=>ee(!1)})]})};function oo({className:e,...t}){return L.jsx("div",{className:_r("animate-pulse rounded-md bg-muted",e),...t})}const YQ=W0("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),KM=Y.forwardRef(({className:e,variant:t,...i},a)=>L.jsx("div",{ref:a,role:"alert",className:_r(YQ({variant:t}),e),...i}));KM.displayName="Alert";const XQ=Y.forwardRef(({className:e,...t},i)=>L.jsx("h5",{ref:i,className:_r("mb-1 font-medium leading-none tracking-tight",e),...t}));XQ.displayName="AlertTitle";const JM=Y.forwardRef(({className:e,...t},i)=>L.jsx("div",{ref:i,className:_r("text-sm [&_p]:leading-relaxed",e),...t}));JM.displayName="AlertDescription";const GF=({cars:e=[],isLoading:t,error:i,loadMoreRef:a,isFetchingNextPage:d})=>{const[_,b]=Y.useState(!1),o=()=>L.jsxs("div",{className:"space-y-3",children:[L.jsx(oo,{className:"h-48 w-full"}),L.jsx(oo,{className:"h-4 w-3/4"}),L.jsx(oo,{className:"h-4 w-1/2"})]});if(i)return L.jsx("div",{className:"text-center py-8 text-red-500",children:"Error loading cars. Please try again later."});if(t)return L.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:[1,2,3,4].map(O=>L.jsx(o,{},O))});if(!Array.isArray(e)||e.length===0){const O=window.location.pathname==="/";return L.jsx(KM,{className:"my-8",children:L.jsx(JM,{children:O?"The car/s you are searching for cannot be found":"You haven't saved any cars yet. Browse our collection and click the heart icon to save your favorite cars."})})}const k=_?e:e.slice(0,6);return L.jsxs("div",{className:"space-y-6",children:[L.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:k.map(O=>L.jsx("div",{className:"animate-fade-in",children:L.jsx(ZQ,{id:O.id,brand:O.brand,model:O.model,price_per_day:O.price_per_day,image_url:O.image_url||"/placeholder.svg",transmission:O.transmission,fuel:O.fuel,seats:O.seats,location:O.location,year:O.year,isSaved:O.isSaved})},O.id))}),e.length>6&&L.jsx("div",{className:"flex justify-center",children:L.jsx(on,{variant:"ghost",onClick:()=>b(!_),className:"text-primary hover:text-primary/80",children:_?"Show Less":"See All"})}),L.jsx("div",{ref:a,className:"h-10 flex items-center justify-center mt-4",children:d&&L.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})]})};Array(12).fill(0);Fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Fe.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"}));Fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Fe.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"}));Fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Fe.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"}));Fe.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Fe.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"}));var qC=1,KQ=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:i,...a}=e,d=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:qC++,_=this.toasts.find(o=>o.id===d),b=e.dismissible===void 0?!0:e.dismissible;return _?this.toasts=this.toasts.map(o=>o.id===d?(this.publish({...o,...e,id:d,title:i}),{...o,...e,id:d,dismissible:b,title:i}):o):this.addToast({title:i,...a,dismissible:b,id:d}),d},this.dismiss=e=>(e||this.toasts.forEach(t=>{this.subscribers.forEach(i=>i({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let i;t.loading!==void 0&&(i=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let a=e instanceof Promise?e:e(),d=i!==void 0;return a.then(async _=>{if(QQ(_)&&!_.ok){d=!1;let b=typeof t.error=="function"?await t.error(`HTTP error! status: ${_.status}`):t.error,o=typeof t.description=="function"?await t.description(`HTTP error! status: ${_.status}`):t.description;this.create({id:i,type:"error",message:b,description:o})}else if(t.success!==void 0){d=!1;let b=typeof t.success=="function"?await t.success(_):t.success,o=typeof t.description=="function"?await t.description(_):t.description;this.create({id:i,type:"success",message:b,description:o})}}).catch(async _=>{if(t.error!==void 0){d=!1;let b=typeof t.error=="function"?await t.error(_):t.error,o=typeof t.description=="function"?await t.description(_):t.description;this.create({id:i,type:"error",message:b,description:o})}}).finally(()=>{var _;d&&(this.dismiss(i),i=void 0),(_=t.finally)==null||_.call(t)}),i},this.custom=(e,t)=>{let i=(t==null?void 0:t.id)||qC++;return this.create({jsx:e(i),id:i,...t}),i},this.subscribers=[],this.toasts=[]}},ol=new KQ,JQ=(e,t)=>{let i=(t==null?void 0:t.id)||qC++;return ol.addToast({title:e,...t,id:i}),i},QQ=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",eee=JQ,tee=()=>ol.toasts,Jn=Object.assign(eee,{success:ol.success,info:ol.info,warning:ol.warning,error:ol.error,custom:ol.custom,message:ol.message,promise:ol.promise,dismiss:ol.dismiss,loading:ol.loading},{getHistory:tee});function ree(e,{insertAt:t}={}){if(typeof document>"u")return;let i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",t==="top"&&i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}ree(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);const nee=()=>{const[e,t]=Y.useState(null),[i,a]=Y.useState(""),[d,_]=Y.useState(null),[b,o]=Y.useState(!0);Y.useState("asc");const[k,O]=Y.useState({startDate:void 0,endDate:void 0,vehicleType:void 0,location:"",sortBy:"distance",sortOrder:"asc"}),{ref:z,inView:F}=uH(),{data:G,isLoading:ee,error:J,hasNextPage:te,fetchNextPage:oe,isFetchingNextPage:X}=H7({queryKey:["available-cars",e,k,i],queryFn:({pageParam:et=0})=>xW({pageParam:et,filters:k,searchParams:{...e?{brand:e}:{},...i?{searchTerm:i}:{}}}),getNextPageParam:et=>et.nextPage||void 0,initialPageParam:0,enabled:d==="renter"}),{data:Q,isLoading:ue,error:he}=Ro({queryKey:["host-cars",i],queryFn:async()=>{var Rt;console.log("Fetching host cars with search:",i);const{data:{session:et}}=await Qt.auth.getSession();if(!((Rt=et==null?void 0:et.user)!=null&&Rt.id))return[];let Ge=Qt.from("cars").select("*").eq("owner_id",et.user.id);i&&(Ge=Ge.or(`brand.ilike.%${i}%,model.ilike.%${i}%`));const{data:qe,error:_t}=await Ge;if(_t)throw _t;return console.log("Host cars fetched:",qe),qe},enabled:d==="host"}),{data:Ie}=Ro({queryKey:["saved-car-ids"],queryFn:async()=>{var Rt;console.log("Fetching saved car IDs for home page");const{data:{session:et}}=await Qt.auth.getSession();if(!((Rt=et==null?void 0:et.user)!=null&&Rt.id))return new Set;const{data:Ge,error:qe}=await Qt.from("saved_cars").select("car_id").eq("user_id",et.user.id);if(qe)return console.error("Error fetching saved cars:",qe),new Set;const _t=new Set(Ge.map(Wt=>Wt.car_id));return console.log("Saved car IDs for home page:",Array.from(_t)),_t},enabled:d==="renter"}),Je=Q||[],Ce=Ie||new Set,Ze=(G==null?void 0:G.pages.flatMap(et=>et.data.map(Ge=>({...Ge,isSaved:Ce.has(Ge.id)}))))||[];return console.log("Available cars:",Ze),Y.useEffect(()=>{(async()=>{try{o(!0);const{data:{session:Ge},error:qe}=await Qt.auth.getSession();if(qe){console.error("Session error:",qe),Jn.error("Failed to fetch user session. Please try refreshing the page."),_(null);return}if(Ge!=null&&Ge.user){console.log("Fetching role for user ID:",Ge.user.id);const{data:_t,error:Rt}=await Qt.from("profiles").select("role").eq("id",Ge.user.id).single();if(Rt){console.error("Profile error:",Rt),Jn.error("Failed to fetch user profile. Please try refreshing the page."),_(null);return}_t&&(console.log("User role:",_t.role),_(_t.role))}}catch(Ge){console.error("Error fetching user role:",Ge),Jn.error("An unexpected error occurred. Please try refreshing the page.")}finally{o(!1)}})()},[]),Y.useEffect(()=>{F&&te&&!X&&oe()},[F,te,X,oe]),L.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[L.jsx(BF,{searchQuery:i,onSearchChange:a,onFiltersChange:O}),L.jsx("main",{className:"container mx-auto px-4 py-8",children:L.jsxs("div",{className:"space-y-6",children:[L.jsx(kG,{selectedBrand:e,onSelectBrand:t}),L.jsx(GF,{cars:d==="host"?Je:Ze,isLoading:d==="host"?ue:ee,error:d==="host"?he:J,loadMoreRef:z,isFetchingNextPage:X})]})}),L.jsx(So,{})]})};var d4,ci="colors",ds="sizes",Ar="space",iee={gap:Ar,gridGap:Ar,columnGap:Ar,gridColumnGap:Ar,rowGap:Ar,gridRowGap:Ar,inset:Ar,insetBlock:Ar,insetBlockEnd:Ar,insetBlockStart:Ar,insetInline:Ar,insetInlineEnd:Ar,insetInlineStart:Ar,margin:Ar,marginTop:Ar,marginRight:Ar,marginBottom:Ar,marginLeft:Ar,marginBlock:Ar,marginBlockEnd:Ar,marginBlockStart:Ar,marginInline:Ar,marginInlineEnd:Ar,marginInlineStart:Ar,padding:Ar,paddingTop:Ar,paddingRight:Ar,paddingBottom:Ar,paddingLeft:Ar,paddingBlock:Ar,paddingBlockEnd:Ar,paddingBlockStart:Ar,paddingInline:Ar,paddingInlineEnd:Ar,paddingInlineStart:Ar,top:Ar,right:Ar,bottom:Ar,left:Ar,scrollMargin:Ar,scrollMarginTop:Ar,scrollMarginRight:Ar,scrollMarginBottom:Ar,scrollMarginLeft:Ar,scrollMarginX:Ar,scrollMarginY:Ar,scrollMarginBlock:Ar,scrollMarginBlockEnd:Ar,scrollMarginBlockStart:Ar,scrollMarginInline:Ar,scrollMarginInlineEnd:Ar,scrollMarginInlineStart:Ar,scrollPadding:Ar,scrollPaddingTop:Ar,scrollPaddingRight:Ar,scrollPaddingBottom:Ar,scrollPaddingLeft:Ar,scrollPaddingX:Ar,scrollPaddingY:Ar,scrollPaddingBlock:Ar,scrollPaddingBlockEnd:Ar,scrollPaddingBlockStart:Ar,scrollPaddingInline:Ar,scrollPaddingInlineEnd:Ar,scrollPaddingInlineStart:Ar,fontSize:"fontSizes",background:ci,backgroundColor:ci,backgroundImage:ci,borderImage:ci,border:ci,borderBlock:ci,borderBlockEnd:ci,borderBlockStart:ci,borderBottom:ci,borderBottomColor:ci,borderColor:ci,borderInline:ci,borderInlineEnd:ci,borderInlineStart:ci,borderLeft:ci,borderLeftColor:ci,borderRight:ci,borderRightColor:ci,borderTop:ci,borderTopColor:ci,caretColor:ci,color:ci,columnRuleColor:ci,fill:ci,outline:ci,outlineColor:ci,stroke:ci,textDecorationColor:ci,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:ds,minBlockSize:ds,maxBlockSize:ds,inlineSize:ds,minInlineSize:ds,maxInlineSize:ds,width:ds,minWidth:ds,maxWidth:ds,height:ds,minHeight:ds,maxHeight:ds,flexBasis:ds,gridTemplateColumns:ds,gridTemplateRows:ds,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},oee=(e,t)=>typeof t=="function"?{"()":Function.prototype.toString.call(t)}:t,cv=()=>{const e=Object.create(null);return(t,i,...a)=>{const d=(_=>JSON.stringify(_,oee))(t);return d in e?e[d]:e[d]=i(t,...a)}},ob=Symbol.for("sxs.internal"),QM=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),h4=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:see}=Object.prototype,WC=e=>e.includes("-")?e:e.replace(/[A-Z]/g,t=>"-"+t.toLowerCase()),aee=/\s+(?![^()]*\))/,fm=e=>t=>e(...typeof t=="string"?String(t).split(aee):[t]),f4={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:fm((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e})),marginInline:fm((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e})),maxSize:fm((e,t)=>({maxBlockSize:e,maxInlineSize:t||e})),minSize:fm((e,t)=>({minBlockSize:e,minInlineSize:t||e})),paddingBlock:fm((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e})),paddingInline:fm((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e}))},KT=/([\d.]+)([^]*)/,lee=(e,t)=>e.length?e.reduce((i,a)=>(i.push(...t.map(d=>d.includes("&")?d.replace(/&/g,/[ +>|~]/.test(a)&&/&.*&/.test(d)?`:is(${a})`:a):a+" "+d)),i),[]):t,cee=(e,t)=>e in uee&&typeof t=="string"?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,a,d,_)=>a+(d==="stretch"?`-moz-available${_};${WC(e)}:${a}-webkit-fill-available`:`-moz-fit-content${_};${WC(e)}:${a}fit-content`)+_):String(t),uee={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},nu=e=>e?e+"-":"",HF=(e,t,i)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(a,d,_,b,o)=>b=="$"==!!_?a:(d||b=="--"?"calc(":"")+"var(--"+(b==="$"?nu(t)+(o.includes("$")?"":nu(i))+o.replace(/\$/g,"-"):o)+")"+(d||b=="--"?"*"+(d||"")+(_||"1")+")":"")),dee=/\s*,\s*(?![^()]*\))/,hee=Object.prototype.toString,Im=(e,t,i,a,d)=>{let _,b,o;const k=(O,z,F)=>{let G,ee;const J=te=>{for(G in te){const Q=G.charCodeAt(0)===64,ue=Q&&Array.isArray(te[G])?te[G]:[te[G]];for(ee of ue){const he=/[A-Z]/.test(X=G)?X:X.replace(/-[^]/g,Je=>Je[1].toUpperCase()),Ie=typeof ee=="object"&&ee&&ee.toString===hee&&(!a.utils[he]||!z.length);if(he in a.utils&&!Ie){const Je=a.utils[he];if(Je!==b){b=Je,J(Je(ee)),b=null;continue}}else if(he in f4){const Je=f4[he];if(Je!==o){o=Je,J(Je(ee)),o=null;continue}}if(Q&&(oe=G.slice(1)in a.media?"@media "+a.media[G.slice(1)]:G,G=oe.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(Je,Ce,Ze,et,Ge,qe)=>{const _t=KT.test(Ce),Rt=.0625*(_t?-1:1),[Wt,wt]=_t?[et,Ce]:[Ce,et];return"("+(Ze[0]==="="?"":Ze[0]===">"===_t?"max-":"min-")+Wt+":"+(Ze[0]!=="="&&Ze.length===1?wt.replace(KT,(jt,Ct,st)=>Number(Ct)+Rt*(Ze===">"?1:-1)+st):wt)+(Ge?") and ("+(Ge[0]===">"?"min-":"max-")+Wt+":"+(Ge.length===1?qe.replace(KT,(jt,Ct,st)=>Number(Ct)+Rt*(Ge===">"?-1:1)+st):qe):"")+")"})),Ie){const Je=Q?F.concat(G):[...F],Ce=Q?[...z]:lee(z,G.split(dee));_!==void 0&&d(p4(..._)),_=void 0,k(ee,Ce,Je)}else _===void 0&&(_=[[],z,F]),G=Q||G.charCodeAt(0)!==36?G:`--${nu(a.prefix)}${G.slice(1).replace(/\$/g,"-")}`,ee=Ie?ee:typeof ee=="number"?ee&&he in fee?String(ee)+"px":String(ee):HF(cee(he,ee??""),a.prefix,a.themeMap[he]),_[0].push(`${Q?`${G} `:`${WC(G)}:`}${ee}`)}}var oe,X};J(O),_!==void 0&&d(p4(..._)),_=void 0};k(e,t,i)},p4=(e,t,i)=>`${i.map(a=>`${a}{`).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,fee={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},m4=e=>String.fromCharCode(e+(e>25?39:97)),ff=e=>(t=>{let i,a="";for(i=Math.abs(t);i>52;i=i/52|0)a=m4(i%52)+a;return m4(i%52)+a})(((t,i)=>{let a=i.length;for(;a;)t=33*t^i.charCodeAt(--a);return t})(5381,JSON.stringify(e))>>>0),Vy=["themed","global","styled","onevar","resonevar","allvar","inline"],pee=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch{return!1}},mee=e=>{let t;const i=()=>{const{cssRules:d}=t.sheet;return[].map.call(d,(_,b)=>{const{cssText:o}=_;let k="";if(o.startsWith("--sxs"))return"";if(d[b-1]&&(k=d[b-1].cssText).startsWith("--sxs")){if(!_.cssRules.length)return"";for(const O in t.rules)if(t.rules[O].group===_)return`--sxs{--sxs:${[...t.rules[O].cache].join(" ")}}${o}`;return _.cssRules.length?`${k}${o}`:""}return o}).join("")},a=()=>{if(t){const{rules:o,sheet:k}=t;if(!k.deleteRule){for(;Object(Object(k.cssRules)[0]).type===3;)k.cssRules.splice(0,1);k.cssRules=[]}for(const O in o)delete o[O]}const d=Object(e).styleSheets||[];for(const o of d)if(pee(o)){for(let k=0,O=o.cssRules;O[k];++k){const z=Object(O[k]);if(z.type!==1)continue;const F=Object(O[k+1]);if(F.type!==4)continue;++k;const{cssText:G}=z;if(!G.startsWith("--sxs"))continue;const ee=G.slice(14,-3).trim().split(/\s+/),J=Vy[ee[0]];J&&(t||(t={sheet:o,reset:a,rules:{},toString:i}),t.rules[J]={group:F,index:k,cache:new Set(ee)})}if(t)break}if(!t){const o=(k,O)=>({type:O,cssRules:[],insertRule(z,F){this.cssRules.splice(F,0,o(z,{import:3,undefined:1}[(z.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return k==="@media{}"?`@media{${[].map.call(this.cssRules,z=>z.cssText).join("")}}`:k}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:o("","text/css"),rules:{},reset:a,toString:i}}const{sheet:_,rules:b}=t;for(let o=Vy.length-1;o>=0;--o){const k=Vy[o];if(!b[k]){const O=Vy[o+1],z=b[O]?b[O].index:_.cssRules.length;_.insertRule("@media{}",z),_.insertRule(`--sxs{--sxs:${o}}`,z),b[k]={group:_.cssRules[z+1],index:z,cache:new Set([o])}}gee(b[k])}};return a(),t},gee=e=>{const t=e.group;let i=t.cssRules.length;e.apply=a=>{try{t.insertRule(a,i),++i}catch{}}},Iy=Symbol(),_ee=cv(),yee=(e,t)=>_ee(e,()=>(...i)=>{let a={type:null,composers:new Set};for(const d of i)if(d!=null)if(d[ob]){a.type==null&&(a.type=d[ob].type);for(const _ of d[ob].composers)a.composers.add(_)}else d.constructor!==Object||d.$$typeof?a.type==null&&(a.type=d):a.composers.add(vee(d,e));return a.type==null&&(a.type="span"),a.composers.size||a.composers.add(["PJLV",{},[],[],{},[]]),xee(e,a,t)}),vee=({variants:e,compoundVariants:t,defaultVariants:i,...a},d)=>{const _=`${nu(d.prefix)}c-${ff(a)}`,b=[],o=[],k=Object.create(null),O=[];for(const G in i)k[G]=String(i[G]);if(typeof e=="object"&&e)for(const G in e){z=k,F=G,see.call(z,F)||(k[G]="undefined");const ee=e[G];for(const J in ee){const te={[G]:String(J)};String(J)==="undefined"&&O.push(G);const oe=ee[J],X=[te,oe,!h4(oe)];b.push(X)}}var z,F;if(typeof t=="object"&&t)for(const G of t){let{css:ee,...J}=G;ee=typeof ee=="object"&&ee||{};for(const oe in J)J[oe]=String(J[oe]);const te=[J,ee,!h4(ee)];o.push(te)}return[_,a,b,o,k,O]},xee=(e,t,i)=>{const[a,d,_,b]=bee(t.composers),o=typeof t.type=="function"||t.type.$$typeof?(F=>{function G(){for(let ee=0;ee<G[Iy].length;ee++){const[J,te]=G[Iy][ee];F.rules[J].apply(te)}return G[Iy]=[],null}return G[Iy]=[],G.rules={},Vy.forEach(ee=>G.rules[ee]={apply:J=>G[Iy].push([ee,J])}),G})(i):null,k=(o||i).rules,O=`.${a}${d.length>1?`:where(.${d.slice(1).join(".")})`:""}`,z=F=>{F=typeof F=="object"&&F||wee;const{css:G,...ee}=F,J={};for(const X in _)if(delete ee[X],X in F){let Q=F[X];typeof Q=="object"&&Q?J[X]={"@initial":_[X],...Q}:(Q=String(Q),J[X]=Q!=="undefined"||b.has(X)?Q:_[X])}else J[X]=_[X];const te=new Set([...d]);for(const[X,Q,ue,he]of t.composers){i.rules.styled.cache.has(X)||(i.rules.styled.cache.add(X),Im(Q,[`.${X}`],[],e,Ce=>{k.styled.apply(Ce)}));const Ie=g4(ue,J,e.media),Je=g4(he,J,e.media,!0);for(const Ce of Ie)if(Ce!==void 0)for(const[Ze,et,Ge]of Ce){const qe=`${X}-${ff(et)}-${Ze}`;te.add(qe);const _t=(Ge?i.rules.resonevar:i.rules.onevar).cache,Rt=Ge?k.resonevar:k.onevar;_t.has(qe)||(_t.add(qe),Im(et,[`.${qe}`],[],e,Wt=>{Rt.apply(Wt)}))}for(const Ce of Je)if(Ce!==void 0)for(const[Ze,et]of Ce){const Ge=`${X}-${ff(et)}-${Ze}`;te.add(Ge),i.rules.allvar.cache.has(Ge)||(i.rules.allvar.cache.add(Ge),Im(et,[`.${Ge}`],[],e,qe=>{k.allvar.apply(qe)}))}}if(typeof G=="object"&&G){const X=`${a}-i${ff(G)}-css`;te.add(X),i.rules.inline.cache.has(X)||(i.rules.inline.cache.add(X),Im(G,[`.${X}`],[],e,Q=>{k.inline.apply(Q)}))}for(const X of String(F.className||"").trim().split(/\s+/))X&&te.add(X);const oe=ee.className=[...te].join(" ");return{type:t.type,className:oe,selector:O,props:ee,toString:()=>oe,deferredInjector:o}};return QM(z,{className:a,selector:O,[ob]:t,toString:()=>(i.rules.styled.cache.has(a)||z(),a)})},bee=e=>{let t="";const i=[],a={},d=[];for(const[_,,,,b,o]of e){t===""&&(t=_),i.push(_),d.push(...o);for(const k in b){const O=b[k];(a[k]===void 0||O!=="undefined"||o.includes(O))&&(a[k]=O)}}return[t,i,a,new Set(d)]},g4=(e,t,i,a)=>{const d=[];e:for(let[_,b,o]of e){if(o)continue;let k,O=0,z=!1;for(k in _){const F=_[k];let G=t[k];if(G!==F){if(typeof G!="object"||!G)continue e;{let ee,J,te=0;for(const oe in G){if(F===String(G[oe])){if(oe!=="@initial"){const X=oe.slice(1);(J=J||[]).push(X in i?i[X]:oe.replace(/^@media ?/,"")),z=!0}O+=te,ee=!0}++te}if(J&&J.length&&(b={["@media "+J.join(", ")]:b}),!ee)continue e}}}(d[O]=d[O]||[]).push([a?"cv":`${k}-${_[k]}`,b,z])}return d},wee={},See=cv(),Tee=(e,t)=>See(e,()=>(...i)=>{const a=()=>{for(let d of i){d=typeof d=="object"&&d||{};let _=ff(d);if(!t.rules.global.cache.has(_)){if(t.rules.global.cache.add(_),"@import"in d){let b=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let o of[].concat(d["@import"]))o=o.includes('"')||o.includes("'")?o:`"${o}"`,t.sheet.insertRule(`@import ${o};`,b++);delete d["@import"]}Im(d,[],[],e,b=>{t.rules.global.apply(b)})}}return""};return QM(a,{toString:a})}),Eee=cv(),Cee=(e,t)=>Eee(e,()=>i=>{const a=`${nu(e.prefix)}k-${ff(i)}`,d=()=>{if(!t.rules.global.cache.has(a)){t.rules.global.cache.add(a);const _=[];Im(i,[],[],e,o=>_.push(o));const b=`@keyframes ${a}{${_.join("")}}`;t.rules.global.apply(b)}return a};return QM(d,{get name(){return d()},toString:d})}),Mee=class{constructor(t,i,a,d){this.token=t==null?"":String(t),this.value=i==null?"":String(i),this.scale=a==null?"":String(a),this.prefix=d==null?"":String(d)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+nu(this.prefix)+nu(this.scale)+this.token}toString(){return this.computedValue}},Pee=cv(),Aee=(e,t)=>Pee(e,()=>(i,a)=>{a=typeof i=="object"&&i||Object(a);const d=`.${i=(i=typeof i=="string"?i:"")||`${nu(e.prefix)}t-${ff(a)}`}`,_={},b=[];for(const k in a){_[k]={};for(const O in a[k]){const z=`--${nu(e.prefix)}${k}-${O}`,F=HF(String(a[k][O]),e.prefix,k);_[k][O]=new Mee(O,F,k,e.prefix),b.push(`${z}:${F}`)}}const o=()=>{if(b.length&&!t.rules.themed.cache.has(i)){t.rules.themed.cache.add(i);const k=`${a===e.theme?":root,":""}.${i}{${b.join(";")}}`;t.rules.themed.apply(k)}return i};return{..._,get className(){return o()},selector:d,toString:o}}),Iee=cv(),qF=e=>{let t=!1;const i=Iee(e,a=>{t=!0;const d="prefix"in(a=typeof a=="object"&&a||{})?String(a.prefix):"",_=typeof a.media=="object"&&a.media||{},b=typeof a.root=="object"?a.root||null:globalThis.document||null,o=typeof a.theme=="object"&&a.theme||{},k={prefix:d,media:_,theme:o,themeMap:typeof a.themeMap=="object"&&a.themeMap||{...iee},utils:typeof a.utils=="object"&&a.utils||{}},O=mee(b),z={css:yee(k,O),globalCss:Tee(k,O),keyframes:Cee(k,O),createTheme:Aee(k,O),reset(){O.reset(),z.theme.toString()},theme:{},sheet:O,config:k,prefix:d,getCssText:O.toString,toString:O.toString};return String(z.theme=z.createTheme(o)),z});return t||i.reset(),i},WF=()=>d4||(d4=qF()),kee=(...e)=>WF().createTheme(...e),au=(...e)=>WF().css(...e),Ree={default:{colors:{brand:"hsl(153 60.0% 53.0%)",brandAccent:"hsl(154 54.8% 45.1%)",brandButtonText:"white",defaultButtonBackground:"white",defaultButtonBackgroundHover:"#eaeaea",defaultButtonBorder:"lightgray",defaultButtonText:"gray",dividerBackground:"#eaeaea",inputBackground:"transparent",inputBorder:"lightgray",inputBorderHover:"gray",inputBorderFocus:"gray",inputText:"black",inputLabelText:"gray",inputPlaceholder:"darkgray",messageText:"#2b805a",messageBackground:"#e7fcf1",messageBorder:"#d0f3e1",messageTextDanger:"#ff6369",messageBackgroundDanger:"#fff8f8",messageBorderDanger:"#822025",anchorTextColor:"gray",anchorTextHoverColor:"darkgray"},space:{spaceSmall:"4px",spaceMedium:"8px",spaceLarge:"16px",labelBottomMargin:"8px",anchorBottomMargin:"4px",emailInputSpacing:"4px",socialAuthSpacing:"4px",buttonPadding:"10px 15px",inputPadding:"10px 15px"},fontSizes:{baseBodySize:"13px",baseInputSize:"14px",baseLabelSize:"14px",baseButtonSize:"14px"},fonts:{bodyFontFamily:"ui-sans-serif, sans-serif",buttonFontFamily:"ui-sans-serif, sans-serif",inputFontFamily:"ui-sans-serif, sans-serif",labelFontFamily:"ui-sans-serif, sans-serif"},borderWidths:{buttonBorderWidth:"1px",inputBorderWidth:"1px"},radii:{borderRadiusButton:"4px",buttonBorderRadius:"4px",inputBorderRadius:"4px"}},dark:{colors:{brandButtonText:"white",defaultButtonBackground:"#2e2e2e",defaultButtonBackgroundHover:"#3e3e3e",defaultButtonBorder:"#3e3e3e",defaultButtonText:"white",dividerBackground:"#2e2e2e",inputBackground:"#1e1e1e",inputBorder:"#3e3e3e",inputBorderHover:"gray",inputBorderFocus:"gray",inputText:"white",inputPlaceholder:"darkgray",messageText:"#85e0b7",messageBackground:"#072719",messageBorder:"#2b805a",messageBackgroundDanger:"#1f1315"}}},Ji={SIGN_IN:"sign_in",SIGN_UP:"sign_up",FORGOTTEN_PASSWORD:"forgotten_password",MAGIC_LINK:"magic_link",UPDATE_PASSWORD:"update_password",VERIFY_OTP:"verify_otp"},Dee="supabase-auth-ui",Lee={ROOT:"root",SIGN_IN:Ji.SIGN_IN,SIGN_UP:Ji.SIGN_UP,FORGOTTEN_PASSWORD:Ji.FORGOTTEN_PASSWORD,MAGIC_LINK:Ji.MAGIC_LINK,UPDATE_PASSWORD:Ji.UPDATE_PASSWORD,anchor:"ui-anchor",button:"ui-button",container:"ui-container",divider:"ui-divider",input:"ui-input",label:"ui-label",loader:"ui-loader",message:"ui-message"};function Df(e,t,i){var a,d;const _=[],b=Lee[e];return _.push(i!=null&&i.prependedClassName?(i==null?void 0:i.prependedClassName)+"_"+b:Dee+"_"+b),(a=i==null?void 0:i.className)!=null&&a[e]&&_.push((d=i==null?void 0:i.className)==null?void 0:d[e]),((i==null?void 0:i.extend)===void 0||(i==null?void 0:i.extend)===!0)&&_.push(t),_}function ZC(e,t){let i;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(Array.isArray(t))for(i=0;i<t.length;i++)e[i]=ZC(e[i],t[i]);else for(i in t)e[i]=ZC(e[i],t[i]);return e}return t}function JT(e,...t){let i=t.length;for(let a=0;a<i;a++)e=ZC(e,t[a]);return e}function Oee(e,t){return e.replace(/{{(\w+)}}/g,(i,a)=>t.hasOwnProperty(a)?t[a]:i)}var zee={sign_up:{email_label:"Email address",password_label:"Create a Password",email_input_placeholder:"Your email address",password_input_placeholder:"Your password",button_label:"Sign up",loading_button_label:"Signing up ...",social_provider_text:"Sign in with {{provider}}",link_text:"Don't have an account? Sign up",confirmation_text:"Check your email for the confirmation link"},sign_in:{email_label:"Email address",password_label:"Your Password",email_input_placeholder:"Your email address",password_input_placeholder:"Your password",button_label:"Sign in",loading_button_label:"Signing in ...",social_provider_text:"Sign in with {{provider}}",link_text:"Already have an account? Sign in"},magic_link:{email_input_label:"Email address",email_input_placeholder:"Your email address",button_label:"Send Magic Link",loading_button_label:"Sending Magic Link ...",link_text:"Send a magic link email",confirmation_text:"Check your email for the magic link"},forgotten_password:{email_label:"Email address",password_label:"Your Password",email_input_placeholder:"Your email address",button_label:"Send reset password instructions",loading_button_label:"Sending reset instructions ...",link_text:"Forgot your password?",confirmation_text:"Check your email for the password reset link"},update_password:{password_label:"New password",password_input_placeholder:"Your new password",button_label:"Update password",loading_button_label:"Updating password ...",confirmation_text:"Your password has been updated"},verify_otp:{email_input_label:"Email address",email_input_placeholder:"Your email address",phone_input_label:"Phone number",phone_input_placeholder:"Your phone number",token_input_label:"Token",token_input_placeholder:"Your Otp token",button_label:"Verify token",loading_button_label:"Signing in ..."}};const Nee=au({fontFamily:"$bodyFontFamily",fontSize:"$baseBodySize",marginBottom:"$anchorBottomMargin",color:"$anchorTextColor",display:"block",textAlign:"center",textDecoration:"underline","&:hover":{color:"$anchorTextHoverColor"}}),Kh=({children:e,appearance:t,...i})=>{var a;const d=Df("anchor",Nee(),t);return Fe.createElement("a",{...i,style:(a=t==null?void 0:t.style)==null?void 0:a.anchor,className:d.join(" ")},e)},Fee=au({fontFamily:"$buttonFontFamily",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",borderRadius:"$borderRadiusButton",fontSize:"$baseButtonSize",padding:"$buttonPadding",cursor:"pointer",borderWidth:"$buttonBorderWidth",borderStyle:"solid",width:"100%",transitionProperty:"background-color",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionDuration:"100ms","&:disabled":{opacity:.7,cursor:"unset"},variants:{color:{default:{backgroundColor:"$defaultButtonBackground",color:"$defaultButtonText",borderColor:"$defaultButtonBorder","&:hover:not(:disabled)":{backgroundColor:"$defaultButtonBackgroundHover"}},primary:{backgroundColor:"$brand",color:"$brandButtonText",borderColor:"$brandAccent","&:hover:not(:disabled)":{backgroundColor:"$brandAccent"}}}}}),Rg=({children:e,color:t="default",appearance:i,icon:a,loading:d=!1,..._})=>{var b;const o=Df("button",Fee({color:t}),i);return Fe.createElement("button",{..._,style:(b=i==null?void 0:i.style)==null?void 0:b.button,className:o.join(" "),disabled:d},a,e)},jee=au({display:"flex",gap:"4px",variants:{direction:{horizontal:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(48px, 1fr))"},vertical:{flexDirection:"column",margin:"8px 0"}},gap:{small:{gap:"4px"},medium:{gap:"8px"},large:{gap:"16px"}}}}),nc=({children:e,appearance:t,...i})=>{var a;const d=Df("container",jee({direction:i.direction,gap:i.gap}),t);return Fe.createElement("div",{...i,style:(a=t==null?void 0:t.style)==null?void 0:a.container,className:d.join(" ")},e)},Bee=au({background:"$dividerBackground",display:"block",margin:"16px 0",height:"1px",width:"100%"}),Uee=({children:e,appearance:t,...i})=>{var a;const d=Df("divider",Bee(),t);return Fe.createElement("div",{...i,style:(a=t==null?void 0:t.style)==null?void 0:a.divider,className:d.join(" ")})},Vee=au({fontFamily:"$inputFontFamily",background:"$inputBackground",borderRadius:"$inputBorderRadius",padding:"$inputPadding",cursor:"text",borderWidth:"$inputBorderWidth",borderColor:"$inputBorder",borderStyle:"solid",fontSize:"$baseInputSize",width:"100%",color:"$inputText",boxSizing:"border-box","&:hover":{borderColor:"$inputBorderHover",outline:"none"},"&:focus":{borderColor:"$inputBorderFocus",outline:"none"},"&::placeholder":{color:"$inputPlaceholder",letterSpacing:"initial"},transitionProperty:"background-color, border",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionDuration:"100ms",variants:{type:{default:{letterSpacing:"0px"},password:{letterSpacing:"0px"}}}}),Od=({children:e,appearance:t,...i})=>{var a;const d=Df("input",Vee({type:i.type==="password"?"password":"default"}),t);return Fe.createElement("input",{...i,style:(a=t==null?void 0:t.style)==null?void 0:a.input,className:d.join(" ")},e)},$ee=au({fontFamily:"$labelFontFamily",fontSize:"$baseLabelSize",marginBottom:"$labelBottomMargin",color:"$inputLabelText",display:"block"}),zd=({children:e,appearance:t,...i})=>{var a;const d=Df("label",$ee(),t);return Fe.createElement("label",{...i,style:(a=t==null?void 0:t.style)==null?void 0:a.label,className:d.join(" ")},e)},Gee=au({fontFamily:"$bodyFontFamily",fontSize:"$baseInputSize",marginBottom:"$labelBottomMargin",display:"block",textAlign:"center",borderRadius:"0.375rem",padding:"1.5rem 1rem",lineHeight:"1rem",color:"$messageText",backgroundColor:"$messageBackground",border:"1px solid $messageBorder",variants:{color:{danger:{color:"$messageTextDanger",backgroundColor:"$messageBackgroundDanger",border:"1px solid $messageBorderDanger"}}}}),sc=({children:e,appearance:t,...i})=>{var a;const d=Df("message",Gee({color:i.color}),t);return Fe.createElement("span",{...i,style:(a=t==null?void 0:t.style)==null?void 0:a.message,className:d.join(" ")},e)};function ZF({setAuthView:e=()=>{},supabaseClient:t,redirectTo:i,i18n:a,appearance:d,showLinks:_=!1}){var b;const[o,k]=Y.useState(""),[O,z]=Y.useState(""),[F,G]=Y.useState(""),[ee,J]=Y.useState(!1),te=async X=>{var Q,ue;if(X.preventDefault(),z(""),G(""),J(!0),o.length===0){z((Q=a==null?void 0:a.magic_link)==null?void 0:Q.empty_email_address),J(!1);return}const{error:he}=await t.auth.signInWithOtp({email:o,options:{emailRedirectTo:i}});he?z(he.message):G((ue=a==null?void 0:a.magic_link)==null?void 0:ue.confirmation_text),J(!1)},oe=a==null?void 0:a.magic_link;return Fe.createElement("form",{id:"auth-magic-link",onSubmit:te},Fe.createElement(nc,{gap:"large",direction:"vertical",appearance:d},Fe.createElement("div",null,Fe.createElement(zd,{htmlFor:"email",appearance:d},oe==null?void 0:oe.email_input_label),Fe.createElement(Od,{id:"email",name:"email",type:"email",autoFocus:!0,placeholder:oe==null?void 0:oe.email_input_placeholder,onChange:X=>{z&&z(""),k(X.target.value)},appearance:d})),Fe.createElement(Rg,{color:"primary",type:"submit",loading:ee,appearance:d},ee?oe==null?void 0:oe.loading_button_label:oe==null?void 0:oe.button_label),_&&Fe.createElement(Kh,{href:"#auth-sign-in",onClick:X=>{X.preventDefault(),e(Ji.SIGN_IN)},appearance:d},(b=a==null?void 0:a.sign_in)==null?void 0:b.link_text),F&&Fe.createElement(sc,{appearance:d},F),O&&Fe.createElement(sc,{color:"danger",appearance:d},O)))}const Go=au({width:"21px",height:"21px"}),Hee=({provider:e})=>e=="google"?qee():e=="facebook"?Wee():e=="twitter"?Zee():e=="apple"?Yee():e=="github"?Xee():e=="gitlab"?Kee():e=="bitbucket"?Jee():e=="discord"?Qee():e=="azure"?ete():e=="keycloak"?tte():e=="linkedin"?rte():e=="notion"?nte():e=="slack"?ite():e=="spotify"?ote():e=="twitch"?ste():e=="workos"?ate():e=="kakao"?lte():null,qee=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},Fe.createElement("path",{fill:"#FFC107",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),Fe.createElement("path",{fill:"#FF3D00",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),Fe.createElement("path",{fill:"#4CAF50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),Fe.createElement("path",{fill:"#1976D2",d:"M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})),Wee=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},Fe.createElement("path",{fill:"#039be5",d:"M24 5A19 19 0 1 0 24 43A19 19 0 1 0 24 5Z"}),Fe.createElement("path",{fill:"#fff",d:"M26.572,29.036h4.917l0.772-4.995h-5.69v-2.73c0-2.075,0.678-3.915,2.619-3.915h3.119v-4.359c-0.548-0.074-1.707-0.236-3.897-0.236c-4.573,0-7.254,2.415-7.254,7.917v3.323h-4.701v4.995h4.701v13.729C22.089,42.905,23.032,43,24,43c0.875,0,1.729-0.08,2.572-0.194V29.036z"})),Zee=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},Fe.createElement("path",{fill:"#03A9F4",d:"M42,12.429c-1.323,0.586-2.746,0.977-4.247,1.162c1.526-0.906,2.7-2.351,3.251-4.058c-1.428,0.837-3.01,1.452-4.693,1.776C34.967,9.884,33.05,9,30.926,9c-4.08,0-7.387,3.278-7.387,7.32c0,0.572,0.067,1.129,0.193,1.67c-6.138-0.308-11.582-3.226-15.224-7.654c-0.64,1.082-1,2.349-1,3.686c0,2.541,1.301,4.778,3.285,6.096c-1.211-0.037-2.351-0.374-3.349-0.914c0,0.022,0,0.055,0,0.086c0,3.551,2.547,6.508,5.923,7.181c-0.617,0.169-1.269,0.263-1.941,0.263c-0.477,0-0.942-0.054-1.392-0.135c0.94,2.902,3.667,5.023,6.898,5.086c-2.528,1.96-5.712,3.134-9.174,3.134c-0.598,0-1.183-0.034-1.761-0.104C9.268,36.786,13.152,38,17.321,38c13.585,0,21.017-11.156,21.017-20.834c0-0.317-0.01-0.633-0.025-0.945C39.763,15.197,41.013,13.905,42,12.429"})),Yee=()=>Fe.createElement("svg",{className:Go(),fill:"gray",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"21px",height:"21px"}," ",Fe.createElement("path",{d:"M 15.904297 1.078125 C 15.843359 1.06875 15.774219 1.0746094 15.699219 1.0996094 C 14.699219 1.2996094 13.600391 1.8996094 12.900391 2.5996094 C 12.300391 3.1996094 11.800781 4.1996094 11.800781 5.0996094 C 11.800781 5.2996094 11.999219 5.5 12.199219 5.5 C 13.299219 5.4 14.399609 4.7996094 15.099609 4.0996094 C 15.699609 3.2996094 16.199219 2.4 16.199219 1.5 C 16.199219 1.275 16.087109 1.10625 15.904297 1.078125 z M 16.199219 5.4003906 C 14.399219 5.4003906 13.600391 6.5 12.400391 6.5 C 11.100391 6.5 9.9003906 5.5 8.4003906 5.5 C 6.3003906 5.5 3.0996094 7.4996094 3.0996094 12.099609 C 2.9996094 16.299609 6.8 21 9 21 C 10.3 21 10.600391 20.199219 12.400391 20.199219 C 14.200391 20.199219 14.600391 21 15.900391 21 C 17.400391 21 18.500391 19.399609 19.400391 18.099609 C 19.800391 17.399609 20.100391 17.000391 20.400391 16.400391 C 20.600391 16.000391 20.4 15.600391 20 15.400391 C 17.4 14.100391 16.900781 9.9003906 19.800781 8.4003906 C 20.300781 8.1003906 20.4 7.4992188 20 7.1992188 C 18.9 6.1992187 17.299219 5.4003906 16.199219 5.4003906 z"})),Xee=()=>Fe.createElement("svg",{className:Go(),fill:"gray",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"21px",height:"21px"}," ",Fe.createElement("path",{d:"M15,3C8.373,3,3,8.373,3,15c0,5.623,3.872,10.328,9.092,11.63C12.036,26.468,12,26.28,12,26.047v-2.051 c-0.487,0-1.303,0-1.508,0c-0.821,0-1.551-0.353-1.905-1.009c-0.393-0.729-0.461-1.844-1.435-2.526 c-0.289-0.227-0.069-0.486,0.264-0.451c0.615,0.174,1.125,0.596,1.605,1.222c0.478,0.627,0.703,0.769,1.596,0.769 c0.433,0,1.081-0.025,1.691-0.121c0.328-0.833,0.895-1.6,1.588-1.962c-3.996-0.411-5.903-2.399-5.903-5.098 c0-1.162,0.495-2.286,1.336-3.233C9.053,10.647,8.706,8.73,9.435,8c1.798,0,2.885,1.166,3.146,1.481C13.477,9.174,14.461,9,15.495,9 c1.036,0,2.024,0.174,2.922,0.483C18.675,9.17,19.763,8,21.565,8c0.732,0.731,0.381,2.656,0.102,3.594 c0.836,0.945,1.328,2.066,1.328,3.226c0,2.697-1.904,4.684-5.894,5.097C18.199,20.49,19,22.1,19,23.313v2.734 c0,0.104-0.023,0.179-0.035,0.268C23.641,24.676,27,20.236,27,15C27,8.373,21.627,3,15,3z"})),Kee=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},Fe.createElement("path",{fill:"#e53935",d:"M24 43L16 20 32 20z"}),Fe.createElement("path",{fill:"#ff7043",d:"M24 43L42 20 32 20z"}),Fe.createElement("path",{fill:"#e53935",d:"M37 5L42 20 32 20z"}),Fe.createElement("path",{fill:"#ffa726",d:"M24 43L42 20 45 28z"}),Fe.createElement("path",{fill:"#ff7043",d:"M24 43L6 20 16 20z"}),Fe.createElement("path",{fill:"#e53935",d:"M11 5L6 20 16 20z"}),Fe.createElement("path",{fill:"#ffa726",d:"M24 43L6 20 3 28z"})),Jee=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",width:"512",height:"512",viewBox:"0 0 62.42 62.42"},Fe.createElement("defs",null,Fe.createElement("linearGradient",{id:"New_Gradient_Swatch_1",x1:"64.01",y1:"30.27",x2:"32.99",y2:"54.48",gradientUnits:"userSpaceOnUse"},Fe.createElement("stop",{offset:"0.18",stopColor:"#0052cc"}),Fe.createElement("stop",{offset:"1",stopColor:"#2684ff"}))),Fe.createElement("title",null,"Bitbucket-blue"),Fe.createElement("g",{id:"Layer_2","data-name":"Layer 2"},Fe.createElement("g",{id:"Blue",transform:"translate(0 -3.13)"},Fe.createElement("path",{d:"M2,6.26A2,2,0,0,0,0,8.58L8.49,60.12a2.72,2.72,0,0,0,2.66,2.27H51.88a2,2,0,0,0,2-1.68L62.37,8.59a2,2,0,0,0-2-2.32ZM37.75,43.51h-13L21.23,25.12H40.9Z",fill:"#2684ff"}),Fe.createElement("path",{d:"M59.67,25.12H40.9L37.75,43.51h-13L9.4,61.73a2.71,2.71,0,0,0,1.75.66H51.89a2,2,0,0,0,2-1.68Z",fill:"url(#New_Gradient_Swatch_1)"})))),Qee=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},Fe.createElement("path",{fill:"#536dfe",d:"M39.248,10.177c-2.804-1.287-5.812-2.235-8.956-2.778c-0.057-0.01-0.114,0.016-0.144,0.068	c-0.387,0.688-0.815,1.585-1.115,2.291c-3.382-0.506-6.747-0.506-10.059,0c-0.3-0.721-0.744-1.603-1.133-2.291	c-0.03-0.051-0.087-0.077-0.144-0.068c-3.143,0.541-6.15,1.489-8.956,2.778c-0.024,0.01-0.045,0.028-0.059,0.051	c-5.704,8.522-7.267,16.835-6.5,25.044c0.003,0.04,0.026,0.079,0.057,0.103c3.763,2.764,7.409,4.442,10.987,5.554	c0.057,0.017,0.118-0.003,0.154-0.051c0.846-1.156,1.601-2.374,2.248-3.656c0.038-0.075,0.002-0.164-0.076-0.194	c-1.197-0.454-2.336-1.007-3.432-1.636c-0.087-0.051-0.094-0.175-0.014-0.234c0.231-0.173,0.461-0.353,0.682-0.534	c0.04-0.033,0.095-0.04,0.142-0.019c7.201,3.288,14.997,3.288,22.113,0c0.047-0.023,0.102-0.016,0.144,0.017	c0.22,0.182,0.451,0.363,0.683,0.536c0.08,0.059,0.075,0.183-0.012,0.234c-1.096,0.641-2.236,1.182-3.434,1.634	c-0.078,0.03-0.113,0.12-0.075,0.196c0.661,1.28,1.415,2.498,2.246,3.654c0.035,0.049,0.097,0.07,0.154,0.052	c3.595-1.112,7.241-2.79,11.004-5.554c0.033-0.024,0.054-0.061,0.057-0.101c0.917-9.491-1.537-17.735-6.505-25.044	C39.293,10.205,39.272,10.187,39.248,10.177z M16.703,30.273c-2.168,0-3.954-1.99-3.954-4.435s1.752-4.435,3.954-4.435	c2.22,0,3.989,2.008,3.954,4.435C20.658,28.282,18.906,30.273,16.703,30.273z M31.324,30.273c-2.168,0-3.954-1.99-3.954-4.435	s1.752-4.435,3.954-4.435c2.22,0,3.989,2.008,3.954,4.435C35.278,28.282,33.544,30.273,31.324,30.273z"})),ete=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},Fe.createElement("linearGradient",{id:"k8yl7~hDat~FaoWq8WjN6a",x1:"-1254.397",x2:"-1261.911",y1:"877.268",y2:"899.466",gradientTransform:"translate(1981.75 -1362.063) scale(1.5625)",gradientUnits:"userSpaceOnUse"},Fe.createElement("stop",{offset:"0",stopColor:"#114a8b"}),Fe.createElement("stop",{offset:"1",stopColor:"#0669bc"})),Fe.createElement("path",{fill:"url(#k8yl7~hDat~FaoWq8WjN6a)",d:"M17.634,6h11.305L17.203,40.773c-0.247,0.733-0.934,1.226-1.708,1.226H6.697 c-0.994,0-1.8-0.806-1.8-1.8c0-0.196,0.032-0.39,0.094-0.576L15.926,7.227C16.173,6.494,16.86,6,17.634,6L17.634,6z"}),Fe.createElement("path",{fill:"#0078d4",d:"M34.062,29.324H16.135c-0.458-0.001-0.83,0.371-0.831,0.829c0,0.231,0.095,0.451,0.264,0.608 l11.52,10.752C27.423,41.826,27.865,42,28.324,42h10.151L34.062,29.324z"}),Fe.createElement("linearGradient",{id:"k8yl7~hDat~FaoWq8WjN6b",x1:"-1252.05",x2:"-1253.788",y1:"887.612",y2:"888.2",gradientTransform:"translate(1981.75 -1362.063) scale(1.5625)",gradientUnits:"userSpaceOnUse"},Fe.createElement("stop",{offset:"0",stopOpacity:".3"}),Fe.createElement("stop",{offset:".071",stopOpacity:".2"}),Fe.createElement("stop",{offset:".321",stopOpacity:".1"}),Fe.createElement("stop",{offset:".623",stopOpacity:".05"}),Fe.createElement("stop",{offset:"1",stopOpacity:"0"})),Fe.createElement("path",{fill:"url(#k8yl7~hDat~FaoWq8WjN6b)",d:"M17.634,6c-0.783-0.003-1.476,0.504-1.712,1.25L5.005,39.595 c-0.335,0.934,0.151,1.964,1.085,2.299C6.286,41.964,6.493,42,6.702,42h9.026c0.684-0.122,1.25-0.603,1.481-1.259l2.177-6.416 l7.776,7.253c0.326,0.27,0.735,0.419,1.158,0.422h10.114l-4.436-12.676l-12.931,0.003L28.98,6H17.634z"}),Fe.createElement("linearGradient",{id:"k8yl7~hDat~FaoWq8WjN6c",x1:"-1252.952",x2:"-1244.704",y1:"876.6",y2:"898.575",gradientTransform:"translate(1981.75 -1362.063) scale(1.5625)",gradientUnits:"userSpaceOnUse"},Fe.createElement("stop",{offset:"0",stopColor:"#3ccbf4"}),Fe.createElement("stop",{offset:"1",stopColor:"#2892df"})),Fe.createElement("path",{fill:"url(#k8yl7~hDat~FaoWq8WjN6c)",d:"M32.074,7.225C31.827,6.493,31.141,6,30.368,6h-12.6c0.772,0,1.459,0.493,1.705,1.224 l10.935,32.399c0.318,0.942-0.188,1.963-1.13,2.281C29.093,41.968,28.899,42,28.703,42h12.6c0.994,0,1.8-0.806,1.8-1.801 c0-0.196-0.032-0.39-0.095-0.575L32.074,7.225z"})),tte=()=>Fe.createElement("svg",{className:Go(),width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Fe.createElement("path",{d:"M472.136 163.959H408.584C407.401 163.959 406.218 163.327 405.666 162.3L354.651 73.6591C354.02 72.632 352.916 72 351.654 72H143.492C142.309 72 141.126 72.632 140.574 73.6591L87.5084 165.618L36.414 254.259C35.862 255.286 35.862 256.55 36.414 257.656L87.5084 346.297L140.495 438.335C141.047 439.362 142.23 440.073 143.413 439.994H351.654C352.837 439.994 354.02 439.362 354.651 438.335L405.745 349.694C406.297 348.667 407.48 347.956 408.663 348.035H472.215C474.344 348.035 476 346.297 476 344.243V167.83C475.921 165.697 474.186 163.959 472.136 163.959ZM228.728 349.694L212.721 377.345C212.485 377.74 212.091 378.135 211.696 378.372C211.223 378.609 210.75 378.767 210.198 378.767H178.422C177.318 378.767 176.293 378.214 175.82 377.187L128.431 294.787L123.779 286.65L106.748 257.498C106.511 257.103 106.353 256.629 106.432 256.076C106.432 255.602 106.59 255.049 106.827 254.654L123.937 224.949L175.899 134.886C176.451 133.938 177.476 133.306 178.501 133.306H210.198C210.75 133.306 211.302 133.464 211.854 133.701C212.248 133.938 212.643 134.254 212.879 134.728L228.886 162.537C229.359 163.485 229.28 164.67 228.728 165.539L177.397 254.654C177.16 255.049 177.081 255.523 177.081 255.918C177.081 256.392 177.239 256.787 177.397 257.182L228.728 346.218C229.438 347.403 229.359 348.667 228.728 349.694V349.694ZM388.083 257.498L371.051 286.65L366.399 294.787L319.011 377.187C318.459 378.135 317.512 378.767 316.409 378.767H284.632C284.08 378.767 283.607 378.609 283.134 378.372C282.74 378.135 282.346 377.819 282.109 377.345L266.103 349.694C265.393 348.667 265.393 347.403 266.024 346.376L317.355 257.34C317.591 256.945 317.67 256.471 317.67 256.076C317.67 255.602 317.513 255.207 317.355 254.812L266.024 165.697C265.472 164.749 265.393 163.643 265.866 162.695L281.873 134.886C282.109 134.491 282.503 134.096 282.898 133.859C283.371 133.543 283.923 133.464 284.553 133.464H316.409C317.512 133.464 318.538 134.017 319.011 135.044L370.972 225.107L388.083 254.812C388.319 255.286 388.477 255.76 388.477 256.234C388.477 256.55 388.319 257.024 388.083 257.498V257.498Z",fill:"#008AAA"})),rte=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},Fe.createElement("path",{fill:"#0288D1",d:"M42,37c0,2.762-2.238,5-5,5H11c-2.761,0-5-2.238-5-5V11c0-2.762,2.239-5,5-5h26c2.762,0,5,2.238,5,5V37z"}),Fe.createElement("path",{fill:"#FFF",d:"M12 19H17V36H12zM14.485 17h-.028C12.965 17 12 15.888 12 14.499 12 13.08 12.995 12 14.514 12c1.521 0 2.458 1.08 2.486 2.499C17 15.887 16.035 17 14.485 17zM36 36h-5v-9.099c0-2.198-1.225-3.698-3.192-3.698-1.501 0-2.313 1.012-2.707 1.99C24.957 25.543 25 26.511 25 27v9h-5V19h5v2.616C25.721 20.5 26.85 19 29.738 19c3.578 0 6.261 2.25 6.261 7.274L36 36 36 36z"})),nte=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px",fillRule:"evenodd",clipRule:"evenodd"},Fe.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M11.553,11.099c1.232,1.001,1.694,0.925,4.008,0.77 l21.812-1.31c0.463,0,0.078-0.461-0.076-0.538l-3.622-2.619c-0.694-0.539-1.619-1.156-3.391-1.002l-21.12,1.54 c-0.77,0.076-0.924,0.461-0.617,0.77L11.553,11.099z",clipRule:"evenodd"}),Fe.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M12.862,16.182v22.95c0,1.233,0.616,1.695,2.004,1.619 l23.971-1.387c1.388-0.076,1.543-0.925,1.543-1.927V14.641c0-1-0.385-1.54-1.234-1.463l-25.05,1.463 C13.171,14.718,12.862,15.181,12.862,16.182L12.862,16.182z",clipRule:"evenodd"}),Fe.createElement("path",{fill:"#424242",fillRule:"evenodd",d:"M11.553,11.099c1.232,1.001,1.694,0.925,4.008,0.77 l21.812-1.31c0.463,0,0.078-0.461-0.076-0.538l-3.622-2.619c-0.694-0.539-1.619-1.156-3.391-1.002l-21.12,1.54 c-0.77,0.076-0.924,0.461-0.617,0.77L11.553,11.099z M12.862,16.182v22.95c0,1.233,0.616,1.695,2.004,1.619l23.971-1.387 c1.388-0.076,1.543-0.925,1.543-1.927V14.641c0-1-0.385-1.54-1.234-1.463l-25.05,1.463C13.171,14.718,12.862,15.181,12.862,16.182 L12.862,16.182z M36.526,17.413c0.154,0.694,0,1.387-0.695,1.465l-1.155,0.23v16.943c-1.003,0.539-1.928,0.847-2.698,0.847 c-1.234,0-1.543-0.385-2.467-1.54l-7.555-11.86v11.475l2.391,0.539c0,0,0,1.386-1.929,1.386l-5.317,0.308 c-0.154-0.308,0-1.078,0.539-1.232l1.388-0.385V20.418l-1.927-0.154c-0.155-0.694,0.23-1.694,1.31-1.772l5.704-0.385l7.862,12.015 V19.493l-2.005-0.23c-0.154-0.848,0.462-1.464,1.233-1.54L36.526,17.413z M7.389,5.862l21.968-1.618 c2.698-0.231,3.392-0.076,5.087,1.155l7.013,4.929C42.614,11.176,43,11.407,43,12.33v27.032c0,1.694-0.617,2.696-2.775,2.849 l-25.512,1.541c-1.62,0.077-2.391-0.154-3.239-1.232l-5.164-6.7C5.385,34.587,5,33.664,5,32.585V8.556 C5,7.171,5.617,6.015,7.389,5.862z",clipRule:"evenodd"})),ite=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},Fe.createElement("path",{fill:"#33d375",d:"M33,8c0-2.209-1.791-4-4-4s-4,1.791-4,4c0,1.254,0,9.741,0,11c0,2.209,1.791,4,4,4s4-1.791,4-4	C33,17.741,33,9.254,33,8z"}),Fe.createElement("path",{fill:"#33d375",d:"M43,19c0,2.209-1.791,4-4,4c-1.195,0-4,0-4,0s0-2.986,0-4c0-2.209,1.791-4,4-4S43,16.791,43,19z"}),Fe.createElement("path",{fill:"#40c4ff",d:"M8,14c-2.209,0-4,1.791-4,4s1.791,4,4,4c1.254,0,9.741,0,11,0c2.209,0,4-1.791,4-4s-1.791-4-4-4	C17.741,14,9.254,14,8,14z"}),Fe.createElement("path",{fill:"#40c4ff",d:"M19,4c2.209,0,4,1.791,4,4c0,1.195,0,4,0,4s-2.986,0-4,0c-2.209,0-4-1.791-4-4S16.791,4,19,4z"}),Fe.createElement("path",{fill:"#e91e63",d:"M14,39.006C14,41.212,15.791,43,18,43s4-1.788,4-3.994c0-1.252,0-9.727,0-10.984	c0-2.206-1.791-3.994-4-3.994s-4,1.788-4,3.994C14,29.279,14,37.754,14,39.006z"}),Fe.createElement("path",{fill:"#e91e63",d:"M4,28.022c0-2.206,1.791-3.994,4-3.994c1.195,0,4,0,4,0s0,2.981,0,3.994c0,2.206-1.791,3.994-4,3.994	S4,30.228,4,28.022z"}),Fe.createElement("path",{fill:"#ffc107",d:"M39,33c2.209,0,4-1.791,4-4s-1.791-4-4-4c-1.254,0-9.741,0-11,0c-2.209,0-4,1.791-4,4s1.791,4,4,4	C29.258,33,37.746,33,39,33z"}),Fe.createElement("path",{fill:"#ffc107",d:"M28,43c-2.209,0-4-1.791-4-4c0-1.195,0-4,0-4s2.986,0,4,0c2.209,0,4,1.791,4,4S30.209,43,28,43z"})),ote=()=>Fe.createElement("svg",{className:Go(),width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Fe.createElement("path",{d:"M255.498 31.0034C131.513 31.0034 31 131.515 31 255.502C31 379.492 131.513 480 255.498 480C379.497 480 480 379.495 480 255.502C480 131.522 379.497 31.0135 255.495 31.0135L255.498 31V31.0034ZM358.453 354.798C354.432 361.391 345.801 363.486 339.204 359.435C286.496 327.237 220.139 319.947 141.993 337.801C134.463 339.516 126.957 334.798 125.24 327.264C123.516 319.731 128.217 312.225 135.767 310.511C221.284 290.972 294.639 299.384 353.816 335.549C360.413 339.596 362.504 348.2 358.453 354.798ZM385.932 293.67C380.864 301.903 370.088 304.503 361.858 299.438C301.512 262.345 209.528 251.602 138.151 273.272C128.893 276.067 119.118 270.851 116.309 261.61C113.521 252.353 118.74 242.597 127.981 239.782C209.512 215.044 310.87 227.026 380.17 269.612C388.4 274.68 391 285.456 385.935 293.676V293.673L385.932 293.67ZM388.293 230.016C315.935 187.039 196.56 183.089 127.479 204.055C116.387 207.42 104.654 201.159 101.293 190.063C97.9326 178.964 104.189 167.241 115.289 163.87C194.59 139.796 326.418 144.446 409.723 193.902C419.722 199.826 422.995 212.71 417.068 222.675C411.168 232.653 398.247 235.943 388.303 230.016H388.293V230.016Z",fill:"#1ED760"})),ste=()=>Fe.createElement("svg",{className:Go(),width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Fe.createElement("path",{d:"M416 240L352 304H288L232 360V304H160V64H416V240Z",fill:"white"}),Fe.createElement("path",{d:"M144 32L64 112V400H160V480L240 400H304L448 256V32H144ZM416 240L352 304H288L232 360V304H160V64H416V240Z",fill:"#9146FF"}),Fe.createElement("path",{d:"M368 120H336V216H368V120Z",fill:"#9146FF"}),Fe.createElement("path",{d:"M280 120H248V216H280V120Z",fill:"#9146FF"})),ate=()=>Fe.createElement("svg",{className:Go(),width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Fe.createElement("path",{d:"M33 256.043C33 264.556 35.3159 273.069 39.4845 280.202L117.993 415.493C126.098 429.298 138.373 440.572 153.657 445.634C183.764 455.528 214.797 442.873 229.618 417.333L248.609 384.661L173.806 256.043L252.777 119.831L271.768 87.1591C277.557 77.2654 284.968 69.4424 294 63H285.894H172.185C150.878 63 131.193 74.2742 120.54 92.6812L39.7161 231.884C35.3159 239.016 33 247.53 33 256.043Z",fill:"#6363F1"}),Fe.createElement("path",{d:"M480 256.058C480 247.539 477.684 239.021 473.516 231.883L393.849 94.6596C379.028 69.3331 347.995 56.4396 317.888 66.34C302.603 71.4053 290.329 82.6871 282.224 96.5015L264.391 127.354L339.194 256.058L260.223 392.131L241.232 424.825C235.443 434.495 228.032 442.553 219 449H227.106H340.815C362.122 449 381.807 437.718 392.46 419.299L473.284 280.003C477.684 272.866 480 264.577 480 256.058Z",fill:"#6363F1"})),lte=()=>Fe.createElement("svg",{className:Go(),xmlns:"http://www.w3.org/2000/svg",width:"2500",height:"2500",viewBox:"0 0 256 256"},Fe.createElement("path",{fill:"#FFE812",d:"M256 236c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20V20C0 8.954 8.954 0 20 0h216c11.046 0 20 8.954 20 20v216z"}),Fe.createElement("path",{d:"M128 36C70.562 36 24 72.713 24 118c0 29.279 19.466 54.97 48.748 69.477-1.593 5.494-10.237 35.344-10.581 37.689 0 0-.207 1.762.934 2.434s2.483.15 2.483.15c3.272-.457 37.943-24.811 43.944-29.04 5.995.849 12.168 1.29 18.472 1.29 57.438 0 104-36.712 104-82 0-45.287-46.562-82-104-82z"}),Fe.createElement("path",{fill:"#FFE812",d:"M70.5 146.625c-3.309 0-6-2.57-6-5.73V105.25h-9.362c-3.247 0-5.888-2.636-5.888-5.875s2.642-5.875 5.888-5.875h30.724c3.247 0 5.888 2.636 5.888 5.875s-2.642 5.875-5.888 5.875H76.5v35.645c0 3.16-2.691 5.73-6 5.73zM123.112 146.547c-2.502 0-4.416-1.016-4.993-2.65l-2.971-7.778-18.296-.001-2.973 7.783c-.575 1.631-2.488 2.646-4.99 2.646a9.155 9.155 0 0 1-3.814-.828c-1.654-.763-3.244-2.861-1.422-8.52l14.352-37.776c1.011-2.873 4.082-5.833 7.99-5.922 3.919.088 6.99 3.049 8.003 5.928l14.346 37.759c1.826 5.672.236 7.771-1.418 8.532a9.176 9.176 0 0 1-3.814.827c-.001 0 0 0 0 0zm-11.119-21.056L106 108.466l-5.993 17.025h11.986zM138 145.75c-3.171 0-5.75-2.468-5.75-5.5V99.5c0-3.309 2.748-6 6.125-6s6.125 2.691 6.125 6v35.25h12.75c3.171 0 5.75 2.468 5.75 5.5s-2.579 5.5-5.75 5.5H138zM171.334 146.547c-3.309 0-6-2.691-6-6V99.5c0-3.309 2.691-6 6-6s6 2.691 6 6v12.896l16.74-16.74c.861-.861 2.044-1.335 3.328-1.335 1.498 0 3.002.646 4.129 1.772 1.051 1.05 1.678 2.401 1.764 3.804.087 1.415-.384 2.712-1.324 3.653l-13.673 13.671 14.769 19.566a5.951 5.951 0 0 1 1.152 4.445 5.956 5.956 0 0 1-2.328 3.957 5.94 5.94 0 0 1-3.609 1.211 5.953 5.953 0 0 1-4.793-2.385l-14.071-18.644-2.082 2.082v13.091a6.01 6.01 0 0 1-6.002 6.003z"}));function cte({supabaseClient:e,socialLayout:t="vertical",providers:i=["github","google","azure"],providerScopes:a,queryParams:d,redirectTo:_,onlyThirdPartyProviders:b=!0,view:o="sign_in",i18n:k,appearance:O}){const[z,F]=Y.useState(!1),[G,ee]=Y.useState(""),J=t==="vertical",te=o==="magic_link"?"sign_in":o,oe=async Q=>{F(!0);const{error:ue}=await e.auth.signInWithOAuth({provider:Q,options:{redirectTo:_,scopes:a==null?void 0:a[Q],queryParams:d}});ue&&ee(ue.message),F(!1)};function X(Q){const ue=Q.toLowerCase();return Q.charAt(0).toUpperCase()+ue.slice(1)}return Fe.createElement(Fe.Fragment,null,i&&i.length>0&&Fe.createElement(Fe.Fragment,null,Fe.createElement(nc,{gap:"large",direction:"vertical",appearance:O},Fe.createElement(nc,{direction:J?"vertical":"horizontal",gap:J?"small":"medium",appearance:O},i.map(Q=>{var ue;return Fe.createElement(Rg,{key:Q,color:"default",loading:z,onClick:()=>oe(Q),appearance:O},Fe.createElement(Hee,{provider:Q}),J&&Oee((ue=k==null?void 0:k[te])==null?void 0:ue.social_provider_text,{provider:X(Q)}))}))),!b&&Fe.createElement(Uee,{appearance:O})))}function _4({authView:e="sign_in",defaultEmail:t="",defaultPassword:i="",setAuthView:a=()=>{},setDefaultEmail:d=J=>{},setDefaultPassword:_=J=>{},supabaseClient:b,showLinks:o=!1,redirectTo:k,additionalData:O,magicLink:z,i18n:F,appearance:G,children:ee}){var J,te,oe,X;const Q=Y.useRef(!0),[ue,he]=Y.useState(t),[Ie,Je]=Y.useState(i),[Ce,Ze]=Y.useState(""),[et,Ge]=Y.useState(!1),[qe,_t]=Y.useState("");Y.useEffect(()=>(Q.current=!0,he(t),Je(i),()=>{Q.current=!1}),[e]);const Rt=async jt=>{var Ct;switch(jt.preventDefault(),Ze(""),Ge(!0),e){case"sign_in":const{error:st}=await b.auth.signInWithPassword({email:ue,password:Ie});st&&Ze(st.message);break;case"sign_up":let yt={emailRedirectTo:k};O&&(yt.data=O);const{data:{user:ir,session:yr},error:Wr}=await b.auth.signUp({email:ue,password:Ie,options:yt});Wr?Ze(Wr.message):ir&&!yr&&_t((Ct=F==null?void 0:F.sign_up)==null?void 0:Ct.confirmation_text);break}Q.current&&Ge(!1)},Wt=jt=>{d(ue),_(Ie),a(jt)},wt=F==null?void 0:F[e];return Fe.createElement("form",{id:e==="sign_in"?"auth-sign-in":"auth-sign-up",onSubmit:Rt,autoComplete:"on",style:{width:"100%"}},Fe.createElement(nc,{direction:"vertical",gap:"large",appearance:G},Fe.createElement(nc,{direction:"vertical",gap:"large",appearance:G},Fe.createElement("div",null,Fe.createElement(zd,{htmlFor:"email",appearance:G},wt==null?void 0:wt.email_label),Fe.createElement(Od,{id:"email",type:"email",name:"email",placeholder:wt==null?void 0:wt.email_input_placeholder,defaultValue:ue,onChange:jt=>he(jt.target.value),autoComplete:"email",appearance:G})),Fe.createElement("div",null,Fe.createElement(zd,{htmlFor:"password",appearance:G},wt==null?void 0:wt.password_label),Fe.createElement(Od,{id:"password",type:"password",name:"password",placeholder:wt==null?void 0:wt.password_input_placeholder,defaultValue:Ie,onChange:jt=>Je(jt.target.value),autoComplete:e==="sign_in"?"current-password":"new-password",appearance:G})),ee),Fe.createElement(Rg,{type:"submit",color:"primary",loading:et,appearance:G},et?wt==null?void 0:wt.loading_button_label:wt==null?void 0:wt.button_label),o&&Fe.createElement(nc,{direction:"vertical",gap:"small",appearance:G},e===Ji.SIGN_IN&&z&&Fe.createElement(Kh,{href:"#auth-magic-link",onClick:jt=>{jt.preventDefault(),a(Ji.MAGIC_LINK)},appearance:G},(J=F==null?void 0:F.magic_link)==null?void 0:J.link_text),e===Ji.SIGN_IN&&Fe.createElement(Kh,{href:"#auth-forgot-password",onClick:jt=>{jt.preventDefault(),a(Ji.FORGOTTEN_PASSWORD)},appearance:G},(te=F==null?void 0:F.forgotten_password)==null?void 0:te.link_text),e===Ji.SIGN_IN?Fe.createElement(Kh,{href:"#auth-sign-up",onClick:jt=>{jt.preventDefault(),Wt(Ji.SIGN_UP)},appearance:G},(oe=F==null?void 0:F.sign_up)==null?void 0:oe.link_text):Fe.createElement(Kh,{href:"#auth-sign-in",onClick:jt=>{jt.preventDefault(),Wt(Ji.SIGN_IN)},appearance:G},(X=F==null?void 0:F.sign_in)==null?void 0:X.link_text))),qe&&Fe.createElement(sc,{appearance:G},qe),Ce&&Fe.createElement(sc,{color:"danger",appearance:G},Ce))}function YF({setAuthView:e=()=>{},supabaseClient:t,redirectTo:i,i18n:a,appearance:d,showLinks:_=!1}){var b;const[o,k]=Y.useState(""),[O,z]=Y.useState(""),[F,G]=Y.useState(""),[ee,J]=Y.useState(!1),te=async X=>{var Q;X.preventDefault(),z(""),G(""),J(!0);const{error:ue}=await t.auth.resetPasswordForEmail(o,{redirectTo:i});ue?z(ue.message):G((Q=a==null?void 0:a.forgotten_password)==null?void 0:Q.confirmation_text),J(!1)},oe=a==null?void 0:a.forgotten_password;return Fe.createElement("form",{id:"auth-forgot-password",onSubmit:te},Fe.createElement(nc,{direction:"vertical",gap:"large",appearance:d},Fe.createElement(nc,{gap:"large",direction:"vertical",appearance:d},Fe.createElement("div",null,Fe.createElement(zd,{htmlFor:"email",appearance:d},oe==null?void 0:oe.email_label),Fe.createElement(Od,{id:"email",name:"email",type:"email",autoFocus:!0,placeholder:oe==null?void 0:oe.email_input_placeholder,onChange:X=>k(X.target.value),appearance:d})),Fe.createElement(Rg,{type:"submit",color:"primary",loading:ee,appearance:d},ee?oe==null?void 0:oe.loading_button_label:oe==null?void 0:oe.button_label),_&&Fe.createElement(Kh,{href:"#auth-sign-in",onClick:X=>{X.preventDefault(),e(Ji.SIGN_IN)},appearance:d},(b=a==null?void 0:a.sign_in)==null?void 0:b.link_text),F&&Fe.createElement(sc,{appearance:d},F),O&&Fe.createElement(sc,{color:"danger",appearance:d},O))))}function XF({supabaseClient:e,i18n:t,appearance:i}){const[a,d]=Y.useState(""),[_,b]=Y.useState(""),[o,k]=Y.useState(""),[O,z]=Y.useState(!1),F=async ee=>{var J;ee.preventDefault(),b(""),k(""),z(!0);const{error:te}=await e.auth.updateUser({password:a});te?b(te.message):k((J=t==null?void 0:t.update_password)==null?void 0:J.confirmation_text),z(!1)},G=t==null?void 0:t.update_password;return Fe.createElement("form",{id:"auth-update-password",onSubmit:F},Fe.createElement(nc,{gap:"large",direction:"vertical",appearance:i},Fe.createElement("div",null,Fe.createElement(zd,{htmlFor:"password",appearance:i},G==null?void 0:G.password_label),Fe.createElement(Od,{id:"password",name:"password",placeholder:G==null?void 0:G.password_input_placeholder,type:"password",autoFocus:!0,onChange:ee=>d(ee.target.value),appearance:i})),Fe.createElement(Rg,{type:"submit",color:"primary",loading:O,appearance:i},O?G==null?void 0:G.loading_button_label:G==null?void 0:G.button_label),o&&Fe.createElement(sc,{appearance:i},o),_&&Fe.createElement(sc,{color:"danger",appearance:i},_)))}function ute({setAuthView:e=()=>{},supabaseClient:t,otpType:i="email",i18n:a,appearance:d,showLinks:_=!1}){var b;const[o,k]=Y.useState(""),[O,z]=Y.useState(""),[F,G]=Y.useState(""),[ee,J]=Y.useState(""),[te,oe]=Y.useState(""),[X,Q]=Y.useState(!1),ue=async Ie=>{Ie.preventDefault(),J(""),oe(""),Q(!0);let Je={email:o,token:F,type:i};["sms","phone_change"].includes(i)&&(Je={phone:O,token:F,type:i});const{error:Ce}=await t.auth.verifyOtp(Je);Ce&&J(Ce.message),Q(!1)},he=a==null?void 0:a.verify_otp;return Fe.createElement("form",{id:"auth-magic-link",onSubmit:ue},Fe.createElement(nc,{gap:"large",direction:"vertical",appearance:d},["sms","phone_change"].includes(i)?Fe.createElement("div",null,Fe.createElement(zd,{htmlFor:"phone",appearance:d},he==null?void 0:he.phone_input_label),Fe.createElement(Od,{id:"phone",name:"phone",type:"text",autoFocus:!0,placeholder:he==null?void 0:he.phone_input_placeholder,onChange:Ie=>z(Ie.target.value),appearance:d})):Fe.createElement("div",null,Fe.createElement(zd,{htmlFor:"email",appearance:d},he==null?void 0:he.email_input_label),Fe.createElement(Od,{id:"email",name:"email",type:"email",autoFocus:!0,placeholder:he==null?void 0:he.email_input_placeholder,onChange:Ie=>k(Ie.target.value),appearance:d})),Fe.createElement("div",null,Fe.createElement(zd,{htmlFor:"token",appearance:d},he==null?void 0:he.token_input_label),Fe.createElement(Od,{id:"token",name:"token",type:"text",placeholder:he==null?void 0:he.token_input_placeholder,onChange:Ie=>G(Ie.target.value),appearance:d})),Fe.createElement(Rg,{color:"primary",type:"submit",loading:X,appearance:d},X?he==null?void 0:he.loading_button_label:he==null?void 0:he.button_label),_&&Fe.createElement(Kh,{href:"#auth-sign-in",onClick:Ie=>{Ie.preventDefault(),e(Ji.SIGN_IN)},appearance:d},(b=a==null?void 0:a.sign_in)==null?void 0:b.link_text),te&&Fe.createElement(sc,{appearance:d},te),ee&&Fe.createElement(sc,{color:"danger",appearance:d},ee)))}const KF=Y.createContext({user:null,session:null}),dte=e=>{const{supabaseClient:t}=e,[i,a]=Y.useState(null),[d,_]=Y.useState((i==null?void 0:i.user)??null);Y.useEffect(()=>{(async()=>{var k;const{data:O}=await t.auth.getSession();a(O.session),_(((k=O.session)==null?void 0:k.user)??null)})();const{data:o}=t.auth.onAuthStateChange(async(k,O)=>{a(O),_((O==null?void 0:O.user)??null)});return()=>{o==null||o.subscription.unsubscribe()}},[]);const b={session:i,user:d};return Fe.createElement(KF.Provider,{value:b,...e})},hte=()=>{const e=Y.useContext(KF);if(e===void 0)throw new Error("useUser must be used within a UserContextProvider.");return e};function Dg({supabaseClient:e,socialLayout:t="vertical",providers:i,providerScopes:a,queryParams:d,view:_="sign_in",redirectTo:b,onlyThirdPartyProviders:o=!1,magicLink:k=!1,showLinks:O=!0,appearance:z,theme:F="default",localization:G={variables:{}},otpType:ee="email",additionalData:J,children:te}){const oe=JT(zee,G.variables??{}),[X,Q]=Y.useState(_),[ue,he]=Y.useState(""),[Ie,Je]=Y.useState(""),Ce=X==="sign_in"||X==="sign_up"||X==="magic_link";Y.useEffect(()=>{var Ge,qe;qF({theme:JT(((Ge=z==null?void 0:z.theme)==null?void 0:Ge.default)??{},((qe=z==null?void 0:z.variables)==null?void 0:qe.default)??{})})},[z]);const Ze=({children:Ge})=>{var qe;return Fe.createElement("div",{className:F!=="default"?kee(JT(z==null?void 0:z.theme[F],((qe=z==null?void 0:z.variables)==null?void 0:qe[F])??{})):""},Ce&&Fe.createElement(cte,{appearance:z,supabaseClient:e,providers:i,providerScopes:a,queryParams:d,socialLayout:t,redirectTo:b,onlyThirdPartyProviders:o,i18n:oe,view:X}),!o&&Ge)};Y.useEffect(()=>{const{data:Ge}=e.auth.onAuthStateChange(qe=>{qe==="PASSWORD_RECOVERY"?Q("update_password"):qe==="USER_UPDATED"&&Q("sign_in")});return Q(_),()=>Ge.subscription.unsubscribe()},[_]);const et={supabaseClient:e,setAuthView:Q,defaultEmail:ue,defaultPassword:Ie,setDefaultEmail:he,setDefaultPassword:Je,redirectTo:b,magicLink:k,showLinks:O,i18n:oe,appearance:z};switch(X){case Ji.SIGN_IN:return Fe.createElement(Ze,null,Fe.createElement(_4,{...et,authView:"sign_in"}));case Ji.SIGN_UP:return Fe.createElement(Ze,null,Fe.createElement(_4,{appearance:z,supabaseClient:e,authView:"sign_up",setAuthView:Q,defaultEmail:ue,defaultPassword:Ie,setDefaultEmail:he,setDefaultPassword:Je,redirectTo:b,magicLink:k,showLinks:O,i18n:oe,additionalData:J,children:te}));case Ji.FORGOTTEN_PASSWORD:return Fe.createElement(Ze,null,Fe.createElement(YF,{appearance:z,supabaseClient:e,setAuthView:Q,redirectTo:b,showLinks:O,i18n:oe}));case Ji.MAGIC_LINK:return Fe.createElement(Ze,null,Fe.createElement(ZF,{appearance:z,supabaseClient:e,setAuthView:Q,redirectTo:b,showLinks:O,i18n:oe}));case Ji.UPDATE_PASSWORD:return Fe.createElement(XF,{appearance:z,supabaseClient:e,i18n:oe});case Ji.VERIFY_OTP:return Fe.createElement(ute,{appearance:z,supabaseClient:e,otpType:ee,i18n:oe});default:return null}}Dg.ForgottenPassword=YF;Dg.UpdatePassword=XF;Dg.MagicLink=ZF;Dg.UserContextProvider=dte;Dg.useUser=hte;au({borderRadius:"12px",boxShadow:"rgba(100, 100, 111, 0.2) 0px 7px 29px 0px",width:"360px",padding:"28px 32px"});const fte=()=>{const e=$o(),t=qd();Y.useEffect(()=>{console.log("Login: Checking session"),i();const{data:{subscription:a}}=Qt.auth.onAuthStateChange((d,_)=>{var b,o;if(console.log("Auth state changed:",d),d==="SIGNED_IN"&&_){console.log("User signed in, redirecting to home");const k=((o=(b=t.state)==null?void 0:b.from)==null?void 0:o.pathname)||"/";e(k)}});return()=>{a.unsubscribe()}},[e,t]);const i=async()=>{var d,_;const{data:{session:a}}=await Qt.auth.getSession();if(a){console.log("Active session found, redirecting to home");const b=((_=(d=t.state)==null?void 0:d.from)==null?void 0:_.pathname)||"/";e(b)}};return L.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:L.jsxs("div",{className:"max-w-md w-full space-y-8",children:[L.jsxs("div",{children:[L.jsx("img",{src:"/lovable-uploads/5f01f258-2bf0-42c9-a69a-83350aa11d7f.png",alt:"Mobirides Logo",className:"mx-auto h-48 w-48"}),L.jsxs("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:["Welcome to ",L.jsx("span",{className:"text-[#7C3AED]",children:"Mobirides"})]}),L.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to start sharing or renting cars"})]}),L.jsx("div",{className:"mt-8",children:L.jsx(Dg,{supabaseClient:Qt,appearance:{theme:Ree,variables:{default:{colors:{brand:"#7C3AED",brandAccent:"#6D28D9"}}}},theme:"light",providers:[]})})]})})},pte=({avatarUrl:e,setAvatarUrl:t})=>{const[i,a]=Y.useState(!1),{toast:d}=Tl(),_=async o=>{try{if(a(!0),!o.target.files||o.target.files.length===0)throw new Error("You must select an image to upload.");const k=o.target.files[0],O=k.name.split(".").pop(),z=`${Math.random()}.${O}`,{data:{session:F}}=await Qt.auth.getSession();if(!(F!=null&&F.user))throw new Error("No authenticated user found");console.log("Uploading avatar...");const{error:G}=await Qt.storage.from("avatars").upload(z,k);if(G)throw G;console.log("Avatar uploaded, updating profile...");const{error:ee}=await Qt.from("profiles").update({avatar_url:z}).eq("id",F.user.id);if(ee)throw ee;t(z),console.log("Avatar update complete"),d({title:"Success",description:"Avatar uploaded successfully"})}catch(k){console.error("Error uploading avatar:",k),d({title:"Error",description:k.message||"Failed to upload avatar",variant:"destructive"})}finally{a(!1)}},b=e?Qt.storage.from("avatars").getPublicUrl(e).data.publicUrl:null;return L.jsxs("div",{className:"mb-8",children:[L.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Avatar"}),L.jsxs("div",{className:"flex items-center gap-4",children:[L.jsxs(R0,{className:"h-16 w-16",children:[L.jsx($w,{src:b||void 0,alt:"Profile Avatar"}),L.jsx(D0,{children:""})]}),L.jsxs(on,{variant:"outline",disabled:i,className:"relative",children:[L.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:i}),L.jsx(rH,{className:"w-4 h-4 mr-2"}),i?"Uploading...":"Upload Avatar"]})]})]})};var uv=e=>e.type==="checkbox",Jh=e=>e instanceof Date,_s=e=>e==null;const JF=e=>typeof e=="object";var eo=e=>!_s(e)&&!Array.isArray(e)&&JF(e)&&!Jh(e),QF=e=>eo(e)&&e.target?uv(e.target)?e.target.checked:e.target.value:e,mte=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,ej=(e,t)=>e.has(mte(t)),gte=e=>{const t=e.constructor&&e.constructor.prototype;return eo(t)&&t.hasOwnProperty("isPrototypeOf")},eP=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Rs(e){let t;const i=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(eP&&(e instanceof Blob||e instanceof FileList))&&(i||eo(e)))if(t=i?[]:{},!i&&!gte(e))t=e;else for(const a in e)e.hasOwnProperty(a)&&(t[a]=Rs(e[a]));else return e;return t}var Gw=e=>Array.isArray(e)?e.filter(Boolean):[],Wi=e=>e===void 0,dr=(e,t,i)=>{if(!t||!eo(e))return i;const a=Gw(t.split(/[,[\].]+?/)).reduce((d,_)=>_s(d)?d:d[_],e);return Wi(a)||a===e?Wi(e[t])?i:e[t]:a},Ta=e=>typeof e=="boolean",tP=e=>/^\w*$/.test(e),tj=e=>Gw(e.replace(/["|']|\]/g,"").split(/\.|\[/)),hi=(e,t,i)=>{let a=-1;const d=tP(t)?[t]:tj(t),_=d.length,b=_-1;for(;++a<_;){const o=d[a];let k=i;if(a!==b){const O=e[o];k=eo(O)||Array.isArray(O)?O:isNaN(+d[a+1])?{}:[]}if(o==="__proto__")return;e[o]=k,e=e[o]}return e};const Zb={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},fl={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},zc={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},rj=Fe.createContext(null),Hw=()=>Fe.useContext(rj),_te=e=>{const{children:t,...i}=e;return Fe.createElement(rj.Provider,{value:i},t)};var nj=(e,t,i,a=!0)=>{const d={defaultValues:t._defaultValues};for(const _ in e)Object.defineProperty(d,_,{get:()=>{const b=_;return t._proxyFormState[b]!==fl.all&&(t._proxyFormState[b]=!a||fl.all),i&&(i[b]=!0),e[b]}});return d},Os=e=>eo(e)&&!Object.keys(e).length,ij=(e,t,i,a)=>{i(e);const{name:d,..._}=e;return Os(_)||Object.keys(_).length>=Object.keys(t).length||Object.keys(_).find(b=>t[b]===(!a||fl.all))},r0=e=>Array.isArray(e)?e:[e],oj=(e,t,i)=>!e||!t||e===t||r0(e).some(a=>a&&(i?a===t:a.startsWith(t)||t.startsWith(a)));function rP(e){const t=Fe.useRef(e);t.current=e,Fe.useEffect(()=>{const i=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{i&&i.unsubscribe()}},[e.disabled])}function yte(e){const t=Hw(),{control:i=t.control,disabled:a,name:d,exact:_}=e||{},[b,o]=Fe.useState(i._formState),k=Fe.useRef(!0),O=Fe.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),z=Fe.useRef(d);return z.current=d,rP({disabled:a,next:F=>k.current&&oj(z.current,F.name,_)&&ij(F,O.current,i._updateFormState)&&o({...i._formState,...F}),subject:i._subjects.state}),Fe.useEffect(()=>(k.current=!0,O.current.isValid&&i._updateValid(!0),()=>{k.current=!1}),[i]),nj(b,i,O.current,!1)}var ec=e=>typeof e=="string",sj=(e,t,i,a,d)=>ec(e)?(a&&t.watch.add(e),dr(i,e,d)):Array.isArray(e)?e.map(_=>(a&&t.watch.add(_),dr(i,_))):(a&&(t.watchAll=!0),i);function vte(e){const t=Hw(),{control:i=t.control,name:a,defaultValue:d,disabled:_,exact:b}=e||{},o=Fe.useRef(a);o.current=a,rP({disabled:_,subject:i._subjects.values,next:z=>{oj(o.current,z.name,b)&&O(Rs(sj(o.current,i._names,z.values||i._formValues,!1,d)))}});const[k,O]=Fe.useState(i._getWatch(a,d));return Fe.useEffect(()=>i._removeUnmounted()),k}function xte(e){const t=Hw(),{name:i,disabled:a,control:d=t.control,shouldUnregister:_}=e,b=ej(d._names.array,i),o=vte({control:d,name:i,defaultValue:dr(d._formValues,i,dr(d._defaultValues,i,e.defaultValue)),exact:!0}),k=yte({control:d,name:i,exact:!0}),O=Fe.useRef(d.register(i,{...e.rules,value:o,...Ta(e.disabled)?{disabled:e.disabled}:{}}));return Fe.useEffect(()=>{const z=d._options.shouldUnregister||_,F=(G,ee)=>{const J=dr(d._fields,G);J&&J._f&&(J._f.mount=ee)};if(F(i,!0),z){const G=Rs(dr(d._options.defaultValues,i));hi(d._defaultValues,i,G),Wi(dr(d._formValues,i))&&hi(d._formValues,i,G)}return()=>{(b?z&&!d._state.action:z)?d.unregister(i):F(i,!1)}},[i,d,b,_]),Fe.useEffect(()=>{dr(d._fields,i)&&d._updateDisabledField({disabled:a,fields:d._fields,name:i,value:dr(d._fields,i)._f.value})},[a,i,d]),{field:{name:i,value:o,...Ta(a)||k.disabled?{disabled:k.disabled||a}:{},onChange:Fe.useCallback(z=>O.current.onChange({target:{value:QF(z),name:i},type:Zb.CHANGE}),[i]),onBlur:Fe.useCallback(()=>O.current.onBlur({target:{value:dr(d._formValues,i),name:i},type:Zb.BLUR}),[i,d]),ref:Fe.useCallback(z=>{const F=dr(d._fields,i);F&&z&&(F._f.ref={focus:()=>z.focus(),select:()=>z.select(),setCustomValidity:G=>z.setCustomValidity(G),reportValidity:()=>z.reportValidity()})},[d._fields,i])},formState:k,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!dr(k.errors,i)},isDirty:{enumerable:!0,get:()=>!!dr(k.dirtyFields,i)},isTouched:{enumerable:!0,get:()=>!!dr(k.touchedFields,i)},isValidating:{enumerable:!0,get:()=>!!dr(k.validatingFields,i)},error:{enumerable:!0,get:()=>dr(k.errors,i)}})}}const bte=e=>e.render(xte(e));var wte=(e,t,i,a,d)=>t?{...i[e],types:{...i[e]&&i[e].types?i[e].types:{},[a]:d||!0}}:{},y4=e=>({isOnSubmit:!e||e===fl.onSubmit,isOnBlur:e===fl.onBlur,isOnChange:e===fl.onChange,isOnAll:e===fl.all,isOnTouch:e===fl.onTouched}),v4=(e,t,i)=>!i&&(t.watchAll||t.watch.has(e)||[...t.watch].some(a=>e.startsWith(a)&&/^\.\w+/.test(e.slice(a.length))));const n0=(e,t,i,a)=>{for(const d of i||Object.keys(e)){const _=dr(e,d);if(_){const{_f:b,...o}=_;if(b){if(b.refs&&b.refs[0]&&t(b.refs[0],d)&&!a)return!0;if(b.ref&&t(b.ref,b.name)&&!a)return!0;if(n0(o,t))break}else if(eo(o)&&n0(o,t))break}}};var Ste=(e,t,i)=>{const a=r0(dr(e,i));return hi(a,"root",t[i]),hi(e,i,a),e},nP=e=>e.type==="file",Hc=e=>typeof e=="function",Yb=e=>{if(!eP)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},sb=e=>ec(e),iP=e=>e.type==="radio",Xb=e=>e instanceof RegExp;const x4={value:!1,isValid:!1},b4={value:!0,isValid:!0};var aj=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Wi(e[0].attributes.value)?Wi(e[0].value)||e[0].value===""?b4:{value:e[0].value,isValid:!0}:b4:x4}return x4};const w4={isValid:!1,value:null};var lj=e=>Array.isArray(e)?e.reduce((t,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:t,w4):w4;function S4(e,t,i="validate"){if(sb(e)||Array.isArray(e)&&e.every(sb)||Ta(e)&&!e)return{type:i,message:sb(e)?e:"",ref:t}}var pm=e=>eo(e)&&!Xb(e)?e:{value:e,message:""},T4=async(e,t,i,a,d)=>{const{ref:_,refs:b,required:o,maxLength:k,minLength:O,min:z,max:F,pattern:G,validate:ee,name:J,valueAsNumber:te,mount:oe,disabled:X}=e._f,Q=dr(t,J);if(!oe||X)return{};const ue=b?b[0]:_,he=_t=>{a&&ue.reportValidity&&(ue.setCustomValidity(Ta(_t)?"":_t||""),ue.reportValidity())},Ie={},Je=iP(_),Ce=uv(_),Ze=Je||Ce,et=(te||nP(_))&&Wi(_.value)&&Wi(Q)||Yb(_)&&_.value===""||Q===""||Array.isArray(Q)&&!Q.length,Ge=wte.bind(null,J,i,Ie),qe=(_t,Rt,Wt,wt=zc.maxLength,jt=zc.minLength)=>{const Ct=_t?Rt:Wt;Ie[J]={type:_t?wt:jt,message:Ct,ref:_,...Ge(_t?wt:jt,Ct)}};if(d?!Array.isArray(Q)||!Q.length:o&&(!Ze&&(et||_s(Q))||Ta(Q)&&!Q||Ce&&!aj(b).isValid||Je&&!lj(b).isValid)){const{value:_t,message:Rt}=sb(o)?{value:!!o,message:o}:pm(o);if(_t&&(Ie[J]={type:zc.required,message:Rt,ref:ue,...Ge(zc.required,Rt)},!i))return he(Rt),Ie}if(!et&&(!_s(z)||!_s(F))){let _t,Rt;const Wt=pm(F),wt=pm(z);if(!_s(Q)&&!isNaN(Q)){const jt=_.valueAsNumber||Q&&+Q;_s(Wt.value)||(_t=jt>Wt.value),_s(wt.value)||(Rt=jt<wt.value)}else{const jt=_.valueAsDate||new Date(Q),Ct=ir=>new Date(new Date().toDateString()+" "+ir),st=_.type=="time",yt=_.type=="week";ec(Wt.value)&&Q&&(_t=st?Ct(Q)>Ct(Wt.value):yt?Q>Wt.value:jt>new Date(Wt.value)),ec(wt.value)&&Q&&(Rt=st?Ct(Q)<Ct(wt.value):yt?Q<wt.value:jt<new Date(wt.value))}if((_t||Rt)&&(qe(!!_t,Wt.message,wt.message,zc.max,zc.min),!i))return he(Ie[J].message),Ie}if((k||O)&&!et&&(ec(Q)||d&&Array.isArray(Q))){const _t=pm(k),Rt=pm(O),Wt=!_s(_t.value)&&Q.length>+_t.value,wt=!_s(Rt.value)&&Q.length<+Rt.value;if((Wt||wt)&&(qe(Wt,_t.message,Rt.message),!i))return he(Ie[J].message),Ie}if(G&&!et&&ec(Q)){const{value:_t,message:Rt}=pm(G);if(Xb(_t)&&!Q.match(_t)&&(Ie[J]={type:zc.pattern,message:Rt,ref:_,...Ge(zc.pattern,Rt)},!i))return he(Rt),Ie}if(ee){if(Hc(ee)){const _t=await ee(Q,t),Rt=S4(_t,ue);if(Rt&&(Ie[J]={...Rt,...Ge(zc.validate,Rt.message)},!i))return he(Rt.message),Ie}else if(eo(ee)){let _t={};for(const Rt in ee){if(!Os(_t)&&!i)break;const Wt=S4(await ee[Rt](Q,t),ue,Rt);Wt&&(_t={...Wt,...Ge(Rt,Wt.message)},he(Wt.message),i&&(Ie[J]=_t))}if(!Os(_t)&&(Ie[J]={ref:ue,..._t},!i))return Ie}}return he(!0),Ie};function Tte(e,t){const i=t.slice(0,-1).length;let a=0;for(;a<i;)e=Wi(e)?a++:e[t[a++]];return e}function Ete(e){for(const t in e)if(e.hasOwnProperty(t)&&!Wi(e[t]))return!1;return!0}function _o(e,t){const i=Array.isArray(t)?t:tP(t)?[t]:tj(t),a=i.length===1?e:Tte(e,i),d=i.length-1,_=i[d];return a&&delete a[_],d!==0&&(eo(a)&&Os(a)||Array.isArray(a)&&Ete(a))&&_o(e,i.slice(0,-1)),e}var QT=()=>{let e=[];return{get observers(){return e},next:d=>{for(const _ of e)_.next&&_.next(d)},subscribe:d=>(e.push(d),{unsubscribe:()=>{e=e.filter(_=>_!==d)}}),unsubscribe:()=>{e=[]}}},YC=e=>_s(e)||!JF(e);function hd(e,t){if(YC(e)||YC(t))return e===t;if(Jh(e)&&Jh(t))return e.getTime()===t.getTime();const i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(const d of i){const _=e[d];if(!a.includes(d))return!1;if(d!=="ref"){const b=t[d];if(Jh(_)&&Jh(b)||eo(_)&&eo(b)||Array.isArray(_)&&Array.isArray(b)?!hd(_,b):_!==b)return!1}}return!0}var cj=e=>e.type==="select-multiple",Cte=e=>iP(e)||uv(e),eE=e=>Yb(e)&&e.isConnected,uj=e=>{for(const t in e)if(Hc(e[t]))return!0;return!1};function Kb(e,t={}){const i=Array.isArray(e);if(eo(e)||i)for(const a in e)Array.isArray(e[a])||eo(e[a])&&!uj(e[a])?(t[a]=Array.isArray(e[a])?[]:{},Kb(e[a],t[a])):_s(e[a])||(t[a]=!0);return t}function dj(e,t,i){const a=Array.isArray(e);if(eo(e)||a)for(const d in e)Array.isArray(e[d])||eo(e[d])&&!uj(e[d])?Wi(t)||YC(i[d])?i[d]=Array.isArray(e[d])?Kb(e[d],[]):{...Kb(e[d])}:dj(e[d],_s(t)?{}:t[d],i[d]):i[d]=!hd(e[d],t[d]);return i}var ky=(e,t)=>dj(e,t,Kb(t)),hj=(e,{valueAsNumber:t,valueAsDate:i,setValueAs:a})=>Wi(e)?e:t?e===""?NaN:e&&+e:i&&ec(e)?new Date(e):a?a(e):e;function tE(e){const t=e.ref;if(!(e.refs?e.refs.every(i=>i.disabled):t.disabled))return nP(t)?t.files:iP(t)?lj(e.refs).value:cj(t)?[...t.selectedOptions].map(({value:i})=>i):uv(t)?aj(e.refs).value:hj(Wi(t.value)?e.ref.value:t.value,e)}var Mte=(e,t,i,a)=>{const d={};for(const _ of e){const b=dr(t,_);b&&hi(d,_,b._f)}return{criteriaMode:i,names:[...e],fields:d,shouldUseNativeValidation:a}},Ry=e=>Wi(e)?e:Xb(e)?e.source:eo(e)?Xb(e.value)?e.value.source:e.value:e;const E4="AsyncFunction";var Pte=e=>(!e||!e.validate)&&!!(Hc(e.validate)&&e.validate.constructor.name===E4||eo(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===E4)),Ate=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function C4(e,t,i){const a=dr(e,i);if(a||tP(i))return{error:a,name:i};const d=i.split(".");for(;d.length;){const _=d.join("."),b=dr(t,_),o=dr(e,_);if(b&&!Array.isArray(b)&&i!==_)return{name:i};if(o&&o.type)return{name:_,error:o};d.pop()}return{name:i}}var Ite=(e,t,i,a,d)=>d.isOnAll?!1:!i&&d.isOnTouch?!(t||e):(i?a.isOnBlur:d.isOnBlur)?!e:(i?a.isOnChange:d.isOnChange)?e:!0,kte=(e,t)=>!Gw(dr(e,t)).length&&_o(e,t);const Rte={mode:fl.onSubmit,reValidateMode:fl.onChange,shouldFocusError:!0};function Dte(e={}){let t={...Rte,...e},i={submitCount:0,isDirty:!1,isLoading:Hc(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},d=eo(t.defaultValues)||eo(t.values)?Rs(t.defaultValues||t.values)||{}:{},_=t.shouldUnregister?{}:Rs(d),b={action:!1,mount:!1,watch:!1},o={mount:new Set,unMount:new Set,array:new Set,watch:new Set},k,O=0;const z={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},F={values:QT(),array:QT(),state:QT()},G=y4(t.mode),ee=y4(t.reValidateMode),J=t.criteriaMode===fl.all,te=je=>dt=>{clearTimeout(O),O=setTimeout(je,dt)},oe=async je=>{if(!e.disabled&&(z.isValid||je)){const dt=t.resolver?Os((await Ze()).errors):await Ge(a,!0);dt!==i.isValid&&F.state.next({isValid:dt})}},X=(je,dt)=>{!e.disabled&&(z.isValidating||z.validatingFields)&&((je||Array.from(o.mount)).forEach(St=>{St&&(dt?hi(i.validatingFields,St,dt):_o(i.validatingFields,St))}),F.state.next({validatingFields:i.validatingFields,isValidating:!Os(i.validatingFields)}))},Q=(je,dt=[],St,or,Kt=!0,Xt=!0)=>{if(or&&St&&!e.disabled){if(b.action=!0,Xt&&Array.isArray(dr(a,je))){const Ot=St(dr(a,je),or.argA,or.argB);Kt&&hi(a,je,Ot)}if(Xt&&Array.isArray(dr(i.errors,je))){const Ot=St(dr(i.errors,je),or.argA,or.argB);Kt&&hi(i.errors,je,Ot),kte(i.errors,je)}if(z.touchedFields&&Xt&&Array.isArray(dr(i.touchedFields,je))){const Ot=St(dr(i.touchedFields,je),or.argA,or.argB);Kt&&hi(i.touchedFields,je,Ot)}z.dirtyFields&&(i.dirtyFields=ky(d,_)),F.state.next({name:je,isDirty:_t(je,dt),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else hi(_,je,dt)},ue=(je,dt)=>{hi(i.errors,je,dt),F.state.next({errors:i.errors})},he=je=>{i.errors=je,F.state.next({errors:i.errors,isValid:!1})},Ie=(je,dt,St,or)=>{const Kt=dr(a,je);if(Kt){const Xt=dr(_,je,Wi(St)?dr(d,je):St);Wi(Xt)||or&&or.defaultChecked||dt?hi(_,je,dt?Xt:tE(Kt._f)):wt(je,Xt),b.mount&&oe()}},Je=(je,dt,St,or,Kt)=>{let Xt=!1,Ot=!1;const Ur={name:je};if(!e.disabled){const $n=!!(dr(a,je)&&dr(a,je)._f&&dr(a,je)._f.disabled);if(!St||or){z.isDirty&&(Ot=i.isDirty,i.isDirty=Ur.isDirty=_t(),Xt=Ot!==Ur.isDirty);const Ln=$n||hd(dr(d,je),dt);Ot=!!(!$n&&dr(i.dirtyFields,je)),Ln||$n?_o(i.dirtyFields,je):hi(i.dirtyFields,je,!0),Ur.dirtyFields=i.dirtyFields,Xt=Xt||z.dirtyFields&&Ot!==!Ln}if(St){const Ln=dr(i.touchedFields,je);Ln||(hi(i.touchedFields,je,St),Ur.touchedFields=i.touchedFields,Xt=Xt||z.touchedFields&&Ln!==St)}Xt&&Kt&&F.state.next(Ur)}return Xt?Ur:{}},Ce=(je,dt,St,or)=>{const Kt=dr(i.errors,je),Xt=z.isValid&&Ta(dt)&&i.isValid!==dt;if(e.delayError&&St?(k=te(()=>ue(je,St)),k(e.delayError)):(clearTimeout(O),k=null,St?hi(i.errors,je,St):_o(i.errors,je)),(St?!hd(Kt,St):Kt)||!Os(or)||Xt){const Ot={...or,...Xt&&Ta(dt)?{isValid:dt}:{},errors:i.errors,name:je};i={...i,...Ot},F.state.next(Ot)}},Ze=async je=>{X(je,!0);const dt=await t.resolver(_,t.context,Mte(je||o.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return X(je),dt},et=async je=>{const{errors:dt}=await Ze(je);if(je)for(const St of je){const or=dr(dt,St);or?hi(i.errors,St,or):_o(i.errors,St)}else i.errors=dt;return dt},Ge=async(je,dt,St={valid:!0})=>{for(const or in je){const Kt=je[or];if(Kt){const{_f:Xt,...Ot}=Kt;if(Xt){const Ur=o.array.has(Xt.name),$n=Kt._f&&Pte(Kt._f);$n&&z.validatingFields&&X([or],!0);const Ln=await T4(Kt,_,J,t.shouldUseNativeValidation&&!dt,Ur);if($n&&z.validatingFields&&X([or]),Ln[Xt.name]&&(St.valid=!1,dt))break;!dt&&(dr(Ln,Xt.name)?Ur?Ste(i.errors,Ln,Xt.name):hi(i.errors,Xt.name,Ln[Xt.name]):_o(i.errors,Xt.name))}!Os(Ot)&&await Ge(Ot,dt,St)}}return St.valid},qe=()=>{for(const je of o.unMount){const dt=dr(a,je);dt&&(dt._f.refs?dt._f.refs.every(St=>!eE(St)):!eE(dt._f.ref))&&sn(je)}o.unMount=new Set},_t=(je,dt)=>!e.disabled&&(je&&dt&&hi(_,je,dt),!hd(yr(),d)),Rt=(je,dt,St)=>sj(je,o,{...b.mount?_:Wi(dt)?d:ec(je)?{[je]:dt}:dt},St,dt),Wt=je=>Gw(dr(b.mount?_:d,je,e.shouldUnregister?dr(d,je,[]):[])),wt=(je,dt,St={})=>{const or=dr(a,je);let Kt=dt;if(or){const Xt=or._f;Xt&&(!Xt.disabled&&hi(_,je,hj(dt,Xt)),Kt=Yb(Xt.ref)&&_s(dt)?"":dt,cj(Xt.ref)?[...Xt.ref.options].forEach(Ot=>Ot.selected=Kt.includes(Ot.value)):Xt.refs?uv(Xt.ref)?Xt.refs.length>1?Xt.refs.forEach(Ot=>(!Ot.defaultChecked||!Ot.disabled)&&(Ot.checked=Array.isArray(Kt)?!!Kt.find(Ur=>Ur===Ot.value):Kt===Ot.value)):Xt.refs[0]&&(Xt.refs[0].checked=!!Kt):Xt.refs.forEach(Ot=>Ot.checked=Ot.value===Kt):nP(Xt.ref)?Xt.ref.value="":(Xt.ref.value=Kt,Xt.ref.type||F.values.next({name:je,values:{..._}})))}(St.shouldDirty||St.shouldTouch)&&Je(je,Kt,St.shouldTouch,St.shouldDirty,!0),St.shouldValidate&&ir(je)},jt=(je,dt,St)=>{for(const or in dt){const Kt=dt[or],Xt=`${je}.${or}`,Ot=dr(a,Xt);(o.array.has(je)||eo(Kt)||Ot&&!Ot._f)&&!Jh(Kt)?jt(Xt,Kt,St):wt(Xt,Kt,St)}},Ct=(je,dt,St={})=>{const or=dr(a,je),Kt=o.array.has(je),Xt=Rs(dt);hi(_,je,Xt),Kt?(F.array.next({name:je,values:{..._}}),(z.isDirty||z.dirtyFields)&&St.shouldDirty&&F.state.next({name:je,dirtyFields:ky(d,_),isDirty:_t(je,Xt)})):or&&!or._f&&!_s(Xt)?jt(je,Xt,St):wt(je,Xt,St),v4(je,o)&&F.state.next({...i}),F.values.next({name:b.mount?je:void 0,values:{..._}})},st=async je=>{b.mount=!0;const dt=je.target;let St=dt.name,or=!0;const Kt=dr(a,St),Xt=()=>dt.type?tE(Kt._f):QF(je),Ot=Ur=>{or=Number.isNaN(Ur)||Jh(Ur)&&isNaN(Ur.getTime())||hd(Ur,dr(_,St,Ur))};if(Kt){let Ur,$n;const Ln=Xt(),Xn=je.type===Zb.BLUR||je.type===Zb.FOCUS_OUT,Mi=!Ate(Kt._f)&&!t.resolver&&!dr(i.errors,St)&&!Kt._f.deps||Ite(Xn,dr(i.touchedFields,St),i.isSubmitted,ee,G),Ui=v4(St,o,Xn);hi(_,St,Ln),Xn?(Kt._f.onBlur&&Kt._f.onBlur(je),k&&k(0)):Kt._f.onChange&&Kt._f.onChange(je);const Zi=Je(St,Ln,Xn,!1),Lo=!Os(Zi)||Ui;if(!Xn&&F.values.next({name:St,type:je.type,values:{..._}}),Mi)return z.isValid&&(e.mode==="onBlur"?Xn&&oe():oe()),Lo&&F.state.next({name:St,...Ui?{}:Zi});if(!Xn&&Ui&&F.state.next({...i}),t.resolver){const{errors:Yi}=await Ze([St]);if(Ot(Ln),or){const Oo=C4(i.errors,a,St),ss=C4(Yi,a,Oo.name||St);Ur=ss.error,St=ss.name,$n=Os(Yi)}}else X([St],!0),Ur=(await T4(Kt,_,J,t.shouldUseNativeValidation))[St],X([St]),Ot(Ln),or&&(Ur?$n=!1:z.isValid&&($n=await Ge(a,!0)));or&&(Kt._f.deps&&ir(Kt._f.deps),Ce(St,$n,Ur,Zi))}},yt=(je,dt)=>{if(dr(i.errors,dt)&&je.focus)return je.focus(),1},ir=async(je,dt={})=>{let St,or;const Kt=r0(je);if(t.resolver){const Xt=await et(Wi(je)?je:Kt);St=Os(Xt),or=je?!Kt.some(Ot=>dr(Xt,Ot)):St}else je?(or=(await Promise.all(Kt.map(async Xt=>{const Ot=dr(a,Xt);return await Ge(Ot&&Ot._f?{[Xt]:Ot}:Ot)}))).every(Boolean),!(!or&&!i.isValid)&&oe()):or=St=await Ge(a);return F.state.next({...!ec(je)||z.isValid&&St!==i.isValid?{}:{name:je},...t.resolver||!je?{isValid:St}:{},errors:i.errors}),dt.shouldFocus&&!or&&n0(a,yt,je?Kt:o.mount),or},yr=je=>{const dt={...b.mount?_:d};return Wi(je)?dt:ec(je)?dr(dt,je):je.map(St=>dr(dt,St))},Wr=(je,dt)=>({invalid:!!dr((dt||i).errors,je),isDirty:!!dr((dt||i).dirtyFields,je),error:dr((dt||i).errors,je),isValidating:!!dr(i.validatingFields,je),isTouched:!!dr((dt||i).touchedFields,je)}),rr=je=>{je&&r0(je).forEach(dt=>_o(i.errors,dt)),F.state.next({errors:je?i.errors:{}})},dn=(je,dt,St)=>{const or=(dr(a,je,{_f:{}})._f||{}).ref,Kt=dr(i.errors,je)||{},{ref:Xt,message:Ot,type:Ur,...$n}=Kt;hi(i.errors,je,{...$n,...dt,ref:or}),F.state.next({name:je,errors:i.errors,isValid:!1}),St&&St.shouldFocus&&or&&or.focus&&or.focus()},Dn=(je,dt)=>Hc(je)?F.values.subscribe({next:St=>je(Rt(void 0,dt),St)}):Rt(je,dt,!0),sn=(je,dt={})=>{for(const St of je?r0(je):o.mount)o.mount.delete(St),o.array.delete(St),dt.keepValue||(_o(a,St),_o(_,St)),!dt.keepError&&_o(i.errors,St),!dt.keepDirty&&_o(i.dirtyFields,St),!dt.keepTouched&&_o(i.touchedFields,St),!dt.keepIsValidating&&_o(i.validatingFields,St),!t.shouldUnregister&&!dt.keepDefaultValue&&_o(d,St);F.values.next({values:{..._}}),F.state.next({...i,...dt.keepDirty?{isDirty:_t()}:{}}),!dt.keepIsValid&&oe()},cr=({disabled:je,name:dt,field:St,fields:or,value:Kt})=>{if(Ta(je)&&b.mount||je){const Xt=je?void 0:Wi(Kt)?tE(St?St._f:dr(or,dt)._f):Kt;hi(_,dt,Xt),Je(dt,Xt,!1,!1,!0)}},Lr=(je,dt={})=>{let St=dr(a,je);const or=Ta(dt.disabled)||Ta(e.disabled);return hi(a,je,{...St||{},_f:{...St&&St._f?St._f:{ref:{name:je}},name:je,mount:!0,...dt}}),o.mount.add(je),St?cr({field:St,disabled:Ta(dt.disabled)?dt.disabled:e.disabled,name:je,value:dt.value}):Ie(je,!0,dt.value),{...or?{disabled:dt.disabled||e.disabled}:{},...t.progressive?{required:!!dt.required,min:Ry(dt.min),max:Ry(dt.max),minLength:Ry(dt.minLength),maxLength:Ry(dt.maxLength),pattern:Ry(dt.pattern)}:{},name:je,onChange:st,onBlur:st,ref:Kt=>{if(Kt){Lr(je,dt),St=dr(a,je);const Xt=Wi(Kt.value)&&Kt.querySelectorAll&&Kt.querySelectorAll("input,select,textarea")[0]||Kt,Ot=Cte(Xt),Ur=St._f.refs||[];if(Ot?Ur.find($n=>$n===Xt):Xt===St._f.ref)return;hi(a,je,{_f:{...St._f,...Ot?{refs:[...Ur.filter(eE),Xt,...Array.isArray(dr(d,je))?[{}]:[]],ref:{type:Xt.type,name:je}}:{ref:Xt}}}),Ie(je,!1,void 0,Xt)}else St=dr(a,je,{}),St._f&&(St._f.mount=!1),(t.shouldUnregister||dt.shouldUnregister)&&!(ej(o.array,je)&&b.action)&&o.unMount.add(je)}}},cn=()=>t.shouldFocusError&&n0(a,yt,o.mount),Me=je=>{Ta(je)&&(F.state.next({disabled:je}),n0(a,(dt,St)=>{const or=dr(a,St);or&&(dt.disabled=or._f.disabled||je,Array.isArray(or._f.refs)&&or._f.refs.forEach(Kt=>{Kt.disabled=or._f.disabled||je}))},0,!1))},fr=(je,dt)=>async St=>{let or;St&&(St.preventDefault&&St.preventDefault(),St.persist&&St.persist());let Kt=Rs(_);if(F.state.next({isSubmitting:!0}),t.resolver){const{errors:Xt,values:Ot}=await Ze();i.errors=Xt,Kt=Ot}else await Ge(a);if(_o(i.errors,"root"),Os(i.errors)){F.state.next({errors:{}});try{await je(Kt,St)}catch(Xt){or=Xt}}else dt&&await dt({...i.errors},St),cn(),setTimeout(cn);if(F.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Os(i.errors)&&!or,submitCount:i.submitCount+1,errors:i.errors}),or)throw or},Yt=(je,dt={})=>{dr(a,je)&&(Wi(dt.defaultValue)?Ct(je,Rs(dr(d,je))):(Ct(je,dt.defaultValue),hi(d,je,Rs(dt.defaultValue))),dt.keepTouched||_o(i.touchedFields,je),dt.keepDirty||(_o(i.dirtyFields,je),i.isDirty=dt.defaultValue?_t(je,Rs(dr(d,je))):_t()),dt.keepError||(_o(i.errors,je),z.isValid&&oe()),F.state.next({...i}))},tr=(je,dt={})=>{const St=je?Rs(je):d,or=Rs(St),Kt=Os(je),Xt=Kt?d:or;if(dt.keepDefaultValues||(d=St),!dt.keepValues){if(dt.keepDirtyValues){const Ot=new Set([...o.mount,...Object.keys(ky(d,_))]);for(const Ur of Array.from(Ot))dr(i.dirtyFields,Ur)?hi(Xt,Ur,dr(_,Ur)):Ct(Ur,dr(Xt,Ur))}else{if(eP&&Wi(je))for(const Ot of o.mount){const Ur=dr(a,Ot);if(Ur&&Ur._f){const $n=Array.isArray(Ur._f.refs)?Ur._f.refs[0]:Ur._f.ref;if(Yb($n)){const Ln=$n.closest("form");if(Ln){Ln.reset();break}}}}a={}}_=e.shouldUnregister?dt.keepDefaultValues?Rs(d):{}:Rs(Xt),F.array.next({values:{...Xt}}),F.values.next({values:{...Xt}})}o={mount:dt.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},b.mount=!z.isValid||!!dt.keepIsValid||!!dt.keepDirtyValues,b.watch=!!e.shouldUnregister,F.state.next({submitCount:dt.keepSubmitCount?i.submitCount:0,isDirty:Kt?!1:dt.keepDirty?i.isDirty:!!(dt.keepDefaultValues&&!hd(je,d)),isSubmitted:dt.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:Kt?{}:dt.keepDirtyValues?dt.keepDefaultValues&&_?ky(d,_):i.dirtyFields:dt.keepDefaultValues&&je?ky(d,je):dt.keepDirty?i.dirtyFields:{},touchedFields:dt.keepTouched?i.touchedFields:{},errors:dt.keepErrors?i.errors:{},isSubmitSuccessful:dt.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},vt=(je,dt)=>tr(Hc(je)?je(_):je,dt);return{control:{register:Lr,unregister:sn,getFieldState:Wr,handleSubmit:fr,setError:dn,_executeSchema:Ze,_getWatch:Rt,_getDirty:_t,_updateValid:oe,_removeUnmounted:qe,_updateFieldArray:Q,_updateDisabledField:cr,_getFieldArray:Wt,_reset:tr,_resetDefaultValues:()=>Hc(t.defaultValues)&&t.defaultValues().then(je=>{vt(je,t.resetOptions),F.state.next({isLoading:!1})}),_updateFormState:je=>{i={...i,...je}},_disableForm:Me,_subjects:F,_proxyFormState:z,_setErrors:he,get _fields(){return a},get _formValues(){return _},get _state(){return b},set _state(je){b=je},get _defaultValues(){return d},get _names(){return o},set _names(je){o=je},get _formState(){return i},set _formState(je){i=je},get _options(){return t},set _options(je){t={...t,...je}}},trigger:ir,register:Lr,handleSubmit:fr,watch:Dn,setValue:Ct,getValues:yr,reset:vt,resetField:Yt,clearErrors:rr,unregister:sn,setError:dn,setFocus:(je,dt={})=>{const St=dr(a,je),or=St&&St._f;if(or){const Kt=or.refs?or.refs[0]:or.ref;Kt.focus&&(Kt.focus(),dt.shouldSelect&&Kt.select())}},getFieldState:Wr}}function fj(e={}){const t=Fe.useRef(),i=Fe.useRef(),[a,d]=Fe.useState({isDirty:!1,isValidating:!1,isLoading:Hc(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:Hc(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...Dte(e),formState:a});const _=t.current.control;return _._options=e,rP({subject:_._subjects.state,next:b=>{ij(b,_._proxyFormState,_._updateFormState,!0)&&d({..._._formState})}}),Fe.useEffect(()=>_._disableForm(e.disabled),[_,e.disabled]),Fe.useEffect(()=>{if(_._proxyFormState.isDirty){const b=_._getDirty();b!==a.isDirty&&_._subjects.state.next({isDirty:b})}},[_,a.isDirty]),Fe.useEffect(()=>{e.values&&!hd(e.values,i.current)?(_._reset(e.values,_._options.resetOptions),i.current=e.values,d(b=>({...b}))):_._resetDefaultValues()},[e.values,_]),Fe.useEffect(()=>{e.errors&&_._setErrors(e.errors)},[e.errors,_]),Fe.useEffect(()=>{_._state.mount||(_._updateValid(),_._state.mount=!0),_._state.watch&&(_._state.watch=!1,_._subjects.state.next({..._._formState})),_._removeUnmounted()}),Fe.useEffect(()=>{e.shouldUnregister&&_._subjects.values.next({values:_._getWatch()})},[e.shouldUnregister,_]),Fe.useEffect(()=>{t.current&&(t.current.watch=t.current.watch.bind({}))},[a]),t.current.formState=nj(a,_),t.current}const pj=_te,mj=Y.createContext({}),mm=({...e})=>L.jsx(mj.Provider,{value:{name:e.name},children:L.jsx(bte,{...e})}),qw=()=>{const e=Y.useContext(mj),t=Y.useContext(gj),{getFieldState:i,formState:a}=Hw(),d=i(e.name,a);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:_}=t;return{id:_,name:e.name,formItemId:`${_}-form-item`,formDescriptionId:`${_}-form-item-description`,formMessageId:`${_}-form-item-message`,...d}},gj=Y.createContext({}),Gh=Y.forwardRef(({className:e,...t},i)=>{const a=Y.useId();return L.jsx(gj.Provider,{value:{id:a},children:L.jsx("div",{ref:i,className:_r("space-y-2",e),...t})})});Gh.displayName="FormItem";const Bc=Y.forwardRef(({className:e,...t},i)=>{const{error:a,formItemId:d}=qw();return L.jsx(ao,{ref:i,className:_r(a&&"text-destructive",e),htmlFor:d,...t})});Bc.displayName="FormLabel";const Hh=Y.forwardRef(({...e},t)=>{const{error:i,formItemId:a,formDescriptionId:d,formMessageId:_}=qw();return L.jsx(eu,{ref:t,id:a,"aria-describedby":i?`${d} ${_}`:`${d}`,"aria-invalid":!!i,...e})});Hh.displayName="FormControl";const Lte=Y.forwardRef(({className:e,...t},i)=>{const{formDescriptionId:a}=qw();return L.jsx("p",{ref:i,id:a,className:_r("text-sm text-muted-foreground",e),...t})});Lte.displayName="FormDescription";const qh=Y.forwardRef(({className:e,children:t,...i},a)=>{const{error:d,formMessageId:_}=qw(),b=d?String(d==null?void 0:d.message):t;return b?L.jsx("p",{ref:a,id:_,className:_r("text-sm font-medium text-destructive",e),...i,children:b}):null});qh.displayName="FormMessage";const Ote=({initialValues:e})=>{const{toast:t}=Tl(),[i,a]=Y.useState(!1),d=fj({defaultValues:e}),_=async b=>{try{a(!0);const{data:{session:o}}=await Qt.auth.getSession();if(!(o!=null&&o.user))throw new Error("No authenticated user found");const{error:k}=await Qt.from("profiles").update({full_name:b.full_name}).eq("id",o.user.id);if(k)throw k;console.log("Profile updated successfully"),t({title:"Success",description:"Profile updated successfully"})}catch(o){console.error("Error updating profile:",o),t({title:"Error",description:"Failed to update profile",variant:"destructive"})}finally{a(!1)}};return L.jsxs("div",{className:"mb-8",children:[L.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Profile Information"}),L.jsx(pj,{...d,children:L.jsxs("form",{onSubmit:d.handleSubmit(_),className:"space-y-4 max-w-sm",children:[L.jsx(mm,{control:d.control,name:"full_name",render:({field:b})=>L.jsxs(Gh,{children:[L.jsx(Bc,{children:"Full Name"}),L.jsx(Hh,{children:L.jsx(lo,{placeholder:"Enter your full name",...b,disabled:i})}),L.jsx(qh,{})]})}),L.jsx(on,{type:"submit",disabled:i,children:i?"Saving...":"Save Changes"})]})})]})},zte=()=>L.jsx("div",{className:"space-y-6",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsx("h1",{className:"text-2xl font-bold",children:"Profile"}),L.jsxs("div",{className:"flex gap-2",children:[L.jsx(cf,{to:"/bookings",children:L.jsxs(on,{variant:"outline",className:"gap-2",children:[L.jsx(Hz,{className:"h-4 w-4"}),"My Bookings"]})}),L.jsx(cf,{to:"/dashboard",children:L.jsxs(on,{className:"gap-2",children:[L.jsx(WG,{className:"h-4 w-4"}),"Dashboard"]})})]})]})});function Nte(e,t=[]){let i=[];function a(_,b){const o=Y.createContext(b),k=i.length;i=[...i,b];function O(F){const{scope:G,children:ee,...J}=F,te=(G==null?void 0:G[e][k])||o,oe=Y.useMemo(()=>J,Object.values(J));return L.jsx(te.Provider,{value:oe,children:ee})}function z(F,G){const ee=(G==null?void 0:G[e][k])||o,J=Y.useContext(ee);if(J)return J;if(b!==void 0)return b;throw new Error(`\`${F}\` must be used within \`${_}\``)}return O.displayName=_+"Provider",[O,z]}const d=()=>{const _=i.map(b=>Y.createContext(b));return function(o){const k=(o==null?void 0:o[e])||_;return Y.useMemo(()=>({[`__scope${e}`]:{...o,[e]:k}}),[o,k])}};return d.scopeName=e,[a,Fte(d,...t)]}function Fte(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(_){const b=a.reduce((o,{useScope:k,scopeName:O})=>{const F=k(_)[`__scope${O}`];return{...o,...F}},{});return Y.useMemo(()=>({[`__scope${t.scopeName}`]:b}),[b])}};return i.scopeName=t.scopeName,i}var rE="rovingFocusGroup.onEntryFocus",jte={bubbles:!1,cancelable:!0},Ww="RovingFocusGroup",[XC,_j,Bte]=GN(Ww),[Ute,yj]=Nte(Ww,[Bte]),[Vte,$te]=Ute(Ww),vj=Y.forwardRef((e,t)=>L.jsx(XC.Provider,{scope:e.__scopeRovingFocusGroup,children:L.jsx(XC.Slot,{scope:e.__scopeRovingFocusGroup,children:L.jsx(Gte,{...e,ref:t})})}));vj.displayName=Ww;var Gte=Y.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:i,orientation:a,loop:d=!1,dir:_,currentTabStopId:b,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:k,onEntryFocus:O,preventScrollOnEntryFocus:z=!1,...F}=e,G=Y.useRef(null),ee=Qn(t,G),J=jw(_),[te=null,oe]=wf({prop:b,defaultProp:o,onChange:k}),[X,Q]=Y.useState(!1),ue=Io(O),he=_j(i),Ie=Y.useRef(!1),[Je,Ce]=Y.useState(0);return Y.useEffect(()=>{const Ze=G.current;if(Ze)return Ze.addEventListener(rE,ue),()=>Ze.removeEventListener(rE,ue)},[ue]),L.jsx(Vte,{scope:i,orientation:a,dir:J,loop:d,currentTabStopId:te,onItemFocus:Y.useCallback(Ze=>oe(Ze),[oe]),onItemShiftTab:Y.useCallback(()=>Q(!0),[]),onFocusableItemAdd:Y.useCallback(()=>Ce(Ze=>Ze+1),[]),onFocusableItemRemove:Y.useCallback(()=>Ce(Ze=>Ze-1),[]),children:L.jsx(ln.div,{tabIndex:X||Je===0?-1:0,"data-orientation":a,...F,ref:ee,style:{outline:"none",...e.style},onMouseDown:Fr(e.onMouseDown,()=>{Ie.current=!0}),onFocus:Fr(e.onFocus,Ze=>{const et=!Ie.current;if(Ze.target===Ze.currentTarget&&et&&!X){const Ge=new CustomEvent(rE,jte);if(Ze.currentTarget.dispatchEvent(Ge),!Ge.defaultPrevented){const qe=he().filter(jt=>jt.focusable),_t=qe.find(jt=>jt.active),Rt=qe.find(jt=>jt.id===te),wt=[_t,Rt,...qe].filter(Boolean).map(jt=>jt.ref.current);wj(wt,z)}}Ie.current=!1}),onBlur:Fr(e.onBlur,()=>Q(!1))})})}),xj="RovingFocusGroupItem",bj=Y.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:i,focusable:a=!0,active:d=!1,tabStopId:_,...b}=e,o=Wc(),k=_||o,O=$te(xj,i),z=O.currentTabStopId===k,F=_j(i),{onFocusableItemAdd:G,onFocusableItemRemove:ee}=O;return Y.useEffect(()=>{if(a)return G(),()=>ee()},[a,G,ee]),L.jsx(XC.ItemSlot,{scope:i,id:k,focusable:a,active:d,children:L.jsx(ln.span,{tabIndex:z?0:-1,"data-orientation":O.orientation,...b,ref:t,onMouseDown:Fr(e.onMouseDown,J=>{a?O.onItemFocus(k):J.preventDefault()}),onFocus:Fr(e.onFocus,()=>O.onItemFocus(k)),onKeyDown:Fr(e.onKeyDown,J=>{if(J.key==="Tab"&&J.shiftKey){O.onItemShiftTab();return}if(J.target!==J.currentTarget)return;const te=Wte(J,O.orientation,O.dir);if(te!==void 0){if(J.metaKey||J.ctrlKey||J.altKey||J.shiftKey)return;J.preventDefault();let X=F().filter(Q=>Q.focusable).map(Q=>Q.ref.current);if(te==="last")X.reverse();else if(te==="prev"||te==="next"){te==="prev"&&X.reverse();const Q=X.indexOf(J.currentTarget);X=O.loop?Zte(X,Q+1):X.slice(Q+1)}setTimeout(()=>wj(X))}})})})});bj.displayName=xj;var Hte={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function qte(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Wte(e,t,i){const a=qte(e.key,i);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return Hte[a]}function wj(e,t=!1){const i=document.activeElement;for(const a of e)if(a===i||(a.focus({preventScroll:t}),document.activeElement!==i))return}function Zte(e,t){return e.map((i,a)=>e[(t+a)%e.length])}var Yte=vj,Xte=bj,oP="Tabs",[Kte,aoe]=Rf(oP,[yj]),Sj=yj(),[Jte,sP]=Kte(oP),Tj=Y.forwardRef((e,t)=>{const{__scopeTabs:i,value:a,onValueChange:d,defaultValue:_,orientation:b="horizontal",dir:o,activationMode:k="automatic",...O}=e,z=jw(o),[F,G]=wf({prop:a,onChange:d,defaultProp:_});return L.jsx(Jte,{scope:i,baseId:Wc(),value:F,onValueChange:G,orientation:b,dir:z,activationMode:k,children:L.jsx(ln.div,{dir:z,"data-orientation":b,...O,ref:t})})});Tj.displayName=oP;var Ej="TabsList",Cj=Y.forwardRef((e,t)=>{const{__scopeTabs:i,loop:a=!0,...d}=e,_=sP(Ej,i),b=Sj(i);return L.jsx(Yte,{asChild:!0,...b,orientation:_.orientation,dir:_.dir,loop:a,children:L.jsx(ln.div,{role:"tablist","aria-orientation":_.orientation,...d,ref:t})})});Cj.displayName=Ej;var Mj="TabsTrigger",Pj=Y.forwardRef((e,t)=>{const{__scopeTabs:i,value:a,disabled:d=!1,..._}=e,b=sP(Mj,i),o=Sj(i),k=kj(b.baseId,a),O=Rj(b.baseId,a),z=a===b.value;return L.jsx(Xte,{asChild:!0,...o,focusable:!d,active:z,children:L.jsx(ln.button,{type:"button",role:"tab","aria-selected":z,"aria-controls":O,"data-state":z?"active":"inactive","data-disabled":d?"":void 0,disabled:d,id:k,..._,ref:t,onMouseDown:Fr(e.onMouseDown,F=>{!d&&F.button===0&&F.ctrlKey===!1?b.onValueChange(a):F.preventDefault()}),onKeyDown:Fr(e.onKeyDown,F=>{[" ","Enter"].includes(F.key)&&b.onValueChange(a)}),onFocus:Fr(e.onFocus,()=>{const F=b.activationMode!=="manual";!z&&!d&&F&&b.onValueChange(a)})})})});Pj.displayName=Mj;var Aj="TabsContent",Ij=Y.forwardRef((e,t)=>{const{__scopeTabs:i,value:a,forceMount:d,children:_,...b}=e,o=sP(Aj,i),k=kj(o.baseId,a),O=Rj(o.baseId,a),z=a===o.value,F=Y.useRef(z);return Y.useEffect(()=>{const G=requestAnimationFrame(()=>F.current=!1);return()=>cancelAnimationFrame(G)},[]),L.jsx(Ra,{present:d||z,children:({present:G})=>L.jsx(ln.div,{"data-state":z?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":k,hidden:!G,id:O,tabIndex:0,...b,ref:t,style:{...e.style,animationDuration:F.current?"0s":void 0},children:G&&_})})});Ij.displayName=Aj;function kj(e,t){return`${e}-trigger-${t}`}function Rj(e,t){return`${e}-content-${t}`}var Qte=Tj,Dj=Cj,Lj=Pj,Oj=Ij;const Zw=Qte,dv=Y.forwardRef(({className:e,...t},i)=>L.jsx(Dj,{ref:i,className:_r("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));dv.displayName=Dj.displayName;const gl=Y.forwardRef(({className:e,...t},i)=>L.jsx(Lj,{ref:i,className:_r("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));gl.displayName=Lj.displayName;const Zc=Y.forwardRef(({className:e,...t},i)=>L.jsx(Oj,{ref:i,className:_r("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Zc.displayName=Oj.displayName;const ere=()=>{const[e,t]=Y.useState("renter"),[i,a]=Y.useState(!0),[d,_]=Y.useState(!1),{toast:b}=Tl();Y.useEffect(()=>{o(),k()},[]);const o=async()=>{try{const{data:{user:z}}=await Qt.auth.getUser();if(!z)return;console.log("Fetching initial role for user:",z.id);const{data:F}=await Qt.from("profiles").select("role").eq("id",z.id).maybeSingle();F!=null&&F.role&&(console.log("User role found:",F.role),t(F.role)),a(!1)}catch(z){console.error("Error fetching role:",z),a(!1)}},k=async()=>{try{const{data:{user:z}}=await Qt.auth.getUser();if(!z)return;console.log("Checking listed cars for user:",z.id);const{data:F,error:G}=await Qt.from("cars").select("id").eq("owner_id",z.id).limit(1);if(G)throw G;const ee=F&&F.length>0;console.log("User has listed cars:",ee),_(ee)}catch(z){console.error("Error checking listed cars:",z)}},O=async z=>{try{const{data:{user:F}}=await Qt.auth.getUser();if(!F)return;console.log("Updating role to:",z);const{error:G}=await Qt.from("profiles").update({role:z}).eq("id",F.id);if(G)throw G;t(z),b({title:"Role Updated",description:`You are now a ${z}`})}catch(F){console.error("Error updating role:",F),b({title:"Error",description:"Failed to update role. Please try again.",variant:"destructive"})}};return i?L.jsx("div",{children:"Loading..."}):!d&&e==="renter"?L.jsx("div",{className:"w-full max-w-sm mx-auto text-center",children:L.jsx("p",{className:"text-sm text-gray-600",children:"List a car to unlock host features"})}):L.jsx("div",{className:"w-full max-w-sm mx-auto",children:L.jsx(Zw,{value:e,onValueChange:z=>O(z),children:L.jsxs(dv,{className:"grid w-full grid-cols-2",children:[L.jsx(gl,{value:"renter",children:"Renter"}),L.jsx(gl,{value:"host",children:"Host"})]})})})},tre=()=>L.jsxs("div",{className:"mb-8",children:[L.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Select Your Role"}),L.jsx(ere,{})]});function rre(e,t){return Y.useReducer((i,a)=>t[i][a]??i,e)}var aP="ScrollArea",[zj,loe]=Rf(aP),[nre,Da]=zj(aP),Nj=Y.forwardRef((e,t)=>{const{__scopeScrollArea:i,type:a="hover",dir:d,scrollHideDelay:_=600,...b}=e,[o,k]=Y.useState(null),[O,z]=Y.useState(null),[F,G]=Y.useState(null),[ee,J]=Y.useState(null),[te,oe]=Y.useState(null),[X,Q]=Y.useState(0),[ue,he]=Y.useState(0),[Ie,Je]=Y.useState(!1),[Ce,Ze]=Y.useState(!1),et=Qn(t,qe=>k(qe)),Ge=jw(d);return L.jsx(nre,{scope:i,type:a,dir:Ge,scrollHideDelay:_,scrollArea:o,viewport:O,onViewportChange:z,content:F,onContentChange:G,scrollbarX:ee,onScrollbarXChange:J,scrollbarXEnabled:Ie,onScrollbarXEnabledChange:Je,scrollbarY:te,onScrollbarYChange:oe,scrollbarYEnabled:Ce,onScrollbarYEnabledChange:Ze,onCornerWidthChange:Q,onCornerHeightChange:he,children:L.jsx(ln.div,{dir:Ge,...b,ref:et,style:{position:"relative","--radix-scroll-area-corner-width":X+"px","--radix-scroll-area-corner-height":ue+"px",...e.style}})})});Nj.displayName=aP;var Fj="ScrollAreaViewport",jj=Y.forwardRef((e,t)=>{const{__scopeScrollArea:i,children:a,asChild:d,nonce:_,...b}=e,o=Da(Fj,i),k=Y.useRef(null),O=Qn(t,k,o.onViewportChange);return L.jsxs(L.Fragment,{children:[L.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:_}),L.jsx(ln.div,{"data-radix-scroll-area-viewport":"",...b,asChild:d,ref:O,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...e.style},children:fre({asChild:d,children:a},z=>L.jsx("div",{"data-radix-scroll-area-content":"",ref:o.onContentChange,style:{minWidth:o.scrollbarXEnabled?"fit-content":void 0},children:z}))})]})});jj.displayName=Fj;var lc="ScrollAreaScrollbar",lP=Y.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Da(lc,e.__scopeScrollArea),{onScrollbarXEnabledChange:_,onScrollbarYEnabledChange:b}=d,o=e.orientation==="horizontal";return Y.useEffect(()=>(o?_(!0):b(!0),()=>{o?_(!1):b(!1)}),[o,_,b]),d.type==="hover"?L.jsx(ire,{...a,ref:t,forceMount:i}):d.type==="scroll"?L.jsx(ore,{...a,ref:t,forceMount:i}):d.type==="auto"?L.jsx(Bj,{...a,ref:t,forceMount:i}):d.type==="always"?L.jsx(cP,{...a,ref:t}):null});lP.displayName=lc;var ire=Y.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Da(lc,e.__scopeScrollArea),[_,b]=Y.useState(!1);return Y.useEffect(()=>{const o=d.scrollArea;let k=0;if(o){const O=()=>{window.clearTimeout(k),b(!0)},z=()=>{k=window.setTimeout(()=>b(!1),d.scrollHideDelay)};return o.addEventListener("pointerenter",O),o.addEventListener("pointerleave",z),()=>{window.clearTimeout(k),o.removeEventListener("pointerenter",O),o.removeEventListener("pointerleave",z)}}},[d.scrollArea,d.scrollHideDelay]),L.jsx(Ra,{present:i||_,children:L.jsx(Bj,{"data-state":_?"visible":"hidden",...a,ref:t})})}),ore=Y.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Da(lc,e.__scopeScrollArea),_=e.orientation==="horizontal",b=Xw(()=>k("SCROLL_END"),100),[o,k]=rre("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return Y.useEffect(()=>{if(o==="idle"){const O=window.setTimeout(()=>k("HIDE"),d.scrollHideDelay);return()=>window.clearTimeout(O)}},[o,d.scrollHideDelay,k]),Y.useEffect(()=>{const O=d.viewport,z=_?"scrollLeft":"scrollTop";if(O){let F=O[z];const G=()=>{const ee=O[z];F!==ee&&(k("SCROLL"),b()),F=ee};return O.addEventListener("scroll",G),()=>O.removeEventListener("scroll",G)}},[d.viewport,_,k,b]),L.jsx(Ra,{present:i||o!=="hidden",children:L.jsx(cP,{"data-state":o==="hidden"?"hidden":"visible",...a,ref:t,onPointerEnter:Fr(e.onPointerEnter,()=>k("POINTER_ENTER")),onPointerLeave:Fr(e.onPointerLeave,()=>k("POINTER_LEAVE"))})})}),Bj=Y.forwardRef((e,t)=>{const i=Da(lc,e.__scopeScrollArea),{forceMount:a,...d}=e,[_,b]=Y.useState(!1),o=e.orientation==="horizontal",k=Xw(()=>{if(i.viewport){const O=i.viewport.offsetWidth<i.viewport.scrollWidth,z=i.viewport.offsetHeight<i.viewport.scrollHeight;b(o?O:z)}},10);return gg(i.viewport,k),gg(i.content,k),L.jsx(Ra,{present:a||_,children:L.jsx(cP,{"data-state":_?"visible":"hidden",...d,ref:t})})}),cP=Y.forwardRef((e,t)=>{const{orientation:i="vertical",...a}=e,d=Da(lc,e.__scopeScrollArea),_=Y.useRef(null),b=Y.useRef(0),[o,k]=Y.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),O=Hj(o.viewport,o.content),z={...a,sizes:o,onSizesChange:k,hasThumb:O>0&&O<1,onThumbChange:G=>_.current=G,onThumbPointerUp:()=>b.current=0,onThumbPointerDown:G=>b.current=G};function F(G,ee){return dre(G,b.current,o,ee)}return i==="horizontal"?L.jsx(sre,{...z,ref:t,onThumbPositionChange:()=>{if(d.viewport&&_.current){const G=d.viewport.scrollLeft,ee=M4(G,o,d.dir);_.current.style.transform=`translate3d(${ee}px, 0, 0)`}},onWheelScroll:G=>{d.viewport&&(d.viewport.scrollLeft=G)},onDragScroll:G=>{d.viewport&&(d.viewport.scrollLeft=F(G,d.dir))}}):i==="vertical"?L.jsx(are,{...z,ref:t,onThumbPositionChange:()=>{if(d.viewport&&_.current){const G=d.viewport.scrollTop,ee=M4(G,o);_.current.style.transform=`translate3d(0, ${ee}px, 0)`}},onWheelScroll:G=>{d.viewport&&(d.viewport.scrollTop=G)},onDragScroll:G=>{d.viewport&&(d.viewport.scrollTop=F(G))}}):null}),sre=Y.forwardRef((e,t)=>{const{sizes:i,onSizesChange:a,...d}=e,_=Da(lc,e.__scopeScrollArea),[b,o]=Y.useState(),k=Y.useRef(null),O=Qn(t,k,_.onScrollbarXChange);return Y.useEffect(()=>{k.current&&o(getComputedStyle(k.current))},[k]),L.jsx(Vj,{"data-orientation":"horizontal",...d,ref:O,sizes:i,style:{bottom:0,left:_.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:_.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Yw(i)+"px",...e.style},onThumbPointerDown:z=>e.onThumbPointerDown(z.x),onDragScroll:z=>e.onDragScroll(z.x),onWheelScroll:(z,F)=>{if(_.viewport){const G=_.viewport.scrollLeft+z.deltaX;e.onWheelScroll(G),Wj(G,F)&&z.preventDefault()}},onResize:()=>{k.current&&_.viewport&&b&&a({content:_.viewport.scrollWidth,viewport:_.viewport.offsetWidth,scrollbar:{size:k.current.clientWidth,paddingStart:Qb(b.paddingLeft),paddingEnd:Qb(b.paddingRight)}})}})}),are=Y.forwardRef((e,t)=>{const{sizes:i,onSizesChange:a,...d}=e,_=Da(lc,e.__scopeScrollArea),[b,o]=Y.useState(),k=Y.useRef(null),O=Qn(t,k,_.onScrollbarYChange);return Y.useEffect(()=>{k.current&&o(getComputedStyle(k.current))},[k]),L.jsx(Vj,{"data-orientation":"vertical",...d,ref:O,sizes:i,style:{top:0,right:_.dir==="ltr"?0:void 0,left:_.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Yw(i)+"px",...e.style},onThumbPointerDown:z=>e.onThumbPointerDown(z.y),onDragScroll:z=>e.onDragScroll(z.y),onWheelScroll:(z,F)=>{if(_.viewport){const G=_.viewport.scrollTop+z.deltaY;e.onWheelScroll(G),Wj(G,F)&&z.preventDefault()}},onResize:()=>{k.current&&_.viewport&&b&&a({content:_.viewport.scrollHeight,viewport:_.viewport.offsetHeight,scrollbar:{size:k.current.clientHeight,paddingStart:Qb(b.paddingTop),paddingEnd:Qb(b.paddingBottom)}})}})}),[lre,Uj]=zj(lc),Vj=Y.forwardRef((e,t)=>{const{__scopeScrollArea:i,sizes:a,hasThumb:d,onThumbChange:_,onThumbPointerUp:b,onThumbPointerDown:o,onThumbPositionChange:k,onDragScroll:O,onWheelScroll:z,onResize:F,...G}=e,ee=Da(lc,i),[J,te]=Y.useState(null),oe=Qn(t,et=>te(et)),X=Y.useRef(null),Q=Y.useRef(""),ue=ee.viewport,he=a.content-a.viewport,Ie=Io(z),Je=Io(k),Ce=Xw(F,10);function Ze(et){if(X.current){const Ge=et.clientX-X.current.left,qe=et.clientY-X.current.top;O({x:Ge,y:qe})}}return Y.useEffect(()=>{const et=Ge=>{const qe=Ge.target;(J==null?void 0:J.contains(qe))&&Ie(Ge,he)};return document.addEventListener("wheel",et,{passive:!1}),()=>document.removeEventListener("wheel",et,{passive:!1})},[ue,J,he,Ie]),Y.useEffect(Je,[a,Je]),gg(J,Ce),gg(ee.content,Ce),L.jsx(lre,{scope:i,scrollbar:J,hasThumb:d,onThumbChange:Io(_),onThumbPointerUp:Io(b),onThumbPositionChange:Je,onThumbPointerDown:Io(o),children:L.jsx(ln.div,{...G,ref:oe,style:{position:"absolute",...G.style},onPointerDown:Fr(e.onPointerDown,et=>{et.button===0&&(et.target.setPointerCapture(et.pointerId),X.current=J.getBoundingClientRect(),Q.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",ee.viewport&&(ee.viewport.style.scrollBehavior="auto"),Ze(et))}),onPointerMove:Fr(e.onPointerMove,Ze),onPointerUp:Fr(e.onPointerUp,et=>{const Ge=et.target;Ge.hasPointerCapture(et.pointerId)&&Ge.releasePointerCapture(et.pointerId),document.body.style.webkitUserSelect=Q.current,ee.viewport&&(ee.viewport.style.scrollBehavior=""),X.current=null})})})}),Jb="ScrollAreaThumb",$j=Y.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Uj(Jb,e.__scopeScrollArea);return L.jsx(Ra,{present:i||d.hasThumb,children:L.jsx(cre,{ref:t,...a})})}),cre=Y.forwardRef((e,t)=>{const{__scopeScrollArea:i,style:a,...d}=e,_=Da(Jb,i),b=Uj(Jb,i),{onThumbPositionChange:o}=b,k=Qn(t,F=>b.onThumbChange(F)),O=Y.useRef(),z=Xw(()=>{O.current&&(O.current(),O.current=void 0)},100);return Y.useEffect(()=>{const F=_.viewport;if(F){const G=()=>{if(z(),!O.current){const ee=hre(F,o);O.current=ee,o()}};return o(),F.addEventListener("scroll",G),()=>F.removeEventListener("scroll",G)}},[_.viewport,z,o]),L.jsx(ln.div,{"data-state":b.hasThumb?"visible":"hidden",...d,ref:k,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:Fr(e.onPointerDownCapture,F=>{const ee=F.target.getBoundingClientRect(),J=F.clientX-ee.left,te=F.clientY-ee.top;b.onThumbPointerDown({x:J,y:te})}),onPointerUp:Fr(e.onPointerUp,b.onThumbPointerUp)})});$j.displayName=Jb;var uP="ScrollAreaCorner",Gj=Y.forwardRef((e,t)=>{const i=Da(uP,e.__scopeScrollArea),a=!!(i.scrollbarX&&i.scrollbarY);return i.type!=="scroll"&&a?L.jsx(ure,{...e,ref:t}):null});Gj.displayName=uP;var ure=Y.forwardRef((e,t)=>{const{__scopeScrollArea:i,...a}=e,d=Da(uP,i),[_,b]=Y.useState(0),[o,k]=Y.useState(0),O=!!(_&&o);return gg(d.scrollbarX,()=>{var F;const z=((F=d.scrollbarX)==null?void 0:F.offsetHeight)||0;d.onCornerHeightChange(z),k(z)}),gg(d.scrollbarY,()=>{var F;const z=((F=d.scrollbarY)==null?void 0:F.offsetWidth)||0;d.onCornerWidthChange(z),b(z)}),O?L.jsx(ln.div,{...a,ref:t,style:{width:_,height:o,position:"absolute",right:d.dir==="ltr"?0:void 0,left:d.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Qb(e){return e?parseInt(e,10):0}function Hj(e,t){const i=e/t;return isNaN(i)?0:i}function Yw(e){const t=Hj(e.viewport,e.content),i=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-i)*t;return Math.max(a,18)}function dre(e,t,i,a="ltr"){const d=Yw(i),_=d/2,b=t||_,o=d-b,k=i.scrollbar.paddingStart+b,O=i.scrollbar.size-i.scrollbar.paddingEnd-o,z=i.content-i.viewport,F=a==="ltr"?[0,z]:[z*-1,0];return qj([k,O],F)(e)}function M4(e,t,i="ltr"){const a=Yw(t),d=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,_=t.scrollbar.size-d,b=t.content-t.viewport,o=_-a,k=i==="ltr"?[0,b]:[b*-1,0],O=BC(e,k);return qj([0,b],[0,o])(O)}function qj(e,t){return i=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const a=(t[1]-t[0])/(e[1]-e[0]);return t[0]+a*(i-e[0])}}function Wj(e,t){return e>0&&e<t}var hre=(e,t=()=>{})=>{let i={left:e.scrollLeft,top:e.scrollTop},a=0;return function d(){const _={left:e.scrollLeft,top:e.scrollTop},b=i.left!==_.left,o=i.top!==_.top;(b||o)&&t(),i=_,a=window.requestAnimationFrame(d)}(),()=>window.cancelAnimationFrame(a)};function Xw(e,t){const i=Io(e),a=Y.useRef(0);return Y.useEffect(()=>()=>window.clearTimeout(a.current),[]),Y.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(i,t)},[i,t])}function gg(e,t){const i=Io(t);Do(()=>{let a=0;if(e){const d=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(i)});return d.observe(e),()=>{window.cancelAnimationFrame(a),d.unobserve(e)}}},[e,i])}function fre(e,t){const{asChild:i,children:a}=e;if(!i)return typeof t=="function"?t(a):t;const d=Y.Children.only(a);return Y.cloneElement(d,{children:typeof t=="function"?t(d.props.children):t})}var Zj=Nj,pre=jj,mre=Gj;const Kw=Y.forwardRef(({className:e,children:t,...i},a)=>L.jsxs(Zj,{ref:a,className:_r("relative overflow-hidden",e),...i,children:[L.jsx(pre,{className:"h-full w-full rounded-[inherit]",children:t}),L.jsx(Yj,{}),L.jsx(mre,{})]}));Kw.displayName=Zj.displayName;const Yj=Y.forwardRef(({className:e,orientation:t="vertical",...i},a)=>L.jsx(lP,{ref:a,orientation:t,className:_r("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...i,children:L.jsx($j,{className:"relative flex-1 rounded-full bg-border"})}));Yj.displayName=lP.displayName;function gre(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}const Xj=Fe.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),Lg=()=>{const e=Fe.useContext(Xj);if(!e)throw new Error("useDrawerContext must be used within a Drawer.Root");return e};gre(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}`);const _re=24,yre=typeof window<"u"?Y.useLayoutEffect:Y.useEffect;function P4(...e){return(...t)=>{for(let i of e)typeof i=="function"&&i(...t)}}function vre(){return dP(/^Mac/)}function xre(){return dP(/^iPhone/)}function A4(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function bre(){return dP(/^iPad/)||vre()&&navigator.maxTouchPoints>1}function Kj(){return xre()||bre()}function dP(e){return typeof window<"u"&&window.navigator!=null?e.test(window.navigator.platform):void 0}const nE=typeof document<"u"&&window.visualViewport;function I4(e){let t=window.getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowX+t.overflowY)}function Jj(e){for(I4(e)&&(e=e.parentElement);e&&!I4(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement}const wre=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let F1=0,iE;function Sre(e={}){let{isDisabled:t}=e;yre(()=>{if(!t)return F1++,F1===1&&Kj()&&(iE=Tre()),()=>{F1--,F1===0&&(iE==null||iE())}},[t])}function Tre(){let e,t=0,i=F=>{e=Jj(F.target),!(e===document.documentElement&&e===document.body)&&(t=F.changedTouches[0].pageY)},a=F=>{if(!e||e===document.documentElement||e===document.body){F.preventDefault();return}let G=F.changedTouches[0].pageY,ee=e.scrollTop,J=e.scrollHeight-e.clientHeight;J!==0&&((ee<=0&&G>t||ee>=J&&G<t)&&F.preventDefault(),t=G)},d=F=>{let G=F.target;KC(G)&&G!==document.activeElement&&(F.preventDefault(),G.style.transform="translateY(-2000px)",G.focus(),requestAnimationFrame(()=>{G.style.transform=""}))},_=F=>{let G=F.target;KC(G)&&(G.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{G.style.transform="",nE&&(nE.height<window.innerHeight?requestAnimationFrame(()=>{k4(G)}):nE.addEventListener("resize",()=>k4(G),{once:!0}))}))},b=()=>{window.scrollTo(0,0)},o=window.pageXOffset,k=window.pageYOffset,O=P4(Ere(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let z=P4(Dy(document,"touchstart",i,{passive:!1,capture:!0}),Dy(document,"touchmove",a,{passive:!1,capture:!0}),Dy(document,"touchend",d,{passive:!1,capture:!0}),Dy(document,"focus",_,!0),Dy(window,"scroll",b));return()=>{O(),z(),window.scrollTo(o,k)}}function Ere(e,t,i){let a=e.style[t];return e.style[t]=i,()=>{e.style[t]=a}}function Dy(e,t,i,a){return e.addEventListener(t,i,a),()=>{e.removeEventListener(t,i,a)}}function k4(e){let t=document.scrollingElement||document.documentElement;for(;e&&e!==t;){let i=Jj(e);if(i!==document.documentElement&&i!==document.body&&i!==e){let a=i.getBoundingClientRect().top,d=e.getBoundingClientRect().top,_=e.getBoundingClientRect().bottom;const b=i.getBoundingClientRect().bottom+_re;_>b&&(i.scrollTop+=d-a)}e=i.parentElement}}function KC(e){return e instanceof HTMLInputElement&&!wre.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}function Cre(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function Mre(...e){return t=>e.forEach(i=>Cre(i,t))}function Qj(...e){return Y.useCallback(Mre(...e),e)}const eB=new WeakMap;function yo(e,t,i=!1){if(!e||!(e instanceof HTMLElement))return;let a={};Object.entries(t).forEach(([d,_])=>{if(d.startsWith("--")){e.style.setProperty(d,_);return}a[d]=e.style[d],e.style[d]=_}),!i&&eB.set(e,a)}function Pre(e,t){if(!e||!(e instanceof HTMLElement))return;let i=eB.get(e);i&&(e.style[t]=i[t])}const vo=e=>{switch(e){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return e}};function j1(e,t){if(!e)return null;const i=window.getComputedStyle(e),a=i.transform||i.webkitTransform||i.mozTransform;let d=a.match(/^matrix3d\((.+)\)$/);return d?parseFloat(d[1].split(", ")[vo(t)?13:12]):(d=a.match(/^matrix\((.+)\)$/),d?parseFloat(d[1].split(", ")[vo(t)?5:4]):null)}function Are(e){return 8*(Math.log(e+1)-2)}function oE(e,t){if(!e)return()=>{};const i=e.style.cssText;return Object.assign(e.style,t),()=>{e.style.cssText=i}}function Ire(...e){return(...t)=>{for(const i of e)typeof i=="function"&&i(...t)}}const Oi={DURATION:.5,EASE:[.32,.72,0,1]},tB=.4,kre=.25,Rre=100,rB=8,Fh=16,JC=26,sE="vaul-dragging";function nB(e){const t=Fe.useRef(e);return Fe.useEffect(()=>{t.current=e}),Fe.useMemo(()=>(...i)=>t.current==null?void 0:t.current.call(t,...i),[])}function Dre({defaultProp:e,onChange:t}){const i=Fe.useState(e),[a]=i,d=Fe.useRef(a),_=nB(t);return Fe.useEffect(()=>{d.current!==a&&(_(a),d.current=a)},[a,d,_]),i}function iB({prop:e,defaultProp:t,onChange:i=()=>{}}){const[a,d]=Dre({defaultProp:t,onChange:i}),_=e!==void 0,b=_?e:a,o=nB(i),k=Fe.useCallback(O=>{if(_){const F=typeof O=="function"?O(e):O;F!==e&&o(F)}else d(O)},[_,e,d,o]);return[b,k]}function Lre({activeSnapPointProp:e,setActiveSnapPointProp:t,snapPoints:i,drawerRef:a,overlayRef:d,fadeFromIndex:_,onSnapPointChange:b,direction:o="bottom",container:k,snapToSequentialPoint:O}){const[z,F]=iB({prop:e,defaultProp:i==null?void 0:i[0],onChange:t}),[G,ee]=Fe.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);Fe.useEffect(()=>{function Ce(){ee({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",Ce),()=>window.removeEventListener("resize",Ce)},[]);const J=Fe.useMemo(()=>z===(i==null?void 0:i[i.length-1])||null,[i,z]),te=Fe.useMemo(()=>i==null?void 0:i.findIndex(Ce=>Ce===z),[i,z]),oe=i&&i.length>0&&(_||_===0)&&!Number.isNaN(_)&&i[_]===z||!i,X=Fe.useMemo(()=>{const Ce=k?{width:k.getBoundingClientRect().width,height:k.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var Ze;return(Ze=i==null?void 0:i.map(et=>{const Ge=typeof et=="string";let qe=0;if(Ge&&(qe=parseInt(et,10)),vo(o)){const Rt=Ge?qe:G?et*Ce.height:0;return G?o==="bottom"?Ce.height-Rt:-Ce.height+Rt:Rt}const _t=Ge?qe:G?et*Ce.width:0;return G?o==="right"?Ce.width-_t:-Ce.width+_t:_t}))!=null?Ze:[]},[i,G,k]),Q=Fe.useMemo(()=>te!==null?X==null?void 0:X[te]:null,[X,te]),ue=Fe.useCallback(Ce=>{var Ze;const et=(Ze=X==null?void 0:X.findIndex(Ge=>Ge===Ce))!=null?Ze:null;b(et),yo(a.current,{transition:`transform ${Oi.DURATION}s cubic-bezier(${Oi.EASE.join(",")})`,transform:vo(o)?`translate3d(0, ${Ce}px, 0)`:`translate3d(${Ce}px, 0, 0)`}),X&&et!==X.length-1&&et!==_&&et<_?yo(d.current,{transition:`opacity ${Oi.DURATION}s cubic-bezier(${Oi.EASE.join(",")})`,opacity:"0"}):yo(d.current,{transition:`opacity ${Oi.DURATION}s cubic-bezier(${Oi.EASE.join(",")})`,opacity:"1"}),F(i==null?void 0:i[Math.max(et,0)])},[a.current,i,X,_,d,F]);Fe.useEffect(()=>{if(z||e){var Ce;const Ze=(Ce=i==null?void 0:i.findIndex(et=>et===e||et===z))!=null?Ce:-1;X&&Ze!==-1&&typeof X[Ze]=="number"&&ue(X[Ze])}},[z,e,i,X,ue]);function he({draggedDistance:Ce,closeDrawer:Ze,velocity:et,dismissible:Ge}){if(_===void 0)return;const qe=o==="bottom"||o==="right"?(Q??0)-Ce:(Q??0)+Ce,_t=te===_-1,Rt=te===0,Wt=Ce>0;if(_t&&yo(d.current,{transition:`opacity ${Oi.DURATION}s cubic-bezier(${Oi.EASE.join(",")})`}),!O&&et>2&&!Wt){Ge?Ze():ue(X[0]);return}if(!O&&et>2&&Wt&&X&&i){ue(X[i.length-1]);return}const wt=X==null?void 0:X.reduce((Ct,st)=>typeof Ct!="number"||typeof st!="number"?Ct:Math.abs(st-qe)<Math.abs(Ct-qe)?st:Ct),jt=vo(o)?window.innerHeight:window.innerWidth;if(et>tB&&Math.abs(Ce)<jt*.4){const Ct=Wt?1:-1;if(Ct>0&&J){ue(X[i.length-1]);return}if(Rt&&Ct<0&&Ge&&Ze(),te===null)return;ue(X[te+Ct]);return}ue(wt)}function Ie({draggedDistance:Ce}){if(Q===null)return;const Ze=o==="bottom"||o==="right"?Q-Ce:Q+Ce;(o==="bottom"||o==="right")&&Ze<X[X.length-1]||(o==="top"||o==="left")&&Ze>X[X.length-1]||yo(a.current,{transform:vo(o)?`translate3d(0, ${Ze}px, 0)`:`translate3d(${Ze}px, 0, 0)`})}function Je(Ce,Ze){if(!i||typeof te!="number"||!X||_===void 0)return null;const et=te===_-1;if(te>=_&&Ze)return 0;if(et&&!Ze)return 1;if(!oe&&!et)return null;const qe=et?te+1:te-1,_t=et?X[qe]-X[qe-1]:X[qe+1]-X[qe],Rt=Ce/Math.abs(_t);return et?1-Rt:Rt}return{isLastSnapPoint:J,activeSnapPoint:z,shouldFade:oe,getPercentageDragged:Je,setActiveSnapPoint:F,activeSnapPointIndex:te,onRelease:he,onDrag:Ie,snapPointsOffset:X}}const Ore=()=>()=>{};function zre(){const{direction:e,isOpen:t,shouldScaleBackground:i,setBackgroundColorOnScale:a,noBodyStyles:d}=Lg(),_=Fe.useRef(null),b=Y.useMemo(()=>document.body.style.backgroundColor,[]);function o(){return(window.innerWidth-JC)/window.innerWidth}Fe.useEffect(()=>{if(t&&i){_.current&&clearTimeout(_.current);const k=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!k)return;Ire(a&&!d?oE(document.body,{background:"black"}):Ore,oE(k,{transformOrigin:vo(e)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Oi.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Oi.EASE.join(",")})`}));const O=oE(k,{borderRadius:`${rB}px`,overflow:"hidden",...vo(e)?{transform:`scale(${o()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${o()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{O(),_.current=window.setTimeout(()=>{b?document.body.style.background=b:document.body.style.removeProperty("background")},Oi.DURATION*1e3)}}},[t,i,b])}let Ly=null;function Nre({isOpen:e,modal:t,nested:i,hasBeenOpened:a,preventScrollRestoration:d,noBodyStyles:_}){const[b,o]=Fe.useState(()=>typeof window<"u"?window.location.href:""),k=Fe.useRef(0),O=Fe.useCallback(()=>{if(A4()&&Ly===null&&e&&!_){Ly={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:F,innerHeight:G}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-k.current}px`,left:`${-F}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const ee=G-window.innerHeight;ee&&k.current>=G&&(document.body.style.top=`${-(k.current+ee)}px`)}),300)}},[e]),z=Fe.useCallback(()=>{if(A4()&&Ly!==null&&!_){const F=-parseInt(document.body.style.top,10),G=-parseInt(document.body.style.left,10);Object.assign(document.body.style,Ly),window.requestAnimationFrame(()=>{if(d&&b!==window.location.href){o(window.location.href);return}window.scrollTo(G,F)}),Ly=null}},[b]);return Fe.useEffect(()=>{function F(){k.current=window.scrollY}return F(),window.addEventListener("scroll",F),()=>{window.removeEventListener("scroll",F)}},[]),Fe.useEffect(()=>{i||!a||(e?(!window.matchMedia("(display-mode: standalone)").matches&&O(),t||window.setTimeout(()=>{z()},500)):z())},[e,a,b,t,i,O,z]),{restorePositionSetting:z}}function oB({open:e,onOpenChange:t,children:i,onDrag:a,onRelease:d,snapPoints:_,shouldScaleBackground:b=!1,setBackgroundColorOnScale:o=!0,closeThreshold:k=kre,scrollLockTimeout:O=Rre,dismissible:z=!0,handleOnly:F=!1,fadeFromIndex:G=_&&_.length-1,activeSnapPoint:ee,setActiveSnapPoint:J,fixed:te,modal:oe=!0,onClose:X,nested:Q,noBodyStyles:ue,direction:he="bottom",defaultOpen:Ie=!1,disablePreventScroll:Je=!0,snapToSequentialPoint:Ce=!1,preventScrollRestoration:Ze=!1,repositionInputs:et=!0,onAnimationEnd:Ge,container:qe,autoFocus:_t=!1}){var Rt,Wt;const[wt=!1,jt]=iB({defaultProp:Ie,prop:e,onChange:Gt=>{t==null||t(Gt),!Gt&&!Q&&$n(),setTimeout(()=>{Ge==null||Ge(Gt)},Oi.DURATION*1e3),Gt&&!oe&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),Gt||(document.body.style.pointerEvents="auto")}}),[Ct,st]=Fe.useState(!1),[yt,ir]=Fe.useState(!1),[yr,Wr]=Fe.useState(!1),rr=Fe.useRef(null),dn=Fe.useRef(null),Dn=Fe.useRef(null),sn=Fe.useRef(null),cr=Fe.useRef(null),Lr=Fe.useRef(!1),cn=Fe.useRef(null),Me=Fe.useRef(0),fr=Fe.useRef(!1),Yt=Fe.useRef(0),tr=Fe.useRef(null),vt=Fe.useRef(((Rt=tr.current)==null?void 0:Rt.getBoundingClientRect().height)||0),Mn=Fe.useRef(((Wt=tr.current)==null?void 0:Wt.getBoundingClientRect().width)||0),hn=Fe.useRef(0),ei=Fe.useCallback(Gt=>{_&&Gt===Kt.length-1&&(dn.current=new Date)},[]),{activeSnapPoint:je,activeSnapPointIndex:dt,setActiveSnapPoint:St,onRelease:or,snapPointsOffset:Kt,onDrag:Xt,shouldFade:Ot,getPercentageDragged:Ur}=Lre({snapPoints:_,activeSnapPointProp:ee,setActiveSnapPointProp:J,drawerRef:tr,fadeFromIndex:G,overlayRef:rr,onSnapPointChange:ei,direction:he,container:qe,snapToSequentialPoint:Ce});Sre({isDisabled:!wt||yt||!oe||yr||!Ct||!et||!Je});const{restorePositionSetting:$n}=Nre({isOpen:wt,modal:oe,nested:Q,hasBeenOpened:Ct,preventScrollRestoration:Ze,noBodyStyles:ue});function Ln(){return(window.innerWidth-JC)/window.innerWidth}function Xn(Gt){var un,Fn;!z&&!_||tr.current&&!tr.current.contains(Gt.target)||(vt.current=((un=tr.current)==null?void 0:un.getBoundingClientRect().height)||0,Mn.current=((Fn=tr.current)==null?void 0:Fn.getBoundingClientRect().width)||0,ir(!0),Dn.current=new Date,Kj()&&window.addEventListener("touchend",()=>Lr.current=!1,{once:!0}),Gt.target.setPointerCapture(Gt.pointerId),Me.current=vo(he)?Gt.pageY:Gt.pageX)}function Mi(Gt,un){var Fn,nn;let mn=Gt;const Vi=(Fn=window.getSelection())==null?void 0:Fn.toString(),fi=tr.current?j1(tr.current,he):null,Pi=new Date;if(mn.hasAttribute("data-vaul-no-drag")||mn.closest("[data-vaul-no-drag]"))return!1;if(he==="right"||he==="left")return!0;if(dn.current&&Pi.getTime()-dn.current.getTime()<500)return!1;if(fi!==null&&(he==="bottom"?fi>0:fi<0))return!0;if(Vi&&Vi.length>0)return!1;if(Pi.getTime()-((nn=cr.current)==null?void 0:nn.getTime())<O&&fi===0||un)return cr.current=Pi,!1;for(;mn;){if(mn.scrollHeight>mn.clientHeight){if(mn.scrollTop!==0)return cr.current=new Date,!1;if(mn.getAttribute("role")==="dialog")return!0}mn=mn.parentNode}return!0}function Ui(Gt){if(tr.current&&yt){const un=he==="bottom"||he==="right"?1:-1,Fn=(Me.current-(vo(he)?Gt.pageY:Gt.pageX))*un,nn=Fn>0,mn=_&&!z&&!nn;if(mn&&dt===0)return;const Vi=Math.abs(Fn),fi=document.querySelector("[data-vaul-drawer-wrapper]"),Pi=he==="bottom"||he==="top"?vt.current:Mn.current;let co=Vi/Pi;const rt=Ur(Vi,nn);if(rt!==null&&(co=rt),mn&&co>=1||!Lr.current&&!Mi(Gt.target,nn))return;if(tr.current.classList.add(sE),Lr.current=!0,yo(tr.current,{transition:"none"}),yo(rr.current,{transition:"none"}),_&&Xt({draggedDistance:Fn}),nn&&!_){const de=Are(Fn),xe=Math.min(de*-1,0)*un;yo(tr.current,{transform:vo(he)?`translate3d(0, ${xe}px, 0)`:`translate3d(${xe}px, 0, 0)`});return}const ae=1-co;if((Ot||G&&dt===G-1)&&(a==null||a(Gt,co),yo(rr.current,{opacity:`${ae}`,transition:"none"},!0)),fi&&rr.current&&b){const de=Math.min(Ln()+co*(1-Ln()),1),xe=8-co*8,De=Math.max(0,14-co*14);yo(fi,{borderRadius:`${xe}px`,transform:vo(he)?`scale(${de}) translate3d(0, ${De}px, 0)`:`scale(${de}) translate3d(${De}px, 0, 0)`,transition:"none"},!0)}if(!_){const de=Vi*un;yo(tr.current,{transform:vo(he)?`translate3d(0, ${de}px, 0)`:`translate3d(${de}px, 0, 0)`})}}}Fe.useEffect(()=>{var Gt;function un(){if(!tr.current||!et)return;const Fn=document.activeElement;if(KC(Fn)||fr.current){var nn;const mn=((nn=window.visualViewport)==null?void 0:nn.height)||0,Vi=window.innerHeight;let fi=Vi-mn;const Pi=tr.current.getBoundingClientRect().height||0,co=Pi>Vi*.8;hn.current||(hn.current=Pi);const rt=tr.current.getBoundingClientRect().top;if(Math.abs(Yt.current-fi)>60&&(fr.current=!fr.current),_&&_.length>0&&Kt&&dt){const ae=Kt[dt]||0;fi+=ae}if(Yt.current=fi,Pi>mn||fr.current){const ae=tr.current.getBoundingClientRect().height;let de=ae;ae>mn&&(de=mn-(co?rt:JC)),te?tr.current.style.height=`${ae-Math.max(fi,0)}px`:tr.current.style.height=`${Math.max(de,mn-rt)}px`}else tr.current.style.height=`${hn.current}px`;_&&_.length>0&&!fr.current?tr.current.style.bottom="0px":tr.current.style.bottom=`${Math.max(fi,0)}px`}}return(Gt=window.visualViewport)==null||Gt.addEventListener("resize",un),()=>{var Fn;return(Fn=window.visualViewport)==null?void 0:Fn.removeEventListener("resize",un)}},[dt,_,Kt]);function Zi(Gt){Yi(),X==null||X(),Gt||jt(!1),setTimeout(()=>{_&&St(_[0])},Oi.DURATION*1e3)}function Lo(){if(!tr.current)return;const Gt=document.querySelector("[data-vaul-drawer-wrapper]"),un=j1(tr.current,he);yo(tr.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Oi.DURATION}s cubic-bezier(${Oi.EASE.join(",")})`}),yo(rr.current,{transition:`opacity ${Oi.DURATION}s cubic-bezier(${Oi.EASE.join(",")})`,opacity:"1"}),b&&un&&un>0&&wt&&yo(Gt,{borderRadius:`${rB}px`,overflow:"hidden",...vo(he)?{transform:`scale(${Ln()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Ln()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Oi.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Oi.EASE.join(",")})`},!0)}function Yi(){!yt||!tr.current||(tr.current.classList.remove(sE),Lr.current=!1,ir(!1),sn.current=new Date)}function Oo(Gt){if(!yt||!tr.current)return;tr.current.classList.remove(sE),Lr.current=!1,ir(!1),sn.current=new Date;const un=j1(tr.current,he);if(!Mi(Gt.target,!1)||!un||Number.isNaN(un)||Dn.current===null)return;const Fn=sn.current.getTime()-Dn.current.getTime(),nn=Me.current-(vo(he)?Gt.pageY:Gt.pageX),mn=Math.abs(nn)/Fn;if(mn>.05&&(Wr(!0),setTimeout(()=>{Wr(!1)},200)),_){or({draggedDistance:nn*(he==="bottom"||he==="right"?1:-1),closeDrawer:Zi,velocity:mn,dismissible:z}),d==null||d(Gt,!0);return}if(he==="bottom"||he==="right"?nn>0:nn<0){Lo(),d==null||d(Gt,!0);return}if(mn>tB){Zi(),d==null||d(Gt,!1);return}var Vi;const fi=Math.min((Vi=tr.current.getBoundingClientRect().height)!=null?Vi:0,window.innerHeight);var Pi;const co=Math.min((Pi=tr.current.getBoundingClientRect().width)!=null?Pi:0,window.innerWidth),rt=he==="left"||he==="right";if(Math.abs(un)>=(rt?co:fi)*k){Zi(),d==null||d(Gt,!1);return}d==null||d(Gt,!0),Lo()}Fe.useEffect(()=>(wt&&(yo(document.documentElement,{scrollBehavior:"auto"}),dn.current=new Date),()=>{Pre(document.documentElement,"scrollBehavior")}),[wt]);function ss(Gt){const un=Gt?(window.innerWidth-Fh)/window.innerWidth:1,Fn=Gt?-Fh:0;cn.current&&window.clearTimeout(cn.current),yo(tr.current,{transition:`transform ${Oi.DURATION}s cubic-bezier(${Oi.EASE.join(",")})`,transform:`scale(${un}) translate3d(0, ${Fn}px, 0)`}),!Gt&&tr.current&&(cn.current=setTimeout(()=>{const nn=j1(tr.current,he);yo(tr.current,{transition:"none",transform:vo(he)?`translate3d(0, ${nn}px, 0)`:`translate3d(${nn}px, 0, 0)`})},500))}function To(Gt,un){if(un<0)return;const Fn=(window.innerWidth-Fh)/window.innerWidth,nn=Fn+un*(1-Fn),mn=-Fh+un*Fh;yo(tr.current,{transform:vo(he)?`scale(${nn}) translate3d(0, ${mn}px, 0)`:`scale(${nn}) translate3d(${mn}px, 0, 0)`,transition:"none"})}function La(Gt,un){const Fn=vo(he)?window.innerHeight:window.innerWidth,nn=un?(Fn-Fh)/Fn:1,mn=un?-Fh:0;un&&yo(tr.current,{transition:`transform ${Oi.DURATION}s cubic-bezier(${Oi.EASE.join(",")})`,transform:vo(he)?`scale(${nn}) translate3d(0, ${mn}px, 0)`:`scale(${nn}) translate3d(${mn}px, 0, 0)`})}return Fe.createElement(gM,{defaultOpen:Ie,onOpenChange:Gt=>{!z&&!Gt||(Gt?st(!0):Zi(!0),jt(Gt))},open:wt},Fe.createElement(Xj.Provider,{value:{activeSnapPoint:je,snapPoints:_,setActiveSnapPoint:St,drawerRef:tr,overlayRef:rr,onOpenChange:t,onPress:Xn,onRelease:Oo,onDrag:Ui,dismissible:z,handleOnly:F,isOpen:wt,isDragging:yt,shouldFade:Ot,closeDrawer:Zi,onNestedDrag:To,onNestedOpenChange:ss,onNestedRelease:La,keyboardIsOpen:fr,modal:oe,snapPointsOffset:Kt,direction:he,shouldScaleBackground:b,setBackgroundColorOnScale:o,noBodyStyles:ue,container:qe,autoFocus:_t}},i))}const sB=Fe.forwardRef(function({...e},t){const{overlayRef:i,snapPoints:a,onRelease:d,shouldFade:_,isOpen:b,modal:o}=Lg(),k=Qj(t,i),O=a&&a.length>0;return o?Fe.createElement(J0,{onMouseUp:d,ref:k,"data-vaul-overlay":"","data-vaul-snap-points":b&&O?"true":"false","data-vaul-snap-points-overlay":b&&_?"true":"false",...e}):(typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});sB.displayName="Drawer.Overlay";const aB=Fe.forwardRef(function({onPointerDownOutside:e,style:t,onOpenAutoFocus:i,...a},d){const{drawerRef:_,onPress:b,onRelease:o,onDrag:k,keyboardIsOpen:O,snapPointsOffset:z,modal:F,isOpen:G,direction:ee,snapPoints:J,container:te,handleOnly:oe,autoFocus:X}=Lg(),[Q,ue]=Fe.useState(!1),he=Qj(d,_),Ie=Fe.useRef(null),Je=Fe.useRef(null),Ce=Fe.useRef(!1),Ze=J&&J.length>0;zre();const et=(qe,_t,Rt=0)=>{if(Ce.current)return!0;const Wt=Math.abs(qe.y),wt=Math.abs(qe.x),jt=wt>Wt,Ct=["bottom","right"].includes(_t)?1:-1;if(_t==="left"||_t==="right"){if(!(qe.x*Ct<0)&&wt>=0&&wt<=Rt)return jt}else if(!(qe.y*Ct<0)&&Wt>=0&&Wt<=Rt)return!jt;return Ce.current=!0,!0};Fe.useEffect(()=>{Ze&&window.requestAnimationFrame(()=>{ue(!0)})},[]);function Ge(qe){Ie.current=null,Ce.current=!1,o(qe)}return Fe.createElement(Q0,{"data-vaul-drawer-direction":ee,"data-vaul-drawer":"","data-vaul-delayed-snap-points":Q?"true":"false","data-vaul-snap-points":G&&Ze?"true":"false","data-vaul-custom-container":te?"true":"false",...a,ref:he,style:z&&z.length>0?{"--snap-point-height":`${z[0]}px`,...t}:t,onPointerDown:qe=>{oe||(a.onPointerDown==null||a.onPointerDown.call(a,qe),Ie.current={x:qe.pageX,y:qe.pageY},b(qe))},onOpenAutoFocus:qe=>{i==null||i(qe),X||qe.preventDefault()},onPointerDownOutside:qe=>{if(e==null||e(qe),!F||qe.defaultPrevented){qe.preventDefault();return}O.current&&(O.current=!1)},onFocusOutside:qe=>{if(!F){qe.preventDefault();return}},onPointerMove:qe=>{if(Je.current=qe,oe||(a.onPointerMove==null||a.onPointerMove.call(a,qe),!Ie.current))return;const _t=qe.pageY-Ie.current.y,Rt=qe.pageX-Ie.current.x,Wt=qe.pointerType==="touch"?10:2;et({x:Rt,y:_t},ee,Wt)?k(qe):(Math.abs(Rt)>Wt||Math.abs(_t)>Wt)&&(Ie.current=null)},onPointerUp:qe=>{a.onPointerUp==null||a.onPointerUp.call(a,qe),Ie.current=null,Ce.current=!1,o(qe)},onPointerOut:qe=>{a.onPointerOut==null||a.onPointerOut.call(a,qe),Ge(Je.current)},onContextMenu:qe=>{a.onContextMenu==null||a.onContextMenu.call(a,qe),Ge(Je.current)}})});aB.displayName="Drawer.Content";const Fre=250,jre=120,lB=Fe.forwardRef(function({preventCycle:e=!1,children:t,...i},a){const{closeDrawer:d,isDragging:_,snapPoints:b,activeSnapPoint:o,setActiveSnapPoint:k,dismissible:O,handleOnly:z,isOpen:F,onPress:G,onDrag:ee}=Lg(),J=Fe.useRef(null),te=Fe.useRef(!1);function oe(){if(te.current){ue();return}window.setTimeout(()=>{X()},jre)}function X(){if(_||e||te.current){ue();return}if(ue(),(!b||b.length===0)&&O){d();return}if(o===b[b.length-1]&&O){d();return}const Ie=b.findIndex(Ce=>Ce===o);if(Ie===-1)return;const Je=b[Ie+1];k(Je)}function Q(){J.current=window.setTimeout(()=>{te.current=!0},Fre)}function ue(){window.clearTimeout(J.current),te.current=!1}return Fe.createElement("div",{onClick:oe,onPointerCancel:ue,onPointerDown:he=>{z&&G(he),Q()},onPointerMove:he=>{z&&ee(he)},ref:a,"data-vaul-drawer-visible":F?"true":"false","data-vaul-handle":"","aria-hidden":"true",...i},Fe.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},t))});lB.displayName="Drawer.Handle";function Bre({onDrag:e,onOpenChange:t,...i}){const{onNestedDrag:a,onNestedOpenChange:d,onNestedRelease:_}=Lg();if(!a)throw new Error("Drawer.NestedRoot must be placed in another drawer");return Fe.createElement(oB,{nested:!0,onClose:()=>{d(!1)},onDrag:(b,o)=>{a(b,o),e==null||e(b,o)},onOpenChange:b=>{b&&d(b)},onRelease:_,...i})}function Ure(e){const t=Lg(),{container:i=t.container,...a}=e;return Fe.createElement(yM,{container:i,...a})}const lu={Root:oB,NestedRoot:Bre,Content:aB,Overlay:sB,Trigger:_M,Portal:Ure,Handle:lB,Close:vM,Title:ev,Description:tv},cB=({shouldScaleBackground:e=!0,...t})=>L.jsx(lu.Root,{shouldScaleBackground:e,...t});cB.displayName="Drawer";const Vre=lu.Portal,uB=Y.forwardRef(({className:e,...t},i)=>L.jsx(lu.Overlay,{ref:i,className:_r("fixed inset-0 z-50 bg-black/80",e),...t}));uB.displayName=lu.Overlay.displayName;const dB=Y.forwardRef(({className:e,children:t,...i},a)=>L.jsxs(Vre,{children:[L.jsx(uB,{}),L.jsxs(lu.Content,{ref:a,className:_r("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",e),...i,children:[L.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),t]})]}));dB.displayName="DrawerContent";const hB=Y.forwardRef(({className:e,...t},i)=>L.jsx(lu.Title,{ref:i,className:_r("text-lg font-semibold leading-none tracking-tight",e),...t}));hB.displayName=lu.Title.displayName;const $re=Y.forwardRef(({className:e,...t},i)=>L.jsx(lu.Description,{ref:i,className:_r("text-sm text-muted-foreground",e),...t}));$re.displayName=lu.Description.displayName;const Gre=({receiverName:e,receiverAvatar:t,onClose:i,onPrevious:a,onNext:d})=>L.jsxs("div",{className:"flex items-center justify-between p-4",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx(on,{variant:"ghost",size:"icon",onClick:i,children:L.jsx(iM,{className:"h-4 w-4"})}),L.jsxs("div",{className:"flex items-center gap-3",children:[L.jsx(hB,{children:e}),L.jsxs(R0,{className:"h-8 w-8",children:[L.jsx($w,{src:t||void 0,alt:e}),L.jsx(D0,{children:e.split(" ").map(_=>_[0]).join("")})]})]})]}),L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx(on,{variant:"ghost",size:"icon",onClick:a,children:L.jsx(Wz,{className:"h-4 w-4"})}),L.jsx(on,{variant:"ghost",size:"icon",onClick:d,children:L.jsx(Zz,{className:"h-4 w-4"})})]})]}),Jw=Y.forwardRef(({className:e,...t},i)=>L.jsx("textarea",{className:_r("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...t}));Jw.displayName="Textarea";const Hre=({newMessage:e,onChange:t,onSend:i,sending:a})=>L.jsx("div",{className:"p-4 border-t",children:L.jsxs("div",{className:"flex gap-2",children:[L.jsx(Jw,{value:e,onChange:d=>t(d.target.value),placeholder:"Type a message...",className:"resize-none"}),L.jsx(on,{onClick:i,disabled:a||!e.trim(),size:"icon",children:L.jsx(QG,{className:"h-4 w-4"})})]})}),qre=({messages:e,currentUserId:t})=>L.jsx(Kw,{className:"flex-1 p-4",children:L.jsx("div",{className:"space-y-4",children:e.map(i=>L.jsx("div",{className:_r("flex",i.sender_id===t?"justify-end":"justify-start"),children:L.jsx("div",{className:_r("rounded-lg px-4 py-2 max-w-[80%]",i.sender_id===t?"bg-primary text-primary-foreground":"bg-muted"),children:i.content})},i.id))})}),fB=({isOpen:e,onClose:t,receiverId:i,receiverName:a,carId:d})=>{const[_,b]=Y.useState([]),[o,k]=Y.useState(""),[O,z]=Y.useState(!1),[F,G]=Y.useState(null),[ee,J]=Y.useState(null),{toast:te}=Tl();Y.useEffect(()=>{if(!e)return;const X=async()=>{const{data:he}=await Qt.from("profiles").select("avatar_url").eq("id",i).single();if(he!=null&&he.avatar_url){const{data:Ie}=Qt.storage.from("avatars").getPublicUrl(he.avatar_url);G(Ie.publicUrl)}},Q=async()=>{const{data:{user:he}}=await Qt.auth.getUser();if(!he)return;J(he.id);const{data:Ie,error:Je}=await Qt.from("messages").select("*").or(`sender_id.eq.${he.id},receiver_id.eq.${he.id}`).order("created_at",{ascending:!0});if(Je){console.error("Error fetching messages:",Je);return}b(Ie||[])};X(),Q();const ue=Qt.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},he=>{console.log("New message received:",he),b(Ie=>[...Ie,he.new])}).subscribe();return()=>{Qt.removeChannel(ue)}},[e,i]);const oe=async()=>{if(o.trim()){z(!0);try{const{data:{user:X}}=await Qt.auth.getUser();if(!X){te({title:"Error",description:"You must be logged in to send messages",variant:"destructive"});return}const{error:Q}=await Qt.from("messages").insert({content:o.trim(),sender_id:X.id,receiver_id:i,related_car_id:d});if(Q)throw Q;k("")}catch(X){console.error("Error sending message:",X),te({title:"Error",description:"Could not send message. Please try again.",variant:"destructive"})}finally{z(!1)}}};return L.jsx(cB,{open:e,onOpenChange:t,children:L.jsxs(dB,{className:"h-[90%] flex flex-col",children:[L.jsx(Gre,{receiverName:a,receiverAvatar:F,onClose:t}),ee&&L.jsx(qre,{messages:_,currentUserId:ee}),L.jsx(Hre,{newMessage:o,onChange:k,onSend:oe,sending:O})]})})},Wre=()=>{const e=wg(),{data:t,isLoading:i}=Ro({queryKey:["messages"],queryFn:async()=>{console.log("Fetching messages");const{data:{user:d}}=await Qt.auth.getUser();if(!d)return[];const{data:_,error:b}=await Qt.from("messages").select(`
          id,
          content,
          created_at,
          sender_id,
          receiver_id,
          status,
          related_car_id,
          sender:profiles!messages_sender_id_fkey (
            id,
            full_name,
            avatar_url
          )
        `).eq("receiver_id",d.id).order("created_at",{ascending:!1});return b?(console.error("Error fetching messages:",b),[]):(console.log("Messages fetched:",_),_)},refetchInterval:5e3});return{messages:t,isLoading:i,markMessageAsRead:async d=>{const{data:{user:_}}=await Qt.auth.getUser();if(!_)return;const{error:b}=await Qt.from("messages").update({status:"read"}).eq("sender_id",d).eq("receiver_id",_.id).eq("status","sent");b?console.error("Error updating message status:",b):e.invalidateQueries({queryKey:["messages"]})}}};var Zre="Separator",R4="horizontal",Yre=["horizontal","vertical"],pB=Y.forwardRef((e,t)=>{const{decorative:i,orientation:a=R4,...d}=e,_=Xre(a)?a:R4,o=i?{role:"none"}:{"aria-orientation":_==="vertical"?_:void 0,role:"separator"};return L.jsx(ln.div,{"data-orientation":_,...o,...d,ref:t})});pB.displayName=Zre;function Xre(e){return Yre.includes(e)}var mB=pB;const gB=Y.forwardRef(({className:e,orientation:t="horizontal",decorative:i=!0,...a},d)=>L.jsx(mB,{ref:d,decorative:i,orientation:t,className:_r("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...a}));gB.displayName=mB.displayName;const Kre=({messages:e,onMessageClick:t})=>e!=null&&e.length?L.jsx(Kw,{className:"h-[300px] rounded-md border p-4",children:e.map(i=>{var a;return L.jsxs("div",{className:"mb-4 cursor-pointer hover:bg-muted p-2 rounded-md transition-colors",onClick:()=>{var d;return t(i.sender_id,((d=i.sender)==null?void 0:d.full_name)||null)},children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("span",{className:"font-medium",children:((a=i.sender)==null?void 0:a.full_name)||"Unknown User"}),L.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(i.created_at).toLocaleDateString()})]}),L.jsx("p",{className:"text-sm text-muted-foreground",children:i.content}),L.jsx(gB,{className:"my-2"})]},i.id)})}):L.jsx("p",{className:"text-center text-muted-foreground",children:"No messages yet"}),Jre=()=>{const e=$o(),[t,i]=Y.useState({isOpen:!1,senderId:"",senderName:""}),{messages:a,markMessageAsRead:d}=Wre(),_=(a==null?void 0:a.filter(O=>O.status==="sent").length)||0,{data:b}=Ro({queryKey:["notifications"],queryFn:async()=>{const{data:O,error:z}=await Qt.from("notifications").select("*").order("created_at",{ascending:!1});if(z)throw z;return O||[]}}),o=async(O,z)=>{await d(O),i({isOpen:!0,senderId:O,senderName:z||"Unknown User"})},k=O=>{console.log("Navigating to notification:",O),e(`/notifications/${O}`)};return L.jsxs("div",{className:"mb-8",children:[L.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Messages & Notifications"}),L.jsxs(Zw,{defaultValue:"inbox",className:"w-full",children:[L.jsxs(dv,{className:"grid w-full grid-cols-2",children:[L.jsxs(gl,{value:"inbox",className:"flex items-center gap-2",children:[L.jsx(YG,{className:"h-4 w-4"}),"Inbox",_>0&&L.jsx(WM,{variant:"secondary",className:"ml-2",children:_})]}),L.jsxs(gl,{value:"notifications",className:"flex items-center gap-2",children:[L.jsx(Gz,{className:"h-4 w-4"}),"Notifications"]})]}),L.jsx(Zc,{value:"inbox",children:L.jsx(Kre,{messages:a||[],onMessageClick:o})}),L.jsx(Zc,{value:"notifications",children:L.jsx(Kw,{className:"h-[300px] rounded-md border p-4",children:b&&b.length>0?L.jsx("div",{className:"space-y-4",children:b.map(O=>L.jsxs("div",{className:`p-4 rounded-lg border ${O.is_read?"bg-white":"bg-blue-50"} cursor-pointer hover:bg-gray-50 transition-colors`,onClick:()=>k(O.id),children:[L.jsx("p",{className:"text-sm text-gray-600",children:O.content}),L.jsx("span",{className:"text-xs text-gray-400 mt-2 block",children:new Date(O.created_at).toLocaleDateString()})]},O.id))}):L.jsx("p",{className:"text-center text-muted-foreground",children:"No notifications yet"})})})]}),L.jsx(fB,{isOpen:t.isOpen,onClose:()=>i({isOpen:!1,senderId:"",senderName:""}),receiverId:t.senderId,receiverName:t.senderName})]})},Qre=()=>L.jsxs("div",{className:"container mx-auto px-4 py-8",children:[L.jsxs("div",{className:"animate-pulse",children:[L.jsx("div",{className:"h-8 w-32 bg-gray-200 rounded mb-6"}),L.jsx("div",{className:"h-16 w-16 bg-gray-200 rounded-full mb-4"}),L.jsx("div",{className:"h-10 w-full max-w-sm bg-gray-200 rounded mb-4"}),L.jsx("div",{className:"h-10 w-full max-w-sm bg-gray-200 rounded"})]}),L.jsx(So,{})]}),ene=({error:e})=>L.jsxs("div",{className:"container mx-auto px-4 py-8",children:[L.jsx(KM,{variant:"destructive",children:L.jsx(JM,{children:e})}),L.jsx(So,{})]}),tne=()=>{const[e,t]=Y.useState(!0),[i,a]=Y.useState(null),[d,_]=Y.useState(null),[b,o]=Y.useState({full_name:""}),k=$o();return Y.useEffect(()=>{const O=async()=>{const{data:{session:G}}=await Qt.auth.getSession();if(!G){k("/login");return}},z=async()=>{try{t(!0),a(null);const{data:{session:G}}=await Qt.auth.getSession();if(!(G!=null&&G.user))throw new Error("No authenticated user found");console.log("Loading profile data...");const{data:ee,error:J}=await Qt.from("profiles").select("avatar_url, full_name").eq("id",G.user.id).single();if(J)throw J;ee&&(console.log("Profile data loaded:",{avatarUrl:ee.avatar_url,fullName:ee.full_name}),_(ee.avatar_url),o({full_name:ee.full_name||""}))}catch(G){console.error("Error loading profile:",G),a("Failed to load profile data")}finally{t(!1)}};O(),z();const{data:{subscription:F}}=Qt.auth.onAuthStateChange(G=>{G==="SIGNED_OUT"&&k("/login")});return()=>{F.unsubscribe()}},[k]),e?L.jsx(Qre,{}):i?L.jsx(ene,{error:i}):L.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[L.jsx(zte,{}),L.jsx(pte,{avatarUrl:d,setAvatarUrl:_}),L.jsx(Ote,{initialValues:b}),L.jsx(Jre,{}),L.jsx(tre,{}),L.jsx(So,{})]})},Wh=class Wh{constructor(){s1(this,"token",null);s1(this,"tokenPromise",null);console.log("MapboxTokenManager initialized")}static getInstance(){return Wh.instance||(Wh.instance=new Wh),Wh.instance}async getToken(){if(this.token)return console.log("Using cached Mapbox token"),this.token;if(this.tokenPromise)return console.log("Using existing token fetch promise"),this.tokenPromise;console.log("Fetching new Mapbox token"),this.tokenPromise=this.fetchToken();try{return this.token=await this.tokenPromise,console.log("Token fetch completed:",this.token?"success":"no token"),this.token}catch(t){throw console.error("Error in getToken:",t),t}finally{this.tokenPromise=null}}async fetchToken(){try{const t=localStorage.getItem("mapbox_token");if(t)return console.log("Using token from localStorage"),t;console.log("No token in localStorage, trying Supabase...");const{data:i,error:a}=await Qt.functions.invoke("get-mapbox-token");return a?(console.error("Error from Supabase function:",a),null):i!=null&&i.token?(console.log("Successfully retrieved token from Supabase"),localStorage.setItem("mapbox_token",i.token),i.token):(console.log("No token in Supabase response"),null)}catch(t){return console.error("Error in fetchToken:",t),null}}clearToken(){console.log("Clearing cached Mapbox token"),this.token=null,this.tokenPromise=null}};s1(Wh,"instance");let QC=Wh;const _B=QC.getInstance(),rne=()=>{const[e,t]=Y.useState(""),[i,a]=Y.useState(!1),d=async()=>{if(!e){Jn.error("Please enter a Mapbox token");return}if(!e.startsWith("pk.")){Jn.error("Invalid Mapbox token format. Public tokens should start with 'pk.'");return}a(!0);try{localStorage.setItem("mapbox_token",e),console.log("Token saved to localStorage");try{console.log("Attempting to save token to Supabase...");const{error:_}=await Qt.functions.invoke("set-mapbox-token",{body:{token:e}});_?console.warn("Supabase function error (using localStorage):",_):console.log("Token also saved to Supabase successfully")}catch(_){console.warn("Supabase function unavailable (using localStorage):",_)}_B.clearToken(),Jn.success("Mapbox token saved successfully"),setTimeout(()=>{window.location.reload()},1e3)}catch(_){console.error("Error saving token:",_),Jn.error("Failed to save token. Please try again.")}finally{a(!1)}};return L.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-background/80 backdrop-blur-sm p-4 flex items-center justify-center",children:L.jsxs("div",{className:"max-w-md w-full space-y-4",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsx("h2",{className:"text-lg font-semibold",children:"Mapbox Configuration Required"}),L.jsxs("p",{className:"text-sm text-muted-foreground",children:["Please enter your Mapbox public token to enable map functionality. You can find your token at"," ",L.jsx("a",{href:"https://account.mapbox.com/access-tokens/",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Mapbox Access Tokens"})]})]}),L.jsxs("div",{className:"flex gap-2",children:[L.jsx(lo,{type:"text",placeholder:"Enter your Mapbox token",value:e,onChange:_=>t(_.target.value),className:"flex-1",disabled:i}),L.jsx(on,{onClick:d,disabled:i,children:i?"Saving...":"Save Token"})]})]})})};var aE,hP="HoverCard",[yB,coe]=Rf(hP,[Ig]),Qw=Ig(),[nne,fP]=yB(hP),vB=e=>{const{__scopeHoverCard:t,children:i,open:a,defaultOpen:d,onOpenChange:_,openDelay:b=700,closeDelay:o=300}=e,k=Qw(t),O=Y.useRef(0),z=Y.useRef(0),F=Y.useRef(!1),G=Y.useRef(!1),[ee=!1,J]=wf({prop:a,defaultProp:d,onChange:_}),te=Y.useCallback(()=>{clearTimeout(z.current),O.current=window.setTimeout(()=>J(!0),b)},[b,J]),oe=Y.useCallback(()=>{clearTimeout(O.current),!F.current&&!G.current&&(z.current=window.setTimeout(()=>J(!1),o))},[o,J]),X=Y.useCallback(()=>J(!1),[J]);return Y.useEffect(()=>()=>{clearTimeout(O.current),clearTimeout(z.current)},[]),L.jsx(nne,{scope:t,open:ee,onOpenChange:J,onOpen:te,onClose:oe,onDismiss:X,hasSelectionRef:F,isPointerDownOnContentRef:G,children:L.jsx(BM,{...k,children:i})})};vB.displayName=hP;var xB="HoverCardTrigger",bB=Y.forwardRef((e,t)=>{const{__scopeHoverCard:i,...a}=e,d=fP(xB,i),_=Qw(i);return L.jsx(Fw,{asChild:!0,..._,children:L.jsx(ln.a,{"data-state":d.open?"open":"closed",...a,ref:t,onPointerEnter:Fr(e.onPointerEnter,tw(d.onOpen)),onPointerLeave:Fr(e.onPointerLeave,tw(d.onClose)),onFocus:Fr(e.onFocus,d.onOpen),onBlur:Fr(e.onBlur,d.onClose),onTouchStart:Fr(e.onTouchStart,b=>b.preventDefault())})})});bB.displayName=xB;var ine="HoverCardPortal",[uoe,one]=yB(ine,{forceMount:void 0}),ew="HoverCardContent",wB=Y.forwardRef((e,t)=>{const i=one(ew,e.__scopeHoverCard),{forceMount:a=i.forceMount,...d}=e,_=fP(ew,e.__scopeHoverCard);return L.jsx(Ra,{present:a||_.open,children:L.jsx(sne,{"data-state":_.open?"open":"closed",...d,onPointerEnter:Fr(e.onPointerEnter,tw(_.onOpen)),onPointerLeave:Fr(e.onPointerLeave,tw(_.onClose)),ref:t})})});wB.displayName=ew;var sne=Y.forwardRef((e,t)=>{const{__scopeHoverCard:i,onEscapeKeyDown:a,onPointerDownOutside:d,onFocusOutside:_,onInteractOutside:b,...o}=e,k=fP(ew,i),O=Qw(i),z=Y.useRef(null),F=Qn(t,z),[G,ee]=Y.useState(!1);return Y.useEffect(()=>{if(G){const J=document.body;return aE=J.style.userSelect||J.style.webkitUserSelect,J.style.userSelect="none",J.style.webkitUserSelect="none",()=>{J.style.userSelect=aE,J.style.webkitUserSelect=aE}}},[G]),Y.useEffect(()=>{if(z.current){const J=()=>{ee(!1),k.isPointerDownOnContentRef.current=!1,setTimeout(()=>{var oe;((oe=document.getSelection())==null?void 0:oe.toString())!==""&&(k.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",J),()=>{document.removeEventListener("pointerup",J),k.hasSelectionRef.current=!1,k.isPointerDownOnContentRef.current=!1}}},[k.isPointerDownOnContentRef,k.hasSelectionRef]),Y.useEffect(()=>{z.current&&cne(z.current).forEach(te=>te.setAttribute("tabindex","-1"))}),L.jsx(K0,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:b,onEscapeKeyDown:a,onPointerDownOutside:d,onFocusOutside:Fr(_,J=>{J.preventDefault()}),onDismiss:k.onDismiss,children:L.jsx(UM,{...O,...o,onPointerDown:Fr(o.onPointerDown,J=>{J.currentTarget.contains(J.target)&&ee(!0),k.hasSelectionRef.current=!1,k.isPointerDownOnContentRef.current=!0}),ref:F,style:{...o.style,userSelect:G?"text":void 0,WebkitUserSelect:G?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})})}),ane="HoverCardArrow",lne=Y.forwardRef((e,t)=>{const{__scopeHoverCard:i,...a}=e,d=Qw(i);return L.jsx(VM,{...d,...a,ref:t})});lne.displayName=ane;function tw(e){return t=>t.pointerType==="touch"?void 0:e()}function cne(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;i.nextNode();)t.push(i.currentNode);return t}var une=vB,dne=bB,SB=wB;const hne=une,fne=dne,TB=Y.forwardRef(({className:e,align:t="center",sideOffset:i=4,...a},d)=>L.jsx(SB,{ref:d,align:t,sideOffset:i,className:_r("z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));TB.displayName=SB.displayName;const pne=({price:e,brand:t,model:i,type:a,rating:d,distance:_,onClick:b})=>L.jsxs(hne,{children:[L.jsx(fne,{asChild:!0,children:L.jsxs("div",{className:"bg-primary text-white px-2 py-1 rounded-full cursor-pointer flex items-center gap-1 hover:bg-primary/90 transition-colors",onClick:b,children:[L.jsx(zG,{className:"h-4 w-4"}),L.jsxs("span",{children:["BWP ",e]})]})}),L.jsx(TB,{className:"w-80",children:L.jsxs("div",{className:"space-y-2",children:[L.jsxs("h4",{className:"text-sm font-semibold",children:[t," ",i]}),L.jsxs("div",{className:"text-sm text-muted-foreground",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsx("span",{children:a}),L.jsxs("div",{className:"flex items-center gap-1",children:[L.jsx(Yz,{className:"h-3 w-3"}),L.jsx("span",{children:_})]})]}),L.jsxs("div",{className:"flex items-center mt-1",children:[L.jsx("span",{className:"text-yellow-400",children:""}),L.jsx("span",{className:"ml-1",children:d.toFixed(1)})]})]})]})})]});var EB={exports:{}};(function(e,t){(function(i,a){e.exports=a()})(ua,function(){var i,a,d;function _(o,k){if(!i)i=k;else if(!a)a=k;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",z={};i(z),d=k(z),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}_(["exports"],function(o){function k(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var O,z={},F={};function G(){if(O)return F;O=1,Object.defineProperty(F,"__esModule",{value:!0}),F.setMatrixArrayType=function(m){F.ARRAY_TYPE=r=m},F.toRadian=function(m){return m*u},F.equals=function(m,h){return Math.abs(m-h)<=c*Math.max(1,Math.abs(m),Math.abs(h))},F.RANDOM=F.ARRAY_TYPE=F.EPSILON=void 0;var c=1e-6;F.EPSILON=c;var r=typeof Float32Array<"u"?Float32Array:Array;F.ARRAY_TYPE=r;var s=Math.random;F.RANDOM=s;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var m=0,h=arguments.length;h--;)m+=arguments[h]*arguments[h];return Math.sqrt(m)}),F}var ee,J={};function te(){if(ee)return J;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}ee=1,Object.defineProperty(J,"__esModule",{value:!0}),J.create=function(){var h=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},J.clone=function(h){var g=new r.ARRAY_TYPE(4);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g},J.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h},J.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},J.fromValues=function(h,g,w,E){var I=new r.ARRAY_TYPE(4);return I[0]=h,I[1]=g,I[2]=w,I[3]=E,I},J.set=function(h,g,w,E,I){return h[0]=g,h[1]=w,h[2]=E,h[3]=I,h},J.transpose=function(h,g){if(h===g){var w=g[1];h[1]=g[2],h[2]=w}else h[0]=g[0],h[1]=g[2],h[2]=g[1],h[3]=g[3];return h},J.invert=function(h,g){var w=g[0],E=g[1],I=g[2],x=g[3],C=w*x-I*E;return C?(h[0]=x*(C=1/C),h[1]=-E*C,h[2]=-I*C,h[3]=w*C,h):null},J.adjoint=function(h,g){var w=g[0];return h[0]=g[3],h[1]=-g[1],h[2]=-g[2],h[3]=w,h},J.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},J.multiply=u,J.rotate=function(h,g,w){var E=g[0],I=g[1],x=g[2],C=g[3],P=Math.sin(w),T=Math.cos(w);return h[0]=E*T+x*P,h[1]=I*T+C*P,h[2]=E*-P+x*T,h[3]=I*-P+C*T,h},J.scale=function(h,g,w){var E=g[1],I=g[2],x=g[3],C=w[0],P=w[1];return h[0]=g[0]*C,h[1]=E*C,h[2]=I*P,h[3]=x*P,h},J.fromRotation=function(h,g){var w=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=w,h[2]=-w,h[3]=E,h},J.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h},J.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},J.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},J.LDU=function(h,g,w,E){return h[2]=E[2]/E[0],w[0]=E[0],w[1]=E[1],w[3]=E[3]-h[2]*w[1],[h,g,w]},J.add=function(h,g,w){return h[0]=g[0]+w[0],h[1]=g[1]+w[1],h[2]=g[2]+w[2],h[3]=g[3]+w[3],h},J.subtract=m,J.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]},J.equals=function(h,g){var w=h[0],E=h[1],I=h[2],x=h[3],C=g[0],P=g[1],T=g[2],M=g[3];return Math.abs(w-C)<=r.EPSILON*Math.max(1,Math.abs(w),Math.abs(C))&&Math.abs(E-P)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(P))&&Math.abs(I-T)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(T))&&Math.abs(x-M)<=r.EPSILON*Math.max(1,Math.abs(x),Math.abs(M))},J.multiplyScalar=function(h,g,w){return h[0]=g[0]*w,h[1]=g[1]*w,h[2]=g[2]*w,h[3]=g[3]*w,h},J.multiplyScalarAndAdd=function(h,g,w,E){return h[0]=g[0]+w[0]*E,h[1]=g[1]+w[1]*E,h[2]=g[2]+w[2]*E,h[3]=g[3]+w[3]*E,h},J.sub=J.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=s(void 0);if(w&&w.has(h))return w.get(h);var E={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var C=I?Object.getOwnPropertyDescriptor(h,x):null;C&&(C.get||C.set)?Object.defineProperty(E,x,C):E[x]=h[x]}return E.default=h,w&&w.set(h,E),E}(G());function s(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,w=new WeakMap;return(s=function(E){return E?w:g})(h)}function u(h,g,w){var E=g[0],I=g[1],x=g[2],C=g[3],P=w[0],T=w[1],M=w[2],R=w[3];return h[0]=E*P+x*T,h[1]=I*P+C*T,h[2]=E*M+x*R,h[3]=I*M+C*R,h}function m(h,g,w){return h[0]=g[0]-w[0],h[1]=g[1]-w[1],h[2]=g[2]-w[2],h[3]=g[3]-w[3],h}return J.mul=u,J.sub=m,J}var oe,X={};function Q(){if(oe)return X;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}oe=1,Object.defineProperty(X,"__esModule",{value:!0}),X.create=function(){var h=new r.ARRAY_TYPE(6);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},X.clone=function(h){var g=new r.ARRAY_TYPE(6);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g},X.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h},X.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},X.fromValues=function(h,g,w,E,I,x){var C=new r.ARRAY_TYPE(6);return C[0]=h,C[1]=g,C[2]=w,C[3]=E,C[4]=I,C[5]=x,C},X.set=function(h,g,w,E,I,x,C){return h[0]=g,h[1]=w,h[2]=E,h[3]=I,h[4]=x,h[5]=C,h},X.invert=function(h,g){var w=g[0],E=g[1],I=g[2],x=g[3],C=g[4],P=g[5],T=w*x-E*I;return T?(h[0]=x*(T=1/T),h[1]=-E*T,h[2]=-I*T,h[3]=w*T,h[4]=(I*P-x*C)*T,h[5]=(E*C-w*P)*T,h):null},X.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},X.multiply=u,X.rotate=function(h,g,w){var E=g[0],I=g[1],x=g[2],C=g[3],P=g[4],T=g[5],M=Math.sin(w),R=Math.cos(w);return h[0]=E*R+x*M,h[1]=I*R+C*M,h[2]=E*-M+x*R,h[3]=I*-M+C*R,h[4]=P,h[5]=T,h},X.scale=function(h,g,w){var E=g[1],I=g[2],x=g[3],C=g[4],P=g[5],T=w[0],M=w[1];return h[0]=g[0]*T,h[1]=E*T,h[2]=I*M,h[3]=x*M,h[4]=C,h[5]=P,h},X.translate=function(h,g,w){var E=g[0],I=g[1],x=g[2],C=g[3],P=g[4],T=g[5],M=w[0],R=w[1];return h[0]=E,h[1]=I,h[2]=x,h[3]=C,h[4]=E*M+x*R+P,h[5]=I*M+C*R+T,h},X.fromRotation=function(h,g){var w=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=w,h[2]=-w,h[3]=E,h[4]=0,h[5]=0,h},X.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h[4]=0,h[5]=0,h},X.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=g[0],h[5]=g[1],h},X.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},X.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},X.add=function(h,g,w){return h[0]=g[0]+w[0],h[1]=g[1]+w[1],h[2]=g[2]+w[2],h[3]=g[3]+w[3],h[4]=g[4]+w[4],h[5]=g[5]+w[5],h},X.subtract=m,X.multiplyScalar=function(h,g,w){return h[0]=g[0]*w,h[1]=g[1]*w,h[2]=g[2]*w,h[3]=g[3]*w,h[4]=g[4]*w,h[5]=g[5]*w,h},X.multiplyScalarAndAdd=function(h,g,w,E){return h[0]=g[0]+w[0]*E,h[1]=g[1]+w[1]*E,h[2]=g[2]+w[2]*E,h[3]=g[3]+w[3]*E,h[4]=g[4]+w[4]*E,h[5]=g[5]+w[5]*E,h},X.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]},X.equals=function(h,g){var w=h[0],E=h[1],I=h[2],x=h[3],C=h[4],P=h[5],T=g[0],M=g[1],R=g[2],B=g[3],U=g[4],W=g[5];return Math.abs(w-T)<=r.EPSILON*Math.max(1,Math.abs(w),Math.abs(T))&&Math.abs(E-M)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(I-R)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(R))&&Math.abs(x-B)<=r.EPSILON*Math.max(1,Math.abs(x),Math.abs(B))&&Math.abs(C-U)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(U))&&Math.abs(P-W)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(W))},X.sub=X.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=s(void 0);if(w&&w.has(h))return w.get(h);var E={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var C=I?Object.getOwnPropertyDescriptor(h,x):null;C&&(C.get||C.set)?Object.defineProperty(E,x,C):E[x]=h[x]}return E.default=h,w&&w.set(h,E),E}(G());function s(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,w=new WeakMap;return(s=function(E){return E?w:g})(h)}function u(h,g,w){var E=g[0],I=g[1],x=g[2],C=g[3],P=g[4],T=g[5],M=w[0],R=w[1],B=w[2],U=w[3],W=w[4],Z=w[5];return h[0]=E*M+x*R,h[1]=I*M+C*R,h[2]=E*B+x*U,h[3]=I*B+C*U,h[4]=E*W+x*Z+P,h[5]=I*W+C*Z+T,h}function m(h,g,w){return h[0]=g[0]-w[0],h[1]=g[1]-w[1],h[2]=g[2]-w[2],h[3]=g[3]-w[3],h[4]=g[4]-w[4],h[5]=g[5]-w[5],h}return X.mul=u,X.sub=m,X}var ue,he={};function Ie(){if(ue)return he;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}ue=1,Object.defineProperty(he,"__esModule",{value:!0}),he.create=function(){var h=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},he.fromMat4=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[4],h[4]=g[5],h[5]=g[6],h[6]=g[8],h[7]=g[9],h[8]=g[10],h},he.clone=function(h){var g=new r.ARRAY_TYPE(9);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g[6]=h[6],g[7]=h[7],g[8]=h[8],g},he.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},he.fromValues=function(h,g,w,E,I,x,C,P,T){var M=new r.ARRAY_TYPE(9);return M[0]=h,M[1]=g,M[2]=w,M[3]=E,M[4]=I,M[5]=x,M[6]=C,M[7]=P,M[8]=T,M},he.set=function(h,g,w,E,I,x,C,P,T,M){return h[0]=g,h[1]=w,h[2]=E,h[3]=I,h[4]=x,h[5]=C,h[6]=P,h[7]=T,h[8]=M,h},he.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},he.transpose=function(h,g){if(h===g){var w=g[1],E=g[2],I=g[5];h[1]=g[3],h[2]=g[6],h[3]=w,h[5]=g[7],h[6]=E,h[7]=I}else h[0]=g[0],h[1]=g[3],h[2]=g[6],h[3]=g[1],h[4]=g[4],h[5]=g[7],h[6]=g[2],h[7]=g[5],h[8]=g[8];return h},he.invert=function(h,g){var w=g[0],E=g[1],I=g[2],x=g[3],C=g[4],P=g[5],T=g[6],M=g[7],R=g[8],B=R*C-P*M,U=-R*x+P*T,W=M*x-C*T,Z=w*B+E*U+I*W;return Z?(h[0]=B*(Z=1/Z),h[1]=(-R*E+I*M)*Z,h[2]=(P*E-I*C)*Z,h[3]=U*Z,h[4]=(R*w-I*T)*Z,h[5]=(-P*w+I*x)*Z,h[6]=W*Z,h[7]=(-M*w+E*T)*Z,h[8]=(C*w-E*x)*Z,h):null},he.adjoint=function(h,g){var w=g[0],E=g[1],I=g[2],x=g[3],C=g[4],P=g[5],T=g[6],M=g[7],R=g[8];return h[0]=C*R-P*M,h[1]=I*M-E*R,h[2]=E*P-I*C,h[3]=P*T-x*R,h[4]=w*R-I*T,h[5]=I*x-w*P,h[6]=x*M-C*T,h[7]=E*T-w*M,h[8]=w*C-E*x,h},he.determinant=function(h){var g=h[3],w=h[4],E=h[5],I=h[6],x=h[7],C=h[8];return h[0]*(C*w-E*x)+h[1]*(-C*g+E*I)+h[2]*(x*g-w*I)},he.multiply=u,he.translate=function(h,g,w){var E=g[0],I=g[1],x=g[2],C=g[3],P=g[4],T=g[5],M=g[6],R=g[7],B=g[8],U=w[0],W=w[1];return h[0]=E,h[1]=I,h[2]=x,h[3]=C,h[4]=P,h[5]=T,h[6]=U*E+W*C+M,h[7]=U*I+W*P+R,h[8]=U*x+W*T+B,h},he.rotate=function(h,g,w){var E=g[0],I=g[1],x=g[2],C=g[3],P=g[4],T=g[5],M=g[6],R=g[7],B=g[8],U=Math.sin(w),W=Math.cos(w);return h[0]=W*E+U*C,h[1]=W*I+U*P,h[2]=W*x+U*T,h[3]=W*C-U*E,h[4]=W*P-U*I,h[5]=W*T-U*x,h[6]=M,h[7]=R,h[8]=B,h},he.scale=function(h,g,w){var E=w[0],I=w[1];return h[0]=E*g[0],h[1]=E*g[1],h[2]=E*g[2],h[3]=I*g[3],h[4]=I*g[4],h[5]=I*g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},he.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=g[0],h[7]=g[1],h[8]=1,h},he.fromRotation=function(h,g){var w=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=w,h[2]=0,h[3]=-w,h[4]=E,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},he.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=0,h[4]=g[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},he.fromMat2d=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=0,h[3]=g[2],h[4]=g[3],h[5]=0,h[6]=g[4],h[7]=g[5],h[8]=1,h},he.fromQuat=function(h,g){var w=g[0],E=g[1],I=g[2],x=g[3],C=w+w,P=E+E,T=I+I,M=w*C,R=E*C,B=E*P,U=I*C,W=I*P,Z=I*T,H=x*C,K=x*P,re=x*T;return h[0]=1-B-Z,h[3]=R-re,h[6]=U+K,h[1]=R+re,h[4]=1-M-Z,h[7]=W-H,h[2]=U-K,h[5]=W+H,h[8]=1-M-B,h},he.normalFromMat4=function(h,g){var w=g[0],E=g[1],I=g[2],x=g[3],C=g[4],P=g[5],T=g[6],M=g[7],R=g[8],B=g[9],U=g[10],W=g[11],Z=g[12],H=g[13],K=g[14],re=g[15],se=w*P-E*C,ge=w*T-I*C,me=w*M-x*C,pe=E*T-I*P,Ee=E*M-x*P,ye=I*M-x*T,Pe=R*H-B*Z,Le=R*K-U*Z,Re=R*re-W*Z,Ne=B*K-U*H,Ve=B*re-W*H,We=U*re-W*K,Be=se*We-ge*Ve+me*Ne+pe*Re-Ee*Le+ye*Pe;return Be?(h[0]=(P*We-T*Ve+M*Ne)*(Be=1/Be),h[1]=(T*Re-C*We-M*Le)*Be,h[2]=(C*Ve-P*Re+M*Pe)*Be,h[3]=(I*Ve-E*We-x*Ne)*Be,h[4]=(w*We-I*Re+x*Le)*Be,h[5]=(E*Re-w*Ve-x*Pe)*Be,h[6]=(H*ye-K*Ee+re*pe)*Be,h[7]=(K*me-Z*ye-re*ge)*Be,h[8]=(Z*Ee-H*me+re*se)*Be,h):null},he.projection=function(h,g,w){return h[0]=2/g,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/w,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},he.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},he.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},he.add=function(h,g,w){return h[0]=g[0]+w[0],h[1]=g[1]+w[1],h[2]=g[2]+w[2],h[3]=g[3]+w[3],h[4]=g[4]+w[4],h[5]=g[5]+w[5],h[6]=g[6]+w[6],h[7]=g[7]+w[7],h[8]=g[8]+w[8],h},he.subtract=m,he.multiplyScalar=function(h,g,w){return h[0]=g[0]*w,h[1]=g[1]*w,h[2]=g[2]*w,h[3]=g[3]*w,h[4]=g[4]*w,h[5]=g[5]*w,h[6]=g[6]*w,h[7]=g[7]*w,h[8]=g[8]*w,h},he.multiplyScalarAndAdd=function(h,g,w,E){return h[0]=g[0]+w[0]*E,h[1]=g[1]+w[1]*E,h[2]=g[2]+w[2]*E,h[3]=g[3]+w[3]*E,h[4]=g[4]+w[4]*E,h[5]=g[5]+w[5]*E,h[6]=g[6]+w[6]*E,h[7]=g[7]+w[7]*E,h[8]=g[8]+w[8]*E,h},he.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]&&h[6]===g[6]&&h[7]===g[7]&&h[8]===g[8]},he.equals=function(h,g){var w=h[0],E=h[1],I=h[2],x=h[3],C=h[4],P=h[5],T=h[6],M=h[7],R=h[8],B=g[0],U=g[1],W=g[2],Z=g[3],H=g[4],K=g[5],re=g[6],se=g[7],ge=g[8];return Math.abs(w-B)<=r.EPSILON*Math.max(1,Math.abs(w),Math.abs(B))&&Math.abs(E-U)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(U))&&Math.abs(I-W)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(W))&&Math.abs(x-Z)<=r.EPSILON*Math.max(1,Math.abs(x),Math.abs(Z))&&Math.abs(C-H)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(H))&&Math.abs(P-K)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(K))&&Math.abs(T-re)<=r.EPSILON*Math.max(1,Math.abs(T),Math.abs(re))&&Math.abs(M-se)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(se))&&Math.abs(R-ge)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(ge))},he.sub=he.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=s(void 0);if(w&&w.has(h))return w.get(h);var E={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var C=I?Object.getOwnPropertyDescriptor(h,x):null;C&&(C.get||C.set)?Object.defineProperty(E,x,C):E[x]=h[x]}return E.default=h,w&&w.set(h,E),E}(G());function s(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,w=new WeakMap;return(s=function(E){return E?w:g})(h)}function u(h,g,w){var E=g[0],I=g[1],x=g[2],C=g[3],P=g[4],T=g[5],M=g[6],R=g[7],B=g[8],U=w[0],W=w[1],Z=w[2],H=w[3],K=w[4],re=w[5],se=w[6],ge=w[7],me=w[8];return h[0]=U*E+W*C+Z*M,h[1]=U*I+W*P+Z*R,h[2]=U*x+W*T+Z*B,h[3]=H*E+K*C+re*M,h[4]=H*I+K*P+re*R,h[5]=H*x+K*T+re*B,h[6]=se*E+ge*C+me*M,h[7]=se*I+ge*P+me*R,h[8]=se*x+ge*T+me*B,h}function m(h,g,w){return h[0]=g[0]-w[0],h[1]=g[1]-w[1],h[2]=g[2]-w[2],h[3]=g[3]-w[3],h[4]=g[4]-w[4],h[5]=g[5]-w[5],h[6]=g[6]-w[6],h[7]=g[7]-w[7],h[8]=g[8]-w[8],h}return he.mul=u,he.sub=m,he}var Je,Ce={};function Ze(){if(Je)return Ce;function c(x){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(x)}Je=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.create=function(){var x=new r.ARRAY_TYPE(16);return r.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},Ce.clone=function(x){var C=new r.ARRAY_TYPE(16);return C[0]=x[0],C[1]=x[1],C[2]=x[2],C[3]=x[3],C[4]=x[4],C[5]=x[5],C[6]=x[6],C[7]=x[7],C[8]=x[8],C[9]=x[9],C[10]=x[10],C[11]=x[11],C[12]=x[12],C[13]=x[13],C[14]=x[14],C[15]=x[15],C},Ce.copy=function(x,C){return x[0]=C[0],x[1]=C[1],x[2]=C[2],x[3]=C[3],x[4]=C[4],x[5]=C[5],x[6]=C[6],x[7]=C[7],x[8]=C[8],x[9]=C[9],x[10]=C[10],x[11]=C[11],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15],x},Ce.fromValues=function(x,C,P,T,M,R,B,U,W,Z,H,K,re,se,ge,me){var pe=new r.ARRAY_TYPE(16);return pe[0]=x,pe[1]=C,pe[2]=P,pe[3]=T,pe[4]=M,pe[5]=R,pe[6]=B,pe[7]=U,pe[8]=W,pe[9]=Z,pe[10]=H,pe[11]=K,pe[12]=re,pe[13]=se,pe[14]=ge,pe[15]=me,pe},Ce.set=function(x,C,P,T,M,R,B,U,W,Z,H,K,re,se,ge,me,pe){return x[0]=C,x[1]=P,x[2]=T,x[3]=M,x[4]=R,x[5]=B,x[6]=U,x[7]=W,x[8]=Z,x[9]=H,x[10]=K,x[11]=re,x[12]=se,x[13]=ge,x[14]=me,x[15]=pe,x},Ce.identity=u,Ce.transpose=function(x,C){if(x===C){var P=C[1],T=C[2],M=C[3],R=C[6],B=C[7],U=C[11];x[1]=C[4],x[2]=C[8],x[3]=C[12],x[4]=P,x[6]=C[9],x[7]=C[13],x[8]=T,x[9]=R,x[11]=C[14],x[12]=M,x[13]=B,x[14]=U}else x[0]=C[0],x[1]=C[4],x[2]=C[8],x[3]=C[12],x[4]=C[1],x[5]=C[5],x[6]=C[9],x[7]=C[13],x[8]=C[2],x[9]=C[6],x[10]=C[10],x[11]=C[14],x[12]=C[3],x[13]=C[7],x[14]=C[11],x[15]=C[15];return x},Ce.invert=function(x,C){var P=C[0],T=C[1],M=C[2],R=C[3],B=C[4],U=C[5],W=C[6],Z=C[7],H=C[8],K=C[9],re=C[10],se=C[11],ge=C[12],me=C[13],pe=C[14],Ee=C[15],ye=P*U-T*B,Pe=P*W-M*B,Le=P*Z-R*B,Re=T*W-M*U,Ne=T*Z-R*U,Ve=M*Z-R*W,We=H*me-K*ge,Be=H*pe-re*ge,lt=H*Ee-se*ge,bt=K*pe-re*me,ct=K*Ee-se*me,It=re*Ee-se*pe,At=ye*It-Pe*ct+Le*bt+Re*lt-Ne*Be+Ve*We;return At?(x[0]=(U*It-W*ct+Z*bt)*(At=1/At),x[1]=(M*ct-T*It-R*bt)*At,x[2]=(me*Ve-pe*Ne+Ee*Re)*At,x[3]=(re*Ne-K*Ve-se*Re)*At,x[4]=(W*lt-B*It-Z*Be)*At,x[5]=(P*It-M*lt+R*Be)*At,x[6]=(pe*Le-ge*Ve-Ee*Pe)*At,x[7]=(H*Ve-re*Le+se*Pe)*At,x[8]=(B*ct-U*lt+Z*We)*At,x[9]=(T*lt-P*ct-R*We)*At,x[10]=(ge*Ne-me*Le+Ee*ye)*At,x[11]=(K*Le-H*Ne-se*ye)*At,x[12]=(U*Be-B*bt-W*We)*At,x[13]=(P*bt-T*Be+M*We)*At,x[14]=(me*Pe-ge*Re-pe*ye)*At,x[15]=(H*Re-K*Pe+re*ye)*At,x):null},Ce.adjoint=function(x,C){var P=C[0],T=C[1],M=C[2],R=C[3],B=C[4],U=C[5],W=C[6],Z=C[7],H=C[8],K=C[9],re=C[10],se=C[11],ge=C[12],me=C[13],pe=C[14],Ee=C[15];return x[0]=U*(re*Ee-se*pe)-K*(W*Ee-Z*pe)+me*(W*se-Z*re),x[1]=-(T*(re*Ee-se*pe)-K*(M*Ee-R*pe)+me*(M*se-R*re)),x[2]=T*(W*Ee-Z*pe)-U*(M*Ee-R*pe)+me*(M*Z-R*W),x[3]=-(T*(W*se-Z*re)-U*(M*se-R*re)+K*(M*Z-R*W)),x[4]=-(B*(re*Ee-se*pe)-H*(W*Ee-Z*pe)+ge*(W*se-Z*re)),x[5]=P*(re*Ee-se*pe)-H*(M*Ee-R*pe)+ge*(M*se-R*re),x[6]=-(P*(W*Ee-Z*pe)-B*(M*Ee-R*pe)+ge*(M*Z-R*W)),x[7]=P*(W*se-Z*re)-B*(M*se-R*re)+H*(M*Z-R*W),x[8]=B*(K*Ee-se*me)-H*(U*Ee-Z*me)+ge*(U*se-Z*K),x[9]=-(P*(K*Ee-se*me)-H*(T*Ee-R*me)+ge*(T*se-R*K)),x[10]=P*(U*Ee-Z*me)-B*(T*Ee-R*me)+ge*(T*Z-R*U),x[11]=-(P*(U*se-Z*K)-B*(T*se-R*K)+H*(T*Z-R*U)),x[12]=-(B*(K*pe-re*me)-H*(U*pe-W*me)+ge*(U*re-W*K)),x[13]=P*(K*pe-re*me)-H*(T*pe-M*me)+ge*(T*re-M*K),x[14]=-(P*(U*pe-W*me)-B*(T*pe-M*me)+ge*(T*W-M*U)),x[15]=P*(U*re-W*K)-B*(T*re-M*K)+H*(T*W-M*U),x},Ce.determinant=function(x){var C=x[0],P=x[1],T=x[2],M=x[3],R=x[4],B=x[5],U=x[6],W=x[7],Z=x[8],H=x[9],K=x[10],re=x[11],se=x[12],ge=x[13],me=x[14],pe=x[15];return(C*B-P*R)*(K*pe-re*me)-(C*U-T*R)*(H*pe-re*ge)+(C*W-M*R)*(H*me-K*ge)+(P*U-T*B)*(Z*pe-re*se)-(P*W-M*B)*(Z*me-K*se)+(T*W-M*U)*(Z*ge-H*se)},Ce.multiply=m,Ce.translate=function(x,C,P){var T,M,R,B,U,W,Z,H,K,re,se,ge,me=P[0],pe=P[1],Ee=P[2];return C===x?(x[12]=C[0]*me+C[4]*pe+C[8]*Ee+C[12],x[13]=C[1]*me+C[5]*pe+C[9]*Ee+C[13],x[14]=C[2]*me+C[6]*pe+C[10]*Ee+C[14],x[15]=C[3]*me+C[7]*pe+C[11]*Ee+C[15]):(M=C[1],R=C[2],B=C[3],U=C[4],W=C[5],Z=C[6],H=C[7],K=C[8],re=C[9],se=C[10],ge=C[11],x[0]=T=C[0],x[1]=M,x[2]=R,x[3]=B,x[4]=U,x[5]=W,x[6]=Z,x[7]=H,x[8]=K,x[9]=re,x[10]=se,x[11]=ge,x[12]=T*me+U*pe+K*Ee+C[12],x[13]=M*me+W*pe+re*Ee+C[13],x[14]=R*me+Z*pe+se*Ee+C[14],x[15]=B*me+H*pe+ge*Ee+C[15]),x},Ce.scale=function(x,C,P){var T=P[0],M=P[1],R=P[2];return x[0]=C[0]*T,x[1]=C[1]*T,x[2]=C[2]*T,x[3]=C[3]*T,x[4]=C[4]*M,x[5]=C[5]*M,x[6]=C[6]*M,x[7]=C[7]*M,x[8]=C[8]*R,x[9]=C[9]*R,x[10]=C[10]*R,x[11]=C[11]*R,x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15],x},Ce.rotate=function(x,C,P,T){var M,R,B,U,W,Z,H,K,re,se,ge,me,pe,Ee,ye,Pe,Le,Re,Ne,Ve,We,Be,lt,bt,ct=T[0],It=T[1],At=T[2],Nt=Math.hypot(ct,It,At);return Nt<r.EPSILON?null:(ct*=Nt=1/Nt,It*=Nt,At*=Nt,M=Math.sin(P),R=Math.cos(P),W=C[1],Z=C[2],H=C[3],re=C[5],se=C[6],ge=C[7],pe=C[9],Ee=C[10],ye=C[11],Pe=ct*ct*(B=1-R)+R,Ne=ct*It*B-At*M,Ve=It*It*B+R,We=At*It*B+ct*M,Be=ct*At*B+It*M,lt=It*At*B-ct*M,bt=At*At*B+R,x[0]=(U=C[0])*Pe+(K=C[4])*(Le=It*ct*B+At*M)+(me=C[8])*(Re=At*ct*B-It*M),x[1]=W*Pe+re*Le+pe*Re,x[2]=Z*Pe+se*Le+Ee*Re,x[3]=H*Pe+ge*Le+ye*Re,x[4]=U*Ne+K*Ve+me*We,x[5]=W*Ne+re*Ve+pe*We,x[6]=Z*Ne+se*Ve+Ee*We,x[7]=H*Ne+ge*Ve+ye*We,x[8]=U*Be+K*lt+me*bt,x[9]=W*Be+re*lt+pe*bt,x[10]=Z*Be+se*lt+Ee*bt,x[11]=H*Be+ge*lt+ye*bt,C!==x&&(x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x)},Ce.rotateX=function(x,C,P){var T=Math.sin(P),M=Math.cos(P),R=C[4],B=C[5],U=C[6],W=C[7],Z=C[8],H=C[9],K=C[10],re=C[11];return C!==x&&(x[0]=C[0],x[1]=C[1],x[2]=C[2],x[3]=C[3],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[4]=R*M+Z*T,x[5]=B*M+H*T,x[6]=U*M+K*T,x[7]=W*M+re*T,x[8]=Z*M-R*T,x[9]=H*M-B*T,x[10]=K*M-U*T,x[11]=re*M-W*T,x},Ce.rotateY=function(x,C,P){var T=Math.sin(P),M=Math.cos(P),R=C[0],B=C[1],U=C[2],W=C[3],Z=C[8],H=C[9],K=C[10],re=C[11];return C!==x&&(x[4]=C[4],x[5]=C[5],x[6]=C[6],x[7]=C[7],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[0]=R*M-Z*T,x[1]=B*M-H*T,x[2]=U*M-K*T,x[3]=W*M-re*T,x[8]=R*T+Z*M,x[9]=B*T+H*M,x[10]=U*T+K*M,x[11]=W*T+re*M,x},Ce.rotateZ=function(x,C,P){var T=Math.sin(P),M=Math.cos(P),R=C[0],B=C[1],U=C[2],W=C[3],Z=C[4],H=C[5],K=C[6],re=C[7];return C!==x&&(x[8]=C[8],x[9]=C[9],x[10]=C[10],x[11]=C[11],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[0]=R*M+Z*T,x[1]=B*M+H*T,x[2]=U*M+K*T,x[3]=W*M+re*T,x[4]=Z*M-R*T,x[5]=H*M-B*T,x[6]=K*M-U*T,x[7]=re*M-W*T,x},Ce.fromTranslation=function(x,C){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=C[0],x[13]=C[1],x[14]=C[2],x[15]=1,x},Ce.fromScaling=function(x,C){return x[0]=C[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=C[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=C[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ce.fromRotation=function(x,C,P){var T,M,R,B=P[0],U=P[1],W=P[2],Z=Math.hypot(B,U,W);return Z<r.EPSILON?null:(B*=Z=1/Z,U*=Z,W*=Z,T=Math.sin(C),M=Math.cos(C),x[0]=B*B*(R=1-M)+M,x[1]=U*B*R+W*T,x[2]=W*B*R-U*T,x[3]=0,x[4]=B*U*R-W*T,x[5]=U*U*R+M,x[6]=W*U*R+B*T,x[7]=0,x[8]=B*W*R+U*T,x[9]=U*W*R-B*T,x[10]=W*W*R+M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},Ce.fromXRotation=function(x,C){var P=Math.sin(C),T=Math.cos(C);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=T,x[6]=P,x[7]=0,x[8]=0,x[9]=-P,x[10]=T,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ce.fromYRotation=function(x,C){var P=Math.sin(C),T=Math.cos(C);return x[0]=T,x[1]=0,x[2]=-P,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=P,x[9]=0,x[10]=T,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ce.fromZRotation=function(x,C){var P=Math.sin(C),T=Math.cos(C);return x[0]=T,x[1]=P,x[2]=0,x[3]=0,x[4]=-P,x[5]=T,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ce.fromRotationTranslation=h,Ce.fromQuat2=function(x,C){var P=new r.ARRAY_TYPE(3),T=-C[0],M=-C[1],R=-C[2],B=C[3],U=C[4],W=C[5],Z=C[6],H=C[7],K=T*T+M*M+R*R+B*B;return K>0?(P[0]=2*(U*B+H*T+W*R-Z*M)/K,P[1]=2*(W*B+H*M+Z*T-U*R)/K,P[2]=2*(Z*B+H*R+U*M-W*T)/K):(P[0]=2*(U*B+H*T+W*R-Z*M),P[1]=2*(W*B+H*M+Z*T-U*R),P[2]=2*(Z*B+H*R+U*M-W*T)),h(x,C,P),x},Ce.getTranslation=function(x,C){return x[0]=C[12],x[1]=C[13],x[2]=C[14],x},Ce.getScaling=g,Ce.getRotation=function(x,C){var P=new r.ARRAY_TYPE(3);g(P,C);var T=1/P[0],M=1/P[1],R=1/P[2],B=C[0]*T,U=C[1]*M,W=C[2]*R,Z=C[4]*T,H=C[5]*M,K=C[6]*R,re=C[8]*T,se=C[9]*M,ge=C[10]*R,me=B+H+ge,pe=0;return me>0?(pe=2*Math.sqrt(me+1),x[3]=.25*pe,x[0]=(K-se)/pe,x[1]=(re-W)/pe,x[2]=(U-Z)/pe):B>H&&B>ge?(pe=2*Math.sqrt(1+B-H-ge),x[3]=(K-se)/pe,x[0]=.25*pe,x[1]=(U+Z)/pe,x[2]=(re+W)/pe):H>ge?(pe=2*Math.sqrt(1+H-B-ge),x[3]=(re-W)/pe,x[0]=(U+Z)/pe,x[1]=.25*pe,x[2]=(K+se)/pe):(pe=2*Math.sqrt(1+ge-B-H),x[3]=(U-Z)/pe,x[0]=(re+W)/pe,x[1]=(K+se)/pe,x[2]=.25*pe),x},Ce.fromRotationTranslationScale=function(x,C,P,T){var M=C[0],R=C[1],B=C[2],U=C[3],W=M+M,Z=R+R,H=B+B,K=M*W,re=M*Z,se=M*H,ge=R*Z,me=R*H,pe=B*H,Ee=U*W,ye=U*Z,Pe=U*H,Le=T[0],Re=T[1],Ne=T[2];return x[0]=(1-(ge+pe))*Le,x[1]=(re+Pe)*Le,x[2]=(se-ye)*Le,x[3]=0,x[4]=(re-Pe)*Re,x[5]=(1-(K+pe))*Re,x[6]=(me+Ee)*Re,x[7]=0,x[8]=(se+ye)*Ne,x[9]=(me-Ee)*Ne,x[10]=(1-(K+ge))*Ne,x[11]=0,x[12]=P[0],x[13]=P[1],x[14]=P[2],x[15]=1,x},Ce.fromRotationTranslationScaleOrigin=function(x,C,P,T,M){var R=C[0],B=C[1],U=C[2],W=C[3],Z=R+R,H=B+B,K=U+U,re=R*Z,se=R*H,ge=R*K,me=B*H,pe=B*K,Ee=U*K,ye=W*Z,Pe=W*H,Le=W*K,Re=T[0],Ne=T[1],Ve=T[2],We=M[0],Be=M[1],lt=M[2],bt=(1-(me+Ee))*Re,ct=(se+Le)*Re,It=(ge-Pe)*Re,At=(se-Le)*Ne,Nt=(1-(re+Ee))*Ne,pt=(pe+ye)*Ne,Jt=(ge+Pe)*Ve,kt=(pe-ye)*Ve,Zt=(1-(re+me))*Ve;return x[0]=bt,x[1]=ct,x[2]=It,x[3]=0,x[4]=At,x[5]=Nt,x[6]=pt,x[7]=0,x[8]=Jt,x[9]=kt,x[10]=Zt,x[11]=0,x[12]=P[0]+We-(bt*We+At*Be+Jt*lt),x[13]=P[1]+Be-(ct*We+Nt*Be+kt*lt),x[14]=P[2]+lt-(It*We+pt*Be+Zt*lt),x[15]=1,x},Ce.fromQuat=function(x,C){var P=C[0],T=C[1],M=C[2],R=C[3],B=P+P,U=T+T,W=M+M,Z=P*B,H=T*B,K=T*U,re=M*B,se=M*U,ge=M*W,me=R*B,pe=R*U,Ee=R*W;return x[0]=1-K-ge,x[1]=H+Ee,x[2]=re-pe,x[3]=0,x[4]=H-Ee,x[5]=1-Z-ge,x[6]=se+me,x[7]=0,x[8]=re+pe,x[9]=se-me,x[10]=1-Z-K,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ce.frustum=function(x,C,P,T,M,R,B){var U=1/(P-C),W=1/(M-T),Z=1/(R-B);return x[0]=2*R*U,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*R*W,x[6]=0,x[7]=0,x[8]=(P+C)*U,x[9]=(M+T)*W,x[10]=(B+R)*Z,x[11]=-1,x[12]=0,x[13]=0,x[14]=B*R*2*Z,x[15]=0,x},Ce.perspectiveNO=w,Ce.perspectiveZO=function(x,C,P,T,M){var R,B=1/Math.tan(C/2);return x[0]=B/P,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=B,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,M!=null&&M!==1/0?(x[10]=M*(R=1/(T-M)),x[14]=M*T*R):(x[10]=-1,x[14]=-T),x},Ce.perspectiveFromFieldOfView=function(x,C,P,T){var M=Math.tan(C.upDegrees*Math.PI/180),R=Math.tan(C.downDegrees*Math.PI/180),B=Math.tan(C.leftDegrees*Math.PI/180),U=Math.tan(C.rightDegrees*Math.PI/180),W=2/(B+U),Z=2/(M+R);return x[0]=W,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=Z,x[6]=0,x[7]=0,x[8]=-(B-U)*W*.5,x[9]=(M-R)*Z*.5,x[10]=T/(P-T),x[11]=-1,x[12]=0,x[13]=0,x[14]=T*P/(P-T),x[15]=0,x},Ce.orthoNO=E,Ce.orthoZO=function(x,C,P,T,M,R,B){var U=1/(C-P),W=1/(T-M),Z=1/(R-B);return x[0]=-2*U,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*W,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=Z,x[11]=0,x[12]=(C+P)*U,x[13]=(M+T)*W,x[14]=R*Z,x[15]=1,x},Ce.lookAt=function(x,C,P,T){var M,R,B,U,W,Z,H,K,re,se,ge=C[0],me=C[1],pe=C[2],Ee=T[0],ye=T[1],Pe=T[2],Le=P[0],Re=P[1],Ne=P[2];return Math.abs(ge-Le)<r.EPSILON&&Math.abs(me-Re)<r.EPSILON&&Math.abs(pe-Ne)<r.EPSILON?u(x):(H=ge-Le,K=me-Re,re=pe-Ne,M=ye*(re*=se=1/Math.hypot(H,K,re))-Pe*(K*=se),R=Pe*(H*=se)-Ee*re,B=Ee*K-ye*H,(se=Math.hypot(M,R,B))?(M*=se=1/se,R*=se,B*=se):(M=0,R=0,B=0),U=K*B-re*R,W=re*M-H*B,Z=H*R-K*M,(se=Math.hypot(U,W,Z))?(U*=se=1/se,W*=se,Z*=se):(U=0,W=0,Z=0),x[0]=M,x[1]=U,x[2]=H,x[3]=0,x[4]=R,x[5]=W,x[6]=K,x[7]=0,x[8]=B,x[9]=Z,x[10]=re,x[11]=0,x[12]=-(M*ge+R*me+B*pe),x[13]=-(U*ge+W*me+Z*pe),x[14]=-(H*ge+K*me+re*pe),x[15]=1,x)},Ce.targetTo=function(x,C,P,T){var M=C[0],R=C[1],B=C[2],U=T[0],W=T[1],Z=T[2],H=M-P[0],K=R-P[1],re=B-P[2],se=H*H+K*K+re*re;se>0&&(H*=se=1/Math.sqrt(se),K*=se,re*=se);var ge=W*re-Z*K,me=Z*H-U*re,pe=U*K-W*H;return(se=ge*ge+me*me+pe*pe)>0&&(ge*=se=1/Math.sqrt(se),me*=se,pe*=se),x[0]=ge,x[1]=me,x[2]=pe,x[3]=0,x[4]=K*pe-re*me,x[5]=re*ge-H*pe,x[6]=H*me-K*ge,x[7]=0,x[8]=H,x[9]=K,x[10]=re,x[11]=0,x[12]=M,x[13]=R,x[14]=B,x[15]=1,x},Ce.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},Ce.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},Ce.add=function(x,C,P){return x[0]=C[0]+P[0],x[1]=C[1]+P[1],x[2]=C[2]+P[2],x[3]=C[3]+P[3],x[4]=C[4]+P[4],x[5]=C[5]+P[5],x[6]=C[6]+P[6],x[7]=C[7]+P[7],x[8]=C[8]+P[8],x[9]=C[9]+P[9],x[10]=C[10]+P[10],x[11]=C[11]+P[11],x[12]=C[12]+P[12],x[13]=C[13]+P[13],x[14]=C[14]+P[14],x[15]=C[15]+P[15],x},Ce.subtract=I,Ce.multiplyScalar=function(x,C,P){return x[0]=C[0]*P,x[1]=C[1]*P,x[2]=C[2]*P,x[3]=C[3]*P,x[4]=C[4]*P,x[5]=C[5]*P,x[6]=C[6]*P,x[7]=C[7]*P,x[8]=C[8]*P,x[9]=C[9]*P,x[10]=C[10]*P,x[11]=C[11]*P,x[12]=C[12]*P,x[13]=C[13]*P,x[14]=C[14]*P,x[15]=C[15]*P,x},Ce.multiplyScalarAndAdd=function(x,C,P,T){return x[0]=C[0]+P[0]*T,x[1]=C[1]+P[1]*T,x[2]=C[2]+P[2]*T,x[3]=C[3]+P[3]*T,x[4]=C[4]+P[4]*T,x[5]=C[5]+P[5]*T,x[6]=C[6]+P[6]*T,x[7]=C[7]+P[7]*T,x[8]=C[8]+P[8]*T,x[9]=C[9]+P[9]*T,x[10]=C[10]+P[10]*T,x[11]=C[11]+P[11]*T,x[12]=C[12]+P[12]*T,x[13]=C[13]+P[13]*T,x[14]=C[14]+P[14]*T,x[15]=C[15]+P[15]*T,x},Ce.exactEquals=function(x,C){return x[0]===C[0]&&x[1]===C[1]&&x[2]===C[2]&&x[3]===C[3]&&x[4]===C[4]&&x[5]===C[5]&&x[6]===C[6]&&x[7]===C[7]&&x[8]===C[8]&&x[9]===C[9]&&x[10]===C[10]&&x[11]===C[11]&&x[12]===C[12]&&x[13]===C[13]&&x[14]===C[14]&&x[15]===C[15]},Ce.equals=function(x,C){var P=x[0],T=x[1],M=x[2],R=x[3],B=x[4],U=x[5],W=x[6],Z=x[7],H=x[8],K=x[9],re=x[10],se=x[11],ge=x[12],me=x[13],pe=x[14],Ee=x[15],ye=C[0],Pe=C[1],Le=C[2],Re=C[3],Ne=C[4],Ve=C[5],We=C[6],Be=C[7],lt=C[8],bt=C[9],ct=C[10],It=C[11],At=C[12],Nt=C[13],pt=C[14],Jt=C[15];return Math.abs(P-ye)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(ye))&&Math.abs(T-Pe)<=r.EPSILON*Math.max(1,Math.abs(T),Math.abs(Pe))&&Math.abs(M-Le)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(Le))&&Math.abs(R-Re)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(Re))&&Math.abs(B-Ne)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(Ne))&&Math.abs(U-Ve)<=r.EPSILON*Math.max(1,Math.abs(U),Math.abs(Ve))&&Math.abs(W-We)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(We))&&Math.abs(Z-Be)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Be))&&Math.abs(H-lt)<=r.EPSILON*Math.max(1,Math.abs(H),Math.abs(lt))&&Math.abs(K-bt)<=r.EPSILON*Math.max(1,Math.abs(K),Math.abs(bt))&&Math.abs(re-ct)<=r.EPSILON*Math.max(1,Math.abs(re),Math.abs(ct))&&Math.abs(se-It)<=r.EPSILON*Math.max(1,Math.abs(se),Math.abs(It))&&Math.abs(ge-At)<=r.EPSILON*Math.max(1,Math.abs(ge),Math.abs(At))&&Math.abs(me-Nt)<=r.EPSILON*Math.max(1,Math.abs(me),Math.abs(Nt))&&Math.abs(pe-pt)<=r.EPSILON*Math.max(1,Math.abs(pe),Math.abs(pt))&&Math.abs(Ee-Jt)<=r.EPSILON*Math.max(1,Math.abs(Ee),Math.abs(Jt))},Ce.sub=Ce.mul=Ce.ortho=Ce.perspective=void 0;var r=function(x,C){if(x&&x.__esModule)return x;if(x===null||c(x)!=="object"&&typeof x!="function")return{default:x};var P=s(void 0);if(P&&P.has(x))return P.get(x);var T={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var B=M?Object.getOwnPropertyDescriptor(x,R):null;B&&(B.get||B.set)?Object.defineProperty(T,R,B):T[R]=x[R]}return T.default=x,P&&P.set(x,T),T}(G());function s(x){if(typeof WeakMap!="function")return null;var C=new WeakMap,P=new WeakMap;return(s=function(T){return T?P:C})(x)}function u(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function m(x,C,P){var T=C[0],M=C[1],R=C[2],B=C[3],U=C[4],W=C[5],Z=C[6],H=C[7],K=C[8],re=C[9],se=C[10],ge=C[11],me=C[12],pe=C[13],Ee=C[14],ye=C[15],Pe=P[0],Le=P[1],Re=P[2],Ne=P[3];return x[0]=Pe*T+Le*U+Re*K+Ne*me,x[1]=Pe*M+Le*W+Re*re+Ne*pe,x[2]=Pe*R+Le*Z+Re*se+Ne*Ee,x[3]=Pe*B+Le*H+Re*ge+Ne*ye,x[4]=(Pe=P[4])*T+(Le=P[5])*U+(Re=P[6])*K+(Ne=P[7])*me,x[5]=Pe*M+Le*W+Re*re+Ne*pe,x[6]=Pe*R+Le*Z+Re*se+Ne*Ee,x[7]=Pe*B+Le*H+Re*ge+Ne*ye,x[8]=(Pe=P[8])*T+(Le=P[9])*U+(Re=P[10])*K+(Ne=P[11])*me,x[9]=Pe*M+Le*W+Re*re+Ne*pe,x[10]=Pe*R+Le*Z+Re*se+Ne*Ee,x[11]=Pe*B+Le*H+Re*ge+Ne*ye,x[12]=(Pe=P[12])*T+(Le=P[13])*U+(Re=P[14])*K+(Ne=P[15])*me,x[13]=Pe*M+Le*W+Re*re+Ne*pe,x[14]=Pe*R+Le*Z+Re*se+Ne*Ee,x[15]=Pe*B+Le*H+Re*ge+Ne*ye,x}function h(x,C,P){var T=C[0],M=C[1],R=C[2],B=C[3],U=T+T,W=M+M,Z=R+R,H=T*U,K=T*W,re=T*Z,se=M*W,ge=M*Z,me=R*Z,pe=B*U,Ee=B*W,ye=B*Z;return x[0]=1-(se+me),x[1]=K+ye,x[2]=re-Ee,x[3]=0,x[4]=K-ye,x[5]=1-(H+me),x[6]=ge+pe,x[7]=0,x[8]=re+Ee,x[9]=ge-pe,x[10]=1-(H+se),x[11]=0,x[12]=P[0],x[13]=P[1],x[14]=P[2],x[15]=1,x}function g(x,C){var P=C[4],T=C[5],M=C[6],R=C[8],B=C[9],U=C[10];return x[0]=Math.hypot(C[0],C[1],C[2]),x[1]=Math.hypot(P,T,M),x[2]=Math.hypot(R,B,U),x}function w(x,C,P,T,M){var R,B=1/Math.tan(C/2);return x[0]=B/P,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=B,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,M!=null&&M!==1/0?(x[10]=(M+T)*(R=1/(T-M)),x[14]=2*M*T*R):(x[10]=-1,x[14]=-2*T),x}function E(x,C,P,T,M,R,B){var U=1/(C-P),W=1/(T-M),Z=1/(R-B);return x[0]=-2*U,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*W,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*Z,x[11]=0,x[12]=(C+P)*U,x[13]=(M+T)*W,x[14]=(B+R)*Z,x[15]=1,x}function I(x,C,P){return x[0]=C[0]-P[0],x[1]=C[1]-P[1],x[2]=C[2]-P[2],x[3]=C[3]-P[3],x[4]=C[4]-P[4],x[5]=C[5]-P[5],x[6]=C[6]-P[6],x[7]=C[7]-P[7],x[8]=C[8]-P[8],x[9]=C[9]-P[9],x[10]=C[10]-P[10],x[11]=C[11]-P[11],x[12]=C[12]-P[12],x[13]=C[13]-P[13],x[14]=C[14]-P[14],x[15]=C[15]-P[15],x}return Ce.perspective=w,Ce.ortho=E,Ce.mul=m,Ce.sub=I,Ce}var et,Ge={},qe={};function _t(){if(et)return qe;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},c(M)}et=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=u,qe.clone=function(M){var R=new r.ARRAY_TYPE(3);return R[0]=M[0],R[1]=M[1],R[2]=M[2],R},qe.length=m,qe.fromValues=function(M,R,B){var U=new r.ARRAY_TYPE(3);return U[0]=M,U[1]=R,U[2]=B,U},qe.copy=function(M,R){return M[0]=R[0],M[1]=R[1],M[2]=R[2],M},qe.set=function(M,R,B,U){return M[0]=R,M[1]=B,M[2]=U,M},qe.add=function(M,R,B){return M[0]=R[0]+B[0],M[1]=R[1]+B[1],M[2]=R[2]+B[2],M},qe.subtract=h,qe.multiply=g,qe.divide=w,qe.ceil=function(M,R){return M[0]=Math.ceil(R[0]),M[1]=Math.ceil(R[1]),M[2]=Math.ceil(R[2]),M},qe.floor=function(M,R){return M[0]=Math.floor(R[0]),M[1]=Math.floor(R[1]),M[2]=Math.floor(R[2]),M},qe.min=function(M,R,B){return M[0]=Math.min(R[0],B[0]),M[1]=Math.min(R[1],B[1]),M[2]=Math.min(R[2],B[2]),M},qe.max=function(M,R,B){return M[0]=Math.max(R[0],B[0]),M[1]=Math.max(R[1],B[1]),M[2]=Math.max(R[2],B[2]),M},qe.round=function(M,R){return M[0]=Math.round(R[0]),M[1]=Math.round(R[1]),M[2]=Math.round(R[2]),M},qe.scale=function(M,R,B){return M[0]=R[0]*B,M[1]=R[1]*B,M[2]=R[2]*B,M},qe.scaleAndAdd=function(M,R,B,U){return M[0]=R[0]+B[0]*U,M[1]=R[1]+B[1]*U,M[2]=R[2]+B[2]*U,M},qe.distance=E,qe.squaredDistance=I,qe.squaredLength=x,qe.negate=function(M,R){return M[0]=-R[0],M[1]=-R[1],M[2]=-R[2],M},qe.inverse=function(M,R){return M[0]=1/R[0],M[1]=1/R[1],M[2]=1/R[2],M},qe.normalize=function(M,R){var B=R[0],U=R[1],W=R[2],Z=B*B+U*U+W*W;return Z>0&&(Z=1/Math.sqrt(Z)),M[0]=R[0]*Z,M[1]=R[1]*Z,M[2]=R[2]*Z,M},qe.dot=C,qe.cross=function(M,R,B){var U=R[0],W=R[1],Z=R[2],H=B[0],K=B[1],re=B[2];return M[0]=W*re-Z*K,M[1]=Z*H-U*re,M[2]=U*K-W*H,M},qe.lerp=function(M,R,B,U){var W=R[0],Z=R[1],H=R[2];return M[0]=W+U*(B[0]-W),M[1]=Z+U*(B[1]-Z),M[2]=H+U*(B[2]-H),M},qe.hermite=function(M,R,B,U,W,Z){var H=Z*Z,K=H*(2*Z-3)+1,re=H*(Z-2)+Z,se=H*(Z-1),ge=H*(3-2*Z);return M[0]=R[0]*K+B[0]*re+U[0]*se+W[0]*ge,M[1]=R[1]*K+B[1]*re+U[1]*se+W[1]*ge,M[2]=R[2]*K+B[2]*re+U[2]*se+W[2]*ge,M},qe.bezier=function(M,R,B,U,W,Z){var H=1-Z,K=H*H,re=Z*Z,se=K*H,ge=3*Z*K,me=3*re*H,pe=re*Z;return M[0]=R[0]*se+B[0]*ge+U[0]*me+W[0]*pe,M[1]=R[1]*se+B[1]*ge+U[1]*me+W[1]*pe,M[2]=R[2]*se+B[2]*ge+U[2]*me+W[2]*pe,M},qe.random=function(M,R){R=R||1;var B=2*r.RANDOM()*Math.PI,U=2*r.RANDOM()-1,W=Math.sqrt(1-U*U)*R;return M[0]=Math.cos(B)*W,M[1]=Math.sin(B)*W,M[2]=U*R,M},qe.transformMat4=function(M,R,B){var U=R[0],W=R[1],Z=R[2],H=B[3]*U+B[7]*W+B[11]*Z+B[15];return M[0]=(B[0]*U+B[4]*W+B[8]*Z+B[12])/(H=H||1),M[1]=(B[1]*U+B[5]*W+B[9]*Z+B[13])/H,M[2]=(B[2]*U+B[6]*W+B[10]*Z+B[14])/H,M},qe.transformMat3=function(M,R,B){var U=R[0],W=R[1],Z=R[2];return M[0]=U*B[0]+W*B[3]+Z*B[6],M[1]=U*B[1]+W*B[4]+Z*B[7],M[2]=U*B[2]+W*B[5]+Z*B[8],M},qe.transformQuat=function(M,R,B){var U=B[0],W=B[1],Z=B[2],H=R[0],K=R[1],re=R[2],se=W*re-Z*K,ge=Z*H-U*re,me=U*K-W*H,pe=W*me-Z*ge,Ee=Z*se-U*me,ye=U*ge-W*se,Pe=2*B[3];return ge*=Pe,me*=Pe,Ee*=2,ye*=2,M[0]=H+(se*=Pe)+(pe*=2),M[1]=K+ge+Ee,M[2]=re+me+ye,M},qe.rotateX=function(M,R,B,U){var W=[],Z=[];return W[0]=R[0]-B[0],W[1]=R[1]-B[1],W[2]=R[2]-B[2],Z[0]=W[0],Z[1]=W[1]*Math.cos(U)-W[2]*Math.sin(U),Z[2]=W[1]*Math.sin(U)+W[2]*Math.cos(U),M[0]=Z[0]+B[0],M[1]=Z[1]+B[1],M[2]=Z[2]+B[2],M},qe.rotateY=function(M,R,B,U){var W=[],Z=[];return W[0]=R[0]-B[0],W[1]=R[1]-B[1],W[2]=R[2]-B[2],Z[0]=W[2]*Math.sin(U)+W[0]*Math.cos(U),Z[1]=W[1],Z[2]=W[2]*Math.cos(U)-W[0]*Math.sin(U),M[0]=Z[0]+B[0],M[1]=Z[1]+B[1],M[2]=Z[2]+B[2],M},qe.rotateZ=function(M,R,B,U){var W=[],Z=[];return W[0]=R[0]-B[0],W[1]=R[1]-B[1],W[2]=R[2]-B[2],Z[0]=W[0]*Math.cos(U)-W[1]*Math.sin(U),Z[1]=W[0]*Math.sin(U)+W[1]*Math.cos(U),Z[2]=W[2],M[0]=Z[0]+B[0],M[1]=Z[1]+B[1],M[2]=Z[2]+B[2],M},qe.angle=function(M,R){var B=M[0],U=M[1],W=M[2],Z=R[0],H=R[1],K=R[2],re=Math.sqrt(B*B+U*U+W*W)*Math.sqrt(Z*Z+H*H+K*K),se=re&&C(M,R)/re;return Math.acos(Math.min(Math.max(se,-1),1))},qe.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},qe.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},qe.exactEquals=function(M,R){return M[0]===R[0]&&M[1]===R[1]&&M[2]===R[2]},qe.equals=function(M,R){var B=M[0],U=M[1],W=M[2],Z=R[0],H=R[1],K=R[2];return Math.abs(B-Z)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(Z))&&Math.abs(U-H)<=r.EPSILON*Math.max(1,Math.abs(U),Math.abs(H))&&Math.abs(W-K)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(K))},qe.forEach=qe.sqrLen=qe.len=qe.sqrDist=qe.dist=qe.div=qe.mul=qe.sub=void 0;var r=function(M,R){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var B=s(void 0);if(B&&B.has(M))return B.get(M);var U={},W=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in M)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(M,Z)){var H=W?Object.getOwnPropertyDescriptor(M,Z):null;H&&(H.get||H.set)?Object.defineProperty(U,Z,H):U[Z]=M[Z]}return U.default=M,B&&B.set(M,U),U}(G());function s(M){if(typeof WeakMap!="function")return null;var R=new WeakMap,B=new WeakMap;return(s=function(U){return U?B:R})(M)}function u(){var M=new r.ARRAY_TYPE(3);return r.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function m(M){return Math.hypot(M[0],M[1],M[2])}function h(M,R,B){return M[0]=R[0]-B[0],M[1]=R[1]-B[1],M[2]=R[2]-B[2],M}function g(M,R,B){return M[0]=R[0]*B[0],M[1]=R[1]*B[1],M[2]=R[2]*B[2],M}function w(M,R,B){return M[0]=R[0]/B[0],M[1]=R[1]/B[1],M[2]=R[2]/B[2],M}function E(M,R){return Math.hypot(R[0]-M[0],R[1]-M[1],R[2]-M[2])}function I(M,R){var B=R[0]-M[0],U=R[1]-M[1],W=R[2]-M[2];return B*B+U*U+W*W}function x(M){var R=M[0],B=M[1],U=M[2];return R*R+B*B+U*U}function C(M,R){return M[0]*R[0]+M[1]*R[1]+M[2]*R[2]}qe.sub=h,qe.mul=g,qe.div=w,qe.dist=E,qe.sqrDist=I,qe.len=m,qe.sqrLen=x;var P,T=(P=u(),function(M,R,B,U,W,Z){var H,K;for(R||(R=3),B||(B=0),K=U?Math.min(U*R+B,M.length):M.length,H=B;H<K;H+=R)P[0]=M[H],P[1]=M[H+1],P[2]=M[H+2],W(P,P,Z),M[H]=P[0],M[H+1]=P[1],M[H+2]=P[2];return M});return qe.forEach=T,qe}var Rt,Wt,wt={};function jt(){if(Rt)return wt;function c(T){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(T)}Rt=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.create=u,wt.clone=function(T){var M=new r.ARRAY_TYPE(4);return M[0]=T[0],M[1]=T[1],M[2]=T[2],M[3]=T[3],M},wt.fromValues=function(T,M,R,B){var U=new r.ARRAY_TYPE(4);return U[0]=T,U[1]=M,U[2]=R,U[3]=B,U},wt.copy=function(T,M){return T[0]=M[0],T[1]=M[1],T[2]=M[2],T[3]=M[3],T},wt.set=function(T,M,R,B,U){return T[0]=M,T[1]=R,T[2]=B,T[3]=U,T},wt.add=function(T,M,R){return T[0]=M[0]+R[0],T[1]=M[1]+R[1],T[2]=M[2]+R[2],T[3]=M[3]+R[3],T},wt.subtract=m,wt.multiply=h,wt.divide=g,wt.ceil=function(T,M){return T[0]=Math.ceil(M[0]),T[1]=Math.ceil(M[1]),T[2]=Math.ceil(M[2]),T[3]=Math.ceil(M[3]),T},wt.floor=function(T,M){return T[0]=Math.floor(M[0]),T[1]=Math.floor(M[1]),T[2]=Math.floor(M[2]),T[3]=Math.floor(M[3]),T},wt.min=function(T,M,R){return T[0]=Math.min(M[0],R[0]),T[1]=Math.min(M[1],R[1]),T[2]=Math.min(M[2],R[2]),T[3]=Math.min(M[3],R[3]),T},wt.max=function(T,M,R){return T[0]=Math.max(M[0],R[0]),T[1]=Math.max(M[1],R[1]),T[2]=Math.max(M[2],R[2]),T[3]=Math.max(M[3],R[3]),T},wt.round=function(T,M){return T[0]=Math.round(M[0]),T[1]=Math.round(M[1]),T[2]=Math.round(M[2]),T[3]=Math.round(M[3]),T},wt.scale=function(T,M,R){return T[0]=M[0]*R,T[1]=M[1]*R,T[2]=M[2]*R,T[3]=M[3]*R,T},wt.scaleAndAdd=function(T,M,R,B){return T[0]=M[0]+R[0]*B,T[1]=M[1]+R[1]*B,T[2]=M[2]+R[2]*B,T[3]=M[3]+R[3]*B,T},wt.distance=w,wt.squaredDistance=E,wt.length=I,wt.squaredLength=x,wt.negate=function(T,M){return T[0]=-M[0],T[1]=-M[1],T[2]=-M[2],T[3]=-M[3],T},wt.inverse=function(T,M){return T[0]=1/M[0],T[1]=1/M[1],T[2]=1/M[2],T[3]=1/M[3],T},wt.normalize=function(T,M){var R=M[0],B=M[1],U=M[2],W=M[3],Z=R*R+B*B+U*U+W*W;return Z>0&&(Z=1/Math.sqrt(Z)),T[0]=R*Z,T[1]=B*Z,T[2]=U*Z,T[3]=W*Z,T},wt.dot=function(T,M){return T[0]*M[0]+T[1]*M[1]+T[2]*M[2]+T[3]*M[3]},wt.cross=function(T,M,R,B){var U=R[0]*B[1]-R[1]*B[0],W=R[0]*B[2]-R[2]*B[0],Z=R[0]*B[3]-R[3]*B[0],H=R[1]*B[2]-R[2]*B[1],K=R[1]*B[3]-R[3]*B[1],re=R[2]*B[3]-R[3]*B[2],se=M[0],ge=M[1],me=M[2],pe=M[3];return T[0]=ge*re-me*K+pe*H,T[1]=-se*re+me*Z-pe*W,T[2]=se*K-ge*Z+pe*U,T[3]=-se*H+ge*W-me*U,T},wt.lerp=function(T,M,R,B){var U=M[0],W=M[1],Z=M[2],H=M[3];return T[0]=U+B*(R[0]-U),T[1]=W+B*(R[1]-W),T[2]=Z+B*(R[2]-Z),T[3]=H+B*(R[3]-H),T},wt.random=function(T,M){var R,B,U,W,Z,H;M=M||1;do Z=(R=2*r.RANDOM()-1)*R+(B=2*r.RANDOM()-1)*B;while(Z>=1);do H=(U=2*r.RANDOM()-1)*U+(W=2*r.RANDOM()-1)*W;while(H>=1);var K=Math.sqrt((1-Z)/H);return T[0]=M*R,T[1]=M*B,T[2]=M*U*K,T[3]=M*W*K,T},wt.transformMat4=function(T,M,R){var B=M[0],U=M[1],W=M[2],Z=M[3];return T[0]=R[0]*B+R[4]*U+R[8]*W+R[12]*Z,T[1]=R[1]*B+R[5]*U+R[9]*W+R[13]*Z,T[2]=R[2]*B+R[6]*U+R[10]*W+R[14]*Z,T[3]=R[3]*B+R[7]*U+R[11]*W+R[15]*Z,T},wt.transformQuat=function(T,M,R){var B=M[0],U=M[1],W=M[2],Z=R[0],H=R[1],K=R[2],re=R[3],se=re*B+H*W-K*U,ge=re*U+K*B-Z*W,me=re*W+Z*U-H*B,pe=-Z*B-H*U-K*W;return T[0]=se*re+pe*-Z+ge*-K-me*-H,T[1]=ge*re+pe*-H+me*-Z-se*-K,T[2]=me*re+pe*-K+se*-H-ge*-Z,T[3]=M[3],T},wt.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},wt.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},wt.exactEquals=function(T,M){return T[0]===M[0]&&T[1]===M[1]&&T[2]===M[2]&&T[3]===M[3]},wt.equals=function(T,M){var R=T[0],B=T[1],U=T[2],W=T[3],Z=M[0],H=M[1],K=M[2],re=M[3];return Math.abs(R-Z)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(Z))&&Math.abs(B-H)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))&&Math.abs(U-K)<=r.EPSILON*Math.max(1,Math.abs(U),Math.abs(K))&&Math.abs(W-re)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(re))},wt.forEach=wt.sqrLen=wt.len=wt.sqrDist=wt.dist=wt.div=wt.mul=wt.sub=void 0;var r=function(T,M){if(T&&T.__esModule)return T;if(T===null||c(T)!=="object"&&typeof T!="function")return{default:T};var R=s(void 0);if(R&&R.has(T))return R.get(T);var B={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in T)if(W!=="default"&&Object.prototype.hasOwnProperty.call(T,W)){var Z=U?Object.getOwnPropertyDescriptor(T,W):null;Z&&(Z.get||Z.set)?Object.defineProperty(B,W,Z):B[W]=T[W]}return B.default=T,R&&R.set(T,B),B}(G());function s(T){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(s=function(B){return B?R:M})(T)}function u(){var T=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function m(T,M,R){return T[0]=M[0]-R[0],T[1]=M[1]-R[1],T[2]=M[2]-R[2],T[3]=M[3]-R[3],T}function h(T,M,R){return T[0]=M[0]*R[0],T[1]=M[1]*R[1],T[2]=M[2]*R[2],T[3]=M[3]*R[3],T}function g(T,M,R){return T[0]=M[0]/R[0],T[1]=M[1]/R[1],T[2]=M[2]/R[2],T[3]=M[3]/R[3],T}function w(T,M){return Math.hypot(M[0]-T[0],M[1]-T[1],M[2]-T[2],M[3]-T[3])}function E(T,M){var R=M[0]-T[0],B=M[1]-T[1],U=M[2]-T[2],W=M[3]-T[3];return R*R+B*B+U*U+W*W}function I(T){return Math.hypot(T[0],T[1],T[2],T[3])}function x(T){var M=T[0],R=T[1],B=T[2],U=T[3];return M*M+R*R+B*B+U*U}wt.sub=m,wt.mul=h,wt.div=g,wt.dist=w,wt.sqrDist=E,wt.len=I,wt.sqrLen=x;var C,P=(C=u(),function(T,M,R,B,U,W){var Z,H;for(M||(M=4),R||(R=0),H=B?Math.min(B*M+R,T.length):T.length,Z=R;Z<H;Z+=M)C[0]=T[Z],C[1]=T[Z+1],C[2]=T[Z+2],C[3]=T[Z+3],U(C,C,W),T[Z]=C[0],T[Z+1]=C[1],T[Z+2]=C[2],T[Z+3]=C[3];return T});return wt.forEach=P,wt}function Ct(){if(Wt)return Ge;function c(ye){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Pe){return typeof Pe}:function(Pe){return Pe&&typeof Symbol=="function"&&Pe.constructor===Symbol&&Pe!==Symbol.prototype?"symbol":typeof Pe},c(ye)}Wt=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.create=w,Ge.identity=function(ye){return ye[0]=0,ye[1]=0,ye[2]=0,ye[3]=1,ye},Ge.setAxisAngle=E,Ge.getAxisAngle=function(ye,Pe){var Le=2*Math.acos(Pe[3]),Re=Math.sin(Le/2);return Re>r.EPSILON?(ye[0]=Pe[0]/Re,ye[1]=Pe[1]/Re,ye[2]=Pe[2]/Re):(ye[0]=1,ye[1]=0,ye[2]=0),Le},Ge.getAngle=function(ye,Pe){var Le=R(ye,Pe);return Math.acos(2*Le*Le-1)},Ge.multiply=I,Ge.rotateX=function(ye,Pe,Le){Le*=.5;var Re=Pe[0],Ne=Pe[1],Ve=Pe[2],We=Pe[3],Be=Math.sin(Le),lt=Math.cos(Le);return ye[0]=Re*lt+We*Be,ye[1]=Ne*lt+Ve*Be,ye[2]=Ve*lt-Ne*Be,ye[3]=We*lt-Re*Be,ye},Ge.rotateY=function(ye,Pe,Le){Le*=.5;var Re=Pe[0],Ne=Pe[1],Ve=Pe[2],We=Pe[3],Be=Math.sin(Le),lt=Math.cos(Le);return ye[0]=Re*lt-Ve*Be,ye[1]=Ne*lt+We*Be,ye[2]=Ve*lt+Re*Be,ye[3]=We*lt-Ne*Be,ye},Ge.rotateZ=function(ye,Pe,Le){Le*=.5;var Re=Pe[0],Ne=Pe[1],Ve=Pe[2],We=Pe[3],Be=Math.sin(Le),lt=Math.cos(Le);return ye[0]=Re*lt+Ne*Be,ye[1]=Ne*lt-Re*Be,ye[2]=Ve*lt+We*Be,ye[3]=We*lt-Ve*Be,ye},Ge.calculateW=function(ye,Pe){var Le=Pe[0],Re=Pe[1],Ne=Pe[2];return ye[0]=Le,ye[1]=Re,ye[2]=Ne,ye[3]=Math.sqrt(Math.abs(1-Le*Le-Re*Re-Ne*Ne)),ye},Ge.exp=x,Ge.ln=C,Ge.pow=function(ye,Pe,Le){return C(ye,Pe),M(ye,ye,Le),x(ye,ye),ye},Ge.slerp=P,Ge.random=function(ye){var Pe=r.RANDOM(),Le=r.RANDOM(),Re=r.RANDOM(),Ne=Math.sqrt(1-Pe),Ve=Math.sqrt(Pe);return ye[0]=Ne*Math.sin(2*Math.PI*Le),ye[1]=Ne*Math.cos(2*Math.PI*Le),ye[2]=Ve*Math.sin(2*Math.PI*Re),ye[3]=Ve*Math.cos(2*Math.PI*Re),ye},Ge.invert=function(ye,Pe){var Le=Pe[0],Re=Pe[1],Ne=Pe[2],Ve=Pe[3],We=Le*Le+Re*Re+Ne*Ne+Ve*Ve,Be=We?1/We:0;return ye[0]=-Le*Be,ye[1]=-Re*Be,ye[2]=-Ne*Be,ye[3]=Ve*Be,ye},Ge.conjugate=function(ye,Pe){return ye[0]=-Pe[0],ye[1]=-Pe[1],ye[2]=-Pe[2],ye[3]=Pe[3],ye},Ge.fromMat3=T,Ge.fromEuler=function(ye,Pe,Le,Re){var Ne=.5*Math.PI/180;Pe*=Ne,Le*=Ne,Re*=Ne;var Ve=Math.sin(Pe),We=Math.cos(Pe),Be=Math.sin(Le),lt=Math.cos(Le),bt=Math.sin(Re),ct=Math.cos(Re);return ye[0]=Ve*lt*ct-We*Be*bt,ye[1]=We*Be*ct+Ve*lt*bt,ye[2]=We*lt*bt-Ve*Be*ct,ye[3]=We*lt*ct+Ve*Be*bt,ye},Ge.str=function(ye){return"quat("+ye[0]+", "+ye[1]+", "+ye[2]+", "+ye[3]+")"},Ge.setAxes=Ge.sqlerp=Ge.rotationTo=Ge.equals=Ge.exactEquals=Ge.normalize=Ge.sqrLen=Ge.squaredLength=Ge.len=Ge.length=Ge.lerp=Ge.dot=Ge.scale=Ge.mul=Ge.add=Ge.set=Ge.copy=Ge.fromValues=Ge.clone=void 0;var r=g(G()),s=g(Ie()),u=g(_t()),m=g(jt());function h(ye){if(typeof WeakMap!="function")return null;var Pe=new WeakMap,Le=new WeakMap;return(h=function(Re){return Re?Le:Pe})(ye)}function g(ye,Pe){if(ye&&ye.__esModule)return ye;if(ye===null||c(ye)!=="object"&&typeof ye!="function")return{default:ye};var Le=h(Pe);if(Le&&Le.has(ye))return Le.get(ye);var Re={},Ne=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ve in ye)if(Ve!=="default"&&Object.prototype.hasOwnProperty.call(ye,Ve)){var We=Ne?Object.getOwnPropertyDescriptor(ye,Ve):null;We&&(We.get||We.set)?Object.defineProperty(Re,Ve,We):Re[Ve]=ye[Ve]}return Re.default=ye,Le&&Le.set(ye,Re),Re}function w(){var ye=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(ye[0]=0,ye[1]=0,ye[2]=0),ye[3]=1,ye}function E(ye,Pe,Le){Le*=.5;var Re=Math.sin(Le);return ye[0]=Re*Pe[0],ye[1]=Re*Pe[1],ye[2]=Re*Pe[2],ye[3]=Math.cos(Le),ye}function I(ye,Pe,Le){var Re=Pe[0],Ne=Pe[1],Ve=Pe[2],We=Pe[3],Be=Le[0],lt=Le[1],bt=Le[2],ct=Le[3];return ye[0]=Re*ct+We*Be+Ne*bt-Ve*lt,ye[1]=Ne*ct+We*lt+Ve*Be-Re*bt,ye[2]=Ve*ct+We*bt+Re*lt-Ne*Be,ye[3]=We*ct-Re*Be-Ne*lt-Ve*bt,ye}function x(ye,Pe){var Le=Pe[0],Re=Pe[1],Ne=Pe[2],Ve=Pe[3],We=Math.sqrt(Le*Le+Re*Re+Ne*Ne),Be=Math.exp(Ve),lt=We>0?Be*Math.sin(We)/We:0;return ye[0]=Le*lt,ye[1]=Re*lt,ye[2]=Ne*lt,ye[3]=Be*Math.cos(We),ye}function C(ye,Pe){var Le=Pe[0],Re=Pe[1],Ne=Pe[2],Ve=Pe[3],We=Math.sqrt(Le*Le+Re*Re+Ne*Ne),Be=We>0?Math.atan2(We,Ve)/We:0;return ye[0]=Le*Be,ye[1]=Re*Be,ye[2]=Ne*Be,ye[3]=.5*Math.log(Le*Le+Re*Re+Ne*Ne+Ve*Ve),ye}function P(ye,Pe,Le,Re){var Ne,Ve,We,Be,lt,bt=Pe[0],ct=Pe[1],It=Pe[2],At=Pe[3],Nt=Le[0],pt=Le[1],Jt=Le[2],kt=Le[3];return(Ve=bt*Nt+ct*pt+It*Jt+At*kt)<0&&(Ve=-Ve,Nt=-Nt,pt=-pt,Jt=-Jt,kt=-kt),1-Ve>r.EPSILON?(Ne=Math.acos(Ve),We=Math.sin(Ne),Be=Math.sin((1-Re)*Ne)/We,lt=Math.sin(Re*Ne)/We):(Be=1-Re,lt=Re),ye[0]=Be*bt+lt*Nt,ye[1]=Be*ct+lt*pt,ye[2]=Be*It+lt*Jt,ye[3]=Be*At+lt*kt,ye}function T(ye,Pe){var Le,Re=Pe[0]+Pe[4]+Pe[8];if(Re>0)Le=Math.sqrt(Re+1),ye[3]=.5*Le,ye[0]=(Pe[5]-Pe[7])*(Le=.5/Le),ye[1]=(Pe[6]-Pe[2])*Le,ye[2]=(Pe[1]-Pe[3])*Le;else{var Ne=0;Pe[4]>Pe[0]&&(Ne=1),Pe[8]>Pe[3*Ne+Ne]&&(Ne=2);var Ve=(Ne+1)%3,We=(Ne+2)%3;Le=Math.sqrt(Pe[3*Ne+Ne]-Pe[3*Ve+Ve]-Pe[3*We+We]+1),ye[Ne]=.5*Le,ye[3]=(Pe[3*Ve+We]-Pe[3*We+Ve])*(Le=.5/Le),ye[Ve]=(Pe[3*Ve+Ne]+Pe[3*Ne+Ve])*Le,ye[We]=(Pe[3*We+Ne]+Pe[3*Ne+We])*Le}return ye}Ge.clone=m.clone,Ge.fromValues=m.fromValues,Ge.copy=m.copy,Ge.set=m.set,Ge.add=m.add,Ge.mul=I;var M=m.scale;Ge.scale=M;var R=m.dot;Ge.dot=R,Ge.lerp=m.lerp;var B=m.length;Ge.length=B,Ge.len=B;var U=m.squaredLength;Ge.squaredLength=U,Ge.sqrLen=U;var W=m.normalize;Ge.normalize=W,Ge.exactEquals=m.exactEquals,Ge.equals=m.equals;var Z,H,K,re=(Z=u.create(),H=u.fromValues(1,0,0),K=u.fromValues(0,1,0),function(ye,Pe,Le){var Re=u.dot(Pe,Le);return Re<-.999999?(u.cross(Z,H,Pe),u.len(Z)<1e-6&&u.cross(Z,K,Pe),u.normalize(Z,Z),E(ye,Z,Math.PI),ye):Re>.999999?(ye[0]=0,ye[1]=0,ye[2]=0,ye[3]=1,ye):(u.cross(Z,Pe,Le),ye[0]=Z[0],ye[1]=Z[1],ye[2]=Z[2],ye[3]=1+Re,W(ye,ye))});Ge.rotationTo=re;var se,ge,me=(se=w(),ge=w(),function(ye,Pe,Le,Re,Ne,Ve){return P(se,Pe,Ne,Ve),P(ge,Le,Re,Ve),P(ye,se,ge,2*Ve*(1-Ve)),ye});Ge.sqlerp=me;var pe,Ee=(pe=s.create(),function(ye,Pe,Le,Re){return pe[0]=Le[0],pe[3]=Le[1],pe[6]=Le[2],pe[1]=Re[0],pe[4]=Re[1],pe[7]=Re[2],pe[2]=-Pe[0],pe[5]=-Pe[1],pe[8]=-Pe[2],W(ye,T(ye,pe))});return Ge.setAxes=Ee,Ge}var st,yt={};function ir(){if(st)return yt;function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},c(P)}st=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.create=function(){var P=new r.ARRAY_TYPE(8);return r.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0,P[4]=0,P[5]=0,P[6]=0,P[7]=0),P[3]=1,P},yt.clone=function(P){var T=new r.ARRAY_TYPE(8);return T[0]=P[0],T[1]=P[1],T[2]=P[2],T[3]=P[3],T[4]=P[4],T[5]=P[5],T[6]=P[6],T[7]=P[7],T},yt.fromValues=function(P,T,M,R,B,U,W,Z){var H=new r.ARRAY_TYPE(8);return H[0]=P,H[1]=T,H[2]=M,H[3]=R,H[4]=B,H[5]=U,H[6]=W,H[7]=Z,H},yt.fromRotationTranslationValues=function(P,T,M,R,B,U,W){var Z=new r.ARRAY_TYPE(8);Z[0]=P,Z[1]=T,Z[2]=M,Z[3]=R;var H=.5*B,K=.5*U,re=.5*W;return Z[4]=H*R+K*M-re*T,Z[5]=K*R+re*P-H*M,Z[6]=re*R+H*T-K*P,Z[7]=-H*P-K*T-re*M,Z},yt.fromRotationTranslation=g,yt.fromTranslation=function(P,T){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=.5*T[0],P[5]=.5*T[1],P[6]=.5*T[2],P[7]=0,P},yt.fromRotation=function(P,T){return P[0]=T[0],P[1]=T[1],P[2]=T[2],P[3]=T[3],P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},yt.fromMat4=function(P,T){var M=s.create();u.getRotation(M,T);var R=new r.ARRAY_TYPE(3);return u.getTranslation(R,T),g(P,M,R),P},yt.copy=w,yt.identity=function(P){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},yt.set=function(P,T,M,R,B,U,W,Z,H){return P[0]=T,P[1]=M,P[2]=R,P[3]=B,P[4]=U,P[5]=W,P[6]=Z,P[7]=H,P},yt.getDual=function(P,T){return P[0]=T[4],P[1]=T[5],P[2]=T[6],P[3]=T[7],P},yt.setDual=function(P,T){return P[4]=T[0],P[5]=T[1],P[6]=T[2],P[7]=T[3],P},yt.getTranslation=function(P,T){var M=T[4],R=T[5],B=T[6],U=T[7],W=-T[0],Z=-T[1],H=-T[2],K=T[3];return P[0]=2*(M*K+U*W+R*H-B*Z),P[1]=2*(R*K+U*Z+B*W-M*H),P[2]=2*(B*K+U*H+M*Z-R*W),P},yt.translate=function(P,T,M){var R=T[0],B=T[1],U=T[2],W=T[3],Z=.5*M[0],H=.5*M[1],K=.5*M[2],re=T[4],se=T[5],ge=T[6],me=T[7];return P[0]=R,P[1]=B,P[2]=U,P[3]=W,P[4]=W*Z+B*K-U*H+re,P[5]=W*H+U*Z-R*K+se,P[6]=W*K+R*H-B*Z+ge,P[7]=-R*Z-B*H-U*K+me,P},yt.rotateX=function(P,T,M){var R=-T[0],B=-T[1],U=-T[2],W=T[3],Z=T[4],H=T[5],K=T[6],re=T[7],se=Z*W+re*R+H*U-K*B,ge=H*W+re*B+K*R-Z*U,me=K*W+re*U+Z*B-H*R,pe=re*W-Z*R-H*B-K*U;return s.rotateX(P,T,M),P[4]=se*(W=P[3])+pe*(R=P[0])+ge*(U=P[2])-me*(B=P[1]),P[5]=ge*W+pe*B+me*R-se*U,P[6]=me*W+pe*U+se*B-ge*R,P[7]=pe*W-se*R-ge*B-me*U,P},yt.rotateY=function(P,T,M){var R=-T[0],B=-T[1],U=-T[2],W=T[3],Z=T[4],H=T[5],K=T[6],re=T[7],se=Z*W+re*R+H*U-K*B,ge=H*W+re*B+K*R-Z*U,me=K*W+re*U+Z*B-H*R,pe=re*W-Z*R-H*B-K*U;return s.rotateY(P,T,M),P[4]=se*(W=P[3])+pe*(R=P[0])+ge*(U=P[2])-me*(B=P[1]),P[5]=ge*W+pe*B+me*R-se*U,P[6]=me*W+pe*U+se*B-ge*R,P[7]=pe*W-se*R-ge*B-me*U,P},yt.rotateZ=function(P,T,M){var R=-T[0],B=-T[1],U=-T[2],W=T[3],Z=T[4],H=T[5],K=T[6],re=T[7],se=Z*W+re*R+H*U-K*B,ge=H*W+re*B+K*R-Z*U,me=K*W+re*U+Z*B-H*R,pe=re*W-Z*R-H*B-K*U;return s.rotateZ(P,T,M),P[4]=se*(W=P[3])+pe*(R=P[0])+ge*(U=P[2])-me*(B=P[1]),P[5]=ge*W+pe*B+me*R-se*U,P[6]=me*W+pe*U+se*B-ge*R,P[7]=pe*W-se*R-ge*B-me*U,P},yt.rotateByQuatAppend=function(P,T,M){var R=M[0],B=M[1],U=M[2],W=M[3],Z=T[0],H=T[1],K=T[2],re=T[3];return P[0]=Z*W+re*R+H*U-K*B,P[1]=H*W+re*B+K*R-Z*U,P[2]=K*W+re*U+Z*B-H*R,P[3]=re*W-Z*R-H*B-K*U,P[4]=(Z=T[4])*W+(re=T[7])*R+(H=T[5])*U-(K=T[6])*B,P[5]=H*W+re*B+K*R-Z*U,P[6]=K*W+re*U+Z*B-H*R,P[7]=re*W-Z*R-H*B-K*U,P},yt.rotateByQuatPrepend=function(P,T,M){var R=T[0],B=T[1],U=T[2],W=T[3],Z=M[0],H=M[1],K=M[2],re=M[3];return P[0]=R*re+W*Z+B*K-U*H,P[1]=B*re+W*H+U*Z-R*K,P[2]=U*re+W*K+R*H-B*Z,P[3]=W*re-R*Z-B*H-U*K,P[4]=R*(re=M[7])+W*(Z=M[4])+B*(K=M[6])-U*(H=M[5]),P[5]=B*re+W*H+U*Z-R*K,P[6]=U*re+W*K+R*H-B*Z,P[7]=W*re-R*Z-B*H-U*K,P},yt.rotateAroundAxis=function(P,T,M,R){if(Math.abs(R)<r.EPSILON)return w(P,T);var B=Math.hypot(M[0],M[1],M[2]);R*=.5;var U=Math.sin(R),W=U*M[0]/B,Z=U*M[1]/B,H=U*M[2]/B,K=Math.cos(R),re=T[0],se=T[1],ge=T[2],me=T[3];P[0]=re*K+me*W+se*H-ge*Z,P[1]=se*K+me*Z+ge*W-re*H,P[2]=ge*K+me*H+re*Z-se*W,P[3]=me*K-re*W-se*Z-ge*H;var pe=T[4],Ee=T[5],ye=T[6],Pe=T[7];return P[4]=pe*K+Pe*W+Ee*H-ye*Z,P[5]=Ee*K+Pe*Z+ye*W-pe*H,P[6]=ye*K+Pe*H+pe*Z-Ee*W,P[7]=Pe*K-pe*W-Ee*Z-ye*H,P},yt.add=function(P,T,M){return P[0]=T[0]+M[0],P[1]=T[1]+M[1],P[2]=T[2]+M[2],P[3]=T[3]+M[3],P[4]=T[4]+M[4],P[5]=T[5]+M[5],P[6]=T[6]+M[6],P[7]=T[7]+M[7],P},yt.multiply=E,yt.scale=function(P,T,M){return P[0]=T[0]*M,P[1]=T[1]*M,P[2]=T[2]*M,P[3]=T[3]*M,P[4]=T[4]*M,P[5]=T[5]*M,P[6]=T[6]*M,P[7]=T[7]*M,P},yt.lerp=function(P,T,M,R){var B=1-R;return I(T,M)<0&&(R=-R),P[0]=T[0]*B+M[0]*R,P[1]=T[1]*B+M[1]*R,P[2]=T[2]*B+M[2]*R,P[3]=T[3]*B+M[3]*R,P[4]=T[4]*B+M[4]*R,P[5]=T[5]*B+M[5]*R,P[6]=T[6]*B+M[6]*R,P[7]=T[7]*B+M[7]*R,P},yt.invert=function(P,T){var M=C(T);return P[0]=-T[0]/M,P[1]=-T[1]/M,P[2]=-T[2]/M,P[3]=T[3]/M,P[4]=-T[4]/M,P[5]=-T[5]/M,P[6]=-T[6]/M,P[7]=T[7]/M,P},yt.conjugate=function(P,T){return P[0]=-T[0],P[1]=-T[1],P[2]=-T[2],P[3]=T[3],P[4]=-T[4],P[5]=-T[5],P[6]=-T[6],P[7]=T[7],P},yt.normalize=function(P,T){var M=C(T);if(M>0){M=Math.sqrt(M);var R=T[0]/M,B=T[1]/M,U=T[2]/M,W=T[3]/M,Z=T[4],H=T[5],K=T[6],re=T[7],se=R*Z+B*H+U*K+W*re;P[0]=R,P[1]=B,P[2]=U,P[3]=W,P[4]=(Z-R*se)/M,P[5]=(H-B*se)/M,P[6]=(K-U*se)/M,P[7]=(re-W*se)/M}return P},yt.str=function(P){return"quat2("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+", "+P[4]+", "+P[5]+", "+P[6]+", "+P[7]+")"},yt.exactEquals=function(P,T){return P[0]===T[0]&&P[1]===T[1]&&P[2]===T[2]&&P[3]===T[3]&&P[4]===T[4]&&P[5]===T[5]&&P[6]===T[6]&&P[7]===T[7]},yt.equals=function(P,T){var M=P[0],R=P[1],B=P[2],U=P[3],W=P[4],Z=P[5],H=P[6],K=P[7],re=T[0],se=T[1],ge=T[2],me=T[3],pe=T[4],Ee=T[5],ye=T[6],Pe=T[7];return Math.abs(M-re)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(re))&&Math.abs(R-se)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(se))&&Math.abs(B-ge)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(ge))&&Math.abs(U-me)<=r.EPSILON*Math.max(1,Math.abs(U),Math.abs(me))&&Math.abs(W-pe)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(pe))&&Math.abs(Z-Ee)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ee))&&Math.abs(H-ye)<=r.EPSILON*Math.max(1,Math.abs(H),Math.abs(ye))&&Math.abs(K-Pe)<=r.EPSILON*Math.max(1,Math.abs(K),Math.abs(Pe))},yt.sqrLen=yt.squaredLength=yt.len=yt.length=yt.dot=yt.mul=yt.setReal=yt.getReal=void 0;var r=h(G()),s=h(Ct()),u=h(Ze());function m(P){if(typeof WeakMap!="function")return null;var T=new WeakMap,M=new WeakMap;return(m=function(R){return R?M:T})(P)}function h(P,T){if(P&&P.__esModule)return P;if(P===null||c(P)!=="object"&&typeof P!="function")return{default:P};var M=m(T);if(M&&M.has(P))return M.get(P);var R={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in P)if(U!=="default"&&Object.prototype.hasOwnProperty.call(P,U)){var W=B?Object.getOwnPropertyDescriptor(P,U):null;W&&(W.get||W.set)?Object.defineProperty(R,U,W):R[U]=P[U]}return R.default=P,M&&M.set(P,R),R}function g(P,T,M){var R=.5*M[0],B=.5*M[1],U=.5*M[2],W=T[0],Z=T[1],H=T[2],K=T[3];return P[0]=W,P[1]=Z,P[2]=H,P[3]=K,P[4]=R*K+B*H-U*Z,P[5]=B*K+U*W-R*H,P[6]=U*K+R*Z-B*W,P[7]=-R*W-B*Z-U*H,P}function w(P,T){return P[0]=T[0],P[1]=T[1],P[2]=T[2],P[3]=T[3],P[4]=T[4],P[5]=T[5],P[6]=T[6],P[7]=T[7],P}function E(P,T,M){var R=T[0],B=T[1],U=T[2],W=T[3],Z=M[4],H=M[5],K=M[6],re=M[7],se=T[4],ge=T[5],me=T[6],pe=T[7],Ee=M[0],ye=M[1],Pe=M[2],Le=M[3];return P[0]=R*Le+W*Ee+B*Pe-U*ye,P[1]=B*Le+W*ye+U*Ee-R*Pe,P[2]=U*Le+W*Pe+R*ye-B*Ee,P[3]=W*Le-R*Ee-B*ye-U*Pe,P[4]=R*re+W*Z+B*K-U*H+se*Le+pe*Ee+ge*Pe-me*ye,P[5]=B*re+W*H+U*Z-R*K+ge*Le+pe*ye+me*Ee-se*Pe,P[6]=U*re+W*K+R*H-B*Z+me*Le+pe*Pe+se*ye-ge*Ee,P[7]=W*re-R*Z-B*H-U*K+pe*Le-se*Ee-ge*ye-me*Pe,P}yt.getReal=s.copy,yt.setReal=s.copy,yt.mul=E;var I=s.dot;yt.dot=I;var x=s.length;yt.length=x,yt.len=x;var C=s.squaredLength;return yt.squaredLength=C,yt.sqrLen=C,yt}var yr,Wr,rr={};function dn(){if(yr)return rr;function c(T){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(T)}yr=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.create=u,rr.clone=function(T){var M=new r.ARRAY_TYPE(2);return M[0]=T[0],M[1]=T[1],M},rr.fromValues=function(T,M){var R=new r.ARRAY_TYPE(2);return R[0]=T,R[1]=M,R},rr.copy=function(T,M){return T[0]=M[0],T[1]=M[1],T},rr.set=function(T,M,R){return T[0]=M,T[1]=R,T},rr.add=function(T,M,R){return T[0]=M[0]+R[0],T[1]=M[1]+R[1],T},rr.subtract=m,rr.multiply=h,rr.divide=g,rr.ceil=function(T,M){return T[0]=Math.ceil(M[0]),T[1]=Math.ceil(M[1]),T},rr.floor=function(T,M){return T[0]=Math.floor(M[0]),T[1]=Math.floor(M[1]),T},rr.min=function(T,M,R){return T[0]=Math.min(M[0],R[0]),T[1]=Math.min(M[1],R[1]),T},rr.max=function(T,M,R){return T[0]=Math.max(M[0],R[0]),T[1]=Math.max(M[1],R[1]),T},rr.round=function(T,M){return T[0]=Math.round(M[0]),T[1]=Math.round(M[1]),T},rr.scale=function(T,M,R){return T[0]=M[0]*R,T[1]=M[1]*R,T},rr.scaleAndAdd=function(T,M,R,B){return T[0]=M[0]+R[0]*B,T[1]=M[1]+R[1]*B,T},rr.distance=w,rr.squaredDistance=E,rr.length=I,rr.squaredLength=x,rr.negate=function(T,M){return T[0]=-M[0],T[1]=-M[1],T},rr.inverse=function(T,M){return T[0]=1/M[0],T[1]=1/M[1],T},rr.normalize=function(T,M){var R=M[0],B=M[1],U=R*R+B*B;return U>0&&(U=1/Math.sqrt(U)),T[0]=M[0]*U,T[1]=M[1]*U,T},rr.dot=function(T,M){return T[0]*M[0]+T[1]*M[1]},rr.cross=function(T,M,R){var B=M[0]*R[1]-M[1]*R[0];return T[0]=T[1]=0,T[2]=B,T},rr.lerp=function(T,M,R,B){var U=M[0],W=M[1];return T[0]=U+B*(R[0]-U),T[1]=W+B*(R[1]-W),T},rr.random=function(T,M){M=M||1;var R=2*r.RANDOM()*Math.PI;return T[0]=Math.cos(R)*M,T[1]=Math.sin(R)*M,T},rr.transformMat2=function(T,M,R){var B=M[0],U=M[1];return T[0]=R[0]*B+R[2]*U,T[1]=R[1]*B+R[3]*U,T},rr.transformMat2d=function(T,M,R){var B=M[0],U=M[1];return T[0]=R[0]*B+R[2]*U+R[4],T[1]=R[1]*B+R[3]*U+R[5],T},rr.transformMat3=function(T,M,R){var B=M[0],U=M[1];return T[0]=R[0]*B+R[3]*U+R[6],T[1]=R[1]*B+R[4]*U+R[7],T},rr.transformMat4=function(T,M,R){var B=M[0],U=M[1];return T[0]=R[0]*B+R[4]*U+R[12],T[1]=R[1]*B+R[5]*U+R[13],T},rr.rotate=function(T,M,R,B){var U=M[0]-R[0],W=M[1]-R[1],Z=Math.sin(B),H=Math.cos(B);return T[0]=U*H-W*Z+R[0],T[1]=U*Z+W*H+R[1],T},rr.angle=function(T,M){var R=T[0],B=T[1],U=M[0],W=M[1],Z=Math.sqrt(R*R+B*B)*Math.sqrt(U*U+W*W);return Math.acos(Math.min(Math.max(Z&&(R*U+B*W)/Z,-1),1))},rr.zero=function(T){return T[0]=0,T[1]=0,T},rr.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},rr.exactEquals=function(T,M){return T[0]===M[0]&&T[1]===M[1]},rr.equals=function(T,M){var R=T[0],B=T[1],U=M[0],W=M[1];return Math.abs(R-U)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(U))&&Math.abs(B-W)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(W))},rr.forEach=rr.sqrLen=rr.sqrDist=rr.dist=rr.div=rr.mul=rr.sub=rr.len=void 0;var r=function(T,M){if(T&&T.__esModule)return T;if(T===null||c(T)!=="object"&&typeof T!="function")return{default:T};var R=s(void 0);if(R&&R.has(T))return R.get(T);var B={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in T)if(W!=="default"&&Object.prototype.hasOwnProperty.call(T,W)){var Z=U?Object.getOwnPropertyDescriptor(T,W):null;Z&&(Z.get||Z.set)?Object.defineProperty(B,W,Z):B[W]=T[W]}return B.default=T,R&&R.set(T,B),B}(G());function s(T){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(s=function(B){return B?R:M})(T)}function u(){var T=new r.ARRAY_TYPE(2);return r.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function m(T,M,R){return T[0]=M[0]-R[0],T[1]=M[1]-R[1],T}function h(T,M,R){return T[0]=M[0]*R[0],T[1]=M[1]*R[1],T}function g(T,M,R){return T[0]=M[0]/R[0],T[1]=M[1]/R[1],T}function w(T,M){return Math.hypot(M[0]-T[0],M[1]-T[1])}function E(T,M){var R=M[0]-T[0],B=M[1]-T[1];return R*R+B*B}function I(T){return Math.hypot(T[0],T[1])}function x(T){var M=T[0],R=T[1];return M*M+R*R}rr.len=I,rr.sub=m,rr.mul=h,rr.div=g,rr.dist=w,rr.sqrDist=E,rr.sqrLen=x;var C,P=(C=u(),function(T,M,R,B,U,W){var Z,H;for(M||(M=2),R||(R=0),H=B?Math.min(B*M+R,T.length):T.length,Z=R;Z<H;Z+=M)C[0]=T[Z],C[1]=T[Z+1],U(C,C,W),T[Z]=C[0],T[Z+1]=C[1];return T});return rr.forEach=P,rr}function Dn(){if(Wr)return z;function c(T){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(T)}Wr=1,Object.defineProperty(z,"__esModule",{value:!0}),z.vec4=z.vec3=z.vec2=z.quat2=z.quat=z.mat4=z.mat3=z.mat2d=z.mat2=z.glMatrix=void 0;var r=P(G());z.glMatrix=r;var s=P(te());z.mat2=s;var u=P(Q());z.mat2d=u;var m=P(Ie());z.mat3=m;var h=P(Ze());z.mat4=h;var g=P(Ct());z.quat=g;var w=P(ir());z.quat2=w;var E=P(dn());z.vec2=E;var I=P(_t());z.vec3=I;var x=P(jt());function C(T){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(C=function(B){return B?R:M})(T)}function P(T,M){if(T&&T.__esModule)return T;if(T===null||c(T)!=="object"&&typeof T!="function")return{default:T};var R=C(M);if(R&&R.has(T))return R.get(T);var B={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in T)if(W!=="default"&&Object.prototype.hasOwnProperty.call(T,W)){var Z=U?Object.getOwnPropertyDescriptor(T,W):null;Z&&(Z.get||Z.set)?Object.defineProperty(B,W,Z):B[W]=T[W]}return B.default=T,R&&R.set(T,B),B}return z.vec4=x,z}var sn,cr,Lr,cn,Me=Dn(),fr=function(){if(cr)return sn;function c(r,s,u,m){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=u,this.p2y=m}return cr=1,sn=c,c.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,m=0;m<8;m++){var h=this.sampleCurveX(u)-r;if(Math.abs(h)<s)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=h/g}var w=0,E=1;for(u=r,m=0;m<20&&(h=this.sampleCurveX(u),!(Math.abs(h-r)<s));m++)r>h?w=u:E=u,u=.5*(E-w)+w;return u},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},sn}(),Yt=k(fr);function tr(){if(cn)return Lr;function c(r,s){this.x=r,this.y=s}return cn=1,Lr=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,s){return this.clone()._rotateAround(r,s)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var s=r.x-this.x,u=r.y-this.y;return s*s+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,s){return Math.atan2(this.x*s-this.y*r,this.x*r+this.y*s)},_matMult:function(r){var s=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=s,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var s=Math.cos(r),u=Math.sin(r),m=u*this.x+s*this.y;return this.x=s*this.x-u*this.y,this.y=m,this},_rotateAround:function(r,s){var u=Math.cos(r),m=Math.sin(r),h=s.y+m*(this.x-s.x)+u*(this.y-s.y);return this.x=s.x+u*(this.x-s.x)-m*(this.y-s.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(r){return r instanceof c?r:Array.isArray(r)?new c(r[0],r[1]):r},Lr}var vt=k(tr());function Mn(c,r){if(Array.isArray(c)){if(!Array.isArray(r)||c.length!==r.length)return!1;for(let s=0;s<c.length;s++)if(!Mn(c[s],r[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&r!==null){if(typeof r!="object"||Object.keys(c).length!==Object.keys(r).length)return!1;for(const s in c)if(!Mn(c[s],r[s]))return!1;return!0}return c===r}const hn=Math.PI/180,ei=180/Math.PI;function je(c){return c*hn}function dt(c){return c*ei}const St=[[0,0],[1,0],[1,1],[0,1]];function or(c){if(c<=0)return 0;if(c>=1)return 1;const r=c*c,s=r*c;return 4*(c<.5?s:3*(c-r)+s-.75)}function Kt(c,r,s,u){const m=new Yt(c,r,s,u);return function(h){return m.solve(h)}}const Xt=Kt(.25,.1,.25,1);function Ot(c,r,s){return Math.min(s,Math.max(r,c))}function Ur(c,r,s){return(s=Ot((s-c)/(r-c),0,1))*s*(3-2*s)}function $n(c,r,s){const u=s-r,m=((c-r)%u+u)%u+r;return m===r?s:m}function Ln(c,r,s){if(!c.length)return s(null,[]);let u=c.length;const m=new Array(c.length);let h=null;c.forEach((g,w)=>{r(g,(E,I)=>{E&&(h=E),m[w]=I,--u==0&&s(h,m)})})}function Xn(c,...r){for(const s of r)for(const u in s)c[u]=s[u];return c}let Mi=1;function Ui(){return Mi++}function Zi(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Lo(c,r){c.forEach(s=>{r[s]&&(r[s]=r[s].bind(r))})}function Yi(c,r){return c.indexOf(r,c.length-r.length)!==-1}function Oo(c,r,s){const u={};for(const m in c)u[m]=r.call(this,c[m],m,c);return u}function ss(c,r,s){const u={};for(const m in c)r.call(this,c[m],m,c)&&(u[m]=c[m]);return u}function To(c){return Array.isArray(c)?c.map(To):typeof c=="object"&&c?Oo(c,To):c}const La={};function Gt(c){La[c]||(typeof console<"u"&&console.warn(c),La[c]=!0)}function un(c,r,s){return(s.y-c.y)*(r.x-c.x)>(r.y-c.y)*(s.x-c.x)}function Fn(c){let r=0;for(let s,u,m=0,h=c.length,g=h-1;m<h;g=m++)s=c[m],u=c[g],r+=(u.x-s.x)*(s.y+u.y);return r}function nn([c,r,s]){const u=je(r+90),m=je(s);return{x:c*Math.cos(u)*Math.sin(m),y:c*Math.sin(u)*Math.sin(m),z:c*Math.cos(m),azimuthal:r,polar:s}}function mn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Vi(c){const r={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,m,h)=>{const g=m||h;return r[u]=!g||g.toLowerCase(),""}),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r}let fi=null;function Pi(c,r){return[c[4*r],c[4*r+1],c[4*r+2],c[4*r+3]]}function co(c,r,s,u){for(;r<s;){const m=r+s>>1;c[m]<u?r=m+1:s=m}return r}function rt(c,r,s,u){for(;r<s;){const m=r+s>>1;c[m]<=u?r=m+1:s=m}return r}function ae(c){return c>0?1/(1.001-c):1+c}function de(c){return c>0?1-1/(1.001-c):-c}const xe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!xe.API_URL)return null;try{const c=new URL(xe.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function De(c){return xe.API_URL_REGEX.test(c)}function Ae(c){return xe.API_SPRITE_REGEX.test(c)}let Ue,Qe,He,it,at,ut;function Et(){return Ue==null&&(Ue=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ue}const Bt={now:()=>it!==void 0?it:performance.now(),setNow(c){it=c},restoreNow(){it=void 0},frame(c){const r=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(c,r=0){const{width:s,height:u}=c;at||(at=document.createElement("canvas"));const m=at.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(s>at.width||u>at.height)&&(at.width=s,at.height=u),m.clearRect(-r,-r,s+2*r,u+2*r),m.drawImage(c,0,0,s,u),m.getImageData(-r,-r,s+2*r,u+2*r)},resolveURL:c=>(Qe||(Qe=document.createElement("a")),Qe.href=c,Qe.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(He==null&&(He=window.matchMedia("(prefers-reduced-motion: reduce)")),He.matches)},hasCanvasFingerprintNoise(){if(ut!==void 0)return ut;if(!Et())return ut=!1,!1;const c=new OffscreenCanvas(85,1),r=c.getContext("2d",{willReadFrequently:!0});let s=0;for(let m=0;m<c.width;++m)r.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,r.fillRect(m,0,1,1);const u=r.getImageData(0,0,c.width,c.height);s=0;for(let m=0;m<u.data.length;++m)if(m%4!=3&&s++!==u.data[m])return ut=!0,!0;return ut=!1,!1}};function Vt(c,r){const s=c.indexOf("?");if(s<0)return`${c}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(c.slice(s));for(const m in r)u.set(m,r[m]);return`${c.slice(0,s)}?${u.toString()}`}function gr(c,r={persistentParams:[]}){const s=c.indexOf("?");if(s<0)return c;const u=new URLSearchParams,m=new URLSearchParams(c.slice(s));for(const g of r.persistentParams){const w=m.get(g);w&&u.set(g,w)}const h=u.toString();return`${c.slice(0,s)}${h.length>0?`?${h}`:""}`}const Mr="mapbox-tiles";let Tr=500,wr=50;const gn=["language","worldview","jobid"];let tn,Nr;function fn(){try{return caches}catch{}}function _n(){const c=fn();c&&tn==null&&(tn=c.open(Mr))}let vi=1/0;const Eo={supported:!1,testSupport:function(c){!cc&&Xi&&(ma?Lf(c):$i=c)}};let $i,Xi,cc=!1,ma=!1;const Og=typeof self<"u"?self:{};function Lf(c){const r=c.createTexture();c.bindTexture(c.TEXTURE_2D,r);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Xi),c.isContextLost())return;Eo.supported=!0}catch{}c.deleteTexture(r),cc=!0}Og.document&&(Xi=Og.document.createElement("img"),Xi.onload=function(){$i&&Lf($i),$i=null,ma=!0},Xi.onerror=function(){cc=!0,$i=null},Xi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const uc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(uc);class Of extends Error{constructor(r,s,u){s===401&&De(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const cu=mn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Oa=function(c,r){if(!(/^file:/.test(s=c.url)||/^file:/.test(cu())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,m){const h=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:cu(),referrerPolicy:u.referrerPolicy,signal:h.signal});let w=!1,E=!1;const I=(x=g.url).indexOf("sku=")>0&&De(x);var x;u.type==="json"&&g.headers.set("Accept","application/json");const C=(T,M,R)=>{if(E)return;if(T&&T.message!=="SecurityError"&&Gt(T.toString()),M&&R)return P(M);const B=Date.now();fetch(g).then(U=>{if(U.ok){const W=I?U.clone():null;return P(U,W,B)}return m(new Of(U.statusText,U.status,u.url))}).catch(U=>{U.name!=="AbortError"&&m(new Error(`${U.message} ${u.url}`))})},P=(T,M,R)=>{(u.type==="arrayBuffer"?T.arrayBuffer():u.type==="json"?T.json():T.text()).then(B=>{E||(M&&R&&function(U,W,Z){if(_n(),tn==null)return;const H=Vi(W.headers.get("Cache-Control")||"");if(H["no-store"])return;const K={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((ge,me)=>K.headers.set(me,ge)),H["max-age"]&&K.headers.set("Expires",new Date(Z+1e3*H["max-age"]).toUTCString());const re=K.headers.get("Expires");if(!re||new Date(re).getTime()-Z<42e4)return;let se=gr(U.url,{persistentParams:gn});if(W.status===206){const ge=U.headers.get("Range");if(!ge)return;K.status=200,se=Vt(se,{range:ge})}(function(ge,me){if(Nr===void 0)try{new Response(new ReadableStream),Nr=!0}catch{Nr=!1}Nr?me(ge.body):ge.blob().then(me)})(W,ge=>{const me=new Response((pe=W.status)!==200&&pe!==404&&[101,103,204,205,304].includes(pe)?null:ge,K);var pe;_n(),tn!=null&&tn.then(Ee=>Ee.put(se,me)).catch(Ee=>Gt(Ee.message))})}(g,M,R),w=!0,m(null,B,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(B=>{E||m(new Error(B.message))})};return I?function(T,M){if(_n(),tn==null)return M(null);tn.then(R=>{let B=gr(T.url,{persistentParams:gn});const U=T.headers.get("Range");U&&(B=Vt(B,{range:U})),R.match(B).then(W=>{const Z=function(H){if(!H)return!1;const K=new Date(H.headers.get("Expires")||0),re=Vi(H.headers.get("Cache-Control")||"");return K>Date.now()&&!re["no-cache"]}(W);R.delete(B),Z&&R.put(B,W.clone()),M(null,W,Z)}).catch(M)}).catch(M)}(g,C):C(null,null),{cancel:()=>{E=!0,w||h.abort()}}}(c,r);if(mn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,r,void 0,!0)}var s;return function(u,m){const h=new XMLHttpRequest;h.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const g in u.headers)h.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=u.credentials==="include",h.onerror=()=>{m(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let g=h.response;if(u.type==="json")try{g=JSON.parse(h.response)}catch(w){return m(w)}m(null,g,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else m(new Of(h.statusText,h.status,u.url))},h.send(u.body),{cancel:()=>h.abort()}}(c,r)},dc=function(c,r){return Oa(Xn(c,{type:"arrayBuffer"}),r)};function zg(c){const r=document.createElement("a");return r.href=c,r.protocol===location.protocol&&r.host===location.host}const pv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let zf,Xd;zf=[],Xd=0;const Nf=function(c,r){if(Eo.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Xd>=xe.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:c,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return zf.push(h),h}Xd++;let s=!1;const u=()=>{if(!s)for(s=!0,Xd--;zf.length&&Xd<xe.MAX_PARALLEL_IMAGE_REQUESTS;){const h=zf.shift(),{requestParameters:g,callback:w,cancelled:E}=h;E||(h.cancel=Nf(g,w).cancel)}},m=dc(c,(h,g,w,E)=>{u(),h?r(h):g&&(self.createImageBitmap?function(I,x){const C=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(C).then(P=>{x(null,P)}).catch(P=>{x(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(I,x)=>r(I,x,w,E)):function(I,x){const C=new Image;C.onload=()=>{x(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=pv})},C.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(I)],{type:"image/png"});C.src=I.byteLength?URL.createObjectURL(P):pv}(g,(I,x)=>r(I,x,w,E)))});return{cancel:()=>{m.cancel(),u()}}};var Ng,as,Gs,bs={exports:{}},Hs={exports:{}},za={exports:{}},Ff=function(){if(Gs)return bs.exports;Gs=1;var c=(Ng||(Ng=1,Hs.exports=function(s,u){var m,h,g,w,E,I,x,C;for(h=s.length-(m=3&s.length),g=u,E=3432918353,I=461845907,C=0;C<h;)x=255&s.charCodeAt(C)|(255&s.charCodeAt(++C))<<8|(255&s.charCodeAt(++C))<<16|(255&s.charCodeAt(++C))<<24,++C,g=27492+(65535&(w=5*(65535&(g=(g^=x=(65535&(x=(x=(65535&x)*E+(((x>>>16)*E&65535)<<16)&4294967295)<<15|x>>>17))*I+(((x>>>16)*I&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(x=0,m){case 3:x^=(255&s.charCodeAt(C+2))<<16;case 2:x^=(255&s.charCodeAt(C+1))<<8;case 1:g^=x=(65535&(x=(x=(65535&(x^=255&s.charCodeAt(C)))*E+(((x>>>16)*E&65535)<<16)&4294967295)<<15|x>>>17))*I+(((x>>>16)*I&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Hs.exports),r=(as||(as=1,za.exports=function(s,u){for(var m,h=s.length,g=u^h,w=0;h>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(m>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),h-=4,++w;switch(h){case 3:g^=(255&s.charCodeAt(w+2))<<16;case 2:g^=(255&s.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),za.exports);return bs.exports=c,bs.exports.murmur3=c,bs.exports.murmur2=r,bs.exports}(),Kd=k(Ff);class El{constructor(r,...s){Xn(this,s[0]||{}),this.type=r}}class Cl extends El{constructor(r,s={}){super("error",Xn({error:r},s))}}function jf(c,r,s){s[c]&&s[c].indexOf(r)!==-1||(s[c]=s[c]||[],s[c].push(r))}function Fg(c,r,s){if(s&&s[c]){const u=s[c].indexOf(r);u!==-1&&s[c].splice(u,1)}}class uu{on(r,s){return this._listeners=this._listeners||{},jf(r,s,this._listeners),this}off(r,s){return Fg(r,s,this._listeners),Fg(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},jf(r,s,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,s){const u=typeof r=="string"?new El(r,s):r,m=u.type;if(this.listens(m)){u.target=this;const h=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const E of h)E.call(this,u);const g=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const E of g)Fg(m,E,this._oneTimeListeners),E.call(this,u);const w=this._eventedParent;w&&(Xn(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(u))}else u instanceof Cl&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}var ws,Bf={},Uf=function(){if(ws)return Bf;ws=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(h){return(h=Math.round(h))<0?0:h>255?255:h}function s(h){return r(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function u(h){return(g=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:g>1?1:g;var g}function m(h,g,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?h+(g-h)*w*6:2*w<1?g:3*w<2?h+(g-h)*(2/3-w)*6:h}try{Bf.parseCSSColor=function(h){var g,w=h.replace(/ /g,"").toLowerCase();if(w in c)return c[w].slice();if(w[0]==="#")return w.length===4?(g=parseInt(w.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:w.length===7&&(g=parseInt(w.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var E=w.indexOf("("),I=w.indexOf(")");if(E!==-1&&I+1===w.length){var x=w.substr(0,E),C=w.substr(E+1,I-(E+1)).split(","),P=1;switch(x){case"rgba":if(C.length!==4)return null;P=u(C.pop());case"rgb":return C.length!==3?null:[s(C[0]),s(C[1]),s(C[2]),P];case"hsla":if(C.length!==4)return null;P=u(C.pop());case"hsl":if(C.length!==3)return null;var T=(parseFloat(C[0])%360+360)%360/360,M=u(C[1]),R=u(C[2]),B=R<=.5?R*(M+1):R+M-R*M,U=2*R-B;return[r(255*m(U,B,T+1/3)),r(255*m(U,B,T)),r(255*m(U,B,T-1/3)),P];default:return null}}return null}}catch{}return Bf}();class Xr{constructor(r,s,u,m=1){this.r=r,this.g=s,this.b=u,this.a=m}static parse(r){if(!r)return;if(r instanceof Xr)return r;if(typeof r!="string")return;const s=Uf.parseCSSColor(r);return s?new Xr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toStringPremultipliedAlpha(){const[r,s,u,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(r)},${Math.round(s)},${Math.round(u)},${m})`}toString(){const[r,s,u,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*s)},${Math.round(255*u)},${m})`}toRenderColor(r){const{r:s,g:u,b:m,a:h}=this;return new r2(r,s,u,m,h)}clone(){return new Xr(this.r,this.g,this.b,this.a)}}class r2{constructor(r,s,u,m,h){if(r){const g=r.image.height,w=g*g;s=h===0?0:s/h*(g-1),u=h===0?0:u/h*(g-1),m=h===0?0:m/h*(g-1);const E=Math.floor(s),I=Math.floor(u),x=Math.floor(m),C=Math.ceil(s),P=Math.ceil(u),T=Math.ceil(m),M=s-E,R=u-I,B=m-x,U=r.image.data,W=4*(E+I*w+x*g),Z=4*(E+I*w+T*g),H=4*(E+P*w+x*g),K=4*(E+P*w+T*g),re=4*(C+I*w+x*g),se=4*(C+I*w+T*g),ge=4*(C+P*w+x*g),me=4*(C+P*w+T*g);if(W<0||me>=U.length)throw new Error("out of range");this.r=pr(pr(pr(U[W],U[Z],B),pr(U[H],U[K],B),R),pr(pr(U[re],U[se],B),pr(U[ge],U[me],B),R),M)/255*h,this.g=pr(pr(pr(U[W+1],U[Z+1],B),pr(U[H+1],U[K+1],B),R),pr(pr(U[re+1],U[se+1],B),pr(U[ge+1],U[me+1],B),R),M)/255*h,this.b=pr(pr(pr(U[W+2],U[Z+2],B),pr(U[H+2],U[K+2],B),R),pr(pr(U[re+2],U[se+2],B),pr(U[ge+2],U[me+2],B),R),M)/255*h,this.a=h}else this.r=s,this.g=u,this.b=m,this.a=h}toArray(){const{r,g:s,b:u,a:m}=this;return m===0?[0,0,0,0]:[255*r/m,255*s/m,255*u/m,m]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r,g:s,b:u,a:m}=this,h=Math.min(Math.max(r/m,0),1),g=Math.min(Math.max(s/m,0),1),w=Math.min(Math.max(u/m,0),1),E=Math.min(h,g,w),I=Math.max(h,g,w),x=(E+I)/2;if(E===I)return[0,0,100*x,m];const C=I-E,P=x>.5?C/(2-I-E):C/(I+E);let T=0;return I===h?T=(g-w)/C+(g<w?6:0):I===g?T=(w-h)/C+2:I===w&&(T=(h-g)/C+4),T*=60,[Math.min(Math.max(T,0),360),Math.min(Math.max(100*P,0),100),Math.min(Math.max(100*x,0),100),m]}toArray01(){const{r,g:s,b:u,a:m}=this;return m===0?[0,0,0,0]:[r/m,s/m,u/m,m]}toArray01Scaled(r){const{r:s,g:u,b:m,a:h}=this;return h===0?[0,0,0]:[s/h*r,u/h*r,m/h*r]}toArray01PremultipliedAlpha(){const{r,g:s,b:u,a:m}=this;return[r,s,u,m]}toArray01Linear(){const{r,g:s,b:u,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(r/m,2.2),Math.pow(s/m,2.2),Math.pow(u/m,2.2),m]}}function pr(c,r,s){return c*(1-s)+r*s}function jg(c,r,s){return c.map((u,m)=>pr(u,r[m],s))}Xr.black=new Xr(0,0,0,1),Xr.white=new Xr(1,1,1,1),Xr.transparent=new Xr(0,0,0,0),Xr.red=new Xr(1,0,0,1),Xr.blue=new Xr(0,0,1,1);var Zr=Object.freeze({__proto__:null,array:jg,color:function(c,r,s){return new Xr(pr(c.r,r.r,s),pr(c.g,r.g,s),pr(c.b,r.b,s),pr(c.a,r.a,s))},number:pr});function Vf(c,...r){for(const s of r)for(const u in s)c[u]=s[u];return c}class Ss extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class Bg{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[u,m]of s)this.bindings[u]=m}concat(r){return new Bg(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const du={kind:"null"},Ht={kind:"number"},rn={kind:"string"},Yr={kind:"boolean"},Ho={kind:"color"},hc={kind:"object"},Vr={kind:"value"},$f={kind:"collator"},Na={kind:"formatted"},fc={kind:"resolvedImage"};function uo(c,r){return{kind:"array",itemType:c,N:r}}function On(c){if(c.kind==="array"){const r=On(c.itemType);return typeof c.N=="number"?`array<${r}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${r}>`}return c.kind}const mv=[du,Ht,rn,Yr,Ho,Na,hc,uo(Vr),fc];function Jd(c,r){if(r.kind==="error")return null;if(c.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Jd(c.itemType,r.itemType))&&(typeof c.N!="number"||c.N===r.N))return null}else{if(c.kind===r.kind)return null;if(c.kind==="value"){for(const s of mv)if(!Jd(s,r))return null}}return`Expected ${On(c)} but found ${On(r)} instead.`}function Gf(c,r){return r.some(s=>s.kind===c.kind)}function hu(c,r){return r.some(s=>s==="null"?c===null:s==="array"?Array.isArray(c):s==="object"?c&&!Array.isArray(c)&&typeof c=="object":s===typeof c)}class Hf{constructor(r,s,u){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qd{constructor(r,s,u,m,h){this.text=r.normalize?r.normalize():r,this.image=s,this.scale=u,this.fontStack=m,this.textColor=h}}class ho{constructor(r){this.sections=r}static fromString(r){return new ho([new Qd(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.namePrimary)}static factory(r){return r instanceof ho?r:ho.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const s of this.sections){if(s.image){r.push(["image",s.image.namePrimary]);continue}r.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),r.push(u)}return r}}class pc{constructor(r,s){if(this.id=r,this.options=s||{params:{}},this.options.transform){const{a:u,b:m,c:h,d:g,e:w,f:E}=this.options.transform;this.options.transform=new DOMMatrix([u,m,h,g,w,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeFromString(r){const s=JSON.parse(r),{a:u,b:m,c:h,d:g,e:w,f:E}=s.options.transform;return new DOMMatrix([u,m,h,g,w,E]),new pc(s.id,s.options)}scaleSelf(r){return this.options.transform=this.options.transform.scale(r),this}serialize(){const r={id:this.id};this.options&&(r.options=this.options);const{a:s,b:u,c:m,d:h,e:g,f:w}=this.options.transform;return r.options.transform={a:s,b:u,c:m,d:h,e:g,f:w},JSON.stringify(r)}}class Ii{constructor(r){this.namePrimary=r.namePrimary,r.nameSecondary&&(this.nameSecondary=r.nameSecondary),r.optionsPrimary&&(this.optionsPrimary=r.optionsPrimary),r.optionsSecondary&&(this.optionsSecondary=r.optionsSecondary),this.available=r.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new pc(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new pc(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(r){return typeof r=="string"?Ii.build(r):r}static build(r,s,u,m){return r?new Ii({namePrimary:r,nameSecondary:s,optionsPrimary:u,optionsSecondary:m,available:!1}):null}}function mc(c,r,s,u){return typeof c=="number"&&c>=0&&c<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,r,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,r,s,u]:[c,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gc(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Xr||c instanceof Hf||c instanceof ho||c instanceof Ii)return!0;if(Array.isArray(c)){for(const r of c)if(!gc(r))return!1;return!0}if(typeof c=="object"){for(const r in c)if(!gc(c[r]))return!1;return!0}return!1}function Hn(c){if(c===null)return du;if(typeof c=="string")return rn;if(typeof c=="boolean")return Yr;if(typeof c=="number")return Ht;if(c instanceof Xr)return Ho;if(c instanceof Hf)return $f;if(c instanceof ho)return Na;if(c instanceof Ii)return fc;if(Array.isArray(c)){const r=c.length;let s;for(const u of c){const m=Hn(u);if(s){if(s===m)continue;s=Vr;break}s=m}return uo(s||Vr,r)}return hc}function qs(c){const r=typeof c;return c===null?"":r==="string"||r==="number"||r==="boolean"?String(c):c instanceof Xr?c.toStringPremultipliedAlpha():c instanceof ho||c instanceof Ii?c.toString():JSON.stringify(c)}class Ts{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!gc(r[1]))return s.error("invalid value");const u=r[1];let m=Hn(u);const h=s.expectedType;return m.kind!=="array"||m.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(m=h),new Ts(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Xr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ho?this.value.serialize():this.value}}class pi{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const eh={string:rn,number:Ht,boolean:Yr,object:hc};class Es{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let u,m=1;const h=r[0];if(h==="array"){let w,E;if(r.length>2){const I=r[1];if(typeof I!="string"||!(I in eh)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=eh[I],m++}else w=Vr;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=r[2],m++}u=uo(w,E)}else u=eh[h];const g=[];for(;m<r.length;m++){const w=s.parse(r[m],m,Vr);if(!w)return null;g.push(w)}return new Es(u,g)}evaluate(r){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(r);if(!Jd(this.type,Hn(u)))return u;if(s===this.args.length-1)throw new pi(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${On(Hn(u))} but was expected to be of type ${On(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,s=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);const m=r.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(u=>u.serialize()))}}class Fa{constructor(r){this.type=Na,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const m=[];let h=!1;for(let g=1;g<=r.length-1;++g){const w=r[g];if(h&&typeof w=="object"&&!Array.isArray(w)){h=!1;let E=null;if(w["font-scale"]&&(E=s.parseObjectValue(w["font-scale"],g,"font-scale",Ht),!E))return null;let I=null;if(w["text-font"]&&(I=s.parseObjectValue(w["text-font"],g,"text-font",uo(rn)),!I))return null;let x=null;if(w["text-color"]&&(x=s.parseObjectValue(w["text-color"],g,"text-color",Ho),!x))return null;const C=m[m.length-1];C.scale=E,C.font=I,C.textColor=x}else{const E=s.parse(r[g],g,Vr);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,m.push({content:E,scale:null,font:null,textColor:null})}}return new Fa(m)}evaluate(r){return new ho(this.sections.map(s=>{const u=s.content.evaluate(r);return Hn(u)===fc?new Qd("",u,null,null,null):new Qd(qs(u),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null)}))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const s of this.sections){r.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),r.push(u)}return r}}class fu{constructor(r,s,u,m){this._imageWarnHistory={},this.type=fc,this.inputPrimary=r,this.inputSecondary=s,this.inputPrimaryParams=u,this.inputSecondaryParams=m}static parse(r,s){if(r.length<2)return s.error("Expected two or more arguments.");let u=1;const m=[];function h(){if(u<r.length){const w=s.parse(r[u],u++,rn);return w?(m.push({image:w,options:void 0}),!0):(s.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<r.length){if((w=r[u])===null||typeof w!="object"||Array.isArray(w))return!0;const E=r[u].params,I=s.concat(u);if(!E)return u++,!0;if(typeof E!="object"||E.constructor!==Object)return I.error('Image options "params" should be an object'),!1;const x={},C=I.concat(void 0,"params");for(const P in E){if(!P)return C.error("Image parameter name should be non-empty"),!1;const T=C.concat(void 0,P).parse(E[P],void 0,Ho,void 0,{typeAnnotation:"coerce"});if(!T)return!1;x[P]=T}return m[m.length-1].options=x,u++,!0}var w;return!0}for(let w=0;w<2;w++)if(!h()||!g())return;return new fu(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(r,s){const u={};if(s){for(const m in s)if(s[m])try{const h=s[m].evaluate(r),g=`Ignoring image parameter "${m}" with semi-transparent color ${h.toString()}`;if(h.a!==1){this._imageWarnHistory[g]||(console.warn(g),this._imageWarnHistory[g]=!0);continue}u[m]=h}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(r){const s=Ii.build(this.inputPrimary.evaluate(r),this.inputSecondary?this.inputSecondary.evaluate(r):void 0,this.inputPrimaryParams?this.evaluateParams(r,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(r,this.inputSecondaryParams):void 0);return s&&r.availableImages&&(s.available=r.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&r.availableImages&&(s.available=r.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(r){if(r(this.inputPrimary),this.inputPrimaryParams)for(const s in this.inputPrimaryParams)this.inputPrimaryParams[s]&&r(this.inputPrimaryParams[s]);if(this.inputSecondary&&(r(this.inputSecondary),this.inputSecondaryParams))for(const s in this.inputSecondaryParams)this.inputSecondaryParams[s]&&r(this.inputSecondaryParams[s])}outputDefined(){return!1}serializeParams(r){const s={};if(r){for(const u in r)r[u]&&(s[u]=r[u].serialize());return{params:s}}}serialize(){const r=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&r.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(r.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&r.push(this.serializeParams(this.inputSecondaryParams))),r}}function _c(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const n2={"to-boolean":Yr,"to-color":Ho,"to-number":Ht,"to-string":rn};class ja{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const u=r[0],m=[];let h=du;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const g=r[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);h=uo(s.expectedType.itemType,g)}else{if(!(g>0&&gc(r[1][0])))return null;h=uo(Hn(r[1][0]),g)}for(let w=0;w<g;w++){const E=r[1][w];let I;if(_c(E)==="array")I=s.parse(E,void 0,h.itemType);else{const x=_c(E);if(x!==h.itemType.kind)return s.error(`Expected ${h.itemType.kind} but found ${x}.`);I=s.registry.literal.parse(["literal",E===void 0?null:E],s)}if(!I)return null;m.push(I)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return s.error("Expected one argument.");h=n2[u];for(let g=1;g<r.length;g++){const w=s.parse(r[g],g,Vr);if(!w)return null;m.push(w)}}return new ja(h,m)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let s,u;for(const m of this.args){if(s=m.evaluate(r),u=null,s instanceof Xr)return s;if(typeof s=="string"){const h=r.parseColor(s);if(h)return h}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:mc(s[0],s[1],s[2],s[3]),!u))return new Xr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new pi(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const u of this.args){if(s=u.evaluate(r),s===null)return 0;const m=Number(s);if(!isNaN(m))return m}throw new pi(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?ho.fromString(qs(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Ii.build(qs(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(s=>s.evaluate(r)):qs(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Fa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new fu(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{r.push(s.serialize())}),r}}const gv=["Unknown","Point","LineString","Polygon"];class qf{constructor(r,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?gv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-r[0])+this.featureDistanceData.bearing[1]*(m*s-r[1])}return 0}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=Xr.parse(r)),s}getConfig(r){return this.options?this.options.get(r):null}}class qo{constructor(r,s,u,m,h){this.name=r,this.type=s,this._evaluate=u,this.args=m,this._overloadIndex=h}evaluate(r){if(!this._evaluate){const s=qo.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,s){const u=r[0],m=qo.definitions[u];if(!m)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(m)?m[0]:m.type,g=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,w=[];let E=null,I=-1;for(const[x,C]of g){if(Array.isArray(x)&&x.length!==r.length-1)continue;w.push(x),I++,E=new Wg(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const P=[];let T=!1;for(let M=1;M<r.length;M++){const R=r[M],B=Array.isArray(x)?x[M-1]:x.type,U=E.parse(R,1+P.length,B);if(!U){T=!0;break}P.push(U)}if(!T)if(Array.isArray(x)&&x.length!==P.length)E.error(`Expected ${x.length} arguments, but found ${P.length} instead.`);else{for(let M=0;M<P.length;M++){const R=Array.isArray(x)?x[M]:x.type,B=P[M];E.concat(M+1).checkSubtype(R,B.type)}if(E.errors.length===0)return new qo(u,h,C,P,I)}}if(w.length===1)s.errors.push(...E.errors);else{const x=(w.length?w:g.map(([P])=>P)).map(Wf).join(" | "),C=[];for(let P=1;P<r.length;P++){const T=s.parse(r[P],1+C.length);if(!T)return null;C.push(On(T.type))}s.error(`Expected arguments of type ${x}, but found (${C.join(", ")}) instead.`)}return null}static register(r,s){qo.definitions=s;for(const u in s)r[u]=qo}}function Wf(c){return Array.isArray(c)?`(${c.map(On).join(", ")})`:`(${On(c.type)}...)`}class Zf{constructor(r,s,u){this.type=$f,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const m=u["case-sensitive"]===void 0?s.parse(!1,1,Yr):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Yr);if(!m)return null;const h=u["diacritic-sensitive"]===void 0?s.parse(!1,1,Yr):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Yr);if(!h)return null;let g=null;return u.locale&&(g=s.parseObjectValue(u.locale,1,"locale",rn),!g)?null:new Zf(m,h,g)}evaluate(r){return new Hf(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function _v(c,r,s=0,u=c.length-1,m=i2){for(;u>s;){if(u-s>600){const E=u-s+1,I=r-s+1,x=Math.log(E),C=.5*Math.exp(2*x/3),P=.5*Math.sqrt(x*C*(E-C)/E)*(I-E/2<0?-1:1);_v(c,r,Math.max(s,Math.floor(r-I*C/E+P)),Math.min(u,Math.floor(r+(E-I)*C/E+P)),m)}const h=c[r];let g=s,w=u;for(th(c,s,r),m(c[u],h)>0&&th(c,s,u);g<w;){for(th(c,g,w),g++,w--;m(c[g],h)<0;)g++;for(;m(c[w],h)>0;)w--}m(c[s],h)===0?th(c,s,w):(w++,th(c,w,u)),w<=r&&(s=w+1),r<=w&&(u=w-1)}}function th(c,r,s){const u=c[r];c[r]=c[s],c[s]=u}function i2(c,r){return c<r?-1:c>r?1:0}function o2(c){let r=0;for(let s,u,m=0,h=c.length,g=h-1;m<h;g=m++)s=c[m],u=c[g],r+=(u.x-s.x)*(s.y+u.y);return r}function rh(c,r){c[0]=Math.min(c[0],r[0]),c[1]=Math.min(c[1],r[1]),c[2]=Math.max(c[2],r[0]),c[3]=Math.max(c[3],r[1])}function nh(c,r){return!(c[0]<=r[0]||c[2]>=r[2]||c[1]<=r[1]||c[3]>=r[3])}function yv(c,r,s){const u=c[0]-r[0],m=c[1]-r[1],h=c[0]-s[0],g=c[1]-s[1];return u*g-h*m==0&&u*h<=0&&m*g<=0}function Ws(c,r,s=!1){let u=!1;for(let w=0,E=r.length;w<E;w++){const I=r[w];for(let x=0,C=I.length,P=C-1;x<C;P=x++){const T=I[P],M=I[x];if(yv(c,T,M))return s;(h=T)[1]>(m=c)[1]!=(g=M)[1]>m[1]&&m[0]<(g[0]-h[0])*(m[1]-h[1])/(g[1]-h[1])+h[0]&&(u=!u)}}var m,h,g;return u}function vv(c,r,s,u){const m=u[0]-s[0],h=u[1]-s[1],g=(c[0]-s[0])*h-m*(c[1]-s[1]),w=(r[0]-s[0])*h-m*(r[1]-s[1]);return g>0&&w<0||g<0&&w>0}function Yf(c,r,s,u){return(m=[u[0]-s[0],u[1]-s[1]])[0]*(h=[r[0]-c[0],r[1]-c[1]])[1]-m[1]*h[0]!=0&&!(!vv(c,r,s,u)||!vv(s,u,c,r));var m,h}const ga=8192;function s2(c,r){const s=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,r.z);return[Math.round(s*m*ga),Math.round(u*m*ga)]}function a2(c,r){for(let s=0;s<r.length;s++)if(Ws(c,r[s]))return!0;return!1}function l2(c,r,s){for(const u of s)for(let m=0,h=u.length,g=h-1;m<h;g=m++)if(Yf(c,r,u[g],u[m]))return!0;return!1}function xv(c,r){for(let s=0;s<c.length;++s)if(!Ws(c[s],r))return!1;for(let s=0;s<c.length-1;++s)if(l2(c[s],c[s+1],r))return!1;return!0}function pu(c,r){for(let s=0;s<r.length;s++)if(xv(c,r[s]))return!0;return!1}function Or(c,r,s){const u=[];for(let m=0;m<c.length;m++){const h=[];for(let g=0;g<c[m].length;g++){const w=s2(c[m][g],s);rh(r,w),h.push(w)}u.push(h)}return u}function sr(c,r,s){const u=[];for(let m=0;m<c.length;m++){const h=Or(c[m],r,s);u.push(h)}return u}function Xf(c,r,s,u){if(c[0]<s[0]||c[0]>s[2]){const m=.5*u;let h=c[0]-s[0]>m?-u:s[0]-c[0]>m?u:0;h===0&&(h=c[0]-s[2]>m?-u:s[2]-c[0]>m?u:0),c[0]+=h}rh(r,c)}function Er(c,r,s,u){const m=Math.pow(2,u.z)*ga,h=[u.x*ga,u.y*ga],g=[];if(!c)return g;for(const w of c)for(const E of w){const I=[E.x+h[0],E.y+h[1]];Xf(I,r,s,m),g.push(I)}return g}function Kf(c,r,s,u){const m=Math.pow(2,u.z)*ga,h=[u.x*ga,u.y*ga],g=[];if(!c)return g;for(const E of c){const I=[];for(const x of E){const C=[x.x+h[0],x.y+h[1]];rh(r,C),I.push(C)}g.push(I)}if(r[2]-r[0]<=m/2){(w=r)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of g)for(const I of E)Xf(I,r,s,m)}var w;return g}class Ba{constructor(r,s){this.type=Yr,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(gc(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let m=0;m<u.features.length;++m){const h=u.features[m].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ba(u,u.features[m].geometry)}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Ba(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Ba(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(s,u){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const w=Or(u.coordinates,h,g),E=Er(s.geometry(),m,h,g);if(!nh(m,h))return!1;for(const I of E)if(!Ws(I,w))return!1}if(u.type==="MultiPolygon"){const w=sr(u.coordinates,h,g),E=Er(s.geometry(),m,h,g);if(!nh(m,h))return!1;for(const I of E)if(!a2(I,w))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(s,u){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const w=Or(u.coordinates,h,g),E=Kf(s.geometry(),m,h,g);if(!nh(m,h))return!1;for(const I of E)if(!xv(I,w))return!1}if(u.type==="MultiPolygon"){const w=sr(u.coordinates,h,g),E=Kf(s.geometry(),m,h,g);if(!nh(m,h))return!1;for(const I of E)if(!pu(I,w))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const mr={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ug=1/298.257223563,Jf=Ug*(2-Ug),mu=Math.PI/180;class gu{static fromTile(r,s,u){const m=Math.PI*(1-2*(r+.5)/Math.pow(2,s)),h=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/mu;return new gu(h,u)}static get units(){return mr}constructor(r,s){if(r===void 0)throw new Error("No latitude given.");if(s&&!mr[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(mr).join(", ")}`);const u=6378.137*mu*(s?mr[s]:1),m=Math.cos(r*mu),h=1/(1-Jf*(1-m*m)),g=Math.sqrt(h);this.kx=u*g*m,this.ky=u*g*h*(1-Jf)}distance(r,s){const u=Wo(r[0]-s[0])*this.kx,m=(r[1]-s[1])*this.ky;return Math.sqrt(u*u+m*m)}bearing(r,s){const u=Wo(s[0]-r[0])*this.kx;return Math.atan2(u,(s[1]-r[1])*this.ky)/mu}destination(r,s,u){const m=u*mu;return this.offset(r,Math.sin(m)*s,Math.cos(m)*s)}offset(r,s,u){return[r[0]+s/this.kx,r[1]+u/this.ky]}lineDistance(r){let s=0;for(let u=0;u<r.length-1;u++)s+=this.distance(r[u],r[u+1]);return s}area(r){let s=0;for(let u=0;u<r.length;u++){const m=r[u];for(let h=0,g=m.length,w=g-1;h<g;w=h++)s+=Wo(m[h][0]-m[w][0])*(m[h][1]+m[w][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(r,s){let u=0;if(s<=0)return r[0];for(let m=0;m<r.length-1;m++){const h=r[m],g=r[m+1],w=this.distance(h,g);if(u+=w,u>s)return to(h,g,(s-(u-w))/w)}return r[r.length-1]}pointToSegmentDistance(r,s,u){let[m,h]=s,g=Wo(u[0]-m)*this.kx,w=(u[1]-h)*this.ky;if(g!==0||w!==0){const E=(Wo(r[0]-m)*this.kx*g+(r[1]-h)*this.ky*w)/(g*g+w*w);E>1?(m=u[0],h=u[1]):E>0&&(m+=g/this.kx*E,h+=w/this.ky*E)}return g=Wo(r[0]-m)*this.kx,w=(r[1]-h)*this.ky,Math.sqrt(g*g+w*w)}pointOnLine(r,s){let u=1/0,m=r[0][0],h=r[0][1],g=0,w=0;for(let E=0;E<r.length-1;E++){let I=r[E][0],x=r[E][1],C=Wo(r[E+1][0]-I)*this.kx,P=(r[E+1][1]-x)*this.ky,T=0;C===0&&P===0||(T=(Wo(s[0]-I)*this.kx*C+(s[1]-x)*this.ky*P)/(C*C+P*P),T>1?(I=r[E+1][0],x=r[E+1][1]):T>0&&(I+=C/this.kx*T,x+=P/this.ky*T)),C=Wo(s[0]-I)*this.kx,P=(s[1]-x)*this.ky;const M=C*C+P*P;M<u&&(u=M,m=I,h=x,g=E,w=T)}return{point:[m,h],index:g,t:Math.max(0,Math.min(1,w))}}lineSlice(r,s,u){let m=this.pointOnLine(u,r),h=this.pointOnLine(u,s);if(m.index>h.index||m.index===h.index&&m.t>h.t){const I=m;m=h,h=I}const g=[m.point],w=m.index+1,E=h.index;!ih(u[w],g[0])&&w<=E&&g.push(u[w]);for(let I=w+1;I<=E;I++)g.push(u[I]);return ih(u[E],h.point)||g.push(h.point),g}lineSliceAlong(r,s,u){let m=0;const h=[];for(let g=0;g<u.length-1;g++){const w=u[g],E=u[g+1],I=this.distance(w,E);if(m+=I,m>r&&h.length===0&&h.push(to(w,E,(r-(m-I))/I)),m>=s)return h.push(to(w,E,(s-(m-I))/I)),h;m>r&&h.push(E)}return h}bufferPoint(r,s){const u=s/this.ky,m=s/this.kx;return[r[0]-m,r[1]-u,r[0]+m,r[1]+u]}bufferBBox(r,s){const u=s/this.ky,m=s/this.kx;return[r[0]-m,r[1]-u,r[2]+m,r[3]+u]}insideBBox(r,s){return Wo(r[0]-s[0])>=0&&Wo(r[0]-s[2])<=0&&r[1]>=s[1]&&r[1]<=s[3]}}function ih(c,r){return c[0]===r[0]&&c[1]===r[1]}function to(c,r,s){const u=Wo(r[0]-c[0]);return[c[0]+u*s,c[1]+(r[1]-c[1])*s]}function Wo(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Qf{constructor(r=[],s=(u,m)=>u<m?-1:u>m?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:u}=this,m=s[r];for(;r>0;){const h=r-1>>1,g=s[h];if(u(m,g)>=0)break;s[r]=g,r=h}s[r]=m}_down(r){const{data:s,compare:u}=this,m=this.length>>1,h=s[r];for(;r<m;){let g=1+(r<<1);const w=g+1;if(w<this.length&&u(s[w],s[g])<0&&(g=w),u(s[g],h)>=0)break;s[r]=s[g],r=g}s[r]=h}}var Lt=8192;function ep(c,r){return r.dist-c.dist}const Ua=100,ro=50;function bv(c){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==c.length)return!1;for(let s=0;s<r.length;s++)if(r[s]!==c[s])return!1;return!0}function tp(c){return c[1]-c[0]+1}function Va(c,r){const s=c[1]>=c[0]&&c[1]<r;return s||console.warn("Distance Expression: Index is out of range"),s}function _u(c,r){if(c[0]>c[1])return[null,null];const s=tp(c);if(r){if(s===2)return[c,null];const u=Math.floor(s/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(s===1)return[c,null];const u=Math.floor(s/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function Ml(c,r){const s=[1/0,1/0,-1/0,-1/0];if(!Va(r,c.length))return s;for(let u=r[0];u<=r[1];++u)rh(s,c[u]);return s}function yu(c){const r=[1/0,1/0,-1/0,-1/0];for(let s=0;s<c.length;++s)for(let u=0;u<c[s].length;++u)rh(r,c[s][u]);return r}function vu(c,r,s){if(bv(c)||bv(r))return NaN;let u=0,m=0;return c[2]<r[0]&&(u=r[0]-c[2]),c[0]>r[2]&&(u=c[0]-r[2]),c[1]>r[3]&&(m=c[1]-r[3]),c[3]<r[1]&&(m=r[1]-c[3]),s.distance([0,0],[u,m])}function c2(c){return 360*c-180}function u2(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Vg(c,r){const s=Math.pow(2,r.z),u=(c.y/Lt+r.y)/s;return[c2((c.x/Lt+r.x)/s),u2(u)]}function wv(c,r){const s=[];for(let u=0;u<c.length;++u)s.push(Vg(c[u],r));return s}function Sv(c,r,s){const u=s.pointOnLine(r,c).point;return s.distance(c,u)}function Tv(c,r,s,u,m){const h=s.slice(u[0],u[1]+1);let g=1/0;for(let w=r[0];w<=r[1];++w)if((g=Math.min(g,Sv(c[w],h,m)))===0)return 0;return g}function $a(c,r,s,u,m){const h=Math.min(m.pointToSegmentDistance(c,s,u),m.pointToSegmentDistance(r,s,u)),g=Math.min(m.pointToSegmentDistance(s,c,r),m.pointToSegmentDistance(u,c,r));return Math.min(h,g)}function d2(c,r,s,u,m){if(!Va(r,c.length)||!Va(u,s.length))return NaN;let h=1/0;for(let g=r[0];g<r[1];++g)for(let w=u[0];w<u[1];++w){if(Yf(c[g],c[g+1],s[w],s[w+1]))return 0;h=Math.min(h,$a(c[g],c[g+1],s[w],s[w+1],m))}return h}function h2(c,r,s,u,m){if(!Va(r,c.length)||!Va(u,s.length))return NaN;let h=1/0;for(let g=r[0];g<=r[1];++g)for(let w=u[0];w<=u[1];++w)if((h=Math.min(h,m.distance(c[g],s[w])))===0)return h;return h}function $g(c,r,s){if(Ws(c,r,!0))return 0;let u=1/0;for(const m of r){const h=m.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[h-1]&&(u=Math.min(u,s.pointToSegmentDistance(c,m[h-1],m[0])))===0||(u=Math.min(u,Sv(c,m,s)))===0)return u}return u}function Ev(c,r,s,u){if(!Va(r,c.length))return NaN;for(let h=r[0];h<=r[1];++h)if(Ws(c[h],s,!0))return 0;let m=1/0;for(let h=r[0];h<r[1];++h)for(const g of s)for(let w=0,E=g.length,I=E-1;w<E;I=w++){if(Yf(c[h],c[h+1],g[I],g[w]))return 0;m=Math.min(m,$a(c[h],c[h+1],g[I],g[w],u))}return m}function Gg(c,r){for(const s of c)for(let u=0;u<=s.length-1;++u)if(Ws(s[u],r,!0))return!0;return!1}function Zs(c,r,s,u=1/0){const m=yu(c),h=yu(r);if(u!==1/0&&vu(m,h,s)>=u)return u;if(nh(m,h)){if(Gg(c,r))return 0}else if(Gg(r,c))return 0;let g=u;for(const w of c)for(let E=0,I=w.length,x=I-1;E<I;x=E++)for(const C of r)for(let P=0,T=C.length,M=T-1;P<T;M=P++){if(Yf(w[x],w[E],C[M],C[P]))return 0;g=Math.min(g,$a(w[x],w[E],C[M],C[P],s))}return g}function oh(c,r,s,u,m,h,g){if(h===null||g===null)return;const w=vu(Ml(u,h),Ml(m,g),s);w<r&&c.push({dist:w,range1:h,range2:g})}function Cv(c,r,s,u,m=1/0){let h=Math.min(u.distance(c[0],s[0][0]),m);if(h===0)return h;const g=new Qf([{dist:0,range1:[0,c.length-1],range2:[0,0]}],ep),w=r?ro:Ua,E=yu(s);for(;g.length;){const I=g.pop();if(I.dist>=h)continue;const x=I.range1;if(tp(x)<=w){if(!Va(x,c.length))return NaN;if(r){const C=Ev(c,x,s,u);if((h=Math.min(h,C))===0)return h}else for(let C=x[0];C<=x[1];++C){const P=$g(c[C],s,u);if((h=Math.min(h,P))===0)return h}}else{const C=_u(x,r);if(C[0]!==null){const P=vu(Ml(c,C[0]),E,u);P<h&&g.push({dist:P,range1:C[0],range2:[0,0]})}if(C[1]!==null){const P=vu(Ml(c,C[1]),E,u);P<h&&g.push({dist:P,range1:C[1],range2:[0,0]})}}}return h}function Hg(c,r,s,u,m,h=1/0){let g=Math.min(h,m.distance(c[0],s[0]));if(g===0)return g;const w=new Qf([{dist:0,range1:[0,c.length-1],range2:[0,s.length-1]}],ep),E=r?ro:Ua,I=u?ro:Ua;for(;w.length;){const x=w.pop();if(x.dist>=g)continue;const C=x.range1,P=x.range2;if(tp(C)<=E&&tp(P)<=I){if(!Va(C,c.length)||!Va(P,s.length))return NaN;if(r&&u?g=Math.min(g,d2(c,C,s,P,m)):r||u?r&&!u?g=Math.min(g,Tv(s,P,c,C,m)):!r&&u&&(g=Math.min(g,Tv(c,C,s,P,m))):g=Math.min(g,h2(c,C,s,P,m)),g===0)return g}else{const T=_u(C,r),M=_u(P,u);oh(w,g,m,c,s,T[0],M[0]),oh(w,g,m,c,s,T[0],M[1]),oh(w,g,m,c,s,T[1],M[0]),oh(w,g,m,c,s,T[1],M[1])}}return g}function rp(c,r,s,u,m=1/0){let h=m;const g=Ml(c,[0,c.length-1]);for(const w of s)if(!(h!==1/0&&vu(g,Ml(w,[0,w.length-1]),u)>=h)&&(h=Math.min(h,Hg(c,r,w,!0,u,h)),h===0))return h;return h}function sh(c,r,s,u,m=1/0){let h=m;const g=Ml(c,[0,c.length-1]);for(const w of s){if(h!==1/0&&vu(g,yu(w),u)>=h)continue;const E=Cv(c,r,w,u,h);if(isNaN(E))return E;if((h=Math.min(h,E))===0)return h}return h}function np(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Pl{constructor(r,s){this.type=Ht,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(gc(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let m=0;m<u.features.length;++m)if(np(u.features[m].geometry.type))return new Pl(u,u.features[m].geometry)}else if(u.type==="Feature"){if(np(u.geometry.type))return new Pl(u,u.geometry)}else if(np(u.type))return new Pl(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const s=r.geometry(),u=r.canonicalID();if(s!=null&&u!=null){if(r.geometryType()==="Point")return function(m,h,g){const w=[];for(const I of m)for(const x of I)w.push(Vg(x,h));const E=new gu(w[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Hg(w,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",E):g.type==="MultiLineString"?rp(w,!1,g.coordinates,E):g.type==="Polygon"||g.type==="MultiPolygon"?sh(w,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,E):null}(s,u,this.geometries);if(r.geometryType()==="LineString")return function(m,h,g){const w=[];for(const I of m){const x=[];for(const C of I)x.push(Vg(C,h));w.push(x)}const E=new gu(w[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return rp(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,E);if(g.type==="MultiLineString"){let I=1/0;for(let x=0;x<g.coordinates.length;x++){const C=rp(g.coordinates[x],!0,w,E,I);if(isNaN(C))return C;if((I=Math.min(I,C))===0)return I}return I}if(g.type==="Polygon"||g.type==="MultiPolygon"){let I=1/0;for(let x=0;x<w.length;x++){const C=sh(w[x],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,E,I);if(isNaN(C))return C;if((I=Math.min(I,C))===0)return I}return I}return null}(s,u,this.geometries);if(r.geometryType()==="Polygon")return function(m,h,g){const w=[];for(const I of function(x,C){const P=x.length;if(P<=1)return[x];const T=[];let M,R;for(let B=0;B<P;B++){const U=o2(x[B]);U!==0&&(x[B].area=Math.abs(U),R===void 0&&(R=U<0),R===U<0?(M&&T.push(M),M=[x[B]]):M.push(x[B]))}return M&&T.push(M),T}(m)){const x=[];for(let C=0;C<I.length;++C)x.push(wv(I[C],h));w.push(x)}const E=new gu(w[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return sh(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,E);if(g.type==="MultiLineString"){let I=1/0;for(let x=0;x<g.coordinates.length;x++){const C=sh(g.coordinates[x],!0,w,E,I);if(isNaN(C))return C;if((I=Math.min(I,C))===0)return I}return I}return g.type==="Polygon"||g.type==="MultiPolygon"?function(I,x,C){let P=1/0;for(const T of I)for(const M of x){const R=Zs(T,M,C,P);if(isNaN(R))return R;if((P=Math.min(P,R))===0)return P}return P}(g.type==="Polygon"?[g.coordinates]:g.coordinates,w,E):null}(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ip(c,r){switch(c){case"string":return qs(r);case"number":return+r;case"boolean":return!!r;case"color":return Xr.parse(r);case"formatted":return ho.fromString(qs(r));case"resolvedImage":return Ii.build(qs(r))}return r}function qg(c,r,s,u){return u!==void 0&&(c=u*Math.round(c/u)),r!==void 0&&c<r&&(c=r),s!==void 0&&c>s&&(c=s),c}class yc{constructor(r,s,u){this.type=r,this.key=s,this.scope=u}static parse(r,s){let u=s.expectedType;if(u==null&&(u=Vr),r.length<2||r.length>3)return s.error("Invalid number of arguments for 'config' expression.");const m=s.parse(r[1],1);if(!(m instanceof Ts))return s.error("Key name of 'config' expression must be a string literal.");if(r.length>=3){const h=s.parse(r[2],2);return h instanceof Ts?new yc(u,qs(m.value),qs(h.value)):s.error("Scope of 'config' expression must be a string literal.")}return new yc(u,qs(m.value))}evaluate(r){const s=[this.key,this.scope,r.scope].filter(Boolean).join(""),u=r.getConfig(s);if(!u)return null;const{type:m,value:h,values:g,minValue:w,maxValue:E,stepValue:I}=u,x=u.default.evaluate(r);let C=x;if(h){const P=r.scope;r.scope=(P||"").split("").slice(1).join(""),C=h.evaluate(r),r.scope=P}return m&&(C=ip(m,C)),C===void 0||w===void 0&&E===void 0&&I===void 0||(typeof C=="number"?C=qg(C,w,E,I):Array.isArray(C)&&(C=C.map(P=>typeof P=="number"?qg(P,w,E,I):P))),h!==void 0&&C!==void 0&&g&&!g.includes(C)&&(C=x,m&&(C=ip(m,C))),(m&&m!==this.type||C!==void 0&&Hn(C)!==this.type)&&(C=ip(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.key),r}}function xu(c){if(c instanceof qo&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Ba||c instanceof Pl)return!1;let r=!0;return c.eachChild(s=>{r&&!xu(s)&&(r=!1)}),r}function vc(c){if(c instanceof qo&&c.name==="feature-state")return!1;let r=!0;return c.eachChild(s=>{r&&!vc(s)&&(r=!1)}),r}function xc(c){if(c instanceof yc)return new Set([c.key]);let r=new Set;return c.eachChild(s=>{r=new Set([...r,...xc(s)])}),r}function Ga(c,r){if(c instanceof qo&&r.indexOf(c.name)>=0)return!1;let s=!0;return c.eachChild(u=>{s&&!Ga(u,r)&&(s=!1)}),s}class ah{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=r[1];return s.scope.has(u)?new ah(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class op{constructor(r,s=[],u,m=new Bg,h=[],g,w){this.registry=r,this.path=s,this.key=s.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=m,this.errors=h,this.expectedType=u,this._scope=g,this.options=w}parse(r,s,u,m,h={}){return s||u?this.concat(s,null,u,m)._parse(r,h):this._parse(r,h)}parseObjectValue(r,s,u,m,h,g={}){return this.concat(s,u,m,h)._parse(r,g)}_parse(r,s){function u(m,h,g){return g==="assert"?new Es(h,[m]):g==="coerce"?new ja(h,[m]):m}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(m){let h=m.parse(r,this);if(!h)return null;if(this.expectedType){const g=this.expectedType,w=h.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||w.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(g,w))return null}else h=u(h,g,s.typeAnnotation||"coerce");else h=u(h,g,s.typeAnnotation||"assert")}if(!(h instanceof Ts)&&h.type.kind!=="resolvedImage"&&Al(h)){const g=new qf(this._scope,this.options);try{h=new Ts(h.type,h.evaluate(g))}catch(w){return this.error(w.message),null}}return h}return ja.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,u,m){let h=typeof r=="number"?this.path.concat(r):this.path;h=typeof s=="string"?h.concat(s):h;const g=m?this.scope.concat(m):this.scope;return new op(this.registry,h,u||null,g,this.errors,this._scope,this.options)}error(r,...s){const u=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new Ss(u,r))}checkSubtype(r,s){const u=Jd(r,s);return u&&this.error(u),u}}var Wg=op;function Al(c){if(c instanceof ah)return Al(c.boundExpression);if(c instanceof qo&&c.name==="error"||c instanceof Zf||c instanceof Ba||c instanceof Pl||c instanceof yc)return!1;const r=c instanceof ja||c instanceof Es;let s=!0;return c.eachChild(u=>{s=r?s&&Al(u):s&&u instanceof Ts}),!!s&&xu(c)&&Ga(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Br(c,r){const s=c.length-1;let u,m,h=0,g=s,w=0;for(;h<=g;)if(w=Math.floor((h+g)/2),u=c[w],m=c[w+1],u<=r){if(w===s||r<m)return w;h=w+1}else{if(!(u>r))throw new pi("Input is not a number.");g=w-1}return 0}class lh{constructor(r,s,u){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[m,h]of u)this.labels.push(m),this.outputs.push(h)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(r[1],1,Ht);if(!u)return null;const m=[];let h=null;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);for(let g=1;g<r.length;g+=2){const w=g===1?-1/0:r[g],E=r[g+1],I=g,x=g+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const C=s.parse(E,x,h);if(!C)return null;h=h||C.type,m.push([w,C])}return new lh(h,u,m)}evaluate(r){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(r);const m=this.input.evaluate(r);if(m<=s[0])return u[0].evaluate(r);const h=s.length;return m>=s[h-1]?u[h-1].evaluate(r):u[Br(s,m)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&r.push(this.labels[s]),r.push(this.outputs[s].serialize());return r}}const Mv=.95047,Pv=1.08883,Zg=4/29,bu=6/29,jn=3*bu*bu,f2=bu*bu*bu,p2=Math.PI/180,m2=180/Math.PI;function Yg(c){return c>f2?Math.pow(c,1/3):c/jn+Zg}function Xg(c){return c>bu?c*c*c:jn*(c-Zg)}function Kg(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Jg(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Av(c){const r=Jg(c.r),s=Jg(c.g),u=Jg(c.b),m=Yg((.4124564*r+.3575761*s+.1804375*u)/Mv),h=Yg((.2126729*r+.7151522*s+.072175*u)/1);return{l:116*h-16,a:500*(m-h),b:200*(h-Yg((.0193339*r+.119192*s+.9503041*u)/Pv)),alpha:c.a}}function Iv(c){let r=(c.l+16)/116,s=isNaN(c.a)?r:r+c.a/500,u=isNaN(c.b)?r:r-c.b/200;return r=1*Xg(r),s=Mv*Xg(s),u=Pv*Xg(u),new Xr(Kg(3.2404542*s-1.5371385*r-.4985314*u),Kg(-.969266*s+1.8760108*r+.041556*u),Kg(.0556434*s-.2040259*r+1.0572252*u),c.alpha)}function g2(c,r,s){const u=r-c;return c+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const ch={forward:Av,reverse:Iv,interpolate:function(c,r,s){return{l:pr(c.l,r.l,s),a:pr(c.a,r.a,s),b:pr(c.b,r.b,s),alpha:pr(c.alpha,r.alpha,s)}}},uh={forward:function(c){const{l:r,a:s,b:u}=Av(c),m=Math.atan2(u,s)*m2;return{h:m<0?m+360:m,c:Math.sqrt(s*s+u*u),l:r,alpha:c.a}},reverse:function(c){const r=c.h*p2,s=c.c;return Iv({l:c.l,a:Math.cos(r)*s,b:Math.sin(r)*s,alpha:c.alpha})},interpolate:function(c,r,s){return{h:g2(c.h,r.h,s),c:pr(c.c,r.c,s),l:pr(c.l,r.l,s),alpha:pr(c.alpha,r.alpha,s)}}};var kv=Object.freeze({__proto__:null,hcl:uh,lab:ch});class Zo{constructor(r,s,u,m,h,g){this.type=r,this.operator=s,this.interpolation=u,this.input=m,this.dynamicStops=h,this.labels=[],this.outputs=[];for(const[w,E]of g)this.labels.push(w),this.outputs.push(E)}static interpolationFactor(r,s,u,m){let h=0;if(r.name==="exponential")h=Qg(s,r.base,u,m);else if(r.name==="linear")h=Qg(s,1,u,m);else if(r.name==="cubic-bezier"){const g=r.controlPoints;h=new Yt(g[0],g[1],g[2],g[3]).solve(Qg(s,1,u,m))}return h}static parse(r,s){let[u,m,h,...g]=r;if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const I=m[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:I}}else{if(m[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const I=m.slice(1);if(I.length!==4||I.some(x=>typeof x!="number"||x<0||x>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:I}}}if(r.length-1<3)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(h=s.parse(h,2,Ht),!h)return null;const w=[];let E=null;if(u==="interpolate-hcl"||u==="interpolate-lab"?E=Ho:s.expectedType&&s.expectedType.kind!=="value"&&(E=s.expectedType),r.length-1==3){const I=s.parse(g[0],3,Vr);return I?new Zo(E,u,m,h,I,w):null}for(let I=0;I<g.length;I+=2){const x=g[I],C=g[I+1],P=I+3,T=I+4;if(typeof x!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(w.length&&w[w.length-1][0]>=x)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const M=s.parse(C,T,E);if(!M)return null;E=E||M.type,w.push([x,M])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Zo(E,u,m,h,null,w):s.error(`Type ${On(E)} is not interpolatable.`)}evaluate(r){let s=this.labels,u=this.outputs;if(this.dynamicStops){const x=this.dynamicStops.evaluate(r);if(x.length%2!=0)throw new pi("Expected an even number of arguments.");s=[],u=[];for(let C=0;C<x.length;C+=2){const P=x[C],T=new Ts(Ht,x[C+1]);if(typeof P!="number")throw new pi('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(s.length&&s[s.length-1]>=P)throw new pi('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');s.push(P),u.push(T)}if(s.length===0)throw new pi("Expected at least one input/output pair.")}if(s.length===1)return u[0].evaluate(r);const m=this.input.evaluate(r);if(m<=s[0])return u[0].evaluate(r);const h=s.length;if(m>=s[h-1])return u[h-1].evaluate(r);const g=Br(s,m),w=Zo.interpolationFactor(this.interpolation,m,s[g],s[g+1]),E=u[g].evaluate(r),I=u[g+1].evaluate(r);return this.operator==="interpolate"?Zr[this.type.kind.toLowerCase()](E,I,w):this.operator==="interpolate-hcl"?uh.reverse(uh.interpolate(uh.forward(E),uh.forward(I),w)):ch.reverse(ch.interpolate(ch.forward(E),ch.forward(I),w))}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,r,this.input.serialize()];if(this.dynamicStops)s.push(this.dynamicStops.serialize());else for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function Qg(c,r,s,u){const m=u-s,h=c-s;return m===0?0:r===1?h/m:(Math.pow(r,h)-1)/(Math.pow(r,m)-1)}class sp{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let u=null;const m=s.expectedType;m&&m.kind!=="value"&&(u=m);const h=[];for(const w of r.slice(1)){const E=s.parse(w,1+h.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,h.push(E)}const g=m&&h.some(w=>Jd(m,w.type));return new sp(g?Vr:u,h)}evaluate(r){let s,u=null,m=0;for(const h of this.args){if(m++,u=h.evaluate(r),u&&u instanceof Ii&&!u.available&&(s||(s=u),u=null,m===this.args.length))return s;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class ap{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let h=1;h<r.length-1;h+=2){const g=r[h];if(typeof g!="string")return s.error(`Expected string, but found ${typeof g} instead.`,h);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",h);const w=s.parse(r[h+1],h+1);if(!w)return null;u.push([g,w])}const m=s.parse(r[r.length-1],r.length-1,s.expectedType,u);return m?new ap(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[s,u]of this.bindings)r.push(s,u.serialize());return r.push(this.result.serialize()),r}}class e_{constructor(r,s,u){this.type=r,this.index=s,this.input=u}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Ht),m=s.parse(r[2],2,uo(s.expectedType||Vr));return u&&m?new e_(m.type.itemType,u,m):null}evaluate(r){const s=this.index.evaluate(r),u=this.input.evaluate(r);if(s<0)throw new pi(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new pi(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];const m=Math.floor(s),h=Math.ceil(s),g=u[m],w=u[h];if(typeof g!="number"||typeof w!="number")throw new pi(`Cannot interpolate between non-number values at index ${s}.`);const E=s-m;return g*(1-E)+w*E}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class t_{constructor(r,s){this.type=Yr,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Vr),m=s.parse(r[2],2,Vr);return u&&m?Gf(u.type,[Yr,rn,Ht,du,Vr])?new t_(u,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${On(u.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!hu(s,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${On(Hn(s))} instead.`);if(!hu(u,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${On(Hn(u))} instead.`);return u.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class lp{constructor(r,s,u){this.type=Ht,this.needle=r,this.haystack=s,this.fromIndex=u}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Vr),m=s.parse(r[2],2,Vr);if(!u||!m)return null;if(!Gf(u.type,[Yr,rn,Ht,du,Vr]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${On(u.type)} instead`);if(r.length===4){const h=s.parse(r[3],3,Ht);return h?new lp(u,m,h):null}return new lp(u,m)}evaluate(r){const s=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!hu(s,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${On(Hn(s))} instead.`);if(!hu(u,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${On(Hn(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return u.indexOf(s,m)}return u.indexOf(s)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class r_{constructor(r,s,u,m,h,g){this.inputType=r,this.type=s,this.input=u,this.cases=m,this.outputs=h,this.otherwise=g}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let u,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);const h={},g=[];for(let I=2;I<r.length-1;I+=2){let x=r[I];const C=r[I+1];Array.isArray(x)||(x=[x]);const P=s.concat(I);if(x.length===0)return P.error("Expected at least one branch label.");for(const M of x){if(typeof M!="number"&&typeof M!="string")return P.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return P.error("Numeric branch labels must be integer values.");if(u){if(P.checkSubtype(u,Hn(M)))return null}else u=Hn(M);if(h[String(M)]!==void 0)return P.error("Branch labels must be unique.");h[String(M)]=g.length}const T=s.parse(C,I,m);if(!T)return null;m=m||T.type,g.push(T)}const w=s.parse(r[1],1,Vr);if(!w)return null;const E=s.parse(r[r.length-1],r.length-1,m);return E?w.type.kind!=="value"&&s.concat(1).checkSubtype(u,w.type)?null:new r_(u,m,w,h,g,E):null}evaluate(r){const s=this.input.evaluate(r);return(Hn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],m={};for(const g of s){const w=m[this.cases[g]];w===void 0?(m[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[w][1].push(g)}const h=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,w]of u)r.push(w.length===1?h(w[0]):w.map(h)),r.push(this.outputs[g].serialize());return r.push(this.otherwise.serialize()),r}}class n_{constructor(r,s,u){this.type=r,this.branches=s,this.otherwise=u}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const m=[];for(let g=1;g<r.length-1;g+=2){const w=s.parse(r[g],g,Yr);if(!w)return null;const E=s.parse(r[g+1],g+1,u);if(!E)return null;m.push([w,E]),u=u||E.type}const h=s.parse(r[r.length-1],r.length-1,u);return h?new n_(u,m,h):null}evaluate(r){for(const[s,u]of this.branches)if(s.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,u]of this.branches)r(s),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class cp{constructor(r,s,u,m){this.type=r,this.input=s,this.beginIndex=u,this.endIndex=m}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Vr),m=s.parse(r[2],2,Ht);if(!u||!m)return null;if(!Gf(u.type,[uo(Vr),rn,Vr]))return s.error(`Expected first argument to be of type array or string, but found ${On(u.type)} instead`);if(r.length===4){const h=s.parse(r[3],3,Ht);return h?new cp(u.type,u,m,h):null}return new cp(u.type,u,m)}evaluate(r){const s=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!hu(s,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${On(Hn(s))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return s.slice(u,m)}return s.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Rv(c,r){return c==="=="||c==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Dv(c,r,s,u){return u.compare(r,s)===0}function wu(c,r,s){const u=c!=="=="&&c!=="!=";return class CB{constructor(h,g,w){this.type=Yr,this.lhs=h,this.rhs=g,this.collator=w,this.hasUntypedArgument=h.type.kind==="value"||g.type.kind==="value"}static parse(h,g){if(h.length!==3&&h.length!==4)return g.error("Expected two or three arguments.");const w=h[0];let E=g.parse(h[1],1,Vr);if(!E)return null;if(!Rv(w,E.type))return g.concat(1).error(`"${w}" comparisons are not supported for type '${On(E.type)}'.`);let I=g.parse(h[2],2,Vr);if(!I)return null;if(!Rv(w,I.type))return g.concat(2).error(`"${w}" comparisons are not supported for type '${On(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return g.error(`Cannot compare types '${On(E.type)}' and '${On(I.type)}'.`);u&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new Es(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new Es(E.type,[I])));let x=null;if(h.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(x=g.parse(h[3],3,$f),!x)return null}return new CB(E,I,x)}evaluate(h){const g=this.lhs.evaluate(h),w=this.rhs.evaluate(h);if(u&&this.hasUntypedArgument){const E=Hn(g),I=Hn(w);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new pi(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=Hn(g),I=Hn(w);if(E.kind!=="string"||I.kind!=="string")return r(h,g,w)}return this.collator?s(h,g,w,this.collator.evaluate(h)):r(h,g,w)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[c];return this.eachChild(g=>{h.push(g.serialize())}),h}}}const _2=wu("==",function(c,r,s){return r===s},Dv),y2=wu("!=",function(c,r,s){return r!==s},function(c,r,s,u){return!Dv(0,r,s,u)}),v2=wu("<",function(c,r,s){return r<s},function(c,r,s,u){return u.compare(r,s)<0}),x2=wu(">",function(c,r,s){return r>s},function(c,r,s,u){return u.compare(r,s)>0}),b2=wu("<=",function(c,r,s){return r<=s},function(c,r,s,u){return u.compare(r,s)<=0}),i_=wu(">=",function(c,r,s){return r>=s},function(c,r,s,u){return u.compare(r,s)>=0});class o_{constructor(r,s,u,m,h,g){this.type=rn,this.number=r,this.locale=s,this.currency=u,this.unit=m,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const u=s.parse(r[1],1,Ht);if(!u)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let h=null;if(m.locale&&(h=s.parseObjectValue(m.locale,2,"locale",rn),!h))return null;let g=null;if(m.currency&&(g=s.parseObjectValue(m.currency,2,"currency",rn),!g))return null;let w=null;if(m.unit&&(w=s.parseObjectValue(m.unit,2,"unit",rn),!w))return null;let E=null;if(m["min-fraction-digits"]&&(E=s.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",Ht),!E))return null;let I=null;return m["max-fraction-digits"]&&(I=s.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",Ht),!I)?null:new o_(u,h,g,w,E,I)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class up{constructor(r){this.type=Ht,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=s.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${On(u.type)} instead.`):new up(u):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string"||Array.isArray(s))return s.length;throw new pi(`Expected value to be of type string or array, but found ${On(Hn(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(s=>{r.push(s.serialize())}),r}}function Lv(c){return function(){c=1831565813+(c|=0)|0;let r=Math.imul(c^c>>>15,1|c);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const Su={"==":_2,"!=":y2,">":x2,"<":v2,">=":i_,"<=":b2,array:Es,at:e_,boolean:Es,case:n_,coalesce:sp,collator:Zf,format:Fa,image:fu,in:t_,"index-of":lp,interpolate:Zo,"interpolate-hcl":Zo,"interpolate-lab":Zo,length:up,let:ap,literal:Ts,match:r_,number:Es,"number-format":o_,object:Es,slice:cp,step:lh,string:Es,"to-boolean":ja,"to-color":ja,"to-number":ja,"to-string":ja,var:ah,within:Ba,distance:Pl,config:yc};function Ov(c,[r,s,u,m]){r=r.evaluate(c),s=s.evaluate(c),u=u.evaluate(c);const h=m?m.evaluate(c):1,g=mc(r,s,u,h);if(g)throw new pi(g);return new Xr(r/255*h,s/255*h,u/255*h,h)}function s_(c,[r,s,u,m]){r=r.evaluate(c),s=s.evaluate(c),u=u.evaluate(c);const h=m?m.evaluate(c):1,g=function(I,x,C,P){return typeof I=="number"&&I>=0&&I<=360?typeof x=="number"&&x>=0&&x<=100&&typeof C=="number"&&C>=0&&C<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[I,x,C,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[I,x,C,P]:[I,x,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[I,x,C,P]:[I,x,C]).join(", ")}]: 'h' must be between 0 and 360.`}(r,s,u,h);if(g)throw new pi(g);const w=`hsla(${r}, ${s}%, ${u}%, ${h})`,E=Xr.parse(w);if(!E)throw new pi(`Failed to parse HSLA color: ${w}`);return E}function a_(c,r){return c in r}function Il(c,r){const s=r[c];return s===void 0?null:s}function kl(c){return{type:c}}function l_(c){return{result:"success",value:c}}function Rl(c){return{result:"error",value:c}}function dh(c,r){return!!c&&!!c.parameters&&c.parameters.indexOf(r)>-1}function Tu(c){return c["property-type"]==="data-driven"}function zv(c){return dh(c.expression,"measure-light")}function Nv(c){return dh(c.expression,"zoom")}function dp(c){return!!c.expression&&c.expression.interpolated}function hp(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function w2(c){return c}function Fv(c,r){const s=r.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",m=u||!(u||c.property!==void 0),h=c.type||(dp(r)?"exponential":"interval");if(s&&((c=Vf({},c)).stops&&(c.stops=c.stops.map(I=>[I[0],Xr.parse(I[1])])),c.default=Xr.parse(c.default?c.default:r.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!kv[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let g,w,E;if(h==="exponential")g=fh;else if(h==="interval")g=Bv;else if(h==="categorical"){g=jv,w=Object.create(null);for(const I of c.stops)w[I[0]]=I[1];E=typeof c.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);g=S2}if(u){const I={},x=[];for(let T=0;T<c.stops.length;T++){const M=c.stops[T],R=M[0].zoom;I[R]===void 0&&(I[R]={zoom:R,type:c.type,property:c.property,default:c.default,stops:[]},x.push(R)),I[R].stops.push([M[0].value,M[1]])}const C=[];for(const T of x)C.push([I[T].zoom,Fv(I[T],r)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Zo.interpolationFactor.bind(void 0,P),zoomStops:C.map(T=>T[0]),evaluate:({zoom:T},M)=>fh({stops:C,base:c.base},r,T).evaluate(T,M)}}if(m){const I=h==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Zo.interpolationFactor.bind(void 0,I),zoomStops:c.stops.map(x=>x[0]),evaluate:({zoom:x})=>g(c,r,x,w,E)}}return{kind:"source",evaluate(I,x){const C=x&&x.properties?x.properties[c.property]:void 0;return C===void 0?hh(c.default,r.default):g(c,r,C,w,E)}}}function hh(c,r,s){return c!==void 0?c:r!==void 0?r:s!==void 0?s:void 0}function jv(c,r,s,u,m){return hh(typeof s===m?u[s]:void 0,c.default,r.default)}function Bv(c,r,s){if(_c(s)!=="number")return hh(c.default,r.default);const u=c.stops.length;if(u===1||s<=c.stops[0][0])return c.stops[0][1];if(s>=c.stops[u-1][0])return c.stops[u-1][1];const m=Br(c.stops.map(h=>h[0]),s);return c.stops[m][1]}function fh(c,r,s){const u=c.base!==void 0?c.base:1;if(_c(s)!=="number")return hh(c.default,r.default);const m=c.stops.length;if(m===1||s<=c.stops[0][0])return c.stops[0][1];if(s>=c.stops[m-1][0])return c.stops[m-1][1];const h=Br(c.stops.map(x=>x[0]),s),g=function(x,C,P,T){const M=T-P,R=x-P;return M===0?0:C===1?R/M:(Math.pow(C,R)-1)/(Math.pow(C,M)-1)}(s,u,c.stops[h][0],c.stops[h+1][0]),w=c.stops[h][1],E=c.stops[h+1][1];let I=Zr[r.type]||w2;if(c.colorSpace&&c.colorSpace!=="rgb"){const x=kv[c.colorSpace];I=(C,P)=>x.reverse(x.interpolate(x.forward(C),x.forward(P),g))}return typeof w.evaluate=="function"?{evaluate(...x){const C=w.evaluate.apply(void 0,x),P=E.evaluate.apply(void 0,x);if(C!==void 0&&P!==void 0)return I(C,P,g)}}:I(w,E,g)}function S2(c,r,s){return r.type==="color"?s=Xr.parse(s):r.type==="formatted"?s=ho.fromString(s.toString()):r.type==="resolvedImage"?s=Ii.build(s.toString()):_c(s)===r.type||r.type==="enum"&&r.values[s]||(s=void 0),hh(s,c.default,r.default)}qo.register(Su,{error:[{kind:"error"},[rn],(c,[r])=>{throw new pi(r.evaluate(c))}],typeof:[rn,[Vr],(c,[r])=>On(Hn(r.evaluate(c)))],"to-rgba":[uo(Ht,4),[Ho],(c,[r])=>r.evaluate(c).toRenderColor(null).toArray()],"to-hsla":[uo(Ht,4),[Ho],(c,[r])=>r.evaluate(c).toRenderColor(null).toHslaArray()],rgb:[Ho,[Ht,Ht,Ht],Ov],rgba:[Ho,[Ht,Ht,Ht,Ht],Ov],hsl:[Ho,[Ht,Ht,Ht],s_],hsla:[Ho,[Ht,Ht,Ht,Ht],s_],has:{type:Yr,overloads:[[[rn],(c,[r])=>a_(r.evaluate(c),c.properties())],[[rn,hc],(c,[r,s])=>a_(r.evaluate(c),s.evaluate(c))]]},get:{type:Vr,overloads:[[[rn],(c,[r])=>Il(r.evaluate(c),c.properties())],[[rn,hc],(c,[r,s])=>Il(r.evaluate(c),s.evaluate(c))]]},"feature-state":[Vr,[rn],(c,[r])=>Il(r.evaluate(c),c.featureState||{})],properties:[hc,[],c=>c.properties()],"geometry-type":[rn,[],c=>c.geometryType()],id:[Vr,[],c=>c.id()],zoom:[Ht,[],c=>c.globals.zoom],pitch:[Ht,[],c=>c.globals.pitch||0],"distance-from-center":[Ht,[],c=>c.distanceFromCenter()],"measure-light":[Ht,[rn],(c,[r])=>c.measureLight(r.evaluate(c))],"heatmap-density":[Ht,[],c=>c.globals.heatmapDensity||0],"line-progress":[Ht,[],c=>c.globals.lineProgress||0],"raster-value":[Ht,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[Ht,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ht,[],c=>c.globals.skyRadialProgress||0],accumulated:[Vr,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Ht,kl(Ht),(c,r)=>{let s=0;for(const u of r)s+=u.evaluate(c);return s}],"*":[Ht,kl(Ht),(c,r)=>{let s=1;for(const u of r)s*=u.evaluate(c);return s}],"-":{type:Ht,overloads:[[[Ht,Ht],(c,[r,s])=>r.evaluate(c)-s.evaluate(c)],[[Ht],(c,[r])=>-r.evaluate(c)]]},"/":[Ht,[Ht,Ht],(c,[r,s])=>r.evaluate(c)/s.evaluate(c)],"%":[Ht,[Ht,Ht],(c,[r,s])=>r.evaluate(c)%s.evaluate(c)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(c,[r,s])=>Math.pow(r.evaluate(c),s.evaluate(c))],sqrt:[Ht,[Ht],(c,[r])=>Math.sqrt(r.evaluate(c))],log10:[Ht,[Ht],(c,[r])=>Math.log(r.evaluate(c))/Math.LN10],ln:[Ht,[Ht],(c,[r])=>Math.log(r.evaluate(c))],log2:[Ht,[Ht],(c,[r])=>Math.log(r.evaluate(c))/Math.LN2],sin:[Ht,[Ht],(c,[r])=>Math.sin(r.evaluate(c))],cos:[Ht,[Ht],(c,[r])=>Math.cos(r.evaluate(c))],tan:[Ht,[Ht],(c,[r])=>Math.tan(r.evaluate(c))],asin:[Ht,[Ht],(c,[r])=>Math.asin(r.evaluate(c))],acos:[Ht,[Ht],(c,[r])=>Math.acos(r.evaluate(c))],atan:[Ht,[Ht],(c,[r])=>Math.atan(r.evaluate(c))],min:[Ht,kl(Ht),(c,r)=>Math.min(...r.map(s=>s.evaluate(c)))],max:[Ht,kl(Ht),(c,r)=>Math.max(...r.map(s=>s.evaluate(c)))],abs:[Ht,[Ht],(c,[r])=>Math.abs(r.evaluate(c))],round:[Ht,[Ht],(c,[r])=>{const s=r.evaluate(c);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ht,[Ht],(c,[r])=>Math.floor(r.evaluate(c))],ceil:[Ht,[Ht],(c,[r])=>Math.ceil(r.evaluate(c))],"filter-==":[Yr,[rn,Vr],(c,[r,s])=>c.properties()[r.value]===s.value],"filter-id-==":[Yr,[Vr],(c,[r])=>c.id()===r.value],"filter-type-==":[Yr,[rn],(c,[r])=>c.geometryType()===r.value],"filter-<":[Yr,[rn,Vr],(c,[r,s])=>{const u=c.properties()[r.value],m=s.value;return typeof u==typeof m&&u<m}],"filter-id-<":[Yr,[Vr],(c,[r])=>{const s=c.id(),u=r.value;return typeof s==typeof u&&s<u}],"filter->":[Yr,[rn,Vr],(c,[r,s])=>{const u=c.properties()[r.value],m=s.value;return typeof u==typeof m&&u>m}],"filter-id->":[Yr,[Vr],(c,[r])=>{const s=c.id(),u=r.value;return typeof s==typeof u&&s>u}],"filter-<=":[Yr,[rn,Vr],(c,[r,s])=>{const u=c.properties()[r.value],m=s.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[Yr,[Vr],(c,[r])=>{const s=c.id(),u=r.value;return typeof s==typeof u&&s<=u}],"filter->=":[Yr,[rn,Vr],(c,[r,s])=>{const u=c.properties()[r.value],m=s.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[Yr,[Vr],(c,[r])=>{const s=c.id(),u=r.value;return typeof s==typeof u&&s>=u}],"filter-has":[Yr,[Vr],(c,[r])=>r.value in c.properties()],"filter-has-id":[Yr,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Yr,[uo(rn)],(c,[r])=>r.value.indexOf(c.geometryType())>=0],"filter-id-in":[Yr,[uo(Vr)],(c,[r])=>r.value.indexOf(c.id())>=0],"filter-in-small":[Yr,[rn,uo(Vr)],(c,[r,s])=>s.value.indexOf(c.properties()[r.value])>=0],"filter-in-large":[Yr,[rn,uo(Vr)],(c,[r,s])=>function(u,m,h,g){for(;h<=g;){const w=h+g>>1;if(m[w]===u)return!0;m[w]>u?g=w-1:h=w+1}return!1}(c.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Yr,overloads:[[[Yr,Yr],(c,[r,s])=>r.evaluate(c)&&s.evaluate(c)],[kl(Yr),(c,r)=>{for(const s of r)if(!s.evaluate(c))return!1;return!0}]]},any:{type:Yr,overloads:[[[Yr,Yr],(c,[r,s])=>r.evaluate(c)||s.evaluate(c)],[kl(Yr),(c,r)=>{for(const s of r)if(s.evaluate(c))return!0;return!1}]]},"!":[Yr,[Yr],(c,[r])=>!r.evaluate(c)],"is-supported-script":[Yr,[rn],(c,[r])=>{const s=c.globals&&c.globals.isSupportedScript;return!s||s(r.evaluate(c))}],upcase:[rn,[rn],(c,[r])=>r.evaluate(c).toUpperCase()],downcase:[rn,[rn],(c,[r])=>r.evaluate(c).toLowerCase()],concat:[rn,kl(Vr),(c,r)=>r.map(s=>qs(s.evaluate(c))).join("")],"resolved-locale":[rn,[$f],(c,[r])=>r.evaluate(c).resolvedLocale()],random:[Ht,[Ht,Ht,Vr],(c,r)=>{const[s,u,m]=r.map(g=>g.evaluate(c));if(s>u||s===u)return s;let h;if(typeof m=="string")h=function(g){let w=0;if(g.length===0)return w;for(let E=0;E<g.length;E++)w=(w<<5)-w+g.charCodeAt(E),w|=0;return w}(m);else{if(typeof m!="number")throw new pi(`Invalid seed input: ${m}`);h=m}return s+Lv(h)()*(u-s)}]});class fp{constructor(r,s,u,m){this.expression=r,this._warningHistory={},this._evaluator=new qf(u,m),this._defaultValue=s?function(h){return h.type==="color"&&(hp(h.default)||Array.isArray(h.default))?new Xr(0,0,0,0):h.type==="color"?Xr.parse(h.default)||null:h.default===void 0?null:h.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=xc(r)}evaluateWithoutErrorHandling(r,s,u,m,h,g,w,E){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,s,u,m,h,g,w,E){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function c_(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Su}function ph(c,r,s,u){const m=new Wg(Su,[],r?function(g){const w={color:Ho,string:rn,number:Ht,enum:rn,boolean:Yr,formatted:Na,resolvedImage:fc};return g.type==="array"?uo(w[g.value]||Vr,g.length):w[g.type]}(r):void 0,void 0,void 0,s,u),h=m.parse(c,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?l_(new fp(h,r,s,u)):Rl(m.errors)}class pp{constructor(r,s,u,m){this.kind=r,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=m,this.isStateDependent=r!=="constant"&&!vc(s.expression),this.configDependencies=xc(s.expression)}evaluateWithoutErrorHandling(r,s,u,m,h,g){return this._styleExpression.evaluateWithoutErrorHandling(r,s,u,m,h,g)}evaluate(r,s,u,m,h,g){return this._styleExpression.evaluate(r,s,u,m,h,g)}}class Eu{constructor(r,s,u,m,h,g){this.kind=r,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!vc(s.expression),this.isLightConstant=h,this.isLineProgressConstant=g,this.configDependencies=xc(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,s,u,m,h,g){return this._styleExpression.evaluateWithoutErrorHandling(r,s,u,m,h,g)}evaluate(r,s,u,m,h,g){return this._styleExpression.evaluate(r,s,u,m,h,g)}interpolationFactor(r,s,u){return this.interpolationType?Zo.interpolationFactor(this.interpolationType,r,s,u):0}}function Uv(c,r,s,u){if((c=ph(c,r,s,u)).result==="error")return c;const m=c.value.expression,h=xu(m);if(!h&&!Tu(r))return Rl([new Ss("","data expressions not supported")]);const g=Ga(m,["zoom","pitch","distance-from-center"]);if(!g&&!Nv(r))return Rl([new Ss("","zoom expressions not supported")]);const w=Ga(m,["measure-light"]);if(!w&&!zv(r))return Rl([new Ss("","measure-light expression not supported")]);const E=Ga(m,["line-progress"]);if(!E&&!function(C){return dh(C.expression,"line-progress")}(r))return Rl([new Ss("","line-progress expression not supported")]);const I=r.expression&&r.expression.relaxZoomRestriction,x=gp(m);return x||g||I?x instanceof Ss?Rl([x]):x instanceof Zo&&!dp(r)?Rl([new Ss("",'"interpolate" expressions cannot be used with this property')]):l_(x?new Eu(h&&E?"camera":"composite",c.value,x.labels,x instanceof Zo?x.interpolation:void 0,w,E):new pp(h&&E?"constant":"source",c.value,w,E)):Rl([new Ss("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class mp{constructor(r,s){this._parameters=r,this._specification=s,Vf(this,Fv(this._parameters,this._specification))}static deserialize(r){return new mp(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function gp(c){let r=null;if(c instanceof ap)r=gp(c.result);else if(c instanceof sp){for(const s of c.args)if(r=gp(s),r)break}else(c instanceof lh||c instanceof Zo)&&c.input instanceof qo&&c.input.name==="zoom"&&(r=c);return r instanceof Ss||c.eachChild(s=>{const u=gp(s);u instanceof Ss?r=u:r&&u&&r!==u&&(r=new Ss("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var _p,Vv,T2=function(){if(Vv)return _p;Vv=1,_p=r;var c=3;function r(s,u,m){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var g=new Int32Array(this.arrayBuffer);s=g[0],this.d=(u=g[1])+2*(m=g[2]);for(var w=0;w<this.d*this.d;w++){var E=g[c+w],I=g[c+w+1];h.push(E===I?null:g.subarray(E,I))}var x=g[c+h.length+1];this.keys=g.subarray(g[c+h.length],x),this.bboxes=g.subarray(x),this.insert=this._insertReadonly}else{this.d=u+2*m;for(var C=0;C<this.d*this.d;C++)h.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=m,this.scale=u/s,this.uid=0;var P=m/u*s;this.min=-P,this.max=s+P}return r.prototype.insert=function(s,u,m,h,g){this._forEachCell(u,m,h,g,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(h),this.bboxes.push(g)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(s,u,m,h,g,w){this.cells[g].push(w)},r.prototype.query=function(s,u,m,h,g){var w=this.min,E=this.max;if(s<=w&&u<=w&&E<=m&&E<=h&&!g)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(s,u,m,h,this._queryCell,I,{},g),I},r.prototype._queryCell=function(s,u,m,h,g,w,E,I){var x=this.cells[g];if(x!==null)for(var C=this.keys,P=this.bboxes,T=0;T<x.length;T++){var M=x[T];if(E[M]===void 0){var R=4*M;(I?I(P[R+0],P[R+1],P[R+2],P[R+3]):s<=P[R+2]&&u<=P[R+3]&&m>=P[R+0]&&h>=P[R+1])?(E[M]=!0,w.push(C[M])):E[M]=!1}}},r.prototype._forEachCell=function(s,u,m,h,g,w,E,I){for(var x=this._convertToCellCoord(s),C=this._convertToCellCoord(u),P=this._convertToCellCoord(m),T=this._convertToCellCoord(h),M=x;M<=P;M++)for(var R=C;R<=T;R++){var B=this.d*R+M;if((!I||I(this._convertFromCellCoord(M),this._convertFromCellCoord(R),this._convertFromCellCoord(M+1),this._convertFromCellCoord(R+1)))&&g.call(this,s,u,m,h,B,w,E,I))return}},r.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},r.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=c+this.cells.length+1+1,m=0,h=0;h<this.cells.length;h++)m+=this.cells[h].length;var g=new Int32Array(u+m+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var w=u,E=0;E<s.length;E++){var I=s[E];g[c+E]=w,g.set(I,w),w+=I.length}return g[c+s.length]=w,g.set(this.keys,w),g[c+s.length+1]=w+=this.keys.length,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer},_p}(),bc=k(T2);const mh={};function qt(c,r,s={}){Object.defineProperty(c,"_classRegistryKey",{value:r,writable:!1}),mh[r]={klass:c,omit:s.omit||[]}}qt(Object,"Object"),bc.serialize=function(c,r){const s=c.toArrayBuffer();return r&&r.add(s),{buffer:s}},bc.deserialize=function(c){return new bc(c.buffer)},Object.defineProperty(bc,"name",{value:"Grid"}),qt(bc,"Grid"),typeof DOMMatrix<"u"&&qt(DOMMatrix,"DOMMatrix"),qt(Xr,"Color"),qt(Error,"Error"),qt(ho,"Formatted"),qt(Qd,"FormattedSection"),qt(Of,"AJAXError"),qt(Ii,"ResolvedImage"),qt(mp,"StylePropertyFunction"),qt(fp,"StyleExpression",{omit:["_evaluator"]}),qt(pc,"ImageIdWithOptions"),qt(Eu,"ZoomDependentExpression"),qt(pp,"ZoomConstantExpression"),qt(qo,"CompoundExpression",{omit:["_evaluate"]});for(const c in Su)mh[Su[c]._classRegistryKey]||qt(Su[c],`Expression${c}`);function $v(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function wc(c){return self.ImageBitmap&&c instanceof ImageBitmap}function Sc(c,r){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if($v(c)||wc(c))return r&&r.add(c),c;if(ArrayBuffer.isView(c))return r&&r.add(c.buffer),c;if(c instanceof ImageData)return r&&r.add(c.data.buffer),c;if(Array.isArray(c)){const s=[];for(const u of c)s.push(Sc(u,r));return s}if(c instanceof Map){const s={$name:"Map"};for(const[u,m]of c.entries())s[u]=Sc(m);return s}if(c instanceof Set){const s={$name:"Set"};let u=0;for(const m of c.values())s[++u]=Sc(m);return s}if(typeof c=="object"){const s=c.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${u}".`);const m=s.serialize?s.serialize(c,r):{};if(!s.serialize){for(const h in c)c.hasOwnProperty(h)&&(mh[u].omit.indexOf(h)>=0||(m[h]=Sc(c[h],r)));c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof c)}function Tc(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||$v(c)||wc(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Tc);if(typeof c=="object"){const r=c.$name||"Object";if(r==="Map"){const m=new Map;for(const h of Object.keys(c))h!=="$name"&&m.set(h,Tc(c[h]));return m}if(r==="Set"){const m=new Set;for(const h of Object.keys(c))h!=="$name"&&m.add(Tc(c[h]));return m}const{klass:s}=mh[r];if(!s)throw new Error(`Can't deserialize unregistered class "${r}".`);if(s.deserialize)return s.deserialize(c);const u=Object.create(s.prototype);for(const m of Object.keys(c))m!=="$name"&&(u[m]=Tc(c[m]));return u}throw new Error("can't deserialize object of type "+typeof c)}const nr={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function yp(c){for(const r of c)if(vp(r.charCodeAt(0)))return!0;return!1}function Gv(c){for(const r of c)if(!Hv(r.charCodeAt(0)))return!1;return!0}function Hv(c){return!(nr.Arabic(c)||nr["Arabic Supplement"](c)||nr["Arabic Extended-A"](c)||nr["Arabic Presentation Forms-A"](c)||nr["Arabic Presentation Forms-B"](c))}function vp(c){return!(c!==746&&c!==747&&(c<4352||!(nr["Bopomofo Extended"](c)||nr.Bopomofo(c)||nr["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||nr["CJK Compatibility Ideographs"](c)||nr["CJK Compatibility"](c)||nr["CJK Radicals Supplement"](c)||nr["CJK Strokes"](c)||!(!nr["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||nr["CJK Unified Ideographs Extension A"](c)||nr["CJK Unified Ideographs"](c)||nr["Enclosed CJK Letters and Months"](c)||nr["Hangul Compatibility Jamo"](c)||nr["Hangul Jamo Extended-A"](c)||nr["Hangul Jamo Extended-B"](c)||nr["Hangul Jamo"](c)||nr["Hangul Syllables"](c)||nr.Hiragana(c)||nr["Ideographic Description Characters"](c)||nr.Kanbun(c)||nr["Kangxi Radicals"](c)||nr["Katakana Phonetic Extensions"](c)||nr.Katakana(c)&&c!==12540||!(!nr["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!nr["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||nr["Unified Canadian Aboriginal Syllabics"](c)||nr["Unified Canadian Aboriginal Syllabics Extended"](c)||nr["Vertical Forms"](c)||nr["Yijing Hexagram Symbols"](c)||nr["Yi Syllables"](c)||nr["Yi Radicals"](c))))}function xp(c){return!(vp(c)||function(r){return!!(nr["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||nr["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||nr["Letterlike Symbols"](r)||nr["Number Forms"](r)||nr["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||nr["Control Pictures"](r)&&r!==9251||nr["Optical Character Recognition"](r)||nr["Enclosed Alphanumerics"](r)||nr["Geometric Shapes"](r)||nr["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||nr["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||nr["CJK Symbols and Punctuation"](r)||nr.Katakana(r)||nr["Private Use Area"](r)||nr["CJK Compatibility Forms"](r)||nr["Small Form Variants"](r)||nr["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(c))}function bp(c){return c>=1424&&c<=2303||nr["Arabic Presentation Forms-A"](c)||nr["Arabic Presentation Forms-B"](c)}function qv(c,r){return!(!r&&bp(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||nr.Khmer(c))}function E2(c){for(const r of c)if(bp(r.charCodeAt(0)))return!0;return!1}const _a="deferred",u_="loading",d_="loaded";let wp=null,Yo="unavailable",Ys=null;const h_=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Yo="error"),wp&&wp(c)};function Cu(){Sp.fire(new El("pluginStateChange",{pluginStatus:Yo,pluginURL:Ys}))}const Sp=new uu,f_=function(){return Yo},Wv=function(){if(Yo!==_a||!Ys)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yo=u_,Cu(),Ys&&dc({url:Ys},c=>{c?h_(c):(Yo=d_,Cu())})},Xo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yo===d_||Xo.applyArabicShaping!=null,isLoading:()=>Yo===u_,setState(c){Yo=c.pluginStatus,Ys=c.pluginURL},isParsed:()=>Xo.applyArabicShaping!=null&&Xo.processBidirectionalText!=null&&Xo.processStyledBidirectionalText!=null,getPluginURL:()=>Ys};class Gn{constructor(r,s){this.zoom=r,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(s,u){for(const m of s)if(!qv(m.charCodeAt(0),u))return!1;return!0}(r,Xo.isLoaded())}}class gh{constructor(r,s,u,m){this.property=r,this.value=s,this.expression=function(h,g,w,E){if(hp(h))return new mp(h,g);if(c_(h)||Array.isArray(h)&&h.length>0){const I=Uv(h,g,w,E);if(I.result==="error")throw new Error(I.value.map(x=>`${x.key}: ${x.message}`).join(", "));return I.value}{let I=h;return typeof h=="string"&&g.type==="color"&&(I=Xr.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>I}}}(s===void 0?r.specification.default:s,r.specification,u,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,s,u){return this.property.possiblyEvaluate(this,r,s,u)}}class Mu{constructor(r,s,u){this.property=r,this.value=new gh(r,void 0,s,u)}transitioned(r,s){return new Zv(this.property,this.value,s,Xn({},r.transition,this.transition),r.now)}untransitioned(){return new Zv(this.property,this.value,null,{},0)}}class Ec{constructor(r,s,u){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this.configDependencies=new Set}getValue(r){return To(this._values[r].value.value)}setValue(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new Mu(this._values[r].property,this._scope,this._options)),this._values[r].value=new gh(this._values[r].property,s===null?void 0:To(s),this._scope,this._options),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]))}setTransitionOrValue(r,s){s&&(this._options=s);const u=this._properties.properties;if(r)for(const m in r){const h=r[m];if(Yi(m,"-transition")){const g=m.slice(0,-11);u[g]&&this.setTransition(g,h)}else u.hasOwnProperty(m)&&this.setValue(m,h)}}getTransition(r){return To(this._values[r].transition)}setTransition(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new Mu(this._values[r].property)),this._values[r].transition=To(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(r[s]=u);const m=this.getTransition(s);m!==void 0&&(r[`${s}-transition`]=m)}return r}transitioned(r,s){const u=new Yv(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(r,s._values[m]);return u}untransitioned(){const r=new Yv(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}}class Zv{constructor(r,s,u,m,h){const g=m.delay||0,w=m.duration||0;h=h||0,this.property=r,this.value=s,this.begin=h+g,this.end=this.begin+w,r.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(r,s,u){const m=r.now||0,h=this.value.possiblyEvaluate(r,s,u),g=this.prior;if(g){if(m>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(m<this.begin)return g.possiblyEvaluate(r,s,u);{const w=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(r,s,u),h,or(w))}}return h}}class Yv{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,u){const m=new Au(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(r,s,u);return m}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class C2{constructor(r,s,u){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=s,this._options=u,this.configDependencies=new Set}getValue(r){return To(this._values[r].value)}setValue(r,s){this._values[r]=new gh(this._values[r].property,s===null?void 0:To(s),this._scope,this._options),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]))}serialize(){const r={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(r[s]=u)}return r}possiblyEvaluate(r,s,u){const m=new Au(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(r,s,u);return m}}class Pu{constructor(r,s,u){this.property=r,this.value=s,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,s,u,m){return this.property.evaluate(this.value,this.parameters,r,s,u,m)}}class Au{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Mt{constructor(r){this.specification=r}possiblyEvaluate(r,s){return r.expression.evaluate(s)}interpolate(r,s,u){const m=Zr[this.specification.type];return m?m(r,s,u):r}}class Ut{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,u,m){return new Pu(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(s,null,{},u,m)}:r.expression,s)}interpolate(r,s,u){if(r.value.kind!=="constant"||s.value.kind!=="constant")return r;if(r.value.value===void 0||s.value.value===void 0)return new Pu(this,{kind:"constant",value:void 0},r.parameters);const m=Zr[this.specification.type];return m?new Pu(this,{kind:"constant",value:m(r.value.value,s.value.value,u)},r.parameters):r}evaluate(r,s,u,m,h,g){return r.kind==="constant"?r.value:r.evaluate(s,u,m,h,g)}}class Iu{constructor(r){this.specification=r}possiblyEvaluate(r,s,u,m){return!!r.expression.evaluate(s,null,{},u,m)}interpolate(){return!1}}class ti{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new Gn(0,{});for(const u in r){const m=r[u];m.specification.overridable&&this.overridableProperties.push(u);const h=this.defaultPropertyValues[u]=new gh(m,void 0),g=this.defaultTransitionablePropertyValues[u]=new Mu(m);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=h.possiblyEvaluate(s)}}}qt(Ut,"DataDrivenProperty"),qt(Mt,"DataConstantProperty"),qt(Iu,"ColorRampProperty");var Ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Xv(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Tp(c){if(Array.isArray(c))return c.map(Tp);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const r={};for(const s in c)r[s]=Tp(c[s]);return r}return Xv(c)}function p_(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const r of c.slice(1))if(!p_(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Kv(c,r="",s=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};p_(c)||(c=_h(c));const m=c;let h=!0;try{h=function(x){if(!ku(x))return x;let C=Tp(x);return Qv(C),C=Jv(C),C}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let g=null,w=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){w=Ke[`filter_${u}`];const x=ph(h,w,r,s);if(x.result==="error")throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));g=(C,P,T)=>x.value.evaluate(C,P,{},T)}let E=null,I=null;if(h!==m){const x=ph(m,w,r,s);if(x.result==="error")throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));E=(C,P,T,M,R)=>x.value.evaluate(C,P,{},T,void 0,void 0,M,R),I=!xu(x.value.expression)}return{filter:g,dynamicFilter:E||void 0,needGeometry:m_(h),needFeature:!!I}}function Jv(c){if(!Array.isArray(c))return c;const r=function(s){if(M2.has(s[0])){for(let u=1;u<s.length;u++)if(ku(s[u]))return!0}return s}(c);return r===!0?r:r.map(s=>Jv(s))}function Qv(c){let r=!1;const s=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)r=r||ku(c[u]),s.push(c[u+1]);s.push(c[c.length-1])}else if(c[0]==="match"){r=r||ku(c[1]);for(let u=2;u<c.length-1;u+=2)s.push(c[u+1]);s.push(c[c.length-1])}else if(c[0]==="step"){r=r||ku(c[1]);for(let u=1;u<c.length-1;u+=2)s.push(c[u+1])}r&&(c.length=0,c.push("any",...s));for(let u=1;u<c.length;u++)Qv(c[u])}function ku(c){if(!Array.isArray(c))return!1;if((r=c[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let s=1;s<c.length;s++)if(ku(c[s]))return!0;return!1}const M2=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ru(c,r){return c<r?-1:c>r?1:0}function m_(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let r=1;r<c.length;r++)if(m_(c[r]))return!0;return!1}function _h(c){if(!c)return!0;const r=c[0];return c.length<=1?r!=="any":r==="=="?Du(c[1],c[2],"=="):r==="!="?Xs(Du(c[1],c[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Du(c[1],c[2],r):r==="any"?(s=c.slice(1),["any"].concat(s.map(_h))):r==="all"?["all"].concat(c.slice(1).map(_h)):r==="none"?["all"].concat(c.slice(1).map(_h).map(Xs)):r==="in"?ex(c[1],c.slice(2)):r==="!in"?Xs(ex(c[1],c.slice(2))):r==="has"?tx(c[1]):r!=="!has"||Xs(tx(c[1]));var s}function Du(c,r,s){switch(c){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,c,r]}}function ex(c,r){if(r.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",c,["literal",r.sort(Ru)]]:["filter-in-small",c,["literal",r]]}}function tx(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Xs(c){return["!",c]}const yh="";function zo(c,r){return r?`${c}${yh}${r}`:c}const rx="-transition",P2=new Set(["fill","line","background","hillshade","raster"]);class No extends uu{constructor(r,s,u,m,h){if(super(),this.id=r.id,this.fqid=zo(this.id,u),this.type=r.type,this.scope=u,this.lut=m,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const g=ph(this.filter,Ke[`filter_${r.type}`]);g.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(r.slot&&(this.slot=r.slot),s.layout&&(this._unevaluatedLayout=new C2(s.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint){this._transitionablePaint=new Ec(s.paint,this.scope,h);for(const g in r.paint)this.setPaintProperty(g,r.paint[g]);for(const g in r.layout)this.setLayoutProperty(g,r.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Au(s.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D()&&P2.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,s){if(this.type==="custom"&&r==="visibility")return void(this.visibility=s);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,s),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),r==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return Yi(r,rx)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,s){const u=this._transitionablePaint,m=u._properties.properties;if(Yi(r,rx)){const C=r.slice(0,-11);return m[C]&&u.setTransition(C,s||void 0),!1}if(!m[r])return!1;const h=u._values[r],g=h.value.isDataDriven(),w=h.value;u.setValue(r,s),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(r);const E=u._values[r].value,I=E.isDataDriven(),x=Yi(r,"pattern")||r==="line-dasharray";return I||g||x||this._handleOverridablePaintPropertyUpdate(r,w,E)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,s,u){return null}_handleOverridablePaintPropertyUpdate(r,s,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){return ss({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof Pu&&Tu(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=Kv(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(r){}queryIntersectsFeature(r,s,u,m,h,g,w,E,I){}}const A2={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vh{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&(r.isTransferred=!0,s.add(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qr(c,r=1){let s=0,u=0;return{members:c.map(m=>{const h=A2[m.type].BYTES_PER_ELEMENT,g=s=xh(s,Math.max(r,h)),w=m.components||1;return u=Math.max(u,h),s+=h*w,{name:m.name,type:m.type,components:w,offset:g}}),size:xh(s,Math.max(u,r)),alignment:r}}function xh(c,r){return Math.ceil(c/r)*r}class Ha extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const m=2*r;return this.int16[m+0]=s,this.int16[m+1]=u,r}}Ha.prototype.bytesPerElement=4,qt(Ha,"StructArrayLayout2i4");class Lu extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,u)}emplace(r,s,u,m){const h=3*r;return this.int16[h+0]=s,this.int16[h+1]=u,this.int16[h+2]=m,r}}Lu.prototype.bytesPerElement=6,qt(Lu,"StructArrayLayout3i6");class Ou extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u,m)}emplace(r,s,u,m,h){const g=4*r;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=m,this.int16[g+3]=h,r}}Ou.prototype.bytesPerElement=8,qt(Ou,"StructArrayLayout4i8");class Cs extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,m,h)}emplace(r,s,u,m,h,g){const w=5*r;return this.int16[w+0]=s,this.int16[w+1]=u,this.int16[w+2]=m,this.int16[w+3]=h,this.int16[w+4]=g,r}}Cs.prototype.bytesPerElement=10,qt(Cs,"StructArrayLayout5i10");class g_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,u,m,h,g,w)}emplace(r,s,u,m,h,g,w,E){const I=6*r,x=12*r,C=3*r;return this.int16[I+0]=s,this.int16[I+1]=u,this.uint8[x+4]=m,this.uint8[x+5]=h,this.uint8[x+6]=g,this.uint8[x+7]=w,this.float32[C+2]=E,r}}g_.prototype.bytesPerElement=12,qt(g_,"StructArrayLayout2i4ub1f12");class qa extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u,m)}emplace(r,s,u,m,h){const g=4*r;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=m,this.float32[g+3]=h,r}}qa.prototype.bytesPerElement=16,qt(qa,"StructArrayLayout4f16");class Dl extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,u)}emplace(r,s,u,m){const h=3*r;return this.float32[h+0]=s,this.float32[h+1]=u,this.float32[h+2]=m,r}}Dl.prototype.bytesPerElement=12,qt(Dl,"StructArrayLayout3f12");class Ll extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,m,h)}emplace(r,s,u,m,h,g){const w=6*r,E=3*r;return this.uint16[w+0]=s,this.uint16[w+1]=u,this.uint16[w+2]=m,this.uint16[w+3]=h,this.float32[E+2]=g,r}}Ll.prototype.bytesPerElement=12,qt(Ll,"StructArrayLayout4ui1f12");class Ep extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u,m)}emplace(r,s,u,m,h){const g=4*r;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=m,this.uint16[g+3]=h,r}}Ep.prototype.bytesPerElement=8,qt(Ep,"StructArrayLayout4ui8");class Cp extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,r,s,u,m,h,g)}emplace(r,s,u,m,h,g,w){const E=6*r;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=m,this.int16[E+3]=h,this.int16[E+4]=g,this.int16[E+5]=w,r}}Cp.prototype.bytesPerElement=12,qt(Cp,"StructArrayLayout6i12");class __ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w,E,I,x,C,P){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,m,h,g,w,E,I,x,C,P)}emplace(r,s,u,m,h,g,w,E,I,x,C,P,T){const M=12*r;return this.int16[M+0]=s,this.int16[M+1]=u,this.int16[M+2]=m,this.int16[M+3]=h,this.uint16[M+4]=g,this.uint16[M+5]=w,this.uint16[M+6]=E,this.uint16[M+7]=I,this.int16[M+8]=x,this.int16[M+9]=C,this.int16[M+10]=P,this.int16[M+11]=T,r}}__.prototype.bytesPerElement=24,qt(__,"StructArrayLayout4i4ui4i24");class y_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,r,s,u,m,h,g)}emplace(r,s,u,m,h,g,w){const E=10*r,I=5*r;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=m,this.float32[I+2]=h,this.float32[I+3]=g,this.float32[I+4]=w,r}}y_.prototype.bytesPerElement=20,qt(y_,"StructArrayLayout3i3f20");class v_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}v_.prototype.bytesPerElement=4,qt(v_,"StructArrayLayout1ul4");class Ol extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const m=2*r;return this.uint16[m+0]=s,this.uint16[m+1]=u,r}}Ol.prototype.bytesPerElement=4,qt(Ol,"StructArrayLayout2ui4");class x_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w,E,I,x,C,P,T){const M=this.length;return this.resize(M+1),this.emplace(M,r,s,u,m,h,g,w,E,I,x,C,P,T)}emplace(r,s,u,m,h,g,w,E,I,x,C,P,T,M){const R=20*r,B=10*r;return this.int16[R+0]=s,this.int16[R+1]=u,this.int16[R+2]=m,this.int16[R+3]=h,this.int16[R+4]=g,this.float32[B+3]=w,this.float32[B+4]=E,this.float32[B+5]=I,this.float32[B+6]=x,this.int16[R+14]=C,this.uint32[B+8]=P,this.uint16[R+18]=T,this.uint16[R+19]=M,r}}x_.prototype.bytesPerElement=40,qt(x_,"StructArrayLayout5i4f1i1ul2ui40");class bh extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,u,m,h,g,w)}emplace(r,s,u,m,h,g,w,E){const I=8*r;return this.int16[I+0]=s,this.int16[I+1]=u,this.int16[I+2]=m,this.int16[I+4]=h,this.int16[I+5]=g,this.int16[I+6]=w,this.int16[I+7]=E,r}}bh.prototype.bytesPerElement=16,qt(bh,"StructArrayLayout3i2i2i16");class b_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,m,h)}emplace(r,s,u,m,h,g){const w=4*r,E=8*r;return this.float32[w+0]=s,this.float32[w+1]=u,this.float32[w+2]=m,this.int16[E+6]=h,this.int16[E+7]=g,r}}b_.prototype.bytesPerElement=16,qt(b_,"StructArrayLayout2f1f2i16");class w_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,r,s,u,m,h,g)}emplace(r,s,u,m,h,g,w){const E=20*r,I=5*r;return this.uint8[E+0]=s,this.uint8[E+1]=u,this.float32[I+1]=m,this.float32[I+2]=h,this.float32[I+3]=g,this.float32[I+4]=w,r}}w_.prototype.bytesPerElement=20,qt(w_,"StructArrayLayout2ub4f20");class no extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,u)}emplace(r,s,u,m){const h=3*r;return this.uint16[h+0]=s,this.uint16[h+1]=u,this.uint16[h+2]=m,r}}no.prototype.bytesPerElement=6,qt(no,"StructArrayLayout3ui6");class Mp extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B,U,W,Z,H,K){const re=this.length;return this.resize(re+1),this.emplace(re,r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B,U,W,Z,H,K)}emplace(r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B,U,W,Z,H,K,re){const se=30*r,ge=15*r,me=60*r;return this.int16[se+0]=s,this.int16[se+1]=u,this.int16[se+2]=m,this.float32[ge+2]=h,this.float32[ge+3]=g,this.uint16[se+8]=w,this.uint16[se+9]=E,this.uint32[ge+5]=I,this.uint32[ge+6]=x,this.uint32[ge+7]=C,this.uint16[se+16]=P,this.uint16[se+17]=T,this.uint16[se+18]=M,this.float32[ge+10]=R,this.float32[ge+11]=B,this.uint8[me+48]=U,this.uint8[me+49]=W,this.uint8[me+50]=Z,this.uint32[ge+13]=H,this.int16[se+28]=K,this.uint8[me+58]=re,r}}Mp.prototype.bytesPerElement=60,qt(Mp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Pp extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B,U,W,Z,H,K,re,se,ge,me,pe,Ee,ye,Pe,Le,Re,Ne){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B,U,W,Z,H,K,re,se,ge,me,pe,Ee,ye,Pe,Le,Re,Ne)}emplace(r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B,U,W,Z,H,K,re,se,ge,me,pe,Ee,ye,Pe,Le,Re,Ne,Ve){const We=20*r,Be=40*r,lt=80*r;return this.float32[We+0]=s,this.float32[We+1]=u,this.int16[Be+4]=m,this.int16[Be+5]=h,this.int16[Be+6]=g,this.int16[Be+7]=w,this.int16[Be+8]=E,this.int16[Be+9]=I,this.int16[Be+10]=x,this.int16[Be+11]=C,this.int16[Be+12]=P,this.uint16[Be+13]=T,this.uint16[Be+14]=M,this.uint16[Be+15]=R,this.uint16[Be+16]=B,this.uint16[Be+17]=U,this.uint16[Be+18]=W,this.uint16[Be+19]=Z,this.uint16[Be+20]=H,this.uint16[Be+21]=K,this.uint16[Be+22]=re,this.uint16[Be+23]=se,this.uint16[Be+24]=ge,this.uint16[Be+25]=me,this.uint16[Be+26]=pe,this.uint16[Be+27]=Ee,this.uint32[We+14]=ye,this.float32[We+15]=Pe,this.float32[We+16]=Le,this.float32[We+17]=Re,this.float32[We+18]=Ne,this.uint8[lt+76]=Ve,r}}Pp.prototype.bytesPerElement=80,qt(Pp,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ms extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}Ms.prototype.bytesPerElement=4,qt(Ms,"StructArrayLayout1f4");class zl extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,m,h)}emplace(r,s,u,m,h,g){const w=5*r;return this.float32[w+0]=s,this.float32[w+1]=u,this.float32[w+2]=m,this.float32[w+3]=h,this.float32[w+4]=g,r}}zl.prototype.bytesPerElement=20,qt(zl,"StructArrayLayout5f20");class S_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,u,m,h,g,w)}emplace(r,s,u,m,h,g,w,E){const I=7*r;return this.float32[I+0]=s,this.float32[I+1]=u,this.float32[I+2]=m,this.float32[I+3]=h,this.float32[I+4]=g,this.float32[I+5]=w,this.float32[I+6]=E,r}}S_.prototype.bytesPerElement=28,qt(S_,"StructArrayLayout7f28");class T_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w,E,I,x,C){const P=this.length;return this.resize(P+1),this.emplace(P,r,s,u,m,h,g,w,E,I,x,C)}emplace(r,s,u,m,h,g,w,E,I,x,C,P){const T=11*r;return this.float32[T+0]=s,this.float32[T+1]=u,this.float32[T+2]=m,this.float32[T+3]=h,this.float32[T+4]=g,this.float32[T+5]=w,this.float32[T+6]=E,this.float32[T+7]=I,this.float32[T+8]=x,this.float32[T+9]=C,this.float32[T+10]=P,r}}T_.prototype.bytesPerElement=44,qt(T_,"StructArrayLayout11f44");class E_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w,E,I){const x=this.length;return this.resize(x+1),this.emplace(x,r,s,u,m,h,g,w,E,I)}emplace(r,s,u,m,h,g,w,E,I,x){const C=9*r;return this.float32[C+0]=s,this.float32[C+1]=u,this.float32[C+2]=m,this.float32[C+3]=h,this.float32[C+4]=g,this.float32[C+5]=w,this.float32[C+6]=E,this.float32[C+7]=I,this.float32[C+8]=x,r}}E_.prototype.bytesPerElement=36,qt(E_,"StructArrayLayout9f36");class Wa extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const m=2*r;return this.float32[m+0]=s,this.float32[m+1]=u,r}}Wa.prototype.bytesPerElement=8,qt(Wa,"StructArrayLayout2f8");class Ap extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u,m)}emplace(r,s,u,m,h){const g=6*r;return this.uint32[3*r+0]=s,this.uint16[g+2]=u,this.uint16[g+3]=m,this.uint16[g+4]=h,r}}Ap.prototype.bytesPerElement=12,qt(Ap,"StructArrayLayout1ul3ui12");class C_ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}C_.prototype.bytesPerElement=2,qt(C_,"StructArrayLayout1ui2");class Ip extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B){const U=this.length;return this.resize(U+1),this.emplace(U,r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B)}emplace(r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B,U){const W=16*r;return this.float32[W+0]=s,this.float32[W+1]=u,this.float32[W+2]=m,this.float32[W+3]=h,this.float32[W+4]=g,this.float32[W+5]=w,this.float32[W+6]=E,this.float32[W+7]=I,this.float32[W+8]=x,this.float32[W+9]=C,this.float32[W+10]=P,this.float32[W+11]=T,this.float32[W+12]=M,this.float32[W+13]=R,this.float32[W+14]=B,this.float32[W+15]=U,r}}Ip.prototype.bytesPerElement=64,qt(Ip,"StructArrayLayout16f64");class kp extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,u,m,h,g,w)}emplace(r,s,u,m,h,g,w,E){const I=10*r,x=5*r;return this.uint16[I+0]=s,this.uint16[I+1]=u,this.uint16[I+2]=m,this.uint16[I+3]=h,this.float32[x+2]=g,this.float32[x+3]=w,this.float32[x+4]=E,r}}kp.prototype.bytesPerElement=20,qt(kp,"StructArrayLayout4ui3f20");class Rp extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.int16[1*r+0]=s,r}}Rp.prototype.bytesPerElement=2,qt(Rp,"StructArrayLayout1i2");class zu extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint8[1*r+0]=s,r}}zu.prototype.bytesPerElement=1,qt(zu,"StructArrayLayout1ub1");class nx extends vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}nx.prototype.size=40;class ix extends x_{get(r){return new nx(this,r)}}qt(ix,"CollisionBoxArray");class ox extends vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}ox.prototype.size=60;class sx extends Mp{get(r){return new ox(this,r)}}qt(sx,"PlacedSymbolArray");class ax extends vh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}ax.prototype.size=80;class wh extends Pp{get(r){return new ax(this,r)}}qt(wh,"SymbolInstanceArray");class Sh extends Ms{getoffsetX(r){return this.float32[1*r+0]}}qt(Sh,"GlyphOffsetArray");class Ko extends Ha{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}qt(Ko,"SymbolLineVertexArray");class Th extends vh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Th.prototype.size=12;class lx extends Ap{get(r){return new Th(this,r)}}qt(lx,"FeatureIndexArray");class cx extends Ol{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}qt(cx,"FillExtrusionCentroidArray");class ux extends vh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ux.prototype.size=6;class dx extends Lu{get(r){return new ux(this,r)}}qt(dx,"FillExtrusionWallArray");const M_=Qr([{name:"a_pos",components:2,type:"Int16"}],4),I2=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ri{constructor(r=[]){this.segments=r}_prepareSegment(r,s,u,m){let h=this.segments[this.segments.length-1];return r>ri.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${ri.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!h||h.vertexLength+r>ri.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==m)&&(h={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},m!==void 0&&(h.sortKey=m),this.segments.push(h)),h}prepareSegment(r,s,u,m){return this._prepareSegment(r,s.length,u.length,m)}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,u,m){return new ri([{vertexOffset:r,primitiveOffset:s,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function hx(c,r){return 256*(c=Ot(Math.floor(c),0,255))+Ot(Math.floor(r),0,255)}ri.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt(ri,"SegmentVector");const k2=Qr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),P_=Qr([{name:"a_dash",components:4,type:"Uint16"}]);class Eh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,s,u,m){this.ids.push(A_(r)),this.positions.push(s,u,m)}eachPosition(r,s){const u=A_(r);let m=0,h=this.ids.length-1;for(;m<h;){const g=m+h>>1;this.ids[g]>=u?h=g:m=g+1}for(;this.ids[m]===u;)s(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(r,s){const u=new Float64Array(r.ids),m=new Uint32Array(r.positions);return Dp(u,m,0,u.length-1),s&&(s.add(u.buffer),s.add(m.buffer)),{ids:u,positions:m}}static deserialize(r){const s=new Eh;let u;s.ids=r.ids,s.positions=r.positions;for(const m of s.ids)m!==u&&s.uniqueIds.push(m),u=m;return s.indexed=!0,s}}function A_(c){const r=+c;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:Kd(String(c))}function Dp(c,r,s,u){for(;s<u;){const m=c[s+u>>1];let h=s-1,g=u+1;for(;;){do h++;while(c[h]<m);do g--;while(c[g]>m);if(h>=g)break;Lp(c,h,g),Lp(r,3*h,3*g),Lp(r,3*h+1,3*g+1),Lp(r,3*h+2,3*g+2)}g-s<u-g?(Dp(c,r,s,g),s=g+1):(Dp(c,r,g+1,u),u=g)}}function Lp(c,r,s){const u=c[r];c[r]=c[s],c[s]=u}qt(Eh,"FeaturePositionMap");class Ks{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,s),this.initialized=!0),!!this.location}set(r,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Cc extends Ks{constructor(r){super(r),this.current=0}set(r,s,u){this.fetchUniformLocation(r,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class li extends Ks{constructor(r){super(r),this.current=0}set(r,s,u){this.fetchUniformLocation(r,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class ya extends Ks{constructor(r){super(r),this.current=[0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Op extends Ks{constructor(r){super(r),this.current=[0,0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class zp extends Ks{constructor(r){super(r),this.current=[0,0,0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Np extends Ks{constructor(r){super(r),this.current=Xr.transparent.toRenderColor(null)}set(r,s,u){this.fetchUniformLocation(r,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const R2=new Float32Array(16);class Ch extends Ks{constructor(r){super(r),this.current=R2}set(r,s,u){if(this.fetchUniformLocation(r,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let m=1;m<16;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const D2=new Float32Array(9),L2=new Float32Array(4);class Fp extends Ks{constructor(r){super(r),this.current=L2}set(r,s,u){if(this.fetchUniformLocation(r,s)){for(let m=0;m<4;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function I_(c){return[hx(255*c.r,255*c.g),hx(255*c.b,255*c.a)]}class Nu{constructor(r,s,u,m){this.value=r,this.uniformNames=s.map(h=>`u_${h}`),this.type=u,this.context=m}setUniform(r,s,u,m,h){const g=m.constantOr(this.value);s.set(r,h,g instanceof Xr?g.toRenderColor(this.ignoreLut?null:this.context.lut):g)}getBinding(r,s){return this.type==="color"?new Np(r):new li(r)}}class Fu{constructor(r,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,s,u,m,h){const g=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;g&&s.set(r,h,g)}getBinding(r,s){return s==="u_pattern"||s==="u_dash"?new zp(r):new li(r)}}class Za{constructor(r,s,u,m){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(h=>({name:`a_${h}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(r,s,u,m,h,g,w){const E=this.paintVertexArray.length,I=this.expression.evaluate(new Gn(0,{brightness:g}),s,{},h,m,w);this.paintVertexArray.resize(r),this._setPaintValue(E,r,I,this.context)}updatePaintArray(r,s,u,m,h,g,w){const E=this.expression.evaluate({zoom:0,brightness:w},u,m,void 0,h);this._setPaintValue(r,s,E,this.context)}_setPaintValue(r,s,u,m){if(this.type==="color"){const h=I_(u.toRenderColor(this.ignoreLut?null:m.lut));for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=r;h<s;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Js{constructor(r,s,u,m,h,g){this.expression=r,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=m,this.context=h,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,s,u,m,h,g,w){const E=this.expression.evaluate(new Gn(this.context.zoom,{brightness:g}),s,{},h,m,w),I=this.expression.evaluate(new Gn(this.context.zoom+1,{brightness:g}),s,{},h,m,w),x=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(x,r,E,I,this.context)}updatePaintArray(r,s,u,m,h,g,w){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:w},u,m,void 0,h),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},u,m,void 0,h);this._setPaintValue(r,s,E,I,this.context)}_setPaintValue(r,s,u,m,h){if(this.type==="color"){const g=I_(u.toRenderColor(this.ignoreLut?null:h.lut)),w=I_(u.toRenderColor(this.ignoreLut?null:h.lut));for(let E=r;E<s;E++)this.paintVertexArray.emplace(E,g[0],g[1],w[0],w[1])}else{for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s,u,m,h){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,w=Ot(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);s.set(r,h,w)}getBinding(r,s){return new li(r)}}class Nl{constructor(r,s,u,m,h){this.expression=r,this.layerId=h,this.paintVertexAttributes=(u==="array"?P_:k2).members;for(let g=0;g<s.length;++g);this.paintVertexArray=new m}populatePaintArray(r,s,u,m){const h=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(h,r,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(r,s,u,m,h,g,w){this._setPaintValues(r,s,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(r,s,u,m){if(!m||!u)return;const h=m[u];if(!h)return;const{tl:g,br:w,pixelRatio:E}=h;for(let I=r;I<s;I++)this.paintVertexArray.emplace(I,g[0],g[1],w[0],w[1],E)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mc{constructor(r,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;const m=[];for(const h in r.paint._values){const g=r.paint.get(h),w=r.paint.get(`${h}-use-theme`);if(h.endsWith("-use-theme")||!u(h)||!(g instanceof Pu&&Tu(g.property.specification)))continue;const E=O2(h,r.type),I=g.value,x=g.property.specification.type,C=!!g.property.useIntegerZoom,P=h==="line-dasharray"||h.endsWith("pattern"),T=h==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(I.kind!=="constant"||T)if(I.kind==="source"||T||P){const M=fx(h,x,"source");this.binders[h]=P?new Nl(I,E,x,M,r.id):new Za(I,E,x,M),m.push(`/a_${h}`)}else{const M=fx(h,x,"composite");this.binders[h]=new Js(I,E,x,C,s,M),m.push(`/z_${h}`)}else this.binders[h]=P?new Fu(I.value,E):new Nu(I.value,E,x,s),m.push(`/u_${h}`);w&&(this.binders[h].ignoreLut=w.constantOr("default")==="none",this.binders[h].checkUseTheme=!0)}this.cacheKey=m.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof Za||s instanceof Js?s.maxValue:0}populatePaintArrays(r,s,u,m,h,g,w){for(const E in this.binders){const I=this.binders[E];I.context=this.context,(I instanceof Za||I instanceof Js||I instanceof Nl)&&I.populatePaintArray(r,s,u,m,h,g,w)}}setConstantPatternPositions(r){for(const s in this.binders){const u=this.binders[s];u instanceof Fu&&u.setConstantPatternPositions(r)}}updatePaintArrays(r,s,u,m,h,g,w,E,I){let x=!1;const C=Object.keys(r),P=C.length!==0&&!E,T=P?C:s.uniqueIds;this.context.lut=h.lut;for(const M in this.binders){const R=this.binders[M];if(R.context=this.context,(R instanceof Za||R instanceof Js||R instanceof Nl)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const B=h.paint.get(M);R.expression=B.value;for(const U of T){const W=r[U.toString()];s.eachPosition(U,(Z,H,K)=>{const re=m.feature(Z);R.updatePaintArray(H,K,re,W,g,w,I)})}if(!P)for(const U of u.uniqueIds){const W=r[U.toString()];u.eachPosition(U,(Z,H,K)=>{const re=m.feature(Z);R.updatePaintArray(H,K,re,W,g,w,I)})}x=!0}}return x}defines(){const r=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Nu||u instanceof Fu)&&r.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return r}getBinderAttributes(){const r=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Za||u instanceof Js||u instanceof Nl)for(let m=0;m<u.paintVertexAttributes.length;m++)r.push(u.paintVertexAttributes[m].name)}return r}getBinderUniforms(){const r=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Nu||u instanceof Fu||u instanceof Js)for(const m of u.uniformNames)r.push(m)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const s=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Nu||m instanceof Fu||m instanceof Js)for(const h of m.uniformNames)s.push({name:h,property:u,binding:m.getBinding(r,h)})}return s}setUniforms(r,s,u,m,h){for(const{name:g,property:w,binding:E}of u){if(this.binders[w].checkUseTheme&&this.binders[w]instanceof Nu){const I=m.get(`${w}-use-theme`);I.isConstant()&&(this.binders[w].ignoreLut=I.constantOr("default")==="none")}this.binders[w].setUniform(r,E,h,m.get(w),g)}}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Za||s instanceof Js||s instanceof Nl)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(r){for(const s in this.binders){const u=this.binders[s];(u instanceof Za||u instanceof Js||u instanceof Nl)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof Za||s instanceof Js||s instanceof Nl)&&s.destroy()}}}class Fl{constructor(r,s,u=()=>!0){this.programConfigurations={};for(const m of r)this.programConfigurations[m.id]=new Mc(m,s,u);this.needsUpload=!1,this._featureMap=new Eh,this._featureMapWithoutIds=new Eh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,s,u,m,h,g,w,E){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(r,s,m,h,g,w,E);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,u,m,h,g,w){for(const E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,s,E,m,h,g,w||0)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const jp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function O2(c,r){return jp[c]||[c.replace(`${r}-`,"").replace(/-/g,"_")]}const z2={"line-pattern":{source:Ll,composite:Ll},"fill-pattern":{source:Ll,composite:Ll},"fill-extrusion-pattern":{source:Ll,composite:Ll},"line-dasharray":{source:Ep,composite:Ep}},Bp={color:{source:Wa,composite:qa},number:{source:Ms,composite:Wa}};function fx(c,r,s){const u=z2[c];return u&&u[s]||Bp[r][s]}qt(Nu,"ConstantBinder"),qt(Fu,"PatternConstantBinder"),qt(Za,"SourceExpressionBinder"),qt(Nl,"PatternCompositeBinder"),qt(Js,"CompositeExpressionBinder"),qt(Mc,"ProgramConfiguration",{omit:["_buffers"]}),qt(Fl,"ProgramConfigurationSet");const fo=Lt/Math.PI/2,k_=5,R_=6,px=16383,Pc=64,D_=[Pc,32,16],Ps=-fo,As=fo;function Ac(c,r,s,u=fo){return s=je(s),[c*Math.sin(s)*u,-r*u,c*Math.cos(s)*u]}function Ic(c,r,s){return Ac(Math.cos(je(c)),Math.sin(je(c)),r,s)}const ju=63710088e-1,L_=2*Math.PI*ju;class Kr{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Kr($n(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,u=this.lat*s,m=r.lat*s,h=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((r.lng-this.lng)*s);return ju*Math.acos(Math.min(h,1))}toBounds(r=0){const s=360*r/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new jl({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(r){return Ic(this.lat,this.lng,fo+r*fo/ju)}static convert(r){if(r instanceof Kr)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Kr(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Kr(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class jl{constructor(r,s){if(r)if(s)this.setSouthWest(r).setNorthEast(s);else if(r.length===4){const u=r;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=r;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(r){return this._ne=r instanceof Kr?new Kr(r.lng,r.lat):Kr.convert(r),this}setSouthWest(r){return this._sw=r instanceof Kr?new Kr(r.lng,r.lat):Kr.convert(r),this}extend(r){const s=this._sw,u=this._ne;let m,h;if(r instanceof Kr)m=r,h=r;else{if(!(r instanceof jl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(jl.convert(r)):this.extend(Kr.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Kr.convert(r)):this;if(m=r._sw,h=r._ne,!m||!h)return this}return s||u?(s.lng=Math.min(m.lng,s.lng),s.lat=Math.min(m.lat,s.lat),u.lng=Math.max(h.lng,u.lng),u.lat=Math.max(h.lat,u.lat)):(this._sw=new Kr(m.lng,m.lat),this._ne=new Kr(h.lng,h.lat)),this}getCenter(){return new Kr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Kr(this.getWest(),this.getNorth())}getSouthEast(){return new Kr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:s,lat:u}=Kr.convert(r);let m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(r){if(r)return r instanceof jl?r:new jl(r)}}const mx=0,O_=25.5;function Mh(c){return L_*Math.cos(c*Math.PI/180)}function Bl(c){return(180+c)/360}function Ya(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Co(c,r){return c/Mh(r)}function Jo(c){return 360*c-180}function Ki(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function z_(c,r){return c*Mh(Ki(r))}const ui=85.051129;function f(c){return Math.cos(je(Ot(c,-ui,ui)))}function n(c,r){const s=Ot(r,mx,O_),u=Math.pow(2,s);return f(c)*L_/(512*u)}function l(c){return 1/Math.cos(c*Math.PI/180)}function p(c,r=0){const s=Math.exp(Math.PI*(1-(c.y+r/Lt)/(1<<c.z)*2));return 80150034*s/(s*s+1)/Lt/(1<<c.z)}class y{constructor(r,s,u=0){this.x=+r,this.y=+s,this.z=+u}static fromLngLat(r,s=0){const u=Kr.convert(r);return new y(Bl(u.lng),Ya(u.lat),Co(s,u.lat))}toLngLat(){return new Kr(Jo(this.x),Ki(this.y))}toAltitude(){return z_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/L_*l(Ki(this.y))}}function v(c,r,s,u,m,h,g,w,E){const I=(r+u)/2,x=(s+m)/2,C=new vt(I,x);w(C),function(P,T,M,R,B,U){const W=M-B,Z=R-U;return Math.abs((R-T)*W-(M-P)*Z)/Math.hypot(W,Z)}(C.x,C.y,h.x,h.y,g.x,g.y)>=E?(v(c,r,s,I,x,h,C,w,E),v(c,I,x,u,m,C,g,w,E)):c.push(g)}function S(c,r,s){let u=c[0],m=u.x,h=u.y;r(u);const g=[u];for(let w=1;w<c.length;w++){const E=c[w],{x:I,y:x}=E;r(E),v(g,m,h,I,x,u,E,r,s),m=I,h=x,u=E}return g}function A(c,r,s,u){if(u(r,s)){const m=r.add(s)._mult(.5);A(c,r,m,u),A(c,m,s,u)}else c.push(s)}function D(c,r){let s=c[0];const u=[s];for(let m=1;m<c.length;m++){const h=c[m];A(u,s,h,r),s=h}return u}const N=Math.pow(2,14)-1,j=-N-1;function $(c,r){const s=Math.round(c.x*r),u=Math.round(c.y*r);return c.x=Ot(s,j,N),c.y=Ot(u,j,N),(s<c.x||s>c.x+1||u<c.y||u>c.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function V(c,r,s){const u=c.loadGeometry(),m=c.extent,h=Lt/m;if(r&&s&&s.projection.isReprojectedInTileSpace){const g=1<<r.z,{scale:w,x:E,y:I,projection:x}=s,C=P=>{const T=Jo((r.x+P.x/m)/g),M=Ki((r.y+P.y/m)/g),R=x.project(T,M);P.x=(R.x*w-E)*m,P.y=(R.y*w-I)*m};for(let P=0;P<u.length;P++)if(c.type!==1)u[P]=S(u[P],C,1);else{const T=[];for(const M of u[P])M.x<0||M.x>=m||M.y<0||M.y>=m||(C(M),T.push(M));u[P]=T}}for(const g of u)for(const w of g)$(w,h);return u}function q(c,r){return{type:c.type,id:c.id,properties:c.properties,geometry:r?V(c):[]}}function ie(c,r,s,u,m){c.emplaceBack(2*r+(u+1)/2,2*s+(m+1)/2)}function ne(c,r,s){c.emplaceBack(r.x,r.y,r.z,s[0]*16384,s[1]*16384,s[2]*16384)}class le{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Ha,this.indexArray=new no,this.segments=new ri,this.programConfigurations=new Fl(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(r,s){}populate(r,s,u,m){const h=this.layers[0],g=[];let w=null;h.type==="circle"&&(w=h.layout.get("circle-sort-key"));for(const{feature:I,id:x,index:C,sourceLayerIndex:P}of r){const T=this.layers[0]._featureFilter.needGeometry,M=q(I,T);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),M,u))continue;const R=w?w.evaluate(M,{},u):void 0,B={id:x,properties:I.properties,type:I.type,sourceLayerIndex:P,index:C,geometry:T?M.geometry:V(I,u,m),patterns:{},sortKey:R};g.push(B)}w&&g.sort((I,x)=>I.sortKey-x.sortKey);let E=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new Cp,E=m.projection);for(const I of g){const{geometry:x,index:C,sourceLayerIndex:P}=I,T=r[C].feature;this.addFeature(I,x,C,s.availableImages,u,E,s.brightness),s.featureIndex.insert(T,x,C,P,this.index)}}update(r,s,u,m,h,g,w){this.programConfigurations.updatePaintArrays(r,s,h,u,m,g,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,M_.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,I2.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,s,u,m,h,g,w){for(const E of s)for(const I of E){const x=I.x,C=I.y;if(x<0||x>=Lt||C<0||C>=Lt)continue;if(g){const M=g.projectTilePoint(x,C,h),R=g.upVector(h,x,C),B=this.globeExtVertexArray;ne(B,M,R),ne(B,M,R),ne(B,M,R),ne(B,M,R)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),T=P.vertexLength;ie(this.layoutVertexArray,x,C,-1,-1),ie(this.layoutVertexArray,x,C,1,-1),ie(this.layoutVertexArray,x,C,1,1),ie(this.layoutVertexArray,x,C,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},m,h,w)}}function ce(c,r){for(let s=0;s<c.length;s++)if(ze(r,c[s]))return!0;for(let s=0;s<r.length;s++)if(ze(c,r[s]))return!0;return!!Te(c,r)}function fe(c,r,s){return!!ze(c,r)||!!Se(r,c,s)}function ve(c,r){if(c.length===1)return ke(r,c[0]);for(let s=0;s<r.length;s++){const u=r[s];for(let m=0;m<u.length;m++)if(ze(c,u[m]))return!0}for(let s=0;s<c.length;s++)if(ke(r,c[s]))return!0;for(let s=0;s<r.length;s++)if(Te(c,r[s]))return!0;return!1}function _e(c,r,s){if(c.length>1){if(Te(c,r))return!0;for(let u=0;u<r.length;u++)if(Se(r[u],c,s))return!0}for(let u=0;u<c.length;u++)if(Se(c[u],r,s))return!0;return!1}function Te(c,r){if(c.length===0||r.length===0)return!1;for(let s=0;s<c.length-1;s++){const u=c[s],m=c[s+1];for(let h=0;h<r.length-1;h++)if(we(u,m,r[h],r[h+1]))return!0}return!1}function we(c,r,s,u){return un(c,s,u)!==un(r,s,u)&&un(c,r,s)!==un(c,r,u)}function Se(c,r,s){const u=s*s;if(r.length===1)return c.distSqr(r[0])<u;for(let m=1;m<r.length;m++)if(be(c,r[m-1],r[m])<u)return!0;return!1}function be(c,r,s){const u=r.distSqr(s);if(u===0)return c.distSqr(r);const m=((c.x-r.x)*(s.x-r.x)+(c.y-r.y)*(s.y-r.y))/u;return c.distSqr(m<0?r:m>1?s:s.sub(r)._mult(m)._add(r))}function ke(c,r){let s,u,m,h=!1;for(let g=0;g<c.length;g++){s=c[g];for(let w=0,E=s.length-1;w<s.length;E=w++)u=s[w],m=s[E],u.y>r.y!=m.y>r.y&&r.x<(m.x-u.x)*(r.y-u.y)/(m.y-u.y)+u.x&&(h=!h)}return h}function ze(c,r){let s=!1;for(let u=0,m=c.length-1;u<c.length;m=u++){const h=c[u],g=c[m];h.y>r.y!=g.y>r.y&&r.x<(g.x-h.x)*(r.y-h.y)/(g.y-h.y)+h.x&&(s=!s)}return s}function tt(c,r,s,u,m){for(const g of c)if(r<=g.x&&s<=g.y&&u>=g.x&&m>=g.y)return!0;const h=[new vt(r,s),new vt(r,m),new vt(u,m),new vt(u,s)];if(c.length>2){for(const g of h)if(ze(c,g))return!0}for(let g=0;g<c.length-1;g++)if(Xe(c[g],c[g+1],h))return!0;return!1}function Xe(c,r,s){const u=s[0],m=s[2];if(c.x<u.x&&r.x<u.x||c.x>m.x&&r.x>m.x||c.y<u.y&&r.y<u.y||c.y>m.y&&r.y>m.y)return!1;const h=un(c,r,s[0]);return h!==un(c,r,s[1])||h!==un(c,r,s[2])||h!==un(c,r,s[3])}function Oe(c,r,s,u,m,h){let g=r.y-c.y,w=c.x-r.x;if(h=h||0){const E=g*g+w*w;if(E===0)return!0;const I=Math.sqrt(E);g/=I,w/=I}return!((s.x-c.x)*g+(s.y-c.y)*w-h<0||(u.x-c.x)*g+(u.y-c.y)*w-h<0||(m.x-c.x)*g+(m.y-c.y)*w-h<0)}function $e(c,r,s,u,m,h,g){return!(Oe(c,r,u,m,h,g)||Oe(r,s,u,m,h,g)||Oe(s,c,u,m,h,g)||Oe(u,m,c,r,s,g)||Oe(m,h,c,r,s,g)||Oe(h,u,c,r,s,g))}function ht(c,r,s){const u=r.paint.get(c).value;return u.kind==="constant"?u.value:s.programConfigurations.get(r.id).getMaxValue(c)}function xt(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Pt(c,r,s,u,m){if(!r[0]&&!r[1])return c;const h=vt.convert(r)._mult(m);s==="viewport"&&h._rotate(-u);const g=[];for(let w=0;w<c.length;w++)g.push(c[w].sub(h));return g}function Ye(c,r,s,u){const m=vt.convert(c)._mult(u);return r==="viewport"&&m._rotate(-s),m}let mt,ot;qt(le,"CircleBucket",{omit:["layers"]});var Tt,gt={exports:{}},ft=(Tt||(Tt=1,function(c,r){(function(s){function u(h,g,w){var E=m(256*h,256*(g=Math.pow(2,w)-g-1),w),I=m(256*(h+1),256*(g+1),w);return E[0]+","+E[1]+","+I[0]+","+I[1]}function m(h,g,w){var E=2*Math.PI*6378137/256/Math.pow(2,w);return[h*E-2*Math.PI*6378137/2,g*E-2*Math.PI*6378137/2]}s.getURL=function(h,g,w,E,I,x){return x=x||{},h+"?"+["bbox="+u(w,E,I),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+g].join("&")},s.getTileBBox=u,s.getMercCoords=m,Object.defineProperty(s,"__esModule",{value:!0})})(r)}(0,gt.exports)),gt.exports);class zt{constructor(r,s,u){this.z=r,this.x=s,this.y=u,this.key=$t(0,r,r,s,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,s){const u=ft.getTileBBox(this.x,this.y,this.z),m=function(h,g,w){let E,I="";for(let x=h;x>0;x--)E=1<<x-1,I+=(g&E?1:0)+(w&E?2:0);return I}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ft{constructor(r,s){this.wrap=r,this.canonical=s,this.key=$t(r,s.z,s.z,s.x,s.y)}}class Dt{constructor(r,s,u,m,h){this.overscaledZ=r,this.wrap=s,this.canonical=new zt(u,+m,+h),this.key=s===0&&r===u?this.canonical.key:$t(s,r,u,m,h)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const s=this.canonical.z-r;return r>this.canonical.z?new Dt(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dt(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s=!0){if(this.overscaledZ===r&&s)return this.key;if(r>this.canonical.z)return $t(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return $t(this.wrap*+s,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new Dt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Dt(s,this.wrap,s,u,m),new Dt(s,this.wrap,s,u+1,m),new Dt(s,this.wrap,s,u,m+1),new Dt(s,this.wrap,s,u+1,m+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Dt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Dt(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ft(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $t(c,r,s,u,m){const h=1<<Math.min(s,22);let g=h*(m%h)+u%h;return c&&s<22&&(g+=h*h*((c<0?-2*c-1:2*c)%(1<<2*(22-s)))),16*(32*g+s)+(r-s)}const vr=[c=>{let r=c.canonical.x-1,s=c.wrap;return r<0&&(r=(1<<c.canonical.z)-1,s--),new Dt(c.overscaledZ,s,c.canonical.z,r,c.canonical.y)},c=>{let r=c.canonical.x+1,s=c.wrap;return r===1<<c.canonical.z&&(r=0,s++),new Dt(c.overscaledZ,s,c.canonical.z,r,c.canonical.y)},c=>new Dt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new Dt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];qt(zt,"CanonicalTileID"),qt(Dt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const lr=Qr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ar}=lr,xr=Qr([{name:"a_pos_3",components:3,type:"Int16"}]);var $r=Qr([{name:"a_pos",type:"Int16",components:2}]);class Rr{constructor(r,s){this.pos=r,this.dir=s}intersectsPlane(r,s,u){const m=Me.vec3.dot(s,this.dir);if(Math.abs(m)<1e-6)return!1;const h=((r[0]-this.pos[0])*s[0]+(r[1]-this.pos[1])*s[1]+(r[2]-this.pos[2])*s[2])/m;return u[0]=this.pos[0]+this.dir[0]*h,u[1]=this.pos[1]+this.dir[1]*h,u[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(r,s,u){if(Me.vec3.equals(this.pos,r)||s===0)return u[0]=u[1]=u[2]=0,!1;const[m,h,g]=this.dir,w=this.pos[0]-r[0],E=this.pos[1]-r[1],I=this.pos[2]-r[2],x=m*m+h*h+g*g,C=2*(w*m+E*h+I*g),P=C*C-4*x*(w*w+E*E+I*I-s*s);if(P<0){const T=Math.max(-C/2,0),M=w+m*T,R=E+h*T,B=I+g*T,U=Math.hypot(M,R,B);return u[0]=M*s/U,u[1]=R*s/U,u[2]=B*s/U,!1}{const T=(-C-Math.sqrt(P))/(2*x);if(T<0){const M=Math.hypot(w,E,I);return u[0]=w*s/M,u[1]=E*s/M,u[2]=I*s/M,!1}return u[0]=w+m*T,u[1]=E+h*T,u[2]=I+g*T,!0}}}class Bn{constructor(r,s,u,m,h){this.TL=r,this.TR=s,this.BR=u,this.BL=m,this.horizon=h}static fromInvProjectionMatrix(r,s,u){const m=[-1,1,1],h=[1,1,1],g=[1,-1,1],w=[-1,-1,1],E=Me.vec3.transformMat4(m,m,r),I=Me.vec3.transformMat4(h,h,r),x=Me.vec3.transformMat4(g,g,r),C=Me.vec3.transformMat4(w,w,r);return new Bn(E,I,x,C,s/u)}}function Pn(c,r,s){let u=1/0,m=-1/0;const h=[];for(const g of c){Me.vec3.sub(h,g,r);const w=Me.vec3.dot(h,s);u=Math.min(u,w),m=Math.max(m,w)}return[u,m]}function an(c,r){let s=!0;for(let u=0;u<c.planes.length;u++){const m=c.planes[u];let h=0;for(let g=0;g<r.length;g++)h+=Me.vec3.dot(m,r[g])+m[3]>=0;if(h===0)return 0;h!==r.length&&(s=!1)}return s?2:1}function yn(c,r){for(const s of c.projections){const u=Pn(r,c.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function Dr(c,r){let s=0;const u=[0,0,0,0];for(let m=0;m<c.length;m++)u[0]=c[m][0],u[1]=c[m][1],u[2]=c[m][2],u[3]=1,Me.vec4.dot(u,r)>=0&&s++;return s}class Gr{constructor(r,s){this.points=r||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=hr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Me.vec3.sub([],this.points[2],this.points[3]),Me.vec3.sub([],this.points[0],this.points[3]),Me.vec3.sub([],this.points[4],this.points[0]),Me.vec3.sub([],this.points[5],this.points[1]),Me.vec3.sub([],this.points[6],this.points[2]),Me.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const m=[0,-u[2],u[1]],h=[u[2],0,-u[0]];this.projections.push({axis:m,projection:Pn(this.points,this.points[0],m)}),this.projections.push({axis:h,projection:Pn(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(r,s,u,m){const h=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const x=Me.vec4.transformMat4([],I,r),C=1/x[3]/s*h;return Me.vec4.mul(x,x,[C,C,m?1/x[3]:C,C])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const x=Me.vec3.sub([],g[I[0]],g[I[1]]),C=Me.vec3.sub([],g[I[2]],g[I[1]]),P=Me.vec3.normalize([],Me.vec3.cross([],x,C)),T=-Me.vec3.dot(P,g[I[1]]);return P.concat(T)}),E=[];for(let I=0;I<g.length;I++)E.push([g[I][0],g[I][1],g[I][2]]);return new Gr(E,w)}intersectsPrecise(r,s,u){for(let m=0;m<s.length;m++)if(!Dr(r,s[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!Dr(r,this.planes[m]))return 0;for(const m of u)for(const h of this.frustumEdges){const g=Me.vec3.cross([],m,h),w=Me.vec3.length(g);if(w===0)continue;Me.vec3.scale(g,g,1/w);const E=Pn(this.points,this.points[0],g),I=Pn(r,this.points[0],g);if(E[0]>I[1]||I[0]>E[1])return 0}return 1}containsPoint(r){for(const s of this.planes){const u=s[3];if(Me.vec3.dot([s[0],s[1],s[2]],r)+u<0)return!1}return!0}}class hr{static fromPoints(r){const s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const m of r)Me.vec3.min(s,s,m),Me.vec3.max(u,u,m);return new hr(s,u)}static fromTileIdAndHeight(r,s,u){const m=1<<r.canonical.z,h=r.canonical.x,g=r.canonical.y;return new hr([h/m,g/m,s],[(h+1)/m,(g+1)/m,u])}static applyTransform(r,s){const u=r.getCorners();for(let m=0;m<u.length;++m)Me.vec3.transformMat4(u[m],u[m],s);return hr.fromPoints(u)}static applyTransformFast(r,s){const u=[s[12],s[13],s[14]],m=[...u];for(let h=0;h<3;h++)for(let g=0;g<3;g++){const w=s[4*g+h],E=w*r.min[g],I=w*r.max[g];u[h]+=Math.min(E,I),m[h]+=Math.max(E,I)}return new hr(u,m)}static projectAabbCorners(r,s){const u=r.getCorners();for(let m=0;m<u.length;++m)Me.vec3.transformMat4(u[m],u[m],s);return u}constructor(r,s){this.min=r,this.max=s,this.center=Me.vec3.scale([],Me.vec3.add([],this.min,this.max),.5)}quadrant(r){const s=[r%2==0,r<2],u=Me.vec3.clone(this.min),m=Me.vec3.clone(this.max);for(let h=0;h<s.length;h++)u[h]=s[h]?this.min[h]:this.center[h],m[h]=s[h]?this.center[h]:this.max[h];return m[2]=this.max[2],new hr(u,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,s=this.max;return[[r[0],r[1],r[2]],[s[0],r[1],r[2]],[s[0],s[1],r[2]],[r[0],s[1],r[2]],[r[0],r[1],s[2]],[s[0],r[1],s[2]],[s[0],s[1],s[2]],[r[0],s[1],s[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?an(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?an(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,s){return s||this.intersects(r)?yn(r,this.getCorners()):0}intersectsPreciseFlat(r,s){return s||this.intersectsFlat(r)?yn(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let s=0;s<3;++s)if(this.min[s]>r.max[s]||r.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],r.min[s]),this.max[s]=Math.max(this.max[s],r.max[s])}encapsulatePoint(r){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],r[s]),this.max[s]=Math.max(this.max[s],r[s])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}function en(c){return c*fo/ju}qt(hr,"Aabb");const Kn=[new hr([Ps,Ps,Ps],[As,As,As]),new hr([Ps,Ps,Ps],[0,0,As]),new hr([0,Ps,Ps],[As,0,As]),new hr([Ps,0,Ps],[0,As,As]),new hr([0,0,Ps],[As,As,As])];function Gi(c,r,s,u=!0){const m=Me.vec3.scale([],c._camera.position,c.worldSize),h=[r,s,1,1];Me.vec4.transformMat4(h,h,c.pixelMatrixInverse),Me.vec4.scale(h,h,1/h[3]);const g=Me.vec3.sub([],h,m),w=Me.vec3.normalize([],g),E=c.globeMatrix,I=[E[12],E[13],E[14]],x=Me.vec3.sub([],I,m),C=Me.vec3.length(x),P=Me.vec3.normalize([],x),T=c.worldSize/(2*Math.PI),M=Me.vec3.dot(P,w),R=Math.asin(T/C);if(R<Math.acos(M)){if(!u)return null;const Ee=[],ye=[];Me.vec3.scale(Ee,w,C/M),Me.vec3.normalize(ye,Me.vec3.sub(ye,Ee,x)),Me.vec3.normalize(w,Me.vec3.add(w,x,Me.vec3.scale(w,ye,Math.tan(R)*C)))}const B=[];new Rr(m,w).closestPointOnSphere(I,T,B);const U=Me.vec3.normalize([],Pi(E,0)),W=Me.vec3.normalize([],Pi(E,1)),Z=Me.vec3.normalize([],Pi(E,2)),H=Me.vec3.dot(U,B),K=Me.vec3.dot(W,B),re=Me.vec3.dot(Z,B),se=dt(Math.asin(-K/T));let ge=dt(Math.atan2(H,re));ge=c.center.lng+function(Ee,ye){const Pe=(ye-Ee+180)%360-180;return Pe<-180?Pe+360:Pe}(c.center.lng,ge);const me=Bl(ge),pe=Ot(Ya(se),0,1);return new y(me,pe)}class Qo{constructor(r,s,u){this.a=Me.vec3.sub([],r,u),this.b=Me.vec3.sub([],s,u),this.center=u;const m=Me.vec3.normalize([],this.a),h=Me.vec3.normalize([],this.b);this.angle=Math.acos(Me.vec3.dot(m,h))}}function po(c,r){if(c.angle===0)return null;let s;return s=c.a[r]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[r]/c.a[r]/Math.sin(c.angle)-1/Math.tan(c.angle)),s<0||s>1?null:function(u,m,h,g){const w=Math.sin(h);return u*(Math.sin((1-g)*h)/w)+m*(Math.sin(g*h)/w)}(c.a[r],c.b[r],c.angle,Ot(s,0,1))+c.center[r]}function ki(c){if(c.z<=1)return Kn[c.z+2*c.y+c.x];const r=qr(Tn(c));return hr.fromPoints(r)}function mi(c,r,s){return Me.vec3.scale(c,c,1-s),Me.vec3.scaleAndAdd(c,c,r,s)}function oi(c,r,s){for(const u of c)Me.vec3.transformMat4(u,u,r),Me.vec3.scale(u,u,s)}function Nn(c,r,s,u){const m=r/c.worldSize,h=c.globeMatrix;if(s.z<=1){const me=ki(s).getCorners();return oi(me,h,m),hr.fromPoints(me)}const g=Tn(s,u),w=qr(g,fo+en(c._tileCoverLift));oi(w,h,m);const E=Number.MAX_VALUE,I=[-E,-E,-E],x=[E,E,E];if(g.contains(c.center)){for(const Ee of w)Me.vec3.min(x,x,Ee),Me.vec3.max(I,I,Ee);I[2]=0;const me=c.point,pe=[me.x*m,me.y*m,0];return Me.vec3.min(x,x,pe),Me.vec3.max(I,I,pe),new hr(x,I)}if(c._tileCoverLift>0){for(const me of w)Me.vec3.min(x,x,me),Me.vec3.max(I,I,me);return new hr(x,I)}const C=[h[12]*m,h[13]*m,h[14]*m],P=g.getCenter(),T=Ot(c.center.lat,-ui,ui),M=Ot(P.lat,-ui,ui),R=Bl(c.center.lng),B=Ya(T);let U=R-Bl(P.lng);const W=B-Ya(M);U>.5?U-=1:U<-.5&&(U+=1);let Z=0;if(Math.abs(U)>Math.abs(W))Z=U>=0?1:3;else{Z=W>=0?0:2;const me=[h[4]*m,h[5]*m,h[6]*m],pe=-Math.sin(je(W>=0?g.getSouth():g.getNorth()))*fo;Me.vec3.scaleAndAdd(C,C,me,pe)}const H=w[Z],K=w[(Z+1)%4],re=new Qo(H,K,C),se=[po(re,0)||H[0],po(re,1)||H[1],po(re,2)||H[2]],ge=mo(c.zoom);if(ge>0){const me=function({x:Ee,y:ye,z:Pe},Le,Re,Ne,Ve){const We=1/(1<<Pe);let Be=Ee*We,lt=Be+We,bt=ye*We,ct=bt+We,It=0;const At=(Be+lt)/2-Ne;return At>.5?It=-1:At<-.5&&(It=1),Be=((Be+It)*Le-(Ne*=Le))*Re+Ne,lt=((lt+It)*Le-Ne)*Re+Ne,bt=(bt*Le-(Ve*=Le))*Re+Ve,ct=(ct*Le-Ve)*Re+Ve,[[Be,ct,0],[lt,ct,0],[lt,bt,0],[Be,bt,0]]}(s,r,c._pixelsPerMercatorPixel,R,B);for(let Ee=0;Ee<w.length;Ee++)mi(w[Ee],me[Ee],ge);const pe=Me.vec3.add([],me[Z],me[(Z+1)%4]);Me.vec3.scale(pe,pe,.5),mi(se,pe,ge)}for(const me of w)Me.vec3.min(x,x,me),Me.vec3.max(I,I,me);return x[2]=Math.min(H[2],K[2]),Me.vec3.min(x,x,se),Me.vec3.max(I,I,se),new hr(x,I)}function Tn({x:c,y:r,z:s},u=!1){const m=1/(1<<s),h=new Kr(Jo(c*m),r===(1<<s)-1&&u?-90:Ki((r+1)*m)),g=new Kr(Jo((c+1)*m),r===0&&u?90:Ki(r*m));return new jl(h,g)}function qr(c,r=fo){const s=je(c.getNorth()),u=je(c.getSouth()),m=Math.cos(s),h=Math.cos(u),g=Math.sin(s),w=Math.sin(u),E=c.getWest(),I=c.getEast();return[Ac(h,w,E,r),Ac(h,w,I,r),Ac(m,g,I,r),Ac(m,g,E,r)]}function ni(c,r,s,u){const m=1<<s.z,h=(c/Lt+s.x)/m;return Ic(Ki((r/Lt+s.y)/m),Jo(h),u)}function Ri({min:c,max:r}){return px/Math.max(r[0]-c[0],r[1]-c[1],r[2]-c[2])}const An=new Float64Array(16);function io(c){const r=Ri(c),s=Me.mat4.fromScaling(An,[r,r,r]);return Me.mat4.translate(s,s,Me.vec3.negate([],c.min))}function ls(c){const r=Me.mat4.fromTranslation(An,c.min),s=1/Ri(c);return Me.mat4.scale(r,r,[s,s,s])}function Fo(c){const r=Lt/(2*Math.PI);return c/(2*Math.PI)/r}function Xa(c,r){return Lt/(512*Math.pow(2,c))*Ri(ki(r))}function va(c,r,s,u,m){const h=Fo(s),g=[c,r,-s/(2*Math.PI)],w=Me.mat4.identity(new Float64Array(16));return Me.mat4.translate(w,w,g),Me.mat4.scale(w,w,[h,h,h]),Me.mat4.rotateX(w,w,je(-m)),Me.mat4.rotateY(w,w,je(-u)),w}function mo(c){return Ur(k_,R_,c)}function cs(c,r){const s=Ic(r.lat,r.lng),u=function(h){const g=Ic(h._center.lat,h._center.lng),w=Me.vec3.fromValues(0,1,0);let E=Me.vec3.cross([],w,g);const I=Me.mat4.fromRotation([],-h.angle,g);E=Me.vec3.transformMat4(E,E,I),Me.mat4.fromRotation(I,-h._pitch,E);const x=Me.vec3.normalize([],g);return Me.vec3.scale(x,x,en(h.cameraToCenterDistance/h.pixelsPerMeter)),Me.vec3.transformMat4(x,x,I),Me.vec3.add([],g,x)}(c),m=Me.vec3.subtract([],u,s);return Me.vec3.angle(m,s)}function Ka(c,r){return cs(c,r)>Math.PI/2*1.01}const Qs=je(85),kc=Math.cos(Qs),Ph=Math.sin(Qs),N_=Me.mat4.create(),Up=c=>{const r=[];return c.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function bP(c,r,s,u,m,h,g,w,E){if(h&&c.queryGeometry.isAboveHorizon)return!1;h&&(E*=c.pixelToTileUnitsFactor);const I=c.tileID.canonical,x=s.projection.upVectorScale(I,s.center.lat,s.worldSize).metersToTile;for(const C of r)for(const P of C){const T=P.add(w),M=m&&s.elevation?s.elevation.exaggeration()*m.getElevationAt(T.x,T.y,!0):0,R=s.projection.projectTilePoint(T.x,T.y,I);if(M>0){const Z=s.projection.upVector(I,T.x,T.y);R.x+=Z[0]*x*M,R.y+=Z[1]*x*M,R.z+=Z[2]*x*M}const B=h?T:GB(R.x,R.y,R.z,u),U=h?c.tilespaceRays.map(Z=>qB(Z,M)):c.queryGeometry.screenGeometry,W=Me.vec4.transformMat4([],[R.x,R.y,R.z,1],u);if(!g&&h?E*=W[3]/s.cameraToCenterDistance:g&&!h&&(E*=s.cameraToCenterDistance/W[3]),h){const Z=Ki((P.y/Lt+I.y)/(1<<I.z));E/=s.projection.pixelsPerMeter(Z,1)/Co(1,Z)}if(fe(U,B,E))return!0}return!1}function GB(c,r,s,u){const m=Me.vec4.transformMat4([],[c,r,s,1],u);return new vt(m[0]/m[3],m[1]/m[3])}const wP=Me.vec3.fromValues(0,0,0),HB=Me.vec3.fromValues(0,0,1);function qB(c,r){const s=Me.vec3.create();return wP[2]=r,c.intersectsPlane(wP,HB,s),new vt(s[0],s[1])}class SP extends le{}let TP,EP,CP,MP;function PP(c,{width:r,height:s},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==r*s*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(r*s*u);return c.width=r,c.height=s,c.data=m,c}function AP(c,r,s){const{width:u,height:m}=r;u===c.width&&m===c.height||(N2(c,r,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,m)},s,null),c.width=u,c.height=m,c.data=r.data)}function N2(c,r,s,u,m,h,g,w){if(m.width===0||m.height===0)return r;if(m.width>c.width||m.height>c.height||s.x>c.width-m.width||s.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>r.width||m.height>r.height||u.x>r.width-m.width||u.y>r.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const E=c.data,I=r.data,x=h===4&&w;for(let C=0;C<m.height;C++){const P=((s.y+C)*c.width+s.x)*h,T=((u.y+C)*r.width+u.x)*h;if(x)for(let M=0;M<m.width;M++){const R=P+M*h+3,B=T+M*h;I[B+0]=255,I[B+1]=255,I[B+2]=255,I[B+3]=E[R]}else if(g)for(let M=0;M<m.width;M++){const R=P+M*h,B=T+M*h,U=E[R+3],W=new Xr(E[R+0]/255*U,E[R+1]/255*U,E[R+2]/255*U,U).toRenderColor(g).toArray();I[B+0]=W[0],I[B+1]=W[1],I[B+2]=W[2],I[B+3]=W[3]}else for(let M=0;M<m.width*h;M++)I[T+M]=E[P+M]}return r}qt(SP,"HeatmapBucket",{omit:["layers"]});class Bu{constructor(r,s){PP(this,r,1,s)}resize(r){AP(this,new Bu(r),1)}clone(){return new Bu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,u,m,h){N2(r,s,u,m,h,1,null)}}class Mo{constructor(r,s){PP(this,r,4,s)}resize(r){AP(this,new Mo(r),4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,u,m,h,g,w){N2(r,s,u,m,h,4,g,w)}}class IP{constructor(r,s){this.width=r.width,this.height=r.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function F_(c){const r={},s=c.resolution||256,u=c.clips?c.clips.length:1,m=c.image||new Mo({width:s,height:u}),h=(g,w,E)=>{r[c.evaluationKey]=E;const I=c.expression.evaluate(r);I&&(m.data[g+w+0]=Math.floor(255*I.r/I.a),m.data[g+w+1]=Math.floor(255*I.g/I.a),m.data[g+w+2]=Math.floor(255*I.b/I.a),m.data[g+w+3]=Math.floor(255*I.a))};if(c.clips)for(let g=0,w=0;g<u;++g,w+=4*s)for(let E=0,I=0;E<s;E++,I+=4){const x=E/(s-1),{start:C,end:P}=c.clips[g];h(w,I,C*(1-x)+P*x)}else for(let g=0,w=0;g<s;g++,w+=4)h(0,w,g/(s-1));return m}qt(Bu,"AlphaImage"),qt(Mo,"RGBAImage");const WB=Qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ZB}=WB;function j_(c,r,s=2){const u=r&&r.length,m=u?r[0]*s:c.length;let h=kP(c,0,m,s,!0);const g=[];if(!h||h.next===h.prev)return g;let w,E,I;if(u&&(h=function(x,C,P,T){const M=[];for(let R=0,B=C.length;R<B;R++){const U=kP(x,C[R]*T,R<B-1?C[R+1]*T:x.length,T,!1);U===U.next&&(U.steiner=!0),M.push(r6(U))}M.sort(QB);for(let R=0;R<M.length;R++)P=e6(M[R],P);return P}(c,r,h,s)),c.length>80*s){w=1/0,E=1/0;let x=-1/0,C=-1/0;for(let P=s;P<m;P+=s){const T=c[P],M=c[P+1];T<w&&(w=T),M<E&&(E=M),T>x&&(x=T),M>C&&(C=M)}I=Math.max(x-w,C-E),I=I!==0?32767/I:0}return B_(h,g,s,w,E,I,0),g}function kP(c,r,s,u,m){let h;if(m===function(g,w,E,I){let x=0;for(let C=w,P=E-I;C<E;C+=I)x+=(g[P]-g[C])*(g[C+1]+g[P+1]),P=C;return x}(c,r,s,u)>0)for(let g=r;g<s;g+=u)h=LP(g/u|0,c[g],c[g+1],h);else for(let g=s-u;g>=r;g-=u)h=LP(g/u|0,c[g],c[g+1],h);return h&&gx(h,h.next)&&(V_(h),h=h.next),h}function Ah(c,r){if(!c)return c;r||(r=c);let s,u=c;do if(s=!1,u.steiner||!gx(u,u.next)&&Di(u.prev,u,u.next)!==0)u=u.next;else{if(V_(u),u=r=u.prev,u===u.next)break;s=!0}while(s||u!==r);return r}function B_(c,r,s,u,m,h,g){if(!c)return;!g&&h&&function(E,I,x,C){let P=E;do P.z===0&&(P.z=F2(P.x,P.y,I,x,C)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==E);P.prevZ.nextZ=null,P.prevZ=null,function(T){let M,R=1;do{let B,U=T;T=null;let W=null;for(M=0;U;){M++;let Z=U,H=0;for(let re=0;re<R&&(H++,Z=Z.nextZ,Z);re++);let K=R;for(;H>0||K>0&&Z;)H!==0&&(K===0||!Z||U.z<=Z.z)?(B=U,U=U.nextZ,H--):(B=Z,Z=Z.nextZ,K--),W?W.nextZ=B:T=B,B.prevZ=W,W=B;U=Z}W.nextZ=null,R*=2}while(M>1)}(P)}(c,u,m,h);let w=c;for(;c.prev!==c.next;){const E=c.prev,I=c.next;if(h?XB(c,u,m,h):YB(c))r.push(E.i,c.i,I.i),V_(c),c=I.next,w=I.next;else if((c=I)===w){g?g===1?B_(c=KB(Ah(c),r),r,s,u,m,h,2):g===2&&JB(c,r,s,u,m,h):B_(Ah(c),r,s,u,m,h,1);break}}}function YB(c){const r=c.prev,s=c,u=c.next;if(Di(r,s,u)>=0)return!1;const m=r.x,h=s.x,g=u.x,w=r.y,E=s.y,I=u.y,x=m<h?m<g?m:g:h<g?h:g,C=w<E?w<I?w:I:E<I?E:I,P=m>h?m>g?m:g:h>g?h:g,T=w>E?w>I?w:I:E>I?E:I;let M=u.next;for(;M!==r;){if(M.x>=x&&M.x<=P&&M.y>=C&&M.y<=T&&Vp(m,w,h,E,g,I,M.x,M.y)&&Di(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function XB(c,r,s,u){const m=c.prev,h=c,g=c.next;if(Di(m,h,g)>=0)return!1;const w=m.x,E=h.x,I=g.x,x=m.y,C=h.y,P=g.y,T=w<E?w<I?w:I:E<I?E:I,M=x<C?x<P?x:P:C<P?C:P,R=w>E?w>I?w:I:E>I?E:I,B=x>C?x>P?x:P:C>P?C:P,U=F2(T,M,r,s,u),W=F2(R,B,r,s,u);let Z=c.prevZ,H=c.nextZ;for(;Z&&Z.z>=U&&H&&H.z<=W;){if(Z.x>=T&&Z.x<=R&&Z.y>=M&&Z.y<=B&&Z!==m&&Z!==g&&Vp(w,x,E,C,I,P,Z.x,Z.y)&&Di(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,H.x>=T&&H.x<=R&&H.y>=M&&H.y<=B&&H!==m&&H!==g&&Vp(w,x,E,C,I,P,H.x,H.y)&&Di(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;Z&&Z.z>=U;){if(Z.x>=T&&Z.x<=R&&Z.y>=M&&Z.y<=B&&Z!==m&&Z!==g&&Vp(w,x,E,C,I,P,Z.x,Z.y)&&Di(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;H&&H.z<=W;){if(H.x>=T&&H.x<=R&&H.y>=M&&H.y<=B&&H!==m&&H!==g&&Vp(w,x,E,C,I,P,H.x,H.y)&&Di(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function KB(c,r){let s=c;do{const u=s.prev,m=s.next.next;!gx(u,m)&&RP(u,s,s.next,m)&&U_(u,m)&&U_(m,u)&&(r.push(u.i,s.i,m.i),V_(s),V_(s.next),s=c=m),s=s.next}while(s!==c);return Ah(s)}function JB(c,r,s,u,m,h){let g=c;do{let w=g.next.next;for(;w!==g.prev;){if(g.i!==w.i&&n6(g,w)){let E=DP(g,w);return g=Ah(g,g.next),E=Ah(E,E.next),B_(g,r,s,u,m,h,0),void B_(E,r,s,u,m,h,0)}w=w.next}g=g.next}while(g!==c)}function QB(c,r){return c.x-r.x}function e6(c,r){const s=function(m,h){let g=h;const w=m.x,E=m.y;let I,x=-1/0;do{if(E<=g.y&&E>=g.next.y&&g.next.y!==g.y){const R=g.x+(E-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(R<=w&&R>x&&(x=R,I=g.x<g.next.x?g:g.next,R===w))return I}g=g.next}while(g!==h);if(!I)return null;const C=I,P=I.x,T=I.y;let M=1/0;g=I;do{if(w>=g.x&&g.x>=P&&w!==g.x&&Vp(E<T?w:x,E,P,T,E<T?x:w,E,g.x,g.y)){const R=Math.abs(E-g.y)/(w-g.x);U_(g,m)&&(R<M||R===M&&(g.x>I.x||g.x===I.x&&t6(I,g)))&&(I=g,M=R)}g=g.next}while(g!==C);return I}(c,r);if(!s)return r;const u=DP(s,c);return Ah(u,u.next),Ah(s,s.next)}function t6(c,r){return Di(c.prev,c,r.prev)<0&&Di(r.next,c,c.next)<0}function F2(c,r,s,u,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-s)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function r6(c){let r=c,s=c;do(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next;while(r!==c);return s}function Vp(c,r,s,u,m,h,g,w){return(m-g)*(r-w)>=(c-g)*(h-w)&&(c-g)*(u-w)>=(s-g)*(r-w)&&(s-g)*(h-w)>=(m-g)*(u-w)}function n6(c,r){return c.next.i!==r.i&&c.prev.i!==r.i&&!function(s,u){let m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==u.i&&m.next.i!==u.i&&RP(m,m.next,s,u))return!0;m=m.next}while(m!==s);return!1}(c,r)&&(U_(c,r)&&U_(r,c)&&function(s,u){let m=s,h=!1;const g=(s.x+u.x)/2,w=(s.y+u.y)/2;do m.y>w!=m.next.y>w&&m.next.y!==m.y&&g<(m.next.x-m.x)*(w-m.y)/(m.next.y-m.y)+m.x&&(h=!h),m=m.next;while(m!==s);return h}(c,r)&&(Di(c.prev,c,r.prev)||Di(c,r.prev,r))||gx(c,r)&&Di(c.prev,c,c.next)>0&&Di(r.prev,r,r.next)>0)}function Di(c,r,s){return(r.y-c.y)*(s.x-r.x)-(r.x-c.x)*(s.y-r.y)}function gx(c,r){return c.x===r.x&&c.y===r.y}function RP(c,r,s,u){const m=yx(Di(c,r,s)),h=yx(Di(c,r,u)),g=yx(Di(s,u,c)),w=yx(Di(s,u,r));return m!==h&&g!==w||!(m!==0||!_x(c,s,r))||!(h!==0||!_x(c,u,r))||!(g!==0||!_x(s,c,u))||!(w!==0||!_x(s,r,u))}function _x(c,r,s){return r.x<=Math.max(c.x,s.x)&&r.x>=Math.min(c.x,s.x)&&r.y<=Math.max(c.y,s.y)&&r.y>=Math.min(c.y,s.y)}function yx(c){return c>0?1:c<0?-1:0}function U_(c,r){return Di(c.prev,c,c.next)<0?Di(c,r,c.next)>=0&&Di(c,c.prev,r)>=0:Di(c,r,c.prev)<0||Di(c,c.next,r)<0}function DP(c,r){const s=j2(c.i,c.x,c.y),u=j2(r.i,r.x,r.y),m=c.next,h=r.prev;return c.next=r,r.prev=c,s.next=m,m.prev=s,u.next=s,s.prev=u,h.next=u,u.prev=h,u}function LP(c,r,s,u){const m=j2(c,r,s);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function V_(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function j2(c,r,s){return{i:c,x:r,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function vx(c,r){const s=c.length;if(s<=1)return[c];const u=[];let m,h;for(let g=0;g<s;g++){const w=Fn(c[g]);w!==0&&(c[g].area=Math.abs(w),h===void 0&&(h=w<0),h===w<0?(m&&u.push(m),m=[c[g]]):m.push(c[g]))}if(m&&u.push(m),r>1)for(let g=0;g<u.length;g++)u[g].length<=r||(_v(u[g],r,1,u[g].length-1,i6),u[g]=u[g].slice(0,r));return u}function i6(c,r){return r.area-c.area}function OP(c,r){if(!c)return null;const s=typeof c=="string"?c:c.getPrimary().id;r[s]||(r[s]=[]);const u=Ii.from(c).getPrimary();return r[s].push(u),u.serialize()}function B2(c,r,s){const u=s.patternDependencies;let m=!1;for(const h of r){const g=h.paint.get(`${c}-pattern`);g.isConstant()||(m=!0),OP(g.constantOr(null),u)&&(m=!0)}return m}function U2(c,r,s,u,m){const h=m.patternDependencies;for(const g of r){const w=g.paint.get(`${c}-pattern`).value;if(w.kind!=="constant"){let E=w.evaluate({zoom:u},s,{},m.availableImages);E=E&&E.name?E.name:E;const I=OP(E,h);I&&(s.patterns[g.id]=I)}}return s}class V2{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ha,this.indexArray=new no,this.indexArray2=new Ol,this.programConfigurations=new Fl(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new ri,this.segments2=new ri,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=r.projection}updateFootprints(r,s){}populate(r,s,u,m){this.hasPattern=B2("fill",this.layers,s);const h=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:w,id:E,index:I,sourceLayerIndex:x}of r){const C=this.layers[0]._featureFilter.needGeometry,P=q(w,C);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),P,u))continue;const T=h?h.evaluate(P,{},u,s.availableImages):void 0,M={id:E,properties:w.properties,type:w.type,sourceLayerIndex:x,index:I,geometry:C?P.geometry:V(w,u,m),patterns:{},sortKey:T};g.push(M)}h&&g.sort((w,E)=>w.sortKey-E.sortKey);for(const w of g){const{geometry:E,index:I,sourceLayerIndex:x}=w;if(this.hasPattern){const C=U2("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(C)}else this.addFeature(w,E,I,u,{},s.availableImages,s.brightness);s.featureIndex.insert(r[I].feature,E,I,x,this.index)}}update(r,s,u,m,h,g,w){this.programConfigurations.updatePaintArrays(r,s,h,u,m,g,w)}addFeatures(r,s,u,m,h,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,s,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ZB),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,s,u,m,h,g=[],w){for(const E of vx(s,500)){let I=0;for(const R of E)I+=R.length;const x=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),C=x.vertexLength,P=[],T=[];for(const R of E){if(R.length===0)continue;R!==E[0]&&T.push(P.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),U=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(U+R.length-1,U),P.push(R[0].x),P.push(R[0].y);for(let W=1;W<R.length;W++)this.layoutVertexArray.emplaceBack(R[W].x,R[W].y),this.indexArray2.emplaceBack(U+W-1,U+W),P.push(R[W].x),P.push(R[W].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const M=j_(P,T);for(let R=0;R<M.length;R+=3)this.indexArray.emplaceBack(C+M[R],C+M[R+1],C+M[R+2]);x.vertexLength+=I,x.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,w)}}let zP,NP,FP,jP;qt(V2,"FillBucket",{omit:["layers","patternFeatures"]});class $2{constructor(r,s,u,m){if(this.triangleCount=s.length/3,this.min=new vt(0,0),this.max=new vt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[h,g]=[r[0].clone(),r[0].clone()];for(let C=1;C<r.length;++C){const P=r[C];h.x=Math.min(h.x,P.x),h.y=Math.min(h.y,P.y),g.x=Math.max(g.x,P.x),g.y=Math.max(g.y,P.y)}if(m){const C=Math.ceil(Math.max(g.x-h.x,g.y-h.y)/m);u=Math.max(u,C)}if(u===0)return;this.min=h,this.max=g;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const E=Math.max(w.x,w.y)/u;this.cellsX=Math.max(1,Math.ceil(w.x/E)),this.cellsY=Math.max(1,Math.ceil(w.y/E)),this.xScale=1/E,this.yScale=1/E;const I=[];for(let C=0;C<this.triangleCount;C++){const P=r[s[3*C+0]].sub(this.min),T=r[s[3*C+1]].sub(this.min),M=r[s[3*C+2]].sub(this.min),R=Ul(Math.floor(Math.min(P.x,T.x,M.x)),this.xScale,this.cellsX),B=Ul(Math.floor(Math.max(P.x,T.x,M.x)),this.xScale,this.cellsX),U=Ul(Math.floor(Math.min(P.y,T.y,M.y)),this.yScale,this.cellsY),W=Ul(Math.floor(Math.max(P.y,T.y,M.y)),this.yScale,this.cellsY),Z=new vt(0,0),H=new vt(0,0),K=new vt(0,0),re=new vt(0,0);for(let se=U;se<=W;++se){Z.y=H.y=se*E,K.y=re.y=(se+1)*E;for(let ge=R;ge<=B;++ge)Z.x=K.x=ge*E,H.x=re.x=(ge+1)*E,($e(P,T,M,Z,H,re)||$e(P,T,M,Z,re,K))&&I.push({cellIdx:se*this.cellsX+ge,triIdx:C})}}if(I.length===0)return;I.sort((C,P)=>C.cellIdx-P.cellIdx||C.triIdx-P.triIdx);let x=0;for(;x<I.length;){const C=I[x].cellIdx,P={start:this.payload.length,len:0};for(;x<I.length&&I[x].cellIdx===C;)++P.len,this.payload.push(I[x++].triIdx);this.cells[C]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,s){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=Ul(r.x-this.min.x,this.xScale,this.cellsX),m=Ul(r.y-this.min.y,this.yScale,this.cellsY),h=this.cells[m*this.cellsX+u];if(h){this._lazyInitLookup();for(let g=0;g<h.len;g++){const w=this.payload[h.start+g],E=Math.floor(w/8),I=1<<w%8;if(!(this.lookup[E]&I)&&(this.lookup[E]|=I,s.push(w),s.length===this.triangleCount))return}}}query(r,s,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>s.x||r.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const m=Ul(r.x-this.min.x,this.xScale,this.cellsX),h=Ul(s.x-this.min.x,this.xScale,this.cellsX),g=Ul(r.y-this.min.y,this.yScale,this.cellsY),w=Ul(s.y-this.min.y,this.yScale,this.cellsY);for(let E=g;E<=w;E++)for(let I=m;I<=h;I++){const x=this.cells[E*this.cellsX+I];if(x)for(let C=0;C<x.len;C++){const P=this.payload[x.start+C],T=Math.floor(P/8),M=1<<P%8;if(!(this.lookup[T]&M)&&(this.lookup[T]|=M,u.push(P),u.length===this.triangleCount))return}}}}function Ul(c,r,s){return Math.max(0,Math.min(s-1,Math.floor(c*r)))}qt($2,"TriangleGridIndex");class BP{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(r,s){for(const u of this.footprints)s.push({footprint:u,id:r})}populate(r,s,u,m){const h=[];for(const{feature:g,id:w,index:E,sourceLayerIndex:I}of r){const x=this.layers[0]._featureFilter.needGeometry,C=q(g,x);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),C,u))continue;const P={id:w,properties:g.properties,type:g.type,sourceLayerIndex:I,index:E,geometry:x?C.geometry:V(g,u,m),patterns:{}};h.push(P)}for(const g of h){const{geometry:w,index:E,sourceLayerIndex:I}=g;this.addFeature(g,w,E,u,{},s.availableImages,s.brightness),s.featureIndex.insert(r[E].feature,w,E,I,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,s,u,m,h,g,w){}destroy(){}addFeature(r,s,u,m,h,g=[],w){for(const E of vx(s,2)){const I=[],x=[],C=[],P=new vt(1/0,1/0),T=new vt(-1/0,-1/0);for(const B of E)if(B.length!==0){B!==E[0]&&C.push(x.length/2);for(let U=0;U<B.length;U++)x.push(B[U].x),x.push(B[U].y),I.push(B[U]),P.x=Math.min(P.x,B[U].x),P.y=Math.min(P.y,B[U].y),T.x=Math.max(T.x,B[U].x),T.y=Math.max(T.y,B[U].y)}const M=j_(x,C),R=new $2(I,M,8,256);this.footprints.push({vertices:I,indices:M,grid:R,min:P,max:T})}}}qt(BP,"ClipBucket",{omit:["layers"]});const o6=Qr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),s6=Qr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),a6=Qr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),l6=Qr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),c6=Qr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),u6=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:d6}=o6;var G2,UP,H2,VP,q2,$P,GP,xx={};function HP(){if(UP)return G2;UP=1;var c=tr();function r(m,h,g,w,E){this.properties={},this.extent=g,this.type=0,this._pbf=m,this._geometry=-1,this._keys=w,this._values=E,m.readFields(s,this,h)}function s(m,h,g){m==1?h.id=g.readVarint():m==2?function(w,E){for(var I=w.readVarint()+w.pos;w.pos<I;){var x=E._keys[w.readVarint()],C=E._values[w.readVarint()];E.properties[x]=C}}(g,h):m==3?h.type=g.readVarint():m==4&&(h._geometry=g.pos)}function u(m){for(var h,g,w=0,E=0,I=m.length,x=I-1;E<I;x=E++)w+=((g=m[x]).x-(h=m[E]).x)*(h.y+g.y);return w}return G2=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var h,g=m.readVarint()+m.pos,w=1,E=0,I=0,x=0,C=[];m.pos<g;){if(E<=0){var P=m.readVarint();w=7&P,E=P>>3}if(E--,w===1||w===2)I+=m.readSVarint(),x+=m.readSVarint(),w===1&&(h&&C.push(h),h=[]),h.push(new c(I,x));else{if(w!==7)throw new Error("unknown command "+w);h&&h.push(h[0].clone())}}return h&&C.push(h),C},r.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var h=m.readVarint()+m.pos,g=1,w=0,E=0,I=0,x=1/0,C=-1/0,P=1/0,T=-1/0;m.pos<h;){if(w<=0){var M=m.readVarint();g=7&M,w=M>>3}if(w--,g===1||g===2)(E+=m.readSVarint())<x&&(x=E),E>C&&(C=E),(I+=m.readSVarint())<P&&(P=I),I>T&&(T=I);else if(g!==7)throw new Error("unknown command "+g)}return[x,P,C,T]},r.prototype.toGeoJSON=function(m,h,g){var w,E,I=this.extent*Math.pow(2,g),x=this.extent*m,C=this.extent*h,P=this.loadGeometry(),T=r.types[this.type];function M(U){for(var W=0;W<U.length;W++){var Z=U[W];U[W]=[360*(Z.x+x)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+C)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(w=0;w<P.length;w++)R[w]=P[w][0];M(P=R);break;case 2:for(w=0;w<P.length;w++)M(P[w]);break;case 3:for(P=function(U){var W=U.length;if(W<=1)return[U];for(var Z,H,K=[],re=0;re<W;re++){var se=u(U[re]);se!==0&&(H===void 0&&(H=se<0),H===se<0?(Z&&K.push(Z),Z=[U[re]]):Z.push(U[re]))}return Z&&K.push(Z),K}(P),w=0;w<P.length;w++)for(E=0;E<P[w].length;E++)M(P[w][E])}P.length===1?P=P[0]:T="Multi"+T;var B={type:"Feature",geometry:{type:T,coordinates:P},properties:this.properties};return"id"in this&&(B.id=this.id),B},G2}function qP(){if(VP)return H2;VP=1;var c=HP();function r(u,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(s,this,m),this.length=this._features.length}function s(u,m,h){u===15?m.version=h.readVarint():u===1?m.name=h.readString():u===5?m.extent=h.readVarint():u===2?m._features.push(h.pos):u===3?m._keys.push(h.readString()):u===4&&m._values.push(function(g){for(var w=null,E=g.readVarint()+g.pos;g.pos<E;){var I=g.readVarint()>>3;w=I===1?g.readString():I===2?g.readFloat():I===3?g.readDouble():I===4?g.readVarint64():I===5?g.readVarint():I===6?g.readSVarint():I===7?g.readBoolean():null}return w}(h))}return H2=r,r.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var m=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,m,this.extent,this._keys,this._values)},H2}function WP(){return GP||(GP=1,xx.VectorTile=function(){if($P)return q2;$P=1;var c=qP();function r(s,u,m){if(s===3){var h=new c(m,m.readVarint()+m.pos);h.length&&(u[h.name]=h)}}return q2=function(s,u){this.layers=s.readFields(r,{},u)},q2}(),xx.VectorTileFeature=HP(),xx.VectorTileLayer=qP()),xx}var $p=WP();class Ih extends vt{constructor(r,s,u){super(r,s),this.z=u}}class ZP extends Ih{constructor(r,s,u,m){super(r,s,u),this.w=m}}function bx(c,r,s,u){const m=[],h=u===0?(g,w,E,I,x,C)=>{g.push(new vt(C,E+(C-w)/(I-w)*(x-E)))}:(g,w,E,I,x,C)=>{g.push(new vt(w+(C-E)/(x-E)*(I-w),C))};for(const g of c){const w=[];for(const E of g){if(E.length<=2)continue;const I=[];for(let P=0;P<E.length-1;P++){const T=E[P].x,M=E[P].y,R=E[P+1].x,B=E[P+1].y,U=u===0?T:M,W=u===0?R:B;U<r?W>r&&h(I,T,M,R,B,r):U>s?W<s&&h(I,T,M,R,B,s):I.push(E[P]),W<r&&U>=r&&h(I,T,M,R,B,r),W>s&&U<=s&&h(I,T,M,R,B,s)}let x=E[E.length-1];const C=u===0?x.x:x.y;C>=r&&C<=s&&I.push(x),I.length&&(x=I[I.length-1],I[0].x===x.x&&I[0].y===x.y||I.push(I[0]),w.push(I))}w.length&&m.push(w)}return m}function YP(c,r,s,u){const m=s==="x"?"y":"x",h=(u-c[s])/(r[s]-c[s]);c[m]=c[m]+(r[m]-c[m])*h,c[s]=u,c.hasOwnProperty("z")&&(c.z=pr(c.z,r.z,h)),c.hasOwnProperty("w")&&(c.w=pr(c.w,r.w,h))}function XP(c,r,s,u){const m=s,h=u;for(const g of["x","y"]){let w=c,E=r;w[g]>=E[g]&&(w=r,E=c),w[g]<m&&E[g]>m&&YP(w,E,g,m),w[g]<h&&E[g]>h&&YP(E,w,g,h)}}const wx=Number.MAX_SAFE_INTEGER;function KP(c,r,s,u){return c.order<r||c.order===wx||!(c.clipMask&s)||function(m,h){return h.length!==0&&h.find(g=>g===m)===void 0}(u,c.clipScope)}function Sx(c,r){return c.x-r.x||c.y-r.y}function JP(c,r){return Sx(c.min,r.min)===0&&Sx(c.max,r.max)===0}function W2(c,r){return!(c.min.x>r.max.x||c.max.x<r.min.x||c.min.y>r.max.y||c.max.y<r.min.y)}function Z2(c,r){if(c.length!==r.length)return!1;for(let s=0;s<c.length;s++)if(c[s].sourceId!==r[s].sourceId||!JP(c[s],r[s])||c[s].order!==r[s].order||c[s].clipMask!==r[s].clipMask||!Mn(c[s].clipScope,r[s].clipScope))return!1;return!0}function QP(c,r,s){const u=1/Lt,m=1/(1<<s.canonical.z),h=(r.x*u+s.canonical.x)*m+s.wrap,g=(r.y*u+s.canonical.y)*m;return{min:new vt((c.x*u+s.canonical.x)*m+s.wrap,(c.y*u+s.canonical.y)*m),max:new vt(h,g)}}function h6(c,r,s){const u=1<<s.canonical.z,m=((r.x-s.wrap)*u-s.canonical.x)*Lt,h=(r.y*u-s.canonical.y)*Lt;return{min:new vt(((c.x-s.wrap)*u-s.canonical.x)*Lt,(c.y*u-s.canonical.y)*Lt),max:new vt(m,h)}}function eA(c,r,s,u,m,h,g){const w=c.indices,E=c.vertices,I=[];for(let x=u;x<u+m;x+=3){const C=r[s[x+0]+h],P=r[s[x+1]+h],T=r[s[x+2]+h],M=Math.min(C.x,P.x,T.x),R=Math.max(C.x,P.x,T.x),B=Math.min(C.y,P.y,T.y),U=Math.max(C.y,P.y,T.y);I.length=0,c.grid.query(new vt(M,B),new vt(R,U),I);for(let W=0;W<I.length;W++){const Z=I[W];if($e(E[w[3*Z+0]],E[w[3*Z+1]],E[w[3*Z+2]],C,P,T,g))return!0}}return!1}function tA(c,r,s,u){if(!c||!s)return!1;let m=c.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(s.vertices.length<c.vertices.length)return tA(s,u,c,r);const h=r.canonical,g=u.canonical,w=Math.pow(2,g.z-h.z);m=c.vertices.map(E=>new vt((E.x+h.x*Lt)*w-g.x*Lt,(E.y+h.y*Lt)*w-g.y*Lt))}return eA(s,m,c.indices,0,c.indices.length,0,0)}function rA(c,r,s,u){const m=Math.pow(2,u.z-s.z);return new vt((c+s.x*Lt)*m-u.x*Lt,(r+s.y*Lt)*m-u.y*Lt)}function nA(c,r){const s=[];r.grid.queryPoint(c,s);const u=r.indices,m=r.vertices;for(let h=0;h<s.length;h++){const g=s[h];if(ze([m[u[3*g+0]],m[u[3*g+1]],m[u[3*g+2]]],c))return!0}return!1}const Y2=[new vt(0,0),new vt(Lt,0),new vt(Lt,Lt),new vt(0,Lt)];function iA(c,r){const s=[];let u=[];if(!r||c.length<2)return[c];if(c.length===2)return Xe(c[0],c[1],Y2)?[c]:[];for(let m=0;m<c.length+2;m++){const h=c[m%c.length],g=c[(m+1)%c.length],w=Xe(m===0?c[c.length-1]:c[(m-1)%c.length],h,Y2),E=Xe(h,g,Y2),I=w||E;I&&u.push(h),I&&E||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}const X2=$p.VectorTileFeature.types,f6=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],p6=["fill-extrusion-flood-light-ground-radius"],m6=Math.pow(2,13),g6=Math.pow(2,15)-1,oA=new vt(0,1),Uu=2147483648;function $_(c,r,s,u,m,h,g,w){c.emplaceBack((r<<1)+g,(s<<1)+h,(Math.floor(u*m6)<<1)+m,Math.round(w))}function G_(c,r,s){c.emplaceBack(r.x*Lt,r.y*Lt,s?1:0)}function Tx(c,r,s,u,m,h){c.emplaceBack(r.x,r.y,(s.x<<1)+u,(s.y<<1)+m,h)}function H_(c,r,s){c.emplaceBack(r.x,r.y,r.z,s[0]*16384,s[1]*16384,s[2]*16384)}class sA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class aA{constructor(){this.centroidXY=new vt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new vt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new vt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new vt(this.max.x-this.min.x,this.max.y-this.min.y)}}class lA{constructor(){this.acc=new vt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,s){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=s.x,r.min.y=r.max.y=s.y)}appendEdge(r,s,u){this.accCount++,this.acc._add(s);let m=!!this.borders;s.x<r.min.x?(r.min.x=s.x,m=!0):s.x>r.max.x&&(r.max.x=s.x,m=!0),s.y<r.min.y?(r.min.y=s.y,m=!0):s.y>r.max.y&&(r.max.y=s.y,m=!0),((s.x===0||s.x===Lt)&&s.x===u.x)!=((s.y===0||s.y===Lt)&&s.y===u.y)&&this.processBorderOverlap(s,u),m&&this.checkBorderIntersection(s,u)}checkBorderIntersection(r,s){s.x<0!=r.x<0&&this.addBorderIntersection(0,pr(s.y,r.y,(0-s.x)/(r.x-s.x))),s.x>Lt!=r.x>Lt&&this.addBorderIntersection(1,pr(s.y,r.y,(Lt-s.x)/(r.x-s.x))),s.y<0!=r.y<0&&this.addBorderIntersection(2,pr(s.x,r.x,(0-s.y)/(r.y-s.y))),s.y>Lt!=r.y>Lt&&this.addBorderIntersection(3,pr(s.x,r.x,(Lt-s.y)/(r.y-s.y)))}addBorderIntersection(r,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(r,s){if(r.x===s.x){if(r.y===s.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new vt(0,0):new vt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,s)=>r+ +(s[0]!==Number.MAX_VALUE),0):0}}function cA(c,r){const s=c.add(r)._unit(),u=Ot(c.x*s.x+c.y*s.y,-1,1);var m,h,g;return g=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(g)))/4*g6*((m=c).x*(h=r).y-m.y*h.x<0?-1:1)}const _6=[c=>c.x<0,c=>c.x>Lt,c=>c.y<0,c=>c.y>Lt];function y6(c,r,s,u){const m=[4];if(u===0)return m;s._mult(u);const h=c.sub(s),g=r.sub(s),w=[c,r,h,g];for(let E=0;E<4;E++)for(const I of w)if(_6[E](I)){m.push(E);break}return m}class uA{constructor(r){this.vertexArray=new Cs,this.indexArray=new no,this.programConfigurations=new Fl(r.layers,{zoom:r.zoom,lut:r.lut},s=>p6.includes(s)),this._segments=new ri,this.hiddenByLandmarkVertexArray=new zu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ri}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,s,u,m=!1){const h=r.length;if(h>2){let g=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let E;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const I=r[0],x=r[1];E=cA(I.sub(r[h-1])._perp()._unit(),x.sub(I)._perp()._unit())}for(let I=0;I<h;I++){const x=I===h-1?0:I+1,C=r[I],P=r[x],T=r[x===h-1?0:x+1],M=P.sub(C)._perp()._unit(),R=cA(M,T.sub(P)._perp()._unit()),B=E,U=R;if(K2(C,P,s)||m&&fA(C,s)&&fA(P,s)){E=R;continue}const W=w.vertexLength;Tx(this.vertexArray,C,P,1,1,B),Tx(this.vertexArray,C,P,1,0,B),Tx(this.vertexArray,C,P,0,1,U),Tx(this.vertexArray,C,P,0,0,U),w.vertexLength+=4;const Z=y6(C,P,M,u);for(const H of Z)this._segmentToGroundQuads[g].push({id:W,region:H}),this._segmentToRegionTriCounts[g][H]+=2,w.primitiveLength+=2;E=R}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),s=r.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((m,h)=>m.region-h.region);for(let u=0;u<s;u++){const m=this._segmentToGroundQuads[u],h=r[u],g=this._segmentToRegionTriCounts[u];g.reduce((E,I)=>E+I,0);let w=0;for(let E=0;E<=4;E++){const I=g[E];if(I!==0){let x=this.regionSegments[E];x||(x=this.regionSegments[E]=new ri);const C={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+w,vertexLength:h.vertexLength,primitiveLength:I};x.get().push(C)}w+=I}for(let E=0;E<m.length;E++){const I=m[E].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,s,u,m,h,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,s,u,m,h,g)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,s6.members),this.indexBuffer=r.createIndexBuffer(this.indexArray))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,s,u,m,h,g,w){this.hasData()&&this.programConfigurations.updatePaintArrays(r,s,u,m,h,g,w)}updateHiddenByLandmark(r){if(!this.hasData())return;const s=r.groundVertexCount+r.groundVertexArrayOffset;if(r.groundVertexCount===0)return;const u=r.flags&Uu?1:0;for(let m=r.groundVertexArrayOffset;m<s;++m)this.hiddenByLandmarkVertexArray.emplace(m,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,c6.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const s=this.regionSegments[r];s&&s.destroy()}}}}class Ex{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new no,this.footprintVertices=new Ha,this.footprintSegments=[],this.layoutVertexArray=new Ou,this.centroidVertexArray=new cx,this.wallVertexArray=new dx,this.indexArray=new no,this.programConfigurations=new Fl(r.layers,{zoom:r.zoom,lut:r.lut},s=>f6.includes(s)),this.segments=new ri,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new uA(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(r,s){}populate(r,s,u,m){this.features=[],this.hasPattern=B2("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=p(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:g,index:w,sourceLayerIndex:E}of r){const I=this.layers[0]._featureFilter.needGeometry,x=q(h,I);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),x,u))continue;const C={id:g,sourceLayerIndex:E,index:w,geometry:I?x.geometry:V(h,u,m),properties:h.properties,type:h.type,patterns:{}},P=this.layoutVertexArray.length,T=X2[C.type]==="Polygon";if(this.hasPattern)this.features.push(U2("fill-extrusion",this.layers,C,this.zoom,s));else if(this.wallMode)for(const M of C.geometry)for(const R of iA(M,T))this.addFeature(C,[R],w,u,{},s.availableImages,m,s.brightness);else this.addFeature(C,C.geometry,w,u,{},s.availableImages,m,s.brightness);s.featureIndex.insert(h,C.geometry,w,E,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,s,u,m,h,g){for(const w of this.features){const E=X2[w.type]==="Polygon",{geometry:I}=w;if(this.wallMode)for(const x of I)for(const C of iA(x,E))this.addFeature(w,[C],w.index,s,u,m,h,g);else this.addFeature(w,I,w.index,s,u,m,h,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,s,u,m,h,g,w){this.programConfigurations.updatePaintArrays(r,s,h,u,m,g,w),this.groundEffect.update(r,s,h,u,m,g,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,d6),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,l6.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,u6.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,a6.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,u,m,h,g,w,E){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,x=[new vt(0,0),new vt(Lt,Lt)],C=w.projection,P=C.name==="globe",T=this.wallMode||X2[r.type]==="Polygon",M=new lA;M.centroidDataIndex=this.centroidData.length;const R=new aA,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},m)<=0,U=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},m);let W;if(R.height=U,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Cp),this.wallMode){if(P)return void Gt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;W=function(pe){const Ee=pe[0].x===pe[pe.length-1].x&&pe[0].y===pe[pe.length-1].y;(function(Nt){let pt=0;const Jt=Nt.length;for(let kt=0;kt<Jt;kt++)pt+=(Nt[(kt+1)%Jt].x-Nt[kt].x)*(Nt[(kt+1)%Jt].y+Nt[kt].y);return pt>=0})(pe)||(pe=pe.reverse());const Pe={geometry:[],joinNormals:[],indices:[]},Le=[],Re=[],Ne=[];let Ve=pe.length;for(;Ve>=2&&pe[Ve-1].equals(pe[Ve-2]);)Ve--;if(Ve<(Ee?3:2))return Pe;let We,Be,lt,bt,ct,It=0;for(;It<Ve-1&&pe[It].equals(pe[It+1]);)It++;Ee&&(We=pe[Ve-2],ct=pe[It].sub(We)._unit()._perp());for(let Nt=It;Nt<Ve;Nt++){if(lt=Nt===Ve-1?Ee?pe[It+1]:void 0:pe[Nt+1],lt&&pe[Nt].equals(lt))continue;ct&&(bt=ct),We&&(Be=We),We=pe[Nt],ct=lt?lt.sub(We)._unit()._perp():bt,bt=bt||ct;let pt=bt.add(ct);pt.x===0&&pt.y===0||pt._unit();const Jt=pt.x*ct.x+pt.y*ct.y,kt=Jt!==0?1/Jt:1/0,Zt=bt.x*ct.y-bt.y*ct.x>0;let ur="miter";const Pr=2;ur==="miter"&&kt>Pr&&(ur="bevel"),ur==="bevel"&&(kt>100&&(ur="flipbevel"),kt<Pr&&(ur="miter"));const Ir=(zr,kr,jr,En)=>{const vn=new vt(zr.x,zr.y),br=new vt(zr.x,zr.y);vn.x+=kr.x*En,vn.y+=kr.y*En,br.x-=kr.x*Math.max(jr,1),br.y-=kr.y*Math.max(jr,1),Ne.push(kr),Le.push(vn),Re.push(br)};if(ur==="miter")pt._mult(kt),Ir(We,pt,0,0);else if(ur==="flipbevel")pt=ct.mult(-1),Ir(We,pt,0,0),Ir(We,pt.mult(-1),0,0);else{const zr=-Math.sqrt(kt*kt-1),kr=Zt?zr:0,jr=Zt?0:zr;Be&&Ir(We,bt,kr,jr),lt&&Ir(We,ct,kr,jr)}}Pe.geometry=[...Le,...Re.reverse(),Le[0]],Pe.joinNormals=[...Ne,...Ne.reverse(),Ne[Ne.length-1]];const At=Pe.geometry.length-1;for(let Nt=0;Nt<At/2;Nt++)if(Nt+1<At/2){let pt=Nt,Jt=Nt+1,kt=At-1-Nt,Zt=At-2-Nt;pt=pt===0?At-1:pt-1,Jt=Jt===0?At-1:Jt-1,kt=kt===0?At-1:kt-1,Zt=Zt===0?At-1:Zt-1,Pe.indices.push(kt),Pe.indices.push(Jt),Pe.indices.push(pt),Pe.indices.push(kt),Pe.indices.push(Zt),Pe.indices.push(Jt)}return Pe}(s[0]),s=[W.geometry]}const Z=(pe,Ee)=>pe<(Ee.length-1)/2||pe===Ee.length-1,H=this.wallMode?[s]:vx(s,500);for(let pe=H.length-1;pe>=0;pe--){const Ee=H[pe];(Ee.length===0||(K=Ee[0]).every(ye=>ye.x<=0)||K.every(ye=>ye.x>=Lt)||K.every(ye=>ye.y<=0)||K.every(ye=>ye.y>=Lt))&&H.splice(pe,1)}var K;let re;if(P)re=_A(H,x,m);else{re=[];for(const pe of H)re.push({polygon:pe,bounds:x})}const se=T?this.edgeRadius:0,ge=se>0&&this.zoom<17,me=(pe,Ee)=>{if(pe.length===0)return!1;const ye=pe[pe.length-1];return Ee.x===ye.x&&Ee.y===ye.y};for(const{polygon:pe,bounds:Ee}of re){let ye=0,Pe=0;for(const Ve of pe)T&&!Ve[0].equals(Ve[Ve.length-1])&&Ve.push(Ve[0]),Pe+=T?Ve.length-1:Ve.length;const Le=this.segments.prepareSegment((T?5:4)*Pe,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const Re={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ne=new sA;if(Ne.vertexOffset=this.footprintVertices.length,Ne.indexOffset=3*this.footprintIndices.length,Ne.ringIndices=[],T){const Ve=[],We=[];ye=Le.vertexLength;for(let lt=0;lt<pe.length;lt++){const bt=pe[lt];bt.length&&lt!==0&&We.push(Ve.length/2);const ct=[];let It,At;It=bt[1].sub(bt[0])._perp()._unit(),Ne.ringIndices.push(bt.length-1);for(let Nt=1;Nt<bt.length;Nt++){const pt=bt[Nt],Jt=bt[Nt===bt.length-1?1:Nt+1],kt=pt.clone();if(se){At=Jt.sub(pt)._perp()._unit();const Zt=It.add(At)._unit(),ur=se*Math.min(4,1/(It.x*Zt.x+It.y*Zt.y));kt.x+=ur*Zt.x,kt.y+=ur*Zt.y,kt.x=Math.round(kt.x),kt.y=Math.round(kt.y),It=At}if(!B||se!==0&&!ge||me(ct,kt)||ct.push(kt),$_(this.layoutVertexArray,kt.x,kt.y,0,0,1,1,0),this.wallMode){const Zt=Z(Nt,bt);G_(this.wallVertexArray,W.joinNormals[Nt],!Zt)}Le.vertexLength++,this.footprintVertices.emplaceBack(pt.x,pt.y),Ve.push(pt.x,pt.y),P&&H_(this.layoutVertexExtArray,C.projectTilePoint(kt.x,kt.y,m),C.upVector(m,kt.x,kt.y))}B&&(se===0||ge)&&(ct.length!==0&&me(ct,ct[0])&&ct.pop(),this.groundEffect.addData(ct,Ee,I))}const Be=this.wallMode?W.indices:j_(Ve,We);for(let lt=0;lt<Be.length;lt+=3)this.footprintIndices.emplaceBack(Ne.vertexOffset+Be[lt+0],Ne.vertexOffset+Be[lt+1],Ne.vertexOffset+Be[lt+2]),this.indexArray.emplaceBack(ye+Be[lt],ye+Be[lt+2],ye+Be[lt+1]),Le.primitiveLength++;Ne.indexCount+=Be.length,Ne.vertexCount+=this.footprintVertices.length-Ne.vertexOffset}for(let Ve=0;Ve<pe.length;Ve++){const We=pe[Ve];M.startRing(R,We[0]);let Be=We.length>4&&pA(We[We.length-2],We[0],We[1]),lt=se?v6(We[We.length-2],We[0],We[1],se):0;const bt=[];let ct,It,At;It=We[1].sub(We[0])._perp()._unit();let Nt=!0;for(let pt=1,Jt=0;pt<We.length;pt++){let kt=We[pt-1],Zt=We[pt];const ur=We[pt===We.length-1?1:pt+1];if(M.appendEdge(R,Zt,kt),K2(Zt,kt,Ee)){se&&(It=ur.sub(Zt)._perp()._unit(),Nt=!Nt);continue}const Pr=Zt.sub(kt)._perp(),Ir=Pr.x/(Math.abs(Pr.x)+Math.abs(Pr.y)),zr=Pr.y>0?1:0,kr=kt.dist(Zt);if(Jt+kr>32768&&(Jt=0),se){At=ur.sub(Zt)._perp()._unit();let br=hA(kt,Zt,ur,dA(It,At),se);isNaN(br)&&(br=0);const xn=Zt.sub(kt)._unit();kt=kt.add(xn.mult(lt))._round(),Zt=Zt.add(xn.mult(-br))._round(),lt=br,It=At,B&&this.zoom>=17&&(me(bt,kt)||bt.push(kt),me(bt,Zt)||bt.push(Zt))}const jr=Le.vertexLength,En=We.length>4&&pA(kt,Zt,ur);let vn=mA(Jt,Be,Nt);if($_(this.layoutVertexArray,kt.x,kt.y,Ir,zr,0,0,vn),$_(this.layoutVertexArray,kt.x,kt.y,Ir,zr,0,1,vn),this.wallMode){const br=Z(pt-1,We),xn=W.joinNormals[pt-1];G_(this.wallVertexArray,xn,br),G_(this.wallVertexArray,xn,br)}if(Jt+=kr,vn=mA(Jt,En,!Nt),Be=En,$_(this.layoutVertexArray,Zt.x,Zt.y,Ir,zr,0,0,vn),$_(this.layoutVertexArray,Zt.x,Zt.y,Ir,zr,0,1,vn),this.wallMode){const br=Z(pt,We),xn=W.joinNormals[pt];G_(this.wallVertexArray,xn,br),G_(this.wallVertexArray,xn,br)}if(Le.vertexLength+=4,this.indexArray.emplaceBack(jr+0,jr+1,jr+2),this.indexArray.emplaceBack(jr+1,jr+3,jr+2),Le.primitiveLength+=2,se){const br=ye+(pt===1?We.length-2:pt-2),xn=pt===1?ye:br+1;if(this.indexArray.emplaceBack(jr+1,br,jr+3),this.indexArray.emplaceBack(br,xn,jr+3),Le.primitiveLength+=2,ct===void 0&&(ct=jr),!K2(ur,We[pt],Ee)){const pn=pt===We.length-1?ct:Le.vertexLength;this.indexArray.emplaceBack(jr+2,jr+3,pn),this.indexArray.emplaceBack(jr+3,pn+1,pn),this.indexArray.emplaceBack(jr+3,xn,pn+1),Le.primitiveLength+=3}Nt=!Nt}if(P){const br=this.layoutVertexExtArray,xn=C.projectTilePoint(kt.x,kt.y,m),pn=C.projectTilePoint(Zt.x,Zt.y,m),Cn=C.upVector(m,kt.x,kt.y),bi=C.upVector(m,Zt.x,Zt.y);H_(br,xn,Cn),H_(br,xn,Cn),H_(br,pn,bi),H_(br,pn,bi)}}T&&(ye+=We.length-1),B&&se&&this.zoom>=17&&(bt.length!==0&&me(bt,bt[0])&&bt.pop(),this.groundEffect.addData(bt,Ee,I,se>0))}this.footprintSegments.push(Ne),Re.triangleCount=this.indexArray.length-Re.triangleArrayOffset,this.polygonSegments.push(Re),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=M.borders?oA:this.encodeCentroid(M,R),this.centroidData.push(R),M.borders){this.featuresOnBorder.push(M);const pe=this.featuresOnBorder.length-1;for(let Ee=0;Ee<M.borders.length;Ee++)M.borders[Ee][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ee].push(pe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,E),this.groundEffect.addPaintPropertiesData(r,u,h,g,m,E),this.maxHeight=Math.max(this.maxHeight,U)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((s,u)=>this.featuresOnBorder[s].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let w=0;w<this.centroidData.length;w++){const E=this.centroidData[w],I=+(E.min.y+E.max.y>Lt),x=2*I+(+(E.min.x+E.max.x>Lt)^I);for(let C=0;C<E.polygonSegLen;C++){const P=E.polygonSegIdx+C;r.push({centroidIdx:w,subtile:x,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const s=new no;r.sort((w,E)=>w.triangleSegmentIdx===E.triangleSegmentIdx?w.subtile-E.subtile:w.triangleSegmentIdx-E.triangleSegmentIdx);let u=0,m=0,h=0;for(const w of r){if(w.triangleSegmentIdx!==u)break;h++}const g=r.length;for(;m!==r.length;){u=r[m].triangleSegmentIdx;let w=0,E=m,I=m;for(let x=E;x<h&&r[x].subtile===w;x++)I++;for(;E!==h;){const x=r[E];w=x.subtile;const C=this.centroidData[x.centroidIdx].min.clone(),P=this.centroidData[x.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=E;M<I;M++){const R=r[M],B=this.polygonSegments[R.polygonSegmentIdx],U=this.centroidData[R.centroidIdx].min,W=this.centroidData[R.centroidIdx].max,Z=this.indexArray.uint16;for(let H=B.triangleArrayOffset;H<B.triangleArrayOffset+B.triangleCount;H++)s.emplaceBack(Z[3*H],Z[3*H+1],Z[3*H+2]);T.primitiveLength+=B.triangleCount,C.x=Math.min(C.x,U.x),C.y=Math.min(C.y,U.y),P.x=Math.max(P.x,W.x),P.y=Math.max(P.y,W.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:C,max:P}),E=I;for(let M=E;M<h&&r[M].subtile===r[E].subtile;M++)I++}m=h;for(let x=m;x<g&&r[x].triangleSegmentIdx===r[m].triangleSegmentIdx;x++)h++}s._trim(),this.indexArray=s}getVisibleSegments(r,s,u){const m=new ri;if(this.wallMode){for(const R of this.triangleSubSegments)m.segments.push(R.segment);return m}let h=0,g=0;const w=1<<r.canonical.z;if(s){const R=s.getMinMaxForTile(r);R&&(h=R.min,g=R.max)}g+=this.maxHeight;const E=r.toUnwrapped();let I;const x=[E.canonical.x/w+E.wrap,E.canonical.y/w],C=[(E.canonical.x+1)/w+E.wrap,(E.canonical.y+1)/w],P=(R,B,U)=>[R[0]*(1-U[0])+B[0]*U[0],R[1]*(1-U[1])+B[1]*U[1]],T=[],M=[];for(const R of this.triangleSubSegments){T[0]=R.min.x/Lt,T[1]=R.min.y/Lt,M[0]=R.max.x/Lt,M[1]=R.max.y/Lt;const B=P(x,C,T),U=P(x,C,M);if(new hr([B[0],B[1],h],[U[0],U[1],g]).intersectsPrecise(u)===0){I&&(m.segments.push(I),I=void 0);continue}const W=R.segment;I&&I.vertexOffset!==W.vertexOffset&&(m.segments.push(I),I=void 0),I?(I.vertexLength+=W.vertexLength,I.primitiveLength+=W.primitiveLength):I={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&m.segments.push(I),m}encodeCentroid(r,s){const u=r.centroid(),m=s.span(),h=Math.min(7,Math.round(m.x*this.tileToMeter/10)),g=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new vt(Ot(u.x,1,Lt-1)<<3|h,Ot(u.y,1,Lt-1)<<3|g)}encodeBorderCentroid(r){if(!r.borders)return new vt(0,0);const s=r.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){const m=s[0][0]!==u?0:1;return new vt(6|(s[0][0]!==u?0:65528),(s[m][0]+s[m][1])/2<<3|6)}{const m=s[2][0]!==u?2:3;return new vt((s[m][0]+s[m][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(r){const s=this.centroidData[r.centroidDataIndex];s.flags&=Uu,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const s=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,m=r.flags&Uu?oA:r.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==m.y||h!==m.x){for(let g=s;g<u;++g)this.centroidVertexArray.emplace(g,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const m=s.getReplacementRegionsForTile(r.toUnwrapped());if(Z2(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const h=[];for(const g of this.activeReplacements){if(g.order<u)continue;const w=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-r.canonical.z));for(const E of this.centroidData)if(!(E.flags&Uu||g.min.x>E.max.x||E.min.x>g.max.x||g.min.y>E.max.y||E.min.y>g.max.y))for(let I=0;I<E.footprintSegLen;I++){const x=this.footprintSegments[E.footprintSegIdx+I];if(h.length=0,x6(this.footprintVertices,x.vertexOffset,x.vertexCount,g.footprintTileId.canonical,r.canonical,h),eA(g.footprint,h,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-w)){E.flags|=Uu;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,s,u){let m=!1;for(let h=0;h<u.footprintSegLen;h++){const g=this.footprintSegments[u.footprintSegIdx+h];let w=0;for(const E of g.ringIndices){for(let I=w,x=E+w-1;I<E+w;x=I++){const C=this.footprintVertices.int16[2*(I+g.vertexOffset)+0],P=this.footprintVertices.int16[2*(I+g.vertexOffset)+1],T=this.footprintVertices.int16[2*(x+g.vertexOffset)+1];P>s!=T>s&&r<(this.footprintVertices.int16[2*(x+g.vertexOffset)+0]-C)*(s-P)/(T-P)+C&&(m=!m)}w=E}}return m}getHeightAtTileCoord(r,s){let u=Number.NEGATIVE_INFINITY,m=!0;const h=4*(r+Lt)*Lt+(s+Lt);if(this.partLookup.hasOwnProperty(h)){const g=this.partLookup[h];return g?{height:g.height,hidden:!!(g.flags&Uu)}:void 0}for(const g of this.centroidData)r>g.max.x||g.min.x>r||s>g.max.y||g.min.y>s||this.footprintContainsPoint(r,s,g)&&g&&g.height>u&&(u=g.height,this.partLookup[h]=g,m=!!(g.flags&Uu));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:m};this.partLookup[h]=void 0}}function dA(c,r){const s=c.add(r)._unit();return c.x*s.x+c.y*s.y}function v6(c,r,s,u){const m=r.sub(c)._perp()._unit(),h=s.sub(r)._perp()._unit();return hA(c,r,s,dA(m,h),u)}function hA(c,r,s,u,m){const h=Math.sqrt(1-u*u);return Math.min(c.dist(r)/3,r.dist(s)/3,m*h/u)}function K2(c,r,s){return c.x<s[0].x&&r.x<s[0].x||c.x>s[1].x&&r.x>s[1].x||c.y<s[0].y&&r.y<s[0].y||c.y>s[1].y&&r.y>s[1].y}function fA(c,r){return c.x<r[0].x||c.x>r[1].x||c.y<r[0].y||c.y>r[1].y}function pA(c,r,s){if(c.x<0||c.x>=Lt||r.x<0||r.x>=Lt||s.x<0||s.x>=Lt)return!1;const u=s.sub(r),m=u.perp(),h=c.sub(r);return(u.x*h.x+u.y*h.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(h.x*h.x+h.y*h.y))>-.866&&m.x*h.x+m.y*h.y<0}function mA(c,r,s){const u=r?2|c:-3&c;return s?1|u:-2&u}function gA(){const c=Math.PI/32,r=Math.tan(c),s=ju;return s*Math.sqrt(1+2*r*r)-s}function _A(c,r,s){const u=1<<s.z,m=Jo(s.x/u),h=Jo((s.x+1)/u),g=Ki(s.y/u),w=Ki((s.y+1)/u);return function(E,I,x,C,P=0,T){const M=[];if(!E.length||!x||!C)return M;const R=(re,se)=>{for(const ge of re)M.push({polygon:ge,bounds:se})},B=Math.ceil(Math.log2(x)),U=Math.ceil(Math.log2(C)),W=B-U,Z=[];for(let re=0;re<Math.abs(W);re++)Z.push(W>0?0:1);for(let re=0;re<Math.min(B,U);re++)Z.push(0),Z.push(1);let H=E;if(H=bx(H,I[0].y-P,I[1].y+P,1),H=bx(H,I[0].x-P,I[1].x+P,0),!H.length)return M;const K=[];for(Z.length?K.push({polygons:H,bounds:I,depth:0}):R(H,I);K.length;){const re=K.pop(),se=re.depth,ge=Z[se],me=re.bounds[0],pe=re.bounds[1],Ee=ge===0?me.x:me.y,ye=ge===0?pe.x:pe.y,Pe=T?T(ge,Ee,ye):.5*(Ee+ye),Le=bx(re.polygons,Ee-P,Pe+P,ge),Re=bx(re.polygons,Pe-P,ye+P,ge);if(Le.length){const Ne=[me,new vt(ge===0?Pe:pe.x,ge===1?Pe:pe.y)];Z.length>se+1?K.push({polygons:Le,bounds:Ne,depth:se+1}):R(Le,Ne)}if(Re.length){const Ne=[new vt(ge===0?Pe:me.x,ge===1?Pe:me.y),pe];Z.length>se+1?K.push({polygons:Re,bounds:Ne,depth:se+1}):R(Re,Ne)}}return M}(c,r,Math.ceil((h-m)/11.25),Math.ceil((g-w)/11.25),1,(E,I,x)=>{if(E===0)return .5*(I+x);{const C=Ki((s.y+I/Lt)/u);return(Ya(.5*(Ki((s.y+x/Lt)/u)+C))*u-s.y)*Lt}})}function x6(c,r,s,u,m,h){const g=Math.pow(2,u.z-m.z);for(let w=0;w<s;w++){let E=c.int16[2*(w+r)+0],I=c.int16[2*(w+r)+1];E=(E+m.x*Lt)*g-u.x*Lt,I=(I+m.y*Lt)*g-u.y*Lt,h.push(new vt(E,I))}}let yA,vA;function q_(c,r){return c.x*r.x+c.y*r.y}function xA(c,r){if(c.length===1){let s=0;const u=r[s++];let m;for(;!m||u.equals(m);)if(m=r[s++],!m)return 1/0;for(;s<r.length;s++){const h=r[s],g=c[0],w=m.sub(u),E=h.sub(u),I=g.sub(u),x=q_(w,w),C=q_(w,E),P=q_(E,E),T=q_(I,w),M=q_(I,E),R=x*P-C*C,B=(P*T-C*M)/R,U=(x*M-C*T)/R,W=u.z*(1-B-U)+m.z*B+h.z*U;if(isFinite(W))return W}return 1/0}{let s=1/0;for(const u of r)s=Math.min(s,u.z);return s}}function bA(c,r,s,u,m,h,g,w){const E=g*m.getElevationAt(c,r,!0,!0),I=h[0]!==0,x=I?h[1]===0?g*(h[0]/7-450):g*function(C,P,T){const M=Math.floor(P[0]/8),R=Math.floor(P[1]/8),B=10*(P[0]-8*M),U=10*(P[1]-8*R),W=C.getElevationAt(M,R,!0,!0),Z=C.getMeterToDEM(T),H=Math.floor(.5*(B*Z-1)),K=Math.floor(.5*(U*Z-1)),re=C.tileCoordToPixel(M,R),se=2*H+1,ge=2*K+1,me=function(Re,Ne,Ve,We,Be){return[Re.getElevationAtPixel(Ne,Ve,!0),Re.getElevationAtPixel(Ne+Be,Ve,!0),Re.getElevationAtPixel(Ne,Ve+Be,!0),Re.getElevationAtPixel(Ne+We,Ve+Be,!0)]}(C,re.x-H,re.y-K,se,ge),pe=Math.abs(me[0]-me[1]),Ee=Math.abs(me[2]-me[3]),ye=Math.abs(me[0]-me[2])+Math.abs(me[1]-me[3]),Pe=Math.min(.25,.5*Z*(pe+Ee)/se),Le=Math.min(.25,.5*Z*ye/ge);return W+Math.max(Pe*B,Le*U)}(m,h,w):E;return{base:E+(s===0?-1:s),top:I?Math.max(x+u,E+s+2):E+u}}qt(Ex,"FillExtrusionBucket",{omit:["layers","features"]}),qt(aA,"PartData"),qt(sA,"FootprintSegment"),qt(lA,"BorderCentroidData"),qt(uA,"GroundEffect");const b6=Qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),w6=Qr([{name:"a_z_offset_width",components:2,type:"Float32"}],4),{members:S6}=b6,T6=Qr([{name:"a_packed",components:4,type:"Float32"}]),{members:E6}=T6,C6=Qr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:M6}=C6;class wA{constructor(r,s){this.width=r,this.height=s,this.nextRow=0,this.image=new Bu({width:r,height:s}),this.positions={},this.uploaded=!1}getDash(r,s){const u=this.getKey(r,s);return this.positions[u]}trim(){const r=this.width,s=this.height=Zi(this.nextRow);this.image.resize({width:r,height:s})}getKey(r,s){return r.join(",")+s}getDashRanges(r,s,u){const m=[];let h=r.length%2==1?-r[r.length-1]*u:0,g=r[0]*u,w=!0;m.push({left:h,right:g,isDash:w,zeroLength:r[0]===0});let E=r[0];for(let I=1;I<r.length;I++){w=!w;const x=r[I];h=E*u,E+=x,g=E*u,m.push({left:h,right:g,isDash:w,zeroLength:x===0})}return m}addRoundDash(r,s,u){const m=s/2;for(let h=-u;h<=u;h++){const g=this.width*(this.nextRow+u+h);let w=0,E=r[w];for(let I=0;I<this.width;I++){I/E.right>1&&(E=r[++w]);const x=Math.abs(I-E.left),C=Math.abs(I-E.right),P=Math.min(x,C);let T;const M=h/u*(m+1);if(E.isDash){const R=m-Math.abs(M);T=Math.sqrt(P*P+R*R)}else T=m-Math.sqrt(P*P+M*M);this.image.data[g+I]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(r,s){for(let E=r.length-1;E>=0;--E){const I=r[E],x=r[E+1];I.zeroLength?r.splice(E,1):x&&x.isDash===I.isDash&&(x.left=I.left,r.splice(E,1))}const u=r[0],m=r[r.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const h=this.width*this.nextRow;let g=0,w=r[g];for(let E=0;E<this.width;E++){E/w.right>1&&(w=r[++g]);const I=Math.abs(E-w.left),x=Math.abs(E-w.right),C=Math.min(I,x);this.image.data[h+E]=Math.max(0,Math.min(255,(w.isDash?C:-C)+s+128))}}addDash(r,s){const u=this.getKey(r,s);if(this.positions[u])return this.positions[u];const m=s==="round",h=m?7:0,g=2*h+1;if(this.nextRow+g>this.height)return Gt("LineAtlas out of space"),null;r.length===0&&r.push(1);let w=0;for(let x=0;x<r.length;x++)r[x]<0&&(Gt("Negative value is found in line dasharray, replacing values with 0"),r[x]=0),w+=r[x];if(w!==0){const x=this.width/w,C=this.getDashRanges(r,this.width,x);m?this.addRoundDash(C,x,h):this.addRegularDash(C,s==="square"?.5*x:0)}const E=this.nextRow+h;this.nextRow+=g;const I={tl:[E,h],br:[w,0]};return this.positions[u]=I,I}}qt(wA,"LineAtlas");const P6=$p.VectorTileFeature.types,A6=Math.cos(Math.PI/180*37.5),I6=Math.cos(Math.PI/180*5);class J2{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new g_,this.layoutVertexArray2=new qa,this.patternVertexArray=new Dl,this.indexArray=new no,this.programConfigurations=new Fl(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new ri,this.maxLineLength=0,this.zOffsetVertexArray=new Wa,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:Lt/64}updateFootprints(r,s){}populate(r,s,u,m){this.hasPattern=B2("line",this.layers,s);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=p(u),this.hasZOffset=!this.layers[0].isDraped();const g=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&g==="none"&&Gt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&w!==void 0;const E=[];for(const{feature:P,id:T,index:M,sourceLayerIndex:R}of r){const B=this.layers[0]._featureFilter.needGeometry,U=q(P,B);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),U,u))continue;const W=h?h.evaluate(U,{},u):void 0,Z={id:T,properties:P.properties,type:P.type,sourceLayerIndex:R,index:M,geometry:B?U.geometry:V(P,u,m),patterns:{},sortKey:W};E.push(Z)}h&&E.sort((P,T)=>P.sortKey-T.sortKey);const{lineAtlas:I,featureIndex:x}=s,C=this.addConstantDashes(I);for(const P of E){const{geometry:T,index:M,sourceLayerIndex:R}=P;if(C&&this.addFeatureDashes(P,I),this.hasPattern){const B=U2("line",this.layers,P,this.zoom,s);this.patternFeatures.push(B)}else this.addFeature(P,T,M,u,I.positions,s.availableImages,s.brightness);x.insert(r[M].feature,T,M,R,this.index)}}addConstantDashes(r){let s=!1;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,h=u.layout.get("line-cap").value;if(m.kind!=="constant"||h.kind!=="constant")s=!0;else{const g=h.value,w=m.value;if(!w)continue;r.addDash(w,g)}}return s}addFeatureDashes(r,s){const u=this.zoom;for(const m of this.layers){const h=m.paint.get("line-dasharray").value,g=m.layout.get("line-cap").value;if(h.kind==="constant"&&g.kind==="constant")continue;let w,E;if(h.kind==="constant"){if(w=h.value,!w)continue}else w=h.evaluate({zoom:u},r);E=g.kind==="constant"?g.value:g.evaluate({zoom:u},r),s.addDash(w,E),r.patterns[m.id]=s.getKey(w,E)}}update(r,s,u,m,h,g,w){this.programConfigurations.updatePaintArrays(r,s,h,u,m,g,w)}addFeatures(r,s,u,m,h,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,s,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,E6)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,M6)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,w6.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,S6),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,s,u,m,h,g,w){const E=this.layers[0].layout,I=E.get("line-join").evaluate(r,{}),x=E.get("line-cap").evaluate(r,{}),C=E.get("line-miter-limit"),P=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r,this.zOffsetValue=E.get("line-z-offset").value;const T=this.layers[0].paint.get("line-width").value;T.kind!=="constant"&&T.isLineProgressConstant===!1&&(this.variableWidthValue=T);for(const M of s)this.addLine(M,r,m,I,x,C,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,w)}addLine(r,s,u,m,h,g,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E=m==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Z=0;Z<r.length-1;Z++)this.totalDistance+=r[Z].dist(r[Z+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=P6[s.type]==="Polygon";let x=r.length;for(;x>=2&&r[x-1].equals(r[x-2]);)x--;let C=0;for(;C<x-1&&r[C].equals(r[C+1]);)C++;if(x<(I?3:2))return;m==="bevel"&&(g=1.05);const P=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let T,M,R,B,U,W;this.e1=this.e2=-1,I&&(T=r[x-2],U=r[C].sub(T)._unit()._perp());for(let Z=C;Z<x;Z++){if(R=Z===x-1?I?r[C+1]:void 0:r[Z+1],R&&r[Z].equals(R))continue;U&&(B=U),T&&(M=T),T=r[Z],W=this.evaluateLineProgressFeatures(M?M.dist(T):0),U=R?R.sub(T)._unit()._perp():B,B=B||U;const H=M&&R;let K=H?m:I||E?"butt":h;const re=B.x*U.x+B.y*U.y;if(E){const Le=function(Re){if(Re.patternJoinNone){const Ne=Re.segmentPoints.length/2,Ve=Re.lineSoFar-Re.segmentStart;for(let We=0;We<Ne;++We){const Be=Re.segmentPoints[2*We+1],lt=Math.round(Re.segmentPoints[2*We])+.5+.25*Be;Re.patternVertexArray.emplaceBack(lt,Ve,Re.segmentStart),Re.patternVertexArray.emplaceBack(lt,Ve,Re.segmentStart)}Re.segmentPoints.length=0}Re.e1=Re.e2=-1};if(H&&re<I6){this.updateDistance(M,T),this.addCurrentVertex(T,B,1,1,P,W),Le(this),this.addCurrentVertex(T,U,-1,-1,P,W);continue}if(M){if(!R){this.updateDistance(M,T),this.addCurrentVertex(T,B,1,1,P,W),Le(this);continue}K="miter"}}let se=B.add(U);se.x===0&&se.y===0||se._unit();const ge=se.x*U.x+se.y*U.y,me=ge!==0?1/ge:1/0,pe=2*Math.sqrt(2-2*ge),Ee=ge<A6&&M&&R,ye=B.x*U.y-B.y*U.x>0,Pe=this.overscaling<=16?15*Lt/(512*this.overscaling):0;if(H&&K==="round"){if(me<w)K="miter";else if(me<=2){const Le=Q2(T,-10,Lt+10);K=this.hasZOffset&&(Le||this.hasCrossSlope)?"miter":"fakeround"}}if(K==="miter"&&me>g&&(K="bevel"),K==="bevel"&&(me>2&&(K="flipbevel"),me<g&&(K="miter")),M&&!(K==="miter"&&Ee)&&this.updateDistance(M,T),K==="miter")if(Ee){const Le=T.dist(M);if(Le>2*Pe){const Ne=T.sub(T.sub(M)._mult(Pe/Le)._round());this.updateDistance(M,Ne),this.addCurrentVertex(Ne,B,0,0,P,W),M=Ne}this.updateDistance(M,T),se._mult(me),this.addCurrentVertex(T,se,0,0,P,W);const Re=T.dist(R);if(Re>2*Pe){const Ne=T.add(R.sub(T)._mult(Pe/Re)._round());this.updateDistance(T,Ne),this.addCurrentVertex(Ne,U,0,0,P,W),T=Ne}}else se._mult(me),this.addCurrentVertex(T,se,0,0,P,W);else if(K==="flipbevel"){if(me>100)se=U.mult(-1);else{const Le=me*B.add(U).mag()/B.sub(U).mag();se._perp()._mult(Le*(ye?-1:1))}this.addCurrentVertex(T,se,0,0,P,W),this.addCurrentVertex(T,se.mult(-1),0,0,P,W)}else if(K==="bevel"||K==="fakeround"){W!=null&&M&&this.addCurrentVertex(T,B,-1,-1,P,W);const Le=T.dist(M)<=2*Pe&&K!=="bevel",Re=se.mult(ye?1:-1);Re._mult(me);const Ne=U.mult(ye?-1:1),Ve=B.mult(ye?-1:1),We=this.evaluateLineProgressFeatures(this.distance);if(W==null&&(this.addHalfVertex(T,Re.x,Re.y,!1,!ye,0,P,We),Le||this.addHalfVertex(T,Re.x+2*Ve.x,Re.y+2*Ve.y,!1,ye,0,P,We)),K==="fakeround"){const Be=Math.round(180*pe/Math.PI/20);this.addHalfVertex(T,Ve.x,Ve.y,!1,ye,0,P,We);for(let lt=0;lt<Be;lt++){let bt=lt/Be;if(bt!==.5){const It=bt-.5;bt+=bt*It*(bt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*It*It+(.848013+re*(.215638*re-1.06021)))}const ct=Ne.sub(Ve)._mult(bt)._add(Ve)._unit();this.addHalfVertex(T,ct.x,ct.y,!1,ye,0,P,We)}this.addHalfVertex(T,Ne.x,Ne.y,!1,ye,0,P,We)}Le||W!=null||this.addHalfVertex(T,Re.x+2*Ne.x,Re.y+2*Ne.y,!1,ye,0,P,We),W!=null&&R&&this.addCurrentVertex(T,U,1,1,P,W)}else K==="butt"?this.addCurrentVertex(T,se,0,0,P,W):K==="square"?(M||this.addCurrentVertex(T,se,-1,-1,P,W),this.addCurrentVertex(T,se,0,0,P,W),M&&this.addCurrentVertex(T,se,1,1,P,W)):K==="round"&&(M&&(this.addCurrentVertex(T,B,0,0,P,W),this.addCurrentVertex(T,B,1,1,P,W,!0)),R&&(this.addCurrentVertex(T,U,-1,-1,P,W,!0),this.addCurrentVertex(T,U,0,0,P,W)))}}addVerticesTo(r,s,u,m,h,g,w,E,I,x){const C=(s.w-r.w)/this.tessellationStep|0;let P=0;const T=this.scaledDistance;if(C>1){this.lineSoFar=r.w;const R=(s.x-r.x)/C,B=(s.y-r.y)/C,U=(s.z-r.z)/C,W=(s.w-r.w)/C;for(let Z=1;Z<C;++Z){r.x+=R,r.y+=B,r.z+=U,this.lineSoFar+=W,P+=W;const H=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(r,u,m,x,!1,w,I,H),this.addHalfVertex(r,h,g,x,!0,-E,I,H)}}this.lineSoFar=s.w,this.scaledDistance=T;const M=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,m,x,!1,w,I,M),this.addHalfVertex(s,h,g,x,!0,-E,I,M)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):Gt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}:{zOffset:0,variableWidth:s}}addCurrentVertex(r,s,u,m,h,g,w=!1){const E=s.x+s.y*u,I=s.y-s.x*u,x=s.y*m-s.x,C=-s.y-s.x*m;if(g!=null){const P=this.hasZOffset,T=-10,M=Lt+10,R=g.zOffset,B=new ZP(r.x,r.y,R,this.lineSoFar),U=!!P&&Q2(r,T,M),W=this.lineSoFar,Z=this.distance;if(this.currentVertex)if(U){const H=this.currentVertexIsOutside,K=this.currentVertex,re=new ZP(r.x,r.y,R,this.lineSoFar);if(XP(K,re,T,M),!Q2(re,T,M)){if(H){this.e1=this.e2=-1,this.distance-=K.dist(B),this.lineSoFar=K.w;const se=this.evaluateLineProgressFeatures(K.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(K,E,I,w,!1,u,h,se),this.addHalfVertex(K,x,C,w,!0,-m,h,se),this.prevDistance=this.distance}this.distance=this.prevDistance+K.dist(re),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(K,re,E,I,x,C,u,m,h,w),this.distance=Z,this.scaledDistance=this.distance/this.totalDistance}}else{const H=this.currentVertex;if(this.currentVertexIsOutside){XP(H,B,T,M),this.e1=this.e2=-1,this.distance-=H.dist(B),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=H.w;const K=this.evaluateLineProgressFeatures(H.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(H,E,I,w,!1,u,h,K),this.addHalfVertex(H,x,C,w,!0,-m,h,K),this.prevDistance=this.distance,this.distance=Z,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(H,B,E,I,x,C,u,m,h,w)}else U||(this.addHalfVertex(r,E,I,w,!1,u,h,g),this.addHalfVertex(r,x,C,w,!0,-m,h,g));this.currentVertex=B,this.currentVertexIsOutside=U,this.lineSoFar=W}else this.addHalfVertex(r,E,I,w,!1,u,h,g),this.addHalfVertex(r,x,C,w,!0,-m,h,g)}addHalfVertex({x:r,y:s},u,m,h,g,w,E,I){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((r<<1)+(h?1:0),(s<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),E.primitiveLength++),g?this.e2=x:this.e1=x,I!=null&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,s){this.prevDistance=this.distance,this.distance+=r.dist(s),this.updateScaledDistance()}}function Q2(c,r,s){return c.x<r||c.x>s||c.y<r||c.y>s}let SA,TA;function EA(c,r,s){return r*(Lt/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}qt(J2,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const CA=(c,r,s)=>(1-s)*c+s*r;function MA(c,r){return 1/EA(c,1,r.tileZoom)}function PA(c,r,s,u){return c.translatePosMatrix(u||r.tileID.projMatrix,r,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const AA=c=>{const r=[];IA(c)&&r.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const s=c.paint.get("line-trim-offset");s[0]===0&&s[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=c.layout.get("line-join").constantOr("miter")==="none",m=!!c.paint.get("line-pattern").constantOr(1);return u&&m&&r.push("LINE_JOIN_NONE"),r};function IA(c){const r=c.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}let eS;const kA=()=>eS||(eS={layout:SA||(SA=new ti({"line-cap":new Ut(Ke.layout_line["line-cap"]),"line-join":new Ut(Ke.layout_line["line-join"]),"line-miter-limit":new Mt(Ke.layout_line["line-miter-limit"]),"line-round-limit":new Mt(Ke.layout_line["line-round-limit"]),"line-sort-key":new Ut(Ke.layout_line["line-sort-key"]),"line-z-offset":new Ut(Ke.layout_line["line-z-offset"]),"line-elevation-reference":new Mt(Ke.layout_line["line-elevation-reference"]),"line-cross-slope":new Mt(Ke.layout_line["line-cross-slope"]),visibility:new Mt(Ke.layout_line.visibility),"line-width-unit":new Mt(Ke.layout_line["line-width-unit"])})),paint:TA||(TA=new ti({"line-opacity":new Ut(Ke.paint_line["line-opacity"]),"line-color":new Ut(Ke.paint_line["line-color"]),"line-translate":new Mt(Ke.paint_line["line-translate"]),"line-translate-anchor":new Mt(Ke.paint_line["line-translate-anchor"]),"line-width":new Ut(Ke.paint_line["line-width"]),"line-gap-width":new Ut(Ke.paint_line["line-gap-width"]),"line-offset":new Ut(Ke.paint_line["line-offset"]),"line-blur":new Ut(Ke.paint_line["line-blur"]),"line-dasharray":new Ut(Ke.paint_line["line-dasharray"]),"line-pattern":new Ut(Ke.paint_line["line-pattern"]),"line-gradient":new Iu(Ke.paint_line["line-gradient"]),"line-trim-offset":new Mt(Ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new Mt(Ke.paint_line["line-trim-fade-range"]),"line-trim-color":new Mt(Ke.paint_line["line-trim-color"]),"line-emissive-strength":new Mt(Ke.paint_line["line-emissive-strength"]),"line-border-width":new Ut(Ke.paint_line["line-border-width"]),"line-border-color":new Ut(Ke.paint_line["line-border-color"]),"line-occlusion-opacity":new Mt(Ke.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},eS);class k6 extends Ut{possiblyEvaluate(r,s){return s=new Gn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(r,s)}evaluate(r,s,u,m){return s=Xn({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(r,s,u,m)}}let W_;function RA(c,r){return r>0?r+2*c:c}const R6=Qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),D6=Qr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),L6=Qr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const O6=Qr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),z6=Qr([{name:"a_texb",components:2,type:"Uint16"}]),N6=Qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),F6=Qr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const DA=Qr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),j6=Qr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qr([{name:"triangle",components:3,type:"Uint16"}]),Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Qr([{type:"Float32",name:"offsetX"}]),Qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var go=24;const Ja=128;function Cx(c,r,s,u,m){if(c.kind==="camera")return c.maxSize;if(c.kind==="composite"){const h=r.possiblyEvaluate(new Gn(c.maxZoom),s).evaluate(m,{},s),g=r.possiblyEvaluate(new Gn(c.minZoom),s).evaluate(m,{},s);return Math.max(h,g)}return r.possiblyEvaluate(new Gn(u)).evaluate(m,{},s)}function tS(c,r){const{expression:s}=r;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Gn(c+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:m}=s;let h=0;for(;h<u.length&&u[h]<=c;)h++;h=Math.max(0,h-1);let g=h;for(;g<u.length&&u[g]<c+1;)g++;g=Math.min(u.length-1,g);const w=u[h],E=u[g];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:m}:{kind:"camera",minZoom:w,maxZoom:E,minSize:s.evaluate(new Gn(w)),maxSize:s.evaluate(new Gn(E)),interpolationType:m}}}function Mx(c,{uSize:r,uSizeT:s},{lowerSize:u,upperSize:m}){return c.kind==="source"?u/Ja:c.kind==="composite"?pr(u/Ja,m/Ja,s):r}function Gp(c,r,s=1){let u=0,m=0;if(c.kind==="constant")m=c.layoutSize*s;else if(c.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:w}=c,E=h?Ot(Zo.interpolationFactor(h,r,g,w),0,1):0;c.kind==="camera"?m=pr(c.minSize,c.maxSize,E)*s:u=E*s}return{uSizeT:u,uSize:m}}var B6=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ja,evaluateSizeForFeature:Mx,evaluateSizeForZoom:Gp,getRasterizedIconSize:Cx,getSizeData:tS});function U6(c,r,s){return c.sections.forEach(u=>{u.text=function(m,h,g){const w=h.layout.get("text-transform").evaluate(g,{});return w==="uppercase"?m=m.toLocaleUpperCase():w==="lowercase"&&(m=m.toLocaleLowerCase()),Xo.applyArabicShaping&&(m=Xo.applyArabicShaping(m)),m}(u.text,r,s)}),c}const Z_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function V6(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}function $6(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}var LA,rS,OA,nS={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function G6(){return LA||(LA=1,nS.read=function(c,r,s,u,m){var h,g,w=8*m-u-1,E=(1<<w)-1,I=E>>1,x=-7,C=s?m-1:0,P=s?-1:1,T=c[r+C];for(C+=P,h=T&(1<<-x)-1,T>>=-x,x+=w;x>0;h=256*h+c[r+C],C+=P,x-=8);for(g=h&(1<<-x)-1,h>>=-x,x+=u;x>0;g=256*g+c[r+C],C+=P,x-=8);if(h===0)h=1-I;else{if(h===E)return g?NaN:1/0*(T?-1:1);g+=Math.pow(2,u),h-=I}return(T?-1:1)*g*Math.pow(2,h-u)},nS.write=function(c,r,s,u,m,h){var g,w,E,I=8*h-m-1,x=(1<<I)-1,C=x>>1,P=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=u?0:h-1,M=u?1:-1,R=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(w=isNaN(r)?1:0,g=x):(g=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-g))<1&&(g--,E*=2),(r+=g+C>=1?P/E:P*Math.pow(2,1-C))*E>=2&&(g++,E/=2),g+C>=x?(w=0,g=x):g+C>=1?(w=(r*E-1)*Math.pow(2,m),g+=C):(w=r*Math.pow(2,C-1)*Math.pow(2,m),g=0));m>=8;c[s+T]=255&w,T+=M,w/=256,m-=8);for(g=g<<m|w,I+=m;I>0;c[s+T]=255&g,T+=M,g/=256,I-=8);c[s+T-M]|=128*R}),nS}function zA(){if(OA)return rS;OA=1,rS=r;var c=G6();function r(H){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(H)?H:new Uint8Array(H||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var s=4294967296,u=1/s,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(H){return H.type===r.Bytes?H.readVarint()+H.pos:H.pos+1}function g(H,K,re){return re?4294967296*K+(H>>>0):4294967296*(K>>>0)+(H>>>0)}function w(H,K,re){var se=K<=16383?1:K<=2097151?2:K<=268435455?3:Math.floor(Math.log(K)/(7*Math.LN2));re.realloc(se);for(var ge=re.pos-1;ge>=H;ge--)re.buf[ge+se]=re.buf[ge]}function E(H,K){for(var re=0;re<H.length;re++)K.writeVarint(H[re])}function I(H,K){for(var re=0;re<H.length;re++)K.writeSVarint(H[re])}function x(H,K){for(var re=0;re<H.length;re++)K.writeFloat(H[re])}function C(H,K){for(var re=0;re<H.length;re++)K.writeDouble(H[re])}function P(H,K){for(var re=0;re<H.length;re++)K.writeBoolean(H[re])}function T(H,K){for(var re=0;re<H.length;re++)K.writeFixed32(H[re])}function M(H,K){for(var re=0;re<H.length;re++)K.writeSFixed32(H[re])}function R(H,K){for(var re=0;re<H.length;re++)K.writeFixed64(H[re])}function B(H,K){for(var re=0;re<H.length;re++)K.writeSFixed64(H[re])}function U(H,K){return(H[K]|H[K+1]<<8|H[K+2]<<16)+16777216*H[K+3]}function W(H,K,re){H[re]=K,H[re+1]=K>>>8,H[re+2]=K>>>16,H[re+3]=K>>>24}function Z(H,K){return(H[K]|H[K+1]<<8|H[K+2]<<16)+(H[K+3]<<24)}return r.prototype={destroy:function(){this.buf=null},readFields:function(H,K,re){for(re=re||this.length;this.pos<re;){var se=this.readVarint(),ge=se>>3,me=this.pos;this.type=7&se,H(ge,K,this),this.pos===me&&this.skip(se)}return K},readMessage:function(H,K){return this.readFields(H,K,this.readVarint()+this.pos)},readFixed32:function(){var H=U(this.buf,this.pos);return this.pos+=4,H},readSFixed32:function(){var H=Z(this.buf,this.pos);return this.pos+=4,H},readFixed64:function(){var H=U(this.buf,this.pos)+U(this.buf,this.pos+4)*s;return this.pos+=8,H},readSFixed64:function(){var H=U(this.buf,this.pos)+Z(this.buf,this.pos+4)*s;return this.pos+=8,H},readFloat:function(){var H=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,H},readDouble:function(){var H=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,H},readVarint:function(H){var K,re,se=this.buf;return K=127&(re=se[this.pos++]),re<128?K:(K|=(127&(re=se[this.pos++]))<<7,re<128?K:(K|=(127&(re=se[this.pos++]))<<14,re<128?K:(K|=(127&(re=se[this.pos++]))<<21,re<128?K:function(ge,me,pe){var Ee,ye,Pe=pe.buf;if(Ee=(112&(ye=Pe[pe.pos++]))>>4,ye<128||(Ee|=(127&(ye=Pe[pe.pos++]))<<3,ye<128)||(Ee|=(127&(ye=Pe[pe.pos++]))<<10,ye<128)||(Ee|=(127&(ye=Pe[pe.pos++]))<<17,ye<128)||(Ee|=(127&(ye=Pe[pe.pos++]))<<24,ye<128)||(Ee|=(1&(ye=Pe[pe.pos++]))<<31,ye<128))return g(ge,Ee,me);throw new Error("Expected varint not more than 10 bytes")}(K|=(15&(re=se[this.pos]))<<28,H,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var H=this.readVarint();return H%2==1?(H+1)/-2:H/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var H=this.readVarint()+this.pos,K=this.pos;return this.pos=H,H-K>=12&&m?function(re,se,ge){return m.decode(re.subarray(se,ge))}(this.buf,K,H):function(re,se,ge){for(var me="",pe=se;pe<ge;){var Ee,ye,Pe,Le=re[pe],Re=null,Ne=Le>239?4:Le>223?3:Le>191?2:1;if(pe+Ne>ge)break;Ne===1?Le<128&&(Re=Le):Ne===2?(192&(Ee=re[pe+1]))==128&&(Re=(31&Le)<<6|63&Ee)<=127&&(Re=null):Ne===3?(ye=re[pe+2],(192&(Ee=re[pe+1]))==128&&(192&ye)==128&&((Re=(15&Le)<<12|(63&Ee)<<6|63&ye)<=2047||Re>=55296&&Re<=57343)&&(Re=null)):Ne===4&&(ye=re[pe+2],Pe=re[pe+3],(192&(Ee=re[pe+1]))==128&&(192&ye)==128&&(192&Pe)==128&&((Re=(15&Le)<<18|(63&Ee)<<12|(63&ye)<<6|63&Pe)<=65535||Re>=1114112)&&(Re=null)),Re===null?(Re=65533,Ne=1):Re>65535&&(Re-=65536,me+=String.fromCharCode(Re>>>10&1023|55296),Re=56320|1023&Re),me+=String.fromCharCode(Re),pe+=Ne}return me}(this.buf,K,H)},readBytes:function(){var H=this.readVarint()+this.pos,K=this.buf.subarray(this.pos,H);return this.pos=H,K},readPackedVarint:function(H,K){if(this.type!==r.Bytes)return H.push(this.readVarint(K));var re=h(this);for(H=H||[];this.pos<re;)H.push(this.readVarint(K));return H},readPackedSVarint:function(H){if(this.type!==r.Bytes)return H.push(this.readSVarint());var K=h(this);for(H=H||[];this.pos<K;)H.push(this.readSVarint());return H},readPackedBoolean:function(H){if(this.type!==r.Bytes)return H.push(this.readBoolean());var K=h(this);for(H=H||[];this.pos<K;)H.push(this.readBoolean());return H},readPackedFloat:function(H){if(this.type!==r.Bytes)return H.push(this.readFloat());var K=h(this);for(H=H||[];this.pos<K;)H.push(this.readFloat());return H},readPackedDouble:function(H){if(this.type!==r.Bytes)return H.push(this.readDouble());var K=h(this);for(H=H||[];this.pos<K;)H.push(this.readDouble());return H},readPackedFixed32:function(H){if(this.type!==r.Bytes)return H.push(this.readFixed32());var K=h(this);for(H=H||[];this.pos<K;)H.push(this.readFixed32());return H},readPackedSFixed32:function(H){if(this.type!==r.Bytes)return H.push(this.readSFixed32());var K=h(this);for(H=H||[];this.pos<K;)H.push(this.readSFixed32());return H},readPackedFixed64:function(H){if(this.type!==r.Bytes)return H.push(this.readFixed64());var K=h(this);for(H=H||[];this.pos<K;)H.push(this.readFixed64());return H},readPackedSFixed64:function(H){if(this.type!==r.Bytes)return H.push(this.readSFixed64());var K=h(this);for(H=H||[];this.pos<K;)H.push(this.readSFixed64());return H},skip:function(H){var K=7&H;if(K===r.Varint)for(;this.buf[this.pos++]>127;);else if(K===r.Bytes)this.pos=this.readVarint()+this.pos;else if(K===r.Fixed32)this.pos+=4;else{if(K!==r.Fixed64)throw new Error("Unimplemented type: "+K);this.pos+=8}},writeTag:function(H,K){this.writeVarint(H<<3|K)},realloc:function(H){for(var K=this.length||16;K<this.pos+H;)K*=2;if(K!==this.length){var re=new Uint8Array(K);re.set(this.buf),this.buf=re,this.length=K}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(H){this.realloc(4),W(this.buf,H,this.pos),this.pos+=4},writeSFixed32:function(H){this.realloc(4),W(this.buf,H,this.pos),this.pos+=4},writeFixed64:function(H){this.realloc(8),W(this.buf,-1&H,this.pos),W(this.buf,Math.floor(H*u),this.pos+4),this.pos+=8},writeSFixed64:function(H){this.realloc(8),W(this.buf,-1&H,this.pos),W(this.buf,Math.floor(H*u),this.pos+4),this.pos+=8},writeVarint:function(H){(H=+H||0)>268435455||H<0?function(K,re){var se,ge;if(K>=0?(se=K%4294967296|0,ge=K/4294967296|0):(ge=~(-K/4294967296),4294967295^(se=~(-K%4294967296))?se=se+1|0:(se=0,ge=ge+1|0)),K>=18446744073709552e3||K<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");re.realloc(10),function(me,pe,Ee){Ee.buf[Ee.pos++]=127&me|128,me>>>=7,Ee.buf[Ee.pos++]=127&me|128,me>>>=7,Ee.buf[Ee.pos++]=127&me|128,me>>>=7,Ee.buf[Ee.pos++]=127&me|128,Ee.buf[Ee.pos]=127&(me>>>=7)}(se,0,re),function(me,pe){var Ee=(7&me)<<4;pe.buf[pe.pos++]|=Ee|((me>>>=3)?128:0),me&&(pe.buf[pe.pos++]=127&me|((me>>>=7)?128:0),me&&(pe.buf[pe.pos++]=127&me|((me>>>=7)?128:0),me&&(pe.buf[pe.pos++]=127&me|((me>>>=7)?128:0),me&&(pe.buf[pe.pos++]=127&me|((me>>>=7)?128:0),me&&(pe.buf[pe.pos++]=127&me)))))}(ge,re)}(H,this):(this.realloc(4),this.buf[this.pos++]=127&H|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=H>>>7&127))))},writeSVarint:function(H){this.writeVarint(H<0?2*-H-1:2*H)},writeBoolean:function(H){this.writeVarint(!!H)},writeString:function(H){H=String(H),this.realloc(4*H.length),this.pos++;var K=this.pos;this.pos=function(se,ge,me){for(var pe,Ee,ye=0;ye<ge.length;ye++){if((pe=ge.charCodeAt(ye))>55295&&pe<57344){if(!Ee){pe>56319||ye+1===ge.length?(se[me++]=239,se[me++]=191,se[me++]=189):Ee=pe;continue}if(pe<56320){se[me++]=239,se[me++]=191,se[me++]=189,Ee=pe;continue}pe=Ee-55296<<10|pe-56320|65536,Ee=null}else Ee&&(se[me++]=239,se[me++]=191,se[me++]=189,Ee=null);pe<128?se[me++]=pe:(pe<2048?se[me++]=pe>>6|192:(pe<65536?se[me++]=pe>>12|224:(se[me++]=pe>>18|240,se[me++]=pe>>12&63|128),se[me++]=pe>>6&63|128),se[me++]=63&pe|128)}return me}(this.buf,H,this.pos);var re=this.pos-K;re>=128&&w(K,re,this),this.pos=K-1,this.writeVarint(re),this.pos+=re},writeFloat:function(H){this.realloc(4),c.write(this.buf,H,this.pos,!0,23,4),this.pos+=4},writeDouble:function(H){this.realloc(8),c.write(this.buf,H,this.pos,!0,52,8),this.pos+=8},writeBytes:function(H){var K=H.length;this.writeVarint(K),this.realloc(K);for(var re=0;re<K;re++)this.buf[this.pos++]=H[re]},writeRawMessage:function(H,K){this.pos++;var re=this.pos;H(K,this);var se=this.pos-re;se>=128&&w(re,se,this),this.pos=re-1,this.writeVarint(se),this.pos+=se},writeMessage:function(H,K,re){this.writeTag(H,r.Bytes),this.writeRawMessage(K,re)},writePackedVarint:function(H,K){K.length&&this.writeMessage(H,E,K)},writePackedSVarint:function(H,K){K.length&&this.writeMessage(H,I,K)},writePackedBoolean:function(H,K){K.length&&this.writeMessage(H,P,K)},writePackedFloat:function(H,K){K.length&&this.writeMessage(H,x,K)},writePackedDouble:function(H,K){K.length&&this.writeMessage(H,C,K)},writePackedFixed32:function(H,K){K.length&&this.writeMessage(H,T,K)},writePackedSFixed32:function(H,K){K.length&&this.writeMessage(H,M,K)},writePackedFixed64:function(H,K){K.length&&this.writeMessage(H,R,K)},writePackedSFixed64:function(H,K){K.length&&this.writeMessage(H,B,K)},writeBytesField:function(H,K){this.writeTag(H,r.Bytes),this.writeBytes(K)},writeFixed32Field:function(H,K){this.writeTag(H,r.Fixed32),this.writeFixed32(K)},writeSFixed32Field:function(H,K){this.writeTag(H,r.Fixed32),this.writeSFixed32(K)},writeFixed64Field:function(H,K){this.writeTag(H,r.Fixed64),this.writeFixed64(K)},writeSFixed64Field:function(H,K){this.writeTag(H,r.Fixed64),this.writeSFixed64(K)},writeVarintField:function(H,K){this.writeTag(H,r.Varint),this.writeVarint(K)},writeSVarintField:function(H,K){this.writeTag(H,r.Varint),this.writeSVarint(K)},writeStringField:function(H,K){this.writeTag(H,r.Bytes),this.writeString(K)},writeFloatField:function(H,K){this.writeTag(H,r.Fixed32),this.writeFloat(K)},writeDoubleField:function(H,K){this.writeTag(H,r.Fixed64),this.writeDouble(K)},writeBooleanField:function(H,K){this.writeVarintField(H,!!K)}},rS}var Px=k(zA());const iS=3;function H6(c,r,s){r.glyphs=[],c===1&&s.readMessage(q6,r)}function q6(c,r,s){if(c===3){const{id:u,bitmap:m,width:h,height:g,left:w,top:E,advance:I}=s.readMessage(W6,{});r.glyphs.push({id:u,bitmap:new Bu({width:h+2*iS,height:g+2*iS},m),metrics:{width:h,height:g,left:w,top:E,advance:I}})}else c===4?r.ascender=s.readSVarint():c===5&&(r.descender=s.readSVarint())}function W6(c,r,s){c===1?r.id=s.readVarint():c===2?r.bitmap=s.readBytes():c===3?r.width=s.readVarint():c===4?r.height=s.readVarint():c===5?r.left=s.readSVarint():c===6?r.top=s.readSVarint():c===7&&(r.advance=s.readVarint())}const NA=iS,ea={horizontal:1,vertical:2,horizontalOnly:3};class Y_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,s){const u=new Y_;return u.scale=r||1,u.fontStack=s,u}static forImage(r){const s=new Y_;return s.image=r,s}}class Hp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s){const u=new Hp;for(let m=0;m<r.sections.length;m++){const h=r.sections[m];h.image?u.addImageSection(h):u.addTextSection(h,s)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(s,u){let m="";for(let h=0;h<s.length;h++){const g=s.charCodeAt(h+1)||null,w=s.charCodeAt(h-1)||null;m+=!u&&(g&&xp(g)&&!Z_[s[h+1]]||w&&xp(w)&&!Z_[s[h-1]])||!Z_[s[h]]?s[h]:Z_[s[h]]}return m}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&Ax[this.text.charCodeAt(u)];u++)r++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&Ax[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const u=new Hp;return u.text=this.text.substring(r,s),u.sectionIndex=this.sectionIndex.slice(r,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}addTextSection(r,s){this.text+=r.text,this.sections.push(Y_.forText(r.scale,r.fontStack||s));const u=this.sections.length-1;for(let m=0;m<r.text.length;++m)this.sectionIndex.push(u)}addImageSection(r){const s=r.image&&r.image.namePrimary?r.image.getPrimary():null;if(!s)return void Gt("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(Y_.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function oS(c,r,s,u,m,h,g,w,E,I,x,C,P,T,M){const R=Hp.fromFeature(c,m);C===ea.vertical&&R.verticalizePunctuation(P);let B=[];const U=function(re,se,ge,me,pe,Ee){if(!re)return[];const ye=[],Pe=function(Ve,We,Be,lt,bt,ct){let It=0;for(let At=0;At<Ve.length();At++){const Nt=Ve.getSection(At);It+=FA(Ve.getCodePoint(At),Nt,lt,bt,We,ct)}return It/Math.max(1,Math.ceil(It/Be))}(re,se,ge,me,pe,Ee),Le=re.text.indexOf("")>=0;let Re=0;for(let Ve=0;Ve<re.length();Ve++){const We=re.getSection(Ve),Be=re.getCodePoint(Ve);if(Ax[Be]||(Re+=FA(Be,We,me,pe,se,Ee)),Ve<re.length()-1){const lt=!((Ne=Be)<11904||!(nr["Bopomofo Extended"](Ne)||nr.Bopomofo(Ne)||nr["CJK Compatibility Forms"](Ne)||nr["CJK Compatibility Ideographs"](Ne)||nr["CJK Compatibility"](Ne)||nr["CJK Radicals Supplement"](Ne)||nr["CJK Strokes"](Ne)||nr["CJK Symbols and Punctuation"](Ne)||nr["CJK Unified Ideographs Extension A"](Ne)||nr["CJK Unified Ideographs"](Ne)||nr["Enclosed CJK Letters and Months"](Ne)||nr["Halfwidth and Fullwidth Forms"](Ne)||nr.Hiragana(Ne)||nr["Ideographic Description Characters"](Ne)||nr["Kangxi Radicals"](Ne)||nr["Katakana Phonetic Extensions"](Ne)||nr.Katakana(Ne)||nr["Vertical Forms"](Ne)||nr["Yi Radicals"](Ne)||nr["Yi Syllables"](Ne)));(Z6[Be]||lt||We.image)&&ye.push(BA(Ve+1,Re,Pe,ye,Y6(Be,re.getCodePoint(Ve+1),lt&&Le),!1))}}var Ne;return UA(BA(re.length(),Re,Pe,ye,0,!0))}(R,I,h,r,u,T),{processBidirectionalText:W,processStyledBidirectionalText:Z}=Xo;if(W&&R.sections.length===1){const re=W(R.toString(),U);for(const se of re){const ge=new Hp;ge.text=se,ge.sections=R.sections;for(let me=0;me<se.length;me++)ge.sectionIndex.push(0);B.push(ge)}}else if(Z){const re=Z(R.text,R.sectionIndex,U);for(const se of re){const ge=new Hp;ge.text=se[0],ge.sectionIndex=se[1],ge.sections=R.sections,B.push(ge)}}else B=function(re,se){const ge=[],me=re.text;let pe=0;for(const Ee of se)ge.push(re.substring(pe,Ee)),pe=Ee;return pe<me.length&&ge.push(re.substring(pe,me.length)),ge}(R,U);const H=[],K={positionedLines:H,text:R.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(re,se,ge,me,pe,Ee,ye,Pe,Le,Re,Ne,Ve){let We=0,Be=0,lt=0;const bt=Pe==="right"?1:Pe==="left"?0:.5;let ct=!1;for(const kt of pe){const Zt=kt.getSections();for(const ur of Zt){if(ur.image)continue;const Pr=se[ur.fontStack];if(Pr&&(ct=Pr.ascender!==void 0&&Pr.descender!==void 0,!ct))break}if(!ct)break}let It=0;for(const kt of pe){kt.trim();const Zt=kt.getMaxScale(),ur=(Zt-1)*go,Pr={positionedGlyphs:[],lineOffset:0};re.positionedLines[It]=Pr;const Ir=Pr.positionedGlyphs;let zr=0;if(!kt.length()){Be+=Ee,++It;continue}let kr=0,jr=0;for(let vn=0;vn<kt.length();vn++){const br=kt.getSection(vn),xn=kt.getSectionIndex(vn),pn=kt.getCodePoint(vn);let Cn=br.scale,bi=null,wi=null,di=null,es=go,qn=0;const Yn=!(Le===ea.horizontal||!Ne&&!vp(pn)||Ne&&(Ax[pn]||(At=pn,nr.Arabic(At)||nr["Arabic Supplement"](At)||nr["Arabic Extended-A"](At)||nr["Arabic Presentation Forms-A"](At)||nr["Arabic Presentation Forms-B"](At))));if(br.image){const jo=me[br.image.serialize()];if(!jo)continue;di=br.image.id,re.iconsInText=re.iconsInText||!0,wi=jo.paddedRect;const Si=jo.displaySize;Cn=Cn*go/Ve,bi={width:Si[0],height:Si[1],left:0,top:-NA,advance:Yn?Si[1]:Si[0],localGlyph:!1},qn=ct?-bi.height*Cn:Zt*go-17-Si[1]*Cn,es=bi.advance;const us=(Yn?Si[0]:Si[1])*Cn-go*Zt;us>0&&us>zr&&(zr=us)}else{const jo=ge[br.fontStack];if(!jo)continue;jo[pn]&&(wi=jo[pn]);const Si=se[br.fontStack];if(!Si)continue;const us=Si.glyphs[pn];if(!us)continue;if(bi=us.metrics,es=pn!==8203?go:0,ct){const Li=Si.ascender!==void 0?Math.abs(Si.ascender):0,Vl=Si.descender!==void 0?Math.abs(Si.descender):0,Wu=(Li+Vl)*Cn;kr<Wu&&(kr=Wu,jr=(Li-Vl)/2*Cn),qn=-Li*Cn}else qn=(Zt-Cn)*go-17}Yn?(re.verticalizable=!0,Ir.push({glyph:pn,imageName:di,x:We,y:Be+qn,vertical:Yn,scale:Cn,localGlyph:bi.localGlyph,fontStack:br.fontStack,sectionIndex:xn,metrics:bi,rect:wi}),We+=es*Cn+Re):(Ir.push({glyph:pn,imageName:di,x:We,y:Be+qn,vertical:Yn,scale:Cn,localGlyph:bi.localGlyph,fontStack:br.fontStack,sectionIndex:xn,metrics:bi,rect:wi}),We+=bi.advance*Cn+Re)}Ir.length!==0&&(lt=Math.max(We-Re,lt),ct?VA(Ir,bt,zr,jr,Ee*Zt/2):VA(Ir,bt,zr,0,Ee/2)),We=0;const En=Ee*Zt+zr;Pr.lineOffset=Math.max(zr,ur),Be+=En,++It}var At;const Nt=Be,{horizontalAlign:pt,verticalAlign:Jt}=sS(ye);(function(kt,Zt,ur,Pr,Ir,zr){const kr=(Zt-ur)*Ir,jr=-zr*Pr;for(const En of kt)for(const vn of En.positionedGlyphs)vn.x+=kr,vn.y+=jr})(re.positionedLines,bt,pt,Jt,lt,Nt),re.top+=-Jt*Nt,re.bottom=re.top+Nt,re.left+=-pt*lt,re.right=re.left+lt,re.hasBaseline=ct}(K,r,s,u,B,g,w,E,C,I,P,M),!function(re){for(const se of re)if(se.positionedGlyphs.length!==0)return!1;return!0}(H)&&K}const Ax={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Z6={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function FA(c,r,s,u,m,h){if(r.image){const g=u[r.image.serialize()];return g?g.displaySize[0]*r.scale*go/h+m:0}{const g=s[r.fontStack],w=g&&g.glyphs[c];return w?w.metrics.advance*r.scale+m:0}}function jA(c,r,s,u){const m=Math.pow(c-r,2);return u?c<r?m/2:2*m:m+Math.abs(s)*s}function Y6(c,r,s){let u=0;return c===10&&(u-=1e4),s&&(u+=150),c!==40&&c!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function BA(c,r,s,u,m,h){let g=null,w=jA(r,s,m,h);for(const E of u){const I=jA(r-E.x,s,m,h)+E.badness;I<=w&&(g=E,w=I)}return{index:c,x:r,priorBreak:g,badness:w}}function UA(c){return c?UA(c.priorBreak).concat(c.index):[]}function sS(c){let r=.5,s=.5;switch(c){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function VA(c,r,s,u,m){if(!(r||s||u||m))return;const h=c.length-1,g=c[h],w=(g.x+g.metrics.advance*g.scale)*r;for(let E=0;E<=h;E++)c[E].x-=w,c[E].y+=s+u+m}function X6(c,r,s,u){const{horizontalAlign:m,verticalAlign:h}=sS(u),g=s[0]-c.displaySize[0]*m,w=s[1]-c.displaySize[1]*h;return{imagePrimary:c,imageSecondary:r,top:w,bottom:w+c.displaySize[1],left:g,right:g+c.displaySize[0]}}function $A(c,r,s,u,m,h){const g=c.imagePrimary;let w;if(g.content){const B=g.content,U=g.pixelRatio||1;w=[B[0]/U,B[1]/U,g.displaySize[0]-B[2]/U,g.displaySize[1]-B[3]/U]}const E=r.left*h,I=r.right*h;let x,C,P,T;s==="width"||s==="both"?(T=m[0]+E-u[3],C=m[0]+I+u[1]):(T=m[0]+(E+I-g.displaySize[0])/2,C=T+g.displaySize[0]);const M=r.top*h,R=r.bottom*h;return s==="height"||s==="both"?(x=m[1]+M-u[0],P=m[1]+R+u[2]):(x=m[1]+(M+R-g.displaySize[1])/2,P=x+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:x,right:C,bottom:P,left:T,collisionPadding:w}}class Rc extends vt{constructor(r,s,u,m,h){super(r,s),this.angle=m,this.z=u,h!==void 0&&(this.segment=h)}clone(){return new Rc(this.x,this.y,this.z,this.angle,this.segment)}}function GA(c,r,s,u,m){if(r.segment===void 0)return!0;let h=r,g=r.segment+1,w=0;for(;w>-s/2;){if(g--,g<0)return!1;w-=c[g].dist(h),h=c[g]}w+=c[g].dist(c[g+1]),g++;const E=[];let I=0;for(;w<s/2;){const x=c[g],C=c[g+1];if(!C)return!1;let P=c[g-1].angleTo(x)-x.angleTo(C);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:P}),I+=P;w-E[0].distance>u;)I-=E.shift().angleDelta;if(I>m)return!1;g++,w+=x.dist(C)}return!0}function HA(c){let r=0;for(let s=0;s<c.length-1;s++)r+=c[s].dist(c[s+1]);return r}function qA(c,r,s){return c?.6*r*s:0}function WA(c,r){return Math.max(c?c.right-c.left:0,r?r.right-r.left:0)}function K6(c,r,s,u,m,h){const g=qA(s,m,h),w=WA(s,u)*h;let E=0;const I=HA(c)/2;for(let x=0;x<c.length-1;x++){const C=c[x],P=c[x+1],T=C.dist(P);if(E+T>I){const M=(I-E)/T,R=pr(C.x,P.x,M),B=pr(C.y,P.y,M),U=new Rc(R,B,0,P.angleTo(C),x);return!g||GA(c,U,w,g,r)?U:void 0}E+=T}}function J6(c,r,s,u,m,h,g,w,E){const I=qA(u,h,g),x=WA(u,m),C=x*g,P=c[0].x===0||c[0].x===E||c[0].y===0||c[0].y===E;return r-C<r/4&&(r=C+r/4),ZA(c,P?r/2*w%r:(x/2+2*h)*g*w%r,r,I,s,C,P,!1,E)}function ZA(c,r,s,u,m,h,g,w,E){const I=h/2,x=HA(c);let C=0,P=r-s,T=[];for(let M=0;M<c.length-1;M++){const R=c[M],B=c[M+1],U=R.dist(B),W=B.angleTo(R);for(;P+s<C+U;){P+=s;const Z=(P-C)/U,H=pr(R.x,B.x,Z),K=pr(R.y,B.y,Z);if(H>=0&&H<E&&K>=0&&K<E&&P-I>=0&&P+I<=x){const re=new Rc(H,K,0,W,M);u&&!GA(c,re,h,u,m)||T.push(re)}}C+=U}return w||T.length||g||(T=ZA(c,C/2,s,u,m,h,g,!0,E)),T}function YA(c,r,s,u,m){const h=[];for(let g=0;g<c.length;g++){const w=c[g];let E;for(let I=0;I<w.length-1;I++){let x=w[I],C=w[I+1];x.x<r&&C.x<r||(x.x<r?x=new vt(r,x.y+(r-x.x)/(C.x-x.x)*(C.y-x.y))._round():C.x<r&&(C=new vt(r,x.y+(r-x.x)/(C.x-x.x)*(C.y-x.y))._round()),x.y<s&&C.y<s||(x.y<s?x=new vt(x.x+(s-x.y)/(C.y-x.y)*(C.x-x.x),s)._round():C.y<s&&(C=new vt(x.x+(s-x.y)/(C.y-x.y)*(C.x-x.x),s)._round()),x.x>=u&&C.x>=u||(x.x>=u?x=new vt(u,x.y+(u-x.x)/(C.x-x.x)*(C.y-x.y))._round():C.x>=u&&(C=new vt(u,x.y+(u-x.x)/(C.x-x.x)*(C.y-x.y))._round()),x.y>=m&&C.y>=m||(x.y>=m?x=new vt(x.x+(m-x.y)/(C.y-x.y)*(C.x-x.x),m)._round():C.y>=m&&(C=new vt(x.x+(m-x.y)/(C.y-x.y)*(C.x-x.x),m)._round()),E&&x.equals(E[E.length-1])||(E=[x],h.push(E)),E.push(C)))))}}return h}function XA(c){let r=0,s=0;for(const g of c)r+=g.w*g.h,s=Math.max(s,g.w);c.sort((g,w)=>w.h-g.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let m=0,h=0;for(const g of c)for(let w=u.length-1;w>=0;w--){const E=u[w];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,h=Math.max(h,g.y+g.h),m=Math.max(m,g.x+g.w),g.w===E.w&&g.h===E.h){const I=u.pop();w<u.length&&(u[w]=I)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(u.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:m,h,fill:r/(m*h)||0}}qt(Rc,"Anchor");const X_=1;class aS{constructor(r,{pixelRatio:s,version:u,stretchX:m,stretchY:h,content:g},w){this.paddedRect=r,this.pixelRatio=s,this.stretchX=m,this.stretchY=h,this.content=g,this.version=u,this.padding=w}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class KA{constructor(r,s,u){const m={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,m,X_,g),this.addImages(s,h,2,g);const{w,h:E}=XA(g),I=new Mo({width:w||1,height:E||1});for(const x in r){const C=r[x],P=m[x].paddedRect;Mo.copy(C.data,I,{x:0,y:0},{x:P.x+X_,y:P.y+X_},C.data,u,C.sdf)}for(const x in s){const C=s[x],P=h[x].paddedRect;let T=h[x].padding;const M=P.x+T,R=P.y+T,B=C.data.width,U=C.data.height;T=T>1?T-1:T,Mo.copy(C.data,I,{x:0,y:0},{x:M,y:R},C.data,u),Mo.copy(C.data,I,{x:0,y:U-T},{x:M,y:R-T},{width:B,height:T},u),Mo.copy(C.data,I,{x:0,y:0},{x:M,y:R+U},{width:B,height:T},u),Mo.copy(C.data,I,{x:B-T,y:0},{x:M-T,y:R},{width:T,height:U},u),Mo.copy(C.data,I,{x:0,y:0},{x:M+B,y:R},{width:T,height:U},u),Mo.copy(C.data,I,{x:B-T,y:U-T},{x:M-T,y:R-T},{width:T,height:T},u),Mo.copy(C.data,I,{x:0,y:U-T},{x:M+B,y:R-T},{width:T,height:T},u),Mo.copy(C.data,I,{x:0,y:0},{x:M+B,y:R+U},{width:T,height:T},u),Mo.copy(C.data,I,{x:B-T,y:0},{x:M-T,y:R+U},{width:T,height:T},u)}this.image=I,this.iconPositions=m,this.patternPositions=h}addImages(r,s,u,m){for(const h in r){const g=r[h],w={x:0,y:0,w:g.data.width+2*u,h:g.data.height+2*u};m.push(w),s[h]=new aS(w,g,u),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>r.hasImage(m,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const m in r.getUpdatedImages(u)){const h=Ii.build(m).getSerializedPrimary();this.patchUpdatedImage(this.iconPositions[h],r.getImage(m,u),s),this.patchUpdatedImage(this.patternPositions[h],r.getImage(m,u),s)}}patchUpdatedImage(r,s,u){if(!r||!s||r.version===s.version)return;r.version=s.version;const[m,h]=r.tl;u.update(s.data,{position:{x:m,y:h}})}}qt(aS,"ImagePosition"),qt(KA,"ImageAtlas");const K_=1e20;function JA(c,r,s,u,m,h,g,w,E){for(let I=r;I<r+u;I++)QA(c,s*h+I,h,m,g,w,E);for(let I=s;I<s+m;I++)QA(c,I*h+r,1,u,g,w,E)}function QA(c,r,s,u,m,h,g){h[0]=0,g[0]=-K_,g[1]=K_,m[0]=c[r];for(let w=1,E=0,I=0;w<u;w++){m[w]=c[r+w*s];const x=w*w;do{const C=h[E];I=(m[w]-m[C]+x-C*C)/(w-C)/2}while(I<=g[E]&&--E>-1);E++,h[E]=w,g[E]=I,g[E+1]=K_}for(let w=0,E=0;w<u;w++){for(;g[E+1]<w;)E++;const I=h[E],x=w-I;c[r+w*s]=m[I]+x*x}}const Qa=2,lS={none:0,ideographs:1,all:2};class qp{constructor(r,s,u){this.requestManager=r,this.localGlyphMode=s,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r,s){this.urls[s]=r}getGlyphs(r,s,u){const m=[],h=this.urls[s]||xe.GLYPHS_URL;for(const g in r)for(const w of r[g])m.push({stack:g,id:w});Ln(m,({stack:g,id:w},E)=>{let I=this.entries[g];I||(I=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=I.glyphs[w];if(x!==void 0)return void E(null,{stack:g,id:w,glyph:x});if(x=this._tinySDF(I,g,w),x)return I.glyphs[w]=x,void E(null,{stack:g,id:w,glyph:x});const C=Math.floor(w/256);if(256*C>65535)return Gt("glyphs > 65535 not supported"),void E(null,{stack:g,id:w,glyph:x});if(I.ranges[C])return void E(null,{stack:g,id:w,glyph:x});let P=I.requests[C];P||(P=I.requests[C]=[],qp.loadGlyphRange(g,C,h,this.requestManager,(T,M)=>{if(M){I.ascender=M.ascender,I.descender=M.descender;for(const R in M.glyphs)this._doesCharSupportLocalGlyph(+R)||(I.glyphs[+R]=M.glyphs[+R]);I.ranges[C]=!0}for(const R of P)R(T,M);delete I.requests[C]})),P.push((T,M)=>{T?E(T):M&&E(null,{stack:g,id:w,glyph:M.glyphs[w]||null})})},(g,w)=>{if(g)u(g);else if(w){const E={};for(const{stack:I,id:x,glyph:C}of w)E[I]===void 0&&(E[I]={}),E[I].glyphs===void 0&&(E[I].glyphs={}),E[I].glyphs[x]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},E[I].ascender=this.entries[I].ascender,E[I].descender=this.entries[I].descender;u(null,E)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==lS.none&&(this.localGlyphMode===lS.all?!!this.localFontFamily:!!this.localFontFamily&&(nr["CJK Unified Ideographs"](r)||nr["Hangul Syllables"](r)||nr.Hiragana(r)||nr.Katakana(r)||nr["CJK Symbols and Punctuation"](r)||nr["CJK Unified Ideographs Extension A"](r)||nr["CJK Unified Ideographs Extension B"](r)||nr.Osage(r)))}_tinySDF(r,s,u){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let h=r.tinySDF;if(!h){let R="400";/bold/i.test(s)?R="900":/medium/i.test(s)?R="500":/light/i.test(s)&&(R="200"),h=r.tinySDF=new qp.TinySDF({fontFamily:m,fontWeight:R,fontSize:24*Qa,buffer:3*Qa,radius:8*Qa}),h.fontWeight=R}if(this.localGlyphs[h.fontWeight][u])return this.localGlyphs[h.fontWeight][u];const g=String.fromCodePoint(u),{data:w,width:E,height:I,glyphWidth:x,glyphHeight:C,glyphLeft:P,glyphTop:T,glyphAdvance:M}=h.draw(g);return this.localGlyphs[h.fontWeight][u]={id:u,bitmap:new Bu({width:E,height:I},w),metrics:{width:x/Qa,height:C/Qa,left:P/Qa,top:T/Qa-27,advance:M/Qa,localGlyph:!0}}}}qp.loadGlyphRange=function(c,r,s,u,m){const h=256*r,g=h+255,w=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",c).replace("{range}",`${h}-${g}`),uc.Glyphs);dc(w,(E,I)=>{if(E)m(E);else if(I){const x={},C=function(P){return new Px(P).readFields(H6,{})}(I);for(const P of C.glyphs)x[P.id]=P;m(null,{glyphs:x,ascender:C.ascender,descender:C.descender})}})},qp.TinySDF=class{constructor({fontSize:c=24,buffer:r=3,radius:s=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:h="normal",fontStyle:g="normal"}={}){this.buffer=r,this.cutoff=u,this.radius=s;const w=this.size=c+4*r,E=this._createCanvas(w),I=this.ctx=E.getContext("2d",{willReadFrequently:!0});I.font=`${g} ${h} ${c}px ${m}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(c){const r=document.createElement("canvas");return r.width=r.height=c,r}draw(c){const{width:r,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:h}=this.ctx.measureText(c),g=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-m))),E=Math.min(this.size-this.buffer,g+Math.ceil(u)),I=w+2*this.buffer,x=E+2*this.buffer,C=Math.max(I*x,0),P=new Uint8ClampedArray(C),T={data:P,width:I,height:x,glyphWidth:w,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:r};if(w===0||E===0)return T;const{ctx:M,buffer:R,gridInner:B,gridOuter:U}=this;M.clearRect(R,R,w,E),M.fillText(c,R,R+g);const W=M.getImageData(R,R,w,E);U.fill(K_,0,C),B.fill(0,0,C);for(let Z=0;Z<E;Z++)for(let H=0;H<w;H++){const K=W.data[4*(Z*w+H)+3]/255;if(K===0)continue;const re=(Z+R)*I+H+R;if(K===1)U[re]=0,B[re]=K_;else{const se=.5-K;U[re]=se>0?se*se:0,B[re]=se<0?se*se:0}}JA(U,0,0,I,x,I,this.f,this.v,this.z),JA(B,R,R,w,E,I,this.f,this.v,this.z);for(let Z=0;Z<C;Z++){const H=Math.sqrt(U[Z])-Math.sqrt(B[Z]);P[Z]=Math.round(255-255*(H/this.radius+this.cutoff))}return T}};const Vu=X_;function eI(c,r){return c+r[1]-r[0]}function tI(c,r,s,u,m=1){const h=[],g=c.imagePrimary,w=g.pixelRatio,E=g.paddedRect.w-2*Vu,I=g.paddedRect.h-2*Vu,x=(c.right-c.left)*m,C=(c.bottom-c.top)*m,P=g.stretchX||[[0,E]],T=g.stretchY||[[0,I]],M=P.reduce(eI,0),R=T.reduce(eI,0),B=E-M,U=I-R;let W=0,Z=M,H=0,K=R,re=0,se=B,ge=0,me=U;if(g.content&&u){const Ee=g.content;W=Ix(P,0,Ee[0]),H=Ix(T,0,Ee[1]),Z=Ix(P,Ee[0],Ee[2]),K=Ix(T,Ee[1],Ee[3]),re=Ee[0]-W,ge=Ee[1]-H,se=Ee[2]-Ee[0]-Z,me=Ee[3]-Ee[1]-K}const pe=(Ee,ye,Pe,Le)=>{const Re=kx(Ee.stretch-W,Z,x,c.left*m),Ne=Rx(Ee.fixed-re,se,Ee.stretch,M),Ve=kx(ye.stretch-H,K,C,c.top*m),We=Rx(ye.fixed-ge,me,ye.stretch,R),Be=kx(Pe.stretch-W,Z,x,c.left*m),lt=Rx(Pe.fixed-re,se,Pe.stretch,M),bt=kx(Le.stretch-H,K,C,c.top*m),ct=Rx(Le.fixed-ge,me,Le.stretch,R),It=new vt(Re,Ve),At=new vt(Be,Ve),Nt=new vt(Be,bt),pt=new vt(Re,bt),Jt=new vt(Ne/w,We/w),kt=new vt(lt/w,ct/w),Zt=r*Math.PI/180;if(Zt){const jr=Math.sin(Zt),En=Math.cos(Zt),vn=[En,-jr,jr,En];It._matMult(vn),At._matMult(vn),pt._matMult(vn),Nt._matMult(vn)}const ur=Ee.stretch+Ee.fixed,Pr=Pe.stretch+Pe.fixed,Ir=ye.stretch+ye.fixed,zr=Le.stretch+Le.fixed,kr=c.imageSecondary;return{tl:It,tr:At,bl:pt,br:Nt,texPrimary:{x:g.paddedRect.x+Vu+ur,y:g.paddedRect.y+Vu+Ir,w:Pr-ur,h:zr-Ir},texSecondary:kr?{x:kr.paddedRect.x+Vu+ur,y:kr.paddedRect.y+Vu+Ir,w:Pr-ur,h:zr-Ir}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jt,pixelOffsetBR:kt,minFontScaleX:se/w/x,minFontScaleY:me/w/C,isSDF:s}};if(u&&(g.stretchX||g.stretchY)){const Ee=rI(P,B,M),ye=rI(T,U,R);for(let Pe=0;Pe<Ee.length-1;Pe++){const Le=Ee[Pe],Re=Ee[Pe+1];for(let Ne=0;Ne<ye.length-1;Ne++)h.push(pe(Le,ye[Ne],Re,ye[Ne+1]))}}else h.push(pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:I+1}));return h}function Ix(c,r,s){let u=0;for(const m of c)u+=Math.max(r,Math.min(s,m[1]))-Math.max(r,Math.min(s,m[0]));return u}function rI(c,r,s){const u=[{fixed:-Vu,stretch:0}];for(const[m,h]of c){const g=u[u.length-1];u.push({fixed:m-g.stretch,stretch:g.stretch}),u.push({fixed:m-g.stretch,stretch:g.stretch+(h-m)})}return u.push({fixed:r+Vu,stretch:s}),u}function kx(c,r,s,u){return c/r*s+u}function Rx(c,r,s,u){return c-r*s/u}function Q6(c,r,s,u){const m=r+c.positionedLines[u].lineOffset;return u===0?s+m/2:s+(m+(r+c.positionedLines[u-1].lineOffset))/2}function e8(c,r=1,s=!1){let u=1/0,m=1/0,h=-1/0,g=-1/0;const w=c[0];for(let T=0;T<w.length;T++){const M=w[T];(!T||M.x<u)&&(u=M.x),(!T||M.y<m)&&(m=M.y),(!T||M.x>h)&&(h=M.x),(!T||M.y>g)&&(g=M.y)}const E=Math.min(h-u,g-m);let I=E/2;const x=new Qf([],t8);if(E===0)return new vt(u,m);for(let T=u;T<h;T+=E)for(let M=m;M<g;M+=E)x.push(new Wp(T+I,M+I,I,c));let C=function(T){let M=0,R=0,B=0;const U=T[0];for(let W=0,Z=U.length,H=Z-1;W<Z;H=W++){const K=U[W],re=U[H],se=K.x*re.y-re.x*K.y;R+=(K.x+re.x)*se,B+=(K.y+re.y)*se,M+=3*se}return new Wp(R/M,B/M,0,T)}(c),P=x.length;for(;x.length;){const T=x.pop();(T.d>C.d||!C.d)&&(C=T,s&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,P)),T.max-C.d<=r||(I=T.h/2,x.push(new Wp(T.p.x-I,T.p.y-I,I,c)),x.push(new Wp(T.p.x+I,T.p.y-I,I,c)),x.push(new Wp(T.p.x-I,T.p.y+I,I,c)),x.push(new Wp(T.p.x+I,T.p.y+I,I,c)),P+=4)}return s&&(console.log(`num probes: ${P}`),console.log(`best distance: ${C.d}`)),C.p}function t8(c,r){return r.max-c.max}class Wp{constructor(r,s,u,m){this.p=new vt(r,s),this.h=u,this.d=function(h,g){let w=!1,E=1/0;for(let I=0;I<g.length;I++){const x=g[I];for(let C=0,P=x.length,T=P-1;C<P;T=C++){const M=x[C],R=x[T];M.y>h.y!=R.y>h.y&&h.x<(R.x-M.x)*(h.y-M.y)/(R.y-M.y)+M.x&&(w=!w),E=Math.min(E,be(h,M,R))}}return(w?1:-1)*Math.sqrt(E)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const cS=Number.POSITIVE_INFINITY,r8=Math.sqrt(2);function nI(c,[r,s]){let u=0,m=0;if(s===cS){r<0&&(r=0);const h=r/r8;switch(c){case"top-right":case"top-left":m=h-7;break;case"bottom-right":case"bottom-left":m=7-h;break;case"bottom":m=7-r;break;case"top":m=r-7}switch(c){case"top-right":case"bottom-right":u=-h;break;case"top-left":case"bottom-left":u=h;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),s=Math.abs(s),c){case"top-right":case"top-left":case"top":m=s-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-s}switch(c){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,m]}function uS(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function n8(c,r,s,u,m,h,g,w,E,I,x,C,P,T,M,R){let B=h.textMaxSize.evaluate(r,{},P);B===void 0?B=g*h.textScaleFactor:B*=h.textScaleFactor;const U=c.layers[0].layout,W=U.get("icon-offset").evaluate(r,{},P),Z=oI(s.horizontal)||s.vertical,H=T.name==="globe",K=go,re=g*h.textScaleFactor/K,se=c.tilePixelRatio*B/K,ge=(Ne=c.overscaling,c.zoom>18&&Ne>2&&(Ne>>=1),Math.max(Lt/(512*Ne),1)*U.get("symbol-spacing")),me=U.get("text-padding")*c.tilePixelRatio,pe=U.get("icon-padding")*c.tilePixelRatio,Ee=je(U.get("text-max-angle")),ye=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Pe=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Le=U.get("symbol-placement"),Re=ge/2;var Ne;const Ve=U.get("icon-text-fit").evaluate(r,{},P),We=U.get("icon-text-fit-padding").evaluate(r,{},P),Be=Ve!=="none";let lt;c.hasAnyIconTextFit===!1&&Be&&(c.hasAnyIconTextFit=!0),u&&Be&&(c.allowVerticalPlacement&&s.vertical&&(lt=$A(u,s.vertical,Ve,We,W,re)),Z&&(u=$A(u,Z,Ve,We,W,re)));const bt=(ct,It,At)=>{if(It.x<0||It.x>=Lt||It.y<0||It.y>=Lt)return;let Nt=null;if(H){const{x:pt,y:Jt,z:kt}=T.projectTilePoint(It.x,It.y,At);Nt={anchor:new Rc(pt,Jt,kt,0,void 0),up:T.upVector(At,It.x,It.y)}}(function(pt,Jt,kt,Zt,ur,Pr,Ir,zr,kr,jr,En,vn,br,xn,pn,Cn,bi,wi,di,es,qn,Yn,jo,Si,us,Li,Vl,Wu){const Zu=pt.addToLineVertexArray(Jt,Zt);let Dc,Yu,Xu,o1,Nk,Fk,jk,Bk=0,Uk=0,Vk=0,$k=0,HS=-1,qS=-1;const $l={};let Gk=Kd("");const Oh=kt?kt.anchor:Jt,WS=kr.layout.get("icon-text-fit").evaluate(qn,{},Li)!=="none";let ZS=0,YS=0;if(kr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ZS,YS]=kr.layout.get("text-offset").evaluate(qn,{},Li).map(ra=>ra*go):(ZS=kr.layout.get("text-radial-offset").evaluate(qn,{},Li)*go,YS=cS),pt.allowVerticalPlacement&&ur.vertical){const ra=ur.vertical;if(pn)Fk=dS(ra),zr&&(jk=dS(zr));else{const Is=kr.layout.get("text-rotate").evaluate(qn,{},Li)+90;Xu=Dx(jr,Oh,Jt,En,vn,br,ra,xn,Is,Cn),zr&&(o1=Dx(jr,Oh,Jt,En,vn,br,zr,wi,Is))}}if(Pr){const ra=pt.iconSizeData,Is=Si?Cx(pt.iconSizeData,pt.layers[0]._unevaluatedLayout._values["icon-size"],Li,pt.zoom,qn):1,im=kr.layout.get("icon-rotate").evaluate(qn,{},Li),Hk=tI(Pr,im,jo,WS,Si?1/Is:Yn.iconScaleFactor),KS=zr?tI(zr,im,jo,WS,Yn.iconScaleFactor):void 0;Yu=Dx(jr,Oh,Jt,En,vn,br,Pr,wi,im,null,Si?Yn.iconScaleFactor*Is:1),Bk=4*Hk.length;let zh=null;ra.kind==="source"?(zh=[Ja*kr.layout.get("icon-size").evaluate(qn,{},Li)*Yn.iconScaleFactor],zh[0]>$u&&Gt(`${pt.layerIds[0]}: Value for "icon-size" is >= ${J_}. Reduce your "icon-size".`)):ra.kind==="composite"&&(zh=[Ja*Yn.compositeIconSizes[0].evaluate(qn,{},Li)*Yn.iconScaleFactor,Ja*Yn.compositeIconSizes[1].evaluate(qn,{},Li)*Yn.iconScaleFactor],(zh[0]>$u||zh[1]>$u)&&Gt(`${pt.layerIds[0]}: Value for "icon-size" is >= ${J_}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,Hk,zh,es,di,qn,!1,kt,Jt,Zu.lineStartIndex,Zu.lineLength,-1,us,Li,Vl,Wu),HS=pt.icon.placedSymbolArray.length-1,KS&&(Uk=4*KS.length,pt.addSymbols(pt.icon,KS,zh,es,di,qn,ea.vertical,kt,Jt,Zu.lineStartIndex,Zu.lineLength,-1,us,Li,Vl,Wu),qS=pt.icon.placedSymbolArray.length-1)}for(const ra in ur.horizontal){const Is=ur.horizontal[ra];Dc||(Gk=Kd(Is.text),pn?Nk=dS(Is):Dc=Dx(jr,Oh,Jt,En,vn,br,Is,xn,kr.layout.get("text-rotate").evaluate(qn,{},Li),Cn));const im=Is.positionedLines.length===1;if(Vk+=iI(pt,kt,Jt,Is,Ir,kr,pn,qn,Cn,Zu,ur.vertical?ea.horizontal:ea.horizontalOnly,im?Object.keys(ur.horizontal):[ra],$l,HS,Yn,us,Li,Vl),im)break}ur.vertical&&($k+=iI(pt,kt,Jt,ur.vertical,Ir,kr,pn,qn,Cn,Zu,ea.vertical,["vertical"],$l,qS,Yn,us,Li,Vl));let Ku=-1;const XS=(ra,Is)=>ra?Math.max(ra,Is):Is;Ku=XS(Nk,Ku),Ku=XS(Fk,Ku),Ku=XS(jk,Ku);const zU=Ku>-1?1:0;pt.glyphOffsetArray.length>=65535&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qn.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,qn.sortKey),pt.symbolInstances.emplaceBack(Jt.x,Jt.y,Oh.x,Oh.y,Oh.z,$l.right>=0?$l.right:-1,$l.center>=0?$l.center:-1,$l.left>=0?$l.left:-1,$l.vertical>=0?$l.vertical:-1,HS,qS,Gk,Dc!==void 0?Dc:pt.collisionBoxArray.length,Dc!==void 0?Dc+1:pt.collisionBoxArray.length,Xu!==void 0?Xu:pt.collisionBoxArray.length,Xu!==void 0?Xu+1:pt.collisionBoxArray.length,Yu!==void 0?Yu:pt.collisionBoxArray.length,Yu!==void 0?Yu+1:pt.collisionBoxArray.length,o1||pt.collisionBoxArray.length,o1?o1+1:pt.collisionBoxArray.length,En,Vk,$k,Bk,Uk,zU,0,ZS,YS,Ku,0,WS?1:0)})(c,It,Nt,ct,s,u,m,lt,c.layers[0],c.collisionBoxArray,r.index,r.sourceLayerIndex,c.index,me,ye,E,0,pe,Pe,W,r,h,I,x,C,P,M,R)};if(Le==="line")for(const ct of YA(r.geometry,0,0,Lt,Lt)){const It=J6(ct,ge,Ee,s.vertical||Z,u,K,se,c.overscaling,Lt);for(const At of It)Z&&i8(c,Z.text,Re,At)||bt(ct,At,P)}else if(Le==="line-center"){for(const ct of r.geometry)if(ct.length>1){const It=K6(ct,Ee,s.vertical||Z,u,K,se);It&&bt(ct,It,P)}}else if(r.type==="Polygon")for(const ct of vx(r.geometry,0)){const It=e8(ct,16);bt(ct[0],new Rc(It.x,It.y,0,0,void 0),P)}else if(r.type==="LineString")for(const ct of r.geometry)bt(ct,new Rc(ct[0].x,ct[0].y,0,0,void 0),P);else if(r.type==="Point")for(const ct of r.geometry)for(const It of ct)bt([It],new Rc(It.x,It.y,0,0,void 0),P)}const J_=255,$u=J_*Ja;function iI(c,r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B,U){const W=function(K,re,se,ge,me,pe,Ee,ye){const Pe=[];if(re.positionedLines.length===0)return Pe;const Le=ge.layout.get("text-rotate").evaluate(pe,{})*Math.PI/180,Re=function(lt){const bt=lt[0],ct=lt[1],It=bt*ct;return It>0?[bt,-ct]:It<0?[-bt,ct]:bt===0?[ct,bt]:[ct,-bt]}(se);let Ne=Math.abs(re.top-re.bottom);for(const lt of re.positionedLines)Ne-=lt.lineOffset;const Ve=re.positionedLines.length,We=Ne/Ve;let Be=re.top-se[1];for(let lt=0;lt<Ve;++lt){const bt=re.positionedLines[lt];Be=Q6(re,We,Be,lt);for(const ct of bt.positionedGlyphs){if(!ct.rect)continue;const It=ct.rect||{};let At=NA+1,Nt=!0,pt=1,Jt=0;if(ct.imageName){const di=Ee[Ii.build(ct.imageName).getSerializedPrimary()];if(!di)continue;if(di.sdf){Gt("SDF images are not supported in formatted text and will be ignored.");continue}Nt=!1,pt=di.pixelRatio,At=X_/pt}const kt=(me||ye)&&ct.vertical,Zt=ct.metrics.advance*ct.scale/2,ur=ct.metrics,Pr=ct.rect;if(Pr===null)continue;ye&&re.verticalizable&&(Jt=ct.imageName?Zt-ct.metrics.width*ct.scale/2:0);const Ir=me?[ct.x+Zt,ct.y]:[0,0];let zr=[0,0],kr=[0,0],jr=!1;me||(kt?(kr=[ct.x+Zt+Re[0],ct.y+Re[1]-Jt],jr=!0):zr=[ct.x+Zt+se[0],ct.y+se[1]-Jt]);const En=Pr.w*ct.scale/(pt*(ct.localGlyph?Qa:1)),vn=Pr.h*ct.scale/(pt*(ct.localGlyph?Qa:1));let br,xn,pn,Cn;if(kt){const di=ct.y-Be,es=new vt(-Zt,Zt-di),qn=-Math.PI/2,Yn=new vt(...kr);br=new vt(-Zt+zr[0],zr[1]),br._rotateAround(qn,es)._add(Yn),br.x+=-di+Zt,br.y-=(ur.left-At)*ct.scale;const jo=ct.imageName?ur.advance*ct.scale:go*ct.scale,Si=String.fromCodePoint(ct.glyph);V6(Si)?br.x+=(1-At)*ct.scale:$6(Si)?br.x+=jo-ur.height*ct.scale+(-At-1)*ct.scale:br.x+=ct.imageName||ur.width+2*At===Pr.w&&ur.height+2*At===Pr.h?(jo-vn)/2:(jo-(ur.height+2*At)*ct.scale)/2,xn=new vt(br.x,br.y-En),pn=new vt(br.x+vn,br.y),Cn=new vt(br.x+vn,br.y-En)}else{const di=(ur.left-At)*ct.scale-Zt+zr[0],es=(-ur.top-At)*ct.scale+zr[1],qn=di+En,Yn=es+vn;br=new vt(di,es),xn=new vt(qn,es),pn=new vt(di,Yn),Cn=new vt(qn,Yn)}if(Le){let di;di=me?new vt(0,0):jr?new vt(Re[0],Re[1]):new vt(se[0],se[1]),br._rotateAround(Le,di),xn._rotateAround(Le,di),pn._rotateAround(Le,di),Cn._rotateAround(Le,di)}const bi=new vt(0,0),wi=new vt(0,0);Pe.push({tl:br,tr:xn,bl:pn,br:Cn,texPrimary:It,texSecondary:void 0,writingMode:re.writingMode,glyphOffset:Ir,sectionIndex:ct.sectionIndex,isSDF:Nt,pixelOffsetTL:bi,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}}return Pe}(0,u,E,h,g,w,m,c.allowVerticalPlacement),Z=c.textSizeData;let H=null;Z.kind==="source"?(H=[Ja*h.layout.get("text-size").evaluate(w,{},B)*M.textScaleFactor],H[0]>$u&&Gt(`${c.layerIds[0]}: Value for "text-size" is >= ${J_}. Reduce your "text-size".`)):Z.kind==="composite"&&(H=[Ja*M.compositeTextSizes[0].evaluate(w,{},B)*M.textScaleFactor,Ja*M.compositeTextSizes[1].evaluate(w,{},B)*M.textScaleFactor],(H[0]>$u||H[1]>$u)&&Gt(`${c.layerIds[0]}: Value for "text-size" is >= ${J_}. Reduce your "text-size".`)),c.addSymbols(c.text,W,H,E,g,w,x,r,s,I.lineStartIndex,I.lineLength,T,R,B,U,!1);for(const K of C)P[K]=c.text.placedSymbolArray.length-1;return 4*W.length}function oI(c){for(const r in c)return c[r];return null}function Dx(c,r,s,u,m,h,g,w,E,I,x=1){let C=g.top/x,P=g.bottom/x,T=g.left/x,M=g.right/x;const R=g.collisionPadding;if(R&&(T-=R[0],C-=R[1],M+=R[2],P+=R[3]),E){const B=new vt(T,C),U=new vt(M,C),W=new vt(T,P),Z=new vt(M,P),H=je(E);let K=new vt(0,0);I&&(K=new vt(I[0],I[1])),B._rotateAround(H,K),U._rotateAround(H,K),W._rotateAround(H,K),Z._rotateAround(H,K),T=Math.min(B.x,U.x,W.x,Z.x),M=Math.max(B.x,U.x,W.x,Z.x),C=Math.min(B.y,U.y,W.y,Z.y),P=Math.max(B.y,U.y,W.y,Z.y)}return c.emplaceBack(r.x,r.y,r.z,s.x,s.y,T,C,M,P,w,u,m,h),c.length-1}function dS(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const r=c.bottom-c.top;return r>0?Math.max(10,r):null}function i8(c,r,s,u){const m=c.compareText;if(r in m){const h=m[r];for(let g=h.length-1;g>=0;g--)if(u.dist(h[g])<s)return!0}else m[r]=[];return m[r].push(u),!1}function sI(c,r){const s=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*r:0,m=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),h=Math.sin(s)*m/Math.sin(Math.max(Math.PI/2-c._pitch-s,.01));let g=Math.sin(c._pitch)*h+m;const w=m*(1/c._horizonShift);return c.elevation&&c.elevation.exaggeration()!==0||(g*=1+Math.max(c.zoom-17,0)),Math.min(1.01*g,w)}function Q_(c,r){if(!r.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:r};const s=Math.pow(2,-c.z),u=c.x*s,m=(c.x+1)*s,h=c.y*s,g=(c.y+1)*s,w=Jo(u),E=Jo(m),I=Ki(h),x=Ki(g),C=r.project(w,I),P=r.project(E,I),T=r.project(E,x),M=r.project(w,x);let R=Math.min(C.x,P.x,T.x,M.x),B=Math.min(C.y,P.y,T.y,M.y),U=Math.max(C.x,P.x,T.x,M.x),W=Math.max(C.y,P.y,T.y,M.y);const Z=s/16;function H(re,se,ge,me,pe,Ee){const ye=(ge+pe)/2,Pe=(me+Ee)/2,Le=r.project(Jo(ye),Ki(Pe)),Re=Math.max(0,R-Le.x,B-Le.y,Le.x-U,Le.y-W);R=Math.min(R,Le.x),U=Math.max(U,Le.x),B=Math.min(B,Le.y),W=Math.max(W,Le.y),Re>Z&&(H(re,Le,ge,me,ye,Pe),H(Le,se,ye,Pe,pe,Ee))}H(C,P,u,h,m,h),H(P,T,m,h,m,g),H(T,M,m,g,u,g),H(M,C,u,g,u,h),R-=Z,B-=Z,U+=Z,W+=Z;const K=1/Math.max(U-R,W-B);return{scale:K,x:R*K,y:B*K,x2:U*K,y2:W*K,projection:r}}function aI(c,{x:r,y:s},u=0){return new vt(((r-u)*c.scale-c.x)*Lt,(s*c.scale-c.y)*Lt)}const o8=Me.mat4.identity(new Float32Array(16));class Gu{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,s){return{x:0,y:0,z:0}}unproject(r,s){return new Kr(0,0)}projectTilePoint(r,s,u){return{x:r,y:s,z:0}}locationPoint(r,s,u=!0){return r._coordinatePoint(r.locationCoordinate(s),u)}pixelsPerMeter(r,s){return Co(1,r)*s}pixelSpaceConversion(r,s,u){return 1}farthestPixelDistance(r){return sI(r,r.pixelsPerMeter)}pointCoordinate(r,s,u,m){const h=r.horizonLineFromTop(!1),g=new vt(s,Math.max(h,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(g,m))}pointCoordinate3D(r,s,u){const m=new vt(s,u);if(r.elevation)return r.elevation.pointCoordinate(m);{const h=this.pointCoordinate(r,m.x,m.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(r,s){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,s.x,s.y);const u=r.horizonLineFromTop();return s.y<u}createInversionMatrix(r,s){return o8}createTileMatrix(r,s,u){let m,h,g;const w=u.canonical,E=Me.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=Q_(w,this);m=1,h=I.x+u.wrap*I.scale,g=I.y,Me.mat4.scale(E,E,[m/I.scale,m/I.scale,r.pixelsPerMeter/s])}else m=s/r.zoomScale(w.z),h=(w.x+Math.pow(2,w.z)*u.wrap)*m,g=w.y*m;return Me.mat4.translate(E,E,[h,g,0]),Me.mat4.scale(E,E,[m/Lt,m/Lt,1]),E}upVector(r,s,u){return[0,0,1]}upVectorScale(r,s,u){return{metersToTile:1}}}class s8 extends Gu{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[s,u]=this.parallels=r.parallels||[29.5,45.5],m=Math.sin(je(s));this.n=(m+Math.sin(je(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(r,s){const{n:u,c:m,r0:h}=this,g=je(r-this.center[0]),w=je(s),E=Math.sqrt(m-2*u*Math.sin(w))/u;return{x:E*Math.sin(g*u),y:E*Math.cos(g*u)-h,z:0}}unproject(r,s){const{n:u,c:m,r0:h}=this,g=h+s;let w=Math.atan2(r,Math.abs(g))*Math.sign(g);g*u<0&&(w-=Math.PI*Math.sign(r)*Math.sign(g));const E=je(this.center[0])*u;w=$n(w,-Math.PI-E,Math.PI-E);const I=Ot(dt(w/u)+this.center[0],-180,180),x=Math.asin(Ot((m-(r*r+g*g)*u*u)/(2*u),-1,1)),C=Ot(dt(x),-ui,ui);return new Kr(I,C)}}const ey=1.340264,ty=-.081106,ry=893e-6,ny=.003796,Lx=Math.sqrt(3)/2;class a8 extends Gu{project(r,s){s=s/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(Lx*Math.sin(s)),m=u*u,h=m*m*m;return{x:.5*(r*Math.cos(u)/(Lx*(ey+3*ty*m+h*(7*ry+9*ny*m)))/Math.PI+.5),y:1-.5*(u*(ey+ty*m+h*(ry+ny*m))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,m=u*u,h=m*m*m;for(let x,C,P,T=0;T<12&&(C=u*(ey+ty*m+h*(ry+ny*m))-s,P=ey+3*ty*m+h*(7*ry+9*ny*m),x=C/P,u=Ot(u-x,-Math.PI/3,Math.PI/3),m=u*u,h=m*m*m,!(Math.abs(x)<1e-12));++T);const g=Lx*r*(ey+3*ty*m+h*(7*ry+9*ny*m))/Math.cos(u),w=Math.asin(Math.sin(u)/Lx),E=Ot(180*g/Math.PI,-180,180),I=Ot(180*w/Math.PI,-ui,ui);return new Kr(E,I)}}class l8 extends Gu{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){return{x:.5+r/360,y:.5-s/360,z:0}}unproject(r,s){const u=360*(r-.5),m=Ot(360*(.5-s),-ui,ui);return new Kr(u,m)}}const Zp=Math.PI/2;function Ox(c){return Math.tan((Zp+c)/2)}class c8 extends Gu{constructor(r){super(r),this.center=r.center||[0,30];const[s,u]=this.parallels=r.parallels||[30,30];let m=je(s),h=je(u);this.southernCenter=m+h<0,this.southernCenter&&(m=-m,h=-h);const g=Math.cos(m),w=Ox(m);this.n=m===h?Math.sin(m):Math.log(g/Math.cos(h))/Math.log(Ox(h)/w),this.f=g*Math.pow(Ox(m),this.n)/this.n}project(r,s){s=je(s),this.southernCenter&&(s=-s),r=je(r-this.center[0]);const u=1e-6,{n:m,f:h}=this;h>0?s<-Zp+u&&(s=-Zp+u):s>Zp-u&&(s=Zp-u);const g=h/Math.pow(Ox(s),m);let w=g*Math.sin(m*r),E=h-g*Math.cos(m*r);return w=.5*(w/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:w,y:this.southernCenter?E:1-E,z:0}}unproject(r,s){r=(2*r-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:u,f:m}=this,h=m-s,g=Math.sign(h),w=Math.sign(u)*Math.sqrt(r*r+h*h);let E=Math.atan2(r,Math.abs(h))*g;h*u<0&&(E-=Math.PI*Math.sign(r)*g);const I=Ot(dt(E/u)+this.center[0],-180,180),x=Ot(dt(2*Math.atan(Math.pow(m/w,1/u))-Zp),-ui,ui);return new Kr(I,this.southernCenter?-x:x)}}class lI extends Gu{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,s){return{x:Bl(r),y:Ya(s),z:0}}unproject(r,s){const u=Jo(r),m=Ki(s);return new Kr(u,m)}}const cI=je(ui);class u8 extends Gu{project(r,s){const u=(s=je(s))*s,m=u*u;return{x:.5*((r=je(r))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,m=25,h=0,g=u*u;do{g=u*u;const I=g*g;h=(u*(1.007226+g*(.015085+I*(.028874*g-.044475-.005916*I)))-s)/(1.007226+g*(.045255+I*(.259866*g-.311325-.005916*11*I))),u=Ot(u-h,-cI,cI)}while(Math.abs(h)>1e-6&&--m>0);g=u*u;const w=Ot(dt(r/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=dt(u);return new Kr(w,E)}}const uI=je(ui);class d8 extends Gu{project(r,s){s=je(s),r=je(r);const u=Math.cos(s),m=2/Math.PI,h=Math.acos(u*Math.cos(r/2)),g=Math.sin(h)/h,w=.5*(r*m+2*u*Math.sin(r/2)/g)||0,E=.5*(s+Math.sin(s)/g)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,s){let u=r=(2*r-.5)*Math.PI,m=s=(2*(1-s)-1)*Math.PI,h=25;const g=1e-6;let w=0,E=0;do{const I=Math.cos(m),x=Math.sin(m),C=2*x*I,P=x*x,T=I*I,M=Math.cos(u/2),R=Math.sin(u/2),B=2*M*R,U=R*R,W=1-T*M*M,Z=W?1/W:0,H=W?Math.acos(I*M)*Math.sqrt(1/W):0,K=.5*(2*H*I*R+2*u/Math.PI)-r,re=.5*(H*x+m)-s,se=.5*Z*(T*U+H*I*M*P)+1/Math.PI,ge=Z*(B*C/4-H*x*R),me=.125*Z*(C*R-H*x*T*B),pe=.5*Z*(P*M+H*U*I)+.5,Ee=ge*me-pe*se;w=(re*ge-K*pe)/Ee,E=(K*me-re*se)/Ee,u=Ot(u-w,-Math.PI,Math.PI),m=Ot(m-E,-uI,uI)}while((Math.abs(w)>g||Math.abs(E)>g)&&--h>0);return new Kr(dt(u),dt(m))}}class dI extends Gu{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(je(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){const{scale:u,cosPhi:m}=this;return{x:je(r)*m*u+.5,y:-Math.sin(je(s))/m*u+.5,z:0}}unproject(r,s){const{scale:u,cosPhi:m}=this,h=-(s-.5)/u,g=Ot(dt((r-.5)/u)/m,-180,180),w=Math.asin(Ot(h*m,-1,1)),E=Ot(dt(w),-ui,ui);return new Kr(g,E)}}class h8 extends lI{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,s,u){const m=ni(r,s,u),h=io(ki(u));return Me.vec3.transformMat4(m,m,h),{x:m[0],y:m[1],z:m[2]}}locationPoint(r,s){const u=Ic(s.lat,s.lng),m=Me.vec3.normalize([],u),h=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(s),r._centerAltitude):r._centerAltitude,g=Co(1,0)*Lt*h;Me.vec3.scaleAndAdd(u,u,m,g);const w=Me.mat4.identity(new Float64Array(16));return Me.mat4.multiply(w,r.pixelMatrix,r.globeMatrix),Me.vec3.transformMat4(u,u,w),new vt(u[0],u[1])}pixelsPerMeter(r,s){return Co(1,0)*s}pixelSpaceConversion(r,s,u){const m=Co(1,r)*s,h=pr(Co(1,45)*s,m,u);return this.pixelsPerMeter(r,s)/h}createTileMatrix(r,s,u){const m=ls(ki(u.canonical));return Me.mat4.multiply(new Float64Array(16),r.globeMatrix,m)}createInversionMatrix(r,s){const{center:u}=r,m=io(ki(s));return Me.mat4.rotateY(m,m,je(u.lng)),Me.mat4.rotateX(m,m,je(u.lat)),Me.mat4.scale(m,m,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(r,s,u,m){return Gi(r,s,u,!0)||new y(0,0)}pointCoordinate3D(r,s,u){const m=this.pointCoordinate(r,s,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(r,s){return!Gi(r,s.x,s.y,!1)}farthestPixelDistance(r){const s=function(m,h){const g=m.cameraToCenterDistance,w=m._centerAltitude*h,E=m._camera,I=m._camera.forward(),x=Me.vec3.add([],Me.vec3.scale([],I,-g),[0,0,w]),C=m.worldSize/(2*Math.PI),P=[0,0,-C],T=m.width/m.height,M=Math.tan(m.fovAboveCenter),R=Me.vec3.scale([],E.up(),M),B=Me.vec3.scale([],E.right(),M*T),U=Me.vec3.normalize([],Me.vec3.add([],Me.vec3.add([],I,R),B)),W=[];let Z;if(new Rr(x,U).closestPointOnSphere(P,C,W)){const H=Me.vec3.add([],W,P),K=Me.vec3.sub([],H,x);Z=Math.cos(m.fovAboveCenter)*Me.vec3.length(K)}else{const H=Me.vec3.sub([],x,P),K=Me.vec3.sub([],P,x);Me.vec3.normalize(K,K);const re=Me.vec3.length(H)-C;Z=Math.sqrt(re*(re+2*C));const se=Math.acos(Z/(C+re))-Math.acos(Me.vec3.dot(I,K));Z*=Math.cos(se)}return 1.01*Z}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=mo(r.zoom);if(u>0){const m=sI(r,Co(1,r.center.lat)*r.worldSize),h=r.worldSize/(2*Math.PI),g=Math.max(r.width,r.height)/r.worldSize*Math.PI;return pr(s,m+h*(1-Math.cos(g)),Math.pow(u,10))}return s}upVector(r,s,u){return ni(s,u,r,1)}upVectorScale(r){return{metersToTile:en(Ri(ki(r)))}}}function hI(c){const r=c.parallels,s=!!r&&Math.abs(r[0]+r[1])<.01;switch(c.name){case"mercator":return new lI(c);case"equirectangular":return new l8(c);case"naturalEarth":return new u8(c);case"equalEarth":return new a8(c);case"winkelTripel":return new d8(c);case"albers":return s?new dI(c):new s8(c);case"lambertConformalConic":return s?new dI(c):new c8(c);case"globe":return new h8(c)}throw new Error(`Invalid projection name: ${c.name}`)}const f8=$p.VectorTileFeature.types,p8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zx(c,r,s,u,m,h,g,w,E,I,x,C,P){const T=w?Math.min($u,Math.round(w[0])):0,M=w?Math.min($u,Math.round(w[1])):0;c.emplaceBack(r,s,Math.round(32*u),Math.round(32*m),h,g,(T<<1)+(E?1:0),M,16*I,16*x,256*C,256*P)}function Nx(c,r,s){c.emplaceBack(r,s)}function Fx(c,r,s,u,m,h,g){c.emplaceBack(r,s,u,m,h,g)}function jx(c,r,s,u,m){c.emplaceBack(r,s,u,m),c.emplaceBack(r,s,u,m),c.emplaceBack(r,s,u,m),c.emplaceBack(r,s,u,m)}function m8(c){for(const r of c.sections)if(E2(r.text))return!0;return!1}class hS{constructor(r){this.layoutVertexArray=new __,this.indexArray=new no,this.programConfigurations=r,this.segments=new ri,this.dynamicLayoutVertexArray=new qa,this.opacityVertexArray=new v_,this.placedSymbolArray=new sx,this.iconTransitioningVertexArray=new Ol,this.globeExtVertexArray=new y_,this.zOffsetVertexArray=new Ms}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(r,s,u,m,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,R6.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,L6.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,p8,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,z6.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,D6.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,O6.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}qt(hS,"SymbolBuffers");class fS{constructor(r,s,u){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new u,this.segments=new ri,this.collisionVertexArray=new w_,this.collisionVertexArrayExt=new qa}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,N6.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,F6.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qt(fS,"CollisionBuffers");class Bx{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.lut=r.lut,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Me.mat4.identity([]),this.placementViewportMatrix=Me.mat4.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tS(this.zoom,s["text-size"]),this.iconSizeData=tS(this.zoom,s["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),h=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>ea[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new hS(new Fl(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new hS(new Fl(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new Sh,this.lineVertexArray=new Ko,this.symbolInstances=new wh}calculateGlyphDependencies(r,s,u,m,h){for(const g of r){const w=g.codePointAt(0);if(w===void 0)break;if(s[w]=!0,m&&h&&w<=65535){const E=Z_[g];E&&(s[E.charCodeAt(0)]=!0)}}}updateFootprints(r,s){}updateReplacement(r,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!Z2(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(r,s,u,m){const h=this.layers[0],g=h.layout,w=this.projection.name==="globe",E=g.get("text-font"),I=g.get("text-field"),x=g.get("icon-image"),[C,P]=g.get("icon-size-scale-range"),T=Ot(s.scaleFactor||1,C,P),M=(I.value.kind!=="constant"||I.value.value instanceof ho&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),R=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,B=g.get("symbol-sort-key");if(this.features=[],!M&&!R)return;const U=s.iconDependencies,W=s.glyphDependencies,Z=s.availableImages,H=new Gn(this.zoom);for(const{feature:K,id:re,index:se,sourceLayerIndex:ge}of r){const me=h._featureFilter.needGeometry,pe=q(K,me);if(!h._featureFilter.filter(H,pe,u))continue;if(me||(pe.geometry=V(K,u,m)),w&&K.type!==1&&u.z<=5){const Re=pe.geometry,Ne=.98078528056,Ve=(We,Be)=>{const lt=ni(We.x,We.y,u,1),bt=ni(Be.x,Be.y,u,1);return Me.vec3.dot(lt,bt)<Ne};for(let We=0;We<Re.length;We++)Re[We]=D(Re[We],Ve)}let Ee,ye;if(M){const Re=h.getValueAndResolveTokens("text-field",pe,u,Z),Ne=ho.factory(Re);m8(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||f_()==="unavailable"||this.hasRTLText&&Xo.isParsed())&&(Ee=U6(Ne,h,pe))}if(R){const Re=h.getValueAndResolveTokens("icon-image",pe,u,Z);ye=Re instanceof Ii?Re:Ii.build(Re)}if(!Ee&&!ye)continue;const Pe=this.sortFeaturesByKey?B.evaluate(pe,{},u):void 0,Le={id:re,text:Ee,icon:ye,index:se,sourceLayerIndex:ge,geometry:pe.geometry,properties:K.properties,type:f8[K.type],sortKey:Pe};if(this.features.push(Le),ye){const Re=Cx(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],u,this.zoom,Le)*T*this.pixelRatio,Ne=ye.getPrimary().scaleSelf(Re);if(U[Ne.id]=U[Ne.id]||[],U[Ne.id].push(Ne),ye.nameSecondary){const Ve=ye.getSecondary().scaleSelf(Re);U[Ve.id]=U[Ve.id]||[],U[Ve.id].push(Ve)}}if(Ee){const Re=E.evaluate(pe,{},u).join(","),Ne=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ea.vertical)>=0;for(const Ve of Ee.sections)if(Ve.image){const We=Ve.image.getPrimary().scaleSelf(this.pixelRatio);U[We.id]=U[We.id]||[],U[We.id].push(We)}else{const We=yp(Ee.toString()),Be=Ve.fontStack||Re,lt=W[Be]=W[Be]||{};this.calculateGlyphDependencies(Ve.text,lt,Ne,this.allowVerticalPlacement,We)}}}g.get("symbol-placement")==="line"&&(this.features=function(K){const re={},se={},ge=[];let me=0;function pe(Le){ge.push(K[Le]),me++}function Ee(Le,Re,Ne){const Ve=se[Le];return delete se[Le],se[Re]=Ve,ge[Ve].geometry[0].pop(),ge[Ve].geometry[0]=ge[Ve].geometry[0].concat(Ne[0]),Ve}function ye(Le,Re,Ne){const Ve=re[Re];return delete re[Re],re[Le]=Ve,ge[Ve].geometry[0].shift(),ge[Ve].geometry[0]=Ne[0].concat(ge[Ve].geometry[0]),Ve}function Pe(Le,Re,Ne){const Ve=Ne?Re[0][Re[0].length-1]:Re[0][0];return`${Le}:${Ve.x}:${Ve.y}`}for(let Le=0;Le<K.length;Le++){const Re=K[Le],Ne=Re.geometry,Ve=Re.text?Re.text.toString():null;if(!Ve){pe(Le);continue}const We=Pe(Ve,Ne),Be=Pe(Ve,Ne,!0);if(We in se&&Be in re&&se[We]!==re[Be]){const lt=ye(We,Be,Ne),bt=Ee(We,Be,ge[lt].geometry);delete re[We],delete se[Be],se[Pe(Ve,ge[bt].geometry,!0)]=bt,ge[lt].geometry=null}else We in se?Ee(We,Be,Ne):Be in re?ye(We,Be,Ne):(pe(Le),re[We]=me-1,se[Be]=me-1)}return ge.filter(Le=>Le.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,re)=>K.sortKey-re.sortKey)}update(r,s,u,m,h,g,w){this.text.programConfigurations.updatePaintArrays(r,s,h,u,m,g,w),this.icon.programConfigurations.updatePaintArrays(r,s,h,u,m,g,w)}updateZOffset(){const r=(h,g,w)=>{u+=g,u>h.length&&h.resize(u);for(let E=-g;E<0;E++)h.emplace(E+u,w)},s=(h,g,w)=>{m+=g,m>h.length&&h.resize(m);for(let E=-g;E<0;E++)h.emplace(E+m,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,m=0;for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:E,numIconVertices:I}=g,x=g.zOffset,C=I>0;if((w>0||E>0)&&(r(this.text.zOffsetVertexArray,w,x),r(this.text.zOffsetVertexArray,E,x)),C){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:T}=g;P>=0&&s(this.icon.zOffsetVertexArray,I,x),T>=0&&s(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=hI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:m,y:h}of s)this.lineVertexArray.emplaceBack(m,h);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,s,u,m,h,g,w,E,I,x,C,P,T,M,R,B){const U=r.indexArray,W=r.layoutVertexArray,Z=r.globeExtVertexArray,H=r.segments.prepareSegment(4*s.length,W,U,this.canOverlap?g.sortKey:void 0),K=this.glyphOffsetArray.length,re=H.vertexLength,se=this.allowVerticalPlacement&&w===ea.vertical?Math.PI/2:0,ge=g.text&&g.text.sections;for(let pe=0;pe<s.length;pe++){const{tl:Ee,tr:ye,bl:Pe,br:Le,texPrimary:Re,texSecondary:Ne,pixelOffsetTL:Ve,pixelOffsetBR:We,minFontScaleX:Be,minFontScaleY:lt,glyphOffset:bt,isSDF:ct,sectionIndex:It}=s[pe],At=H.vertexLength,Nt=bt[1];if(zx(W,I.x,I.y,Ee.x,Nt+Ee.y,Re.x,Re.y,u,ct,Ve.x,Ve.y,Be,lt),zx(W,I.x,I.y,ye.x,Nt+ye.y,Re.x+Re.w,Re.y,u,ct,We.x,Ve.y,Be,lt),zx(W,I.x,I.y,Pe.x,Nt+Pe.y,Re.x,Re.y+Re.h,u,ct,Ve.x,We.y,Be,lt),zx(W,I.x,I.y,Le.x,Nt+Le.y,Re.x+Re.w,Re.y+Re.h,u,ct,We.x,We.y,Be,lt),E){const{x:pt,y:Jt,z:kt}=E.anchor,[Zt,ur,Pr]=E.up;Fx(Z,pt,Jt,kt,Zt,ur,Pr),Fx(Z,pt,Jt,kt,Zt,ur,Pr),Fx(Z,pt,Jt,kt,Zt,ur,Pr),Fx(Z,pt,Jt,kt,Zt,ur,Pr),jx(r.dynamicLayoutVertexArray,pt,Jt,kt,se)}else jx(r.dynamicLayoutVertexArray,I.x,I.y,I.z,se);if(B){const pt=Ne||Re;Nx(r.iconTransitioningVertexArray,pt.x,pt.y),Nx(r.iconTransitioningVertexArray,pt.x+pt.w,pt.y),Nx(r.iconTransitioningVertexArray,pt.x,pt.y+pt.h),Nx(r.iconTransitioningVertexArray,pt.x+pt.w,pt.y+pt.h)}U.emplaceBack(At,At+1,At+2),U.emplaceBack(At+1,At+2,At+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bt[0]),pe!==s.length-1&&It===s[pe+1].sectionIndex||r.programConfigurations.populatePaintArrays(W.length,g,g.index,{},T,M,R,ge&&ge[It])}const me=E?E.anchor:I;r.placedSymbolArray.emplaceBack(me.x,me.y,me.z,I.x,I.y,K,this.glyphOffsetArray.length-K,re,x,C,I.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],w,0,!1,0,P,0)}_commitLayoutVertex(r,s,u,m,h,g,w){r.emplaceBack(s,u,m,h,g,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(r,s,u,m,h,g,w){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),I=E.vertexLength,x=w.tileAnchorX,C=w.tileAnchorY;for(let T=0;T<4;T++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,r.padding,w.zOffset),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,x,C,new vt(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,x,C,new vt(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,x,C,new vt(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,x,C,new vt(r.x1,r.y2)),E.vertexLength+=4;const P=u.indexArray;P.emplaceBack(I,I+1),P.emplaceBack(I+1,I+2),P.emplaceBack(I+2,I+3),P.emplaceBack(I+3,I),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,s,u,m,h,g){for(let w=m;w<h;w++){const E=u.get(w),I=this.getSymbolInstanceTextSize(r,g,s,w);this._addCollisionDebugVertices(E,I,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(r,s,u,m,h,g){for(let w=m;w<h;w++){const E=u.get(w),I=this.getSymbolInstanceIconSize(r,s,g.placedIconSymbolIndex);this._addCollisionDebugVertices(E,I,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(r,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fS(bh,DA.members,Ol),this.iconCollisionBox=new fS(bh,DA.members,Ol);const m=Gp(this.iconSizeData,r),h=Gp(this.textSizeData,r,u);for(let g=0;g<this.symbolInstances.length;g++){const w=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(h,r,s,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(h,r,s,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(m,r,s,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(m,r,s,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(r,s,u,m){const h=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:m),g=Mx(this.textSizeData,r,h)/go;return this.tilePixelRatio*g}getSymbolInstanceIconSize(r,s,u){const m=this.icon.placedSymbolArray.get(u),h=Mx(this.iconSizeData,r,m);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(r,s,u,m){r.emplaceBack(s,-u,-u,m),r.emplaceBack(s,u,-u,m),r.emplaceBack(s,u,u,m),r.emplaceBack(s,-u,u,m)}_updateTextDebugCollisionBoxes(r,s,u,m,h,g,w){for(let E=m;E<h;E++){const I=u.get(E),x=this.getSymbolInstanceTextSize(r,g,s,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,I.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(r,s,u,m,h,g,w){for(let E=m;E<h;E++){const I=u.get(E),x=this.getSymbolInstanceIconSize(r,s,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,I.padding,g.zOffset)}}updateCollisionDebugBuffers(r,s,u,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Gp(this.iconSizeData,r,m),g=Gp(this.textSizeData,r,u);for(let w=0;w<this.symbolInstances.length;w++){const E=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(g,r,s,E.textBoxStartIndex,E.textBoxEndIndex,E,u),this._updateTextDebugCollisionBoxes(g,r,s,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(h,r,s,E.iconBoxStartIndex,E.iconBoxEndIndex,E,m),this._updateIconDebugCollisionBoxes(h,r,s,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,s,u,m,h,g,w,E,I){const x={};if(s<u){const{x1:C,y1:P,x2:T,y2:M,padding:R,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:W,tileAnchorX:Z,tileAnchorY:H,featureIndex:K}=r.get(s);x.textBox={x1:C,y1:P,x2:T,y2:M,padding:R,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:W,tileAnchorX:Z,tileAnchorY:H},x.textFeatureIndex=K}if(m<h){const{x1:C,y1:P,x2:T,y2:M,padding:R,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:W,tileAnchorX:Z,tileAnchorY:H,featureIndex:K}=r.get(m);x.verticalTextBox={x1:C,y1:P,x2:T,y2:M,padding:R,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:W,tileAnchorX:Z,tileAnchorY:H},x.verticalTextFeatureIndex=K}if(g<w){const{x1:C,y1:P,x2:T,y2:M,padding:R,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:W,tileAnchorX:Z,tileAnchorY:H,featureIndex:K}=r.get(g);x.iconBox={x1:C,y1:P,x2:T,y2:M,padding:R,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:W,tileAnchorX:Z,tileAnchorY:H},x.iconFeatureIndex=K}if(E<I){const{x1:C,y1:P,x2:T,y2:M,padding:R,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:W,tileAnchorX:Z,tileAnchorY:H,featureIndex:K}=r.get(E);x.verticalIconBox={x1:C,y1:P,x2:T,y2:M,padding:R,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:W,tileAnchorX:Z,tileAnchorY:H},x.verticalIconFeatureIndex=K}return x}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,s){const u=r.placedSymbolArray.get(s),m=u.vertexStartIndex+4*u.numGlyphs;for(let h=u.vertexStartIndex;h<m;h+=4)r.indexArray.emplaceBack(h,h+1,h+2),r.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(r),u=Math.cos(r),m=[],h=[],g=[];for(let w=0;w<this.symbolInstances.length;++w){g.push(w);const E=this.symbolInstances.get(w);m.push(0|Math.round(s*E.tileAnchorX+u*E.tileAnchorY)),h.push(E.featureIndex)}return g.sort((w,E)=>m[w]-m[E]||h[E]-h[w]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:I}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),h>=0&&h!==m&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&g!==m&&this.addIndicesForPlacedSymbol(this.text,g),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let fI,pI,pS;qt(Bx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Bx.addDynamicAttributes=jx;class mI{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:du,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt(mI,"FormatSectionOverride",{omit:["defaultValue"]});const mS=()=>pS||(pS={layout:fI||(fI=new ti({"symbol-placement":new Mt(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Mt(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mt(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ut(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mt(Ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Mt(Ke.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Mt(Ke.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Mt(Ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mt(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mt(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mt(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ut(Ke.layout_symbol["icon-size"]),"icon-size-scale-range":new Mt(Ke.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ut(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ut(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ut(Ke.layout_symbol["icon-image"]),"icon-rotate":new Ut(Ke.layout_symbol["icon-rotate"]),"icon-padding":new Mt(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Mt(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Ut(Ke.layout_symbol["icon-offset"]),"icon-anchor":new Ut(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mt(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mt(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mt(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new Ut(Ke.layout_symbol["text-field"]),"text-font":new Ut(Ke.layout_symbol["text-font"]),"text-size":new Ut(Ke.layout_symbol["text-size"]),"text-size-scale-range":new Mt(Ke.layout_symbol["text-size-scale-range"]),"text-max-width":new Ut(Ke.layout_symbol["text-max-width"]),"text-line-height":new Ut(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Ut(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new Ut(Ke.layout_symbol["text-justify"]),"text-radial-offset":new Ut(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mt(Ke.layout_symbol["text-variable-anchor"]),"text-anchor":new Ut(Ke.layout_symbol["text-anchor"]),"text-max-angle":new Mt(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Mt(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new Ut(Ke.layout_symbol["text-rotate"]),"text-padding":new Mt(Ke.layout_symbol["text-padding"]),"text-keep-upright":new Mt(Ke.layout_symbol["text-keep-upright"]),"text-transform":new Ut(Ke.layout_symbol["text-transform"]),"text-offset":new Ut(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new Mt(Ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mt(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new Mt(Ke.layout_symbol["text-optional"]),visibility:new Mt(Ke.layout_symbol.visibility)})),paint:pI||(pI=new ti({"icon-opacity":new Ut(Ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ut(Ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ut(Ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ut(Ke.paint_symbol["text-emissive-strength"]),"icon-color":new Ut(Ke.paint_symbol["icon-color"]),"icon-halo-color":new Ut(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ut(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ut(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Mt(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mt(Ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ut(Ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ut(Ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ut(Ke.paint_symbol["text-occlusion-opacity"]),"text-color":new Ut(Ke.paint_symbol["text-color"],{runtimeType:Ho,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Ut(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new Ut(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Ut(Ke.paint_symbol["text-halo-blur"]),"text-translate":new Mt(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new Mt(Ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Mt(Ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Mt(Ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Mt(Ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Mt(Ke.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ut(Ke.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},pS);class Ux extends No{constructor(r,s,u,m){super(r,mS(),s,u,m),this._colorAdjustmentMatrix=Me.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}recalculate(r,s){super.recalculate(r,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const h of u)m.indexOf(h)<0&&m.push(h);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,s,u,m){return this._saturation===r&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(h,g,w,E){h=de(h),g=ae(g);const I=Me.mat4.create(),x=h/3,C=1-2*x,P=[C,x,x,0,x,C,x,0,x,x,C,0,0,0,0,1],T=.5-.5*g,M=E-w;return Me.mat4.multiply(I,[M,0,0,0,0,M,0,0,0,0,M,0,w,w,w,1],[g,0,0,0,0,g,0,0,0,0,g,0,T,T,T,1]),Me.mat4.multiply(I,I,P),I}(r,s,u,m),this._saturation=r,this._contrast=s,this._brightnessMin=u,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,s,u,m){const h=this.layout.get(r).evaluate(s,{},u,m),g=this._unevaluatedLayout._values[r];return g.isDataDriven()||c_(g.value)||!h?h:function(w,E){return E.replace(/{([^{}]+)}/g,(I,x)=>x in w?String(w[x]):"")}(s.properties,h)}createBucket(r){return new Bx(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of mS().paint.overridableProperties){if(!Ux.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),u=new mI(s),m=new fp(u,s.property.specification,this.scope,this.options);let h=null;h=s.value.kind==="constant"||s.value.kind==="source"?new pp("source",m):new Eu("composite",m,s.value.zoomStops,s.value._interpolationType),this.paint._values[r]=new Pu(s.property,h,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&Ux.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const u=r.get("text-field"),m=mS().paint.properties[s];let h=!1;const g=w=>{for(const E of w)if(m.overrides&&m.overrides.hasOverride(E))return void(h=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ho)g(u.value.value.sections);else if(u.value.kind==="source"){const w=I=>{h||(I instanceof Ts&&Hn(I.value)===Na?g(I.value.sections):I instanceof Fa?g(I.sections):I.eachChild(w))},E=u.value;E._styleExpression&&w(E._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,s,u){return{config:new Mc(this,{zoom:s,lut:u}),overrideFog:!1}}}let gI,_I,yI,vI;var gS=Qr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function _S(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function yS(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class vS{constructor(r,s,u,m){this.context=r,this.format=u,this.useMipmap=m&&m.useMipmap,this.texture=r.gl.createTexture(),this.update(s,{premultiply:m&&m.premultiply})}update(r,s){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,m=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:h}=this,{gl:g}=h,{x:w,y:E}=s&&s.position?s.position:{x:0,y:0},I=Math.max(w+u,this.size?this.size[0]:0),x=Math.max(E+m,this.size?this.size[1]:0);!this.size||this.size[0]===I&&this.size[1]===x||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!s||s.premultiply!==!1));const C=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&I>0&&x>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(I,x)))+1:1;g.texStorage2D(g.TEXTURE_2D,P,this.format,I,x),this.size=[I,x]}if(this.size)if(C)g.texSubImage2D(g.TEXTURE_2D,0,w,E,_S(this.format),yS(this.format),r);else{const P=r.data;P&&g.texSubImage2D(g.TEXTURE_2D,0,w,E,u,m,_S(this.format),yS(this.format),P)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(r,s,u=!1){const{context:m}=this,{gl:h}=m;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(r,s,u,m){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),s!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,s),this.magFilter=s),r!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?r===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),this.wrapS=u),m!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Vx{constructor(r,s){this.context=r,this.texture=s}bind(r,s){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,r),this.minFilter=r),s!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrapS=s)}}function $x(c,r,s,u,m,h,g,w){const E=[c,r,1,s,u,1,m,h,1],I=[g,w,1],x=Me.mat3.adjoint([],E),[C,P,T]=Me.vec3.transformMat3(I,I,x);return Me.mat3.multiply(E,E,[C,0,0,0,P,0,0,0,T])}function xI(c,r,s,u,m,h,g,w){const E=function(I,x,C,P,T,M,R,B){const U=$x(0,0,1,0,1,1,0,1),W=$x(I,x,C,P,T,M,R,B),Z=Me.mat3.adjoint([],U);return Me.mat3.multiply(W,W,Z)}(c,r,s,u,m,h,g,w);return[E[2]/E[8]/Lt,E[5]/E[8]/Lt]}function Gx(c){return[c[0],Math.min(Math.max(c[1],-ui),ui)]}class bI extends uu{constructor(r,s,u,m){super(),this.id=r,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=s,this._dirty=!1}load(r,s){if(this._loaded=s||!1,this.fire(new El("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=Nf(this.map._requestManager.transformRequest(this.url,uc.Image),(u,m)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Cl(u)):m&&(this.image=m instanceof HTMLImageElement?Bt.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Vx(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new El("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Vx||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=r[0][1],u=r[0][1];for(const h of r)h[1]>u&&(u=h[1]),h[1]<s&&(s=h[1]);const m=(u+s)/2;if(m>ui?this.onNorthPole=!0:m<-ui&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=r.map(y.fromLngLat);this.tileID=function(g){let w=1/0,E=1/0,I=-1/0,x=-1/0;for(const R of g)w=Math.min(w,R.x),E=Math.min(E,R.y),I=Math.max(I,R.x),x=Math.max(x,R.y);const C=Math.max(I-w,x-E),P=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),T=Math.pow(2,P);let M=Math.floor((w+I)/2*T);return M>1&&(M-=1),new zt(P,M,Math.floor((E+x)/2*T))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new El("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const U in this.tiles){const W=this.tiles[U];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=Q_(new zt(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(U){const W=U[1].x-U[0].x,Z=U[1].y-U[0].y,H=U[2].x-U[1].x,K=U[2].y-U[1].y,re=U[3].x-U[2].x,se=U[3].y-U[2].y,ge=U[0].x-U[3].x,me=U[0].y-U[3].y,pe=W*K-H*Z,Ee=H*se-re*K,ye=re*me-ge*se,Pe=ge*Z-W*me;return pe>0&&Ee>0&&ye>0&&Pe>0||pe<0&&Ee<0&&ye<0&&Pe<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=Q_(this.tileID,this.map.transform.projection),[h,g,w,E]=this.coordinates.map(U=>{const W=m.projection.project(U[0],U[1]);return aI(m,W)._round()});this.perspectiveTransform=xI(h.x,h.y,g.x,g.y,w.x,w.y,E.x,E.y);const I=this._boundsArray=new Ou;I.emplaceBack(h.x,h.y,0,0),I.emplaceBack(g.x,g.y,Lt,0),I.emplaceBack(E.x,E.y,0,Lt),I.emplaceBack(w.x,w.y,Lt,Lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(I,gS.members),this.boundsSegments=ri.simpleSegment(0,0,4,2);const x=[],C=[Gx((P=this.coordinates)[0]),Gx(P[1]),Gx(P[2]),Gx(P[3])];var P;const[T,M,R,B]=function(U){let W=U[0][0],Z=W,H=U[0][1],K=H;for(let re=1;re<U.length;re++)U[re][0]<W?W=U[re][0]:U[re][0]>Z&&(Z=U[re][0]),U[re][1]<H?H=U[re][1]:U[re][1]>K&&(K=U[re][1]);return[W,H,Z-W,K-H]}(C);{const U=new Ou,[W,Z,H,K]=function(Ve){let We=Ve[0].x,Be=We,lt=Ve[0].y,bt=lt;for(let ct=1;ct<Ve.length;ct++)Ve[ct].x<We?We=Ve[ct].x:Ve[ct].x>Be&&(Be=Ve[ct].x),Ve[ct].y<lt?lt=Ve[ct].y:Ve[ct].y>bt&&(bt=Ve[ct].y);return[We,lt,Be-We,bt-lt]}(u),re=Ve=>[(Ve.x-W)/H,(Ve.y-Z)/K],[se,ge,me,pe]=u.map(re),Ee=function(Ve,We,Be,lt,bt,ct,It,At){const Nt=$x(0,0,1,0,1,1,0,1),pt=$x(Ve,We,Be,lt,bt,ct,It,At),Jt=Me.mat3.adjoint([],pt);return Me.mat3.multiply(Nt,Nt,Jt)}(se[0],se[1],ge[0],ge[1],me[0],me[1],pe[0],pe[1]);this.elevatedGlobePerspectiveTransform=xI(se[0],se[1],ge[0],ge[1],me[0],me[1],pe[0],pe[1]);const ye=(Ve,We)=>{x.push(Ve.lng);const Be=Math.round((Ve.lng-T)/R*Lt),lt=Math.round((Ve.lat-M)/B*Lt),bt=re(We),ct=Me.vec3.transformMat3([],[bt[0],bt[1],1],Ee),It=Math.round(ct[0]/ct[2]*Lt),At=Math.round(ct[1]/ct[2]*Lt);U.emplaceBack(Be,lt,It,At)},Pe=u[3].x-u[0].x,Le=u[3].y-u[0].y,Re=u[2].x-u[1].x,Ne=u[2].y-u[1].y;for(let Ve=0;Ve<65;Ve++){const We=Ve/64,Be=[u[0].x+We*Pe,u[0].y+We*Le],lt=[u[1].x+We*Re,u[1].y+We*Ne],bt=lt[0]-Be[0],ct=lt[1]-Be[1];for(let It=0;It<65;It++){const At=It/64,Nt={x:Be[0]+bt*At,y:Be[1]+ct*At,z:0};ye(s.projection.unproject(Nt.x,Nt.y),Nt)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(U,gS.members)}{this.maxLongitudeTriangleSize=0;let U=[],W=new no;const Z=(H,K,re)=>{W.emplaceBack(H,K,re);const se=x[H],ge=x[K],me=x[re],pe=Math.min(Math.min(se,ge),me),Ee=Math.max(Math.max(se,ge),me)-pe;Ee>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ee),U.push(pe+Ee/2)};for(let H=0;H<64;H++)for(let K=0;K<64;K++){const re=65*H+K,se=re+1,ge=re+65,me=ge+1;Z(re,ge,se),Z(se,ge,me)}[U,W]=function(H,K){const re=Array.from({length:H.length},(me,pe)=>pe);re.sort((me,pe)=>H[me]-H[pe]);const se=[],ge=new no;for(let me=0;me<re.length;me++){const pe=re[me];se.push(H[pe]);const Ee=3*pe,ye=Ee+1;ge.emplaceBack(K.uint16[Ee],K.uint16[ye],K.uint16[ye+1])}return[se,ge]}(U,W),this.elevatedGlobeTrianglesCenterLongitudes=U,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(W)}this.elevatedGlobeSegments=ri.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/Lt,0,B/Lt,0,0,M,T,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof Vx||(this.texture?this.texture.update(this.image):(this.texture=new vS(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(s)}loadTile(r,s){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},s(null)):(r.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let m=(h=r+180)+360*Math.round((u[0]-h)/360);var h;const g=new ri,w=(C,P)=>{g.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:s.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-m)<=E){const C=rt(u,0,u.length,m+E);return C===u.length||w(C,co(u,C+1,u.length,m+360-E)-C),g}m<u[0]&&(m+=360);const I=co(u,0,u.length,m-E);if(I===u.length)return w(0,u.length),g;w(0,I-0);const x=rt(u,I+1,u.length,m+E);return x!==u.length&&w(x,u.length-x),g}}const g8=(Math.pow(256,2)-1)/16907520;class wI extends No{constructor(r,s,u,m){super(r,{layout:yI||(yI=new ti({visibility:new Mt(Ke.layout_raster.visibility)})),paint:vI||(vI=new ti({"raster-opacity":new Mt(Ke.paint_raster["raster-opacity"]),"raster-color":new Iu(Ke.paint_raster["raster-color"]),"raster-color-mix":new Mt(Ke.paint_raster["raster-color-mix"]),"raster-color-range":new Mt(Ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new Mt(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mt(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mt(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Mt(Ke.paint_raster["raster-saturation"]),"raster-contrast":new Mt(Ke.paint_raster["raster-contrast"]),"raster-resampling":new Mt(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Mt(Ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Mt(Ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new Mt(Ke.paint_raster["raster-array-band"]),"raster-elevation":new Mt(Ke.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},s,u,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof bI&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[u,m]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(m)||u===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=F_({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,m])}}let SI,TI,EI,CI,MI;class PI extends No{constructor(r,s,u,m){super(r,{layout:SI||(SI=new ti({visibility:new Mt(Ke["layout_raster-particle"].visibility)})),paint:TI||(TI=new ti({"raster-particle-array-band":new Mt(Ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Mt(Ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Iu(Ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Mt(Ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Mt(Ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Mt(Ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Mt(Ke["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Mt(Ke["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},s,u,m),this._updateColorRamp(),this.lastInvalidatedAt=Bt.now()}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=F_({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Bt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class _8 extends No{constructor(r,s){super(r,{},s,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function xS(c,r,s){const u=[0,0,1],m=Me.quat.identity([]);return Me.quat.rotateY(m,m,s?-je(c)+Math.PI:je(c)),Me.quat.rotateX(m,m,-je(r)),Me.vec3.transformQuat(u,u,m),Me.vec3.normalize(u,u)}function AI(c,r){const s=Hx(c.projection,c.zoom,c.width,c.height),u=function(h,g,w,E,I){const x=new Kr(w.lng-180*Hu,w.lat),C=new Kr(w.lng+180*Hu,w.lat),P=h.project(x.lng,x.lat),T=h.project(C.lng,C.lat),M=-Math.atan2(T.y-P.y,T.x-P.x),R=y.fromLngLat(w);R.y=Ot(R.y,-1+Hu,1-Hu);const B=R.toLngLat(),U=h.project(B.lng,B.lat),W=y.fromLngLat(B);W.x+=Hu;const Z=W.toLngLat(),H=h.project(Z.lng,Z.lat),K=kI(H.x-U.x,H.y-U.y,M),re=y.fromLngLat(B);re.y+=Hu;const se=re.toLngLat(),ge=h.project(se.lng,se.lat),me=kI(ge.x-U.x,ge.y-U.y,M),pe=Math.abs(K.x)/Math.abs(me.y),Ee=Me.mat4.identity([]);Me.mat4.rotateZ(Ee,Ee,-M*(1-(I?0:E)));const ye=Me.mat4.identity([]);return Me.mat4.scale(ye,ye,[1,1-(1-pe)*E,1]),ye[4]=-me.x/me.y*E,Me.mat4.rotateZ(ye,ye,M),Me.mat4.multiply(ye,Ee,ye),ye}(c.projection,0,c.center,s,r),m=II(c);return Me.mat4.scale(u,u,[m,m,1]),u}function II(c){const r=c.projection,s=Hx(c.projection,c.zoom,c.width,c.height),u=bS(r,c.center),m=bS(r,Kr.convert(r.center));return Math.pow(2,u*s+(1-s)*m)}function Hx(c,r,s,u,m=1/0){const h=c.range;if(!h)return 0;const g=Math.min(m,Math.max(s,u)),w=Math.log(g/1024)/Math.LN2;return Ur(h[0]+w,h[1]+w,r)}const Hu=1/4e4;function bS(c,r){const s=Ot(r.lat,-ui,ui),u=new Kr(r.lng-180*Hu,s),m=new Kr(r.lng+180*Hu,s),h=c.project(u.lng,s),g=c.project(m.lng,s),w=y.fromLngLat(u),E=y.fromLngLat(m),I=g.x-h.x,x=g.y-h.y,C=E.x-w.x,P=E.y-w.y,T=Math.sqrt((C*C+P*P)/(I*I+x*x));return Math.log(T)/Math.LN2}function kI(c,r,s){const u=Math.cos(s),m=Math.sin(s);return{x:c*u-r*m,y:c*m+r*u}}function RI(c,r,s){Me.mat4.identity(c),Me.mat4.rotateZ(c,c,je(r[2])),Me.mat4.rotateX(c,c,je(r[0])),Me.mat4.rotateY(c,c,je(r[1])),Me.mat4.scale(c,c,s),Me.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function qx(c,r,s,u,m,h,g,w){const E=[s[0]-r[0],s[1]-r[1],0],I=[u[0]-r[0],u[1]-r[1],0];if(Me.vec3.length(E)<1e-12||Me.vec3.length(I)<1e-12)return Me.quat.identity(c);const x=Me.vec3.cross([],E,I);Me.vec3.normalize(x,x),Me.vec3.subtract(I,u,r),E[2]=(h-m)*w,I[2]=(g-m)*w;const C=E;return Me.vec3.cross(C,E,I),Me.vec3.normalize(C,C),Me.quat.rotationTo(c,x,C)}function wS(c,r,s=!1){const u=mo(r.zoom),m=function(h,g,w){const E=g.worldSize,I=[h[12],h[13],h[14]],x=Ki(I[1]/E),C=Jo(I[0]/E),P=Me.mat4.identity([]),T=Co(1,x)*E,M=Co(1,0)*E*n(x,g.zoom),R=1/Fo(E);let B=M*R;if(w){const H=Hx(g.projection,g.zoom,g.width,g.height,1024);B=R*g.projection.pixelSpaceConversion(g.center.lat,E,H)}const U=Ic(x,C);Me.vec3.add(U,U,Me.vec3.scale([],Me.vec3.normalize([],U),T*B*I[2]));const W=function(H){const K=[H[0],H[1],H[2]];let re=[0,1,0];const se=Me.vec3.cross([],re,K);return Me.vec3.cross(re,K,se),Me.vec3.squaredLength(re)===0&&(re=[0,1,0],Me.vec3.cross(se,K,re)),Me.vec3.normalize(se,se),Me.vec3.normalize(re,re),Me.vec3.normalize(K,K),[se[0],se[1],se[2],0,re[0],re[1],re[2],0,K[0],K[1],K[2],0,H[0],H[1],H[2],1]}(U);Me.mat4.scale(P,P,[B,B,B*T]),Me.mat4.translate(P,P,[-I[0],-I[1],-I[2]]);const Z=Me.mat4.multiply([],g.globeMatrix,W);return Me.mat4.multiply(Z,Z,P),Me.mat4.multiply(Z,Z,h),Z}(c,r,s);if(u>0){const h=function(g,w){const E=w.worldSize,I=Co(1,0)*E*n(w.center.lat,w.zoom)/Fo(E),x=Co(1,w.center.lat)*E,C=Me.mat4.identity([]);return Me.mat4.rotateY(C,C,je(w.center.lng)),Me.mat4.rotateX(C,C,je(w.center.lat)),Me.mat4.translate(C,C,[0,0,fo]),Me.mat4.scale(C,C,[I,I,I*x]),Me.mat4.translate(C,C,[w.point.x-.5*E,w.point.y-.5*E,0]),Me.mat4.multiply(C,C,g),Me.mat4.multiply(C,w.globeMatrix,C)}(c,r);return function(g,w,E){const I=(M,R,B)=>{const U=Me.vec3.length(M),W=Me.vec3.length(R),Z=mi(M,R,B);return Me.vec3.scale(Z,Z,1/Me.vec3.length(Z)*pr(U,W,B))},x=I([g[0],g[1],g[2]],[w[0],w[1],w[2]],E),C=I([g[4],g[5],g[6]],[w[4],w[5],w[6]],E),P=I([g[8],g[9],g[10]],[w[8],w[9],w[10]],E),T=mi([g[12],g[13],g[14]],[w[12],w[13],w[14]],E);return[x[0],x[1],x[2],0,C[0],C[1],C[2],0,P[0],P[1],P[2],0,T[0],T[1],T[2],1]}(m,h,u)}return m}function DI(c,r,s,u){const m=hr.projectAabbCorners(u,s);let h=Number.MAX_VALUE,g=-1;for(let I=0;I<m.length;++I){const x=m[I];x[0]=(.5*x[0]+.5)*r.width,x[1]=(.5-.5*x[1])*r.height,x[2]<h&&(g=I,h=x[2])}const w=I=>new vt(m[I][0],m[I][1]);let E;switch(g){case 0:case 6:E=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:E=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:E=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:E=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(ce(c,E))return h}const y8=Qr([{name:"a_pos_3f",components:3,type:"Float32"}]),v8=Qr([{name:"a_color_3f",components:3,type:"Float32"}]),x8=Qr([{name:"a_color_4f",components:4,type:"Float32"}]),b8=Qr([{name:"a_uv_2f",components:2,type:"Float32"}]),w8=Qr([{name:"a_normal_3f",components:3,type:"Float32"}]),S8=Qr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),T8=Qr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),LI={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Wx{constructor(r,s,u,m){this.message=(r?`${r}: `:"")+u,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)}}function OI(c,r){const s=c.indexOf("://")===-1;try{return new URL(c,s&&r?"http://example.com":void 0),!0}catch{return!1}}class zI{constructor(r,s){this.feature=r,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class NI{constructor(){this.instancedDataArray=new Ip,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class SS{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=r.projection,this.index=r.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(r,s){}populate(r,s,u,m){this.tileToMeter=p(u);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:w,index:E,sourceLayerIndex:I}of r){const x=w??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),C=q(g,h);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),C,u))continue;const P={id:x,sourceLayerIndex:I,index:E,geometry:h?C.geometry:V(g,u,m),properties:g.properties,type:g.type,patterns:{}},T=this.addFeature(P,P.geometry,C);T&&s.featureIndex.insert(g,P.geometry,E,I,this.index,this.instancesPerModel[T].instancedDataArray.length,Lt/32)}this.lookup=null}update(r,s,u,m){for(const h in this.instancesPerModel){const g=this.instancesPerModel[h];for(const w in r)g.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(g.features[g.idToFeaturesIndex[w]],r[w],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];for(const m of u.features){const h=this.layers[0],g=m.feature,w=this.canonical,E=h.paint.get("model-rotation").evaluate(g,{},w),I=h.paint.get("model-scale").evaluate(g,{},w),x=h.paint.get("model-translation").evaluate(g,{},w);Me.vec3.exactEquals(m.rotation,E)&&Me.vec3.exactEquals(m.scale,I)&&Me.vec3.exactEquals(m.translation,x)||(this.evaluate(m,m.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,s,u,m){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(Z2(this.activeReplacements,h))return!1;this.activeReplacements=h;let g=!1;for(const w in this.instancesPerModel){const E=this.instancesPerModel[w],I=E.instancedDataArray;for(const x of E.features){const C=x.instancedDataOffset,P=x.instancedDataCount;for(let T=0;T<P;T++){const M=16*(T+C);let R=I.float32[M+0];const B=R>Lt;R=B?R-Lt:R;const U=Math.floor(R),W=I.float32[M+1];let Z=!1;for(const H of this.activeReplacements)if(!KP(H,u,LI.Model,m)&&!(H.min.x>U||U>H.max.x||H.min.y>W||W>H.max.y)&&(Z=nA(rA(U,W,r.canonical,H.footprintTileId.canonical),H.footprint),Z))break;I.float32[M]=Z?R+Lt:R,g=g||Z!==B}}}return g}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,S8.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris)for(const s of this.modelUris)r.removeModel(s,"")}addFeature(r,s,u){const m=this.layers[0],h=m.layout.get("model-id").evaluate(u,{},this.canonical);if(!h)return Gt(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),h;OI(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new NI);const g=this.instancesPerModel[h],w=g.instancedDataArray,E=new zI(u,w.length);for(const I of s)for(const x of I){if(x.x<0||x.x>=Lt||x.y<0||x.y>=Lt)continue;const C=(this.lookupDim-1)/Lt,P=this.lookupDim*(x.y*C|0)+x.x*C|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const T=w.length;w.resize(T+1),g.instancesEvaluatedElevation.push(0),w.float32[16*T]=x.x,w.float32[16*T+1]=x.y}return E.instancedDataCount=g.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(r.id&&(g.idToFeaturesIndex[r.id]=g.features.length),g.features.push(E),this.evaluate(E,{},g,!1)),h}getModelUris(){return this.modelUris}evaluate(r,s,u,m){const h=this.layers[0],g=r.feature,w=this.canonical,E=r.rotation=h.paint.get("model-rotation").evaluate(g,s,w),I=r.scale=h.paint.get("model-scale").evaluate(g,s,w),x=r.translation=h.paint.get("model-translation").evaluate(g,s,w),C=h.paint.get("model-color").evaluate(g,s,w);C.a=h.paint.get("model-color-mix-intensity").evaluate(g,s,w);const P=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),RI(P,E,I);const T=Math.round(100*C.a)+C.b/1.05;for(let M=0;M<r.instancedDataCount;++M){const R=r.instancedDataOffset+M,B=16*R,U=u.instancedDataArray.float32;let W=0;m&&(W=U[B+6]-u.instancesEvaluatedElevation[R]);const Z=0|U[B+1];U[B]=(0|U[B])+C.r/1.05,U[B+1]=Z+C.g/1.05,U[B+2]=T,U[B+3]=1/(w.z>10?this.tileToMeter:p(w,Z)),U[B+4]=x[0],U[B+5]=x[1],U[B+6]=x[2]+W,U[B+7]=P[0],U[B+8]=P[1],U[B+9]=P[2],U[B+10]=P[4],U[B+11]=P[5],U[B+12]=P[6],U[B+13]=P[8],U[B+14]=P[9],U[B+15]=P[10],u.instancesEvaluatedElevation[R]=x[2]}}}let FI,jI;qt(SS,"ModelBucket",{omit:["layers"]}),qt(NI,"PerModelAttributes"),qt(zI,"ModelFeature");const kh=64,Yp={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function BI(c,r,s,u,m,h,g,w,E,I=!1){const x=s.zoom,C=s.project(u),P=n(u.lat,x),T=1/P;Me.mat4.identity(c),Me.mat4.translate(c,c,[C.x+g[0]*T,C.y+g[1]*T,g[2]]);let M=1,R=1;const B=s.worldSize;if(I){if(s.projection.name==="mercator"){let H=0;s.elevation&&(H=s.elevation.getAtPointOrZero(new y(C.x/B,C.y/B),0));const K=Me.vec4.transformMat4([],[C.x,C.y,H,1],s.projMatrix)[3]/s.cameraToCenterDistance;M=K,R=K*n(s.center.lat,x)}else if(s.projection.name==="globe"){const H=wS(c,s),K=Me.mat4.multiply([],s.projMatrix,H),re=[0,0,0,1];Me.vec4.transformMat4(re,re,K);const se=re[3]/s.cameraToCenterDistance,ge=mo(x),me=s.projection.pixelsPerMeter(u.lat,B)*n(u.lat,x),pe=s.projection.pixelsPerMeter(s.center.lat,B)*n(s.center.lat,x);M=se/pr(me,f(s.center.lat),ge),R=se*P/me,M*=pe,R*=pe}}else M=T;Me.mat4.scale(c,c,[M,M,R]);const U=[...c],W=r.orientation,Z=[];if(RI(Z,[W[0]+m[0],W[1]+m[1],W[2]+m[2]],h),Me.mat4.multiply(c,U,Z),w&&s.elevation){let H=0;const K=[];if(E&&s.elevation){H=function(ge,me,pe,Ee,ye){const Pe=me.elevation;if(!Pe)return 0;const Le=hr.projectAabbCorners(pe,Ee),Re=Co(1,ye.lat)*me.worldSize,Ne=function(Jt,kt){const Zt=[0,0,1],ur=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Pr of ur){const Ir=Jt[Pr.corners[0]],zr=Jt[Pr.corners[1]],kr=Jt[Pr.corners[2]],jr=[zr[0]-Ir[0],zr[1]-Ir[1],kt*(zr[2]-Ir[2])],En=Me.vec3.cross(jr,jr,[kr[0]-Ir[0],kr[1]-Ir[1],kt*(kr[2]-Ir[2])]);Me.vec3.normalize(En,En),Pr.dotProductWithUp=Me.vec3.dot(En,Zt)}return ur.sort((Pr,Ir)=>Pr.dotProductWithUp-Ir.dotProductWithUp),ur[0].corners}(Le,Re),Ve=Le[Ne[0]],We=Le[Ne[1]],Be=Le[Ne[2]],lt=Le[Ne[3]],bt=Pe.getAtPointOrZero(new y(Ve[0]/me.worldSize,Ve[1]/me.worldSize),0),ct=Pe.getAtPointOrZero(new y(We[0]/me.worldSize,We[1]/me.worldSize),0),It=Pe.getAtPointOrZero(new y(Be[0]/me.worldSize,Be[1]/me.worldSize),0),At=Pe.getAtPointOrZero(new y(lt[0]/me.worldSize,lt[1]/me.worldSize),0),Nt=(bt+At)/2,pt=(ct+It)/2;return Nt>pt?ct<It?qx(ge,We,lt,Ve,ct,At,bt,Re):qx(ge,Be,Ve,lt,It,bt,At,Re):bt<At?qx(ge,Ve,We,Be,bt,ct,It,Re):qx(ge,lt,Be,We,At,It,ct,Re),Math.max(Nt,pt)}(K,s,r.aabb,c,u);const re=Me.mat4.fromQuat([],K),se=Me.mat4.multiply([],re,Z);Me.mat4.multiply(c,U,se)}else H=s.elevation.getAtPointOrZero(new y(C.x/B,C.y/B),0);H!==0&&(c[14]+=H)}}function iy(c,r,s=!1){c.uploaded||(c.gfxTexture=new vS(r,c.image,s?r.gl.R8:r.gl.RGBA8,{useMipmap:c.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function E8(c,r,s){c.indexBuffer=r.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=r.createVertexBuffer(c.vertexArray,y8.members,!1,!0),c.normalArray&&(c.normalBuffer=r.createVertexBuffer(c.normalArray,w8.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=r.createVertexBuffer(c.texcoordArray,b8.members,!1,!0)),c.colorArray&&(c.colorBuffer=r.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?v8:x8).members,!1,!0)),c.featureArray&&(c.pbrBuffer=r.createVertexBuffer(c.featureArray,T8.members,!0)),c.segments=ri.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const u=c.material;u.pbrMetallicRoughness.baseColorTexture&&iy(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&iy(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&iy(u.normalTexture,r),u.occlusionTexture&&iy(u.occlusionTexture,r,s),u.emissionTexture&&iy(u.emissionTexture,r)}function TS(c,r,s){if(c.meshes)for(const u of c.meshes)E8(u,r,s);if(c.children)for(const u of c.children)TS(u,r,s)}function Zx(c){if(c.meshes)for(const r of c.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(c.children)for(const r of c.children)Zx(r)}function ES(c){if(c.meshes)for(const s of c.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((r=s.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(c.children)for(const s of c.children)ES(s)}class Xp{constructor(r,s,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(r,s,u){const m=u||r.findDEMTileFor(s);if(!m||!m.dem)return;const h=m.dem,g=m.tileID,w=1<<s.canonical.z-g.canonical.z;return new Xp(m,h.dim/Lt/w,[(s.canonical.x/w-g.canonical.x)*h.dim,(s.canonical.y/w-g.canonical.y)*h.dim])}tileCoordToPixel(r,s){const u=s*this._scale+this._offset[1],m=Math.floor(r*this._scale+this._offset[0]),h=Math.floor(u);return new vt(m,h)}getElevationAt(r,s,u,m){const h=r*this._scale+this._offset[0],g=s*this._scale+this._offset[1],w=Math.floor(h),E=Math.floor(g),I=this._dem;return m=!!m,u?pr(pr(I.get(w,E,m),I.get(w,E+1,m),g-E),pr(I.get(w+1,E,m),I.get(w+1,E+1,m),g-E),h-w):I.get(w,E,m)}getElevationAtPixel(r,s,u){return this._dem.get(r,s,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Co(1,r)*this._dem.stride}}const CS=new Float32Array(262144),Rh=new Uint8Array(262144);function UI(c){let r=0;if(c.meshes)for(const s of c.meshes)r=Math.max(r,s.aabb.max[2]);if(c.children)for(const s of c.children)r=Math.max(r,UI(s));return r}function VI(c,r,s){if(c.meshes)for(const u of c.meshes){if(u.aabb.min[0]===1/0)continue;const m=hr.applyTransform(u.aabb,c.matrix);s.insert(r,m.min[0],m.min[1],m.max[0],m.max[1])}if(c.children)for(const u of c.children)VI(u,r,s)}const $I=["","wall","door","roof","window","lamp","logo"];class GI{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:UI(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const s=new hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=hr.applyTransformFast(u.aabb,this.node.matrix),s.encapsulate(u.transformedAabb)),r++;this.aabb=s}return this.aabb}}class Yx{constructor(r,s,u,m,h,g,w){this.id=u,this.layers=r,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=Yp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=Yp.HasMapboxMeshFeatures),h&&(this.modelTraits|=Yp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const E of s)this.nodesInfo.push(new GI(E)),VI(E,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(r,s){for(const u of this.getNodesInfo()){const m=u.node;m.footprint&&s.push({footprint:m.footprint,id:r})}}update(r){const s=Object.keys(r).length!==0;if(s&&!this.stateDependentLayers.length)return;const u=s?this.stateDependentLayers:this.layers;if(!Mn(r,this.states))for(const m of u)this.evaluate(m,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const u of s){const m=u.node;this.uploaded?this.updatePbrBuffer(m):TS(m,r,!0)}for(const u of s)Zx(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let s=!1;if(!r.meshes)return s;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(r,s,u){const m=r.transform.projectionOptions,h=r.style.getBrightness(),g=this.brightness!==h;if(!this.uploaded||this.dirty||m.name!==this.projection.name||oy(u.paint.get("model-color").value,g)||oy(u.paint.get("model-color-mix-intensity").value,g)||oy(u.paint.get("model-roughness").value,g)||oy(u.paint.get("model-emissive-strength").value,g)||oy(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=m,this.brightness=h;const w=this.getNodesInfo();for(const E of w)E.state=null;return!0}return!1}evaluateScale(r,s){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),m=this.id.canonical;for(const h of u){const g=h.feature;h.evaluatedScale=s.paint.get("model-scale").evaluate(g,{},m)}}evaluate(r,s){const u=this.getNodesInfo();for(const m of u){if(!m.node.meshes)continue;const h=m.feature,g=s&&s[h.id];if(Mn(g,m.state))continue;m.state=structuredClone(g);const w=m.node.meshes&&m.node.meshes[0].featureData,E=m.evaluatedColor[2],I=m.evaluatedRMEA[2],x=this.id.canonical;if(m.hasTranslucentParts=!1,w){for(let C=0;C<$I.length;C++){const P=$I[C];P.length&&(h.properties.part=P);const T=r.paint.get("model-color").evaluate(h,g,x).toRenderColor(null),M=r.paint.get("model-color-mix-intensity").evaluate(h,g,x);m.evaluatedColor[C]=[T.r,T.g,T.b,M],m.evaluatedRMEA[C][0]=r.paint.get("model-roughness").evaluate(h,g,x),m.evaluatedRMEA[C][2]=r.paint.get("model-emissive-strength").evaluate(h,g,x),m.evaluatedRMEA[C][3]=T.a,m.emissionHeightBasedParams[C]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,g,x),!m.hasTranslucentParts&&T.a<1&&(m.hasTranslucentParts=!0)}delete h.properties.part,M8(m,E!==m.evaluatedColor[2]||I!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(h,g,x);m.evaluatedScale=r.paint.get("model-scale").evaluate(h,g,x),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,s,u,m){const h=r.findDEMTileFor(u);if(h&&(h.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const g=Xp.create(r,u,h);if(!g)return;this.modelTraits&Yp.HasMapboxMeshFeatures&&this.updateDEM(r,g,u,m);for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const I=E.footprint.vertices;let x=g.getElevationAt(I[0].x,I[0].y,!0,!0);for(let C=1;C<I.length;C++)x=Math.min(x,g.getElevationAt(I[C].x,I[C].y,!0,!0));E.elevation=x}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=s}}updateDEM(r,s,u,m){let h=s._dem._modifiedForSources[m];if(h===void 0&&(s._dem._modifiedForSources[m]=[],h=s._dem._modifiedForSources[m]),h.includes(u.canonical))return;const g=s._dem.dim;h.push(u.canonical);let w=!1;for(const E of this.getNodesInfo()){const I=E.node;if(!I.footprint||!I.footprint.grid)continue;const x=I.footprint.grid,C=s.tileCoordToPixel(x.min.x,x.min.y),P=s.tileCoordToPixel(x.max.x,x.max.y),T=Math.min(Math.min(g-P.y,C.x),Math.min(C.y,g-P.x));if(T<0)continue;const M=Ot(T,2,5);let R=Math.max(0,C.x-M),B=Math.max(0,C.y-M),U=Math.min(P.x+M,g-1),W=Math.min(P.y+M,g-1);for(let re=B;re<=W;++re)for(let se=R;se<=U;++se)Rh[re*g+se]=255;let Z=0,H=0;for(let re=0;re<x.cellsY;++re)for(let se=0;se<x.cellsX;++se){if(!x.cells[re*x.cellsX+se])continue;const ge=s.tileCoordToPixel(x.min.x+se/x.xScale,x.min.y+re/x.yScale),me=s.tileCoordToPixel(x.min.x+(se+1)/x.xScale,x.min.y+(re+1)/x.yScale);for(let pe=ge.y;pe<=Math.min(me.y+1,g-1);++pe)for(let Ee=ge.x;Ee<=Math.min(me.x+1,g-1);++Ee)Rh[pe*g+Ee]===255&&(Rh[pe*g+Ee]=0,Z+=s.getElevationAtPixel(Ee,pe),H++)}const K=Z/H;R=Math.max(1,C.x-M),B=Math.max(1,C.y-M),U=Math.min(P.x+M,g-2),W=Math.min(P.y+M,g-2),w=!0;for(let re=B;re<=W;++re)for(let se=R;se<=U;++se)Rh[re*g+se]===0&&(CS[re*g+se]=s._dem.set(se,re,K));for(let re=1;re<M;++re){R=Math.max(1,C.x-re),B=Math.max(1,C.y-re),U=Math.min(P.x+re,g-2),W=Math.min(P.y+re,g-2);for(let se=B;se<=W;++se)for(let ge=R;ge<=U;++ge){const me=se*g+ge;if(Rh[me]===255){let pe=0,Ee=0,ye=-1,Pe=-1;for(let Le=-1;Le<=1;++Le)for(let Re=-1;Re<=1;++Re){const Ne=(se+Le)*g+ge+Re;if(Rh[Ne]>=re)continue;const Ve=CS[Ne],We=Math.abs(Ve);We>Ee&&(pe=Ve,Ee=We,ye=Re,Pe=Le)}if(Ee>.1){const Le=1-(re+.5*Math.abs(ye*Pe))/M;let Re=s._dem.get(ge,se)+pe*Le;const Ne=s._dem.get(ge+ye,se+Pe),Ve=s._dem.get(ge-ye,se-Pe,!0);(Re-Ne)*(Re-Ve)>0&&(Re=(Ne+Ve)/2),CS[me]=s._dem.set(ge,se,Re),Rh[me]=re}}}}}w&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=Bt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const s of r)Zx(s.node),ES(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(r.toUnwrapped()),m=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const g=m[h].node;m[h].hiddenByReplacement=!!g.footprint&&!u.find(w=>w.footprint===g.footprint)}}getHeightAtTileCoord(r,s){const u=this.getNodesInfo(),m=[],h=[0,0,0],g=Me.mat4.identity([]);for(let w=0;w<this.nodesInfo.length;w++){const E=u[w],I=E.node.meshes[0],x=I.transformedAabb;if(r<x.min[0]||s<x.min[1]||r>x.max[0]||s>x.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};Me.mat4.invert(g,E.node.matrix),h[0]=r,h[1]=s,Me.vec3.transformMat4(h,h,g);const C=(h[0]-I.aabb.min[0])/(I.aabb.max[0]-I.aabb.min[0])*kh|0,P=Math.min(63,(h[1]-I.aabb.min[1])/(I.aabb.max[1]-I.aabb.min[1])*kh|0)*kh+Math.min(63,C),T=I.heightmap[P];if(!(T<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:T,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new vt(r,s),new vt(r,s),m),m.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function oy(c,r){return!c.isLightConstant&&r}function C8(c,r,s,u,m,h,g,w){let E=(61440&r|(61440&r)>>4)>>8,I=(3840&r|(3840&r)>>4)>>4,x=240&r|(240&r)>>4;s[3]>0&&(E=pr(E,255*s[0],s[3]),I=pr(I,255*s[1],s[3]),x=pr(x,255*s[2],s[3]));const C=E<<8|I,P=x<<8|Math.floor(255*u[3]),T=function(re){const se=Ot(re,0,2);return Math.min(Math.round(.5*se*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],M=Ot(m[0],0,1),R=Ot(m[1],0,1),B=Ot(m[2],0,1),U=Ot(m[3],0,1);let W,Z,H,K;if(M!==R&&g!==h&&R!==M){const re=g-h;Z=1/(re*(R-M)),H=-(h+re*M)/(re*(R-M));const se=Ot(m[4],-1,1);K=Math.pow(10,se),W=255*B<<8|255*U}else W=65535,Z=0,H=1,K=1;if(c.emplaceBack(C,P,T,W,Z,H,K),w){const re=w.length;w.clear();for(let se=0;se<re;se++)w.emplaceBack(C,P,T,W,Z,H,K)}}function M8(c,r,s){const u=c.node;let m=0;const h=s&Yp.HasMeshoptCompression;for(const g of u.meshes){if(u.lights&&u.lightMeshIndex===m||!g.featureData)continue;g.featureArray=new kp,g.featureArray.reserve(g.featureData.length);let w=r;for(const E of g.featureData){const I=h?65535&E:E>>16&65535,x=h?E>>16&65535:65535&E,C=(15&x)<8?15&x:0,P=c.evaluatedRMEA[C],T=c.evaluatedColor[C],M=c.emissionHeightBasedParams[C];let R;if(w&&C===2&&u.lights&&(R=new kp,R.resize(10*u.lights.length)),C8(g.featureArray,I,T,P,M,g.aabb.min[2],g.aabb.max[2],R),R&&w){w=!1;const B=u.meshes[u.lightMeshIndex];B.featureArray=R,B.featureArray._trim()}}g.featureArray._trim(),m++}}function HI(c,r,s,u){const m=1<<c.z;r.lat=Ki((u/Lt+c.y)/m),r.lng=Jo((s/Lt+c.x)/m)}qt(Yx,"Tiled3dModelBucket",{omit:["layers"]}),qt(GI,"Tiled3dModelFeature");const P8={circle:class extends No{constructor(c,r,s,u){super(c,{layout:mt||(mt=new ti({"circle-sort-key":new Ut(Ke.layout_circle["circle-sort-key"]),visibility:new Mt(Ke.layout_circle.visibility)})),paint:ot||(ot=new ti({"circle-radius":new Ut(Ke.paint_circle["circle-radius"]),"circle-color":new Ut(Ke.paint_circle["circle-color"]),"circle-blur":new Ut(Ke.paint_circle["circle-blur"]),"circle-opacity":new Ut(Ke.paint_circle["circle-opacity"]),"circle-translate":new Mt(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Mt(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mt(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mt(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ut(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ut(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ut(Ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Mt(Ke.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}createBucket(c){return new le(c)}queryRadius(c){const r=c;return ht("circle-radius",this,r)+ht("circle-stroke-width",this,r)+xt(this.paint.get("circle-translate"))}queryIntersectsFeature(c,r,s,u,m,h,g,w){const E=Ye(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s);return bP(c,u,h,g,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,r,s){const u=Up(this);return{config:new Mc(this,{zoom:r,lut:s}),defines:u,overrideFog:!1}}},heatmap:class extends No{createBucket(c){return new SP(c)}constructor(c,r,s,u){super(c,{layout:TP||(TP=new ti({visibility:new Mt(Ke.layout_heatmap.visibility)})),paint:EP||(EP=new ti({"heatmap-radius":new Ut(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ut(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mt(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Iu(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mt(Ke.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=F_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return ht("heatmap-radius",this,c)}queryIntersectsFeature(c,r,s,u,m,h,g,w){const E=this.paint.get("heatmap-radius").evaluate(r,s);return bP(c,u,h,g,w,!0,!0,new vt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,r,s){return c==="heatmap"?{config:new Mc(this,{zoom:r,lut:s}),overrideFog:!1}:{}}},hillshade:class extends No{constructor(c,r,s,u){super(c,{layout:CP||(CP=new ti({visibility:new Mt(Ke.layout_hillshade.visibility)})),paint:MP||(MP=new ti({"hillshade-illumination-direction":new Mt(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mt(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mt(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mt(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mt(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mt(Ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Mt(Ke.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,r,s){return{overrideFog:!1}}},fill:class extends No{constructor(c,r,s,u){super(c,{layout:zP||(zP=new ti({"fill-sort-key":new Ut(Ke.layout_fill["fill-sort-key"]),visibility:new Mt(Ke.layout_fill.visibility),"fill-elevation-reference":new Mt(Ke.layout_fill["fill-elevation-reference"])})),paint:NP||(NP=new ti({"fill-antialias":new Mt(Ke.paint_fill["fill-antialias"]),"fill-opacity":new Ut(Ke.paint_fill["fill-opacity"]),"fill-color":new Ut(Ke.paint_fill["fill-color"]),"fill-outline-color":new Ut(Ke.paint_fill["fill-outline-color"]),"fill-translate":new Mt(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Mt(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ut(Ke.paint_fill["fill-pattern"]),"fill-emissive-strength":new Mt(Ke.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ut(Ke.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}getProgramIds(){const c=this.paint.get("fill-pattern"),r=c&&c.constantOr(1),s=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(c,r,s){return{config:new Mc(this,{zoom:r,lut:s}),overrideFog:!1}}recalculate(c,r){super.recalculate(c,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new V2(c)}queryRadius(){return xt(this.paint.get("fill-translate"))}queryIntersectsFeature(c,r,s,u,m,h){return!c.queryGeometry.isAboveHorizon&&ve(Pt(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends No{constructor(c,r,s,u){super(c,{layout:yA||(yA=new ti({visibility:new Mt(Ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Mt(Ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:vA||(vA=new ti({"fill-extrusion-opacity":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ut(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ut(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ut(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ut(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ut(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ut(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ut(Ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ut(Ke["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Mt(Ke["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new Ex(c)}queryRadius(){return xt(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,r,s,u,m,h,g,w,E){const I=Ye(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(r,s),C=this.paint.get("fill-extrusion-base").evaluate(r,s),P=[0,0],T=w&&h.elevation,M=h.elevation?h.elevation.exaggeration():1,R=c.tile.getBucket(this);if(T&&R instanceof Ex){const H=R.centroidVertexArray,K=E+1;K<H.length&&(P[0]=H.geta_centroid_pos0(K),P[1]=H.geta_centroid_pos1(K))}if(P[0]===0&&P[1]===1)return!1;h.projection.name==="globe"&&(u=_A([u],[new vt(0,0),new vt(Lt,Lt)],c.tileID.canonical).map(H=>H.polygon).flat());const B=T?w:null,[U,W]=function(H,K,re,se,ge,me,pe,Ee,ye,Pe,Le){return H.projection.name==="globe"?function(Re,Ne,Ve,We,Be,lt,bt,ct,It,At,Nt){const pt=[],Jt=[],kt=Re.projection.upVectorScale(Nt,Re.center.lat,Re.worldSize).metersToTile,Zt=[0,0,0,1],ur=[0,0,0,1],Pr=(zr,kr,jr,En)=>{zr[0]=kr,zr[1]=jr,zr[2]=En,zr[3]=1},Ir=gA();Ve>0&&(Ve+=Ir),We+=Ir;for(const zr of Ne){const kr=[],jr=[];for(const En of zr){const vn=En.x+Be.x,br=En.y+Be.y,xn=Re.projection.projectTilePoint(vn,br,Nt),pn=Re.projection.upVector(Nt,En.x,En.y);let Cn=Ve,bi=We;if(bt){const wi=bA(vn,br,Ve,We,bt,ct,It,At);Cn+=wi.base,bi+=wi.top}Ve!==0?Pr(Zt,xn.x+pn[0]*kt*Cn,xn.y+pn[1]*kt*Cn,xn.z+pn[2]*kt*Cn):Pr(Zt,xn.x,xn.y,xn.z),Pr(ur,xn.x+pn[0]*kt*bi,xn.y+pn[1]*kt*bi,xn.z+pn[2]*kt*bi),Me.vec3.transformMat4(Zt,Zt,lt),Me.vec3.transformMat4(ur,ur,lt),kr.push(new Ih(Zt[0],Zt[1],Zt[2])),jr.push(new Ih(ur[0],ur[1],ur[2]))}pt.push(kr),Jt.push(jr)}return[pt,Jt]}(H,K,re,se,ge,me,pe,Ee,ye,Pe,Le):pe?function(Re,Ne,Ve,We,Be,lt,bt,ct,It){const At=[],Nt=[],pt=[0,0,0,1];for(const Jt of Re){const kt=[],Zt=[];for(const ur of Jt){const Pr=ur.x+We.x,Ir=ur.y+We.y,zr=bA(Pr,Ir,Ne,Ve,lt,bt,ct,It);pt[0]=Pr,pt[1]=Ir,pt[2]=zr.base,pt[3]=1,Me.vec4.transformMat4(pt,pt,Be),pt[3]=Math.max(pt[3],1e-5);const kr=new Ih(pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]);pt[0]=Pr,pt[1]=Ir,pt[2]=zr.top,pt[3]=1,Me.vec4.transformMat4(pt,pt,Be),pt[3]=Math.max(pt[3],1e-5);const jr=new Ih(pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]);kt.push(kr),Zt.push(jr)}At.push(kt),Nt.push(Zt)}return[At,Nt]}(K,re,se,ge,me,pe,Ee,ye,Pe):function(Re,Ne,Ve,We,Be){const lt=[],bt=[],ct=Be[8]*Ne,It=Be[9]*Ne,At=Be[10]*Ne,Nt=Be[11]*Ne,pt=Be[8]*Ve,Jt=Be[9]*Ve,kt=Be[10]*Ve,Zt=Be[11]*Ve;for(const ur of Re){const Pr=[],Ir=[];for(const zr of ur){const kr=zr.x+We.x,jr=zr.y+We.y,En=Be[0]*kr+Be[4]*jr+Be[12],vn=Be[1]*kr+Be[5]*jr+Be[13],br=Be[2]*kr+Be[6]*jr+Be[14],xn=Be[3]*kr+Be[7]*jr+Be[15],pn=En+ct,Cn=vn+It,bi=br+At,wi=Math.max(xn+Nt,1e-5),di=En+pt,es=vn+Jt,qn=br+kt,Yn=Math.max(xn+Zt,1e-5);Pr.push(new Ih(pn/wi,Cn/wi,bi/wi)),Ir.push(new Ih(di/Yn,es/Yn,qn/Yn))}lt.push(Pr),bt.push(Ir)}return[lt,bt]}(K,re,se,ge,me)}(h,u,C,x,I,g,B,P,M,h.center.lat,c.tileID.canonical),Z=c.queryGeometry;return function(H,K,re){let se=1/0;ve(re,K)&&(se=xA(re,K[0]));for(let ge=0;ge<K.length;ge++){const me=K[ge],pe=H[ge];for(let Ee=0;Ee<me.length-1;Ee++){const ye=me[Ee],Pe=[ye,me[Ee+1],pe[Ee+1],pe[Ee],ye];ce(re,Pe)&&(se=Math.min(se,xA(re,Pe)))}}return se!==1/0&&se}(U,W,Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends No{constructor(c,r,s,u){const m=kA();super(c,m,r,s,u),m.layout&&(this.layout=new Au(m.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof lh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,r){super.recalculate(c,r),this.paint._values["line-floorwidth"]=(()=>{if(W_)return W_;const s=kA();return W_=new k6(s.paint.properties["line-width"].specification),W_.useIntegerZoom=!0,W_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new J2(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,r,s){const u=AA(this);return{config:new Mc(this,{zoom:r,lut:s}),defines:u,overrideFog:!1}}queryRadius(c){const r=c,s=RA(ht("line-width",this,r),ht("line-gap-width",this,r)),u=ht("line-offset",this,r);return s/2+Math.abs(u)+xt(this.paint.get("line-translate"))}queryIntersectsFeature(c,r,s,u,m,h){if(c.queryGeometry.isAboveHorizon)return!1;const g=Pt(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),w=c.pixelToTileUnitsFactor/2*RA(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),E=this.paint.get("line-offset").evaluate(r,s);return E&&(u=function(I,x){const C=[],P=new vt(0,0);for(let T=0;T<I.length;T++){const M=I[T],R=[];for(let B=0;B<M.length;B++){const U=M[B],W=M[B+1],Z=B===0?P:U.sub(M[B-1])._unit()._perp(),H=B===M.length-1?P:W.sub(U)._unit()._perp(),K=Z._add(H)._unit();K._mult(1/(K.x*H.x+K.y*H.y)),R.push(K._mult(x)._add(U))}C.push(R)}return C}(u,E*c.pixelToTileUnitsFactor)),function(I,x,C){for(let P=0;P<x.length;P++){const T=x[P];if(I.length>=3){for(let M=0;M<T.length;M++)if(ze(I,T[M]))return!0}if(_e(I,T,C))return!0}return!1}(g,u,w)}isTileClipped(){return!0}isDraped(c){const r=this.layout.get("line-z-offset"),s=r.isConstant()&&!r.constantOr(0),u=this.layout.get("line-elevation-reference");return!(u==="sea"||u==="ground")&&(s||u!=="none")}},symbol:Ux,background:class extends No{constructor(c,r,s,u){super(c,{layout:gI||(gI=new ti({visibility:new Mt(Ke.layout_background.visibility)})),paint:_I||(_I=new ti({"background-pitch-alignment":new Mt(Ke.paint_background["background-pitch-alignment"]),"background-color":new Mt(Ke.paint_background["background-color"]),"background-pattern":new Mt(Ke.paint_background["background-pattern"]),"background-opacity":new Mt(Ke.paint_background["background-opacity"]),"background-emissive-strength":new Mt(Ke.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,r,s){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:wI,"raster-particle":PI,sky:class extends No{constructor(c,r,s,u){super(c,{layout:EI||(EI=new ti({visibility:new Mt(Ke.layout_sky.visibility)})),paint:CI||(CI=new ti({"sky-type":new Mt(Ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mt(Ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mt(Ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mt(Ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mt(Ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Iu(Ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mt(Ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mt(Ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mt(Ke.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=F_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(c,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),m=!u,h=c.style.light,g=h.properties.get("position");return m&&h.properties.get("anchor")==="viewport"&&Gt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?xS(g.azimuthal,90-g.polar,r):xS(u[0],90-u[1],r)}const s=this.paint.get("sky-gradient-center");return xS(s[0],90-s[1],r)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends No{constructor(c,r,s,u){super(c,{paint:MI||(MI=new ti({}))},r,null)}},model:class extends No{constructor(c,r,s,u){super(c,{layout:FI||(FI=new ti({visibility:new Mt(Ke.layout_model.visibility),"model-id":new Ut(Ke.layout_model["model-id"])})),paint:jI||(jI=new ti({"model-opacity":new Ut(Ke.paint_model["model-opacity"]),"model-rotation":new Ut(Ke.paint_model["model-rotation"]),"model-scale":new Ut(Ke.paint_model["model-scale"]),"model-translation":new Ut(Ke.paint_model["model-translation"]),"model-color":new Ut(Ke.paint_model["model-color"]),"model-color-mix-intensity":new Ut(Ke.paint_model["model-color-mix-intensity"]),"model-type":new Mt(Ke.paint_model["model-type"]),"model-cast-shadows":new Mt(Ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new Mt(Ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Mt(Ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ut(Ke.paint_model["model-emissive-strength"]),"model-roughness":new Ut(Ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ut(Ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Mt(Ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Mt(Ke.paint_model["model-front-cutoff"]),"model-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new SS(c)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof Yx?Lt-1:0}queryIntersectsFeature(c,r,s,u,m,h){if(!this.modelManager)return!1;const g=this.modelManager,w=c.tile.getBucket(this);if(!(w&&w instanceof SS))return!1;for(const E in w.instancesPerModel){const I=w.instancesPerModel[E],x=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(I.idToFeaturesIndex.hasOwnProperty(x)){const C=I.features[I.idToFeaturesIndex[x]],P=g.getModel(E,this.scope);if(!P)return!1;let T=Me.mat4.create();const M=new Kr(0,0),R=w.canonical;let B=Number.MAX_VALUE;for(let U=0;U<C.instancedDataCount;++U){const W=16*(C.instancedDataOffset+U),Z=I.instancedDataArray.float32,H=[Z[W+4],Z[W+5],Z[W+6]];HI(R,M,Z[W],0|Z[W+1]),BI(T,P,h,M,C.rotation,C.scale,H,!1,!1,!1),h.projection.name==="globe"&&(T=wS(T,h));const K=Me.mat4.multiply([],h.projMatrix,T),re=c.queryGeometry,se=DI(re.isPointQuery()?re.screenBounds:re.screenGeometry,h,K,P.aabb);se!=null&&(B=Math.min(se,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(c,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const r=this._transitionablePaint._values[c];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof Eu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends No{constructor(c,r,s,u){super(c,{layout:FP||(FP=new ti({"clip-layer-types":new Mt(Ke.layout_clip["clip-layer-types"]),"clip-layer-scope":new Mt(Ke.layout_clip["clip-layer-scope"])})),paint:jP||(jP=new ti({}))},r,s,u)}recalculate(c,r){super.recalculate(c,r)}createBucket(c){return new BP(c)}isTileClipped(){return!0}is3D(){return!0}}};class A8{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class I8{constructor(){this.tasks={},this.taskQueue=[],Lo(["process"],this),this.invoker=new A8(this.process),this.nextId=0}add(r,s){const u=this.nextId++,m=function({type:h,isSymbolTile:g,zoom:w}){return w=w||0,h==="message"?0:h!=="maybePrepare"||g?h!=="parseTile"||g?h==="parseTile"&&g?300-w:h==="maybePrepare"&&g?400-w:500:200-w:100-w}(s);if(m===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:s,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const s=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let r=null,s=1/0;for(let m=0;m<this.taskQueue.length;m++){const h=this.tasks[this.taskQueue[m]];h.priority<s&&(s=h.priority,r=m)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class qI{constructor(r,s,u){this.target=r,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Lo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new I8}send(r,s,u,m,h=!1,g){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[w]=u);const E=new Set;return this.target.postMessage({id:w,type:r,hasCallback:!!u,targetMapId:m,mustQueue:h,sourceMapId:this.mapId,data:Sc(s,E)},E),{cancel:()=>{u&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(r){const s=r.data,u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const m=this.cancelCallbacks[u];delete this.cancelCallbacks[u],m&&m.cancel()}else if(s.mustQueue||mn()){const m=this.callbacks[u],h=this.scheduler.add(()=>this.processTask(u,s),m&&m.metadata||{type:"message"});h&&(this.cancelCallbacks[u]=h)}else this.processTask(u,s)}processTask(r,s){if(delete this.cancelCallbacks[r],s.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(s.error?u(Tc(s.error)):u(null,Tc(s.data)))}else{const u=new Set,m=s.hasCallback?(g,w)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:g?Sc(g):null,data:Sc(w,u)},u)}:()=>{},h=Tc(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,h,m);else if(this.parent.getWorkerSource){const g=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,g[0],h.source,h.scope)[g[1]](h,m)}else m(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var sy={workerUrl:"",workerClass:null,workerParams:void 0};const MS="mapboxgl_preloaded_worker_pool";class Dh{constructor(){this.active={}}acquire(r,s=Dh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(sy.workerClass!=null?new sy.workerClass:new self.Worker(sy.workerUrl,sy.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[MS]}numActive(){return Object.keys(this.active).length}}Dh.workerCount=2;class Kp{constructor(r,s,u="Worker",m=Dh.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Ui();const h=this.workerPool.acquire(this.id,m);for(let g=0;g<h.length;g++){const w=new Kp.Actor(h[g],s,this.id);w.name=`${u} ${g}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,u){Ln(this.actors,(m,h)=>{m.send(r,s,h)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ay,PS;function Xx(){return ay||(ay=new Dh),ay}Kp.Actor=qI;const AS=new Xr(0,0,0);var Kx=(c=>(c[c.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",c[c.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",c[c.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",c))(Kx||{}),Jx=(c=>(c[c.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",c[c.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",c[c.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",c[c.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",c))(Jx||{}),ly=(c=>(c[c.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",c[c.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",c[c.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",c[c.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",c[c.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",c))(ly||{}),WI=(c=>(c[c.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",c[c.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",c[c.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",c))(WI||{}),Jp=(c=>(c[c.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",c[c.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",c[c.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",c[c.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",c[c.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",c[c.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",c))(Jp||{}),ZI=(c=>(c[c.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",c[c.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",c[c.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",c))(ZI||{});function k8(c,r,s){c===1&&r.icons.push(function(u,m){return function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:g}=h;if(g.content_area){const{content_area:w}=g;w.top==null&&(w.top=w.left),w.width==null&&(w.width=h.usvg_tree.width),w.height==null&&(w.height=w.width)}return g.stretch_x&&g.stretch_x.length&&YI(g,"x"),g.stretch_y&&g.stretch_y.length&&YI(g,"y"),h}(u.readFields(R8,{name:void 0},m))}(s,s.readVarint()+s.pos))}function YI(c,r){const s=[],u=c[`stretch_${r}`];let m=null;for(let h=0;h<u.length;h++)m===null?m=s.length===0?u[0]:s[s.length-1][1]+u[h]:(s.push([m,m+u[h]]),m=null);c[`stretch_${r}_areas`]=s}function R8(c,r,s){c===1?r.name=s.readString():c===2?r.metadata=function(u,m){return u.readFields(D8,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(s,s.readVarint()+s.pos):c===3&&(r.usvg_tree=function(u,m){return u.readFields(z8,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(s,s.readVarint()+s.pos),r.data="usvg_tree")}function D8(c,r,s){c===1?r.stretch_x=s.readPackedVarint():c===2?r.stretch_y=s.readPackedVarint():c===3?r.content_area=function(u,m){return u.readFields(L8,{left:0},m)}(s,s.readVarint()+s.pos):c===4&&r.variables.push(function(u,m){return u.readFields(O8,{name:void 0},m)}(s,s.readVarint()+s.pos))}function L8(c,r,s){c===1?r.left=s.readVarint():c===2?r.width=s.readVarint():c===3?r.top=s.readVarint():c===4&&(r.height=s.readVarint())}function O8(c,r,s){c===1?r.name=s.readString():c===2&&(r.rgb_color=t1(s.readVarint()),r.value="rgb_color")}function z8(c,r,s){c===1?r.width=r.height=s.readVarint():c===2?r.height=s.readVarint():c===3?r.children.push(Qx(s,s.readVarint()+s.pos)):c===4?r.linear_gradients.push(function(u,m){return u.readFields($8,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(s,s.readVarint()+s.pos)):c===5?r.radial_gradients.push(function(u,m){return u.readFields(H8,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(s,s.readVarint()+s.pos)):c===7?r.clip_paths.push(function(u,m){return u.readFields(q8,{children:[]},m)}(s,s.readVarint()+s.pos)):c===8&&r.masks.push(function(u,m){const h=u.readFields(W8,{left:0,width:20,mask_type:1,children:[]},m);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h}(s,s.readVarint()+s.pos))}function Qx(c,r){return c.readFields(N8,{},r)}function N8(c,r,s){c===1?(r.group=function(u,m){return u.readFields(F8,{opacity:255,children:[]},m)}(s,s.readVarint()+s.pos),r.node="group"):c===2&&(r.path=function(u,m){return u.readFields(B8,{paint_order:1,commands:[],step:1,diffs:[],rule:1},m)}(s,s.readVarint()+s.pos),r.node="path")}function F8(c,r,s){c===1?r.transform=e1(s,s.readVarint()+s.pos):c===2?r.opacity=s.readVarint():c===5?r.clip_path_idx=s.readVarint():c===6?r.mask_idx=s.readVarint():c===7&&r.children.push(Qx(s,s.readVarint()+s.pos))}function e1(c,r){return c.readFields(j8,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function j8(c,r,s){c===1?r.sx=s.readFloat():c===2?r.ky=s.readFloat():c===3?r.kx=s.readFloat():c===4?r.sy=s.readFloat():c===5?r.tx=s.readFloat():c===6&&(r.ty=s.readFloat())}function B8(c,r,s){c===1?r.fill=function(u,m){return u.readFields(U8,{rgb_color:AS,paint:"rgb_color",opacity:255},m)}(s,s.readVarint()+s.pos):c===2?r.stroke=function(u,m){return u.readFields(V8,{rgb_color:AS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(s,s.readVarint()+s.pos):c===3?r.paint_order=s.readVarint():c===5?s.readPackedVarint(r.commands):c===6?r.step=s.readFloat():c===7?s.readPackedSVarint(r.diffs):c===8&&(r.rule=s.readVarint())}function U8(c,r,s){c===1?(r.rgb_color=t1(s.readVarint()),r.paint="rgb_color"):c===2?(r.linear_gradient_idx=s.readVarint(),r.paint="linear_gradient_idx"):c===3?(r.radial_gradient_idx=s.readVarint(),r.paint="radial_gradient_idx"):c===5&&(r.opacity=s.readVarint())}function t1(c){return new Xr((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function V8(c,r,s){c===1?(r.rgb_color=t1(s.readVarint()),r.paint="rgb_color"):c===2?(r.linear_gradient_idx=s.readVarint(),r.paint="linear_gradient_idx"):c===3?(r.radial_gradient_idx=s.readVarint(),r.paint="radial_gradient_idx"):c===5?s.readPackedFloat(r.dasharray):c===6?r.dashoffset=s.readFloat():c===7?r.miterlimit=s.readFloat():c===8?r.opacity=s.readVarint():c===9?r.width=s.readFloat():c===10?r.linecap=s.readVarint():c===11&&(r.linejoin=s.readVarint())}function $8(c,r,s){c===1?r.transform=e1(s,s.readVarint()+s.pos):c===2?r.spread_method=s.readVarint():c===3?r.stops.push(XI(s,s.readVarint()+s.pos)):c===4?r.x1=s.readFloat():c===5?r.y1=s.readFloat():c===6?r.x2=s.readFloat():c===7&&(r.y2=s.readFloat())}function XI(c,r){return c.readFields(G8,{offset:0,opacity:255,rgb_color:AS},r)}function G8(c,r,s){c===1?r.offset=s.readFloat():c===2?r.opacity=s.readVarint():c===3&&(r.rgb_color=t1(s.readVarint()))}function H8(c,r,s){c===1?r.transform=e1(s,s.readVarint()+s.pos):c===2?r.spread_method=s.readVarint():c===3?r.stops.push(XI(s,s.readVarint()+s.pos)):c===4?r.cx=s.readFloat():c===5?r.cy=s.readFloat():c===6?r.r=s.readFloat():c===7?r.fx=s.readFloat():c===8?r.fy=s.readFloat():c===9&&(r.fr=s.readFloat())}function q8(c,r,s){c===1?r.transform=e1(s,s.readVarint()+s.pos):c===2?r.clip_path_idx=s.readVarint():c===3&&r.children.push(Qx(s,s.readVarint()+s.pos))}function W8(c,r,s){c===1?r.left=r.top=s.readFloat():c===2?r.width=r.height=s.readFloat():c===3?r.top=s.readFloat():c===4?r.height=s.readFloat():c===5?r.mask_type=s.readVarint():c===6?r.mask_idx=s.readVarint():c===7&&r.children.push(Qx(s,s.readVarint()+s.pos))}class Z8{static calculate(r,s){const u=new Map,m=new Map;if(Object.keys(r).length===0)return u;s.forEach(h=>{m.set(h.name,h.rgb_color||new Xr(0,0,0))});for(const[h,g]of Object.entries(r))m.has(h)?u.set(m.get(h).toStringPremultipliedAlpha(),g):console.warn(`Ignoring unknown image variable "${h}"`);return u}}function Qp(c,r=255,s){const u=r/255,m=c.toStringPremultipliedAlpha(),h=s.has(m)?s.get(m).clone():c.clone();return h.a=u,h.toString()}function IS(c,r){if(!Et()){const s=document.createElement("canvas");return s.width=c,s.height=r,s}return new OffscreenCanvas(c,r)}function Y8(c,r){const s=Z8.calculate(r.params,c.metadata?c.metadata.variables:[]),u=c.usvg_tree,m=u.width,h=u.height,g=r.transform?r.transform:new DOMMatrix,w=Math.max(1,Math.round(m*g.a)),E=Math.max(1,Math.round(h*g.d)),I=new DOMMatrix([w/m,0,0,E/h,0,0]),x=IS(w,E).getContext("2d");return kS(x,I,u,u,s),x.getImageData(0,0,w,E)}function kS(c,r,s,u,m){for(const h of u.children)KI(c,r,s,h,m)}function KI(c,r,s,u,m){u.group?(c.save(),function(h,g,w,E,I){const x=E.mask_idx!=null?w.masks[E.mask_idx]:null,C=E.clip_path_idx!=null?w.clip_paths[E.clip_path_idx]:null;if(E.transform&&(g=cy(E.transform).preMultiplySelf(g)),!function(M,R,B){return M.opacity!==255||R||B}(E,C!=null,x!=null))return void kS(h,g,w,E,I);const P=IS(h.canvas.width,h.canvas.height),T=P.getContext("2d");C&&rk(T,g,w,C),kS(T,g,w,E,I),x&&nk(T,g,w,x,I),h.globalAlpha=E.opacity/255,h.drawImage(P,0,0)}(c,r,s,u.group,m),c.restore()):u.path&&(c.save(),function(h,g,w,E,I){const x=ik(E);h.setTransform(g),E.paint_order===WI.PAINT_ORDER_FILL_AND_STROKE?(JI(h,w,E,x,I),QI(h,w,E,x,I)):(QI(h,w,E,x,I),JI(h,w,E,x,I))}(c,r,s,u.path,m),c.restore())}function JI(c,r,s,u,m){const h=s.fill;if(!h)return;const g=h.opacity/255;switch(h.paint){case"rgb_color":c.fillStyle=Qp(h.rgb_color,h.opacity,m);break;case"linear_gradient_idx":c.fillStyle=ek(c,r.linear_gradients[h.linear_gradient_idx],g,m);break;case"radial_gradient_idx":c.fillStyle=tk(c,r.radial_gradients[h.radial_gradient_idx],g,m)}let w;switch(s.rule){case Kx.PATH_RULE_NON_ZERO:w="nonzero";break;case Kx.PATH_RULE_EVEN_ODD:w="evenodd"}c.fill(u,w)}function QI(c,r,s,u,m){const h=s.stroke;if(!h)return;c.lineWidth=h.width,c.miterLimit=h.miterlimit,c.setLineDash(h.dasharray),c.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":c.strokeStyle=Qp(h.rgb_color,h.opacity,m);break;case"linear_gradient_idx":c.strokeStyle=ek(c,r.linear_gradients[h.linear_gradient_idx],g,m);break;case"radial_gradient_idx":c.strokeStyle=tk(c,r.radial_gradients[h.radial_gradient_idx],g,m)}switch(h.linejoin){case ly.LINE_JOIN_MITER_CLIP:case ly.LINE_JOIN_MITER:c.lineJoin="miter";break;case ly.LINE_JOIN_ROUND:c.lineJoin="round";break;case ly.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(h.linecap){case Jx.LINE_CAP_BUTT:c.lineCap="butt";break;case Jx.LINE_CAP_ROUND:c.lineCap="round";break;case Jx.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(u)}function ek(c,r,s,u){if(r.stops.length===1){const P=r.stops[0];return Qp(P.rgb_color,P.opacity*s,u)}const m=cy(r.transform),{x1:h,y1:g,x2:w,y2:E}=r,I=m.transformPoint(new DOMPoint(h,g)),x=m.transformPoint(new DOMPoint(w,E)),C=c.createLinearGradient(I.x,I.y,x.x,x.y);for(const P of r.stops)C.addColorStop(P.offset,Qp(P.rgb_color,P.opacity*s,u));return C}function tk(c,r,s,u){if(r.stops.length===1){const P=r.stops[0];return Qp(P.rgb_color,P.opacity*s,u)}const m=cy(r.transform),{fx:h,fy:g,cx:w,cy:E}=r,I=m.transformPoint(new DOMPoint(h,g)),x=m.transformPoint(new DOMPoint(w,E)),C=c.createRadialGradient(I.x,I.y,0,x.x,x.y,r.r*((m.a+m.d)/2));for(const P of r.stops)C.addColorStop(P.offset,Qp(P.rgb_color,P.opacity*s,u));return C}function rk(c,r,s,u){const m=cy(u.transform).preMultiplySelf(r),h=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;h&&rk(c,m,s,h);const g=new Path2D;let w;function E(I,x){if(I.path){const C=I.path;g.addPath(ik(C),x),C.rule===Kx.PATH_RULE_EVEN_ODD&&(w="evenodd")}else if(I.group){const C=I.group.transform?cy(I.group.transform).preMultiplySelf(x):x;for(const P of I.group.children)E(P,C)}}for(const I of u.children)E(I,m);c.clip(g,w)}function nk(c,r,s,u,m){if(u.children.length===0)return;const h=u.mask_idx!=null?s.masks[u.mask_idx]:null;h&&nk(c,r,s,h,m);const g=c.canvas.width,w=c.canvas.height,E=IS(g,w),I=E.getContext("2d"),x=u.width,C=u.height,P=u.left,T=u.top,M=new Path2D,R=new Path2D;R.rect(P,T,x,C),M.addPath(R,r),I.clip(M);for(const W of u.children)KI(I,r,s,W,m);const B=I.getImageData(0,0,g,w),U=B.data;if(u.mask_type===ZI.MASK_TYPE_LUMINANCE)for(let W=0;W<U.length;W+=4)U[W+3]=U[W+3]/255*(.2126*U[W]+.7152*U[W+1]+.0722*U[W+2]);I.putImageData(B,0,0),c.globalCompositeOperation="destination-in",c.drawImage(E,0,0)}function cy(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function ik(c){const r=new Path2D,s=c.step;let u=c.diffs[0]*s,m=c.diffs[1]*s;r.moveTo(u,m);for(let h=0,g=2;h<c.commands.length;h++)switch(c.commands[h]){case Jp.PATH_COMMAND_MOVE:u+=c.diffs[g++]*s,m+=c.diffs[g++]*s,r.moveTo(u,m);break;case Jp.PATH_COMMAND_LINE:u+=c.diffs[g++]*s,m+=c.diffs[g++]*s,r.lineTo(u,m);break;case Jp.PATH_COMMAND_QUAD:{const w=u+c.diffs[g++]*s,E=m+c.diffs[g++]*s;u=w+c.diffs[g++]*s,m=E+c.diffs[g++]*s,r.quadraticCurveTo(w,E,u,m);break}case Jp.PATH_COMMAND_CUBIC:{const w=u+c.diffs[g++]*s,E=m+c.diffs[g++]*s,I=w+c.diffs[g++]*s,x=E+c.diffs[g++]*s;u=I+c.diffs[g++]*s,m=x+c.diffs[g++]*s,r.bezierCurveTo(w,E,I,x,u,m);break}case Jp.PATH_COMMAND_CLOSE:r.closePath()}return r}class RS{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const s=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,s),s}put(r,s){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,s)}delete(r){this.cache.delete(r)}}class DS{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new Mo(r,r.data)}getFromCache(r,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new RS(150)),this.cacheMap.get(u).get(zo(r.serialize(),s))}setInCache(r,s,u,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new RS(150));const h=this.cacheDependenciesMap.get(m);h.get(zo(r.id,u))||h.set(zo(r.id,u),new Set);const g=this.cacheMap.get(m),w=r.serialize();h.get(zo(r.id,u)).add(w),g.put(zo(r.serialize(),u),s)}removeImagesFromCacheByIds(r,s,u=""){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const m=this.cacheMap.get(u),h=this.cacheDependenciesMap.get(u);for(const g of r)if(h.has(zo(g,s))){for(const w of h.get(zo(g,s)))m.delete(w);h.delete(zo(g,s))}}rasterize(r,s,u,m,h=Y8){const g=this.getFromCache(r,u,m);if(g)return g.clone();const w=h(s.icon,r.options),E=DS._getImage(w);return this.setInCache(r,E,u,m),E.clone()}}class ok{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,s){const u=this.toIdx(r,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,s){return this.leaves[this.toIdx(r,s)]}toIdx(r,s){return s*this.size+r}}function sk(c,r,s,u){let m=0,h=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(s[g]<c[g]||s[g]>r[g])return null}else{const w=1/u[g];let E=(c[g]-s[g])*w,I=(r[g]-s[g])*w;if(E>I){const x=E;E=I,I=x}if(E>m&&(m=E),I<h&&(h=I),m>h)return null}return m}function ak(c,r,s,u,m,h,g,w,E,I,x){const C=u-c,P=m-r,T=h-s,M=g-c,R=w-r,B=E-s,U=x[1]*B-x[2]*R,W=x[2]*M-x[0]*B,Z=x[0]*R-x[1]*M,H=C*U+P*W+T*Z;if(Math.abs(H)<1e-15)return null;const K=1/H,re=I[0]-c,se=I[1]-r,ge=I[2]-s,me=(re*U+se*W+ge*Z)*K;if(me<0||me>1)return null;const pe=se*T-ge*P,Ee=ge*C-re*T,ye=re*P-se*C,Pe=(x[0]*pe+x[1]*Ee+x[2]*ye)*K;return Pe<0||me+Pe>1?null:(M*pe+R*Ee+B*ye)*K}function lk(c,r,s){return(c-r)/(s-r)}function ck(c,r,s,u,m,h,g,w,E){const I=1<<s,x=h-u,C=g-m,P=(c+1)/I*x+u,T=(r+0)/I*C+m,M=(r+1)/I*C+m;w[0]=(c+0)/I*x+u,w[1]=T,E[0]=P,E[1]=M}class uk{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(h){const g=Math.ceil(Math.log2(h.dim/8)),w=[];let E=Math.ceil(Math.pow(2,g));const I=1/E,x=(T,M,R,B,U)=>{const W=B?1:0,Z=(T+1)*R-W,H=M*R,K=(M+1)*R-W;U[0]=T*R,U[1]=H,U[2]=Z,U[3]=K};let C=new ok(E);const P=[];for(let T=0;T<E*E;T++){x(T%E,Math.floor(T/E),I,!1,P);const M=qu(P[0],P[1],h),R=qu(P[2],P[1],h),B=qu(P[2],P[3],h),U=qu(P[0],P[3],h);C.minimums.push(Math.min(M,R,B,U)),C.maximums.push(Math.max(M,R,B,U)),C.leaves.push(1)}for(w.push(C),E/=2;E>=1;E/=2){const T=w[w.length-1];C=new ok(E);for(let M=0;M<E*E;M++){x(M%E,Math.floor(M/E),2,!0,P);const R=T.getElevation(P[0],P[1]),B=T.getElevation(P[2],P[1]),U=T.getElevation(P[2],P[3]),W=T.getElevation(P[0],P[3]),Z=T.isLeaf(P[0],P[1]),H=T.isLeaf(P[2],P[1]),K=T.isLeaf(P[2],P[3]),re=T.isLeaf(P[0],P[3]),se=Math.min(R.min,B.min,U.min,W.min),ge=Math.max(R.max,B.max,U.max,W.max),me=Z&&H&&K&&re;C.maximums.push(ge),C.minimums.push(se),C.leaves.push(ge-se<=5&&me?1:0)}w.push(C)}return w}(this.dem),u=s.length-1,m=s[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(r,s,u,m,h,g,w=1){return sk([r,s,-100],[u,m,this.maximums[0]*w],h,g)}raycast(r,s,u,m,h,g,w=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,s,u,m,h,g,w);if(E==null)return null;const I=[],x=[],C=[],P=[],T=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;T.length>0;){const{idx:M,t:R,nodex:B,nodey:U,depth:W}=T.pop();if(this.leaves[M]){ck(B,U,W,r,s,u,m,C,P);const H=1<<W,K=(B+0)/H,re=(B+1)/H,se=(U+0)/H,ge=(U+1)/H,me=qu(K,se,this.dem)*w,pe=qu(re,se,this.dem)*w,Ee=qu(re,ge,this.dem)*w,ye=qu(K,ge,this.dem)*w,Pe=ak(C[0],C[1],me,P[0],C[1],pe,P[0],P[1],Ee,h,g),Le=ak(P[0],P[1],Ee,C[0],P[1],ye,C[0],C[1],me,h,g),Re=Math.min(Pe!==null?Pe:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(Re!==Number.MAX_VALUE)return Re;{const Ne=Me.vec3.scaleAndAdd([],h,g,R);if(dk(me,pe,ye,Ee,lk(Ne[0],C[0],P[0]),lk(Ne[1],C[1],P[1]))>=Ne[2])return R}continue}let Z=0;for(let H=0;H<this._siblingOffset.length;H++){ck((B<<1)+this._siblingOffset[H][0],(U<<1)+this._siblingOffset[H][1],W+1,r,s,u,m,C,P),C[2]=-100,P[2]=this.maximums[this.childOffsets[M]+H]*w;const K=sk(C,P,h,g);if(K!=null){const re=K;I[H]=re;let se=!1;for(let ge=0;ge<Z&&!se;ge++)re>=I[x[ge]]&&(x.splice(ge,0,H),se=!0);se||(x[Z]=H),Z++}}for(let H=0;H<Z;H++){const K=x[H];T.push({idx:this.childOffsets[M]+K,t:I[K],nodex:(B<<1)+this._siblingOffset[K][0],nodey:(U<<1)+this._siblingOffset[K][1],depth:W+1})}}return null}_addNode(r,s,u){return this.minimums.push(r),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,s,u,m,h){if(r[m].isLeaf(s,u)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const g=m-1,w=r[g];let E=0,I=0;for(let x=0;x<this._siblingOffset.length;x++){const C=2*s+this._siblingOffset[x][0],P=2*u+this._siblingOffset[x][1],T=w.getElevation(C,P),M=w.isLeaf(C,P),R=this._addNode(T.min,T.max,M);M&&(E|=1<<x),I||(I=R)}for(let x=0;x<this._siblingOffset.length;x++)E&1<<x||this._construct(r,2*s+this._siblingOffset[x][0],2*u+this._siblingOffset[x][1],g,I+x)}}function dk(c,r,s,u,m,h){return pr(pr(c,s,h),pr(r,u,h),m)}function qu(c,r,s){const u=s.dim,m=Ot(c*u-.5,0,u-1),h=Ot(r*u-.5,0,u-1),g=Math.floor(m),w=Math.floor(h),E=Math.min(g+1,u-1),I=Math.min(w+1,u-1);return dk(s.get(g,w),s.get(E,w),s.get(g,I),s.get(E,I),m-g,h-w)}const X8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function K8(c,r,s){return(256*c*256+256*r+s)/10-1e4}function J8(c,r,s){return 256*c+r+s/256-32768}class r1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,s,u,m=!1){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Gt(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const h=this.dim=s.height-2,g=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let E=0;E<h;E++)g[this._idx(-1,E)]=g[this._idx(0,E)],g[this._idx(h,E)]=g[this._idx(h-1,E)],g[this._idx(E,-1)]=g[this._idx(E,0)],g[this._idx(E,h)]=g[this._idx(E,h-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(h,-1)]=g[this._idx(h-1,0)],g[this._idx(-1,h)]=g[this._idx(0,h-1)],g[this._idx(h,h)]=g[this._idx(h-1,h-1)]}const w=u==="terrarium"?J8:K8;for(let E=0;E<g.length;++E){const I=4*E;this.floatView[E]=w(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=Bt.now()}_buildQuadTree(){this._tree=new uk(this)}get(r,s,u=!1){u&&(r=Ot(r,-1,this.dim),s=Ot(s,-1,this.dim));const m=this._idx(r,s);return this.floatView[m]}set(r,s,u){const m=this._idx(r,s),h=this.floatView[m];return this.floatView[m]=u,u-h}static getUnpackVector(r){return X8[r]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}static pack(r,s){const u=[0,0,0,0],m=r1.getUnpackVector(s);let h=Math.floor((r+m[3])/m[2]);return u[2]=h%256,h=Math.floor(h/256),u[1]=h%256,h=Math.floor(h/256),u[0]=h,u}getPixels(){return new IP({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,s,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let m=s*this.dim,h=s*this.dim+this.dim,g=u*this.dim,w=u*this.dim+this.dim;switch(s){case-1:m=h-1;break;case 1:h=m+1}switch(u){case-1:g=w-1;break;case 1:w=g+1}const E=-s*this.dim,I=-u*this.dim;for(let x=g;x<w;x++)for(let C=m;C<h;C++){const P=4*this._idx(C,x),T=4*this._idx(C+E,x+I);this.pixels[P+0]=r.pixels[T+0],this.pixels[P+1]=r.pixels[T+1],this.pixels[P+2]=r.pixels[T+2],this.pixels[P+3]=r.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Q8(c,r,s){c===1?r.headerLength=s.readFixed32():c===2?r.x=s.readVarint():c===3?r.y=s.readVarint():c===4?r.z=s.readVarint():c===5&&r.layers.push(function(u,m){return u.readFields(iU,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(s,s.readVarint()+s.pos))}function eU(c,r,s){c===1?(r.delta_filter=function(u,m){return u.readFields(tU,{blockSize:0},m)}(s,s.readVarint()+s.pos),r.filter="delta_filter"):c===2?(s.readVarint(),r.filter="zigzag_filter"):c===3?(s.readVarint(),r.filter="bitshuffle_filter"):c===4&&(s.readVarint(),r.filter="byteshuffle_filter")}function tU(c,r,s){c===1&&(r.blockSize=s.readVarint())}function rU(c,r,s){c===1?(s.readVarint(),r.codec="gzip_data"):c===2?(s.readVarint(),r.codec="jpeg_image"):c===3?(s.readVarint(),r.codec="webp_image"):c===4&&(s.readVarint(),r.codec="png_image")}function nU(c,r,s){let u=0,m=0;c===1?r.firstByte=s.readFixed64():c===2?r.lastByte=s.readFixed64():c===3?r.filters.push(function(h,g){return h.readFields(eU,{},g)}(s,s.readVarint()+s.pos)):c===4?r.codec=function(h,g){return h.readFields(rU,{},g)}(s,s.readVarint()+s.pos):c===5?m=s.readFloat():c===6?u=s.readFloat():c===7?r.bands.push(s.readString()):c===8?r.offset=s.readDouble():c===9&&(r.scale=s.readDouble()),r.offset===0&&(r.offset=m),r.scale===0&&(r.scale=u)}function iU(c,r,s){c===1?r.version=s.readVarint():c===2?r.name=s.readString():c===3?r.units=s.readString():c===4?r.tileSize=s.readVarint():c===5?r.buffer=s.readVarint():c===6?r.pixelFormat=s.readVarint():c===7&&r.dataIndex.push(function(u,m){return u.readFields(nU,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(s,s.readVarint()+s.pos))}function oU(c,r,s){if(c===2)(function(u,m,h){u.readFields(sU,h,m)})(s,s.readVarint()+s.pos,r);else if(c===3)throw new Error("Not implemented")}function sU(c,r,s){if(c===1){let u=0;const m=s.readVarint()+s.pos;for(;s.pos<m;)r[u++]=s.readVarint()}}function aU(c,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let s=r[3];for(let u=2;u>=1;u--){const m=u===1?1:0,h=u===2?1:0;for(let g=0;g<r[0];g++){const w=r[1]*g;for(let E=m;E<r[1];E++){const I=r[2]*(E+w);for(let x=h;x<r[2];x++){const C=r[3]*(x+I);for(let P=0;P<r[3];P++){const T=C+P;c[T]+=c[T-s]}}}}s*=r[u]}return c}function lU(c){for(let r=0,s=c.length;r<s;r++)c[r]=c[r]>>>1^-(1&c[r]);return c}function cU(c,r){switch(r){case"uint32":return c;case"uint16":for(let s=0;s<c.length;s+=2){const u=c[s],m=c[s+1];c[s]=(240&u)>>4|(61440&u)>>8|(240&m)<<4|61440&m,c[s+1]=15&u|(3840&u)>>4|(15&m)<<8|(3840&m)<<4}return c;case"uint8":for(let s=0;s<c.length;s+=4){const u=c[s],m=c[s+1],h=c[s+2],g=c[s+3];c[s+0]=(192&u)>>6|(192&m)>>4|(192&h)>>2|192&g,c[s+1]=(48&u)>>4|(48&m)>>2|48&h|(48&g)<<2,c[s+2]=(12&u)>>2|12&m|(12&h)<<2|(12&g)<<4,c[s+3]=3&u|(3&m)<<2|(3&h)<<4|(3&g)<<6}return c;default:throw new Error(`Invalid pixel format, "${r}"`)}}qt(r1,"DEMData"),qt(uk,"DemMinMaxQuadTree",{omit:["dem"]});var ta=Uint8Array,uy=Uint16Array,uU=Int32Array,hk=new ta([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fk=new ta([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dU=new ta([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pk=function(c,r){for(var s=new uy(31),u=0;u<31;++u)s[u]=r+=1<<c[u-1];var m=new uU(s[30]);for(u=1;u<30;++u)for(var h=s[u];h<s[u+1];++h)m[h]=h-s[u]<<5|u;return{b:s,r:m}},mk=pk(hk,2),gk=mk.b,hU=mk.r;gk[28]=258,hU[258]=28;for(var fU=pk(fk,0).b,_k=new uy(32768),xi=0;xi<32768;++xi){var em=(43690&xi)>>1|(21845&xi)<<1;_k[xi]=((65280&(em=(61680&(em=(52428&em)>>2|(13107&em)<<2))>>4|(3855&em)<<4))>>8|(255&em)<<8)>>1}var dy=function(c,r,s){for(var u=c.length,m=0,h=new uy(r);m<u;++m)c[m]&&++h[c[m]-1];var g,w=new uy(r);for(m=1;m<r;++m)w[m]=w[m-1]+h[m-1]<<1;g=new uy(1<<r);var E=15-r;for(m=0;m<u;++m)if(c[m])for(var I=m<<4|c[m],x=r-c[m],C=w[c[m]-1]++<<x,P=C|(1<<x)-1;C<=P;++C)g[_k[C]>>E]=I;return g},hy=new ta(288);for(xi=0;xi<144;++xi)hy[xi]=8;for(xi=144;xi<256;++xi)hy[xi]=9;for(xi=256;xi<280;++xi)hy[xi]=7;for(xi=280;xi<288;++xi)hy[xi]=8;var yk=new ta(32);for(xi=0;xi<32;++xi)yk[xi]=5;var pU=dy(hy,9),mU=dy(yk,5),LS=function(c){for(var r=c[0],s=1;s<c.length;++s)c[s]>r&&(r=c[s]);return r},el=function(c,r,s){var u=r/8|0;return(c[u]|c[u+1]<<8)>>(7&r)&s},OS=function(c,r){var s=r/8|0;return(c[s]|c[s+1]<<8|c[s+2]<<16)>>(7&r)},gU=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],tl=function(c,r,s){var u=new Error(r||gU[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,tl),!s)throw u;return u},_U=new ta(0),yU=typeof TextDecoder<"u"&&new TextDecoder;try{yU.decode(_U,{stream:!0})}catch{}const vU={gzip_data:"gzip"};class xa extends Error{constructor(r){super(r),this.name="MRTError"}}const xU={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},vk={uint32:1,uint16:2,uint8:4},bU={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let zS;class NS{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const s=this.layers[r];if(!s)throw new xa(`Layer '${r}' not found`);return s}getHeaderLength(r){const s=new Uint8Array(r),u=new DataView(r);if(s[0]!==13)throw new xa("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const s=new Uint8Array(r),u=this.getHeaderLength(r);if(s.length<u)throw new xa(`Expected header with length >= ${u} but got buffer of length ${s.length}`);const m=function(h,g){return h.readFields(Q8,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new zS(s.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new xa(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const h of m.layers)this.layers[h.name]=new wU(h,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const s=[],u=this.getLayer(r.layerName);for(let m of r.blockIndices){const h=u.dataIndex[m],g=h.firstByte-r.firstByte,w=h.lastByte-r.firstByte;if(u._blocksInProgress.has(m))continue;const E={layerName:u.name,firstByte:g,lastByte:w,pixelFormat:u.pixelFormat,blockIndex:m,blockShape:[h.bands.length].concat(u.bandShape),buffer:u.buffer,codec:h.codec.codec,filters:h.filters.map(I=>I.filter)};u._blocksInProgress.add(m),s.push(E)}return new xk(s,()=>{s.forEach(m=>u._blocksInProgress.delete(m.blockIndex))},(m,h)=>{if(s.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),m)throw m;h.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class wU{constructor({version:r,name:s,units:u,tileSize:m,pixelFormat:h,buffer:g,dataIndex:w},E){if(this.version=r,this.version!==1)throw new xa(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=s,this.units=u,this.tileSize=m,this.buffer=g,this.pixelFormat=xU[h],this.dataIndex=w,this.bandShape=[m+2*g,m+2*g,vk[this.pixelFormat]],this._decodedBlocks=new RS(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return vk[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const s=r.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,r.data)}getBlockForBand(r){let s=0;switch(typeof r){case"string":for(const[u,m]of this.dataIndex.entries()){for(const[h,g]of m.bands.entries())if(g===r)return{bandIndex:s+h,blockIndex:u,blockBandIndex:h};s+=m.bands.length}break;case"number":for(const[u,m]of this.dataIndex.entries()){if(r>=s&&r<s+m.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-s};s+=m.bands.length}break;default:throw new xa(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}throw new xa(`Band not found: ${JSON.stringify(r)}`)}getDataRange(r){let s=1/0,u=-1/0;const m=[],h=new Set;for(const g of r){const{blockIndex:w}=this.getBlockForBand(g);if(w<0)throw new xa(`Invalid band: ${JSON.stringify(g)}`);const E=this.dataIndex[w];m.includes(w)||m.push(w),h.add(w),s=Math.min(s,E.firstByte),u=Math.max(u,E.lastByte)}if(h.size>this.cacheSize)throw new xa(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:m}}hasBand(r){const{blockIndex:s}=this.getBlockForBand(r);return s>=0}hasDataForBand(r){const{blockIndex:s}=this.getBlockForBand(r);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(r){const{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(r),m=this._decodedBlocks.get(s.toString());if(!m)throw new xa(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[s],g=this.bandShape.reduce((I,x)=>I*x,1),w=u*g,E=m.subarray(w,w+g);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}NS.setPbf=function(c){zS=c};class xk{constructor(r,s,u){this.tasks=r,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,s){this._finalized||(this._onComplete(r,s),this._finalized=!0)}}NS.performDecoding=function(c,r){const s=new Uint8Array(c);return Promise.all(r.tasks.map(u=>{const{layerName:m,firstByte:h,lastByte:g,pixelFormat:w,blockShape:E,blockIndex:I,filters:x,codec:C}=u,P=s.subarray(h,g+1),T=new Uint32Array(E[0]*E[1]*E[2]);let M;if(C!=="gzip_data")throw new xa(`Unhandled codec: ${C}`);return M=function(R,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve(((H=function(se){se[0]==31&&se[1]==139&&se[2]==8||tl(6,"invalid gzip data");var ge=se[3],me=10;4&ge&&(me+=2+(se[10]|se[11]<<8));for(var pe=(ge>>3&1)+(ge>>4&1);pe>0;pe-=!se[me++]);return me+(2&ge)}(Z=R))+8>Z.length&&tl(6,"invalid gzip data"),function(se,ge,me,pe){var Ee=se.length;if(!Ee||ge.f&&!ge.l)return me||new ta(0);var ye=!me,Pe=ye||ge.i!=2,Le=ge.i;ye&&(me=new ta(3*Ee));var Re,Ne,Ve=function(Dc){var Yu=me.length;if(Dc>Yu){var Xu=new ta(Math.max(2*Yu,Dc));Xu.set(me),me=Xu}},We=ge.f||0,Be=ge.p||0,lt=ge.b||0,bt=ge.l,ct=ge.d,It=ge.m,At=ge.n,Nt=8*Ee;do{if(!bt){We=el(se,Be,1);var pt=el(se,Be+1,3);if(Be+=3,!pt){var Jt=se[(br=4+((Be+7)/8|0))-4]|se[br-3]<<8,kt=br+Jt;if(kt>Ee){Le&&tl(0);break}Pe&&Ve(lt+Jt),me.set(se.subarray(br,kt),lt),ge.b=lt+=Jt,ge.p=Be=8*kt,ge.f=We;continue}if(pt==1)bt=pU,ct=mU,It=9,At=5;else if(pt==2){var Zt=el(se,Be,31)+257,ur=el(se,Be+10,15)+4,Pr=Zt+el(se,Be+5,31)+1;Be+=14;for(var Ir=new ta(Pr),zr=new ta(19),kr=0;kr<ur;++kr)zr[dU[kr]]=el(se,Be+3*kr,7);Be+=3*ur;var jr=LS(zr),En=(1<<jr)-1,vn=dy(zr,jr);for(kr=0;kr<Pr;){var br,xn=vn[el(se,Be,En)];if(Be+=15&xn,(br=xn>>4)<16)Ir[kr++]=br;else{var pn=0,Cn=0;for(br==16?(Cn=3+el(se,Be,3),Be+=2,pn=Ir[kr-1]):br==17?(Cn=3+el(se,Be,7),Be+=3):br==18&&(Cn=11+el(se,Be,127),Be+=7);Cn--;)Ir[kr++]=pn}}var bi=Ir.subarray(0,Zt),wi=Ir.subarray(Zt);It=LS(bi),At=LS(wi),bt=dy(bi,It),ct=dy(wi,At)}else tl(1);if(Be>Nt){Le&&tl(0);break}}Pe&&Ve(lt+131072);for(var di=(1<<It)-1,es=(1<<At)-1,qn=Be;;qn=Be){var Yn=(pn=bt[OS(se,Be)&di])>>4;if((Be+=15&pn)>Nt){Le&&tl(0);break}if(pn||tl(2),Yn<256)me[lt++]=Yn;else{if(Yn==256){qn=Be,bt=null;break}var jo=Yn-254;Yn>264&&(jo=el(se,Be,(1<<(Li=hk[kr=Yn-257]))-1)+gk[kr],Be+=Li);var Si=ct[OS(se,Be)&es],us=Si>>4;if(Si||tl(3),Be+=15&Si,wi=fU[us],us>3){var Li=fk[us];wi+=OS(se,Be)&(1<<Li)-1,Be+=Li}if(Be>Nt){Le&&tl(0);break}Pe&&Ve(lt+131072);var Vl=lt+jo;if(lt<wi){var Wu=0-wi,Zu=Math.min(wi,Vl);for(Wu+lt<0&&tl(3);lt<Zu;++lt)me[lt]=(void 0)[Wu+lt]}for(;lt<Vl;++lt)me[lt]=me[lt-wi]}}ge.l=bt,ge.p=qn,ge.b=lt,ge.f=We,bt&&(We=1,ge.m=It,ge.d=ct,ge.n=At)}while(!We);return lt!=me.length&&ye?(Re=me,((Ne=lt)==null||Ne>Re.length)&&(Ne=Re.length),new ta(Re.subarray(0,Ne))):me.subarray(0,lt)}(Z.subarray(H,-8),{i:2},new ta(((U=Z)[(W=U.length)-4]|U[W-3]<<8|U[W-2]<<16|U[W-1]<<24)>>>0))));var U,W,Z,H;const K=vU[B];if(!K)throw new Error(`Unhandled codec: ${B}`);const re=new globalThis.DecompressionStream(K);return new Response(new Blob([R]).stream().pipeThrough(re)).arrayBuffer().then(se=>new Uint8Array(se))}(P,C).then(R=>(function(B,U){B.readFields(oU,U)}(new zS(R),T),new bU[w](T.buffer))),M.then(R=>{for(let B=x.length-1;B>=0;B--)switch(x[B]){case"delta_filter":aU(R,E);break;case"zigzag_filter":lU(R);break;case"bitshuffle_filter":cU(R,w);break;default:throw new xa(`Unhandled filter "${x[B]}"`)}return{layerName:m,blockIndex:I,data:R}}).catch(R=>{throw R})}))},qt(xk,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let fy,FS,rl,tm,jS,rm=null;function bk(){return mn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:FS||xe.DRACO_URL}function wk(){if(mn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(tm)return tm;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return tm=WebAssembly.validate(c)?xe.MESHOPT_SIMD_URL:xe.MESHOPT_URL,tm}const n1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},SU={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},py={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Sk(c,r,s){const u=s.json.bufferViews.length,m=s.buffers.length;r.bufferView=u,s.json.bufferViews[u]={buffer:m,byteLength:c.byteLength},s.buffers[m]=c}const BS="KHR_draco_mesh_compression";function TU(c,r){const s=c.extensions&&c.extensions[BS];if(!s)return;const u=new rl.Decoder,m=Mk(r,s.bufferView),h=new rl.Mesh;if(!u.DecodeArrayToMesh(m,m.byteLength,h))throw new Error("Failed to decode Draco mesh");const g=r.json.accessors[c.indices],w=n1[g.componentType],E=g.count*w.BYTES_PER_ELEMENT,I=rl._malloc(E);w===Uint16Array?u.GetTrianglesUInt16Array(h,E,I):u.GetTrianglesUInt32Array(h,E,I),Sk(rl.memory.buffer.slice(I,I+E),g,r),rl._free(I);for(const x of Object.keys(s.attributes)){const C=u.GetAttributeByUniqueId(h,s.attributes[x]),P=r.json.accessors[c.attributes[x]],T=SU[P.componentType],M=P.count*py[P.type]*n1[P.componentType].BYTES_PER_ELEMENT,R=rl._malloc(M);u.GetAttributeDataArrayForAllPoints(h,C,rl[T],M,R),Sk(rl.memory.buffer.slice(R,R+M),P,r),rl._free(R)}u.destroy(),h.destroy(),delete c.extensions[BS]}const i1="EXT_meshopt_compression";function EU(c,r){if(!c.extensions||!c.extensions[i1])return;const s=c.extensions[i1],u=new Uint8Array(r.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),m=new Uint8Array(s.count*s.byteStride);jS.decodeGltfBuffer(m,s.count,s.byteStride,u,s.mode,s.filter),c.buffer=r.buffers.length,c.byteOffset=0,r.buffers[c.buffer]=m.buffer,delete c.extensions[i1]}const Tk=1179937895,Ek=new TextDecoder("utf8");function Ck(c,r){return new URL(c,r).href}function CU(c,r,s,u){return fetch(Ck(c.uri,u)).then(m=>m.arrayBuffer()).then(m=>{r.buffers[s]=m})}function Mk(c,r){const s=c.json.bufferViews[r];return new Uint8Array(c.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function MU(c,r,s,u){if(c.uri){const m=Ck(c.uri,u);return fetch(m).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{r.images[s]=h})}if(c.bufferView!==void 0){const m=Mk(r,c.bufferView),h=new Blob([m],{type:c.mimeType});return createImageBitmap(h).then(g=>{r.images[s]=g})}}function Pk(c,r=0,s){const u={json:null,images:[],buffers:[]};if(new Uint32Array(c,r,1)[0]===Tk){const x=new Uint32Array(c,r);let C=2;const P=(x[C++]>>2)-3,T=x[C++]>>2;if(C++,u.json=JSON.parse(Ek.decode(x.subarray(C,C+T))),C+=T,C<P){const M=x[C++];C++;const R=r+(C<<2);u.buffers[0]=c.slice(R,R+M)}}else u.json=JSON.parse(Ek.decode(new Uint8Array(c,r)));const{buffers:m,images:h,meshes:g,extensionsUsed:w,bufferViews:E}=u.json;let I=Promise.resolve();if(m){const x=[];for(let C=0;C<m.length;C++){const P=m[C];P.uri?x.push(CU(P,u,C,s)):u.buffers[C]||(u.buffers[C]=null)}I=Promise.all(x)}return I.then(()=>{const x=[],C=w&&w.includes(BS),P=w&&w.includes(i1);if(C&&x.push(function(){if(!rl)return fy??(fy=function(T){let M,R=null;function B(){M=new Uint8Array(R.buffer)}function U(){throw new Error("Unexpected Draco error.")}const W={a:{a:U,d:function(Z,H,K){return M.copyWithin(Z,H,H+K)},c:function(Z){const H=M.length,K=Math.max(Z>>>0,Math.ceil(1.2*H)),re=Math.ceil((K-H)/65536);try{return R.grow(re),B(),!0}catch{return!1}},b:U}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,W):T.then(Z=>Z.arrayBuffer()).then(Z=>WebAssembly.instantiate(Z,W))).then(Z=>{const{Rb:H,Qb:K,P:re,T:se,X:ge,Ja:me,La:pe,Qa:Ee,Va:ye,Wa:Pe,eb:Le,jb:Re,f:Ne,e:Ve,yb:We,zb:Be,Ab:lt,Bb:bt,Db:ct,Gb:It}=Z.instance.exports;R=Ve;const At=(()=>{let Nt=0,pt=0,Jt=0,kt=0;return Zt=>{Jt&&(H(kt),H(Nt),pt+=Jt,Jt=Nt=0),Nt||(pt+=128,Nt=K(pt));const ur=Zt.length+7&-8;let Pr=Nt;ur>=pt&&(Jt=ur,Pr=kt=K(ur));for(let Ir=0;Ir<Zt.length;Ir++)M[Pr+Ir]=Zt[Ir];return Pr}})();return B(),Ne(),{memory:Ve,_free:H,_malloc:K,Mesh:class{constructor(){this.ptr=re()}destroy(){se(this.ptr)}},Decoder:class{constructor(){this.ptr=me()}destroy(){Re(this.ptr)}DecodeArrayToMesh(Nt,pt,Jt){const kt=At(Nt),Zt=pe(this.ptr,kt,pt,Jt.ptr);return!!ge(Zt)}GetAttributeByUniqueId(Nt,pt){return{ptr:Ee(this.ptr,Nt.ptr,pt)}}GetTrianglesUInt16Array(Nt,pt,Jt){ye(this.ptr,Nt.ptr,pt,Jt)}GetTrianglesUInt32Array(Nt,pt,Jt){Pe(this.ptr,Nt.ptr,pt,Jt)}GetAttributeDataArrayForAllPoints(Nt,pt,Jt,kt,Zt){Le(this.ptr,Nt.ptr,pt.ptr,Jt,kt,Zt)}},DT_INT8:We(),DT_UINT8:Be(),DT_INT16:lt(),DT_UINT16:bt(),DT_UINT32:ct(),DT_FLOAT32:It()}})}(fetch(bk())),fy.then(T=>{rl=T,fy=void 0}))}()),P&&x.push(function(){if(jS)return;const T=function(M){let R;const B=WebAssembly.instantiateStreaming(M,{}).then(Z=>{R=Z.instance,R.exports.__wasm_call_ctors()}),U={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(Z,H,K,re,se,ge){(function(me,pe,Ee,ye,Pe,Le,Re){const Ne=me.exports.sbrk,Ve=ye+3&-4,We=Ne(Ve*Pe),Be=Ne(Le.length),lt=new Uint8Array(me.exports.memory.buffer);lt.set(Le,Be);const bt=pe(We,ye,Pe,Be,Le.length);if(bt===0&&Re&&Re(We,Ve,Pe),Ee.set(lt.subarray(We,We+ye*Pe)),Ne(We-Ne(0)),bt!==0)throw new Error(`Malformed buffer data: ${bt}`)})(R,R.exports[W[se]],Z,H,K,re,R.exports[U[ge]])}}}(fetch(wk()));return T.ready.then(()=>{jS=T})}()),h)for(let T=0;T<h.length;T++)x.push(MU(h[T],u,T,s));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(C&&g)for(const{primitives:T}of g)for(const M of T)TU(M,u);if(P&&g&&E)for(const T of E)EU(T,u);return u})})}function Lh(c,r){const s=c.json.bufferViews[r.bufferView],u=n1[r.componentType];return new u(c.buffers[s.buffer],(r.byteOffset||0)+(s.byteOffset||0),r.count*(s.byteStride&&s.byteStride!==py[r.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:py[r.type]))}function US(c,r,s,u){const m=n1[r.componentType],h=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),g=c.json.bufferViews[r.bufferView],w=g.byteStride?g.byteStride/m.BYTES_PER_ELEMENT:py[r.type],E=s.float32,I=E.length/s.capacity;for(let x=0,C=0;x<r.count*w;x+=w,C+=I)for(let P=0;P<I;P++)E[C+P]=u[x+P]*h;s._trim()}function PU(c,r,s){const u=c.indices,m=c.attributes,h={};h.indexArray=new no;const g=r.json.accessors[u],w=g.count/3;h.indexArray.reserve(w);const E=Lh(r,g);for(let P=0;P<w;P++)h.indexArray.emplaceBack(E[3*P],E[3*P+1],E[3*P+2]);h.indexArray._trim(),h.vertexArray=new Dl;const I=r.json.accessors[m.POSITION];h.vertexArray.reserve(I.count);const x=Lh(r,I);for(let P=0;P<I.count;P++)h.vertexArray.emplaceBack(x[3*P],x[3*P+1],x[3*P+2]);if(h.vertexArray._trim(),h.aabb=new hr(I.min,I.max),h.centroid=function(P,T){const M=[0,0,0],R=P.length;if(R>0){for(let B=0;B<R;B++){const U=3*P[B];M[0]+=T[U],M[1]+=T[U+1],M[2]+=T[U+2]}M[0]/=R,M[1]/=R,M[2]/=R}return M}(E,x),m.COLOR_0!==void 0){const P=r.json.accessors[m.COLOR_0],T=py[P.type],M=Lh(r,P);h.colorArray=T===3?new Dl:new qa,h.colorArray.resize(P.count),US(r,P,h.colorArray,M)}if(m.NORMAL!==void 0){h.normalArray=new Dl;const P=r.json.accessors[m.NORMAL];h.normalArray.resize(P.count);const T=Lh(r,P);US(r,P,h.normalArray,T)}if(m.TEXCOORD_0!==void 0&&s.length>0){h.texcoordArray=new Wa;const P=r.json.accessors[m.TEXCOORD_0];h.texcoordArray.resize(P.count);const T=Lh(r,P);US(r,P,h.texcoordArray,T)}if(m._FEATURE_ID_RGBA4444!==void 0){const P=r.json.accessors[m._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Lh(r,P))}m._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Lh(r,r.json.accessors[m._FEATURE_RGBA4444]).buffer));const C=c.material;return h.material=function(P,T){const{emissiveFactor:M=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:B=.5,normalTexture:U,occlusionTexture:W,emissiveTexture:Z,doubleSided:H}=P,{baseColorFactor:K=[1,1,1,1],metallicFactor:re=1,roughnessFactor:se=1,baseColorTexture:ge,metallicRoughnessTexture:me}=P.pbrMetallicRoughness||{},pe=W?T[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&pe){const Ee=W.extensions.KHR_texture_transform;pe.offsetScale=[Ee.offset[0],Ee.offset[1],Ee.scale[0],Ee.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Xr(...K),metallicFactor:re,roughnessFactor:se,baseColorTexture:ge?T[ge.index]:void 0,metallicRoughnessTexture:me?T[me.index]:void 0},doubleSided:H,emissiveFactor:M,alphaMode:R,alphaCutoff:B,normalTexture:U?T[U.index]:void 0,occlusionTexture:pe,emissionTexture:Z?T[Z.index]:void 0,defined:P.defined===void 0}}(C!==void 0?r.json.materials[C]:{defined:!1},s),h}function Ak(c,r,s){const{matrix:u,rotation:m,translation:h,scale:g,mesh:w,extras:E,children:I}=c,x={};if(x.matrix=u||Me.mat4.fromRotationTranslationScale([],m||[0,0,0,1],h||[0,0,0],g||[1,1,1]),w!==void 0){x.meshes=s[w];const C=x.anchor=[0,0];for(const P of x.meshes){const{min:T,max:M}=P.aabb;C[0]+=T[0]+M[0],C[1]+=T[1]+M[1]}C[0]=Math.floor(C[0]/x.meshes.length/2),C[1]=Math.floor(C[1]/x.meshes.length/2)}if(E&&(E.id&&(x.id=E.id),E.lights&&(x.lights=function(C){if(!C.length)return[];const P=function(U){const W=atob(U),Z=new Uint8Array(W.length);for(let H=0;H<W.length;H++)Z[H]=W.codePointAt(H);return Z}(C),T=[],M=P.length/24,R=new Uint16Array(P.buffer),B=new Float32Array(P.buffer);for(let U=0;U<M;U++){const W=R[2*U*6]/30,Z=R[2*U*6+1]/30,H=R[2*U*6+10]/100,K=B[6*U+1],re=B[6*U+2],se=B[6*U+3],ge=B[6*U+4],me=se-K,pe=ge-re,Ee=Math.hypot(me,pe);T.push({pos:[K+.5*me,re+.5*pe,Z],normal:[pe/Ee,-me/Ee,0],width:Ee,height:W,depth:H,points:[K,re,se,ge]})}return T}(E.lights))),I){const C=[];for(const P of I)C.push(Ak(r.json.nodes[P],r,s));x.children=C}return x}function AU(c){if(c.vertices.length===0||c.indices.length===0)return null;const r=new $2(c.vertices,c.indices,8,256),[s,u]=[r.min.clone(),r.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:r,min:s,max:u}}function IU(c){if(!c.extras||!c.extras.ground)return null;const r=c.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const s=r[0];if(!s||!Array.isArray(s)||s.length===0)return null;const u=[];for(const g of s){if(!Array.isArray(g)||g.length!==2)continue;const w=g[0],E=g[1];typeof w=="number"&&typeof E=="number"&&u.push(new vt(w,E))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let m=0;for(let g=0;g<u.length;g++){const w=u[g],E=u[(g+1)%u.length],I=u[(g+2)%u.length];m+=(w.x-E.x)*(I.y-E.y)-(I.x-E.x)*(w.y-E.y)}m>0&&u.reverse();const h=j_(u.flatMap(g=>[g.x,g.y]),[]);return h.length===0?null:{vertices:u,indices:h}}function kU(c,r){const s=[],u=[];let m=0;const h=[];for(const g of c){m=s.length;const w=g.vertexArray.float32,E=g.indexArray.uint16;for(let I=0;I<g.vertexArray.length;I++)h[0]=w[3*I+0],h[1]=w[3*I+1],h[2]=w[3*I+2],Me.vec3.transformMat4(h,h,r),s.push(new vt(h[0],h[1]));for(let I=0;I<3*g.indexArray.length;I++)u.push(E[I]+m)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){const w=s[u[g+0]],E=s[u[g+1]],I=s[u[g+2]];(w.x-E.x)*(I.y-E.y)-(I.x-E.x)*(w.y-E.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:s,indices:u}}function Ik(c){const r=function(E,I){const x=[],C=WebGL2RenderingContext;if(E.json.textures)for(const P of E.json.textures){const T={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};P.sampler!==void 0&&Object.assign(T,E.json.samplers[P.sampler]),x.push({image:I[P.source],sampler:T,uploaded:!1})}return x}(c,c.images),s=function(E,I){const x=[];for(const C of E.json.meshes){const P=[];for(const T of C.primitives)P.push(PU(T,E,I));x.push(P)}return x}(c,r),{scenes:u,scene:m,nodes:h}=c.json,g=u?u[m||0].nodes:h,w=[];for(const E of g)w.push(Ak(h[E],c,s));return function(E,I,x){const C={},P=new Set;for(let T=0;T<E.length;T++){const M=x[I[T]];if(!M.extras)continue;const R=M.extras["mapbox:footprint:version"],B=M.extras["mapbox:footprint:id"];(R||B)&&P.add(T),R==="1.0.0"&&B&&(C[B]=T)}for(let T=0;T<E.length;T++){if(P.has(T))continue;const M=E[T],R=x[I[T]];if(!R.extras)continue;let B=null;M.id in C&&(B=kU(E[C[M.id]].meshes,M.matrix)),B||(B=IU(R)),B&&(M.footprint=AU(B))}if(P.size>0){const T=Array.from(P.values()).sort((M,R)=>M-R);for(let M=T.length-1;M>=0;M--)E.splice(T[M],1)}}(w,g,c.json.nodes),w}function RU(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const r=c.vertexArray.float32,s=c.aabb.min[0]-1,u=c.aabb.min[1]-1,m=kh/(c.aabb.max[0]-s+2),h=kh/(c.aabb.max[1]-u+2);for(let g=0;g<r.length;g+=3){const w=r[g+2],E=(r[g+0]-s)*m|0,I=(r[g+1]-u)*h|0;w>c.heightmap[I*kh+E]&&(c.heightmap[I*kh+E]=w)}}function DU(c,r){const s={};s.indexArray=new no,s.indexArray.reserve(4*c.length),s.vertexArray=new Dl,s.vertexArray.reserve(10*c.length),s.colorArray=new qa,s.vertexArray.reserve(10*c.length);let u=0;for(const g of c){const w=Math.min(10,Math.max(4,1.3*g.height))*r,E=[-g.normal[1],g.normal[0],0],I=Math.min(.29,.1*g.width/g.depth),x=g.width-2*g.depth*r*(I+.01),C=Me.vec3.scaleAndAdd([],g.pos,E,x/2),P=Me.vec3.scaleAndAdd([],g.pos,E,-x/2),T=[C[0],C[1],C[2]+g.height],M=[P[0],P[1],P[2]+g.height],R=Me.vec3.scaleAndAdd([],g.normal,E,I);Me.vec3.scale(R,R,w);const B=Me.vec3.scaleAndAdd([],g.normal,E,-I);Me.vec3.scale(B,B,w),Me.vec3.add(R,C,R),Me.vec3.add(B,P,B),C[2]+=.1,P[2]+=.1,s.vertexArray.emplaceBack(R[0],R[1],R[2]),s.vertexArray.emplaceBack(B[0],B[1],B[2]),s.vertexArray.emplaceBack(C[0],C[1],C[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(T[0],T[1],T[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(C[0],C[1],C[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(R[0],R[1],R[2]),s.vertexArray.emplaceBack(B[0],B[1],B[2]);const U=x/w/2;s.colorArray.emplaceBack(-U-I,-1,U,.8),s.colorArray.emplaceBack(U+I,-1,U,.8),s.colorArray.emplaceBack(-U,0,U,1.3),s.colorArray.emplaceBack(U,0,U,1.3),s.colorArray.emplaceBack(U+I,-.8,U,.7),s.colorArray.emplaceBack(U+I,-.8,U,.7),s.colorArray.emplaceBack(0,0,U,1.3),s.colorArray.emplaceBack(0,0,U,1.3),s.colorArray.emplaceBack(U+I,-1.2,U,.8),s.colorArray.emplaceBack(U+I,-1.2,U,.8),s.indexArray.emplaceBack(6+u,4+u,8+u),s.indexArray.emplaceBack(7+u,9+u,5+u),s.indexArray.emplaceBack(0+u,1+u,2+u),s.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const m={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=Xr.white,m.pbrMetallicRoughness=h,s.material=m,s.aabb=new hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}class kk{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const u=r[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const LU=["id","tile","layer","source","sourceLayer","state"];class nm{constructor(r,s,u,m,h){this.type="Feature",this._vectorTileFeature=r,this._z=s,this._x=u,this._y=m,this.properties=r.properties,this.id=h}clone(){const r=new nm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state={...this.state}),this.layer&&(r.layer={...this.layer}),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of LU)this[s]!==void 0&&(r[s]=this[s]);return r}}class Rk{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new bc(Lt,16,0),this.featureIndexArray=new lx,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,s,u,m,h,g=0,w=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,h,g);const I=this.grid;for(let x=0;x<s.length;x++){const C=s[x],P=[1/0,1/0,-1/0,-1/0];for(let T=0;T<C.length;T++){const M=C[T];P[0]=Math.min(P[0],M.x),P[1]=Math.min(P[1],M.y),P[2]=Math.max(P[2],M.x),P[3]=Math.max(P[3],M.y)}w!==0&&(P[0]-=w,P[1]-=w,P[2]+=w,P[3]+=w),P[0]<Lt&&P[1]<Lt&&P[2]>=0&&P[3]>=0&&I.insert(E,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new $p.VectorTile(new Px(this.rawTileData)).layers,this.sourceLayerCoder=new kk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,s){const{tilespaceGeometry:u,transform:m,tileTransform:h,pixelPosMatrix:g,availableImages:w}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const E=u.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(T,M,R,B)=>tt(u.bufferedTilespaceGeometry,T,M,R,B));I.sort(OU);let x=null;m.elevation&&I.length>0&&(x=Xp.create(m.elevation,this.tileID));const C={};let P;for(let T=0;T<I.length;T++){const M=I[T];if(M===P)continue;P=M;const R=this.featureIndexArray.get(M);let B=null;this.is3DTile?this.loadMatchingModelFeature(C,R,r,u,m):this.loadMatchingFeature(C,R,r,w,(U,W,Z,H=0)=>(B||(B=V(U,this.tileID.canonical,h)),W.queryIntersectsFeature(u,U,Z,B,this.z,m,g,x,H)))}return C}loadMatchingFeature(r,s,u,m,h){const{featureIndex:g,bucketIndex:w,sourceLayerIndex:E,layoutVertexArrayOffset:I}=s,x=this.bucketLayerIDs[w],C=u.layers,P=Object.keys(C);if(P.length&&!function(U,W){for(let Z=0;Z<U.length;Z++)if(W.indexOf(U[Z])>=0)return!0;return!1}(P,x))return;const T=u.sourceCache,M=this.sourceLayerCoder.decode(E),R=this.vtLayers[M].feature(g),B=this.getId(R,M);for(let U=0;U<x.length;U++){const W=x[U];if(!C[W])continue;const{styleLayer:Z,targets:H}=C[W];let K={};B!==void 0&&(K=T.getFeatureState(Z.sourceLayer,B));const re=!h||h(R,Z,K,I);if(!re)continue;const se=new nm(R,this.z,this.x,this.y,B);se.tile=this.tileID.canonical,se.state=K;let ge=this.serializedLayersCache.get(W);ge||(ge=Z.serialize(),ge.id=W,this.serializedLayersCache.set(W,ge)),se.source=ge.source,se.sourceLayer=ge["source-layer"],se.layer=Xn({},ge),se.layer.paint=Dk(ge.paint,Z.paint,R,K,m),se.layer.layout=Dk(ge.layout,Z.layout,R,K,m);let me=!1;for(const pe of H){this.updateFeatureProperties(se,pe);const{filter:Ee}=pe;if(Ee){if(R.properties=se.properties,Ee.needGeometry){const ye=q(R,!0);if(!Ee.filter(new Gn(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!Ee.filter(new Gn(this.tileID.overscaledZ),R))continue}me=!0,pe.targetId&&this.addFeatureVariant(se,pe)}me&&this.appendToResult(r,W,g,se,re)}}loadMatchingModelFeature(r,s,u,m,h){const g=this.bucketLayerIDs[0][0],w=u.layers;if(!w[g])return;const{styleLayer:E,targets:I}=w[g];if(E.type!=="model")return;const x=m.tile,C=s.featureIndex,P=x.getBucket(E);if(!(P&&P instanceof Yx))return;const T=function(ge,me,pe,Ee){const ye=ge.getNodesInfo()[me];if(ye.hiddenByReplacement||!ye.node.meshes)return;let Pe=Number.MAX_VALUE;const Le=ye.node,Re=pe.tile,Ne=Ee.calculatePosMatrix(Re.tileID.toUnwrapped(),Ee.worldSize),Ve=ye.evaluatedScale;let We=0;Ee.elevation&&Le.elevation&&(We=Le.elevation*Ee.elevation.exaggeration()),Me.mat4.translate(Ne,Ne,[(Le.anchor?Le.anchor[0]:0)*(Ve[0]-1),(Le.anchor?Le.anchor[1]:0)*(Ve[1]-1),We]),Me.mat4.scale(Ne,Ne,Ve);const Be=pe.queryGeometry,lt=Be.isPointQuery()?Be.screenBounds:Be.screenGeometry,bt=function(It){const At=Me.mat4.multiply([],Ne,It.matrix);Me.mat4.multiply(At,Ee.expandedFarZProjMatrix,At);for(let Nt=0;Nt<It.meshes.length;++Nt){const pt=It.meshes[Nt];if(Nt===It.lightMeshIndex)continue;const Jt=DI(lt,Ee,At,pt.aabb);Jt!=null&&(Pe=Math.min(Jt,Pe))}if(It.children)for(const Nt of It.children)bt(Nt)};if(bt(Le),Pe===Number.MAX_VALUE)return;const ct=new Kr(0,0);return HI(Re.tileID.canonical,ct,ye.node.anchor[0],ye.node.anchor[1]),{intersectionZ:Pe,position:ct,feature:ye.feature}}(P,C,m,h);if(!T)return;const{z:M,x:R,y:B}=x.tileID.canonical,{feature:U,intersectionZ:W,position:Z}=T;let H={};U.id!==void 0&&(H=u.sourceCache.getFeatureState(E.sourceLayer,U.id));const K=new nm({},M,R,B,U.id);K.tile=this.tileID.canonical,K.state=H,K.properties=U.properties,K.geometry={type:"Point",coordinates:[Z.lng,Z.lat]};let re=this.serializedLayersCache.get(g);re||(re=E.serialize(),re.id=g,this.serializedLayersCache.set(g,re)),K.source=re.source,K.sourceLayer=re["source-layer"],K.layer=Xn({},re);let se=!1;for(const ge of I){this.updateFeatureProperties(K,ge);const{filter:me}=ge;if(me){if(U.properties=K.properties,me.needGeometry){if(!me.filter(new Gn(this.tileID.overscaledZ),U,this.tileID.canonical))continue}else if(!me.filter(new Gn(this.tileID.overscaledZ),U))continue}se=!0,ge.targetId&&this.addFeatureVariant(K,ge)}se&&this.appendToResult(r,g,C,K,W)}updateFeatureProperties(r,s,u){if(s.properties){const m={};for(const h in s.properties){const g=s.properties[h].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,u);g!=null&&(m[h]=g)}r.properties=m}}addFeatureVariant(r,s,u){const m={target:s.target,namespace:s.namespace};s.properties&&(m.properties=r.properties),r.variants=r.variants||{},r.variants[s.targetId]=r.variants[s.targetId]||[],r.variants[s.targetId].push(m)}appendToResult(r,s,u,m,h){let g=r[s];g===void 0&&(g=r[s]=[]),g.push({featureIndex:u,feature:m,intersectionZ:h})}lookupSymbolFeatures(r,s,u,m,h){const g={};this.loadVTLayers();for(const w of r)this.loadMatchingFeature(g,{bucketIndex:s,sourceLayerIndex:u,featureIndex:w,layoutVertexArrayOffset:0},m,h);return g}loadFeature(r){const{featureIndex:s,sourceLayerIndex:u}=r;this.loadVTLayers();const m=this.sourceLayerCoder.decode(u),h=this.vtFeatures[m];if(h[s])return h[s];const g=this.vtLayers[m].feature(s);return h[s]=g,g}hasLayer(r){for(const s of this.bucketLayerIDs)for(const u of s)if(r===u)return!0;return!1}getId(r,s){let u=r.id;if(this.promoteId){const m=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];m!=null&&(u=r.properties[m]),typeof u=="boolean"&&(u=Number(u))}return u}}function Dk(c,r,s,u,m){return Oo(c,(h,g)=>{const w=r instanceof Au?r.get(g):null;return w&&w.evaluate?w.evaluate(s,u,m):w})}function OU(c,r){return r-c}qt(Rk,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Lk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class VS{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(r,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const h=Lk[15&u];if(!h)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(r,2,1),[w]=new Uint32Array(r,4,1);return new VS(w,g,h,r)}constructor(r,s=64,u=Float64Array,m){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const h=Lk.indexOf(this.ArrayType),g=2*r*this.ArrayType.BYTES_PER_ELEMENT,w=r*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+w+E,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+g+w+E),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+w+E,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=r)}add(r,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=s,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return $S(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,s,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:w}=this,E=[0,h.length-1,0],I=[];for(;E.length;){const x=E.pop()||0,C=E.pop()||0,P=E.pop()||0;if(C-P<=w){for(let B=P;B<=C;B++){const U=g[2*B],W=g[2*B+1];U>=r&&U<=u&&W>=s&&W<=m&&I.push(h[B])}continue}const T=P+C>>1,M=g[2*T],R=g[2*T+1];M>=r&&M<=u&&R>=s&&R<=m&&I.push(h[T]),(x===0?r<=M:s<=R)&&(E.push(P),E.push(T-1),E.push(1-x)),(x===0?u>=M:m>=R)&&(E.push(T+1),E.push(C),E.push(1-x))}return I}within(r,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:h,nodeSize:g}=this,w=[0,m.length-1,0],E=[],I=u*u;for(;w.length;){const x=w.pop()||0,C=w.pop()||0,P=w.pop()||0;if(C-P<=g){for(let B=P;B<=C;B++)zk(h[2*B],h[2*B+1],r,s)<=I&&E.push(m[B]);continue}const T=P+C>>1,M=h[2*T],R=h[2*T+1];zk(M,R,r,s)<=I&&E.push(m[T]),(x===0?r-u<=M:s-u<=R)&&(w.push(P),w.push(T-1),w.push(1-x)),(x===0?r+u>=M:s+u>=R)&&(w.push(T+1),w.push(C),w.push(1-x))}return E}}function $S(c,r,s,u,m,h){if(m-u<=s)return;const g=u+m>>1;Ok(c,r,g,u,m,h),$S(c,r,s,u,g-1,1-h),$S(c,r,s,g+1,m,1-h)}function Ok(c,r,s,u,m,h){for(;m>u;){if(m-u>600){const I=m-u+1,x=s-u+1,C=Math.log(I),P=.5*Math.exp(2*C/3),T=.5*Math.sqrt(C*P*(I-P)/I)*(x-I/2<0?-1:1);Ok(c,r,s,Math.max(u,Math.floor(s-x*P/I+T)),Math.min(m,Math.floor(s+(I-x)*P/I+T)),h)}const g=r[2*s+h];let w=u,E=m;for(my(c,r,u,s),r[2*m+h]>g&&my(c,r,u,m);w<E;){for(my(c,r,w,E),w++,E--;r[2*w+h]<g;)w++;for(;r[2*E+h]>g;)E--}r[2*u+h]===g?my(c,r,u,E):(E++,my(c,r,E,m)),E<=s&&(u=E+1),s<=E&&(m=E-1)}}function my(c,r,s,u){GS(c,s,u),GS(r,2*s,2*u),GS(r,2*s+1,2*u+1)}function GS(c,r,s){const u=c[r];c[r]=c[s],c[s]=u}function zk(c,r,s,u){const m=c-s,h=r-u;return m*m+h*h}o.$=p_,o.A=Ii,o.B=2,o.C=XA,o.D=Kp,o.E=uu,o.F=aS,o.G=class extends Wx{},o.H=_c,o.I=DS,o.J=Vf,o.K=Xv,o.L=dp,o.M=Tu,o.N=Nv,o.O=c_,o.P=vt,o.Q=Tp,o.R=uc,o.S=Uv,o.T=vS,o.U=ph,o.V=Wx,o.W=vc,o.X=Ga,o.Y=xu,o.Z=qo,o._=Uf,o.a=function(c){return xe.API_CDN_URL_REGEX.test(c)},o.a$=nm,o.a0=hp,o.a1=zv,o.a2=function(c){const r=c.value;let s=[];if(!r)return s;const u=_c(r);return u!=="string"?(s=s.concat([new Wx(c.key,r,`string expected, "${u}" found`)]),s):(OI(r,!0)||(s=s.concat([new Wx(c.key,r,`invalid url "${r}"`)])),s)},o.a3=Ke,o.a4=Ec,o.a5=ti,o.a6=Mt,o.a7=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return nn(c.expression.evaluate(r))}interpolate(c,r,s){return{x:pr(c.x,r.x,s),y:pr(c.y,r.y,s),z:pr(c.z,r.z,s),azimuthal:pr(c.azimuthal,r.azimuthal,s),polar:pr(c.polar,r.polar,s)}}},o.a8=Gn,o.a9=Eu,o.aA=Ya,o.aB=class{constructor(c){this.entries={},this.scheduler=c}request(c,r,s,u){const m=this.entries[c]=this.entries[c]||{callbacks:[]};if(m.result){const[h,g]=m.result;return this.scheduler?this.scheduler.add(()=>{u(h,g)},r):u(h,g),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=s((h,g)=>{m.result=[h,g];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(h,g)},r):w(h,g);setTimeout(()=>delete this.entries[c],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(h=>h!==u),m.callbacks.length||(m.cancel(),delete this.entries[c]))}}},o.aC=zo,o.aD=function(c,r,s){const u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},m=>{const h=dc(c.request,(g,w,E,I)=>{g?m(g):w&&m(null,{vectorTile:s?void 0:new $p.VectorTile(new Px(w)),rawData:w,cacheControl:E,expires:I})});return()=>{h.cancel(),m()}},r)},o.aE=function(c){vi++,vi>wr&&(c.getActor().send("enforceCacheSizeLimit",Tr),vi=0)},o.aF=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},o.aG=Dt,o.aH=wI,o.aI=PI,o.aJ=bI,o.aK=function(c,r){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let u=0;u<c.length;u++){const m=document.createElement("source");zg(c[u])||(s.crossOrigin="Anonymous"),m.src=c[u],s.appendChild(m)}return{cancel:()=>{}}},o.aL=Vx,o.aM=function(c){return fetch(c).then(r=>r.arrayBuffer()).then(r=>Pk(r,0,c))},o.aN=Ik,o.aO=class{constructor(c,r,s,u){this.id=c,this.position=r!=null?new Kr(r[0],r[1]):new Kr(0,0),this.orientation=s??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,r){if(Me.mat4.multiply(c.matrix,r,c.matrix),c.meshes)for(const s of c.meshes){const u=hr.applyTransformFast(s.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(const s of c.children)this._applyTransformations(s,c.matrix)}computeBoundsAndApplyParent(){const c=Me.mat4.identity([]);for(const r of this.nodes)this._applyTransformations(r,c)}computeModelMatrix(c,r,s,u,m,h,g=!1){BI(this.matrix,this,c.transform,this.position,r,s,u,m,h,g)}upload(c){if(!this.uploaded){for(const r of this.nodes)TS(r,c);for(const r of this.nodes)Zx(r);this.uploaded=!0}}destroy(){for(const c of this.nodes)ES(c)}},o.aP=Lo,o.aQ=Q_,o.aR=Jo,o.aS=Ki,o.aT=Ou,o.aU=no,o.aV=Ui,o.aW=ix,o.aX=Bx,o.aY=function(){Xo.isLoading()||Xo.isLoaded()||f_()!=="deferred"||Wv()},o.aZ=Kv,o.a_=q,o.aa=y,o.ab=Me,o.ac=Ur,o.ad=Au,o.ae=mo,o.af=pr,o.ag=Lt,o.ah=jg,o.ai=je,o.aj=Xr,o.ak=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return function([s,u]){const m=nn([1,s,u]);return{x:m.x,y:m.y,z:m.z}}(c.expression.evaluate(r))}interpolate(c,r,s){return{x:pr(c.x,r.x,s),y:pr(c.y,r.y,s),z:pr(c.z,r.z,s)}}},o.al=function(c,r,s=0,u=!0){const m=new vt(s,s),h=c.sub(m),g=r.add(m),w=[h,new vt(g.x,h.y),g,new vt(h.x,g.y)];return u&&w.push(h.clone()),w},o.am=function(c,r){const s=[];for(let u=0;u<c.length;u++){const m=$n(u-1,-1,c.length-1),h=$n(u+1,-1,c.length-1),g=c[u],w=c[h],E=c[m].sub(g).unit(),I=w.sub(g).unit(),x=I.angleWithSep(E.x,E.y),C=E.add(I).unit().mult(-1*r/Math.sin(x/2));s.push(g.add(C))}return s},o.an=aI,o.ao=tt,o.ap=function(c,r,s=0){return Me.vec3.fromValues(((r.x-s)*c.scale-c.x)*Lt,(r.y*c.scale-c.y)*Lt,z_(r.z,r.y))},o.aq=Rr,o.ar=EA,o.as=function(c){let r=1/0,s=1/0,u=-1/0,m=-1/0;for(const h of c)r=Math.min(r,h.x),s=Math.min(s,h.y),u=Math.max(u,h.x),m=Math.max(m,h.y);return{min:new vt(r,s),max:new vt(u,m)}},o.at=Bl,o.au=ze,o.av=S,o.aw=Ot,o.ax=fo,o.ay=function(c,r){const s={};for(let u=0;u<r.length;u++){const m=r[u];m in c&&(s[m]=c[m])}return s},o.az=jl,o.b=function(c){return xe.API_FONTS_REGEX.test(c)},o.b$=Hx,o.b0=Vi,o.b1=J2,o.b2=V2,o.b3=V,o.b4=Ha,o.b5=C_,o.b6=$r,o.b7=ri,o.b8=j_,o.b9=gS,o.bA=nA,o.bB=uS,o.bC=nI,o.bD=sS,o.bE=VS,o.bF=$n,o.bG=Pi,o.bH=Co,o.bI=function(c,r,s){c[4*r+0]=s[0],c[4*r+1]=s[1],c[4*r+2]=s[2],c[4*r+3]=s[3]},o.bJ=Ch,o.bK=ya,o.bL=Op,o.bM=li,o.bN=Cc,o.bO=Kr,o.bP=hI,o.bQ=Ft,o.bR=Gr,o.bS=II,o.bT=zt,o.bU=Nn,o.bV=function(c,r,s,u,m,h,g,w,E){if(E.name==="globe")return Nn(c,r,new zt(s,u,m),!1);const I=Q_({z:s,x:u,y:m},E);return new hr([(h+I.x/I.scale)*r,r*(I.y/I.scale),g],[(h+I.x2/I.scale)*r,r*(I.y2/I.scale),w])},o.bW=function(c,r,s){let u=0;for(let m=0;m<2;++m)c[m]>0&&(u+=(c[m]-0)*(c[m]-0)),r[m]<0&&(u+=(0-r[m])*(0-r[m]));return u},o.bX=ui,o.bY=R_,o.bZ=function(c){const r=Me.mat4.identity(new Float64Array(16));Me.mat4.multiply(r,c.pixelMatrix,c.globeMatrix);const s=[0,Ps,0],u=[0,As,0];return Me.vec3.transformMat4(s,s,r),Me.vec3.transformMat4(u,u,r),[s[0]>0&&s[0]<=c.width&&s[1]>0&&s[1]<=c.height&&!Ka(c,new Kr(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!Ka(c,new Kr(c.center.lat,-90))]},o.b_=function(c,r){const{scale:s}=c.tileTransform,u=s*Lt/(c.tileSize*Math.pow(2,r.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return Me.mat2.scale(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},o.ba=function(c,r){const s=mo(r.zoom);if(s===0)return ki(c);const u=Tn(c),m=qr(u),h=Bl(u.getWest())*r.worldSize,g=Bl(u.getEast())*r.worldSize,w=Ya(u.getNorth())*r.worldSize,E=Ya(u.getSouth())*r.worldSize,I=[h,w,0],x=[g,w,0],C=[h,E,0],P=[g,E,0],T=Me.mat4.invert([],r.globeMatrix);return Me.vec3.transformMat4(I,I,T),Me.vec3.transformMat4(x,x,T),Me.vec3.transformMat4(C,C,T),Me.vec3.transformMat4(P,P,T),m[0]=mi(m[0],C,s),m[1]=mi(m[1],P,s),m[2]=mi(m[2],x,s),m[3]=mi(m[3],I,s),hr.fromPoints(m)},o.bb=io,o.bc=ni,o.bd=mi,o.be=Lu,o.bf=xr,o.bg=NS,o.bh=Px,o.bi=dc,o.bj=function(c){const r=[];for(const s in c)r.push(c[s]);return r},o.bk=function(c,r){const s=[];for(const u in c)u in r||s.push(u);return s},o.bl=Ln,o.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bn=Mn,o.bo=function(c,r){const{x:s,y:u}=c.point,m=va(s,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return Me.mat4.multiply(m,m,ls(ki(r)))},o.bp=Gp,o.bq=ea,o.br=Mx,o.bs=function(c,r,s,u,m){const h=5*r+2;c.float32[h+0]=s,c.float32[h+1]=u,c.float32[h+2]=m},o.bt=jx,o.bu=YA,o.bv=ce,o.bw=go,o.bx=KP,o.by=LI,o.bz=rA,o.c=Ae,o.c$=(c,r,s,u,m,h,g,w)=>{const E=c.transform,I=E.pitch<15?CA(.07,.7,Ot((14-E.zoom)/5,0,1)):.07,x=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:PA(c,r,s,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:m,u_width_scale:h,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:MA(r,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(x?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:p(r.tileID.canonical,0)}},o.c0=AI,o.c1=function(c){const r=AI(c,!0);return Me.mat2.invert([],[r[0],r[1],r[4],r[5]])},o.c2=Bn,o.c3=function(c){const{x:r,y:s}=c.point,{lng:u,lat:m}=c._center;return va(r,s,c.worldSize,u,m)},o.c4=dt,o.c5=$t,o.c6=k_,o.c7=function(c){const r=Math.round((c+45+360)%360/90)%4;return St[r]},o.c8=45,o.c9=Mh,o.cA=class extends Ks{constructor(c){super(c),this.current=D2}set(c,r,s){if(this.fetchUniformLocation(c,r)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},o.cB=or,o.cC=function(c,r,s){const u=mo(s.zoom),m=c.style.map._antialias,h=r.options.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return u===0&&!m&&!h},o.cD=function(c){const r=c.pixelsPerMeter,s=r/Co(1,c.center.lat),u=Me.mat4.identity(new Float64Array(16));return Me.mat4.translate(u,u,[c.point.x,c.point.y,0]),Me.mat4.scale(u,u,[s,s,r]),Float32Array.from(u)},o.cE=Tn,o.cF=function(c){const r=ui-5;c=Ot(c,-r,r)/r*90;const s=Math.pow(Math.abs(Math.sin(je(c))),3);return Math.round(s*(D_.length-1))},o.cG=function(c,r,s,u){const m=r.getNorth(),h=r.getSouth(),g=r.getWest(),w=r.getEast(),E=1<<c.z,I=w-g,x=m-h,C=I/Pc,P=-x/D_[s],T=[0,C,0,P,0,0,m,g,0];if(c.z>0){const M=180/u;Me.mat3.multiply(T,T,[M/I+1,0,0,0,M/x+1,0,-.5*M/C,.5*M/P,1])}return T[2]=E,T[5]=c.x,T[8]=c.y,T},o.cH=ki,o.cI=function(c,r,s){const u=Me.mat4.identity(new Float64Array(16)),m=(r/(1<<c)-.5)*Math.PI*2;return Me.mat4.rotateY(u,s.globeMatrix,m),Float32Array.from(u)},o.cJ=class{isDataAvailableAtPoint(c){const r=this._source();if(this.isUsingMockSource()||!r||c.y<0||c.y>1)return!1;const s=r.getSource().maxzoom,u=1<<s,m=Math.floor(c.x),h=Math.floor((c.x-m)*u),g=Math.floor(c.y*u),w=this.findDEMTileFor(new Dt(s,m,s,h,g));return!(!w||!w.dem)}getAtPointOrZero(c,r=0){return this.getAtPoint(c,r)||0}getAtPoint(c,r,s=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||c.y<0||c.y>1)return r;const m=u.getSource().maxzoom,h=1<<m,g=Math.floor(c.x),w=c.x-g,E=new Dt(m,g,m,Math.floor(w*h),Math.floor(c.y*h)),I=this.findDEMTileFor(E);if(!I||!I.dem)return r;const x=I.dem,C=1<<I.tileID.canonical.z,P=(w*C-I.tileID.canonical.x)*x.dim,T=(c.y*C-I.tileID.canonical.y)*x.dim,M=Math.floor(P),R=Math.floor(T);return(s?this.exaggeration():1)*pr(pr(x.get(M,R),x.get(M,R+1),T-R),pr(x.get(M+1,R),x.get(M+1,R+1),T-R),P-M)}getAtTileOffset(c,r,s){const u=1<<c.canonical.z;return this.getAtPointOrZero(new y(c.wrap+(c.canonical.x+r/Lt)/u,(c.canonical.y+s/Lt)/u))}getAtTileOffsetFunc(c,r,s,u){return m=>{const h=this.getAtTileOffset(c,m.x,m.y),g=u.upVector(c.canonical,m.x,m.y),w=u.upVectorScale(c.canonical,r,s).metersToTile;return Me.vec3.scale(g,g,h*w),g}}getForTilePoints(c,r,s,u){if(this.isUsingMockSource())return!1;const m=Xp.create(this,c,u);return!!m&&(r.forEach(h=>{h[2]=this.exaggeration()*m.getElevationAt(h[0],h[1],s)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(c);if(!r||!r.dem)return null;const s=r.dem.tree,u=r.tileID,m=1<<c.canonical.z-u.canonical.z;let h=c.canonical.x/m-u.canonical.x,g=c.canonical.y/m-u.canonical.y,w=0;for(let E=0;E<c.canonical.z-u.canonical.z&&!s.leaves[w];E++){h*=2,g*=2;const I=2*Math.floor(g)+Math.floor(h);w=s.childOffsets[w]+I,h%=1,g%=1}return{min:this.exaggeration()*s.minimums[w],max:this.exaggeration()*s.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let r=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const m of c){const h=this.getMinMaxForTile(m.tileID);h&&(s=Math.min(s,h.min),u=Math.max(u,h.max),r=!0)}return r?{min:s,max:u}:null}},o.cK=IP,o.cL=en,o.cM=function(c,r){return[Math.pow(c[0],2.2)*r,Math.pow(c[1],2.2)*r,Math.pow(c[2],2.2)*r]},o.cN=Xa,o.cO=de,o.cP=ae,o.cQ=256,o.cR=function(c,r){const s=[0,0,0],u=io(ki(r.canonical));return Me.vec3.transformMat4(s,s,u),Me.vec3.transformMat4(s,s,c),s},o.cS=c=>({u_camera_to_center_distance:new li(c),u_extrude_scale:new Fp(c),u_device_pixel_ratio:new li(c),u_matrix:new Ch(c),u_inv_rot_matrix:new Ch(c),u_merc_center:new ya(c),u_tile_id:new Op(c),u_zoom_transition:new li(c),u_up_dir:new Op(c),u_emissive_strength:new li(c)}),o.cT=c=>({u_matrix:new Ch(c),u_pixels_to_tile_units:new Fp(c),u_device_pixel_ratio:new li(c),u_width_scale:new li(c),u_floor_width_scale:new li(c),u_units_to_pixels:new ya(c),u_dash_image:new Cc(c),u_gradient_image:new Cc(c),u_image_height:new li(c),u_texsize:new ya(c),u_tile_units_to_pixels:new li(c),u_alpha_discard_threshold:new li(c),u_trim_offset:new ya(c),u_trim_fade_range:new ya(c),u_trim_color:new zp(c),u_emissive_strength:new li(c),u_zbias_factor:new li(c),u_tile_to_meter:new li(c)}),o.cU=c=>({u_matrix:new Ch(c),u_texsize:new ya(c),u_pixels_to_tile_units:new Fp(c),u_device_pixel_ratio:new li(c),u_width_scale:new li(c),u_floor_width_scale:new li(c),u_image:new Cc(c),u_units_to_pixels:new ya(c),u_tile_units_to_pixels:new li(c),u_alpha_discard_threshold:new li(c),u_trim_offset:new ya(c),u_trim_fade_range:new ya(c),u_trim_color:new zp(c),u_emissive_strength:new li(c),u_zbias_factor:new li(c),u_tile_to_meter:new li(c)}),o.cV=b_,o.cW=j6,o.cX=B6,o.cY=Up,o.cZ=(c,r,s,u,m,h)=>{const g=c.transform,w=g.projection.name==="globe";let E;if(h.paint.get("circle-pitch-alignment")==="map")if(w){const x=Xa(g.zoom,r.canonical)*g._pixelsPerMercatorPixel;E=Float32Array.from([x,0,0,x])}else E=g.calculatePixelsToTileUnitsMatrix(s);else E=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(g.projection),u_matrix:c.translatePosMatrix(r.projMatrix,s,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Bt.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:N_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(w){I.u_inv_rot_matrix=u,I.u_merc_center=m,I.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],I.u_zoom_transition=mo(g.zoom);const x=m[0]*Lt,C=m[1]*Lt;I.u_up_dir=g.projection.upVector(new zt(0,0,0),x,C)}return I},o.c_=AA,o.ca=zp,o.cb=function(c,r,s){const u=Math.sqrt(c*c+r*r+s*s),m=u>0?Math.acos(s/u)*ei:0;let h=c!==0||r!==0?Math.atan2(-r,-c)*ei+90:0;return h<0&&(h+=360),[u,h,m]},o.cc=p,o.cd=hr,o.ce=nn,o.cf=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},o.cg=function(c,r){return c.readFields(k8,{icons:[]},r)},o.ch=function(c){return c({pluginStatus:Yo,pluginURL:Ys}),Sp.on("pluginStateChange",c),c},o.ci=Xx,o.cj=qp,o.ck=lS,o.cl=cu,o.cm=h_,o.cn=gr,o.co=Kd,o.cp=To,o.cq=function(c){const r=c.indexOf(yh);return r>=0?c.slice(0,r):c},o.cr=function(c){return c.indexOf(yh)>=0},o.cs=function(c){const r=c.indexOf(yh);return r>=0?c.slice(r+1):""},o.ct=function(c){const r=[],s=c.id;return s===void 0&&r.push({message:`layers.${s}: missing required property "id"`}),c.render===void 0&&r.push({message:`layers.${s}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},o.cu=function(c,r,s,u){return c.type==="custom"?new _8(c,r):new P8[c.type](c,r,s,u)},o.cv=ss,o.cw=class extends nm{constructor(c,r){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state={...c.state}),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},o.cx=Sp,o.cy=Oa,o.cz=Np,o.d=function(c){return xe.API_TILEJSON_REGEX.test(c)},o.d$=Oo,o.d0=(c,r,s,u,m,h,g,w,E)=>{const I=c.transform,x=I.calculatePixelsToTileUnitsMatrix(r),C=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",P=I.pitch<15?CA(.07,.7,Ot((14-I.zoom)/5,0,1)):.07;return{u_matrix:PA(c,r,s,u),u_pixels_to_tile_units:x,u_device_pixel_ratio:h,u_width_scale:g,u_floor_width_scale:w,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:IA(s)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:MA(r,c.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(C?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:p(r.tileID.canonical,0)}},o.d1=Zi,o.d2=F_,o.d3=gA,o.d4=vr,o.d5=Ex,o.d6=Uu,o.d7=450,o.d8=7,o.d9=g8,o.dA=Xt,o.dB=l,o.dC=Ic,o.dD=function([c,r,s]){const u=Math.hypot(c,r,s),m=Math.atan2(c,s),h=.5*Math.PI-Math.acos(-r/u);return new Kr(dt(m),dt(h))},o.dE=bS,o.dF=function(c){const r=c.navigator?c.navigator.userAgent:null;return!!function(s){if(fi==null){const u=s.navigator?s.navigator.userAgent:null;fi=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return fi}(c)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dG=function(c,r){Tr=c,wr=r},o.dH=Ka,o.dI=cs,o.dJ=function(c){const r=[0,0,0],s=Me.mat4.identity(new Float64Array(16));return Me.mat4.multiply(s,c.pixelMatrix,c.globeMatrix),Me.vec3.transformMat4(r,r,s),new vt(r[0],r[1])},o.dK=function(c,r,s=!1){if(Yo===_a||Yo===u_||Yo===d_)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ys=Bt.resolveURL(c),Yo=_a,wp=r,Cu(),s||Wv()},o.dL=f_,o.dM=function(){Xx().acquire(MS)},o.dN=function(){const c=ay;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(MS),ay=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dO=Dh,o.dP=function(c){const r=fn();if(!r)return;const s=r.delete(Mr);c&&s.catch(c).then(()=>c())},o.dQ=sy,o.dR=bk,o.dS=function(c){FS=Bt.resolveURL(c),rm||(rm=new Kp(Xx(),new uu)),rm.broadcast("setDracoUrl",FS)},o.dT=wk,o.dU=function(c){tm=Bt.resolveURL(c),rm||(rm=new Kp(Xx(),new uu)),rm.broadcast("setMeshoptUrl",tm)},o.dV=qt,o.dW=Bu,o.dX=Qa,o.dY=kk,o.dZ=Rk,o.d_=wA,o.da=Qr,o.db=Rp,o.dc=256,o.dd=ls,o.de=Dl,o.df=zl,o.dg=S_,o.dh=function(c,r,s,u,m){return Ot((c-r)/(s-r)*(m-u)+u,u,m)},o.di=Lv,o.dj=n,o.dk=class{constructor(c,r,s,u){this.context=c,this.format=u,this.size=s,this.texture=c.gl.createTexture();const[m,h,g]=this.size,{gl:w}=c;w.bindTexture(w.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,m,h,g,0,_S(this.format),yS(this.format),r.data)}bind(c,r){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},o.dl=wS,o.dm=[1,1,1],o.dn=Xp,o.dp=Yp,o.dq=Ol,o.dr=Wa,o.ds=ju,o.dt=E_,o.du=T_,o.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new vt(1/0,1/0),max:new vt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,r=!1){const s=QP(new vt(0,0),new vt(Lt,Lt),c),u=[];if(r&&!W2(s,this._globalClipBounds))return u;for(const m of this._activeRegions){if(m.hiddenByOverlap||!W2(s,m))continue;const h=h6(m.min,m.max,c);u.push({min:h.min,max:h.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return u}setSources(c){this._setSources(c.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const s=[];for(const u of r.cache.getVisibleCoordinates()){const m=r.cache.getTile(u).buckets[r.layer];m&&m.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(c){const r=c.getFootprints();if(r.length===0)return;const s=c.getOrder(),u=c.getClipMask(),m=c.getClipScope();for(const h of r){if(!h.footprint)continue;const g=QP(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:s,clipMask:u,clipScope:m})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,s)=>r.priority-s.priority||Sx(r.min,s.min)||Sx(r.max,s.max)||r.order-s.order||r.clipMask-s.clipMask||function(u,m){const h=(g,w)=>g+w;return u.length-m.length||u.reduce(h,"").localeCompare(m.reduce(h,""))}(r.clipScope,s.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let r=0;for(;!c&&r!==this._activeRegions.length;){const s=this._activeRegions[r],u=this._prevRegions[r];c=s.priority!==u.priority||!JP(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!Mn(s.clipScope,u.clipScope),++r}}if(c){++this._updateTime;for(const s of this._activeRegions)s.order!==wx&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const r=s=>{const u=this._activeRegions;if(s>=u.length)return s;const m=u[s].priority;for(;s<u.length&&u[s].priority===m;)++s;return s};if(this._sourceIds.length>1){let s=0,u=r(s);for(;s!==u;){let m=s;const h=s;for(;m!==u;){const g=this._activeRegions[m];g.hiddenByOverlap=!1;for(let w=0;w<h;w++){const E=this._activeRegions[w];if(!E.hiddenByOverlap&&g.order===wx&&W2(g,E)&&(g.hiddenByOverlap=tA(g.footprint,g.tileId,E.footprint,E.tileId),g.hiddenByOverlap))break}++m}s=u,u=r(s)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=c.length-1;r>=0;r--)this._addSource(c[r]);this._computeReplacement()}},o.dw=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,r){const s=new Ha,u=new no,m=[],h=c+1+2,g=r[0]+1,w=r[0]+1+(1+r.length),E=(I,x,C)=>{let P=I===h-1?I-2:I===0?I:I-1;return P+=C?24575:0,[P,x]};for(let I=0;I<h;++I)s.emplaceBack(...E(I,0,!0));for(let I=0;I<g;++I)for(let x=0;x<h;++x)s.emplaceBack(...E(x,I,(x===0||x===h-1)&&!0));for(let I=0;I<r.length;++I){const x=r[I];for(let C=0;C<h;++C)s.emplaceBack(...E(C,x,!0))}for(let I=0;I<r.length;++I){const x=u.length,C=r[I]+1+2,P=new no;for(let R=0;R<C-1;R++){const B=R===C-2,U=B?h*(w-r.length+I-R):h;for(let W=0;W<h-1;W++){const Z=R*h+W;R===0||B||W===0||W===h-2?(P.emplaceBack(Z+1,Z,Z+U),P.emplaceBack(Z+U,Z+U+1,Z+1)):(u.emplaceBack(Z+1,Z,Z+U),u.emplaceBack(Z+U,Z+U+1,Z+1))}}const T=ri.simpleSegment(0,x,s.length,u.length-x);for(let R=0;R<P.uint16.length;R+=3)u.emplaceBack(P.uint16[R],P.uint16[R+1],P.uint16[R+2]);const M=ri.simpleSegment(0,x,s.length,u.length-x);m.push({withoutSkirts:T,withSkirts:M})}return{vertices:s,indices:u,segments:m}}_createGrid(c){const r=this._fillGridMeshWithLods(Pc,D_);this._gridSegments=r.segments,this._gridBuffer=c.createVertexBuffer(r.vertices,$r.members),this._gridIndexBuffer=c.createIndexBuffer(r.indices,!0)}_createPoles(c){const r=new no;for(let g=0;g<=Pc;g++)r.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=c.createIndexBuffer(r,!0);const s=new zl,u=new zl,m=new zl,h=new zl;this._poleSegments=[];for(let g=0,w=0;g<k_;g++){const E=360/(1<<g);s.emplaceBack(0,-fo,0,.5,0),u.emplaceBack(0,-fo,0,.5,1),m.emplaceBack(0,-fo,0,.5,.5),h.emplaceBack(0,-fo,0,.5,.5);for(let I=0;I<=Pc;I++){let x=I/Pc,C=0;const P=pr(0,E,x),[T,M,R]=Ac(kc,Ph,P,fo);s.emplaceBack(T,M,R,x,C),u.emplaceBack(T,M,R,x,1-C);const B=je(P);x=.5+.5*Math.sin(B),C=.5+.5*Math.cos(B),m.emplaceBack(T,M,R,x,C),h.emplaceBack(T,M,R,x,1-C)}this._poleSegments.push(ri.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(s,ar,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,ar,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(m,ar,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(h,ar,!1)}getGridBuffers(c,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},o.dx=wx,o.dy=Kt,o.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.e=xe,o.e0=pc,o.e1=KA,o.e2=function(c,r,s,u,m,h,g,w,E,I,x=1,C,P){c.createArrays(),c.tilePixelRatio=Lt/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const T=c.layers[0].layout,M=c.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=x,R.textSizeScaleRange=T.get("text-size-scale-range"),R.iconSizeScaleRange=T.get("icon-size-scale-range");const[B,U]=R.textSizeScaleRange,[W,Z]=R.iconSizeScaleRange;if(R.textScaleFactor=Ot(R.scaleFactor,B,U),R.iconScaleFactor=Ot(R.scaleFactor,W,Z),c.textSizeData.kind==="composite"){const{minZoom:se,maxZoom:ge}=c.textSizeData;R.compositeTextSizes=[M["text-size"].possiblyEvaluate(new Gn(se),w),M["text-size"].possiblyEvaluate(new Gn(ge),w)]}if(c.iconSizeData.kind==="composite"){const{minZoom:se,maxZoom:ge}=c.iconSizeData;R.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new Gn(se),w),M["icon-size"].possiblyEvaluate(new Gn(ge),w)]}R.layoutTextSize=M["text-size"].possiblyEvaluate(new Gn(E+1),w),R.layoutIconSize=M["icon-size"].possiblyEvaluate(new Gn(E+1),w),R.textMaxSize=M["text-size"].possiblyEvaluate(new Gn(18),w);const H=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",K=T.get("text-size");let re=!1;for(const se of c.features)if(se.icon&&se.icon.nameSecondary){re=!0;break}for(const se of c.features){const ge=T.get("text-font").evaluate(se,{},w).join(","),me=K.evaluate(se,{},w)*R.textScaleFactor,pe=R.layoutTextSize.evaluate(se,{},w)*R.textScaleFactor,Ee=(R.layoutIconSize.evaluate(se,{},w),{horizontal:{},vertical:void 0}),ye=se.text;let Pe,Le=[0,0];if(ye){const We=ye.toString(),Be=T.get("text-letter-spacing").evaluate(se,{},w)*go,lt=T.get("text-line-height").evaluate(se,{},w)*go,bt=Gv(We)?Be:0,ct=T.get("text-anchor").evaluate(se,{},w),It=T.get("text-variable-anchor");if(!It){const kt=T.get("text-radial-offset").evaluate(se,{},w);Le=kt?nI(ct,[kt*go,cS]):T.get("text-offset").evaluate(se,{},w).map(Zt=>Zt*go)}let At=H?"center":T.get("text-justify").evaluate(se,{},w);const Nt=T.get("symbol-placement")==="point",pt=Nt?T.get("text-max-width").evaluate(se,{},w)*go:1/0,Jt=kt=>{c.allowVerticalPlacement&&yp(We)&&(Ee.vertical=oS(ye,r,s,m,ge,pt,lt,ct,kt,bt,Le,ea.vertical,!0,pe,me))};if(!H&&It){const kt=At==="auto"?It.map(ur=>uS(ur)):[At];let Zt=!1;for(let ur=0;ur<kt.length;ur++){const Pr=kt[ur];if(!Ee.horizontal[Pr])if(Zt)Ee.horizontal[Pr]=Ee.horizontal[0];else{const Ir=oS(ye,r,s,m,ge,pt,lt,"center",Pr,bt,Le,ea.horizontal,!1,pe,me);Ir&&(Ee.horizontal[Pr]=Ir,Zt=Ir.positionedLines.length===1)}}Jt("left")}else{if(At==="auto"&&(At=uS(ct)),Nt||T.get("text-writing-mode").indexOf("horizontal")>=0||!yp(We)){const kt=oS(ye,r,s,m,ge,pt,lt,ct,At,bt,Le,ea.horizontal,!1,pe,me);kt&&(Ee.horizontal[At]=kt)}Jt(Nt?"left":At)}}let Re=!1,Ne=!1;if(se.icon&&se.icon.namePrimary){const We=Cx(c.iconSizeData,M["icon-size"],w,c.zoom,se)*R.iconScaleFactor*C,Be=se.icon.getPrimary().scaleSelf(We).serialize(),lt=u[Be];lt&&(Pe=X6(m[Be],se.icon.nameSecondary?m[se.icon.getSecondary().scaleSelf(We).serialize()]:void 0,T.get("icon-offset").evaluate(se,{},w),T.get("icon-anchor").evaluate(se,{},w)),Re=lt.sdf,Ne=lt.usvg,c.sdfIcons===void 0?c.sdfIcons=lt.sdf:c.sdfIcons!==lt.sdf&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(lt.pixelRatio!==c.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const Ve=oI(Ee.horizontal)||Ee.vertical;c.iconsInText||(c.iconsInText=!!Ve&&Ve.iconsInText),(Ve||Pe)&&n8(c,se,Ee,Pe,u,R,pe,0,Le,Re,Ne,g,w,I,P,re)}h&&c.generateCollisionDebugBuffers(E,c.collisionBoxArray,R.textScaleFactor)},o.e3=$p,o.e4=r1,o.e5=tr,o.e6=WP,o.e7=zA,o.e8=k,o.e9=function(c){let r=0;if(new Uint32Array(c,0,1)[0]!==Tk){const s=new Uint32Array(c,0,7),[,,u,m,h,g]=s;r=s.byteLength+m+h+g+h,(u!==c.byteLength||r>=c.byteLength)&&Gt("Invalid b3dm header information.")}return Pk(c,r)},o.ea=function(c,r){const s=Ik(c);for(const u of s){for(const m of u.meshes)RU(m);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(DU(u.lights,r)))}return s},o.eb=Yx,o.ec=qI,o.ed=Xo,o.ee=function(c){_n(),tn!=null&&tn.then(r=>{r.keys().then(s=>{for(let u=0;u<s.length-c;u++)r.delete(s[u])})})},o.f=function(c){return c.indexOf("mapbox:")===0},o.g=function(c,r){return Oa(Xn(c,{method:"GET"}),r)},o.h=De,o.i=function(c){return xe.API_STYLE_REGEX.test(c)&&!Ae(c)},o.j=function(c){return decodeURIComponent(atob(c).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(r,s)=>String.fromCharCode(+("0x"+s))))},o.l=Xn,o.m=Eo,o.n=function(c,r){return Oa(Xn(c,{type:"json"}),r)},o.o=Nf,o.p=function(c,r){return Oa(Xn(c,{method:"POST"}),r)},o.q=Bt,o.r=Mo,o.s=function(c){try{const r=self[c];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=Et,o.u=function(){return function c(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},o.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},o.w=Gt,o.x=function(){return PS||(PS=new Dh),PS},o.y=Cl,o.z=El}),_(["./shared"],function(o){function k(rt){const ae=rt?rt.url.toString():void 0;return ae?performance.getEntriesByName(ae):[]}function O(rt){if(typeof rt=="number"||typeof rt=="boolean"||typeof rt=="string"||rt==null)return JSON.stringify(rt);if(Array.isArray(rt)){let de="[";for(const xe of rt)de+=`${O(xe)},`;return`${de}]`}let ae="{";for(const de of Object.keys(rt).sort())ae+=`${de}:${O(rt[de])},`;return`${ae}}`}function z(rt){let ae="";for(const de of o.bm)ae+=`/${O(rt[de])}`;return ae}class F{constructor(ae){this.keyCache={},this._layers={},this._layerConfigs={},ae&&this.replace(ae)}replace(ae,de){this._layerConfigs={},this._layers={},this.update(ae,[],de)}update(ae,de,xe){this._options=xe;for(const Ae of ae)this._layerConfigs[Ae.id]=Ae,(this._layers[Ae.id]=o.cu(Ae,this.scope,null,this._options)).compileFilter(xe),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id];for(const Ae of de)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const De=function(Ae,Ue){const Qe={};for(let it=0;it<Ae.length;it++){const at=Ae[it];let ut=Ue&&Ue[at.id];!ut&&(ut=z(at),at.type==="line"&&at.paint)&&function Bt(Vt){return typeof Vt=="string"&&Vt==="line-progress"||(Array.isArray(Vt)?Vt.some(Bt):!(!Vt||typeof Vt!="object")&&Object.values(Vt).some(Bt))}(at.paint["line-width"])&&(ut+=`/${O(at.paint["line-width"])}`),Ue&&(Ue[at.id]=ut);let Et=Qe[ut];Et||(Et=Qe[ut]=[]),Et.push(at)}const He=[];for(const it in Qe)He.push(Qe[it]);return He}(o.bj(this._layerConfigs),this.keyCache);for(const Ae of De){const Ue=Ae.map(Et=>this._layers[Et.id]),Qe=Ue[0];if(Qe.visibility==="none")continue;const He=Qe.source||"";let it=this.familiesBySource[He];it||(it=this.familiesBySource[He]={});const at=Qe.sourceLayer||"_geojsonTileLayer";let ut=it[at];ut||(ut=it[at]=[]),ut.push(Ue)}}}const G=1*o.dX;class ee{constructor(ae){const de={},xe=[];for(const Qe in ae){const He=ae[Qe],it=de[Qe]={};for(const at in He.glyphs){const ut=He.glyphs[+at];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const Et=ut.metrics.localGlyph?G:1,Bt={x:0,y:0,w:ut.bitmap.width+2*Et,h:ut.bitmap.height+2*Et};xe.push(Bt),it[at]=Bt}}const{w:De,h:Ae}=o.C(xe),Ue=new o.dW({width:De||1,height:Ae||1});for(const Qe in ae){const He=ae[Qe];for(const it in He.glyphs){const at=He.glyphs[+it];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const ut=de[Qe][it],Et=at.metrics.localGlyph?G:1;o.dW.copy(at.bitmap,Ue,{x:0,y:0},{x:ut.x+Et,y:ut.y+Et},at.bitmap)}}this.image=Ue,this.positions=de}}o.dV(ee,"GlyphAtlas");class J{constructor(ae){this.tileID=new o.aG(ae.tileID.overscaledZ,ae.tileID.wrap,ae.tileID.canonical.z,ae.tileID.canonical.x,ae.tileID.canonical.y),this.tileZoom=ae.tileZoom,this.uid=ae.uid,this.zoom=ae.zoom,this.lut=ae.lut,this.canonical=ae.tileID.canonical,this.pixelRatio=ae.pixelRatio,this.tileSize=ae.tileSize,this.source=ae.source,this.scope=ae.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ae.showCollisionBoxes,this.collectResourceTiming=!!ae.request&&ae.request.collectResourceTiming,this.promoteId=ae.promoteId,this.isSymbolTile=ae.isSymbolTile,this.tileTransform=o.aQ(ae.tileID.canonical,ae.projection),this.projection=ae.projection,this.worldview=ae.worldview,this.localizableLayerIds=ae.localizableLayerIds,this.brightness=ae.brightness,this.extraShadowCaster=!!ae.extraShadowCaster,this.tessellationStep=ae.tessellationStep,this.scaleFactor=ae.scaleFactor}parse(ae,de,xe,De,Ae){this.status="parsing",this.data=ae,this.collisionBoxArray=new o.aW;const Ue=new o.dY(Object.keys(ae.layers).sort()),Qe=new o.dZ(this.tileID,this.promoteId);Qe.bucketLayerIDs=[];const He={},it=new o.d_(256,256),at={featureIndex:Qe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:it,availableImages:xe,brightness:this.brightness,scaleFactor:this.scaleFactor},ut=de.familiesBySource[this.source];for(const wr in ut){const gn=ae.layers[wr];if(!gn)continue;let tn=!1,Nr=!1,fn=!1;for(const Eo of ut[wr])Eo[0].type==="symbol"?tn=!0:Nr=!0,Eo[0].is3D()&&Eo[0].type!=="model"&&(fn=!0);if(this.extraShadowCaster&&!fn||this.isSymbolTile===!0&&!tn||this.isSymbolTile===!1&&!Nr)continue;gn.version===1&&o.w(`Vector tile source "${this.source}" layer "${wr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _n=Ue.encode(wr),vi=[];for(let Eo=0,$i=0;Eo<gn.length;Eo++){const Xi=gn.feature(Eo),cc=Qe.getId(Xi,wr);if(this.localizableLayerIds&&this.localizableLayerIds.has(wr)){const ma=Xi.properties?Xi.properties.worldview:null;if(this.worldview&&typeof ma=="string")if(ma==="all")Xi.properties.$localized=!0;else{if(!ma.split(",").includes(this.worldview))continue;Xi.properties.$localized=!0,Xi.properties.worldview=this.worldview}}vi.push({feature:Xi,id:cc,index:$i,sourceLayerIndex:_n}),$i++}for(const Eo of ut[wr]){const $i=Eo[0];(!this.extraShadowCaster||$i.is3D()&&$i.type!=="model")&&(this.isSymbolTile!==void 0&&$i.type==="symbol"!==this.isSymbolTile||$i.minzoom&&this.zoom<Math.floor($i.minzoom)||$i.maxzoom&&this.zoom>=$i.maxzoom||$i.visibility!=="none"&&(te(Eo,this.zoom,at.brightness,xe),(He[$i.id]=$i.createBucket({index:Qe.bucketLayerIDs.length,layers:Eo,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_n,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(vi,at,this.tileID.canonical,this.tileTransform),Qe.bucketLayerIDs.push(Eo.map(Xi=>o.aC(Xi.id,Xi.scope)))))}}let Et,Bt,Vt,gr;it.trim();const Mr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Tr=()=>{if(Et)return this.status="done",Ae(Et);if(this.extraShadowCaster)this.status="done",Ae(null,{buckets:o.bj(He).filter(wr=>!wr.isEmpty()),featureIndex:Qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:at.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Bt&&Vt&&gr){const wr=new ee(Bt),gn=new o.e1(Vt,gr,this.lut);for(const tn in He){const Nr=He[tn];Nr instanceof o.aX?(te(Nr.layers,this.zoom,at.brightness,xe),o.e2(Nr,Bt,wr.positions,Vt,gn.iconPositions,this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Nr.hasPattern&&(Nr instanceof o.b1||Nr instanceof o.b2||Nr instanceof o.d5)&&(te(Nr.layers,this.zoom,at.brightness,xe),Nr.addFeatures(at,this.tileID.canonical,gn.patternPositions,xe,this.tileTransform,this.brightness))}this.status="done",Ae(null,{buckets:o.bj(He).filter(tn=>!tn.isEmpty()),featureIndex:Qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:wr.image,lineAtlas:it,imageAtlas:gn,brightness:at.brightness})}};if(!this.extraShadowCaster){const wr=o.d$(at.glyphDependencies,Nr=>Object.keys(Nr).map(Number));Object.keys(wr).length?De.send("getGlyphs",{uid:this.uid,stacks:wr,scope:this.scope},(Nr,fn)=>{Et||(Et=Nr,Bt=fn,Tr())},void 0,!1,Mr):Bt={};const gn=Object.keys(at.iconDependencies);gn.length?De.send("getImages",{icons:gn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Nr,fn)=>{if(Et)return;Et=Nr;const _n={};Object.values(fn).some(vi=>vi.usvg)?this.rasterize(De,_n,fn,at.iconDependencies,()=>{Vt=_n,Tr()}):(this.fillImageMap(_n,at.iconDependencies,fn),Vt=_n,Tr())},void 0,!1,Mr):Vt={};const tn=Object.keys(at.patternDependencies);tn.length?De.send("getImages",{icons:tn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Nr,fn)=>{if(!Et){Et=Nr;const _n={};Object.values(fn).some(vi=>vi.usvg)?this.rasterize(De,_n,fn,at.patternDependencies,()=>{gr=_n,Tr()}):(this.fillImageMap(_n,at.patternDependencies,fn),gr=_n,Tr())}},void 0,!1,Mr):gr={}}Tr()}fillImageMap(ae,de,xe){for(const De in xe){const Ae=de[De]||[];for(const Ue of Ae)xe[Ue.id].usvg||(ae[Ue.serialize()]=xe[Ue.id])}}getImageTaskQueue(ae,de,xe){const De={};for(const Ae in de){const Ue=xe[Ae]||[];for(const Qe of Ue){const He=Qe.serialize();de[Qe.id].usvg?De[He]||(De[He]=Qe):ae[He]=de[Qe.id]}}return De}rasterize(ae,de,xe,De,Ae){const Ue=this.getImageTaskQueue(de,xe,De);this.rasterizeTask=ae.send("rasterizeImages",{scope:this.scope,imageTasks:Ue},(Qe,He)=>{if(!Qe)for(const it in He){const{id:at}=o.e0.deserializeFromString(it);de[it]={...xe[at],data:He[it]}}Ae()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function te(rt,ae,de,xe){const De=new o.a8(ae,{brightness:de});for(const Ae of rt)Ae.recalculate(De,xe)}class oe extends o.E{constructor(ae,de,xe,De,Ae,Ue){super(),this.actor=ae,this.layerIndex=de,this.availableImages=xe,this.loadVectorData=Ae||o.aD,this.loading={},this.loaded={},this.deduped=new o.aB(ae.scheduler),this.isSpriteLoaded=De,this.scheduler=ae.scheduler,this.brightness=Ue}loadTile(ae,de){const xe=ae.uid,De=ae&&ae.request,Ae=De&&De.collectResourceTiming,Ue=this.loading[xe]=new J(ae);Ue.abort=this.loadVectorData(ae,(Qe,He)=>{const it=!this.loading[xe];if(delete this.loading[xe],Ue.cancelRasterize(),it||Qe||!He)return Ue.status="done",it||(this.loaded[xe]=Ue),de(Qe);const at=He.rawData,ut={};He.expires&&(ut.expires=He.expires),He.cacheControl&&(ut.cacheControl=He.cacheControl),Ue.vectorTile=He.vectorTile||new o.e3.VectorTile(new o.bh(at));const Et=()=>{Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(Bt,Vt)=>{if(Bt||!Vt)return de(Bt);const gr={};if(Ae){const Mr=k(De);Mr.length>0&&(gr.resourceTiming=JSON.parse(JSON.stringify(Mr)))}de(null,o.l({rawTileData:at.slice(0)},Vt,ut,gr))})};this.isSpriteLoaded?Et():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Et,{type:"parseTile",isSymbolTile:ae.isSymbolTile,zoom:ae.tileZoom}):Et()}),this.loaded=this.loaded||{},this.loaded[xe]=Ue})}reloadTile(ae,de){const xe=this.loaded,De=ae.uid;if(xe&&xe[De]){const Ae=xe[De];Ae.scaleFactor=ae.scaleFactor,Ae.showCollisionBoxes=ae.showCollisionBoxes,Ae.projection=ae.projection,Ae.brightness=ae.brightness,Ae.tileTransform=o.aQ(ae.tileID.canonical,ae.projection),Ae.extraShadowCaster=ae.extraShadowCaster,Ae.lut=ae.lut;const Ue=(Qe,He)=>{const it=Ae.reloadCallback;it&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,it)),de(Qe,He)};Ae.status==="parsing"?Ae.reloadCallback=Ue:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Ue):Ue())}else de(null,void 0)}abortTile(ae,de){const xe=ae.uid,De=this.loading[xe];De&&(De.abort&&De.abort(),delete this.loading[xe]),de()}removeTile(ae,de){const xe=this.loaded,De=ae.uid;xe&&xe[De]&&delete xe[De],de()}}class X{loadTile(ae,de){const{uid:xe,encoding:De,rawImageData:Ae,padding:Ue}=ae,Qe=ImageBitmap&&Ae instanceof ImageBitmap?this.getImageData(Ae,Ue):Ae;de(null,new o.e4(xe,Qe,De,Ue<1))}getImageData(ae,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ae.width,ae.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ae.width,this.offscreenCanvas.height=ae.height,this.offscreenCanvasContext.drawImage(ae,0,0,ae.width,ae.height);const xe=this.offscreenCanvasContext.getImageData(-de,-de,ae.width+2*de,ae.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}o.bg.setPbf(o.bh);class Q{decodeRasterArray({task:ae,buffer:de},xe){o.bg.performDecoding(de,ae).then(De=>{xe(null,De)},De=>{xe(De)})}}const ue=o.e3.VectorTileFeature.prototype.toGeoJSON;class he{constructor(ae){this._feature=ae,this.extent=o.ag,this.type=ae.type,this.properties=ae.tags,"id"in ae&&!isNaN(ae.id)&&(this.id=parseInt(ae.id,10))}loadGeometry(){if(this._feature.type===1){const ae=[];for(const de of this._feature.geometry)ae.push([new o.P(de[0],de[1])]);return ae}{const ae=[];for(const de of this._feature.geometry){const xe=[];for(const De of de)xe.push(new o.P(De[0],De[1]));ae.push(xe)}return ae}}toGeoJSON(ae,de,xe){return ue.call(this,ae,de,xe)}}class Ie{constructor(ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.ag,this.length=ae.length,this._features=ae}feature(ae){return new he(this._features[ae])}}const Je=64/4096,Ce=128;class Ze{constructor(){this.features=new Map}clear(){this.features.clear()}load(ae=[],de){for(const xe of ae){const De=xe.id;if(De==null)continue;let Ae=this.features.get(De);Ae&&this.updateCache(Ae,de),xe.geometry?(Ae=Ge(xe),this.updateCache(Ae,de),this.features.set(De,Ae)):this.features.delete(De),this.updateCache(Ae,de)}}updateCache(ae,de){for(const{canonical:xe,uid:De}of Object.values(de)){const{z:Ae,x:Ue,y:Qe}=xe;et(ae,Math.pow(2,Ae),Ue,Qe)&&delete de[De]}}getTile(ae,de,xe){const De=Math.pow(2,ae),Ae=[];for(const Ue of this.features.values())et(Ue,De,de,xe)&&Ae.push(Wt(Ue,De,de,xe));return{features:Ae}}getFeatures(){return[...this.features.values()]}}function et({minX:rt,minY:ae,maxX:de,maxY:xe},De,Ae,Ue){return rt<(Ae+1+Je)/De&&ae<(Ue+1+Je)/De&&de>(Ae-Je)/De&&xe>(Ue-Je)/De}function Ge(rt){const{id:ae,geometry:de,properties:xe}=rt;if(!de)return;if(de.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:De,coordinates:Ae}=de,Ue={id:ae,type:1,geometry:[],tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Qe=Ue.geometry;if(De==="Point")qe(Ae,Qe,Ue);else if(De==="MultiPoint")for(const He of Ae)qe(He,Qe,Ue);else if(De==="LineString")Ue.type=2,_t(Ae,Qe,Ue);else if(De==="MultiLineString")Ue.type=2,Rt(Ae,Qe,Ue);else if(De==="Polygon")Ue.type=3,Rt(Ae,Qe,Ue,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ue.type=3;for(const He of Ae)Rt(He,Qe,Ue,!0)}return Ue}function qe([rt,ae],de,xe){const De=o.at(rt);let Ae=o.aA(ae);Ae=Ae<0?0:Ae>1?1:Ae,de.push(De,Ae),xe.minX=Math.min(xe.minX,De),xe.minY=Math.min(xe.minY,Ae),xe.maxX=Math.max(xe.maxX,De),xe.maxY=Math.max(xe.maxY,Ae)}function _t(rt,ae,de,xe=!1,De=!1){const Ae=[];for(const Ue of rt)qe(Ue,Ae,de);ae.push(Ae),xe&&function(Ue,Qe){let He=0;for(let it=0,at=Ue.length,ut=at-2;it<at;ut=it,it+=2)He+=(Ue[it]-Ue[ut])*(Ue[it+1]+Ue[ut+1]);if(He>0===Qe)for(let it=0,at=Ue.length;it<at/2;it+=2){const ut=Ue[it],Et=Ue[it+1];Ue[it]=Ue[at-2-it],Ue[it+1]=Ue[at-1-it],Ue[at-2-it]=ut,Ue[at-1-it]=Et}}(Ae,De)}function Rt(rt,ae,de,xe=!1){for(let De=0;De<rt.length;De++)_t(rt[De],ae,de,xe,De===0)}function Wt(rt,ae,de,xe){const{id:De,type:Ae,geometry:Ue,tags:Qe}=rt,He=[];if(Ae===1)(function(it,at,ut,Et,Bt){for(let Vt=0;Vt<it.length;Vt+=2){const gr=Math.round(o.ag*(it[Vt+0]*at-ut)),Mr=Math.round(o.ag*(it[Vt+1]*at-Et));Bt.push([gr,Mr])}})(Ue,ae,de,xe,He);else for(const it of Ue)wt(it,ae,de,xe,He);return{id:De,type:Ae,geometry:He,tags:Qe}}function wt(rt,ae,de,xe,De){const Ae=-Ce,Ue=o.ag+Ce;let Qe;for(let He=0;He<rt.length-2;He+=2){let it=Math.round(o.ag*(rt[He+0]*ae-de)),at=Math.round(o.ag*(rt[He+1]*ae-xe)),ut=Math.round(o.ag*(rt[He+2]*ae-de)),Et=Math.round(o.ag*(rt[He+3]*ae-xe));const Bt=ut-it,Vt=Et-at;it<Ae&&ut<Ae||(it<Ae?(at+=Math.round(Vt*((Ae-it)/Bt)),it=Ae):ut<Ae&&(Et=at+Math.round(Vt*((Ae-it)/Bt)),ut=Ae),at<Ae&&Et<Ae||(at<Ae?(it+=Math.round(Bt*((Ae-at)/Vt)),at=Ae):Et<Ae&&(ut=it+Math.round(Bt*((Ae-at)/Vt)),Et=Ae),it>=Ue&&ut>=Ue||(it>=Ue?(at+=Math.round(Vt*((Ue-it)/Bt)),it=Ue):ut>=Ue&&(Et=at+Math.round(Vt*((Ue-it)/Bt)),ut=Ue),at>=Ue&&Et>=Ue||(at>=Ue?(it+=Math.round(Bt*((Ue-at)/Vt)),at=Ue):Et>=Ue&&(ut=it+Math.round(Bt*((Ue-at)/Vt)),Et=Ue),Qe&&it===Qe[Qe.length-1][0]&&at===Qe[Qe.length-1][1]||(Qe=[[it,at]],De.push(Qe)),Qe.push([ut,Et])))))}}var jt,Ct,st,yt={exports:{}},ir=function(){if(st)return yt.exports;st=1;var rt=o.e7(),ae=function(){if(Ct)return jt;Ct=1;var at=o.e5(),ut=o.e6().VectorTileFeature;function Et(Vt,gr){this.options=gr||{},this.features=Vt,this.length=Vt.length}function Bt(Vt,gr){this.id=typeof Vt.id=="number"?Vt.id:void 0,this.type=Vt.type,this.rawGeometry=Vt.type===1?[Vt.geometry]:Vt.geometry,this.properties=Vt.tags,this.extent=gr||4096}return jt=Et,Et.prototype.feature=function(Vt){return new Bt(this.features[Vt],this.options.extent)},Bt.prototype.loadGeometry=function(){var Vt=this.rawGeometry;this.geometry=[];for(var gr=0;gr<Vt.length;gr++){for(var Mr=Vt[gr],Tr=[],wr=0;wr<Mr.length;wr++)Tr.push(new at(Mr[wr][0],Mr[wr][1]));this.geometry.push(Tr)}return this.geometry},Bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Vt=this.geometry,gr=1/0,Mr=-1/0,Tr=1/0,wr=-1/0,gn=0;gn<Vt.length;gn++)for(var tn=Vt[gn],Nr=0;Nr<tn.length;Nr++){var fn=tn[Nr];gr=Math.min(gr,fn.x),Mr=Math.max(Mr,fn.x),Tr=Math.min(Tr,fn.y),wr=Math.max(wr,fn.y)}return[gr,Tr,Mr,wr]},Bt.prototype.toGeoJSON=ut.prototype.toGeoJSON,jt}();function de(at){var ut=new rt;return function(Et,Bt){for(var Vt in Et.layers)Bt.writeMessage(3,xe,Et.layers[Vt])}(at,ut),ut.finish()}function xe(at,ut){var Et;ut.writeVarintField(15,at.version||1),ut.writeStringField(1,at.name||""),ut.writeVarintField(5,at.extent||4096);var Bt={keys:[],values:[],keycache:{},valuecache:{}};for(Et=0;Et<at.length;Et++)Bt.feature=at.feature(Et),ut.writeMessage(2,De,Bt);var Vt=Bt.keys;for(Et=0;Et<Vt.length;Et++)ut.writeStringField(3,Vt[Et]);var gr=Bt.values;for(Et=0;Et<gr.length;Et++)ut.writeMessage(4,it,gr[Et])}function De(at,ut){var Et=at.feature;Et.id!==void 0&&ut.writeVarintField(1,Et.id),ut.writeMessage(2,Ae,at),ut.writeVarintField(3,Et.type),ut.writeMessage(4,He,Et)}function Ae(at,ut){var Et=at.feature,Bt=at.keys,Vt=at.values,gr=at.keycache,Mr=at.valuecache;for(var Tr in Et.properties){var wr=Et.properties[Tr],gn=gr[Tr];if(wr!==null){gn===void 0&&(Bt.push(Tr),gr[Tr]=gn=Bt.length-1),ut.writeVarint(gn);var tn=typeof wr;tn!=="string"&&tn!=="boolean"&&tn!=="number"&&(wr=JSON.stringify(wr));var Nr=tn+":"+wr,fn=Mr[Nr];fn===void 0&&(Vt.push(wr),Mr[Nr]=fn=Vt.length-1),ut.writeVarint(fn)}}}function Ue(at,ut){return(ut<<3)+(7&at)}function Qe(at){return at<<1^at>>31}function He(at,ut){for(var Et=at.loadGeometry(),Bt=at.type,Vt=0,gr=0,Mr=Et.length,Tr=0;Tr<Mr;Tr++){var wr=Et[Tr],gn=1;Bt===1&&(gn=wr.length),ut.writeVarint(Ue(1,gn));for(var tn=Bt===3?wr.length-1:wr.length,Nr=0;Nr<tn;Nr++){Nr===1&&Bt!==1&&ut.writeVarint(Ue(2,tn-1));var fn=wr[Nr].x-Vt,_n=wr[Nr].y-gr;ut.writeVarint(Qe(fn)),ut.writeVarint(Qe(_n)),Vt+=fn,gr+=_n}Bt===3&&ut.writeVarint(Ue(7,1))}}function it(at,ut){var Et=typeof at;Et==="string"?ut.writeStringField(1,at):Et==="boolean"?ut.writeBooleanField(7,at):Et==="number"&&(at%1!=0?ut.writeDoubleField(3,at):at<0?ut.writeSVarintField(6,at):ut.writeVarintField(5,at))}return yt.exports=de,yt.exports.fromVectorTileJs=de,yt.exports.fromGeojsonVt=function(at,ut){ut=ut||{};var Et={};for(var Bt in at)Et[Bt]=new ae(at[Bt].features,ut),Et[Bt].name=Bt,Et[Bt].version=ut.version,Et[Bt].extent=ut.extent;return de({layers:Et})},yt.exports.GeoJSONWrapper=ae,yt.exports}(),yr=o.e8(ir);const Wr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:rt=>rt},rr=Math.fround||(dn=new Float32Array(1),rt=>(dn[0]=+rt,dn[0]));var dn;const Dn=3,sn=5,cr=6;class Lr{constructor(ae){this.options=Object.assign(Object.create(Wr),ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ae){const{log:de,minZoom:xe,maxZoom:De}=this.options;de&&console.time("total time");const Ae=`prepare ${ae.length} points`;de&&console.time(Ae),this.points=ae;const Ue=[];for(let He=0;He<ae.length;He++){const it=ae[He];if(!it.geometry)continue;const[at,ut]=it.geometry.coordinates,Et=rr(fr(at)),Bt=rr(Yt(ut));Ue.push(Et,Bt,1/0,He,-1,1),this.options.reduce&&Ue.push(0)}let Qe=this.trees[De+1]=this._createTree(Ue);de&&console.timeEnd(Ae);for(let He=De;He>=xe;He--){const it=+Date.now();Qe=this.trees[He]=this._createTree(this._cluster(Qe,He)),de&&console.log("z%d: %d clusters in %dms",He,Qe.numItems,+Date.now()-it)}return de&&console.timeEnd("total time"),this}getClusters(ae,de){let xe=((ae[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,ae[1]));let Ae=ae[2]===180?180:((ae[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,ae[3]));if(ae[2]-ae[0]>=360)xe=-180,Ae=180;else if(xe>Ae){const ut=this.getClusters([xe,De,180,Ue],de),Et=this.getClusters([-180,De,Ae,Ue],de);return ut.concat(Et)}const Qe=this.trees[this._limitZoom(de)],He=Qe.range(fr(xe),Yt(Ue),fr(Ae),Yt(De)),it=Qe.data,at=[];for(const ut of He){const Et=this.stride*ut;at.push(it[Et+sn]>1?cn(it,Et,this.clusterProps):this.points[it[Et+Dn]])}return at}getChildren(ae){const de=this._getOriginId(ae),xe=this._getOriginZoom(ae),De="No cluster with the specified id.",Ae=this.trees[xe];if(!Ae)throw new Error(De);const Ue=Ae.data;if(de*this.stride>=Ue.length)throw new Error(De);const Qe=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),He=Ae.within(Ue[de*this.stride],Ue[de*this.stride+1],Qe),it=[];for(const at of He){const ut=at*this.stride;Ue[ut+4]===ae&&it.push(Ue[ut+sn]>1?cn(Ue,ut,this.clusterProps):this.points[Ue[ut+Dn]])}if(it.length===0)throw new Error(De);return it}getLeaves(ae,de,xe){const De=[];return this._appendLeaves(De,ae,de=de||10,xe=xe||0,0),De}getTile(ae,de,xe){const De=this.trees[this._limitZoom(ae)],Ae=Math.pow(2,ae),{extent:Ue,radius:Qe}=this.options,He=Qe/Ue,it=(xe-He)/Ae,at=(xe+1+He)/Ae,ut={features:[]};return this._addTileFeatures(De.range((de-He)/Ae,it,(de+1+He)/Ae,at),De.data,de,xe,Ae,ut),de===0&&this._addTileFeatures(De.range(1-He/Ae,it,1,at),De.data,Ae,xe,Ae,ut),de===Ae-1&&this._addTileFeatures(De.range(0,it,He/Ae,at),De.data,-1,xe,Ae,ut),ut.features.length?ut:null}getClusterExpansionZoom(ae){let de=this._getOriginZoom(ae)-1;for(;de<=this.options.maxZoom;){const xe=this.getChildren(ae);if(de++,xe.length!==1)break;ae=xe[0].properties.cluster_id}return de}_appendLeaves(ae,de,xe,De,Ae){const Ue=this.getChildren(de);for(const Qe of Ue){const He=Qe.properties;if(He&&He.cluster?Ae+He.point_count<=De?Ae+=He.point_count:Ae=this._appendLeaves(ae,He.cluster_id,xe,De,Ae):Ae<De?Ae++:ae.push(Qe),ae.length===xe)break}return Ae}_createTree(ae){const de=new o.bE(ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<ae.length;xe+=this.stride)de.add(ae[xe],ae[xe+1]);return de.finish(),de.data=ae,de}_addTileFeatures(ae,de,xe,De,Ae,Ue){for(const Qe of ae){const He=Qe*this.stride,it=de[He+sn]>1;let at,ut,Et;if(it)at=Me(de,He,this.clusterProps),ut=de[He],Et=de[He+1];else{const gr=this.points[de[He+Dn]];at=gr.properties;const[Mr,Tr]=gr.geometry.coordinates;ut=fr(Mr),Et=Yt(Tr)}const Bt={type:1,geometry:[[Math.round(this.options.extent*(ut*Ae-xe)),Math.round(this.options.extent*(Et*Ae-De))]],tags:at};let Vt;Vt=it||this.options.generateId?de[He+Dn]:this.points[de[He+Dn]].id,Vt!==void 0&&(Bt.id=Vt),Ue.features.push(Bt)}}_limitZoom(ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+ae),this.options.maxZoom+1))}_cluster(ae,de){const{radius:xe,extent:De,reduce:Ae,minPoints:Ue}=this.options,Qe=xe/(De*Math.pow(2,de)),He=ae.data,it=[],at=this.stride;for(let ut=0;ut<He.length;ut+=at){if(He[ut+2]<=de)continue;He[ut+2]=de;const Et=He[ut],Bt=He[ut+1],Vt=ae.within(He[ut],He[ut+1],Qe),gr=He[ut+sn];let Mr=gr;for(const Tr of Vt){const wr=Tr*at;He[wr+2]>de&&(Mr+=He[wr+sn])}if(Mr>gr&&Mr>=Ue){let Tr,wr=Et*gr,gn=Bt*gr,tn=-1;const Nr=(ut/at<<5)+(de+1)+this.points.length;for(const fn of Vt){const _n=fn*at;if(He[_n+2]<=de)continue;He[_n+2]=de;const vi=He[_n+sn];wr+=He[_n]*vi,gn+=He[_n+1]*vi,He[_n+4]=Nr,Ae&&(Tr||(Tr=this._map(He,ut,!0),tn=this.clusterProps.length,this.clusterProps.push(Tr)),Ae(Tr,this._map(He,_n)))}He[ut+4]=Nr,it.push(wr/Mr,gn/Mr,1/0,Nr,-1,Mr),Ae&&it.push(tn)}else{for(let Tr=0;Tr<at;Tr++)it.push(He[ut+Tr]);if(Mr>1)for(const Tr of Vt){const wr=Tr*at;if(!(He[wr+2]<=de)){He[wr+2]=de;for(let gn=0;gn<at;gn++)it.push(He[wr+gn])}}}}return it}_getOriginId(ae){return ae-this.points.length>>5}_getOriginZoom(ae){return(ae-this.points.length)%32}_map(ae,de,xe){if(ae[de+sn]>1){const Ue=this.clusterProps[ae[de+cr]];return xe?Object.assign({},Ue):Ue}const De=this.points[ae[de+Dn]].properties,Ae=this.options.map(De);return xe&&Ae===De?Object.assign({},Ae):Ae}}function cn(rt,ae,de){return{type:"Feature",id:rt[ae+Dn],properties:Me(rt,ae,de),geometry:{type:"Point",coordinates:[(xe=rt[ae],360*(xe-.5)),tr(rt[ae+1])]}};var xe}function Me(rt,ae,de){const xe=rt[ae+sn],De=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,Ae=rt[ae+cr],Ue=Ae===-1?{}:Object.assign({},de[Ae]);return Object.assign(Ue,{cluster:!0,cluster_id:rt[ae+Dn],point_count:xe,point_count_abbreviated:De})}function fr(rt){return rt/360+.5}function Yt(rt){const ae=Math.sin(rt*Math.PI/180),de=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return de<0?0:de>1?1:de}function tr(rt){const ae=(180-360*rt)*Math.PI/180;return 360*Math.atan(Math.exp(ae))/Math.PI-90}function vt(rt,ae,de,xe){let De=xe;const Ae=ae+(de-ae>>1);let Ue,Qe=de-ae;const He=rt[ae],it=rt[ae+1],at=rt[de],ut=rt[de+1];for(let Et=ae+3;Et<de;Et+=3){const Bt=Mn(rt[Et],rt[Et+1],He,it,at,ut);if(Bt>De)Ue=Et,De=Bt;else if(Bt===De){const Vt=Math.abs(Et-Ae);Vt<Qe&&(Ue=Et,Qe=Vt)}}De>xe&&(Ue-ae>3&&vt(rt,ae,Ue,xe),rt[Ue+2]=De,de-Ue>3&&vt(rt,Ue,de,xe))}function Mn(rt,ae,de,xe,De,Ae){let Ue=De-de,Qe=Ae-xe;if(Ue!==0||Qe!==0){const He=((rt-de)*Ue+(ae-xe)*Qe)/(Ue*Ue+Qe*Qe);He>1?(de=De,xe=Ae):He>0&&(de+=Ue*He,xe+=Qe*He)}return Ue=rt-de,Qe=ae-xe,Ue*Ue+Qe*Qe}function hn(rt,ae,de,xe){const De={id:rt??null,type:ae,geometry:de,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")ei(De,de);else if(ae==="Polygon")ei(De,de[0]);else if(ae==="MultiLineString")for(const Ae of de)ei(De,Ae);else if(ae==="MultiPolygon")for(const Ae of de)ei(De,Ae[0]);return De}function ei(rt,ae){for(let de=0;de<ae.length;de+=3)rt.minX=Math.min(rt.minX,ae[de]),rt.minY=Math.min(rt.minY,ae[de+1]),rt.maxX=Math.max(rt.maxX,ae[de]),rt.maxY=Math.max(rt.maxY,ae[de+1])}function je(rt,ae,de,xe){if(!ae.geometry)return;const De=ae.geometry.coordinates;if(De&&De.length===0)return;const Ae=ae.geometry.type,Ue=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2);let Qe=[],He=ae.id;if(de.promoteId?He=ae.properties[de.promoteId]:de.generateId&&(He=xe||0),Ae==="Point")dt(De,Qe);else if(Ae==="MultiPoint")for(const it of De)dt(it,Qe);else if(Ae==="LineString")St(De,Qe,Ue,!1);else if(Ae==="MultiLineString"){if(de.lineMetrics){for(const it of De)Qe=[],St(it,Qe,Ue,!1),rt.push(hn(He,"LineString",Qe,ae.properties));return}or(De,Qe,Ue,!1)}else if(Ae==="Polygon")or(De,Qe,Ue,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(const it of ae.geometry.geometries)je(rt,{id:He,geometry:it,properties:ae.properties},de,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const it of De){const at=[];or(it,at,Ue,!0),Qe.push(at)}}rt.push(hn(He,Ae,Qe,ae.properties))}function dt(rt,ae){ae.push(Kt(rt[0]),Xt(rt[1]),0)}function St(rt,ae,de,xe){let De,Ae,Ue=0;for(let He=0;He<rt.length;He++){const it=Kt(rt[He][0]),at=Xt(rt[He][1]);ae.push(it,at,0),He>0&&(Ue+=xe?(De*at-it*Ae)/2:Math.sqrt(Math.pow(it-De,2)+Math.pow(at-Ae,2))),De=it,Ae=at}const Qe=ae.length-3;ae[2]=1,vt(ae,0,Qe,de),ae[Qe+2]=1,ae.size=Math.abs(Ue),ae.start=0,ae.end=ae.size}function or(rt,ae,de,xe){for(let De=0;De<rt.length;De++){const Ae=[];St(rt[De],Ae,de,xe),ae.push(Ae)}}function Kt(rt){return rt/360+.5}function Xt(rt){const ae=Math.sin(rt*Math.PI/180),de=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return de<0?0:de>1?1:de}function Ot(rt,ae,de,xe,De,Ae,Ue,Qe){if(xe/=ae,Ae>=(de/=ae)&&Ue<xe)return rt;if(Ue<de||Ae>=xe)return null;const He=[];for(const it of rt){const at=it.geometry;let ut=it.type;const Et=De===0?it.minX:it.minY,Bt=De===0?it.maxX:it.maxY;if(Et>=de&&Bt<xe){He.push(it);continue}if(Bt<de||Et>=xe)continue;let Vt=[];if(ut==="Point"||ut==="MultiPoint")Ur(at,Vt,de,xe,De);else if(ut==="LineString")$n(at,Vt,de,xe,De,!1,Qe.lineMetrics);else if(ut==="MultiLineString")Xn(at,Vt,de,xe,De,!1);else if(ut==="Polygon")Xn(at,Vt,de,xe,De,!0);else if(ut==="MultiPolygon")for(const gr of at){const Mr=[];Xn(gr,Mr,de,xe,De,!0),Mr.length&&Vt.push(Mr)}if(Vt.length){if(Qe.lineMetrics&&ut==="LineString"){for(const gr of Vt)He.push(hn(it.id,ut,gr,it.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(Vt.length===1?(ut="LineString",Vt=Vt[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=Vt.length===3?"Point":"MultiPoint"),He.push(hn(it.id,ut,Vt,it.tags))}}return He.length?He:null}function Ur(rt,ae,de,xe,De){for(let Ae=0;Ae<rt.length;Ae+=3){const Ue=rt[Ae+De];Ue>=de&&Ue<=xe&&Mi(ae,rt[Ae],rt[Ae+1],rt[Ae+2])}}function $n(rt,ae,de,xe,De,Ae,Ue){let Qe=Ln(rt);const He=De===0?Ui:Zi;let it,at,ut=rt.start;for(let Mr=0;Mr<rt.length-3;Mr+=3){const Tr=rt[Mr],wr=rt[Mr+1],gn=rt[Mr+2],tn=rt[Mr+3],Nr=rt[Mr+4],fn=De===0?Tr:wr,_n=De===0?tn:Nr;let vi=!1;Ue&&(it=Math.sqrt(Math.pow(Tr-tn,2)+Math.pow(wr-Nr,2))),fn<de?_n>de&&(at=He(Qe,Tr,wr,tn,Nr,de),Ue&&(Qe.start=ut+it*at)):fn>xe?_n<xe&&(at=He(Qe,Tr,wr,tn,Nr,xe),Ue&&(Qe.start=ut+it*at)):Mi(Qe,Tr,wr,gn),_n<de&&fn>=de&&(at=He(Qe,Tr,wr,tn,Nr,de),vi=!0),_n>xe&&fn<=xe&&(at=He(Qe,Tr,wr,tn,Nr,xe),vi=!0),!Ae&&vi&&(Ue&&(Qe.end=ut+it*at),ae.push(Qe),Qe=Ln(rt)),Ue&&(ut+=it)}let Et=rt.length-3;const Bt=rt[Et],Vt=rt[Et+1],gr=De===0?Bt:Vt;gr>=de&&gr<=xe&&Mi(Qe,Bt,Vt,rt[Et+2]),Et=Qe.length-3,Ae&&Et>=3&&(Qe[Et]!==Qe[0]||Qe[Et+1]!==Qe[1])&&Mi(Qe,Qe[0],Qe[1],Qe[2]),Qe.length&&ae.push(Qe)}function Ln(rt){const ae=[];return ae.size=rt.size,ae.start=rt.start,ae.end=rt.end,ae}function Xn(rt,ae,de,xe,De,Ae){for(const Ue of rt)$n(Ue,ae,de,xe,De,Ae,!1)}function Mi(rt,ae,de,xe){rt.push(ae,de,xe)}function Ui(rt,ae,de,xe,De,Ae){const Ue=(Ae-ae)/(xe-ae);return Mi(rt,Ae,de+(De-de)*Ue,1),Ue}function Zi(rt,ae,de,xe,De,Ae){const Ue=(Ae-de)/(De-de);return Mi(rt,ae+(xe-ae)*Ue,Ae,1),Ue}function Lo(rt,ae){const de=[];for(let xe=0;xe<rt.length;xe++){const De=rt[xe],Ae=De.type;let Ue;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")Ue=Yi(De.geometry,ae);else if(Ae==="MultiLineString"||Ae==="Polygon"){Ue=[];for(const Qe of De.geometry)Ue.push(Yi(Qe,ae))}else if(Ae==="MultiPolygon"){Ue=[];for(const Qe of De.geometry){const He=[];for(const it of Qe)He.push(Yi(it,ae));Ue.push(He)}}de.push(hn(De.id,Ae,Ue,De.tags))}return de}function Yi(rt,ae){const de=[];de.size=rt.size,rt.start!==void 0&&(de.start=rt.start,de.end=rt.end);for(let xe=0;xe<rt.length;xe+=3)de.push(rt[xe]+ae,rt[xe+1],rt[xe+2]);return de}function Oo(rt,ae){if(rt.transformed)return rt;const de=1<<rt.z,xe=rt.x,De=rt.y;for(const Ae of rt.features){const Ue=Ae.geometry,Qe=Ae.type;if(Ae.geometry=[],Qe===1)for(let He=0;He<Ue.length;He+=2)Ae.geometry.push(ss(Ue[He],Ue[He+1],ae,de,xe,De));else for(let He=0;He<Ue.length;He++){const it=[];for(let at=0;at<Ue[He].length;at+=2)it.push(ss(Ue[He][at],Ue[He][at+1],ae,de,xe,De));Ae.geometry.push(it)}}return rt.transformed=!0,rt}function ss(rt,ae,de,xe,De,Ae){return[Math.round(de*(rt*xe-De)),Math.round(de*(ae*xe-Ae))]}function To(rt,ae,de,xe,De){const Ae=ae===De.maxZoom?0:De.tolerance/((1<<ae)*De.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:rt.length,source:null,x:de,y:xe,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Qe of rt)La(Ue,Qe,Ae,De);return Ue}function La(rt,ae,de,xe){const De=ae.geometry,Ae=ae.type,Ue=[];if(rt.minX=Math.min(rt.minX,ae.minX),rt.minY=Math.min(rt.minY,ae.minY),rt.maxX=Math.max(rt.maxX,ae.maxX),rt.maxY=Math.max(rt.maxY,ae.maxY),Ae==="Point"||Ae==="MultiPoint")for(let Qe=0;Qe<De.length;Qe+=3)Ue.push(De[Qe],De[Qe+1]),rt.numPoints++,rt.numSimplified++;else if(Ae==="LineString")Gt(Ue,De,rt,de,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(let Qe=0;Qe<De.length;Qe++)Gt(Ue,De[Qe],rt,de,Ae==="Polygon",Qe===0);else if(Ae==="MultiPolygon")for(let Qe=0;Qe<De.length;Qe++){const He=De[Qe];for(let it=0;it<He.length;it++)Gt(Ue,He[it],rt,de,!0,it===0)}if(Ue.length){let Qe=ae.tags||null;if(Ae==="LineString"&&xe.lineMetrics){Qe={};for(const it in ae.tags)Qe[it]=ae.tags[it];Qe.mapbox_clip_start=De.start/De.size,Qe.mapbox_clip_end=De.end/De.size}const He={geometry:Ue,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:Qe};ae.id!==null&&(He.id=ae.id),rt.features.push(He)}}function Gt(rt,ae,de,xe,De,Ae){const Ue=xe*xe;if(xe>0&&ae.size<(De?Ue:xe))return void(de.numPoints+=ae.length/3);const Qe=[];for(let He=0;He<ae.length;He+=3)(xe===0||ae[He+2]>Ue)&&(de.numSimplified++,Qe.push(ae[He],ae[He+1])),de.numPoints++;De&&function(He,it){let at=0;for(let ut=0,Et=He.length,Bt=Et-2;ut<Et;Bt=ut,ut+=2)at+=(He[ut]-He[Bt])*(He[ut+1]+He[Bt+1]);if(at>0===it)for(let ut=0,Et=He.length;ut<Et/2;ut+=2){const Bt=He[ut],Vt=He[ut+1];He[ut]=He[Et-2-ut],He[ut+1]=He[Et-1-ut],He[Et-2-ut]=Bt,He[Et-1-ut]=Vt}}(Qe,Ae),rt.push(Qe)}const un={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fn{constructor(ae,de){const xe=(de=this.options=function(Ae,Ue){for(const Qe in Ue)Ae[Qe]=Ue[Qe];return Ae}(Object.create(un),de)).debug;if(xe&&console.time("preprocess data"),de.maxZoom<0||de.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(de.promoteId&&de.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=function(Ae,Ue){const Qe=[];if(Ae.type==="FeatureCollection")for(let He=0;He<Ae.features.length;He++)je(Qe,Ae.features[He],Ue,He);else je(Qe,Ae.type==="Feature"?Ae:{geometry:Ae},Ue);return Qe}(ae,de);this.tiles={},this.tileCoords=[],xe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",de.indexMaxZoom,de.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=function(Ae,Ue){const Qe=Ue.buffer/Ue.extent;let He=Ae;const it=Ot(Ae,1,-1-Qe,Qe,0,-1,2,Ue),at=Ot(Ae,1,1-Qe,2+Qe,0,-1,2,Ue);return(it||at)&&(He=Ot(Ae,1,-Qe,1+Qe,0,-1,2,Ue)||[],it&&(He=Lo(it,1).concat(He)),at&&(He=He.concat(Lo(at,-1)))),He}(De,de),De.length&&this.splitTile(De,0,0,0),xe&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ae,de,xe,De,Ae,Ue,Qe){const He=[ae,de,xe,De],it=this.options,at=it.debug;for(;He.length;){De=He.pop(),xe=He.pop(),de=He.pop(),ae=He.pop();const ut=1<<de,Et=nn(de,xe,De);let Bt=this.tiles[Et];if(!Bt&&(at>1&&console.time("creation"),Bt=this.tiles[Et]=To(ae,de,xe,De,it),this.tileCoords.push({z:de,x:xe,y:De}),at)){at>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",de,xe,De,Bt.numFeatures,Bt.numPoints,Bt.numSimplified),console.timeEnd("creation"));const vi=`z${de}`;this.stats[vi]=(this.stats[vi]||0)+1,this.total++}if(Bt.source=ae,Ae==null){if(de===it.indexMaxZoom||Bt.numPoints<=it.indexMaxPoints)continue}else{if(de===it.maxZoom||de===Ae)continue;if(Ae!=null){const vi=Ae-de;if(xe!==Ue>>vi||De!==Qe>>vi)continue}}if(Bt.source=null,ae.length===0)continue;at>1&&console.time("clipping");const Vt=.5*it.buffer/it.extent,gr=.5-Vt,Mr=.5+Vt,Tr=1+Vt;let wr=null,gn=null,tn=null,Nr=null,fn=Ot(ae,ut,xe-Vt,xe+Mr,0,Bt.minX,Bt.maxX,it),_n=Ot(ae,ut,xe+gr,xe+Tr,0,Bt.minX,Bt.maxX,it);ae=null,fn&&(wr=Ot(fn,ut,De-Vt,De+Mr,1,Bt.minY,Bt.maxY,it),gn=Ot(fn,ut,De+gr,De+Tr,1,Bt.minY,Bt.maxY,it),fn=null),_n&&(tn=Ot(_n,ut,De-Vt,De+Mr,1,Bt.minY,Bt.maxY,it),Nr=Ot(_n,ut,De+gr,De+Tr,1,Bt.minY,Bt.maxY,it),_n=null),at>1&&console.timeEnd("clipping"),He.push(wr||[],de+1,2*xe,2*De),He.push(gn||[],de+1,2*xe,2*De+1),He.push(tn||[],de+1,2*xe+1,2*De),He.push(Nr||[],de+1,2*xe+1,2*De+1)}}getTile(ae,de,xe){ae=+ae,de=+de,xe=+xe;const De=this.options,{extent:Ae,debug:Ue}=De;if(ae<0||ae>24)return null;const Qe=1<<ae,He=nn(ae,de=de+Qe&Qe-1,xe);if(this.tiles[He])return Oo(this.tiles[He],Ae);Ue>1&&console.log("drilling down to z%d-%d-%d",ae,de,xe);let it,at=ae,ut=de,Et=xe;for(;!it&&at>0;)at--,ut>>=1,Et>>=1,it=this.tiles[nn(at,ut,Et)];return it&&it.source?(Ue>1&&(console.log("found parent tile z%d-%d-%d",at,ut,Et),console.time("drilling down")),this.splitTile(it.source,at,ut,Et,ae,de,xe),Ue>1&&console.timeEnd("drilling down"),this.tiles[He]?Oo(this.tiles[He],Ae):null):null}}function nn(rt,ae,de){return 32*((1<<rt)*de+ae)+rt}function mn(rt,ae){const de=rt.tileID.canonical;if(!this._geoJSONIndex)return void ae(null,null);const xe=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!xe)return void ae(null,null);const De=new Ie(xe.features);let Ae=yr(De);Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),ae(null,{vectorTile:De,rawData:Ae.buffer})}class Vi extends oe{constructor(ae,de,xe,De,Ae,Ue){super(ae,de,xe,De,mn,Ue),Ae&&(this.loadGeoJSON=Ae),this._dynamicIndex=new Ze}loadData(ae,de){const xe=ae&&ae.request,De=xe&&xe.collectResourceTiming;this.loadGeoJSON(ae,(Ae,Ue)=>{if(Ae||!Ue)return de(Ae);if(typeof Ue!="object")return de(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));{try{if(ae.filter){const He=o.U(ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(He.result==="error")throw new Error(He.value.map(it=>`${it.key}: ${it.message}`).join(", "));Ue.features=Ue.features.filter(it=>He.value.evaluate({zoom:0},it))}ae.dynamic?(Ue.type==="Feature"&&(Ue={type:"FeatureCollection",features:[Ue]}),ae.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ue.features,this.loaded),ae.cluster&&(Ue.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ae.cluster?new Lr(function({superclusterOptions:He,clusterProperties:it}){if(!it||!He)return He;const at={},ut={},Et={accumulated:null,zoom:0},Bt={properties:null},Vt=Object.keys(it);for(const gr of Vt){const[Mr,Tr]=it[gr],wr=o.U(Tr),gn=o.U(typeof Mr=="string"?[Mr,["accumulated"],["get",gr]]:Mr);at[gr]=wr.value,ut[gr]=gn.value}return He.map=gr=>{Bt.properties=gr;const Mr={};for(const Tr of Vt)Mr[Tr]=at[Tr].evaluate(Et,Bt);return Mr},He.reduce=(gr,Mr)=>{Bt.properties=Mr;for(const Tr of Vt)Et.accumulated=gr[Tr],gr[Tr]=ut[Tr].evaluate(Et,Bt)},He}(ae)).load(Ue.features):ae.dynamic?this._dynamicIndex:function(He,it){return new Fn(He,it)}(Ue,ae.geojsonVtOptions)}catch(He){return de(He)}const Qe={};if(De){const He=k(xe);He&&(Qe.resourceTiming={},Qe.resourceTiming[ae.source]=JSON.parse(JSON.stringify(He)))}de(null,Qe)}})}reloadTile(ae,de){const xe=this.loaded;return xe&&xe[ae.uid]?ae.partial?de(null,void 0):super.reloadTile(ae,de):this.loadTile(ae,de)}loadGeoJSON(ae,de){if(ae.request)o.n(ae.request,de);else{if(typeof ae.data!="string")return de(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));try{return de(null,JSON.parse(ae.data))}catch{return de(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ae,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(xe){de(xe)}}getClusterChildren(ae,de){try{de(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(xe){de(xe)}}getClusterLeaves(ae,de){try{de(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(xe){de(xe)}}}class fi{constructor(ae,de){this.tileID=new o.aG(ae.tileID.overscaledZ,ae.tileID.wrap,ae.tileID.canonical.z,ae.tileID.canonical.x,ae.tileID.canonical.y),this.tileZoom=ae.tileZoom,this.uid=ae.uid,this.zoom=ae.zoom,this.canonical=ae.tileID.canonical,this.pixelRatio=ae.pixelRatio,this.tileSize=ae.tileSize,this.source=ae.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ae.projection,this.brightness=de}parse(ae,de,xe,De){this.status="parsing";const Ae=new o.aG(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),Ue=[],Qe=de.familiesBySource[xe.source],He=new o.dZ(Ae,xe.promoteId);return He.bucketLayerIDs=[],He.is3DTile=!0,o.e9(ae).then(it=>{if(!it)return De(new Error("Could not parse tile"));const at=o.ea(it,1/o.cc(xe.tileID.canonical)),ut=it.json.extensionsUsed&&it.json.extensionsUsed.includes("MAPBOX_mesh_features")||it.json.asset.extras&&it.json.asset.extras.MAPBOX_mesh_features,Et=it.json.extensionsUsed&&it.json.extensionsUsed.includes("EXT_meshopt_compression"),Bt=new o.a8(this.zoom,{brightness:this.brightness});for(const Vt in Qe)for(const gr of Qe[Vt]){const Mr=gr[0];He.bucketLayerIDs.push(gr.map(wr=>o.aC(wr.id,wr.scope))),Mr.recalculate(Bt,[]);const Tr=new o.eb(gr,at,Ae,ut,Et,this.brightness,He);ut||(Tr.needsUpload=!0),Ue.push(Tr),Tr.evaluate(Mr)}this.status="done",De(null,{buckets:Ue,featureIndex:He,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(it=>De(new Error(it.message)))}}class Pi{constructor(ae,de,xe,De,Ae,Ue){this.actor=ae,this.layerIndex=de,this.availableImages=xe,this.brightness=Ue,this.loading={},this.loaded={}}loadTile(ae,de){const xe=ae.uid,De=this.loading[xe]=new fi(ae,this.brightness);o.bi(ae.request,(Ae,Ue)=>{const Qe=!this.loading[xe];return delete this.loading[xe],Qe||Ae?(De.status="done",Qe||(this.loaded[xe]=De),de(Ae)):Ue&&Ue.byteLength!==0?void De.parse(Ue,this.layerIndex,ae,(He,it)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[xe]=De,He||!it?de(He):de(null,it)}):(De.status="done",this.loaded[xe]=De,de())})}reloadTile(ae,de){const xe=this.loaded,De=ae.uid;if(xe&&xe[De]){const Ae=xe[De];Ae.projection=ae.projection,Ae.brightness=ae.brightness;const Ue=(Qe,He)=>{Ae.reloadCallback&&(delete Ae.reloadCallback,this.loadTile(ae,de)),de(Qe,He)};Ae.status==="parsing"?Ae.reloadCallback=Ue:Ae.status==="done"&&this.loadTile(ae,de)}}abortTile(ae,de){const xe=ae.uid;this.loading[xe]&&delete this.loading[xe],de()}removeTile(ae,de){const xe=this.loaded,De=ae.uid;xe&&xe[De]&&delete xe[De],de()}}class co{constructor(ae){this.self=ae,this.actor=new o.ec(ae,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new o.I,this.projections={},this.defaultProjection=o.bP({name:"mercator"}),this.workerSourceTypes={vector:oe,geojson:Vi,"batched-model":Pi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(de,xe)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=xe},this.self.registerRTLTextPlugin=de=>{if(o.ed.isParsed())throw new Error("RTL text plugin already registered.");o.ed.applyArabicShaping=de.applyArabicShaping,o.ed.processBidirectionalText=de.processBidirectionalText,o.ed.processStyledBidirectionalText=de.processStyledBidirectionalText}}clearCaches(ae,de,xe){delete this.layerIndexes[ae],delete this.availableImages[ae],delete this.workerSources[ae],delete this.demWorkerSources[ae],delete this.rasterArrayWorkerSource,xe()}checkIfReady(ae,de,xe){xe()}setReferrer(ae,de){this.referrer=de}spriteLoaded(ae,{scope:de,isLoaded:xe}){if(this.isSpriteLoaded[ae]||(this.isSpriteLoaded[ae]={}),this.isSpriteLoaded[ae][de]=xe,this.workerSources[ae]&&this.workerSources[ae][de])for(const De in this.workerSources[ae][de]){const Ae=this.workerSources[ae][de][De];for(const Ue in Ae){const Qe=Ae[Ue];Qe instanceof oe&&(Qe.isSpriteLoaded=xe,Qe.fire(new o.z("isSpriteLoaded")))}}}setImages(ae,{scope:de,images:xe},De){if(this.availableImages[ae]||(this.availableImages[ae]={}),this.availableImages[ae][de]=xe,this.workerSources[ae]&&this.workerSources[ae][de]){for(const Ae in this.workerSources[ae][de]){const Ue=this.workerSources[ae][de][Ae];for(const Qe in Ue)Ue[Qe].availableImages=xe}De()}else De()}setProjection(ae,de){this.projections[ae]=o.bP(de)}setBrightness(ae,de,xe){this.brightness=de,xe()}setLayers(ae,de,xe){this.getLayerIndex(ae,de.scope).replace(de.layers,de.options),xe()}updateLayers(ae,de,xe){this.getLayerIndex(ae,de.scope).update(de.layers,de.removedIds,de.options),xe()}loadTile(ae,de,xe){de.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,de.type,de.source,de.scope).loadTile(de,xe)}loadDEMTile(ae,de,xe){this.getDEMWorkerSource(ae,de.source,de.scope).loadTile(de,xe)}decodeRasterArray(ae,de,xe){this.getRasterArrayWorkerSource().decodeRasterArray(de,xe)}reloadTile(ae,de,xe){de.projection=this.projections[ae]||this.defaultProjection,this.getWorkerSource(ae,de.type,de.source,de.scope).reloadTile(de,xe)}abortTile(ae,de,xe){this.getWorkerSource(ae,de.type,de.source,de.scope).abortTile(de,xe)}removeTile(ae,de,xe){this.getWorkerSource(ae,de.type,de.source,de.scope).removeTile(de,xe)}removeSource(ae,de,xe){if(!(this.workerSources[ae]&&this.workerSources[ae][de.scope]&&this.workerSources[ae][de.scope][de.type]&&this.workerSources[ae][de.scope][de.type][de.source]))return;const De=this.workerSources[ae][de.scope][de.type][de.source];delete this.workerSources[ae][de.scope][de.type][de.source],De.removeSource!==void 0?De.removeSource(de,xe):xe()}loadWorkerSource(ae,de,xe){try{this.self.importScripts(de.url),xe()}catch(De){xe(De.toString())}}syncRTLPluginState(ae,de,xe){try{o.ed.setState(de);const De=o.ed.getPluginURL();if(o.ed.isLoaded()&&!o.ed.isParsed()&&De!=null){this.self.importScripts(De);const Ae=o.ed.isParsed();xe(Ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Ae)}}catch(De){xe(De.toString())}}setDracoUrl(ae,de){this.dracoUrl=de}getAvailableImages(ae,de){this.availableImages[ae]||(this.availableImages[ae]={});let xe=this.availableImages[ae][de];return xe||(xe=[]),xe}getLayerIndex(ae,de){this.layerIndexes[ae]||(this.layerIndexes[ae]={});let xe=this.layerIndexes[ae][de];return xe||(xe=this.layerIndexes[ae][de]=new F,xe.scope=de),xe}getWorkerSource(ae,de,xe,De){return this.workerSources[ae]||(this.workerSources[ae]={}),this.workerSources[ae][De]||(this.workerSources[ae][De]={}),this.workerSources[ae][De][de]||(this.workerSources[ae][De][de]={}),this.isSpriteLoaded[ae]||(this.isSpriteLoaded[ae]={}),this.workerSources[ae][De][de][xe]||(this.workerSources[ae][De][de][xe]=new this.workerSourceTypes[de]({send:(Ae,Ue,Qe,He,it,at)=>{this.actor.send(Ae,Ue,Qe,ae,it,at)},scheduler:this.actor.scheduler},this.getLayerIndex(ae,De),this.getAvailableImages(ae,De),this.isSpriteLoaded[ae][De],void 0,this.brightness)),this.workerSources[ae][De][de][xe]}rasterizeImages(ae,de,xe){const{imageTasks:De,scope:Ae}=de,Ue={};for(const Qe in De){const{image:He,imageIdWithOptions:it}=De[Qe];Ue[Qe]=this.imageRasterizer.rasterize(it,He,Ae,ae)}xe(void 0,Ue)}removeRasterizedImages(ae,de,xe){const{imageIds:De,scope:Ae}=de;this.imageRasterizer.removeImagesFromCacheByIds(De,Ae,ae),xe()}getDEMWorkerSource(ae,de,xe){return this.demWorkerSources[ae]||(this.demWorkerSources[ae]={}),this.demWorkerSources[ae][xe]||(this.demWorkerSources[ae][xe]={}),this.demWorkerSources[ae][xe][de]||(this.demWorkerSources[ae][xe][de]=new X),this.demWorkerSources[ae][xe][de]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Q),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ae,de){o.ee(de)}getWorkerPerformanceMetrics(ae,de,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new co(self)),co}),_(["./shared"],function(o){var k="3.9.1";const O={create:"create",load:"load",fullLoad:"fullLoad"},z={mark(f){performance.mark(f)},measure(f,n,l){performance.measure(f,n,l)}};function F(f){const n=f.name.split("?")[0];return o.a(n)&&n.includes("mapbox-gl.js")?"javascript":o.a(n)&&n.includes("mapbox-gl.css")?"css":o.b(n)?"fontRange":o.c(n)?"sprite":o.i(n)?"style":o.d(n)?"tilejson":"other"}var G,ee={},J=function(){if(G)return ee;function f(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,A=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(A);try{S=new Worker(D),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(D),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var A=S.getImageData(0,0,1,1);return A&&A.width===v.width}()?(l[y=p&&p.failIfMajorPerformanceCaveat]===void 0&&(l[y]=function(v){var S,A=function(D){var N=document.createElement("canvas"),j=Object.create(f.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=D,N.getContext("webgl2",j)}(v);if(!A)return!1;try{S=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!S||A.isContextLost())&&(A.shaderSource(S,"void main() {}"),A.compileShader(S),A.getShaderParameter(S,A.COMPILE_STATUS)===!0)}(y)),l[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}G=1,ee.supported=f,ee.notSupportedReason=n;var l={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ee}();function te(f,n,l){const p=document.createElement(f);return n!=null&&(p.className=n),l&&l.appendChild(p),p}function oe(f,n,l){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(n))p.setAttributeNS(null,y,String(n[y]));return l&&l.appendChild(p),p}const X=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Q=X&&X.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ue;function he(){X&&Q&&(ue=X[Q],X[Q]="none")}function Ie(){X&&Q&&(X[Q]=ue)}function Je(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Je,!0)}function Ce(){window.addEventListener("click",Je,!0),window.setTimeout(()=>{window.removeEventListener("click",Je,!0)},0)}function Ze(f,n){const l=f.getBoundingClientRect();return qe(f,l,n)}function et(f,n){const l=f.getBoundingClientRect(),p=[];for(let y=0;y<n.length;y++)p.push(qe(f,l,n[y]));return p}function Ge(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function qe(f,n,l){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new o.P((l.clientX-n.left)*p,(l.clientY-n.top)*p)}const _t="01",Rt="NO_ACCESS_TOKEN";class Wt{constructor(n,l,p){this._transformRequestFn=n,this._customAccessToken=l,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=function(){let l="";for(let p=0;p<10;p++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",_t,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,l){return this._transformRequestFn&&this._transformRequestFn(n,l)||{url:n}}normalizeStyleURL(n,l){if(!o.f(n))return n;const p=jt(n);return p.params.push(`sdk=js-${k}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeGlyphsURL(n,l){if(!o.f(n))return n;const p=jt(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeModelURL(n,l){if(!o.f(n))return n;const p=jt(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeSourceURL(n,l,p,y){if(!o.f(n))return n;const v=jt(n);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),p&&v.params.push(`language=${p}`),y&&v.params.push(`worldview=${y}`),this._makeAPIURL(v,this._customAccessToken||l)}normalizeIconsetURL(n,l){const p=jt(n);return o.f(n)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||l)):Ct(p)}normalizeSpriteURL(n,l,p,y){const v=jt(n);return o.f(n)?(v.path=`/styles/v1${v.path}/sprite${l}${p}`,this._makeAPIURL(v,this._customAccessToken||y)):(v.path+=`${l}${p}`,Ct(v))}normalizeTileURL(n,l,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!o.f(n))return n;const y=jt(n);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||p&&y.authority!=="raster"&&p===512?"@2x":""}${o.m.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${o.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${o.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${o.e.TILE_URL_VERSION}${y.path}`);const v=this._customAccessToken||function(S){for(const A of S){const D=A.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(y.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,v)}canonicalizeTileURL(n,l){const p=jt(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let v=p.params;return l&&(v=v.filter(S=>!S.match(/^access_token=/))),v.length&&(y+=`?${v.join("&")}`),y}canonicalizeTileset(n,l){const p=!!l&&o.f(l),y=[];for(const v of n.tiles||[])o.h(v)?y.push(this.canonicalizeTileURL(v,p)):y.push(v);return y}_makeAPIURL(n,l){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=jt(o.e.API_URL);if(n.protocol=y.protocol,n.authority=y.authority,n.protocol==="http"){const v=n.params.indexOf("secure");v>=0&&n.params.splice(v,1)}if(y.path!=="/"&&(n.path=`${y.path}${n.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Ct(n);if(l=l||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(v=>v.indexOf("access_token")===-1),n.params.push(`access_token=${l||""}`),Ct(n)}}const wt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function jt(f){const n=f.match(wt);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Ct(f){const n=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${n}`}const st="mapbox.eventData";function yt(f){if(!f)return null;const n=f.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(o.j(n[1]))}catch{return null}}class ir{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const l=yt(o.e.ACCESS_TOKEN);let p="";return p=l&&l.u?o.k(l.u):o.e.ACCESS_TOKEN||"",n?`${st}.${n}:${p}`:`${st}:${p}`}fetchEventData(){const n=o.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid");if(n)try{const y=localStorage.getItem(l);y&&(this.eventData=JSON.parse(y));const v=localStorage.getItem(p);v&&(this.anonId=v)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const n=o.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.anonId;if(n&&y)try{localStorage.setItem(p,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,l,p,y){if(!o.e.EVENTS_URL)return;const v=jt(o.e.EVENTS_URL);v.params.push(`access_token=${y||o.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(n).toISOString()},A=l?o.l(S,l):S,D={url:Ct(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=o.p(D,N=>{this.pendingRequest=null,p(N),this.saveEventData(),this.processRequests(y)})}queueRequest(n,l){this.queue.push(n),this.processRequests(l)}}const yr=new class extends ir{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,n){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(l=>o.f(l)||o.h(l))&&this.queueRequest(Date.now(),n)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=yt(o.e.ACCESS_TOKEN),l=n?n.u:o.e.ACCESS_TOKEN;let p=l!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),p=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),S=new Date(y),A=(y-this.eventData.lastSuccess)/864e5;p=p||A>=1||A<-1||v.getDate()!==S.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:_t,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=y,this.eventData.tokenU=l)},f):this.processRequests()}},Wr=yr.postTurnstileEvent.bind(yr),rr=new class extends ir{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,n,l,p){this.skuToken=n,this.errorCb=p,o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(Rt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:_t,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f))}remove(){this.errorCb=null}},dn=rr.postMapLoadEvent.bind(rr),Dn=new class extends ir{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let n=this.mapInstanceIdMap.get(f);return n||(n=o.u(),this.mapInstanceIdMap.set(f,n)),n}getEventId(f){const n=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,n+1),n}postStyleLoadEvent(f,n){const{map:l,style:p,importedStyles:y}=n;if(!o.e.EVENTS_URL||!f&&!o.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(l),S={mapInstanceId:v,eventId:this.getEventId(v),style:p};y.length&&(S.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:S},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:l}=this.queue.shift();this.postEvent(n,l,()=>{},f)}},sn=Dn.postStyleLoadEvent.bind(Dn),cr=new class extends ir{constructor(){super("gljs.performance")}postPerformanceEvent(f,n){o.e.EVENTS_URL&&(f||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:l}=this.queue.shift(),p=function(y){const v=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),A=function(q){const ie={};if(q){for(const ne in q)if(ne!=="other")for(const le of q[ne]){const ce=`${ne}ResolveRangeMin`,fe=`${ne}ResolveRangeMax`,ve=`${ne}RequestCount`,_e=`${ne}RequestCachedCount`;ie[ce]=Math.min(ie[ce]||1/0,le.startTime),ie[fe]=Math.max(ie[fe]||-1/0,le.responseEnd);const Te=we=>{ie[we]===void 0&&(ie[we]=0),++ie[we]};le.transferSize!==void 0&&le.transferSize===0&&Te(_e),Te(ve)}}return ie}(function(q,ie){const ne={};if(q)for(const le of q){const ce=ie(le);ne[ce]===void 0&&(ne[ce]=[]),ne[ce].push(le)}return ne}(v,F)),D=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=N?N.effectiveType:void 0,$={counters:[],metadata:[],attributes:[]},V=(q,ie,ne)=>{ne!=null&&q.push({name:ie,value:ne.toString()})};for(const q in A)V($.counters,q,A[q]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(V($.counters,"interactionRangeMin",y.interactionRange[0]),V($.counters,"interactionRangeMax",y.interactionRange[1])),S)for(const q of Object.keys(O)){const ie=O[q],ne=S.find(le=>le.name===ie);ne&&V($.counters,ie,ne.startTime)}return V($.counters,"visibilityHidden",y.visibilityHidden),V($.attributes,"style",function(q){if(q)for(const ie of q){const ne=ie.name.split("?")[0];if(o.i(ne)){const le=ne.split("/").slice(-2);if(le.length===2)return`mapbox://styles/${le[0]}/${le[1]}`}}}(v)),V($.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),V($.attributes,"fogEnabled",y.fogEnabled?"true":"false"),V($.attributes,"projection",y.projection),V($.attributes,"zoom",y.zoom),V($.metadata,"devicePixelRatio",D),V($.metadata,"connectionEffectiveType",j),V($.metadata,"navigatorUserAgent",navigator.userAgent),V($.metadata,"screenWidth",window.screen.width),V($.metadata,"screenHeight",window.screen.height),V($.metadata,"windowWidth",window.innerWidth),V($.metadata,"windowHeight",window.innerHeight),V($.metadata,"mapWidth",y.width/D),V($.metadata,"mapHeight",y.height/D),V($.metadata,"webglRenderer",y.renderer),V($.metadata,"webglVendor",y.vendor),V($.metadata,"sdkVersion",k),V($.metadata,"sdkIdentifier","mapbox-gl-js"),$}(l);for(const y of p.metadata);for(const y of p.counters);for(const y of p.attributes);this.postEvent(n,p,()=>{},f)}},Lr=cr.postPerformanceEvent.bind(cr),cn=new class extends ir{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,n,l,p){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const y=jt(o.e.API_URL+o.e.SESSION_PATH);y.params.push(`sku=${n||""}`),y.params.push(`access_token=${p||o.e.ACCESS_TOKEN||""}`);const v={url:Ct(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(v,S=>{this.pendingRequest=null,l(S),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,n,l,p){this.skuToken=n,this.errorCb=p,o.e.SESSION_PATH&&o.e.API_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(Rt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||this.getSession(l,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f)}remove(){this.errorCb=null}},Me=cn.getSessionAPI.bind(cn),fr=new Set;function Yt(f,n){n?fr.add(f):fr.delete(f)}class tr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,l){this._updatedSourceCaches[n]=l,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const l=n.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(n.id),this.setDirty()}removeLayer(n){const l=n.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][n.id]=n,this._updatedLayers[l].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const l in this._updatedLayers)n[l]=n[l]||{},n[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)n[l]=n[l]||{},n[l].removedIds=Object.keys(this._removedLayers[l]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function vt(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class Mn extends o.E{constructor(n){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=n,n!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.I),this._imageRasterizer}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new o.r({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,l){if(this.loaded[l]!==n&&(this.loaded[l]=n,n)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,l,y);this.requestors=[]}}hasImage(n,l){return!!this.getImage(n,l)}getImage(n,l){return this.images[l][n]}addImage(n,l,p){this._validate(n,p)&&(this.images[l][n]=p)}_validate(n,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.y(new Error(`Image "${n}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.y(new Error(`Image "${n}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new o.y(new Error(`Image "${n}" has invalid "content" value`))),p=!1),p}_validateStretch(n,l){if(!n)return!0;let p=0;for(const y of n){if(y[0]<p||y[1]<y[0]||l<y[1])return!1;p=y[1]}return!0}_validateContent(n,l){return n?n.length!==4||!l.usvg&&(n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,l,p){p.version=this.images[l][n].version+1,this.images[l][n]=p,this.updatedImages[l][n]=!0,this.removeFromImageRasterizerCache(n,l)}removeFromImageRasterizerCache(n,l){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([n],l))}removeImage(n,l){const p=this.images[l][n];delete this.images[l][n],delete this.patterns[l][n],this.removeFromImageRasterizerCache(n,l),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,l,p){let y=!0;const v=!!this.loaded[l];if(!v)for(const S of n)this.images[l][S]||(y=!1);v||y?this._notify(n,l,p):this.requestors.push({ids:n,scope:l,callback:p})}rasterizeImages({scope:n,imageTasks:l},p){const y={};for(const v in l){const S=l[v],A=this.getImage(S.id,n);A&&(y[v]={image:A,imageIdWithOptions:S})}o.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:y,scope:n},p):this.rasterizeImagesInMainThread({imageTasks:y,scope:n},p)}rasterizeImagesInMainThread(n,l){const{imageTasks:p,scope:y}=n,v={};for(const S in p){const{image:A,imageIdWithOptions:D}=p[S];v[S]=this.imageRasterizer.rasterize(D,A,y,"")}l(void 0,v)}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,l,p){const y={};for(const v of n){this.images[l][v]||this.fire(new o.z("styleimagemissing",{id:v}));const S=this.images[l][v];S?y[v]={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:o.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,y)}getPixelSize(n){const{width:l,height:p}=this.atlasImage[n];return{width:l,height:p}}getPattern(n,l,p){const y=this.patterns[l][n],v=this.getImage(n,l);if(!v)return null;if(y&&y.position.version===v.version)return y.position;if(y)y.position.version=v.version;else{v.usvg&&!v.data&&(v.data=this.imageRasterizer.rasterize(o.A.from(n).getPrimary(),v,l,""));const S={w:v.data.width+2*o.B,h:v.data.height+2*o.B,x:0,y:0},A=new o.F(S,v,o.B);this.patterns[l][n]={bin:S,position:A}}return this._updatePatternAtlas(l,p),this.patterns[l][n].position}bind(n,l){const p=n.gl;let y=this.atlasTexture[l];y?this.dirty&&(y.update(this.atlasImage[l]),this.dirty=!1):(y=new o.T(n,this.atlasImage[l],p.RGBA8),this.atlasTexture[l]=y),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,l){const p=[];for(const A in this.patterns[n])p.push(this.patterns[n][A].bin);const{w:y,h:v}=o.C(p),S=this.atlasImage[n];S.resize({width:y||1,height:v||1});for(const A in this.patterns[n]){const{bin:D,position:N}=this.patterns[n][A];let j=N.padding;const $=D.x+j,V=D.y+j,q=this.images[n][A].data,ie=q.width,ne=q.height;j=j>1?j-1:j,o.r.copy(q,S,{x:0,y:0},{x:$,y:V},{width:ie,height:ne},l),o.r.copy(q,S,{x:0,y:ne-j},{x:$,y:V-j},{width:ie,height:j},l),o.r.copy(q,S,{x:0,y:0},{x:$,y:V+ne},{width:ie,height:j},l),o.r.copy(q,S,{x:ie-j,y:0},{x:$-j,y:V},{width:j,height:ne},l),o.r.copy(q,S,{x:0,y:0},{x:$+ie,y:V},{width:j,height:ne},l),o.r.copy(q,S,{x:ie-j,y:ne-j},{x:$-j,y:V-j},{width:j,height:j},l),o.r.copy(q,S,{x:0,y:ne-j},{x:$+ie,y:V-j},{width:j,height:j},l),o.r.copy(q,S,{x:0,y:0},{x:$+ie,y:V+ne},{width:j,height:j},l),o.r.copy(q,S,{x:ie-j,y:0},{x:$-j,y:V+ne},{width:j,height:j},l)}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,l){for(const p of n){if(this.callbackDispatchedThisFrame[l][p])continue;this.callbackDispatchedThisFrame[l][p]=!0;const y=this.images[l][p];vt(y)&&this.updateImage(p,l,y)}}}function hn(f){const n=f.key,l=f.value,p=f.valueSpec||{},y=f.objectElementValidators||{},v=f.style,S=f.styleSpec;let A=[];const D=o.H(l);if(D!=="object")return[new o.V(n,l,`object expected, ${D} found`)];for(const N in l){const j=N.split(".")[0];let $;y[j]?$=y[j]:p[j]?$=Gt:y["*"]?$=y["*"]:p["*"]&&($=Gt),$?A=A.concat($({key:(n&&`${n}.`)+N,value:l[N],valueSpec:p[j]||p["*"],style:v,styleSpec:S,object:l,objectKey:N},l)):A.push(new o.G(n,l[N],`unknown property "${N}"`))}for(const N in p)y[N]||p[N].required&&p[N].default===void 0&&l[N]===void 0&&A.push(new o.V(n,l,`missing required property "${N}"`));return A}function ei(f){const n=f.value,l=f.valueSpec,p=f.style,y=f.styleSpec,v=f.key,S=f.arrayElementValidator||Gt;if(o.H(n)!=="array")return[new o.V(v,n,`array expected, ${o.H(n)} found`)];if(l.length&&n.length!==l.length)return[new o.V(v,n,`array length ${l.length} expected, length ${n.length} found`)];if(l["min-length"]&&n.length<l["min-length"])return[new o.V(v,n,`array length at least ${l["min-length"]} expected, length ${n.length} found`)];let A={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};y.$version<7&&(A.function=l.function),o.H(l.value)==="object"&&(A=l.value);let D=[];for(let N=0;N<n.length;N++)D=D.concat(S({array:n,arrayIndex:N,value:n[N],valueSpec:A,style:p,styleSpec:y,key:`${v}[${N}]`},!0));return D}function je(f){const n=f.key,l=f.value,p=f.valueSpec;let y=o.H(l);if(y==="number"&&l!=l&&(y="NaN"),y!=="number")return[new o.V(n,l,`number expected, ${y} found`)];if("minimum"in p){let v=p.minimum;if(o.H(p.minimum)==="array"&&(v=p.minimum[f.arrayIndex]),l<v)return[new o.V(n,l,`${l} is less than the minimum value ${v}`)]}if("maximum"in p){let v=p.maximum;if(o.H(p.maximum)==="array"&&(v=p.maximum[f.arrayIndex]),l>v)return[new o.V(n,l,`${l} is greater than the maximum value ${v}`)]}return[]}function dt(f){const n=f.valueSpec,l=o.K(f.value.type);let p,y,v,S={};const A=l!=="categorical"&&f.value.property===void 0,D=!A,N=o.H(f.value.stops)==="array"&&o.H(f.value.stops[0])==="array"&&o.H(f.value.stops[0][0])==="object",j=hn({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(q){if(l==="identity")return[new o.V(q.key,q.value,'identity function may not have a "stops" property')];let ie=[];const ne=q.value;return ie=ie.concat(ei({key:q.key,value:ne,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:$})),o.H(ne)==="array"&&ne.length===0&&ie.push(new o.V(q.key,ne,"array must have at least one stop")),ie},default:function(q){return Gt({key:q.key,value:q.value,valueSpec:n,style:q.style,styleSpec:q.styleSpec})}}});return l==="identity"&&A&&j.push(new o.V(f.key,f.value,'missing required property "property"')),l==="identity"||f.value.stops||j.push(new o.V(f.key,f.value,'missing required property "stops"')),l==="exponential"&&f.valueSpec.expression&&!o.L(f.valueSpec)&&j.push(new o.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(D&&!o.M(f.valueSpec)?j.push(new o.V(f.key,f.value,"property functions not supported")):A&&!o.N(f.valueSpec)&&j.push(new o.V(f.key,f.value,"zoom functions not supported"))),l!=="categorical"&&!N||f.value.property!==void 0||j.push(new o.V(f.key,f.value,'"property" property is required')),j;function $(q){let ie=[];const ne=q.value,le=q.key;if(o.H(ne)!=="array")return[new o.V(le,ne,`array expected, ${o.H(ne)} found`)];if(ne.length!==2)return[new o.V(le,ne,`array length 2 expected, length ${ne.length} found`)];if(N){if(o.H(ne[0])!=="object")return[new o.V(le,ne,`object expected, ${o.H(ne[0])} found`)];if(ne[0].zoom===void 0)return[new o.V(le,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new o.V(le,ne,"object stop key must have value")];const ce=o.K(ne[0].zoom);if(typeof ce!="number")return[new o.V(le,ne[0].zoom,"stop zoom values must be numbers")];if(v&&v>ce)return[new o.V(le,ne[0].zoom,"stop zoom values must appear in ascending order")];ce!==v&&(v=ce,y=void 0,S={}),ie=ie.concat(hn({key:`${le}[0]`,value:ne[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:je,value:V}}))}else ie=ie.concat(V({key:`${le}[0]`,value:ne[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},ne));return o.O(o.Q(ne[1]))?ie.concat([new o.V(`${le}[1]`,ne[1],"expressions are not allowed in function stops.")]):ie.concat(Gt({key:`${le}[1]`,value:ne[1],valueSpec:n,style:q.style,styleSpec:q.styleSpec}))}function V(q,ie){const ne=o.H(q.value),le=o.K(q.value),ce=q.value!==null?q.value:ie;if(p){if(ne!==p)return[new o.V(q.key,ce,`${ne} stop domain type must match previous stop domain type ${p}`)]}else p=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean"&&typeof le!="number"&&typeof le!="string"&&typeof le!="boolean")return[new o.V(q.key,ce,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&l!=="categorical"){let fe=`number expected, ${ne} found`;return o.M(n)&&l===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(q.key,ce,fe)]}return l!=="categorical"||ne!=="number"||typeof le=="number"&&isFinite(le)&&Math.floor(le)===le?l!=="categorical"&&ne==="number"&&typeof le=="number"&&typeof y=="number"&&y!==void 0&&le<y?[new o.V(q.key,ce,"stop domain values must appear in ascending order")]:(y=le,l==="categorical"&&le in S?[new o.V(q.key,ce,"stop domain values must be unique")]:(S[le]=!0,[])):[new o.V(q.key,ce,`integer expected, found ${String(le)}`)]}}function St(f){const n=(f.expressionContext==="property"?o.S:o.U)(o.Q(f.value),f.valueSpec);if(n.result==="error")return n.value.map(p=>new o.V(`${f.key}${p.key}`,f.value,p.message));const l=n.value.expression||n.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!l.outputDefined())return[new o.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!o.W(l))return[new o.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return or(l,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!o.X(l,["zoom","feature-state"]))return[new o.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!o.Y(l))return[new o.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function or(f,n){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const y of n.valueSpec.expression.parameters)l.delete(y);if(l.size===0)return[];const p=[];return f instanceof o.Z&&l.has(f.name)?[new o.V(n.key,n.value,`["${f.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(f.eachChild(y=>{p.push(...or(y,n))}),p)}function Kt(f){const n=f.key,l=f.value,p=f.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(o.K(l))===-1&&y.push(new o.V(n,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(o.K(l))===-1&&y.push(new o.V(n,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),y}function Xt(f){return o.$(o.Q(f.value))?St(o.J({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Ot(f)}function Ot(f){const n=f.value,l=f.key;if(o.H(n)!=="array")return[new o.V(l,n,`array expected, ${o.H(n)} found`)];const p=f.styleSpec;let y,v=[];if(n.length<1)return[new o.V(l,n,"filter array must have at least 1 element")];switch(v=v.concat(Kt({key:`${l}[0]`,value:n[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),o.K(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&o.K(n[1])==="$type"&&v.push(new o.V(l,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&v.push(new o.V(l,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(y=o.H(n[1]),y!=="string"&&v.push(new o.V(`${l}[1]`,n[1],`string expected, ${y} found`)));for(let S=2;S<n.length;S++)y=o.H(n[S]),o.K(n[1])==="$type"?v=v.concat(Kt({key:`${l}[${S}]`,value:n[S],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&v.push(new o.V(`${l}[${S}]`,n[S],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let S=1;S<n.length;S++)v=v.concat(Ot({key:`${l}[${S}]`,value:n[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":y=o.H(n[1]),n.length!==2?v.push(new o.V(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):y!=="string"&&v.push(new o.V(`${l}[1]`,n[1],`string expected, ${y} found`))}return v}function Ur(f,n){const l=f.key,p=f.style,y=f.layer,v=f.styleSpec,S=f.value,A=f.objectKey,D=v[`${n}_${f.layerType}`];if(!D)return[];const N=A.match(/^(.*)-use-theme$/);if(n==="paint"&&N&&D[N[1]])return Gt({key:l,value:S,valueSpec:{type:"string"},style:p,styleSpec:v});const j=A.match(/^(.*)-transition$/);if(n==="paint"&&j&&D[j[1]]&&D[j[1]].transition)return Gt({key:l,value:S,valueSpec:v.transition,style:p,styleSpec:v});const $=f.valueSpec||D[A];if(!$)return[new o.G(l,S,`unknown property "${A}"`)];let V;if(o.H(S)==="string"&&o.M($)&&!$.tokens&&(V=/^{([^}]+)}$/.exec(S))){const ie=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new o.V(l,S,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${ie}.`)]}const q=[];if(f.layerType==="symbol")A!=="text-field"||!p||p.glyphs||p.imports||q.push(new o.V(l,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&o.a0(o.Q(S))&&o.K(S.type)==="identity"&&q.push(new o.V(l,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&n==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&o.M($)&&(o.a1($)||o.N($))){const ie=o.S(o.Q(S),$),ne=ie.value.expression||ie.value._styleExpression.expression;ne&&!o.X(ne,["measure-light"])&&(A==="model-emissive-strength"&&o.Y(ne)&&o.W(ne)||q.push(new o.V(l,S,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Gt({key:f.key,value:S,valueSpec:$,style:p,styleSpec:v,expressionContext:"property",propertyType:n,propertyKey:A}))}function $n(f){return Ur(f,"paint")}function Ln(f){return Ur(f,"layout")}function Xn(f){let n=[];const l=f.value,p=f.key,y=f.style,v=f.styleSpec;l.type||l.ref||n.push(new o.V(p,l,'either "type" or "ref" is required'));let S=o.K(l.type);const A=o.K(l.ref);if(l.id){const D=o.K(l.id);for(let N=0;N<f.arrayIndex;N++){const j=y.layers[N];o.K(j.id)===D&&n.push(new o.V(p,l.id,`duplicate layer id "${l.id}", previously used at line ${j.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(N=>{N in l&&n.push(new o.V(p,l[N],`"${N}" is prohibited for ref layers`))}),y.layers.forEach(N=>{o.K(N.id)===A&&(D=N)}),D?D.ref?n.push(new o.V(p,l.ref,"ref cannot reference another ref layer")):S=o.K(D.type):typeof A=="string"&&n.push(new o.V(p,l.ref,`ref layer "${A}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(l.source){const D=y.sources&&y.sources[l.source],N=D&&o.K(D.type);D?N==="vector"&&S==="raster"?n.push(new o.V(p,l.source,`layer "${l.id}" requires a raster source`)):N==="raster"&&S!=="raster"?n.push(new o.V(p,l.source,`layer "${l.id}" requires a vector source`)):N!=="vector"||l["source-layer"]?N==="raster-dem"&&S!=="hillshade"?n.push(new o.V(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||N==="geojson"&&D.lineMetrics?S==="raster-particle"&&N!=="raster-array"&&n.push(new o.V(p,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):n.push(new o.V(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new o.V(p,l.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new o.V(p,l,`layer "${l.id}" must specify a "source-layer"`)):n.push(new o.V(p,l.source,`source "${l.source}" not found`))}else n.push(new o.V(p,l,'missing required property "source"'));return n=n.concat(hn({key:p,value:l,valueSpec:v.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gt({key:`${p}.type`,value:l.type,valueSpec:v.layer.type,style:f.style,styleSpec:f.styleSpec,object:l,objectKey:"type"}),filter:D=>Xt(o.J({layerType:S},D)),layout:D=>hn({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":N=>Ln(o.J({layerType:S},N))}}),paint:D=>hn({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":N=>$n(o.J({layerType:S,layer:l},N))}})}})),n}function Mi(f){const n=f.value,l=f.key,p=o.H(n);return p!=="string"?[new o.V(l,n,`string expected, ${p} found`)]:[]}const Ui={promoteId:function({key:f,value:n}){if(o.H(n)==="string")return Mi({key:f,value:n});{const l=[];for(const p in n)l.push(...Mi({key:`${f}.${p}`,value:n[p]}));return l}}};function Zi(f){const n=f.value,l=f.key,p=f.styleSpec,y=f.style;if(!n.type)return[new o.V(l,n,'"type" is required')];const v=o.K(n.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(n.url||n.tiles||S.push(new o.G(l,n,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(hn({key:l,value:n,valueSpec:p[`source_${v.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Ui})),S;case"geojson":if(S=hn({key:l,value:n,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Ui}),n.cluster)for(const A in n.clusterProperties){const[D,N]=n.clusterProperties[A],j=typeof D=="string"?[D,["accumulated"],["get",A]]:D;S.push(...St({key:`${l}.${A}.map`,value:N,expressionContext:"cluster-map"})),S.push(...St({key:`${l}.${A}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return S;case"video":return hn({key:l,value:n,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return hn({key:l,value:n,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new o.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kt({key:`${l}.type`,value:n.type,valueSpec:{values:Lo(p)},style:y,styleSpec:p})}}function Lo(f){return f.source.reduce((n,l)=>{const p=f[l];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values))),n},[])}function Yi(f){const n=f.value,l=f.styleSpec,p=l.light,y=f.style;let v=[];const S=o.H(n);if(n===void 0)return v;if(S!=="object")return v=v.concat([new o.V("light",n,`object expected, ${S} found`)]),v;for(const A in n){const D=A.match(/^(.*)-transition$/),N=A.match(/^(.*)-use-theme$/);v=v.concat(N&&p[N[1]]?Gt({key:A,value:n[A],valueSpec:{type:"string"},style:y,styleSpec:l}):D&&p[D[1]]&&p[D[1]].transition?Gt({key:A,value:n[A],valueSpec:l.transition,style:y,styleSpec:l}):p[A]?Gt({key:A,value:n[A],valueSpec:p[A],style:y,styleSpec:l}):[new o.V(A,n[A],`unknown property "${A}"`)])}return v}function Oo(f){const n=f.value;let l=[];if(!n)return l;const p=o.H(n);if(p!=="object")return l=l.concat([new o.V("light-3d",n,`object expected, ${p} found`)]),l;const y=f.styleSpec,v=y["light-3d"],S=f.key,A=f.style,D=f.style.lights;for(const $ of["type","id"])if(!($ in n))return l=l.concat([new o.V("light-3d",n,`missing property ${$} on light`)]),l;if(n.type&&D)for(let $=0;$<f.arrayIndex;$++){const V=o.K(n.type),q=D[$];o.K(q.type)===V&&l.push(new o.V(S,n.id,`duplicate light type "${n.type}", previously defined at line ${q.id.__line__}`))}const N=`properties_light_${n.type}`;if(!(N in y))return l=l.concat([new o.V("light-3d",n,`Invalid light type ${n.type}`)]),l;const j=y[N];for(const $ in n)if($==="properties"){const V=n[$],q=o.H(V);if(q!=="object")return l=l.concat([new o.V("properties",V,`object expected, ${q} found`)]),l;for(const ie in V)l=l.concat(j[ie]?Gt({key:ie,value:V[ie],valueSpec:j[ie],style:A,styleSpec:y}):[new o.G(f.key,V[ie],`unknown property "${ie}"`)])}else{const V=$.match(/^(.*)-transition$/),q=$.match(/^(.*)-use-theme$/);l=l.concat(q&&v[q[1]]?Gt({key:$,value:n[$],valueSpec:{type:"string"},style:A,styleSpec:y}):V&&v[V[1]]&&v[V[1]].transition?Gt({key:$,value:n[$],valueSpec:y.transition,style:A,styleSpec:y}):v[$]?Gt({key:$,value:n[$],valueSpec:v[$],style:A,styleSpec:y}):[new o.G($,n[$],`unknown property "${$}"`)])}return l}function ss(f){const n=f.value,l=f.key,p=f.style,y=f.styleSpec,v=y.terrain;let S=[];const A=o.H(n);if(n===void 0||A==="null")return S;if(A!=="object")return S=S.concat([new o.V("terrain",n,`object expected, ${A} found`)]),S;for(const D in n){const N=D.match(/^(.*)-transition$/),j=D.match(/^(.*)-use-theme$/);S=S.concat(j&&v[j[1]]?Gt({key:D,value:n[D],valueSpec:{type:"string"},style:p,styleSpec:y}):N&&v[N[1]]&&v[N[1]].transition?Gt({key:D,value:n[D],valueSpec:y.transition,style:p,styleSpec:y}):v[D]?Gt({key:D,value:n[D],valueSpec:v[D],style:p,styleSpec:y}):[new o.G(D,n[D],`unknown property "${D}"`)])}if(n.source){const D=p.sources&&p.sources[n.source],N=D&&o.K(D.type);D?N!=="raster-dem"&&S.push(new o.V(l,n.source,`terrain cannot be used with a source of type ${String(N)}, it only be used with a "raster-dem" source type`)):S.push(new o.V(l,n.source,`source "${n.source}" not found`))}else S.push(new o.V(l,n,'terrain is missing required property "source"'));return S}function To(f){const n=f.value,l=f.style,p=f.styleSpec,y=p.fog;let v=[];const S=o.H(n);if(n===void 0)return v;if(S!=="object")return v=v.concat([new o.V("fog",n,`object expected, ${S} found`)]),v;for(const A in n){const D=A.match(/^(.*)-transition$/),N=A.match(/^(.*)-use-theme$/);v=v.concat(N&&y[N[1]]?Gt({key:A,value:n[A],valueSpec:{type:"string"},style:l,styleSpec:p}):D&&y[D[1]]&&y[D[1]].transition?Gt({key:A,value:n[A],valueSpec:p.transition,style:l,styleSpec:p}):y[A]?Gt({key:A,value:n[A],valueSpec:y[A],style:l,styleSpec:p}):[new o.G(A,n[A],`unknown property "${A}"`)])}return v}const La={"*":()=>[],array:ei,boolean:function(f){const n=f.value,l=f.key,p=o.H(n);return p!=="boolean"?[new o.V(l,n,`boolean expected, ${p} found`)]:[]},number:je,color:function(f){const n=f.key,l=f.value,p=o.H(l);return p!=="string"?[new o.V(n,l,`color expected, ${p} found`)]:o._.parseCSSColor(l)===null?[new o.V(n,l,`color expected, "${l}" found`)]:[]},enum:Kt,filter:Xt,function:dt,layer:Xn,object:hn,source:Zi,model:o.a2,light:Yi,"light-3d":Oo,terrain:ss,fog:To,string:Mi,formatted:function(f){return Mi(f).length===0?[]:St(f)},resolvedImage:function(f){return Mi(f).length===0?[]:St(f)},projection:function(f){const n=f.value,l=f.styleSpec,p=l.projection,y=f.style;let v=[];const S=o.H(n);if(S==="object")for(const A in n)v=v.concat(Gt({key:A,value:n[A],valueSpec:p[A],style:y,styleSpec:l}));else S!=="string"&&(v=v.concat([new o.V("projection",n,`object or string expected, ${S} found`)]));return v},import:function(f){const{value:n,styleSpec:l}=f,{data:p,...y}=n;Object.defineProperty(y,"__line__",{value:n.__line__,enumerable:!1});let v=hn(o.J({},f,{value:y,valueSpec:l.import}));return o.K(y.id)===""&&v.push(new o.V(`${f.key}.id`,y,"import id can't be an empty string")),p&&(v=v.concat(Fn(p,l,{key:`${f.key}.data`}))),v}};function Gt(f,n=!1){const l=f.value,p=f.valueSpec,y=f.styleSpec;if(p.expression&&o.a0(o.K(l)))return dt(f);if(p.expression&&o.O(o.Q(l)))return St(f);if(p.type&&La[p.type]){const v=La[p.type](f);return n===!0&&v.length>0&&o.H(f.value)==="array"?St(f):v}return hn(o.J({},f,{valueSpec:p.type?y[p.type]:p}))}function un(f){const n=f.value,l=f.key,p=Mi(f);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new o.V(l,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new o.V(l,n,'"glyphs" url must include a "{range}" token'))),p}function Fn(f,n=o.a3,l={}){return Gt({key:l.key||"",value:f,valueSpec:n.$root,styleSpec:n,style:f,objectElementValidators:{glyphs:un,"*":()=>[]}})}function nn(f,n=o.a3){return Qe(Fn(f,n))}const mn=f=>Qe(Zi(f)),Vi=f=>Qe(Yi(f)),fi=f=>Qe(Oo(f)),Pi=f=>Qe(ss(f)),co=f=>Qe(To(f)),rt=f=>Qe(function(n){const l=n.value,p=n.style,y=n.styleSpec,v=y.snow;let S=[];const A=o.H(l);if(l===void 0)return S;if(A!=="object")return S=S.concat([new o.V("snow",l,`object expected, ${A} found`)]),S;for(const D in l){const N=D.match(/^(.*)-transition$/);S=S.concat(N&&v[N[1]]&&v[N[1]].transition?Gt({key:D,value:l[D],valueSpec:y.transition,style:p,styleSpec:y}):v[D]?Gt({key:D,value:l[D],valueSpec:v[D],style:p,styleSpec:y}):[new o.G(D,l[D],`unknown property "${D}"`)])}return S}(f)),ae=f=>Qe(function(n){const l=n.value,p=n.style,y=n.styleSpec,v=y.rain;let S=[];const A=o.H(l);if(l===void 0)return S;if(A!=="object")return S=S.concat([new o.V("rain",l,`object expected, ${A} found`)]),S;for(const D in l){const N=D.match(/^(.*)-transition$/);S=S.concat(N&&v[N[1]]&&v[N[1]].transition?Gt({key:D,value:l[D],valueSpec:y.transition,style:p,styleSpec:y}):v[D]?Gt({key:D,value:l[D],valueSpec:v[D],style:p,styleSpec:y}):[new o.G(D,l[D],`unknown property "${D}"`)])}return S}(f)),de=f=>Qe(Xn(f)),xe=f=>Qe(Xt(f)),De=f=>Qe($n(f)),Ae=f=>Qe(Ln(f)),Ue=f=>Qe(o.a2(f));function Qe(f){return f.slice().sort((n,l)=>n.line&&l.line?n.line-l.line:0)}function He(f,n){let l=!1;if(n&&n.length)for(const p of n)p instanceof o.G?o.w(p.message):(f.fire(new o.y(new Error(p.message))),l=!0);return l}let it;class at extends o.E{constructor(n,l="flat"){super(),this._transitionable=new o.a4(it||(it=new o.a5({anchor:new o.a6(o.a3.light.anchor),position:new o.a7(o.a3.light.position),color:new o.a6(o.a3.light.color),intensity:new o.a6(o.a3.light.intensity)}))),this.setLight(n,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l,p={}){this._validate(Vi,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=l)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,p){return(!p||p.validate!==!1)&&He(this,n.call(nn,o.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a3})))}}let ut=class extends o.E{constructor(f,n,l,p){super(),this.scope=l,this._transitionable=new o.a4(new o.a5({source:new o.a6(o.a3.terrain.source),exaggeration:new o.a6(o.a3.terrain.exaggeration)}),l,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(f,n){this._transitionable.setTransitionOrValue(f,n)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new o.a8(f)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const n=f.value.expression;if(!n)return null;let l=-1,p=-1,y=1;for(const v of n.zoomStops)y=n.evaluate(new o.a8(v)),y>.01?(l=v,p=-1):p=v;return y<.01&&l>0&&p>l?[l,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof o.a9}};const Et=45,Bt=65,Vt=.05;function gr(f,n,l,p){const y=o.ac(Et,Bt,l),[v,S]=Mr(f,p);let A=1-Math.min(1,Math.exp((n-v)/(S-v)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*y*f.alpha}function Mr(f,n){const l=.5/Math.tan(.5*n);return[f.range[0]+l,f.range[1]+l]}function Tr(f,n,l,p,y){const v=o.ab.vec3.transformMat4([],[n,l,p],y.mercatorFogMatrix);return gr(f,o.ab.vec3.length(v),y.pitch,y._fov)}function wr(f,n,l,p,y,v,S){const A=[[l,p,0],[y,p,0],[y,v,0],[l,v,0]];let D=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const j of A){const $=o.ab.vec3.transformMat4([],j,n),V=o.ab.vec3.length($);D=Math.min(D,V),N=Math.max(N,V)}return[gr(f,D,S.pitch,S._fov),gr(f,N,S.pitch,S._fov)]}class gn extends o.E{constructor(n,l,p,y){super();const v=new o.a5({range:new o.a6(o.a3.fog.range),color:new o.a6(o.a3.fog.color),"color-use-theme":new o.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a6(o.a3.fog["high-color"]),"high-color-use-theme":new o.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a6(o.a3.fog["space-color"]),"space-color-use-theme":new o.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a6(o.a3.fog["horizon-blend"]),"star-intensity":new o.a6(o.a3.fog["star-intensity"]),"vertical-range":new o.a6(o.a3.fog["vertical-range"])});this._transitionable=new o.a4(v,p,new Map(y)),this.set(n,y),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new o.ad(v),this.scope=p}get state(){const n=this._transform,l=n.projection.name==="globe",p=o.ae(n.zoom),y=this.properties.get("range"),v=[.5,3];return{range:l?[o.af(v[0],y[0],p),o.af(v[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l,p={}){if(this._validate(co,n,p))return;const y=o.l({},n);for(const v of Object.keys(o.a3.fog))y[v]===void 0&&(y[v]=o.a3.fog[v].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ac(Et,Bt,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(p,y,v){const S=o.aa.fromLngLat(y),A=v.elevation?v.elevation.getAtPointOrZero(S):0;return Tr(p,S.x,S.y,A,v)}(this.state,n,l):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(n.toUnwrapped());return wr(this.state,l,0,0,o.ag,o.ag,this._transform)}getOpacityForBounds(n,l,p,y,v){return this._transform.projection.supportsFog?wr(this.state,n,l,p,y,v,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Mr(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const p of l){const y=n.points[p];let v;if(y[2]>=0)v=y;else{const S=n.points[p-4];v=o.ah(S,y,S[2]/(S[2]-y[2]))}if(Tr(this.state,v[0],v[1],0,this._transform)>=Vt)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,p){return(!p||p.validate!==!1)&&He(this,n.call(nn,o.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a3})))}}let tn,Nr,fn,_n,vi=class extends o.E{constructor(f,n,l,p){super();const y=tn||(tn=new o.a5({density:new o.a6(o.a3.snow.density),intensity:new o.a6(o.a3.snow.intensity),color:new o.a6(o.a3.snow.color),opacity:new o.a6(o.a3.snow.opacity),vignette:new o.a6(o.a3.snow.vignette),"vignette-color":new o.a6(o.a3.snow["vignette-color"]),"center-thinning":new o.a6(o.a3.snow["center-thinning"]),direction:new o.a6(o.a3.snow.direction),"flake-size":new o.a6(o.a3.snow["flake-size"])}));this._transitionable=new o.a4(y,l,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ad(y),this.scope=l}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),l=this.properties.get("direction"),p=o.ai(l[0]),y=-Math.max(o.ai(l[1]),.01),v=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette"),A=this.properties.get("vignette-color");return A.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.aj(n.r,n.g,n.b,n.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(f,n,l={}){if(this._validate(rt,f,l))return;const p=o.l({},f);for(const y of Object.keys(o.a3.snow))p[y]===void 0&&(p[y]=o.a3.snow[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,l){return(!l||l.validate!==!1)&&He(this,f.call(nn,o.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a3})))}},Eo=class extends o.E{constructor(f,n,l,p){super();const y=Nr||(Nr=new o.a5({density:new o.a6(o.a3.rain.density),intensity:new o.a6(o.a3.rain.intensity),color:new o.a6(o.a3.rain.color),opacity:new o.a6(o.a3.rain.opacity),vignette:new o.a6(o.a3.rain.vignette),"vignette-color":new o.a6(o.a3.rain["vignette-color"]),"center-thinning":new o.a6(o.a3.rain["center-thinning"]),direction:new o.a6(o.a3.rain.direction),"droplet-size":new o.a6(o.a3.rain["droplet-size"]),"distortion-strength":new o.a6(o.a3.rain["distortion-strength"])}));this._transitionable=new o.a4(y,l,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ad(y),this.scope=l}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),l=this.properties.get("direction"),p=o.ai(l[0]),y=-Math.max(o.ai(l[1]),.01),v=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.aj(n.r,n.g,n.b,n.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(f,n,l={}){if(this._validate(ae,f,l))return;const p=o.l({},f);for(const y of Object.keys(o.a3.rain))p[y]===void 0&&(p[y]=o.a3.rain[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,l){return(!l||l.validate!==!1)&&He(this,f.call(nn,o.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a3})))}};class $i extends o.E{constructor(n,l,p,y){super(),this.scope=p,this._options=n,this.properties=new o.ad(l),this._transitionable=new o.a4(l,p,new Map(y)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,l){this._options=n,this._transitionable.setTransitionOrValue(n.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Xi{constructor(n,l,p,y){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(n,l){let p,y;if(n instanceof o.P||typeof n[0]=="number"){const v=o.P.convert(n);p=[v],y=l.isPointAboveHorizon(v)}else{const v=o.P.convert(n[0]),S=o.P.convert(n[1]);p=[v,S],y=o.al(v,S).every(A=>l.isPointAboveHorizon(A))}return new Xi(p,l.getCameraPoint(),y,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.al(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(y[3]=this.cameraPoint)),o.am(y,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.al(l,p,n),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>p.y))+((v.x>l.x)+(v.x>p.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(n,l,p,y=0){const v=n.queryPadding/l._pixelsPerMercatorPixel+1,S=p?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l);let A=n.tileID.wrap+(S.unwrapped?y:0);const D=S.polygon.map(le=>o.an(n.tileTransform,le,A));if(!o.ao(D,0,0,o.ag,o.ag))return;A=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const N=this.screenGeometryMercator.polygon.map(le=>o.ap(n.tileTransform,le,A)),j=N.map(le=>new o.P(le[0],le[1])),$=l.getFreeCameraOptions().position||new o.aa(0,0,0),V=o.ap(n.tileTransform,$,A),q=N.map(le=>{const ce=o.ab.vec3.sub(le,le,V);return o.ab.vec3.normalize(ce,ce),new o.aq(V,ce)}),ie=o.ar(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:q,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(ne=o.as(D),ne.min.x=o.aw(ne.min.x,0,o.ag),ne.min.y=o.aw(ne.min.y,0,o.ag),ne.max.x=o.aw(ne.max.x,0,o.ag),ne.max.y=o.aw(ne.max.y,0,o.ag),ne),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:ie};var ne}_bufferedScreenMercator(n,l){const p=Og(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(n,l){const p=Og(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(n,l){const p=function(v,S){const A=o.ab.mat4.multiply([],S.pixelMatrix,S.globeMatrix),D=[0,-o.ax,0,1],N=[0,o.ax,0,1],j=[0,0,0,1];o.ab.vec4.transformMat4(D,D,A),o.ab.vec4.transformMat4(N,N,A),o.ab.vec4.transformMat4(j,j,A);const $=new o.P(D[0]/D[3],D[1]/D[3]),V=new o.P(N[0]/N[3],N[1]/N[3]),q=o.au(v,$)&&D[3]<j[3],ie=o.au(v,V)&&N[3]<j[3];if(!q&&!ie)return null;const ne=function(Se,be,ke){for(let ze=1;ze<Se.length;ze++){const tt=ma(be.pointCoordinate3D(Se[ze-1]).x),Xe=ma(be.pointCoordinate3D(Se[ze]).x);if(ke<0){if(tt<Xe)return{idx:ze,t:-tt/(Xe-1-tt)}}else if(Xe<tt)return{idx:ze,t:(1-tt)/(Xe+1-tt)}}return null}(v,S,q?-1:1);if(!ne)return null;const{idx:le,t:ce}=ne;let fe=le>1?cc(v.slice(0,le),S):[],ve=le<v.length?cc(v.slice(le),S):[];fe=fe.map(Se=>new o.P(ma(Se.x),Se.y)),ve=ve.map(Se=>new o.P(ma(Se.x),Se.y));const _e=[...fe];_e.length===0&&_e.push(ve[ve.length-1]);const Te=o.af(_e[_e.length-1].y,(ve.length===0?fe[0]:ve[0]).y,ce);let we;return we=q?[new o.P(0,Te),new o.P(0,0),new o.P(1,0),new o.P(1,Te)]:[new o.P(1,Te),new o.P(1,1),new o.P(0,1),new o.P(0,Te)],_e.push(...we),ve.length===0?_e.push(fe[0]):_e.push(...ve),{polygon:_e.map(Se=>new o.aa(Se.x,Se.y)),unwrapped:!1}}(n,l);if(p)return p;const y=function(v,S){let A=!1,D=-1/0,N=0;for(let $=0;$<v.length-1;$++)v[$].x>D&&(D=v[$].x,N=$);for(let $=0;$<v.length-1;$++){const V=(N+$)%(v.length-1),q=v[V],ie=v[V+1];Math.abs(q.x-ie.x)>.5&&(q.x<ie.x?(q.x+=1,V===0&&(v[v.length-1].x+=1)):(ie.x+=1,V+1===v.length-1&&(v[0].x+=1)),A=!0)}const j=o.at(S.center.lng);return A&&j<Math.abs(j-1)&&v.forEach($=>{$.x-=1}),{polygon:v,unwrapped:A}}(cc(n,l).map(v=>new o.P(ma(v.x),v.y)),l);return{polygon:y.polygon.map(v=>new o.aa(v.x,v.y)),unwrapped:y.unwrapped}}}function cc(f,n){return o.av(f,l=>{const p=n.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ma(f){return f<0?1+f%1:f%1}function Og(f){return 100*f|0}function Lf(f,n,l,p,y){const v=function(A,D){if(A)return y(A);if(D){if(f.url&&D.tiles&&f.tiles&&delete f.tiles,D.variants){if(!Array.isArray(D.variants))return y(new Error("variants must be an array"));for(const j of D.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return y(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){D=o.l(D,j);break}}}const N=o.ay(o.l({},D,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=n.canonicalizeTileset(N,f.url),y(null,N)}},S=function(A,D,N){if(!A)return null;if(!D&&!N)return A;N=N||A.worldview_default;const j=Object.values(A.language||{});if(j.length===0)return null;const $=Object.values(A.worldview||{});if($.length===0)return null;const V=j.every(ie=>ie===D),q=$.every(ie=>ie===N);return V&&q?A:D in(A.language_options||{})||N in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null}(f.data,l,p);return S?o.q.frame(()=>v(null,S)):f.url?o.n(n.transformRequest(n.normalizeSourceURL(f.url,null,l,p),o.R.Source),v):o.q.frame(()=>{const{data:A,...D}=f;v(null,D)})}class uc{constructor(n,l,p){this.bounds=o.az.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),p=Math.floor(o.at(this.bounds.getWest())*l),y=Math.floor(o.aA(this.bounds.getNorth())*l),v=Math.ceil(o.at(this.bounds.getEast())*l),S=Math.ceil(o.aA(this.bounds.getSouth())*l);return n.x>=p&&n.x<v&&n.y>=y&&n.y<S}}class Of extends o.E{constructor(n,l,p,y){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.l(this,o.ay(l,["url","scheme","tileSize","promoteId"])),this._options=o.l({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new o.aB}load(n){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Lf(this._options,this.map._requestManager,l,p,(y,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new o.y(y));else if(v){if(o.l(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of v.vector_layers)this.vectorLayerIds.push(S.id),v.worldview&&v.worldview[S.source]&&this.localizableLayerIds.add(S.id)}v.bounds&&(this.tileBounds=new uc(v.bounds,this.minzoom,this.maxzoom)),Wr(v.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(y)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}loadTile(n,l){const p=n.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),v=this.map._requestManager.transformRequest(y,o.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,A=S?{image:S.image.clone()}:null,D={request:v,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:A,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&o.f(p)&&(D.worldview=this.map.getWorldview()||this.worldviewDefault,D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=l:n.request=n.actor.send("reloadTile",D,N.bind(this));else if(n.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",D,N.bind(this),void 0,!0);else{const j=o.aD.call({deduped:this._deduped},D,($,V)=>{$||!V?N.call(this,$):(D.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},n.actor&&n.actor.send("loadTile",D,N.bind(this),void 0,!0))},!0);n.request={cancel:j}}function N(j,$){return delete n.request,n.aborted?l(null):j&&j.status!==404?l(j):($&&$.resourceTiming&&(n.resourceTiming=$.resourceTiming),this.map._refreshExpiredTiles&&$&&n.setExpiryData($),n.loadVectorData($,this.map.painter),o.aE(this.dispatcher),l(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class cu extends o.E{constructor(n,l,p,y){super(),this.id=n,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.l({type:"raster"},l),o.l(this,o.ay(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Lf(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new o.y(l)):p&&(o.l(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),p.bounds&&(this.tileBounds=new uc(p.bounds,this.minzoom,this.maxzoom)),Wr(p.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(l)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const p=o.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=o.o(this.map._requestManager.transformRequest(y,o.R.Tile),(v,S,A,D)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):v?(n.state="errored",l(v)):S?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:D}),n.setTexture(S,this.map.painter),n.state="loaded",o.aE(this.dispatcher),void l(null)):l(null)))}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l&&l()}unloadTile(n,l){n.texture&&n.texture instanceof o.T?(n.destroy(!0),n.texture&&n.texture instanceof o.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Oa extends cu{constructor(n,l,p,y){super(n,l,p,y),this.type="raster-array",this.maxzoom=22,this._options=o.l({type:"raster-array"},l)}triggerRepaint(n){const l=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);l&&l.enabled&&p&&l._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,l){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,o.R.Tile);n.requestParams=y,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(v,S,A,D)=>{if(delete n.request,n.aborted)return n.state="unloaded",l(null);if(v)return v.code===20?void 0:(n.state="errored",l(v));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:D}),n.state="empty",l(null)})}unloadTile(n,l){const p=n.texture;p&&p instanceof o.T?(n.destroy(!0),this.map.painter.saveTileTexture(p)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,l,p){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(l,p,(y,v)=>{if(y)return n.state="errored",this.fire(new o.y(y)),void this.triggerRepaint(n);v&&(n.setTexture(v,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:v})=>v===n),p=l&&l.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(n,l,p){if(!n)return;const y=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let v=null;l instanceof o.aH?v=l.paint.get("raster-array-band"):l instanceof o.aI&&(v=l.paint.get("raster-particle-array-band"));const S=v||this.getInitialBand(y);if(S!=null)if(n.textureDescriptor){if(!n.updateNeeded(y,S)||p)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,y,S)}}const dc={vector:Of,raster:cu,"raster-dem":class extends cu{constructor(f,n,l,p){super(f,n,l,p),this.type="raster-dem",this.maxzoom=22,this._options=o.l({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,v){y&&(f.state="errored",n(y)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=o.o(this.map._requestManager.transformRequest(l,o.R.Tile),(function(y,v,S,A){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(y)f.state="errored",n(y);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:A});const D=ImageBitmap&&v instanceof ImageBitmap&&o.t(),N=1-(v.width-o.aF(v.width))/2;N<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const j=D?v:o.q.getImageData(v,N),$={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:N};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",$,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const n=f.canonical,l=Math.pow(2,n.z),p=(n.x-1+l)%l,y=n.x===0?f.wrap-1:f.wrap,v=(n.x+1+l)%l,S=n.x+1===l?f.wrap+1:f.wrap,A={};return A[new o.aG(f.overscaledZ,y,n.z,p,n.y).key]={backfilled:!1},A[new o.aG(f.overscaledZ,S,n.z,v,n.y).key]={backfilled:!1},n.y>0&&(A[new o.aG(f.overscaledZ,y,n.z,p,n.y-1).key]={backfilled:!1},A[new o.aG(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},A[new o.aG(f.overscaledZ,S,n.z,v,n.y-1).key]={backfilled:!1}),n.y+1<l&&(A[new o.aG(f.overscaledZ,y,n.z,p,n.y+1).key]={backfilled:!1},A[new o.aG(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},A[new o.aG(f.overscaledZ,S,n.z,v,n.y+1).key]={backfilled:!1}),A}},"raster-array":Oa,geojson:class extends o.E{constructor(f,n,l,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=n.data,this._options=o.l({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=o.ag/this.tileSize;this.workerOptions=o.l({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:o.ag,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.ag,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const l of this._data.features)n.set(l.id,l);for(const l of f.features)n.set(l.id,l);this._data.features=[...n.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterLeaves(f,n,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:n,offset:l},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=o.l({append:f},this.workerOptions);n.scope=this.scope;const l=this._data;typeof l=="string"?(n.request=this.map._requestManager.transformRequest(o.q.resolveURL(l),o.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new o.y(p));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(v.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new o.z("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,n){const l=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,v=this._partialReload,S={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:v};f.request=this.actor.send(l,S,(A,D)=>v&&!D?(f.state="loaded",n(null)):(delete f.request,f.destroy(),f.aborted?n(null):A?n(A):(f.loadVectorData(D,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,n){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aJ{constructor(f,n,l,p){super(f,n,l,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.R.Source).url);o.aK(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new o.y(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(f,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aJ,model:class extends o.E{constructor(f,n,l,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const f=[];for(const n in this._options.models){const l=this._options.models[n],p=o.aM(this.map._requestManager.transformRequest(l.uri,o.R.Model).url).then(y=>{if(!y)return;const v=o.aN(y),S=new o.aO(n,l.position,l.orientation,v);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(y=>{this.fire(new o.y(new Error(`Could not load model ${n} from ${l.uri}: ${y.message}`)))});f.push(p)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new o.y(new Error(`Could not load models: ${n.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,n){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(f,n,l,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=Lf(this._options,this.map._requestManager,n,l,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.y(p))):y&&(o.l(this,y),y.bounds&&(this.tileBounds=new uc(y.bounds,this.minzoom,this.maxzoom)),Wr(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,n){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,o.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=n;else{if(f.buckets){const v=Object.values(f.buckets);for(const S of v)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(v,S){return f.aborted?n(null):v&&v.status!==404?n(v):(this.map._refreshExpiredTiles&&S&&f.setExpiryData(S),f.loadModelData(S,this.map.painter),f.state="loaded",void n(null))}}serialize(){return o.l({},this._options)}},canvas:class extends o.aJ{constructor(f,n,l,p){super(f,n,l,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(v=>typeof v!="number"))||this.fire(new o.y(new o.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof o.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends o.E{constructor(f,n,l,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new uc(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),o.l(this,o.ay(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:l,z:p}=f.canonical;return this._implementation.hasTile({x:n,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:l,y:p,z:y}=f.tileID.canonical,v=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:y},{signal:v.signal})).then((function(S){return delete f.request,f.aborted?(f.state="unloaded",n(null)):S===void 0?(f.state="errored",n(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement}(S)?(this.loadTileData(f,S),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(f.state="errored",n(S))}),f.request.cancel=()=>v.abort()}loadTileData(f,n){f.setTexture(n,this.map.painter)}unloadTile(f,n){if(f.texture&&f.texture instanceof o.T?(f.destroy(!0),f.texture&&f.texture instanceof o.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:l,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:y})}n&&n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=o.aC(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},zg=function(f,n,l,p){const y=new dc[n.type](f,n,l,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return o.aP(["load","abort","unload","serialize","prepare"],y),y};function pv(f,n,l,p,y=!1){const v=n.sourceCache.transform,S=n.sourceCache.tilesIn(f,n.has3DLayers,y);S.sort(Nf);const A=[];for(const D of S){const N=D.tile.queryRenderedFeatures(n,D,l,p,v,y);Object.keys(N).length&&A.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:N})}return A.length===0?{}:function(D){const N={},j={};for(const $ of D){const V=$.queryResults,q=$.wrappedTileID,ie=j[q]=j[q]||{};for(const ne in V){const le=V[ne],ce=ie[ne]=ie[ne]||{},fe=N[ne]=N[ne]||[];for(const ve of le)ce[ve.featureIndex]||(ce[ve.featureIndex]=!0,fe.push(ve))}}return N}(A)}function zf(f,n,l,p,y){const v={},S=p.queryRenderedSymbols(f),A=[];for(const D of Object.keys(S).map(Number))A.push(y[D]);A.sort(Nf);for(const D of A){const N=D.featureIndex.lookupSymbolFeatures(S[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,n,l);for(const j in N){const $=v[j]=v[j]||[],V=N[j];V.sort((q,ie)=>{const ne=D.featureSortOrder;if(ne){const le=ne.indexOf(q.featureIndex);return ne.indexOf(ie.featureIndex)-le}return ie.featureIndex-q.featureIndex});for(const q of V)$.push(q)}}return v}function Xd(f,n){const l=f.getRenderableIds().map(v=>f.getTileByID(v)),p=[],y={};for(let v=0;v<l.length;v++){const S=l[v],A=S.tileID.canonical.key;y[A]||(y[A]=!0,S.querySourceFeatures(p,n))}return p}function Nf(f,n){const l=f.tileID,p=n.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Ng(f,n){const l={};if(!n)return l;for(const p of f){const y=p.layerIds.map(v=>n.getLayer(v)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(v=>y.filter(S=>S.id===v)[0]));for(const v of y)l[v.fqid]=p}}return l}const as=32,Gs=33,bs=new Uint16Array(8184);for(let f=0;f<2046;f++){let n=f+2,l=0,p=0,y=0,v=0,S=0,A=0;for(1&n?y=v=S=as:l=p=A=as;(n>>=1)>1;){const N=l+y>>1,j=p+v>>1;1&n?(y=l,v=p,l=S,p=A):(l=y,p=v,y=S,v=A),S=N,A=j}const D=4*f;bs[D+0]=l,bs[D+1]=p,bs[D+2]=y,bs[D+3]=v}const Hs=new Uint16Array(2178),za=new Uint8Array(1089),Ff=new Uint16Array(1089);function Kd(f){return f===0?-.03125:f===32?.03125:0}const El={type:2,extent:o.ag,loadGeometry:()=>[[new o.P(0,0),new o.P(o.ag+1,0),new o.P(o.ag+1,o.ag+1),new o.P(0,o.ag+1),new o.P(0,0)]]};class Cl{constructor(n,l,p,y,v){this.tileID=n,this.uid=o.aV(),this.uses=0,this.tileSize=l,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection)}registerFadeDuration(n){const l=n+this.timeAdded;l<o.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,l,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Ng(n.buckets,l.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const v=this.buckets[y];if(v instanceof o.aX){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const v=this.buckets[y];if(v instanceof o.aX&&v.hasRTLText){this.hasRTLText=!0,o.aY();break}}this.queryPadding=0;for(const y in this.buckets){const v=this.buckets[y],S=l.style.getOwnLayer(y);if(!S)continue;const A=S.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,A)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new o.aW}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,l,p){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets={...this.buckets,...Ng(n.buckets,l.style)},n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(n)}const l=n.gl,p=this.imageAtlas;if(p&&!p.uploaded){const y=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new o.T(n,p.image,l.RGBA8,{useMipmap:y}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(n,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(n,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(n,l,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=l.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(n,l,p,y,v,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const A=function(D,N){const j=o.ab.mat4.fromScaling([],[.5*D.width,.5*-D.height,1]);return o.ab.mat4.translate(j,j,[1,-1,0]),o.ab.mat4.multiply(j,j,D.calculateProjMatrix(N.toUnwrapped())),Float32Array.from(j)}(v,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:l,pixelPosMatrix:A,transform:y,availableImages:p,tileTransform:this.tileTransform})}querySourceFeatures(n,l){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),v=l?l.sourceLayer:"",S=y._geojsonTileLayer||y[v];if(!S)return;const A=o.aZ(l&&l.filter),{z:D,x:N,y:j}=this.tileID.canonical,$={z:D,x:N,y:j};for(let V=0;V<S.length;V++){const q=S.feature(V);if(A.needGeometry){const le=o.a_(q,!0);if(!A.filter(new o.a8(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!A.filter(new o.a8(this.tileID.overscaledZ),q))continue;const ie=p.getId(q,v),ne=new o.a$(q,D,N,j,ie);ne.tile=$,n.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const l=this.expirationTime;if(n.cacheControl){const p=o.b0(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(l)if(this.expirationTime<l)y=!0;else{const v=this.expirationTime-l;v?this.expirationTime=p+Math.max(v,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,l){if(!this.latestFeatureIndex)return;const p=this.latestFeatureIndex.loadVTLayers(),y=n.style.listImages(),v=n.style.getBrightness();for(const S in this.buckets){if(!n.style.hasLayer(S))continue;const A=this.buckets[S],D=A.layers[0],N=D.sourceLayer||"_geojsonTileLayer",j=p[N],$=n.style.getSourceCache(D.source,D.scope);let V={};$&&(V=$._state.getState(N,void 0));const q=this.imageAtlas&&this.imageAtlas.patternPositions||{},ie=Object.keys(V).length>0&&!l;(ie&&A.stateDependentLayers.length!==0||l)&&A.update(V,j,y,q,ie?A.stateDependentLayers:A.layers,l,v),(A instanceof o.b1||A instanceof o.b2)&&n._terrain&&n._terrain.enabled&&$&&A.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile($.id,this.tileID);const ne=n&&n.style&&n.style.getOwnLayer(S);ne&&(this.queryPadding=Math.max(this.queryPadding,ne.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=o.q.now()+n}setTexture(n,l){const p=l.context,y=p.gl;this.texture=this.texture||l.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n):(this.texture=new o.T(p,n,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(n,l){const p={};for(const y of l)p[y]=!0;this.dependencies[n]=p}hasDependency(n,l){for(const p of n){const y=this.dependencies[p];if(y){for(const v of l)if(y[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const p=o.b3(El,this.tileID.canonical,this.tileTransform)[0],y=new o.b4,v=new o.b5;for(let S=0;S<p.length;S++){const{x:A,y:D}=p[S];y.emplaceBack(A,D),v.emplaceBack(S)}v.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(v),this._tileDebugBuffer=n.createVertexBuffer(y,o.b6.members),this._tileDebugSegments=o.b7.simpleSegment(0,0,y.length,v.length)}_makeTileBoundsBuffers(n,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const p=o.b3(El,this.tileID.canonical,this.tileTransform)[0];let y,v;if(this.isRaster){const S=function(A,D){const N=o.aQ(A,D),j=Math.pow(2,A.z);for(let le=0;le<Gs;le++)for(let ce=0;ce<Gs;ce++){const fe=o.aR((A.x+(ce+Kd(ce))/as)/j),ve=o.aS((A.y+(le+Kd(le))/as)/j),_e=D.project(fe,ve),Te=le*Gs+ce;Hs[2*Te+0]=Math.round((_e.x*N.scale-N.x)*o.ag),Hs[2*Te+1]=Math.round((_e.y*N.scale-N.y)*o.ag)}za.fill(0),Ff.fill(0);for(let le=2045;le>=0;le--){const ce=4*le,fe=bs[ce+0],ve=bs[ce+1],_e=bs[ce+2],Te=bs[ce+3],we=fe+_e>>1,Se=ve+Te>>1,be=we+Se-ve,ke=Se+fe-we,ze=ve*Gs+fe,tt=Te*Gs+_e,Xe=Se*Gs+we,Oe=Math.hypot((Hs[2*ze+0]+Hs[2*tt+0])/2-Hs[2*Xe+0],(Hs[2*ze+1]+Hs[2*tt+1])/2-Hs[2*Xe+1])>=16;za[Xe]=za[Xe]||(Oe?1:0),le<1022&&(za[Xe]=za[Xe]||za[(ve+ke>>1)*Gs+(fe+be>>1)]||za[(Te+ke>>1)*Gs+(_e+be>>1)])}const $=new o.aT,V=new o.aU;let q=0;function ie(le,ce){const fe=ce*Gs+le;return Ff[fe]===0&&($.emplaceBack(Hs[2*fe+0],Hs[2*fe+1],le*o.ag/as,ce*o.ag/as),Ff[fe]=++q),Ff[fe]-1}function ne(le,ce,fe,ve,_e,Te){const we=le+fe>>1,Se=ce+ve>>1;if(Math.abs(le-_e)+Math.abs(ce-Te)>1&&za[Se*Gs+we])ne(_e,Te,le,ce,we,Se),ne(fe,ve,_e,Te,we,Se);else{const be=ie(le,ce),ke=ie(fe,ve),ze=ie(_e,Te);V.emplaceBack(be,ke,ze)}}return ne(0,0,as,as,as,0),ne(as,as,0,0,0,as),{vertices:$,indices:V}}(this.tileID.canonical,l);y=S.vertices,v=S.indices}else{y=new o.aT,v=new o.aU;for(const{x:A,y:D}of p)y.emplaceBack(A,D,0,0);const S=o.b8(y.int16,void 0,4);for(let A=0;A<S.length;A+=3)v.emplaceBack(S[A],S[A+1],S[A+2])}this._tileBoundsBuffer=n.createVertexBuffer(y,o.b9.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(v),this._tileBoundsSegments=o.b7.simpleSegment(0,0,y.length,v.length)}_makeGlobeTileDebugBuffers(n,l){const p=l.projection;if(!p||p.name!=="globe"||l.freezeTileCoverage)return;const y=this.tileID.canonical,v=o.ba(y,l),S=o.bb(v),A=o.ae(l.zoom);let D;A>0&&(D=o.ab.mat4.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,y,l,S,D,A),this._makeGlobeTileDebugTextBuffer(n,y,l,S,D,A)}_globePoint(n,l,p,y,v,S,A){let D=o.bc(n,l,p);if(S){const N=1<<p.z,j=o.at(y.center.lng),$=o.aA(y.center.lat),V=(p.x+.5)/N-j;let q=0;V>.5?q=-1:V<-.5&&(q=1);let ie=(n/o.ag+p.x)/N+q,ne=(l/o.ag+p.y)/N;ie=(ie-j)*y._pixelsPerMercatorPixel+j,ne=(ne-$)*y._pixelsPerMercatorPixel+$;const le=[ie*y.worldSize,ne*y.worldSize,0];o.ab.vec3.transformMat4(le,le,S),D=o.bd(D,le,A)}return o.ab.vec3.transformMat4(D,D,v)}_makeGlobeTileDebugBorderBuffer(n,l,p,y,v,S){const A=new o.b4,D=new o.b5,N=new o.be,j=(V,q,ie,ne,le)=>{const ce=(ie-V)/(le-1),fe=(ne-q)/(le-1),ve=A.length;for(let _e=0;_e<le;_e++){const Te=V+_e*ce,we=q+_e*fe;A.emplaceBack(Te,we);const Se=this._globePoint(Te,we,l,p,y,v,S);N.emplaceBack(Se[0],Se[1],Se[2]),D.emplaceBack(ve+_e)}},$=o.ag;j(0,0,$,0,16),j($,0,$,$,16),j($,$,0,$,16),j(0,$,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(D),this._tileDebugBuffer=n.createVertexBuffer(A,o.b6.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(N,o.bf.members),this._tileDebugSegments=o.b7.simpleSegment(0,0,A.length,D.length)}_makeGlobeTileDebugTextBuffer(n,l,p,y,v,S){const A=o.ag/4,D=new o.b4,N=new o.aU,j=new o.be,$=25;N.reserve(32),D.reserve($),j.reserve($);const V=(q,ie)=>$*q+ie;for(let q=0;q<$;q++){const ie=q*A;for(let ne=0;ne<$;ne++){const le=ne*A;D.emplaceBack(le,ie);const ce=this._globePoint(le,ie,l,p,y,v,S);j.emplaceBack(ce[0],ce[1],ce[2])}}for(let q=0;q<4;q++)for(let ie=0;ie<4;ie++){const ne=V(q,ie),le=V(q,ie+1),ce=V(q+1,ie),fe=V(q+1,ie+1);N.emplaceBack(ne,le,ce),N.emplaceBack(ce,le,fe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(N),this._tileDebugTextBuffer=n.createVertexBuffer(D,o.b6.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(j,o.bf.members),this._tileDebugTextSegments=o.b7.simpleSegment(0,0,$,32)}destroy(n=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bg.setPbf(o.bh);class jf extends Cl{constructor(n,l,p,y,v){super(n,l,p,y,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,l){const p=l.context,y=p.gl;this.texture=this.texture||l.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n,{premultiply:!1}):this.texture=new o.T(p,n,y.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,l){const p=this._mrt=new o.bg(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=o.bi(y,(v,S,A,D)=>{if(v)l(v);else try{const N=p.getHeaderLength(S);if(N>n)return void(this.request=this.fetchHeader(N,l));p.parseHeader(S),this._isHeaderLoaded=!0;let j=0;for(const $ of Object.values(p.layers))j=Math.max(j,$.dataIndex[$.dataIndex.length-1].last_byte);S.byteLength>=j&&(this.entireBuffer=S),l(null,this.entireBuffer||S,A,D)}catch(N){l(N)}}),this.request}fetchBand(n,l,p){const y=this._mrt;if(!this._isHeaderLoaded||!y)return void p(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void p(new Error("Can't fetch tile band without an actor"));let S;const A=($,V)=>{S.complete($,V),$?p($):(this.updateTextureDescriptor(n,l),p(null,this.textureDescriptor&&this.textureDescriptor.img))},D=($,V)=>{if($)return p($);const q=v.send("decodeRasterArray",{buffer:V,task:S},A,void 0,!0);this._workQueue.push(()=>{q&&q.cancel(),S.cancel()})},N=y.getLayer(n);if(!N)return void p(new Error(`Unknown sourceLayer "${n}"`));if(N.hasDataForBand(l))return this.updateTextureDescriptor(n,l),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const j=N.getDataRange([l]);if(S=y.createDecodingTask(j),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)D(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const $=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),V=o.bi($,D);this._fetchQueue.push(()=>{V.cancel(),S.cancel()})}else p(null)}updateNeeded(n,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,l){if(!this._mrt)return;const p=this._mrt.getLayer(n);if(!p||!p.hasBand(l)||!p.hasDataForBand(l))return;const{bytes:y,tileSize:v,buffer:S,offset:A,scale:D}=p.getBandView(l),N=v+2*S,j={data:y,width:N,height:N},$=this.texture;$&&$ instanceof o.T&&$.update(j,{premultiply:!1}),this.textureDescriptor={layer:n,band:l,img:j,buffer:S,offset:A,tileSize:v,format:p.pixelFormat,mix:[D,256*D,65536*D,16777216*D]}}}class Fg{constructor(n,l){this.max=n,this.onRemove=l,this.reset()}reset(){for(const n in this.data)for(const l of this.data[n])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(n,l,p){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const v={value:l,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(n,v)},p)),this.data[y].push(v),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const l=this.data[n].shift();return l.timeout&&clearTimeout(l.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),l.value}getByKey(n){const l=this.data[n];return l?l[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,l){if(!this.has(n))return this;const p=n.wrapped().key,y=l===void 0?0:this.data[p].indexOf(l),v=this.data[p][y];return this.data[p].splice(y,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(n){const l=[];for(const p in this.data)for(const y of this.data[p])n(y.value)||l.push(y);for(const p of l)this.remove(p.value.tileID,p)}}class uu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,l,p){const y=String(l);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},o.l(this.stateChanges[n][y],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const v in this.state[n])v!==y&&(this.deletedStates[n][v]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const v in this.state[n][y])p[v]||(this.deletedStates[n][y][v]=null)}else for(const v in p)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][v]===null&&delete this.deletedStates[n][y][v]}removeFeatureState(n,l,p){if(this.deletedStates[n]===null)return;const y=String(l);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&l!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][p]=null);else if(l!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(p in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][p]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,l){const p=this.state[n]||{},y=this.stateChanges[n]||{},v=this.deletedStates[n];if(v===null)return{};if(l!==void 0){const A=String(l),D=o.l({},p[A],y[A]);if(v){const N=v[l];if(N===null)return{};for(const j in N)delete D[j]}return D}const S=o.l({},p,y);if(v)for(const A in v)delete S[A];return S}initializeTileState(n,l){n.refreshFeatureState(l)}coalesceChanges(n,l){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const v={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),o.l(this.state[y][S],this.stateChanges[y][S]),v[S]=this.state[y][S];p[y]=v}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const v={};if(this.deletedStates[y]===null)for(const S in this.state[y])v[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else if(this.state[y][S])for(const A of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][A];v[S]=this.state[y][S]}p[y]=p[y]||{},o.l(p[y],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const y in n)n[y].refreshFeatureState(l)}}class ws extends o.E{constructor(n,l,p){super(),this.id=n,this._onlySymbols=p,l.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Fg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new uu,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const l=this._tiles[n];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,l){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,l)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const p=this._tiles[l];p.upload(n),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.bj(this._tiles).map(n=>n.tileID).sort(Bf).map(n=>n.key)}getRenderableIds(n,l){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,n,l)&&p.push(this._tiles[y]);return n?p.sort((y,v)=>{const S=y.tileID,A=v.tileID,D=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),N=new o.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-A.overscaledZ||N.y-D.y||N.x-D.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(Bf).map(y=>y.key)}hasRenderableParent(n){const l=this.findLoadedParent(n,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(n,l,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(l||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,l){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=l),this._loadTile(p,this._tileLoaded.bind(this,p,n,l)))}_tileLoaded(n,l,p,y){if(y)if(n.state="errored",y.status!==404)this._source.fire(new o.y(y,{tile:n}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=o.q.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(l,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new o.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const l=this.getRenderableIds();for(let y=0;y<l.length;y++){const v=l[y];if(n.neighboringTiles&&n.neighboringTiles[v]){const S=this.getTileByID(v);p(n,S),p(S,n)}}function p(y,v){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let S=v.tileID.canonical.x-y.tileID.canonical.x;const A=v.tileID.canonical.y-y.tileID.canonical.y,D=Math.pow(2,y.tileID.canonical.z),N=v.tileID.key;S===0&&A===0||Math.abs(A)>1||(Math.abs(S)>1&&(Math.abs(S+D)===1?S+=D:Math.abs(S-D)===1&&(S-=D)),v.dem&&y.dem&&(y.dem.backfillBorder(v.dem,S,A),y.neighboringTiles&&y.neighboringTiles[N]&&(y.neighboringTiles[N].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,l,p,y){for(const v in this._tiles){let S=this._tiles[v];if(y[v]||!S.hasData()||S.tileID.overscaledZ<=l||S.tileID.overscaledZ>p)continue;let A=S.tileID;for(;S&&S.tileID.overscaledZ>l+1;){const N=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[N.key],S&&S.hasData()&&(A=N)}let D=A;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),n[D.key]){y[A.key]=A;break}}}findLoadedParent(n,l){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=l?p:null}for(let p=n.overscaledZ-1;p>=l;p--){const y=n.scaledTo(p),v=this._getLoadedTile(y);if(v)return v}}_getLoadedTile(n){const l=this._tiles[n.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,l){l=l||this._source.tileSize;const p=Math.ceil(n.width/l)+1,y=Math.ceil(n.height/l)+1,v=Math.floor(p*y*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(A)}handleWrapJump(n){const l=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,l){const p={};for(const y in this._tiles){const v=this._tiles[y];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),p[v.tileID.key]=v}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(n,l,p,y){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let S,A=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const $=D.attenuationRange()[0],V=Math.floor($)-Math.log2(D.getDemUpscale());A>V&&(A=V)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=n.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new o.aG($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y));else if(this.tileCoverLift!==0){const $=n.clone();$.tileCoverLift=this.tileCoverLift,S=$.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&n.projection.name==="globe"&&(S.push(new o.aG(1,0,1,0,0)),S.push(new o.aG(1,0,1,1,0)),S.push(new o.aG(1,0,1,0,1)),S.push(new o.aG(1,0,1,1,1)))}else if(S=n.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const $=this._source.hasTile.bind(this._source);S=S.filter(V=>$(V))}}else S=[];if(S.length>0&&this.castsShadows&&y&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Uf(this._source.type)){const $=n.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),V=Math.min($,this._source.maxzoom);if(v){const q=n.extendTileCover(S,V);for(const ie of q)S.push(ie)}else{const q=n.extendTileCover(S,V,y);for(const ie of q)this._shadowCasterTiles[ie.key]=!0,S.push(ie)}}const N=this._updateRetainedTiles(S);if(Uf(this._source.type)&&S.length!==0){const $={},V={},q=Object.keys(N);for(const ne of q){const le=N[ne],ce=this._tiles[ne];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=o.q.now())continue;const fe=this.findLoadedParent(le,Math.max(le.overscaledZ-ws.maxOverzooming,this._source.minzoom));fe&&(this._addTile(fe.tileID),$[fe.tileID.key]=fe.tileID),V[ne]=le}const ie=S[S.length-1].overscaledZ;for(const ne in this._tiles){const le=this._tiles[ne];if(N[ne]||!le.hasData())continue;let ce=le.tileID;for(;ce.overscaledZ>ie;){ce=ce.scaledTo(ce.overscaledZ-1);const fe=this._tiles[ce.key];if(fe&&fe.hasData()&&V[ce.key]){N[ne]=le.tileID;break}}}for(const ne in $)N[ne]||(this._coveredTiles[ne]=!0,N[ne]=$[ne])}for(const $ in N)this._tiles[$].clearFadeHold();const j=o.bk(this._tiles,N);for(const $ of j){const V=this._tiles[$];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(+$)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const l={};if(n.length===0)return l;const p={},y=n.reduce((N,j)=>Math.min(N,j.overscaledZ),1/0),v=n[0].overscaledZ,S=Math.max(v-ws.maxOverzooming,this._source.minzoom),A=Math.max(v+ws.maxUnderzooming,this._source.minzoom),D={};for(const N of n){const j=this._addTile(N);l[N.key]=N,j.hasData()||y<this._source.maxzoom&&(D[N.key]=N)}this._retainLoadedChildren(D,y,A,l);for(const N of n){let j=this._tiles[N.key];if(j.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const V=N.children(this._source.maxzoom)[0],q=this.getTile(V);if(q&&q.hasData()){l[V.key]=V;continue}}else{const V=N.children(this._source.maxzoom);if(l[V[0].key]&&l[V[1].key]&&l[V[2].key]&&l[V[3].key])continue}let $=j.wasRequested();for(let V=N.overscaledZ-1;V>=S;--V){const q=N.scaledTo(V);if(p[q.key]||(p[q.key]=!0,j=this.getTile(q),!j&&$&&(j=this._addTile(q)),j&&(l[q.key]=q,$=j.wasRequested(),j.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const l=[];let p,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}l.push(y.key);const v=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;y=v}for(const v of l)this._loadedParentTiles[v]=p}}_addTile(n){let l=this._tiles[n.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),l;l=this._cache.getAndRemove(n),l&&(this._setTileReloadTimer(n.key,l),l.tileID=n,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,l)));const p=!!l;if(!p){const y=this.map?this.map.painter:null,v=this._source.tileSize*n.overscaleFactor();l=this._source.type==="raster-array"?new jf(n,v,this.transform.tileZoom,y,this._isRaster):new Cl(n,v,this.transform.tileZoom,y,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,n.key,l.state))}return l?(l.uses++,this._tiles[n.key]=l,p||this._source.fire(new o.z("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(n,l){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=l.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const l=this._tiles[n];l&&(l.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,l,p){const y=[],v=this.transform;if(!v)return y;const S=v.projection.name==="globe",A=o.at(v.center.lng);for(const D in this._tiles){const N=this._tiles[D];if(p&&N.clearQueryDebugViz(),N.holdingForFade())continue;let j;if(S){const $=N.tileID.canonical;if($.z===0){const V=[Math.abs(o.aw(A,...Xr($,-1))-A),Math.abs(o.aw(A,...Xr($,1))-A)];j=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(o.aw(A,...Xr($,-1))-A),Math.abs(o.aw(A,...Xr($,0))-A),Math.abs(o.aw(A,...Xr($,1))-A)];j=[V.indexOf(Math.min(...V))-1]}}else j=[0];for(const $ of j){const V=n.containsTile(N,v,l,$);V&&y.push(V)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,l){const p=this.getRenderableIds(n,l).map(v=>this._tiles[v].tileID),y=this.transform.projection.name==="globe";for(const v of p)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=y?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return p}sortCoordinatesByDistance(n){const l=n.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),v={};for(const S of l){const A=1/(1<<S.canonical.z);v[S.key]=((S.canonical.x+.5)*A+S.wrap-p[0])*y[0]+((S.canonical.y+.5)*A-p[1])*y[1]-p[2]*y[2]}return l.sort((S,A)=>v[S.key]-v[A.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Uf(this._source.type))for(const n in this._tiles){const l=this._tiles[n];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(n,l,p){this._state.updateState(n=n||"_geojsonTileLayer",l,p)}removeFeatureState(n,l,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",l,p)}getFeatureState(n,l){return this._state.getState(n=n||"_geojsonTileLayer",l)}setDependencies(n,l,p){const y=this._tiles[n];y&&y.setDependencies(l,p)}reloadTilesForDependencies(n,l){for(const p in this._tiles)this._tiles[p].hasDependency(n,l)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,l))}_preloadTiles(n,l){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(n,l))};return void this._source.on("data",D)}const p=new Map,y=Array.isArray(n)?n:[n],v=this.map.painter.terrain,S=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const D of y){const N=D.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of N)p.set(j.key,j);this.usedForTerrain&&D.updateElevation(!1)}const A=Array.from(p.values());o.bl(A,(D,N)=>{const j=new Cl(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(j,$=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),N($,j)})},l)}}function Bf(f,n){const l=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return f.overscaledZ-n.overscaledZ||p-l||n.canonical.y-f.canonical.y||n.canonical.x-f.canonical.x}function Uf(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Xr(f,n){const l=1<<f.z;return[f.x/l+n,(f.x+1)/l+n]}ws.maxOverzooming=10,ws.maxUnderzooming=3;class r2{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,l=!1;for(const p in this.style._mergedLayers){const y=this.style._mergedLayers[p];if(y.type==="fill-extrusion")this.layers.push({layer:y,visible:n,visibilityChanged:l});else if(y.type==="model"){const v=this.style.getLayerSource(y);v&&v.type==="batched-model"&&this.layers.push({layer:y,visible:n,visibilityChanged:l})}}}onNewFrame(n){this.layersGotHidden=!1;for(const l of this.layers){const p=l.layer;let y=!1;p.type==="fill-extrusion"?y=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(y=!p.isHidden(n)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&l.visible,l.visible=y}}updateZOffset(n,l){this.currentBuildingBuckets=[];for(const y of this.layers){const v=y.layer,S=this.style.getLayerSourceCache(v);let A=1;v.type==="fill-extrusion"&&(A=y.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let D=S?S.getTile(l):null;if(!D&&S&&l.canonical.z>S.getSource().minzoom){let N=l.scaledTo(Math.min(S.getSource().maxzoom,l.overscaledZ-1));for(;N.overscaledZ>=S.getSource().minzoom&&(D=S.getTile(N),!D&&N.overscaledZ!==0);)N=N.scaledTo(N.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(v):null,tileID:D?D.tileID:l,verticalScale:A})}n.hasAnyZOffset=!1;let p=!1;for(let y=0;y<n.symbolInstances.length;y++){const v=n.symbolInstances.get(y),S=v.zOffset,A=this._getHeightAtTileOffset(l,v.tileAnchorX,v.tileAnchorY);v.zOffset=A!==Number.NEGATIVE_INFINITY?A:S,p||S===v.zOffset||(p=!0),n.hasAnyZOffset||v.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,l,p,y){let v=l,S=p;if(n.canonical.z!==y.canonical.z){const A=y.canonical,D=1/(1<<n.canonical.z-A.z);v=(l+n.canonical.x*o.ag)*D-A.x*o.ag|0,S=(p+n.canonical.y*o.ag)*D-A.y*o.ag|0}return{tileX:v,tileY:S}}_getHeightAtTileOffset(n,l,p){let y,v;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:A,tileID:D,verticalScale:N}=this.currentBuildingBuckets[S];if(!A)continue;const{tileX:j,tileY:$}=this._mapCoordToOverlappingTile(n,l,p,D),V=A.getHeightAtTileCoord(j,$);V&&V.height!==void 0&&(V.hidden?y=V.height:v=Math.max(V.height*N,v||0))}if(v!==void 0)return v;for(let S=0;S<this.layers.length;++S){const A=this.layers[S];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:D,tileID:N}=this.currentBuildingBuckets[S];if(!D)continue;const{tileX:j,tileY:$}=this._mapCoordToOverlappingTile(n,l,p,N),V=D.getHeightAtTileCoord(j,$);if(V&&!V.hidden)return V.height===void 0&&y!==void 0?Math.min(V.maxHeight,y)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function pr(f,n){const l={};for(const p in f)p!=="ref"&&(l[p]=f[p]);return o.bm.forEach(p=>{p in n&&(l[p]=n[p])}),l}function jg(f){f=f.slice();const n=Object.create(null);for(let l=0;l<f.length;l++)n[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=pr(f[l],n[f[l].ref]));return f}const Zr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Vf(f,n,l){l.push({command:Zr.addSource,args:[f,n[f]]})}function Ss(f,n,l){n.push({command:Zr.removeSource,args:[f]}),l[f]=!0}function Bg(f,n,l,p){Ss(f,l,p),Vf(f,n,l)}function du(f,n,l){let p;for(p in f[l])if(f[l].hasOwnProperty(p)&&p!=="data"&&!o.bn(f[l][p],n[l][p]))return!1;for(p in n[l])if(n[l].hasOwnProperty(p)&&p!=="data"&&!o.bn(f[l][p],n[l][p]))return!1;return!0}function Ht(f,n,l,p,y,v){let S;for(S in n=n||{},f=f||{})f.hasOwnProperty(S)&&(o.bn(f[S],n[S])||l.push({command:v,args:[p,S,n[S],y]}));for(S in n)n.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(o.bn(f[S],n[S])||l.push({command:v,args:[p,S,n[S],y]}))}function rn(f){return f.id}function Yr(f,n){return f[n.id]=n,f}class Ho{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.aw(n,0,1);let l=1,p=this._distances[l];const y=n*this.paddedLength+this.padding;for(;p<y&&l<this._distances.length;)p=this._distances[++l];const v=l-1,S=this._distances[v],A=p-S,D=A>0?(y-S)/A:0;return this.points[v].mult(1-D).add(this.points[l].mult(D))}}class hc{constructor(n,l,p){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(l/p);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,p,y,v){this._forEachCell(l,p,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(n,l,p,y){this._forEachCell(l-y,p-y,l+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(p),this.circles.push(y)}_insertBoxCell(n,l,p,y,v,S){this.boxCells[v].push(S)}_insertCircleCell(n,l,p,y,v,S){this.circleCells[v].push(S)}_query(n,l,p,y,v,S){if(p<0||n>this.width||y<0||l>this.height)return!v&&[];const A=[];if(n<=0&&l<=0&&this.width<=p&&this.height<=y){if(v)return!0;for(let D=0;D<this.boxKeys.length;D++)A.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const N=this.circles[3*D],j=this.circles[3*D+1],$=this.circles[3*D+2];A.push({key:this.circleKeys[D],x1:N-$,y1:j-$,x2:N+$,y2:j+$})}return S?A.filter(S):A}return this._forEachCell(n,l,p,y,this._queryCell,A,{hitTest:v,seenUids:{box:{},circle:{}}},S),v?A.length>0:A}_queryCircle(n,l,p,y,v){const S=n-p,A=n+p,D=l-p,N=l+p;if(A<0||S>this.width||N<0||D>this.height)return!y&&[];const j=[];return this._forEachCell(S,D,A,N,this._queryCellCircle,j,{hitTest:y,circle:{x:n,y:l,radius:p},seenUids:{box:{},circle:{}}},v),y?j.length>0:j}query(n,l,p,y,v){return this._query(n,l,p,y,!1,v)}hitTest(n,l,p,y,v){return this._query(n,l,p,y,!0,v)}hitTestCircle(n,l,p,y){return this._queryCircle(n,l,p,!0,y)}_queryCell(n,l,p,y,v,S,A,D){const N=A.seenUids,j=this.boxCells[v];if(j!==null){const V=this.bboxes;for(const q of j)if(!N.box[q]){N.box[q]=!0;const ie=4*q;if(n<=V[ie+2]&&l<=V[ie+3]&&p>=V[ie+0]&&y>=V[ie+1]&&(!D||D(this.boxKeys[q]))){if(A.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[q],x1:V[ie],y1:V[ie+1],x2:V[ie+2],y2:V[ie+3]})}}}const $=this.circleCells[v];if($!==null){const V=this.circles;for(const q of $)if(!N.circle[q]){N.circle[q]=!0;const ie=3*q;if(this._circleAndRectCollide(V[ie],V[ie+1],V[ie+2],n,l,p,y)&&(!D||D(this.circleKeys[q]))){if(A.hitTest)return S.push(!0),!0;{const ne=V[ie],le=V[ie+1],ce=V[ie+2];S.push({key:this.circleKeys[q],x1:ne-ce,y1:le-ce,x2:ne+ce,y2:le+ce})}}}}}_queryCellCircle(n,l,p,y,v,S,A,D){const N=A.circle,j=A.seenUids,$=this.boxCells[v];if($!==null){const q=this.bboxes;for(const ie of $)if(!j.box[ie]){j.box[ie]=!0;const ne=4*ie;if(this._circleAndRectCollide(N.x,N.y,N.radius,q[ne+0],q[ne+1],q[ne+2],q[ne+3])&&(!D||D(this.boxKeys[ie])))return S.push(!0),!0}}const V=this.circleCells[v];if(V!==null){const q=this.circles;for(const ie of V)if(!j.circle[ie]){j.circle[ie]=!0;const ne=3*ie;if(this._circlesCollide(q[ne],q[ne+1],q[ne+2],N.x,N.y,N.radius)&&(!D||D(this.circleKeys[ie])))return S.push(!0),!0}}}_forEachCell(n,l,p,y,v,S,A,D){const N=this._convertToXCellCoord(n),j=this._convertToYCellCoord(l),$=this._convertToXCellCoord(p),V=this._convertToYCellCoord(y);for(let q=N;q<=$;q++)for(let ie=j;ie<=V;ie++)if(v.call(this,n,l,p,y,this.xCellCount*ie+q,S,A,D))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,p,y,v,S){const A=y-n,D=v-l,N=p+S;return N*N>A*A+D*D}_circleAndRectCollide(n,l,p,y,v,S,A){const D=(S-y)/2,N=Math.abs(n-(y+D));if(N>D+p)return!1;const j=(A-v)/2,$=Math.abs(l-(v+j));if($>j+p)return!1;if(N<=D||$<=j)return!0;const V=N-D,q=$-j;return V*V+q*q<=p*p}}const Vr={unknown:0,flipRequired:1,flipNotRequired:2},$f=Math.tan(85*Math.PI/180);function Na(f,n,l,p,y,v,S){const A=o.ab.mat4.create();if(l)if(v.name==="globe"){const D=o.bo(y,n);o.ab.mat4.multiply(A,A,D)}else{const D=o.ab.mat2.invert([],S);A[0]=D[0],A[1]=D[1],A[4]=D[2],A[5]=D[3],p||o.ab.mat4.rotateZ(A,A,y.angle)}else o.ab.mat4.multiply(A,y.labelPlaneMatrix,f);return A}function fc(f,n,l,p,y,v,S){const A=Na(f,n,l,p,y,v,S);return v.name==="globe"&&l||(A[2]=A[6]=A[10]=A[14]=0),A}function uo(f,n,l,p,y,v,S){if(l){if(v.name==="globe"){const A=Na(f,n,l,p,y,v,S);return o.ab.mat4.invert(A,A),o.ab.mat4.multiply(A,f,A),A}{const A=o.ab.mat4.clone(f),D=o.ab.mat4.identity([]);return D[0]=S[0],D[1]=S[1],D[4]=S[2],D[5]=S[3],o.ab.mat4.multiply(A,A,D),p||o.ab.mat4.rotateZ(A,A,-y.angle),A}}return y.glCoordMatrix}function On(f,n,l,p){const y=[f,n,l,1];l?o.ab.vec4.transformMat4(y,y,p):gc(y,y,p);const v=y[3];return y[0]/=v,y[1]/=v,y[2]/=v,y}function mv(f,n){return Math.min(.5+f/n*.5,1.5)}function Jd(f,n){const l=f[0]/f[3],p=f[1]/f[3];return l>=-n[0]&&l<=n[0]&&p>=-n[1]&&p<=n[1]}function Gf(f,n,l,p,y,v,S,A,D,N){const j=l.transform,$=p?f.textSizeData:f.iconSizeData,V=o.bp($,l.transform.zoom),q=j.projection.name==="globe",ie=[256/l.width*2+1,256/l.height*2+1],ne=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ne.clear();let le=null;q&&(le=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const ce=f.lineVertexArray,fe=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ve=l.transform.width/l.transform.height;let _e,Te=!1;for(let we=0;we<fe.length;we++){const Se=fe.get(we),{numGlyphs:be,writingMode:ke}=Se;if(ke!==o.bq.vertical||Te||_e===o.bq.horizontal||(Te=!0),_e=ke,(Se.hidden||ke===o.bq.vertical)&&!Te){mc(be,ne);continue}Te=!1;const ze=new o.P(Se.tileAnchorX,Se.tileAnchorY);let{x:tt,y:Xe,z:Oe}=j.projection.projectTilePoint(ze.x,ze.y,N.canonical);if(D){const[ft,zt,Ft]=D(ze);tt+=ft,Xe+=zt,Oe+=Ft}const $e=[tt,Xe,Oe,1];if(o.ab.vec4.transformMat4($e,$e,n),!Jd($e,ie)){mc(be,ne);continue}const ht=$e[3],xt=mv(l.transform.getCameraToCenterDistance(j.projection),ht),Pt=o.br($,V,Se),Ye=S?Pt/xt:Pt*xt,mt=On(tt,Xe,Oe,y);if(mt[3]<=0){mc(be,ne);continue}let ot={};const Tt=S?null:D,gt=Qd(Se,Ye,!1,A,n,y,v,f.glyphOffsetArray,ce,ne,le,mt,ze,ot,ve,Tt,j.projection,N,S);Te=gt.useVertical,Tt&&gt.needsFlipping&&(ot={}),(gt.notEnoughRoom||Te||gt.needsFlipping&&Qd(Se,Ye,!0,A,n,y,v,f.glyphOffsetArray,ce,ne,le,mt,ze,ot,ve,Tt,j.projection,N,S).notEnoughRoom)&&mc(be,ne)}p?(f.text.dynamicLayoutVertexBuffer.updateData(ne),le&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(le)):(f.icon.dynamicLayoutVertexBuffer.updateData(ne),le&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(le))}function hu(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne){const{lineStartIndex:le,glyphStartIndex:ce,segment:fe}=A,ve=ce+A.numGlyphs,_e=le+A.lineLength,Te=n.getoffsetX(ce),we=n.getoffsetX(ve-1),Se=Ii(f*Te,l,p,y,v,S,fe,le,_e,D,N,j,$,V,!0,q,ie,ne);if(!Se)return null;const be=Ii(f*we,l,p,y,v,S,fe,le,_e,D,N,j,$,V,!0,q,ie,ne);return be?{first:Se,last:be}:null}function Hf(f,n,l,p){return f===o.bq.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:f===o.bq.vertical?p>0?{needsFlipping:!0}:null:n!==Vr.unknown&&function(y,v){return y===0||Math.abs(v/y)>$f}(l,p)?n===Vr.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Qd(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le,ce,fe){const ve=n/24,_e=f.lineOffsetX*ve,Te=f.lineOffsetY*ve,{lineStartIndex:we,glyphStartIndex:Se,numGlyphs:be,segment:ke,writingMode:ze,flipState:tt}=f,Xe=we+f.lineLength,Oe=$e=>{if(j){const[Ye,mt,ot]=$e.up,Tt=N.length;o.bs(j,Tt+0,Ye,mt,ot),o.bs(j,Tt+1,Ye,mt,ot),o.bs(j,Tt+2,Ye,mt,ot),o.bs(j,Tt+3,Ye,mt,ot)}const[ht,xt,Pt]=$e.point;o.bt(N,ht,xt,Pt,$e.angle)};if(be>1){const $e=hu(ve,A,_e,Te,l,$,V,f,D,v,q,ne,!1,le,ce,fe);if(!$e)return{notEnoughRoom:!0};if(p&&!l){let[ht,xt,Pt]=$e.first.point,[Ye,mt,ot]=$e.last.point;[ht,xt]=On(ht,xt,Pt,S),[Ye,mt]=On(Ye,mt,ot,S);const Tt=Hf(ze,tt,(Ye-ht)*ie,mt-xt);if(f.flipState=Tt&&Tt.needsFlipping?Vr.flipRequired:Vr.flipNotRequired,Tt)return Tt}Oe($e.first);for(let ht=Se+1;ht<Se+be-1;ht++){const xt=Ii(ve*A.getoffsetX(ht),_e,Te,l,$,V,ke,we,Xe,D,v,q,ne,!1,!1,le,ce,fe);if(!xt)return N.length-=4*(ht-Se),{notEnoughRoom:!0};Oe(xt)}Oe($e.last)}else{if(p&&!l){const ht=On(V.x,V.y,0,y),xt=we+ke+1,Pt=new o.P(D.getx(xt),D.gety(xt)),Ye=On(Pt.x,Pt.y,0,y),mt=Ye[3]>0?Ye:pc(V,Pt,ht,1,y,void 0,le,ce.canonical),ot=Hf(ze,tt,(mt[0]-ht[0])*ie,mt[1]-ht[1]);if(f.flipState=ot&&ot.needsFlipping?Vr.flipRequired:Vr.flipNotRequired,ot)return ot}const $e=Ii(ve*A.getoffsetX(Se),_e,Te,l,$,V,ke,we,Xe,D,v,q,ne,!1,!1,le,ce,fe);if(!$e)return{notEnoughRoom:!0};Oe($e)}return{}}function ho(f,n,l,p,y){const{x:v,y:S,z:A}=p.projectTilePoint(f.x,f.y,n);if(!y)return On(v,S,A,l);const[D,N,j]=y(f);return On(v+D,S+N,A+j,l)}function pc(f,n,l,p,y,v,S,A){const D=ho(f.sub(n)._unit()._add(f),A,y,S,v);return o.ab.vec3.sub(D,l,D),o.ab.vec3.normalize(D,D),o.ab.vec3.scaleAndAdd(D,l,D,p)}function Ii(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le,ce){const fe=p?f-n:f+n;let ve=fe>0?1:-1,_e=0;p&&(ve*=-1,_e=Math.PI),ve<0&&(_e+=Math.PI);let Te=A+S+(ve>0?0:1)|0,we=y,Se=y,be=0,ke=0;const ze=Math.abs(fe),tt=[],Xe=[];let Oe=v,$e=Oe;const ht=()=>pc($e,Oe,Se,ze-be+1,j,V,ne,le.canonical);for(;be+ke<=ze;){if(Te+=ve,Te<A||Te>=D)return null;if(Se=we,$e=Oe,tt.push(Se),q&&Xe.push($e),Oe=new o.P(N.getx(Te),N.gety(Te)),we=$[Te],!we){const zt=ho(Oe,le.canonical,j,ne,V);we=zt[3]>0?$[Te]=zt:ht()}be+=ke,ke=o.ab.vec3.distance(Se,we)}ie&&V&&($[Te]&&(we=ht(),ke=o.ab.vec3.distance(Se,we)),$[Te]=we);const xt=(ze-be)/ke,Pt=Oe.sub($e)._mult(xt)._add($e),Ye=o.ab.vec3.sub([],we,Se),mt=o.ab.vec3.scaleAndAdd([],Se,Ye,xt);let ot=[0,0,1],Tt=Ye[0],gt=Ye[1];if(ce&&(ot=ne.upVector(le.canonical,Pt.x,Pt.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const zt=[ot[2],0,-ot[0]],Ft=o.ab.vec3.cross([],ot,zt);o.ab.vec3.normalize(zt,zt),o.ab.vec3.normalize(Ft,Ft),Tt=o.ab.vec3.dot(Ye,zt),gt=o.ab.vec3.dot(Ye,Ft)}if(l){const zt=o.ab.vec3.cross([],ot,Ye);o.ab.vec3.normalize(zt,zt),o.ab.vec3.scaleAndAdd(mt,mt,zt,l*ve)}const ft=_e+Math.atan2(gt,Tt);return tt.push(mt),q&&Xe.push(Pt),{point:mt,angle:ft,path:tt,tilePath:Xe,up:ot}}function mc(f,n){const l=n.length,p=l+4*f;n.resize(p),n.float32.fill(-1/0,4*l,4*p)}function gc(f,n,l){const p=n[0],y=n[1];return f[0]=l[0]*p+l[4]*y+l[12],f[1]=l[1]*p+l[5]*y+l[13],f[3]=l[3]*p+l[7]*y+l[15],f}const Hn=100;class qs{constructor(n,l,p=new hc(n.width+200,n.height+200,25),y=new hc(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Hn,this.screenBottomBoundary=n.height+Hn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,p,y,v,S,A,D){let N=p.projectedAnchorX,j=p.projectedAnchorY,$=p.projectedAnchorZ;const V=p.elevation,q=p.tileID,ie=n.getProjection();if(V&&q){const[we,Se,be]=ie.upVector(q.canonical,p.tileAnchorX,p.tileAnchorY),ke=ie.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=we*V*ke,j+=Se*V*ke,$+=be*V*ke}const ne=this.projectAndGetPerspectiveRatio(A,N,j,$,p.tileID,ie.name==="globe"||!!V||this.transform.pitch>0,ie),le=S*ne.perspectiveRatio,ce=(p.x1*l+y.x-p.padding)*le+ne.point.x,fe=(p.y1*l+y.y-p.padding)*le+ne.point.y,ve=(p.x2*l+y.x+p.padding)*le+ne.point.x,_e=(p.y2*l+y.y+p.padding)*le+ne.point.y,Te=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(ce,fe,ve,_e)||!v&&this.grid.hitTest(ce,fe,ve,_e,D)||Te?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[ce,fe,ve,_e],offscreen:this.isOffscreen(ce,fe,ve,_e),occluded:!1}}placeCollisionCircles(n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne){const le=[],ce=this.transform.elevation,fe=n.getProjection(),ve=ce?ce.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,fe):null,_e=new o.P(p.tileAnchorX,p.tileAnchorY);let{x:Te,y:we,z:Se}=fe.projectTilePoint(_e.x,_e.y,ne.canonical);if(ve){const[Pt,Ye,mt]=ve(_e);Te+=Pt,we+=Ye,Se+=mt}const be=fe.name==="globe",ke=this.projectAndGetPerspectiveRatio(A,Te,we,Se,ne,be||!!ce||this.transform.pitch>0,fe),{perspectiveRatio:ze}=ke,tt=($?S/ze:S*ze)/o.bw,Xe=On(Te,we,Se,D),Oe=ke.signedDistanceFromCamera>0?hu(tt,v,p.lineOffsetX*tt,p.lineOffsetY*tt,!1,Xe,_e,p,y,D,{},ce&&!$?ve:null,$&&!!ce,fe,ne,$):null;let $e=!1,ht=!1,xt=!0;if(Oe&&!ke.occluded){const Pt=.5*q*ze+ie,Ye=new o.P(-100,-100),mt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ot=new Ho,{first:Tt,last:gt}=Oe,ft=Tt.path.length;let zt=[];for(let $t=ft-1;$t>=1;$t--)zt.push(Tt.path[$t]);for(let $t=1;$t<gt.path.length;$t++)zt.push(gt.path[$t]);const Ft=2.5*Pt;N&&(zt=zt.map(([$t,vr,lr],ar)=>(ve&&!be&&(lr=ve(ar<ft-1?Tt.tilePath[ft-1-ar]:gt.tilePath[ar-ft+2])[2]),On($t,vr,lr,N))),zt.some($t=>$t[3]<=0)&&(zt=[]));let Dt=[];if(zt.length>0){let $t=1/0,vr=-1/0,lr=1/0,ar=-1/0;for(const xr of zt)$t=Math.min($t,xr[0]),lr=Math.min(lr,xr[1]),vr=Math.max(vr,xr[0]),ar=Math.max(ar,xr[1]);vr>=Ye.x&&$t<=mt.x&&ar>=Ye.y&&lr<=mt.y&&(Dt=[zt.map(xr=>new o.P(xr[0],xr[1]))],($t<Ye.x||vr>mt.x||lr<Ye.y||ar>mt.y)&&(Dt=o.bu(Dt,Ye.x,Ye.y,mt.x,mt.y)))}for(const $t of Dt){ot.reset($t,.25*Pt);let vr=0;vr=ot.length<=.5*Pt?1:Math.ceil(ot.paddedLength/Ft)+1;for(let lr=0;lr<vr;lr++){const ar=lr/Math.max(vr-1,1),xr=ot.lerp(ar),$r=xr.x+Hn,Rr=xr.y+Hn;le.push($r,Rr,Pt,0);const Bn=$r-Pt,Pn=Rr-Pt,an=$r+Pt,yn=Rr+Pt;if(xt=xt&&this.isOffscreen(Bn,Pn,an,yn),ht=ht||this.isInsideGrid(Bn,Pn,an,yn),!l&&this.grid.hitTestCircle($r,Rr,Pt,V)&&($e=!0,!j))return{circles:[],offscreen:!1,collisionDetected:$e,occluded:!1}}}}return{circles:!j&&$e||!ht?[]:le,offscreen:xt,collisionDetected:$e,occluded:ke.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,y=1/0,v=-1/0,S=-1/0;for(const j of n){const $=new o.P(j.x+Hn,j.y+Hn);p=Math.min(p,$.x),y=Math.min(y,$.y),v=Math.max(v,$.x),S=Math.max(S,$.y),l.push($)}const A=this.grid.query(p,y,v,S).concat(this.ignoredGrid.query(p,y,v,S)),D={},N={};for(const j of A){const $=j.key;if(D[$.bucketInstanceId]===void 0&&(D[$.bucketInstanceId]={}),D[$.bucketInstanceId][$.featureIndex])continue;const V=[new o.P(j.x1,j.y1),new o.P(j.x2,j.y1),new o.P(j.x2,j.y2),new o.P(j.x1,j.y2)];o.bv(l,V)&&(D[$.bucketInstanceId][$.featureIndex]=!0,N[$.bucketInstanceId]===void 0&&(N[$.bucketInstanceId]=[]),N[$.bucketInstanceId].push($.featureIndex))}return N}insertCollisionBox(n,l,p,y,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:v},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,p,y,v){const S=l?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:y,collisionGroupID:v};for(let D=0;D<n.length;D+=4)S.insertCircle(A,n[D],n[D+1],n[D+2])}projectAndGetPerspectiveRatio(n,l,p,y,v,S,A){const D=[l,p,y,1];let N=!1;y||this.transform.pitch>0?(o.ab.vec4.transformMat4(D,D,n),this.fogState&&v&&A.name!=="globe"&&(N=function(V,q,ie,ne,le,ce){const fe=ce.calculateFogTileMatrix(le),ve=[q,ie,ne];return o.ab.vec3.transformMat4(ve,ve,fe),gr(V,o.ab.vec3.length(ve),ce.pitch,ce._fov)}(this.fogState,l,p,y,v.toUnwrapped(),this.transform)>.9)):gc(D,D,n);const j=D[3];return{point:new o.P((D[0]/j+1)/2*this.transform.width+Hn,(-D[1]/j+1)/2*this.transform.height+Hn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/j*.5,1.5),signedDistanceFromCamera:j,occluded:S&&D[2]>j||N}}isOffscreen(n,l,p,y){return p<Hn||n>=this.screenRightBoundary||y<Hn||l>this.screenBottomBoundary}isInsideGrid(n,l,p,y){return p>=0&&n<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=o.ab.mat4.identity([]);return o.ab.mat4.translate(n,n,[-100,-100,0]),n}}function Ts(f,n,l){const p=n.createTileMatrix(f,f.worldSize,l.toUnwrapped());return o.ab.mat4.multiply(new Float32Array(16),f.projMatrix,p)}function pi(f,n,l){if(n.projection.name===l.projection.name)return f.projMatrix;const p=l.clone();return p.setProjection(n.projection),Ts(p,n.getProjection(),f)}function eh(f,n,l){return n.name===l.projection.name?f.projMatrix:Ts(l,n,f)}class Es{constructor(n,l,p,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Fa{constructor(n,l,p,y,v,S=!1){this.text=new Es(n?n.text:null,l,p,v),this.icon=new Es(n?n.icon:null,l,y,v),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fu{constructor(n,l,p,y=!1){this.text=n,this.icon=l,this.skipFade=p,this.clipped=y}}class _c{constructor(){this.invProjMatrix=o.ab.mat4.create(),this.viewportMatrix=o.ab.mat4.create(),this.circles=[]}}class n2{constructor(n,l,p,y,v){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=v}}class ja{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[n]}}function gv(f,n,l,p,y){const{horizontalAlign:v,verticalAlign:S}=o.bD(f),A=-(v-.5)*n,D=-(S-.5)*l,N=o.bC(f,p);return new o.P(A+N[0]*y,D+N[1]*y)}function qf(f,n,l,p,y){const v=new o.P(f,n);return l&&v._rotate(p?y:-y),v}class qo{constructor(n,l,p,y,v,S){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new qs(this.transform,v),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ja(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,p,y,v=1){const S=p.getBucket(l),A=p.latestFeatureIndex;if(!S||!A||l.fqid!==S.layerIds[0])return;const D=S.layers[0].layout,N=S.layers[0].paint,j=p.collisionBoxArray,$=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/o.ag,q=p.tileID.toUnwrapped();this.transform.setProjection(S.projection);const ie=(ne=p.tileID,le=S.getProjection(),ce=this.transform,le.name===this.projection?ce.calculateProjMatrix(ne.toUnwrapped()):Ts(ce,le,ne));var ne,le,ce;const fe=D.get("text-pitch-alignment")==="map",ve=D.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const _e=l.dynamicFilter(),Te=l.dynamicFilterNeedsFeature(),we=this.transform.calculatePixelsToTileUnitsMatrix(p),Se=fc(ie,p.tileID.canonical,fe,ve,this.transform,S.getProjection(),we);let be=null;if(fe){const Pt=uo(ie,p.tileID.canonical,fe,ve,this.transform,S.getProjection(),we);be=o.ab.mat4.multiply([],this.transform.labelPlaneMatrix,Pt)}let ke=null;_e&&p.latestFeatureIndex&&(ke={unwrappedTileID:q,dynamicFilter:_e,dynamicFilterNeedsFeature:Te}),this.retainedQueryData[S.bucketInstanceId]=new n2(S.bucketInstanceId,A,S.sourceLayerIndex,S.index,p.tileID);const[ze,tt]=S.layers[0].layout.get("text-size-scale-range"),Xe=o.aw(v,ze,tt),[Oe,$e]=D.get("icon-size-scale-range"),ht=o.aw(v,Oe,$e),xt={bucket:S,layout:D,paint:N,posMatrix:ie,textLabelPlaneMatrix:Se,labelToScreenMatrix:be,clippingData:ke,scale:$,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:o.bp(S.textSizeData,this.transform.zoom,Xe),partiallyEvaluatedIconSize:o.bp(S.iconSizeData,this.transform.zoom,ht),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(const Pt of S.sortKeyRanges){const{sortKey:Ye,symbolInstanceStart:mt,symbolInstanceEnd:ot}=Pt;n.push({sortKey:Ye,symbolInstanceStart:mt,symbolInstanceEnd:ot,parameters:xt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:xt})}attemptAnchorPlacement(n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le,ce,fe){const{textOffset0:ve,textOffset1:_e,crossTileID:Te}=V,we=[ve,_e],Se=gv(n,p,y,we,v),be=this.collisionIndex.placeCollisionBox(ie,v,l,qf(Se.x,Se.y,S,A,this.transform.angle),$,D,N,j.predicate);if(le){const ke=ie.getSymbolInstanceIconSize(fe,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,ke,le,qf(Se.x,Se.y,S,A,this.transform.angle),$,D,N,j.predicate).box.length===0)return}if(be.box.length>0){let ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(ke=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:we,width:p,height:y,anchor:n,textScale:v,prevAnchor:ke},this.markUsedJustification(ie,n,V,ne),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ne,V),this.placedOrientations[Te]=ne),{shift:Se,placedGlyphBoxes:be}}}placeLayerBucketPart(n,l,p,y,v=1){const{bucket:S,layout:A,paint:D,posMatrix:N,textLabelPlaneMatrix:j,labelToScreenMatrix:$,clippingData:V,textPixelRatio:q,holdingForFade:ie,collisionBoxArray:ne,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:ce,collisionGroup:fe,latestFeatureIndex:ve}=n.parameters,_e=A.get("text-optional"),Te=A.get("icon-optional"),we=A.get("text-allow-overlap"),Se=A.get("icon-allow-overlap"),be=A.get("text-rotation-alignment")==="map",ke=A.get("text-pitch-alignment")==="map",ze=A.get("symbol-z-elevate"),tt=D.get("symbol-z-offset"),Xe=A.get("symbol-elevation-reference")==="sea",[Oe,$e]=A.get("text-size-scale-range"),[ht,xt]=A.get("icon-size-scale-range"),Pt=o.aw(v,Oe,$e),Ye=o.aw(v,ht,xt);this.transform.setProjection(S.projection);let mt=we&&(Se||!S.hasIconData()||Te),ot=Se&&(we||!S.hasTextData()||_e);const Tt=!tt.isConstant();!S.collisionArrays&&ne&&S.deserializeCollisionBoxes(ne),p&&y&&S.updateCollisionDebugBuffers(this.transform.zoom,ne,Pt,Ye);const gt=(ft,zt,Ft)=>{const{crossTileID:Dt,numVerticalGlyphVertices:$t}=ft;let vr=null;if(V&&V.dynamicFilterNeedsFeature||Tt){const Nn=this.retainedQueryData[S.bucketInstanceId];vr=ve.loadFeature({featureIndex:ft.featureIndex,bucketIndex:Nn.bucketIndex,sourceLayerIndex:Nn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},vr,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new o.P(ft.tileAnchorX,ft.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[Dt]=new fu(!1,!1,!1,!0),void l.add(Dt);const lr=tt.evaluate(vr,{});if(l.has(Dt))return;if(ie)return void(this.placements[Dt]=new fu(!1,!1,!1));let ar=!1,xr=!1,$r=!0,Rr=!1,Bn=!1,Pn=null,an={box:null,offscreen:null,occluded:null},yn={box:null,offscreen:null,occluded:null},Dr=null,Gr=null,hr=null,en=0,Kn=0,Gi=0;Ft.textFeatureIndex?en=Ft.textFeatureIndex:ft.useRuntimeCollisionCircles&&(en=ft.featureIndex),Ft.verticalTextFeatureIndex&&(Kn=Ft.verticalTextFeatureIndex);const Qo=Nn=>{Nn.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Tn=this.transform.elevation;Nn.elevation=Xe?lr:lr+(Tn?Tn.getAtTileOffset(Nn.tileID,Nn.tileAnchorX,Nn.tileAnchorY):0),Nn.elevation+=ft.zOffset},po=Ft.textBox;if(po){Qo(po);const Nn=qr=>{let ni=o.bq.horizontal;if(S.allowVerticalPlacement&&!qr&&this.prevPlacement){const Ri=this.prevPlacement.placedOrientations[Dt];Ri&&(this.placedOrientations[Dt]=Ri,ni=Ri,this.markUsedOrientation(S,ni,ft))}return ni},Tn=(qr,ni)=>{if(S.allowVerticalPlacement&&$t>0&&Ft.verticalTextBox){for(const Ri of S.writingModes)if(Ri===o.bq.vertical?(an=ni(),yn=an):an=qr(),an&&an.box&&an.box.length)break}else an=qr()};if(A.get("text-variable-anchor")){let qr=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Dt]){const An=this.prevPlacement.variableOffsets[Dt];qr.indexOf(An.anchor)>0&&(qr=qr.filter(io=>io!==An.anchor),qr.unshift(An.anchor))}const ni=(An,io,ls)=>{const Fo=S.getSymbolInstanceTextSize(le,ft,this.transform.zoom,zt),Xa=(An.x2-An.x1)*Fo+2*An.padding,va=(An.y2-An.y1)*Fo+2*An.padding,mo=ft.hasIconTextFit&&!Se?io:null;mo&&Qo(mo);let cs={box:[],offscreen:!1,occluded:!1};const Ka=we?2*qr.length:qr.length;for(let Qs=0;Qs<Ka;++Qs){const kc=this.attemptAnchorPlacement(qr[Qs%qr.length],An,Xa,va,Fo,be,ke,q,N,fe,Qs>=qr.length,ft,zt,S,ls,mo,le,ce);if(kc&&(cs=kc.placedGlyphBoxes,cs&&cs.box&&cs.box.length)){ar=!0,Pn=kc.shift;break}}return cs};Tn(()=>ni(po,Ft.iconBox,o.bq.horizontal),()=>{const An=Ft.verticalTextBox;return An&&Qo(An),S.allowVerticalPlacement&&!(an&&an.box&&an.box.length)&&$t>0&&An?ni(An,Ft.verticalIconBox,o.bq.vertical):{box:null,offscreen:null,occluded:null}}),an&&(ar=an.box,$r=an.offscreen,Rr=an.occluded);const Ri=Nn(!(!an||!an.box));if(!ar&&this.prevPlacement){const An=this.prevPlacement.variableOffsets[Dt];An&&(this.variableOffsets[Dt]=An,this.markUsedJustification(S,An.anchor,ft,Ri))}}else{const qr=(ni,Ri)=>{const An=S.getSymbolInstanceTextSize(le,ft,this.transform.zoom,zt,v),io=this.collisionIndex.placeCollisionBox(S,An,ni,new o.P(0,0),we,q,N,fe.predicate);return io&&io.box&&io.box.length&&(this.markUsedOrientation(S,Ri,ft),this.placedOrientations[Dt]=Ri),io};Tn(()=>qr(po,o.bq.horizontal),()=>{const ni=Ft.verticalTextBox;return S.allowVerticalPlacement&&$t>0&&ni?(Qo(ni),qr(ni,o.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Nn(!!(an&&an.box&&an.box.length))}}if(Dr=an,ar=Dr&&Dr.box&&Dr.box.length>0,$r=Dr&&Dr.offscreen,Rr=Dr&&Dr.occluded,ft.useRuntimeCollisionCircles){const Nn=S.text.placedSymbolArray.get(ft.centerJustifiedTextSymbolIndex>=0?ft.centerJustifiedTextSymbolIndex:ft.verticalPlacedTextSymbolIndex),Tn=o.br(S.textSizeData,le,Nn),qr=A.get("text-padding");Gr=this.collisionIndex.placeCollisionCircles(S,we,Nn,S.lineVertexArray,S.glyphOffsetArray,Tn,N,j,$,p,ke,fe.predicate,ft.collisionCircleDiameter*Tn/o.bw,qr,this.retainedQueryData[S.bucketInstanceId].tileID),ar=we||Gr.circles.length>0&&!Gr.collisionDetected,$r=$r&&Gr.offscreen,Rr=Gr.occluded}if(Ft.iconFeatureIndex&&(Gi=Ft.iconFeatureIndex),Ft.iconBox){const Nn=Tn=>{Qo(Tn);const qr=ft.hasIconTextFit&&Pn?qf(Pn.x,Pn.y,be,ke,this.transform.angle):new o.P(0,0),ni=S.getSymbolInstanceIconSize(ce,this.transform.zoom,ft.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,ni,Tn,qr,Se,q,N,fe.predicate)};yn&&yn.box&&yn.box.length&&Ft.verticalIconBox?(hr=Nn(Ft.verticalIconBox),xr=hr.box.length>0):(hr=Nn(Ft.iconBox),xr=hr.box.length>0),$r=$r&&hr.offscreen,Bn=hr.occluded}const ki=_e||ft.numHorizontalGlyphVertices===0&&$t===0,mi=Te||ft.numIconVertices===0;if(ki||mi?mi?ki||(xr=xr&&ar):ar=xr&&ar:xr=ar=xr&&ar,ar&&Dr&&Dr.box&&this.collisionIndex.insertCollisionBox(Dr.box,A.get("text-ignore-placement"),S.bucketInstanceId,yn&&yn.box&&Kn?Kn:en,fe.ID),xr&&hr&&this.collisionIndex.insertCollisionBox(hr.box,A.get("icon-ignore-placement"),S.bucketInstanceId,Gi,fe.ID),Gr&&(ar&&this.collisionIndex.insertCollisionCircles(Gr.circles,A.get("text-ignore-placement"),S.bucketInstanceId,en,fe.ID),p)){const Nn=S.bucketInstanceId;let Tn=this.collisionCircleArrays[Nn];Tn===void 0&&(Tn=this.collisionCircleArrays[Nn]=new _c);for(let qr=0;qr<Gr.circles.length;qr+=4)Tn.circles.push(Gr.circles[qr+0]),Tn.circles.push(Gr.circles[qr+1]),Tn.circles.push(Gr.circles[qr+2]),Tn.circles.push(Gr.collisionDetected?1:0)}const oi=S.projection.name!=="globe";mt=mt&&(oi||!Rr),ot=ot&&(oi||!Bn),this.placements[Dt]=new fu(ar||mt,xr||ot,$r||S.justReloaded),l.add(Dt)};if(ze&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.updateZOffset()),S.sortFeaturesByY){const ft=S.getSortedSymbolIndexes(this.transform.angle);for(let zt=ft.length-1;zt>=0;--zt){const Ft=ft[zt];gt(S.symbolInstances.get(Ft),Ft,S.collisionArrays[Ft])}S.hasAnyZOffset&&o.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const ft=S.getSortedIndexesByZOffset();for(let zt=0;zt<ft.length;++zt){const Ft=ft[zt];gt(S.symbolInstances.get(Ft),Ft,S.collisionArrays[Ft])}}else for(let ft=n.symbolInstanceStart;ft<n.symbolInstanceEnd;ft++)gt(S.symbolInstances.get(ft),ft,S.collisionArrays[ft]);if(p&&S.bucketInstanceId in this.collisionCircleArrays){const ft=this.collisionCircleArrays[S.bucketInstanceId];o.ab.mat4.invert(ft.invProjMatrix,N),ft.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(n,l,p,y){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:D,crossTileID:N}=p,j=o.bB(l),$=y===o.bq.vertical?D:j==="left"?v:j==="center"?S:j==="right"?A:-1;v>=0&&(n.text.placedSymbolArray.get(v).crossTileID=$>=0&&v!==$?0:N),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=$>=0&&S!==$?0:N),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=$>=0&&A!==$?0:N),D>=0&&(n.text.placedSymbolArray.get(D).crossTileID=$>=0&&D!==$?0:N)}markUsedOrientation(n,l,p){const y=l===o.bq.horizontal||l===o.bq.horizontalOnly?l:0,v=l===o.bq.vertical?l:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:N}=p,j=n.text.placedSymbolArray;S>=0&&(j.get(S).placedOrientation=y),A>=0&&(j.get(A).placedOrientation=y),D>=0&&(j.get(D).placedOrientation=y),N>=0&&(j.get(N).placedOrientation=v)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const y=l?l.symbolFadeChange(n):1,v=l?l.opacities:{},S=l?l.variableOffsets:{},A=l?l.placedOrientations:{};for(const D in this.placements){const N=this.placements[D],j=v[D];j?(this.opacities[D]=new Fa(j,y,N.text,N.icon,null,N.clipped),p=p||N.text!==j.text.placed||N.icon!==j.icon.placed):(this.opacities[D]=new Fa(null,y,N.text,N.icon,N.skipFade,N.clipped),p=p||N.text||N.icon)}for(const D in v){const N=v[D];if(!this.opacities[D]){const j=new Fa(N,y,!1,!1);j.isHidden()||(this.opacities[D]=j,p=p||N.text.placed||N.icon.placed)}}for(const D in S)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=S[D]);for(const D in A)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=A[D]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l,p,y){const v=new Set;for(const S of l){const A=S.getBucket(n);A&&S.latestFeatureIndex&&n.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,v,S,S.collisionBoxArray,p,y,S.tileID,n.scope),A.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,S.tileID),A.updateZOffset()))}}updateBucketOpacities(n,l,p,y,v,S,A,D){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const N=n.layers[0].layout,j=n.layers[0].paint,$=!!n.layers[0].dynamicFilter(),V=new Fa(null,0,!1,!1,!0),q=N.get("text-allow-overlap"),ie=N.get("icon-allow-overlap"),ne=N.get("text-variable-anchor"),le=N.get("text-rotation-alignment")==="map",ce=N.get("text-pitch-alignment")==="map",fe=j.get("symbol-z-offset"),ve=N.get("symbol-elevation-reference")==="sea",_e=!fe.isConstant(),Te=new Fa(null,0,q&&(ie||!n.hasIconData()||N.get("icon-optional")),ie&&(q||!n.hasTextData()||N.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const we=(be,ke,ze)=>{for(let tt=0;tt<ke/4;tt++)be.opacityVertexArray.emplaceBack(ze)};let Se=0;S&&n.updateReplacement(A,S);for(let be=0;be<n.symbolInstances.length;be++){const ke=n.symbolInstances.get(be),{numHorizontalGlyphVertices:ze,numVerticalGlyphVertices:tt,crossTileID:Xe,numIconVertices:Oe,tileAnchorX:$e,tileAnchorY:ht}=ke;let xt=null;const Pt=this.retainedQueryData[n.bucketInstanceId];_e&&ke&&Pt&&(xt=p.latestFeatureIndex.loadFeature({featureIndex:ke.featureIndex,bucketIndex:Pt.bucketIndex,sourceLayerIndex:Pt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ye=fe.evaluate(xt,{}),mt=l.has(Xe);let ot=this.opacities[Xe];mt?ot=V:ot||(ot=Te,this.opacities[Xe]=ot),l.add(Xe);const Tt=ze>0||tt>0,gt=Oe>0,ft=this.placedOrientations[Xe],zt=ft===o.bq.vertical,Ft=ft===o.bq.horizontal||ft===o.bq.horizontalOnly;!Tt&&!gt||ot.isHidden()||Se++;let Dt=!1;if((Tt||gt)&&S)for(const $t of n.activeReplacements){if(o.bx($t,v,o.by.Symbol,D)||$t.min.x>$e||$e>$t.max.x||$t.min.y>ht||ht>$t.max.y)continue;const vr=o.bz($e,ht,A.canonical,$t.footprintTileId.canonical);if(Dt=o.bA(vr,$t.footprint),Dt)break}if(Tt){const $t=Dt?Ws:yv(ot.text);we(n.text,ze,zt?Ws:$t),we(n.text,tt,Ft?Ws:$t);const vr=ot.text.isHidden(),{leftJustifiedTextSymbolIndex:lr,centerJustifiedTextSymbolIndex:ar,rightJustifiedTextSymbolIndex:xr,verticalPlacedTextSymbolIndex:$r}=ke,Rr=n.text.placedSymbolArray,Bn=vr||zt?1:0;lr>=0&&(Rr.get(lr).hidden=Bn),ar>=0&&(Rr.get(ar).hidden=Bn),xr>=0&&(Rr.get(xr).hidden=Bn),$r>=0&&(Rr.get($r).hidden=vr||Ft?1:0);const Pn=this.variableOffsets[Xe];Pn&&this.markUsedJustification(n,Pn.anchor,ke,ft);const an=this.placedOrientations[Xe];an&&(this.markUsedJustification(n,"left",ke,an),this.markUsedOrientation(n,an,ke))}if(gt){const $t=Dt?Ws:yv(ot.icon),{placedIconSymbolIndex:vr,verticalPlacedIconSymbolIndex:lr}=ke,ar=n.icon.placedSymbolArray,xr=ot.icon.isHidden()?1:0;vr>=0&&(we(n.icon,Oe,zt?Ws:$t),ar.get(vr).hidden=xr),lr>=0&&(we(n.icon,ke.numVerticalIconVertices,Ft?Ws:$t),ar.get(lr).hidden=xr)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const $t=n.collisionArrays[be];if($t){let vr=new o.P(0,0),lr=!0;if($t.textBox||$t.verticalTextBox){if(ne){const xr=this.variableOffsets[Xe];xr?(vr=gv(xr.anchor,xr.width,xr.height,xr.textOffset,xr.textScale),le&&vr._rotate(ce?this.transform.angle:-this.transform.angle)):lr=!1}$&&(lr=!ot.clipped),$t.textBox&&Wf(n.textCollisionBox.collisionVertexArray,ot.text.placed,!lr||zt,Ye,ve,vr.x,vr.y),$t.verticalTextBox&&Wf(n.textCollisionBox.collisionVertexArray,ot.text.placed,!lr||Ft,Ye,ve,vr.x,vr.y)}const ar=lr&&!!(!Ft&&$t.verticalIconBox);$t.iconBox&&Wf(n.iconCollisionBox.collisionVertexArray,ot.icon.placed,ar,Ye,ve,ke.hasIconTextFit?vr.x:0,ke.hasIconTextFit?vr.y:0),$t.verticalIconBox&&Wf(n.iconCollisionBox.collisionVertexArray,ot.icon.placed,!ar,Ye,ve,ke.hasIconTextFit?vr.x:0,ke.hasIconTextFit?vr.y:0)}}}if(n.fullyClipped=Se===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=be.invProjMatrix,n.placementViewportMatrix=be.viewportMatrix,n.collisionCircleArray=be.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function Wf(f,n,l,p,y,v,S){f.emplaceBack(n?1:0,l?1:0,v||0,S||0,p,y?1:0),f.emplaceBack(n?1:0,l?1:0,v||0,S||0,p,y?1:0),f.emplaceBack(n?1:0,l?1:0,v||0,S||0,p,y?1:0),f.emplaceBack(n?1:0,l?1:0,v||0,S||0,p,y?1:0)}const Zf=Math.pow(2,25),_v=Math.pow(2,24),th=Math.pow(2,17),i2=Math.pow(2,16),o2=Math.pow(2,9),rh=Math.pow(2,8),nh=Math.pow(2,1);function yv(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,l=Math.floor(127*f.opacity);return l*Zf+n*_v+l*th+n*i2+l*o2+n*rh+l*nh+n}const Ws=0;class vv{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,l,p,y,v,S){const A=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(A,y,n[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((D,N)=>D.sortKey-N.sortKey));this._currentPartIndex<A.length;){const D=A[this._currentPartIndex];if(l.placeLayerBucketPart(D,this._seenCrossTileIDs,p,D.symbolInstanceStart===0,S),this._currentPartIndex++,v())return!0}return!1}}class Yf{constructor(n,l,p,y,v,S,A,D,N){this.placement=new qo(n,v,S,A,D,N),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,l,p,y,v){const S=o.q.now(),A=()=>{const D=o.q.now()-S;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=l[n[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=N)&&(!D.maxzoom||D.maxzoom>N)){const j=D,$=j.layout.get("symbol-z-elevate"),V=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=j.layout.get("symbol-z-order"),ie=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&V),ne=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),le=ie&&ne,ce=this._inProgressLayer=this._inProgressLayer||new vv(j),fe=o.aC(D.source,D.scope);if(ce.continuePlacement($||le?y[fe]:p[fe],this.placement,this._showCollisionBoxes,D,A,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const ga=512/o.ag/2;class s2{constructor(n,l,p){this.tileID=n,this.bucketInstanceId=p,this.index=new o.bE(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*o.ag,v=n.canonical.y*o.ag;for(let S=0;S<l.length;S++){const{key:A,crossTileID:D,tileAnchorX:N,tileAnchorY:j}=l.get(S),$=Math.floor((y+N)*ga),V=Math.floor((v+j)*ga);this.index.add($,V),this.keys.push(A),this.crossTileIDs.push(D)}this.index.finish()}findMatches(n,l,p){const y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=ga/Math.pow(2,l.canonical.z-this.tileID.canonical.z),S=l.canonical.x*o.ag,A=l.canonical.y*o.ag;for(let D=0;D<n.length;D++){const N=n.get(D);if(N.crossTileID)continue;const{key:j,tileAnchorX:$,tileAnchorY:V}=N,q=Math.floor((S+$)*v),ie=Math.floor((A+V)*v),ne=this.index.range(q-y,ie-y,q+y,ie+y);for(const le of ne){const ce=this.crossTileIDs[le];if(this.keys[le]===j&&!p.has(ce)){p.add(ce),N.crossTileID=ce;break}}}}}class a2{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class l2{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const p in this.indexes){const y=this.indexes[p],v={};for(const S in y){const A=y[S];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+l),v[A.tileID.key]=A}this.indexes[p]=v}this.lng=n}addBucket(n,l,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>n.overscaledZ)for(const A in S){const D=S[A];D.tileID.isChildOf(n)&&D.findMatches(l.symbolInstances,n,y)}else{const A=S[n.scaledTo(Number(v)).key];A&&A.findMatches(l.symbolInstances,n,y)}}for(let v=0;v<l.symbolInstances.length;v++){const S=l.symbolInstances.get(v);S.crossTileID||(S.crossTileID=p.generate(),y.add(S.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new s2(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const p of l.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let l=!1;for(const p in this.indexes){const y=this.indexes[p];for(const v in y)n[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[v]),delete y[v],l=!0)}return l}}class xv{constructor(){this.layerIndexes={},this.crossTileIDs=new a2,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,p,y){let v=this.layerIndexes[n.fqid];v===void 0&&(v=this.layerIndexes[n.fqid]=new l2);let S=!1;const A={};y.name!=="globe"&&v.handleWrapJump(p);for(const D of l){const N=D.getBucket(n);N&&n.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,N,this.crossTileIDs)&&(S=!0),A[N.bucketInstanceId]=!0)}return v.removeStaleBuckets(A)&&(S=!0),S}pruneUnusedLayers(n){const l={};n.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const pu=771;class Or{constructor(n,l,p,y){this.blendFunction=n,this.blendColor=l,this.mask=p,this.blendEquation=y}}Or.Replace=[1,0,1,0],Or.disabled=new Or(Or.Replace,o.aj.transparent,[!1,!1,!1,!1]),Or.unblended=new Or(Or.Replace,o.aj.transparent,[!0,!0,!0,!0]),Or.alphaBlended=new Or([1,pu,1,pu],o.aj.transparent,[!0,!0,!0,!0]),Or.alphaBlendedNonPremultiplied=new Or([770,pu,770,pu],o.aj.transparent,[!0,!0,!0,!0]),Or.multiply=new Or([774,0,774,0],o.aj.transparent,[!0,!0,!0,!0]);class sr{constructor(n,l,p){this.func=n,this.mask=l,this.range=p}}sr.ReadOnly=!1,sr.ReadWrite=!0,sr.disabled=new sr(519,sr.ReadOnly,[0,1]);const Xf=7680;class Er{constructor(n,l,p,y,v,S){this.test=n,this.ref=l,this.mask=p,this.fail=y,this.depthFail=v,this.pass=S}}Er.disabled=new Er({func:519,mask:0},0,0,Xf,Xf,Xf);const Kf=1029,Ba=2305;class mr{constructor(n,l,p){this.enable=n,this.mode=l,this.frontFace=p}}function Ug(f,n){const l=o.bG(f,3);o.ab.mat4.fromQuat(f,n),o.bI(f,3,l)}function Jf(f,n){const l=o.ab.quat.identity([]);return o.ab.quat.rotateZ(l,l,-n),o.ab.quat.rotateX(l,l,-f),l}function mu(f,n){const l=[f[0],f[1],0],p=[n[0],n[1],0];if(o.ab.vec3.length(l)>=1e-15){const S=o.ab.vec3.normalize([],l);o.ab.vec3.scale(p,S,o.ab.vec3.dot(p,S)),n[0]=p[0],n[1]=p[1]}const y=o.ab.vec3.cross([],n,f);if(o.ab.vec3.len(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return Jf(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}mr.disabled=new mr(!1,Kf,Ba),mr.backCCW=new mr(!0,Kf,Ba),mr.backCW=new mr(!0,Kf,2304),mr.frontCW=new mr(!0,1028,2304),mr.frontCCW=new mr(!0,1028,Ba);class gu{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof o.aa?n:new o.aa(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=o.bF(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const p=this.position,y=this._elevation?this._elevation.getAtPointOrZero(o.aa.fromLngLat(n)):0,v=o.aa.fromLngLat(n,y),S=[v.x-p.x,v.y-p.y,v.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=mu(S,l)}setPitchBearing(n,l){this.orientation=Jf(o.ai(n),o.ai(-l))}}class ih{constructor(n,l){this._transform=o.ab.mat4.identity([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new o.aa(n[0],n[1],n[2])}get position(){const n=o.bG(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&o.bI(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.ab.quat.identity([]),n&&Ug(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=Jf(n,l),Ug(this._transform,this._orientation)}forward(){const n=o.bG(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.bG(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.bG(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const p=new Float64Array(16);return o.ab.mat4.invert(p,this.getWorldToCamera(n,l)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,l,p){const y=this.position;o.ab.vec3.scale(y,y,-n);const v=new Float64Array(16);return o.ab.mat4.fromScaling(v,[p,p,p]),o.ab.mat4.translate(v,v,y),v[10]*=l,v}getWorldToCamera(n,l){const p=new Float64Array(16),y=new Float64Array(4),v=this.position;return o.ab.quat.conjugate(y,this._orientation),o.ab.vec3.scale(v,v,-n),o.ab.mat4.fromQuat(p,y),o.ab.mat4.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(n,l,p,y){const v=new Float64Array(16);return o.ab.mat4.perspective(v,n,l,p,y),v}getCameraToClipOrthographic(n,l,p,y,v,S){const A=new Float64Array(16);return o.ab.mat4.ortho(A,n,l,p,y,v,S),A}getDistanceToElevation(n,l=!1){const p=n===0?0:o.bH(n,l?o.aS(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new ih([...this.position],[...this.orientation])}}const to={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Wo{constructor(n=0,l=0,p=0,y=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=p,this.right=y}interpolate(n,l,p){return l.top!=null&&n.top!=null&&(this.top=o.af(n.top,l.top,p)),l.bottom!=null&&n.bottom!=null&&(this.bottom=o.af(n.bottom,l.bottom,p)),l.left!=null&&n.left!=null&&(this.left=o.af(n.left,l.left,p)),l.right!=null&&n.right!=null&&(this.right=o.af(n.right,l.right,p)),this}getCenter(n,l){const p=o.aw((this.left+n-this.right)/2,0,n),y=o.aw((this.top+l-this.bottom)/2,0,l);return new o.P(p,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Wo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Qf=(f,n,l)=>(1-l)*f+l*n,Lt=f=>f*f*f*f*f;class ep{constructor(n,l,p,y,v,S,A){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(S),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new o.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ih,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new ep(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.ay(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.bP(this.projectionOptions);const p=this.getProjection(),y=!o.bn(l,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bP({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bF(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=o.ab.mat2.create(),o.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=o.aw(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.ai(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,v=0;for(let S=0;S<l.length;S++){const A=new o.P(l[S][0]*this.width,p+l[S][1]*(this.height-p)),D=n.pointCoordinate(A);if(!D)continue;const N=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);y+=D[3]*N,v+=N}return v===0?NaN:y/v}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,y=this._mercatorZfromZoom(n),v=this._mercatorZfromZoom(this._maxZoom),S=Math.max(y-p,v);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const y=o.ab.vec3.length(o.ab.vec3.sub([],this._camera.position,p));return o.aw(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!o.ab.quat.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];o.ab.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new gu;return l.position=new o.aa(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!o.ab.quat.length(n))return!1;o.ab.quat.normalize(n,n);const l=o.ab.vec3.transformQuat([],[0,0,-1],n),p=o.ab.vec3.transformQuat([],[0,-1,0],n);if(p[2]<0)return!1;const y=mu(l,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=o.aw(n[2],y/p,y/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,p){this._unmodified=!1,this._edgeInsets.interpolate(n,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new o.bQ(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.P(0,0)),y=this.pointCoordinate(new o.P(this.width,0)),v=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),A=Math.floor(Math.min(p.x,y.x,v.x,S.x)),D=Math.floor(Math.max(p.x,y.x,v.x,S.x)),N=1;for(let j=A-N;j<=D+N;j++)j!==0&&l.push(new o.bQ(j,n))}return l}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,l,p){let y=[];const v=p!==void 0,S=!v;if(S&&this.zoom<l||v&&p[0]===0&&p[1]===0)return y;const A=new Set,D=(j,$,V,q,ie)=>{const ne=o.c5($,j,V,q,ie);A.has(ne)||(y.push(new o.aG(j,$,V,q,ie)),A.add(ne))};for(let j=0;j<n.length;j++){const $=n[j];if(S&&$.canonical.z!==l)continue;const V=$.canonical,q=$.overscaledZ,ie=$.wrap,ne=1<<V.z,le=V.x+1<ne,ce=V.x>0,fe=V.y+1<ne,ve=V.y>0,_e=$.wrap-(ce?0:1),Te=$.wrap+(le?0:1),we=ce?V.x-1:ne-1,Se=le?V.x+1:0;if(v)p[0]<0?(D(q,Te,V.z,Se,V.y),p[1]<0&&fe&&(D(q,ie,V.z,V.x,V.y+1),D(q,Te,V.z,Se,V.y+1)),p[1]>0&&ve&&(D(q,ie,V.z,V.x,V.y-1),D(q,Te,V.z,Se,V.y-1))):p[0]>0?(D(q,_e,V.z,we,V.y),p[1]<0&&fe&&(D(q,ie,V.z,V.x,V.y+1),D(q,_e,V.z,we,V.y+1)),p[1]>0&&ve&&(D(q,ie,V.z,V.x,V.y-1),D(q,_e,V.z,we,V.y-1))):p[1]<0&&fe?D(q,ie,V.z,V.x,V.y+1):ve&&D(q,ie,V.z,V.x,V.y-1);else{const be=$.visibleQuadrants;1&be&&(D(q,_e,V.z,we,V.y),ve&&(D(q,ie,V.z,V.x,V.y-1),D(q,_e,V.z,we,V.y-1))),2&be&&(D(q,Te,V.z,Se,V.y),ve&&(D(q,ie,V.z,V.x,V.y-1),D(q,Te,V.z,Se,V.y-1))),4&be&&(D(q,_e,V.z,we,V.y),fe&&(D(q,ie,V.z,V.x,V.y+1),D(q,_e,V.z,we,V.y+1))),8&be&&(D(q,Te,V.z,Se,V.y),fe&&(D(q,ie,V.z,V.x,V.y+1),D(q,Te,V.z,Se,V.y+1)))}}const N=[];for(const j of y)y.some($=>j.isChildOf($))||N.push(j);if(y=N.filter(j=>!n.some($=>!!(j.overscaledZ<l&&$.isChildOf(j))||j.equals($)||j.isChildOf($))),S){const j=1<<l,$=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[j*$.x,j*$.y],q=4,ie=q*q;y=y.filter(ne=>{const le=ne.canonical.x+.5-V[0],ce=ne.canonical.y+.5-V[1];return le*le+ce*ce<ie})}return y}coveringTiles(n){let l=this.coveringZoomLevel(n);const p=l,y=this.elevation&&this.elevation.exaggeration(),v=y&&!n.isTerrainDEM,S=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const A=this.locationCoordinate(this.center),D=this.center.lat,N=1<<l,j=[N*A.x,N*A.y,0],$=this.projection.name==="globe",V=!$,q=o.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,V),ie=$?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ne=N*o.bH(1,this.center.lat),le=this._camera.position[2]/o.bH(1,this.center.lat),ce=[N*ie.x,N*ie.y,le*(V?1:ne)],fe=$||y,ve=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),_e=this.isLODDisabled(!0)?l:0;let Te;if(this._elevation&&n.isTerrainDEM)Te=1e4*this._elevation.exaggeration();else if(this._elevation){const Ye=this._elevation.getMinMaxForVisibleTiles();Te=Ye?Ye.max:this._centerAltitude}else Te=this._centerAltitude;const we=n.isTerrainDEM?-Te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?o.bS(this):1,be=Ye=>{const ot=new o.aa(Ye.x+25e-6,Ye.y,Ye.z),Tt=new o.aa(Ye.x,Ye.y+25e-6,Ye.z),gt=Ye.toLngLat(),ft=ot.toLngLat(),zt=Tt.toLngLat(),Ft=this.locationCoordinate(gt),Dt=this.locationCoordinate(ft),$t=this.locationCoordinate(zt),vr=Math.hypot(Dt.x-Ft.x,Dt.y-Ft.y),lr=Math.hypot($t.x-Ft.x,$t.y-Ft.y);return Math.sqrt(vr*lr)*Se/25e-6},ke=Ye=>{const mt=Te,ot=we;return{aabb:o.bV(this,N,0,0,0,Ye,ot,mt,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:mt,wrap:Ye,fullyVisible:!1}},ze=[];let tt=[];const Xe=l,Oe=n.reparseOverscaled?p:l,$e=(le-this._centerAltitude)*ne,ht=Ye=>{if(!this._elevation||!Ye.tileID||!S)return;const mt=this._elevation.getMinMaxForTile(Ye.tileID),ot=Ye.aabb;mt?(ot.min[2]=mt.min,ot.max[2]=mt.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(Ye.shouldSplit=Pt(Ye),Ye.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},xt=(Ye,mt)=>{if(.707*mt<Ye)return 1;const ot=mt/Ye;return ot/(1.4144271570014144+(Math.pow(1.1,ot-1.4144271570014144+1)-1)/(1.1-1)-1)},Pt=Ye=>{if(Ye.zoom<_e)return!0;if(Ye.zoom===Xe)return!1;if(Ye.shouldSplit!=null)return Ye.shouldSplit;const mt=Ye.aabb.distanceX(ce),ot=Ye.aabb.distanceY(ce);let Tt=$e,gt=1;if($){Tt=Ye.aabb.distanceZ(ce);const lr=Math.pow(2,Ye.zoom),ar=o.aS((Ye.y+1)/lr),xr=o.aS(Ye.y/lr),$r=Math.min(Math.max(D,ar),xr),Rr=o.c9($r)/o.c9(D);if(gt=$r===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Rr/this._mercatorScaleRatio),this.zoom<=o.c6&&Ye.zoom===Xe-1&&Rr>=.9)return!0}else if(v&&(Tt=Ye.aabb.distanceZ(ce)*ne),this.projection.isReprojectedInTileSpace&&p<=5){const lr=Math.pow(2,Ye.zoom),ar=be(new o.aa((Ye.x+.5)/lr,(Ye.y+.5)/lr));gt=ar>.85?1:ar}if(!S){const lr=Math.sqrt(mt*mt+ot*ot+Tt*Tt);let ar=(1<<Xe-Ye.zoom)*ve*gt;return ar*=xt(Math.max(Tt,$e),lr),lr<ar}let ft=Number.MAX_VALUE,zt=0;const Ft=Ye.aabb.getCorners(),Dt=[];for(const lr of Ft){o.ab.vec3.sub(Dt,lr,ce),$||(v?Dt[2]*=ne:Dt[2]=$e);const ar=o.ab.vec3.dot(Dt,this._camera.forward());ar<ft&&(ft=ar,zt=Math.abs(Dt[2]))}let $t=(1<<Xe-Ye.zoom)*ve*gt;if($t*=xt(Math.max(zt,$e),ft),ft<$t)return!0;const vr=Ye.aabb.closestPoint(j);return vr[0]===j[0]&&vr[1]===j[1]};if(this.renderWorldCopies)for(let Ye=1;Ye<=3;Ye++)ze.push(ke(-Ye)),ze.push(ke(Ye));for(ze.push(ke(0));ze.length>0;){const Ye=ze.pop(),mt=Ye.x,ot=Ye.y;let Tt=Ye.fullyVisible;const gt=()=>this.projection.name==="globe"&&(Ye.y===0||Ye.y===(1<<Ye.zoom)-1);if(!Tt){let ft=fe?Ye.aabb.intersects(q):Ye.aabb.intersectsFlat(q);if(ft===0&&gt()){const zt=new o.bT(Ye.zoom,mt,ot);ft=o.bU(this,N,zt,!0).intersects(q)}if(ft===0)continue;Tt=ft===2}if(Ye.zoom!==Xe&&Pt(Ye))for(let ft=0;ft<4;ft++){const zt=(mt<<1)+ft%2,Ft=(ot<<1)+(ft>>1),Dt={aabb:S?Ye.aabb.quadrant(ft):o.bV(this,N,Ye.zoom+1,zt,Ft,Ye.wrap,Ye.minZ,Ye.maxZ,this.projection),zoom:Ye.zoom+1,x:zt,y:Ft,wrap:Ye.wrap,fullyVisible:Tt,tileID:void 0,shouldSplit:void 0,minZ:Ye.minZ,maxZ:Ye.maxZ};v&&!$&&(Dt.tileID=new o.aG(Ye.zoom+1===Xe?Oe:Ye.zoom+1,Ye.wrap,Ye.zoom+1,zt,Ft),ht(Dt)),ze.push(Dt)}else{const ft=Ye.zoom===Xe?Oe:Ye.zoom;if(n.minzoom&&n.minzoom>ft)continue;let zt=0;if(!Tt){let vr=fe?Ye.aabb.intersectsPrecise(q):Ye.aabb.intersectsPreciseFlat(q);if(vr===0&&gt()){const lr=new o.bT(Ye.zoom,mt,ot);vr=o.bU(this,N,lr,!0).intersectsPrecise(q)}if(vr===0)continue;if(n.calculateQuadrantVisibility)if(q.containsPoint(Ye.aabb.center))zt=15;else for(let lr=0;lr<4;lr++)Ye.aabb.quadrant(lr).intersects(q)!==0&&(zt|=1<<lr)}const Ft=j[0]-(.5+mt+(Ye.wrap<<Ye.zoom))*(1<<l-Ye.zoom),Dt=j[1]-.5-ot,$t=Ye.tileID?Ye.tileID:new o.aG(ft,Ye.wrap,Ye.zoom,mt,ot);n.calculateQuadrantVisibility&&($t.visibleQuadrants=zt),tt.push({tileID:$t,distanceSq:Ft*Ft+Dt*Dt})}}if(this.fogCullDistSq){const Ye=this.fogCullDistSq,mt=this.horizonLineFromTop();tt=tt.filter(ot=>{const Tt=[0,0,0,1],gt=[o.ag,o.ag,0,1],ft=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());o.ab.vec4.transformMat4(Tt,Tt,ft),o.ab.vec4.transformMat4(gt,gt,ft);const zt=o.ab.vec4.min([],Tt,gt),Ft=o.ab.vec4.max([],Tt,gt),Dt=o.bW(zt,Ft);if(Dt===0)return!0;let $t=!1;const vr=this._elevation;if(vr&&Dt>Ye&&mt!==0){const lr=this.calculateProjMatrix(ot.tileID.toUnwrapped());let ar;n.isTerrainDEM||(ar=vr.getMinMaxForTile(ot.tileID)),ar||(ar={min:we,max:Te});const xr=o.c7(this.rotation),$r=[xr[0]*o.ag,xr[1]*o.ag,ar.max];o.ab.vec3.transformMat4($r,$r,lr),$t=(1-$r[1])*this.height*.5<mt}return Dt<Ye||$t})}return tt.sort((Ye,mt)=>Ye.distanceSq-mt.distanceSq).map(Ye=>Ye.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=o.aw(n.lat,-o.bX,o.bX),p=this.projection.project(n.lng,l);return new o.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let p,y;const v=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;p=(l.x-v.x)/A,y=(l.y-v.y)/A}else{const A=this.pointCoordinate(l),D=this.pointCoordinate(v);p=A.x-D.x,y=A.y-D.y}const S=this.locationCoordinate(n);this.setLocation(new o.aa(S.x-p,S.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const p=l?o.bH(l,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new o.aa(y.x,y.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const p=l??this._centerAltitude,y=[n.x,n.y,0,1],v=[n.x,n.y,1,1];o.ab.vec4.transformMat4(y,y,this.pixelMatrixInverse),o.ab.vec4.transformMat4(v,v,this.pixelMatrixInverse);const S=v[3];o.ab.vec4.scale(y,y,1/y[3]),o.ab.vec4.scale(v,v,1/S);const A=y[2],D=v[2];return{p0:y,p1:v,t:A===D?0:(p-A)/(D-A)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return o.ab.vec4.transformMat4(l,l,this.pixelMatrixInverse),o.ab.vec4.transformMat4(p,p,this.pixelMatrixInverse),o.ab.vec4.scale(l,l,1/l[3]),o.ab.vec4.scale(p,p,1/p[3]),l[2]=o.bH(l[2],this._center.lat)*this.worldSize,p[2]=o.bH(p[2],this._center.lat)*this.worldSize,o.ab.vec4.scale(l,l,1/this.worldSize),o.ab.vec4.scale(p,p,1/this.worldSize),new o.aq([l[0],l[1],l[2]],o.ab.vec3.normalize([],o.ab.vec3.sub([],p,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:p,t:y}=n,v=o.bH(l[2],this._center.lat),S=o.bH(p[2],this._center.lat);return new o.aa(o.af(l[0],p[0],y)/this.worldSize,o.af(l[1],p[1],y)/this.worldSize,o.af(v,S,y))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let l=this.projection.pointCoordinate3D(this,n.x,n.y);if(l)return new o.aa(l[0],l[1],l[2]);let p=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n);const v=.02*y,S=n.clone();for(let A=0;A<10&&y-p>v;A++){S.y=o.af(p,y,.66);const D=this.projection.pointCoordinate3D(this,S.x,S.y);D?(y=S.y,l=D):p=S.y}return l?new o.aa(l[0],l[1],l[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=o.bY)return!this.isPointAboveHorizon(n);const l=this.pointCoordinate(n);return l.y>=0&&l.y<=1}_coordinatePoint(n,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return o.ab.vec4.transformMat4(y,y,this.pixelMatrix),y[3]>0?new o.P(y[0]/y[3],y[1]/y[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,v=this.pointLocation3D(new o.P(l,n)),S=this.pointLocation3D(new o.P(y,n)),A=this.pointLocation3D(new o.P(y,p)),D=this.pointLocation3D(new o.P(l,p));let N=Math.min(v.lng,S.lng,A.lng,D.lng),j=Math.max(v.lng,S.lng,A.lng,D.lng),$=Math.min(v.lat,S.lat,A.lat,D.lat),V=Math.max(v.lat,S.lat,A.lat,D.lat);const q=Math.pow(2,-this.zoom)/16*270,ie=this.projection.name==="globe"?1:4,ne=(le,ce,fe,ve,_e)=>{const Te=(le+fe)/2,we=(ce+ve)/2,Se=new o.P(Te,we),{lng:be,lat:ke}=this.pointLocation3D(Se),ze=Math.max(0,N-be,$-ke,be-j,ke-V);N=Math.min(N,be),j=Math.max(j,be),$=Math.min($,ke),V=Math.max(V,ke),(_e<ie||ze>q)&&(ne(le,ce,Te,we,_e+1),ne(Te,we,fe,ve,_e+1))};if(ne(l,n,y,n,1),ne(y,n,y,p,1),ne(y,p,l,p,1),ne(l,p,l,n,1),this.projection.name==="globe"){const[le,ce]=o.bZ(this);le?(V=90,j=180,N=-180):ce&&($=-90,j=180,N=-180)}return new o.az(new o.bO(N,$),new o.bO(j,V))}_getBoundsRectangular(n,l){const{top:p,left:y}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,A=new o.P(y,p),D=new o.P(S,p),N=new o.P(S,v),j=new o.P(y,v);let $=this.pointCoordinate(A,n),V=this.pointCoordinate(D,n);const q=this.pointCoordinate(N,l),ie=this.pointCoordinate(j,l),ne=(le,ce)=>(ce.y-le.y)/(ce.x-le.x);return $.y>1&&V.y>=0?$=new o.aa((1-ie.y)/ne(ie,$)+ie.x,1):$.y<0&&V.y<=1&&($=new o.aa(-ie.y/ne(ie,$)+ie.x,0)),V.y>1&&$.y>=0?V=new o.aa((1-q.y)/ne(q,V)+q.x,1):V.y<0&&$.y<=1&&(V=new o.aa(-q.y/ne(q,V)+q.x,0)),new o.az().extend(this.coordinateLocation($)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce((p,y)=>{if(y.dem){const v=y.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.bX,this.maxLat=o.bX,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.at(this.minLng)*this.tileSize,this.worldMaxX=o.at(this.maxLng)*this.tileSize,this.worldMinY=o.aA(this.maxLat)*this.tileSize,this.worldMaxY=o.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,p=this._distanceTileDataCache;if(p[l])return p[l];const y=n.canonical,v=1/this.height,S=this.cameraWorldSize,A=S/this.zoomScale(y.z),D=(y.x+Math.pow(2,y.z)*n.wrap)*A,N=y.y*A,j=this.point;j.x*=S/this.worldSize,j.y*=S/this.worldSize;const $=this.angle,V=Math.sin(-$),q=-Math.cos(-$);return p[l]={bearing:[V,q],center:[(j.x-D)*v,(j.y-N)*v],scale:A/o.ag*v},p[l]}calculateFogTileMatrix(n){const l=n.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.ab.mat4.multiply(y,this.worldToFogMatrix,y),p[l]=new Float32Array(y),p[l]}calculateProjMatrix(n,l=!1,p=!1){const y=n.key;let v;if(v=p?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,v[y])return v[y];const S=this.calculatePosMatrix(n,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,o.ab.mat4.multiply(S,A,S),v[y]=new Float32Array(S),v[y]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const y=o.b_(n,this);return p[l]=y,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,l=o.ab.mat4.fromScaling([],[n,n,n]);return o.ab.mat4.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=o.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),y=this._camera.forward(),v=o.bH(1,this._center.lat);p[2]/=v,y[2]/=v,o.ab.vec3.normalize(y,y);const S=n.raycast(p,y,n.exaggeration());if(S){const A=o.ab.vec3.scaleAndAdd([],p,y,S),D=new o.aa(A[0],A[1],o.bH(A[2],o.aS(A[1]))),N=(D.z+o.ab.vec3.length([D.x-p[0],D.y-p[1],D.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,p=o.bH(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),v=l.getAtPointOrZero(new o.aa(...y)),S=this.pixelsPerMeter/this.worldSize*v,A=this._minimumHeightOverTerrain(),D=y[2]-S;if(D<=A)if(D<0||n){const N=this.locationCoordinate(this._center,this._centerAltitude),j=[y[0],y[1],N.z-y[2]],$=o.ab.vec3.length(j);j[2]-=(A-D)/this._pixelsPerMercatorPixel;const V=o.ab.vec3.length(j);if(V===0)return;o.ab.vec3.scale(j,j,$/V*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],N.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const V=this.center;return V.lat=o.aw(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(V.lng=o.aw(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const l=this._unmodified,{x:p,y}=this.point;let v=0,S=p,A=y;const D=this.width/2,N=this.height/2,j=this.worldMinY*this.scale,$=this.worldMaxY*this.scale;if(y-N<j&&(A=j+N),y+N>$&&(A=$-N),$-j<this.height&&(v=Math.max(v,this.height/($-j)),A=($+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,ie=this.worldSize/2-(V+q)/2;S=(p+ie+this.worldSize)%this.worldSize-ie,S-D<V&&(S=V+D),S+D>q&&(S=q-D),q-V<this.width&&(v=Math.max(v,this.width/(q-V)),S=(q+V)/2)}S===p&&A===y||(this.center=this.unproject(new o.P(S,A))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bH(1,this.center.lat)/o.bH(1,o.c8));const y=o.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?p:1,S=this._camera.getWorldToCamera(this.worldSize,v);let A;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-n.x/this.width,D[9]=2*n.y/this.height,this.isOrthographic){let ke=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ze=ke*this.aspect,tt=-ze,Xe=-ke;ze-=n.x,tt-=n.x,ke+=n.y,Xe+=n.y,A=this._camera.getCameraToClipOrthographic(tt,ze,Xe,ke,this._nearZ,this._farZ),((Oe,$e,ht,xt)=>{for(let Pt=0;Pt<16;Pt++)Oe[Pt]=Qf($e[Pt],ht[Pt],xt)})(A,A,D,Lt(this.pitch>=15?1:this.pitch/15))}else A=D;const N=o.ab.mat4.mul([],D,S);let j=o.ab.mat4.mul([],A,S);if(this.projection.isReprojectedInTileSpace){const ke=this.locationCoordinate(this.center),ze=o.ab.mat4.identity([]);o.ab.mat4.translate(ze,ze,[ke.x*this.worldSize,ke.y*this.worldSize,0]),o.ab.mat4.multiply(ze,ze,o.c0(this)),o.ab.mat4.translate(ze,ze,[-ke.x*this.worldSize,-ke.y*this.worldSize,0]),o.ab.mat4.multiply(j,j,ze),o.ab.mat4.multiply(N,N,ze),this.inverseAdjustmentMatrix=o.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.ab.mat4.scale([],j,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=j,this.invProjMatrix=o.ab.mat4.invert(new Float64Array(16),this.projMatrix),l){const ke=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ke[8]=2*-n.x/this.width,ke[9]=2*n.y/this.height,this.expandedFarZProjMatrix=o.ab.mat4.mul([],ke,S)}else this.expandedFarZProjMatrix=this.projMatrix;const $=o.ab.mat4.invert([],A);this.frustumCorners=o.c2.fromInvProjectionMatrix($,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const V=new Float32Array(16);o.ab.mat4.identity(V),o.ab.mat4.scale(V,V,[1,-1,1]),o.ab.mat4.rotateX(V,V,this._pitch),o.ab.mat4.rotateZ(V,V,this.angle);const q=o.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.ab.mat4.clone(q);const ie=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-n.x/this.width,q[9]=2*(n.y+ie)/this.height,this.skyboxMatrix=o.ab.mat4.multiply(V,q,V);const ne=this.point,le=ne.x,ce=ne.y,fe=this.width%2/2,ve=this.height%2/2,_e=Math.cos(this.angle),Te=Math.sin(this.angle),we=le-Math.round(le)+_e*fe+Te*ve,Se=ce-Math.round(ce)+_e*ve+Te*fe,be=new Float64Array(j);if(o.ab.mat4.translate(be,be,[we>.5?we-1:we,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=be,j=o.ab.mat4.create(),o.ab.mat4.scale(j,j,[this.width/2,-this.height/2,1]),o.ab.mat4.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=o.ab.mat4.create(),o.ab.mat4.scale(j,j,[1,-1,1]),o.ab.mat4.translate(j,j,[-1,-1,0]),o.ab.mat4.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=o.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},j=o.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.c3(this);const ke=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ab.vec3.transformMat4(ke,ke,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,v=[n,n,l];o.ab.vec3.scale(v,v,y),o.ab.vec3.scale(p,p,-1),o.ab.vec3.multiply(p,p,v);const S=o.ab.mat4.create();o.ab.mat4.translate(S,S,p),o.ab.mat4.scale(S,S,v),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,y)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*v,y.y/this.worldSize-p[1]*v,n/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=n[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(v=Math.min((l-p)/y,1)),this._camera.position=o.ab.vec3.scaleAndAdd([],this._camera.position,n,v),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),v=o.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.ai(this._maxPitch)),A=Math.max((n[2]-v)/Math.cos(p),S),D=this._zoomFromMercatorZ(A);o.ab.vec3.scaleAndAdd(n,n,l,A),this._pitch=o.aw(p,o.ai(this.minPitch),o.ai(this.maxPitch)),this.angle=o.bF(y,-Math.PI,Math.PI),this._setZoom(o.aw(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.aa(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,p=o.bY,y=0,v=1/0;for(;p-l>1e-6&&p>l;){const S=l+.5*(p-l),A=this.tileSize*Math.pow(2,S),D=this.getCameraToCenterDistance(this.projection,S,A),N=this.scaleZoom(D/(n*this.tileSize)),j=Math.abs(S-N);j<v&&(v=j,y=S),S<N?l=S:p=S}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const p=Math.min(n.x,l.x),y=Math.max(n.x,l.x),v=Math.min(n.y,l.y),S=Math.max(n.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new o.P(p,v),new o.P(y,S),new o.P(p,S),new o.P(y,v)],D=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const j of A){const $=this.pointRayIntersection(j);if($.t<0)return!0;const V=this.rayIntersectionCoordinate($);if(V.x<D||V.y<0||V.x>N||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(n,l){const p=o.ab.vec3.length(o.ab.vec3.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([l,p,y],v){const S=[l,p,y,1];o.ab.vec4.transformMat4(S,S,v);const A=S[3]=Math.max(S[3],1e-6);return S[0]/=A,S[1]/=A,S[2]/=A,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,n))}}getCameraToCenterDistance(n,l=this.zoom,p=this.worldSize){const y=o.b$(n,l,this.width,this.height,1024),v=n.pixelSpaceConversion(this.center.lat,p,y);let S=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(S=Qf(1,S,Lt(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.ab.mat4.multiply(n,n,this.globeMatrix),n}getFrustum(n){return o.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Ua=(f,n)=>{if(n>0&&f.terrain&&o.w("Cutoff is currently disabled on terrain"),n<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=f.transform,p=Math.max(Math.abs(l._zoom-(f.minCutoffZoom-1)),1),y=l.isLODDisabled(!1)?o.ac(60,45,l.pitch):o.ac(30,15,l.pitch),v=l._farZ-l._nearZ,S=n*l.height,A=((1-(D=y))*l.cameraToCenterDistance+D*(l._farZ+S))*p;var D;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(A-l._nearZ)/v,(A-S-l._nearZ)/v]}}},ro={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class bv{constructor(n,l){this.aabb=n,this.lastCascade=l}}class tp{add(n,l){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],l.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],l.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],l.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],l.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],l.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],l.max[2])):this.receivers[n.key]=new bv(l,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,l,p){const y=o.cd.fromPoints(n.points);let v=0;for(const S in this.receivers){const A=this.receivers[S];if(!A||!y.intersectsAabb(A.aabb))continue;A.aabb.min=y.closestPoint(A.aabb.min),A.aabb.max=y.closestPoint(A.aabb.max);const D=A.aabb.getCorners();for(let N=0;N<p.length;N++){let j=!0;for(const $ of D){const V=[$[0]*l,$[1]*l,$[2]];if(o.ab.vec3.transformMat4(V,V,p[N].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){j=!1;break}}if(A.lastCascade=N,v=Math.max(v,N),j)break}}return v+1}}class Va{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new tp,this._depthMode=new sr(n.context.gl.LEQUAL,sr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(ro,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(ro,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(ro,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,l){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const y=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||y<=0||(this._shadowLayerCount=p.style.order.reduce((ie,ne)=>{const le=p.style._mergedLayers[ne];return ie+(le.hasShadowPass()&&!le.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=p.context,S=ro.shadowMapResolution,A=ro.shadowMapResolution;if(this._cascades.length===0||ro.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ie=0;ie<ro.cascadeCount;++ie){const ne=p._shadowMapDebug,le=v.gl,ce=v.createFramebuffer(S,A,ne,"texture"),fe=new o.T(v,{width:S,height:A,data:null},le.DEPTH_COMPONENT16);if(ce.depthAttachment.set(fe.texture),ne){const ve=new o.T(v,{width:S,height:A,data:null},le.RGBA8);ce.colorAttachment.set(ve.texture)}this._cascades.push({framebuffer:ce,texture:fe,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bR,scale:0})}}this.shadowDirection=Ml(l);let D=0;if(n.elevation){const ie=n.elevation,ne=[1e4,-1e4];ie.visibleDemTiles.filter(le=>le.dem).forEach(le=>{const ce=le.dem.tree;ne[0]=Math.min(ne[0],ce.minimums[0]),ne[1]=Math.max(ne[1],ce.maximums[0])}),ne[0]!==1e4&&(D=(ne[1]-ne[0])*ie.exaggeration())}const N=1.5*n.cameraToCenterDistance,j=3*N,$=new Float64Array(16);for(let ie=0;ie<this._cascades.length;++ie){const ne=this._cascades[ie];let le=n.height/50,ce=1;ro.cascadeCount===1?ce=j:ie===0?ce=N:(le=N,ce=j);const[fe,ve]=vu(n,this.shadowDirection,le,ce,ro.shadowMapResolution,D);ne.scale=n.scale,ne.matrix=fe,ne.boundingSphereRadius=ve,o.ab.mat4.invert($,ne.matrix),ne.frustum=o.bR.fromInvProjectionMatrix($,1,0,!0),ne.far=ce}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ro.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ro.shadowMapResolution,this._uniformValues.u_shadowmap_0=to.ShadowMap0,this._uniformValues.u_shadowmap_1=to.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=p.transform.elevation;for(const ie of this._groundShadowTiles){let ne={min:0,max:0};if(q){const le=q.getMinMaxForTile(ie);le&&(ne=le)}this.addShadowReceiver(ie.toUnwrapped(),ne.min,ne.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,l){if(!this.enabled)return;const p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,ro.shadowMapResolution,ro.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){p.currentShadowCascade=v,y.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),y.clear({color:o.aj.white,depth:1});for(const S of n.order){const A=n._mergedLayers[S];if(!A.hasShadowPass()||A.isHidden(p.transform.zoom))continue;const D=n.getLayerSourceCache(A),N=D?l[D.id]:void 0;(A.type==="model"||N&&N.length)&&p.renderLayer(p,D,A,N)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,l=n.style,p=n.context,y=l.directionalLight,v=l.ambientLight;if(!y||!v)return;const S=[],A=Ua(n,n.longestCutoffRange);A.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const D=yu(l,y,v),N=new sr(p.gl.LEQUAL,sr.ReadOnly,n.depthRangeFor3D);for(const j of this._groundShadowTiles){const $=j.toUnwrapped(),V=n.isTileAffectedByFog(j),q=n.getOrCreateProgram("groundShadow",{defines:S,overrideFog:V});this.setupShadows($,q),n.uploadCommonUniforms(p,q,$,null,A);const ie={u_matrix:n.transform.calculateProjMatrix($),u_ground_shadow_factor:D};q.draw(n,p.gl.TRIANGLES,N,Er.disabled,Or.multiply,mr.disabled,ie,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Or.unblended:Or.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const l=this.painter.transform,p=l.calculatePosMatrix(n,l.worldSize);return o.ab.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){return o.ab.mat4.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,l,p,y=0){if(!this.enabled)return;const v=this.painter.transform,S=this.painter.context,A=S.gl,D=this._uniformValues,N=new Float64Array(16),j=v.calculatePosMatrix(n,v.worldSize);for(let $=0;$<this._cascades.length;$++)o.ab.mat4.multiply(N,this._cascades[$].matrix,j),D[$===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(N),S.activeTexture.set(A.TEXTURE0+to.ShadowMap0+$),this._cascades[$].texture.bind(A.NEAREST,A.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const $=o.cc(n.canonical),V=2/v.tileSize*o.ag/ro.shadowMapResolution,q=V*this._cascades[0].boundingSphereRadius,ie=V*this._cascades[this._cascades.length-1].boundingSphereRadius,ne=(p==="vector-tile"?1:3)/Math.pow(2,y-n.canonical.z-(1-v.zoom+Math.floor(v.zoom)));D.u_shadow_normal_offset=[$,q*ne,ie*ne],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(S,D)}setupShadowsFromMatrix(n,l,p=!1){if(!this.enabled)return;const y=this.painter.context,v=y.gl,S=this._uniformValues,A=new Float64Array(16);for(let D=0;D<ro.cascadeCount;D++)o.ab.mat4.multiply(A,this._cascades[D].matrix,n),S[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),y.activeTexture.set(v.TEXTURE0+to.ShadowMap0+D),this._cascades[D].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){const D=ro.normalOffset;S.u_shadow_normal_offset=[1,D,D],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(y,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,l,p,y){if(y[2]>=0)return{};const v=function(D,N,j){const $=j/(1<<D.canonical.z);return new o.cd([D.canonical.x*$+D.wrap*j,D.canonical.y*$+D.wrap*j,0],[(D.canonical.x+1)*$+D.wrap*j,(D.canonical.y+1)*$+D.wrap*j,N])}(n,l,p).getCorners(),S=l/-y[2];y[0]<0?(o.ab.vec3.add(v[0],v[0],[y[0]*S,0,0]),o.ab.vec3.add(v[3],v[3],[y[0]*S,0,0])):y[0]>0&&(o.ab.vec3.add(v[1],v[1],[y[0]*S,0,0]),o.ab.vec3.add(v[2],v[2],[y[0]*S,0,0])),y[1]<0?(o.ab.vec3.add(v[0],v[0],[0,y[1]*S,0]),o.ab.vec3.add(v[1],v[1],[0,y[1]*S,0])):y[1]>0&&(o.ab.vec3.add(v[2],v[2],[0,y[1]*S,0]),o.ab.vec3.add(v[3],v[3],[0,y[1]*S,0]));const A={};return A.vertices=v,A.planes=[_u(v[1],v[0],v[4]),_u(v[2],v[1],v[5]),_u(v[3],v[2],v[6]),_u(v[0],v[3],v[7])],A}addShadowReceiver(n,l,p){this._receivers.add(n,o.cd.fromTileIdAndHeight(n,l,p))}getMaxCascadeForTile(n){const l=this._receivers.get(n);return l&&l.lastCascade?l.lastCascade:0}}function _u(f,n,l){const p=o.ab.vec3.sub([],l,n),y=o.ab.vec3.sub([],f,n),v=o.ab.vec3.cross([],p,y),S=o.ab.vec3.length(v);return S===0?[0,0,1,0]:(o.ab.vec3.scale(v,v,1/S),[v[0],v[1],v[2],-o.ab.vec3.dot(v,n)])}function Ml(f){const n=f.properties.get("direction"),l=o.cb(n.x,n.y,n.z);l[2]=o.aw(l[2],0,75);const p=o.ce([l[0],l[1],l[2]]);return o.ab.vec3.fromValues(p.x,p.y,p.z)}function yu(f,n,l){const p=n.properties.get("color-use-theme")==="none",y=n.properties.get("color"),v=n.properties.get("intensity"),S=n.properties.get("direction"),A=[S.x,S.y,S.z],D=l.properties.get("color-use-theme")==="none",N=l.properties.get("color"),j=l.properties.get("intensity"),$=Math.max(o.ab.vec3.dot([0,0,1],A),0),V=[0,0,0];o.ab.vec3.scale(V,N.toRenderColor(D?null:f.getLut(n.scope)).toArray01Linear().slice(0,3),j);const q=[0,0,0];return o.ab.vec3.scale(q,y.toRenderColor(p?null:f.getLut(l.scope)).toArray01Linear().slice(0,3),$*v),o.cf([V[0]>0?V[0]/(V[0]+q[0]):0,V[1]>0?V[1]/(V[1]+q[1]):0,V[2]>0?V[2]/(V[2]+q[2]):0])}function vu(f,n,l,p,y,v){const S=f.zoom,A=f.scale,D=f.worldSize,N=1/D,j=f.aspect,$=Math.sqrt(1+j*j)*Math.tan(.5*f.fovX),V=$*$,q=p-l,ie=p+l;let ne,le;V>q/ie?(ne=p,le=p*$):(ne=.5*ie*(1+V),le=.5*Math.sqrt(q*q+2*(p*p+l*l)*V+ie*ie*V*V));const ce=f.projection.pixelsPerMeter(f.center.lat,D),fe=f._camera.getCameraToWorldMercator(),ve=[0,0,-ne*N];o.ab.vec3.transformMat4(ve,ve,fe);let _e=le*N;const Te=f._edgeInsets;if(!(Te.left===0&&Te.top===0&&Te.right===0&&Te.bottom===0||Te.left===Te.right&&Te.top===Te.bottom)){const Tt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?ce:1),gt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,l,p);gt[8]=2*-f.centerOffset.x/f.width,gt[9]=2*f.centerOffset.y/f.height;const ft=new Float64Array(16);o.ab.mat4.mul(ft,gt,Tt);const zt=new Float64Array(16);o.ab.mat4.invert(zt,ft);const Ft=o.bR.fromInvProjectionMatrix(zt,D,S,!0);for(const Dt of Ft.points){const $t=((we=Dt)[0]/=A,we[1]/=A,we[2]=o.bH(we[2],f._center.lat),we);_e=Math.max(_e,o.ab.vec3.len(o.ab.vec3.subtract([],ve,$t)))}}var we;_e*=y/(y-1);const Se=Math.acos(n[2]),be=Math.atan2(-n[0],-n[1]),ke=new ih;ke.position=ve,ke.setPitchBearing(Se,be);const ze=ke.getWorldToCamera(D,ce),tt=_e*D,Xe=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*tt),Oe=ke.getCameraToClipOrthographic(-tt,tt,-tt,tt,Xe,(tt+v*ce)/n[2]),$e=new Float64Array(16);o.ab.mat4.multiply($e,Oe,ze);const ht=o.ab.vec3.fromValues(Math.floor(1e6*ve[0])/1e6*D,Math.floor(1e6*ve[1])/1e6*D,0),xt=.5*y,Pt=[0,0,0];o.ab.vec3.transformMat4(Pt,ht,$e),o.ab.vec3.scale(Pt,Pt,xt);const Ye=[Math.floor(Pt[0]),Math.floor(Pt[1]),Math.floor(Pt[2])],mt=[0,0,0];o.ab.vec3.sub(mt,Pt,Ye),o.ab.vec3.scale(mt,mt,-1/xt);const ot=new Float64Array(16);return o.ab.mat4.identity(ot),o.ab.mat4.translate(ot,ot,mt),o.ab.mat4.multiply($e,ot,$e),[$e,tt]}class c2 extends o.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,l){return o.aM(this.requestManager.transformRequest(l,o.R.Model).url).then(p=>{if(!p)return;const y=o.aN(p),v=new o.aO(n,void 0,void 0,y);return v.computeBoundsAndApplyParent(),v}).catch(p=>{if(p&&p.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${n} from ${l}: ${p.message}`)))})}load(n,l){this.models[l]||(this.models[l]={});const p=Object.keys(n);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+p.length;const y=[];for(const v of p)y.push(this.loadModel(v,n[v]));Promise.allSettled(y).then(v=>{for(let S=0;S<v.length;S++){const{status:A,value:D}=v[S];A==="fulfilled"&&D&&(this.models[l][p[S]]={model:D,numReferences:1})}this.numModelsLoading[l]-=p.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(v=>{this.fire(new o.y(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,l){return!!this.getModel(n,l)}getModel(n,l){return this.models[l]||(this.models[l]={}),this.models[l][n]?this.models[l][n].model:void 0}addModel(n,l,p){this.models[p]||(this.models[p]={}),this.hasModel(n,p)&&this.models[p][n].numReferences++,this.load({[n]:this.requestManager.normalizeModelURL(l)},p)}addModels(n,l){this.models[l]||(this.models[l]={});const p={};for(const y in n)this.models[l][y]={},p[y]=this.requestManager.normalizeModelURL(n[y]);this.load(p,l)}addModelsFromBucket(n,l){this.models[l]||(this.models[l]={});const p={};for(const y of n)this.hasModel(y,l)?this.models[l][y].numReferences++:p[y]=this.requestManager.normalizeModelURL(y);this.load(p,l)}removeModel(n,l){if(this.models[l]&&this.models[l][n]&&(this.models[l][n].numReferences--,this.models[l][n].numReferences===0)){const p=this.models[l][n].model;delete this.models[l][n],p.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,l){this.models[l]||(this.models[l]={});for(const p in this.models[l])this.models[l][p].model&&this.models[l][p].model.upload(n.context)}}const u2=new o.a5({data:new o.a6(o.a3.colorTheme.data)}),Vg={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function wv(f){return f=f||{},Object.assign(f,Vg)}class Sv extends o.E{constructor(n){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},o.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=n,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(n=>{n.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new o.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=n.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=n.stylesheet.indoor.buildingFeaturesetId,this._scope=n.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:n=>(n.feature&&n.feature.properties.floorplan&&this.selectFloorplan(n.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(n){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(S,A){const[D,N]=S,{center:j,radius:$}=A,[V,q]=j,ie=Math.abs(D-V);return Math.sqrt((ie>180?360-ie:ie)**2+(N-q)**2)<=$}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new o.z("floorplangone")));const l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=new o.P(this._map.transform.width/2,this._map.transform.height/2),y=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(n?y:p,l);v.length>0&&(this._selectedFloorplan&&v[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=v[0],this._floorplanSelected(!1)))}_floorplanSelected(n){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(v){const[[S,A],[D,N]]=v,j=(D-S+360)%360,$=j>180?360-j:j;return{center:[(S+$/2+360)%360,(A+N)/2],radius:Math.sqrt($**2+(N-A)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const l=this._floorplanStates[this._indoorData.id].selectedBuilding,p=this._floorplanStates[this._indoorData.id].selectedLevel;let y;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const v of this._indoorData.levels)v.id===this._selectedLevel.id&&(y=v.id);if(this.fire(new o.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:y})),l){const v=this._indoorData.buildings.find(S=>S.id===l);this._buildingSelected(v,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(p){const v=this._indoorData.levels.find(S=>S.id===p);this._updateLevels(v,n)}else n&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(n,l){l&&n&&n.extent&&this._map.fitBounds(n.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=n?n.id:void 0;const p=this._indoorData.levels.filter(y=>n.levels.includes(y.id));this.fire(new o.z("buildingselected",{buildingId:n.id,levels:p}))}_levelSelected(n){if(n==="overview")this._updateLevels(void 0,!0);else{const l=this._indoorData.levels.find(p=>p.id===n);this._updateLevels(l,!0)}this.fire(new o.z("levelselected",{levelId:n==="overview"?void 0:n}))}_updateLevels(n,l){if(!n)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(l&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function p(N){const j=N.indexOf("/floor/");if(j===-1)return N;const $=j+7,V=N.indexOf("/",$);return V===-1?N.slice($):N.slice($,V)}this._selectedLevel=n,this._floorplanStates[this._indoorData.id].selectedLevel=n?n.id:void 0;const y=[],v={},S={},A={},D={};for(const N of this._indoorData.levels)if(y.push(N.id),v[N.id]=N.height,S[N.id]=N.base,n){if(this.mergeFloors){const j=p(n.id),$=p(N.id);A[N.id]=$===j?"true":"false"}else A[N.id]=N.id===n.id?"true":"false";D[N.id]=N.base<n.base?"true":"false"}else D[N.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",A]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",D]),n&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!n.isUnderground),l&&n.extent)){const N=this._map.cameraForBounds(n.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),j=this._map.getZoom(),$=N.zoom?Math.abs(j-N.zoom):0;this._map.fitBounds(n.extent,$>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:j})}}selectFloorplan(n){const l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],y=this._map.queryRenderedFeatures(p,l);if(y.length>0){for(const v of y)if(JSON.parse(v.properties["indoor-data"]).floorplanIDs.includes(n)){this._selectedFloorplan=v,this._floorplanSelected(!0);break}}}selectBuilding(n){const l=this._indoorData.buildings.find(p=>p.id===n);this._buildingSelected(l,!0)}selectLevel(n){this._levelSelected(n)}}function Tv(f){if(!f.metadata||!f.metadata.content_area)return;const{left:n,top:l,width:p,height:y}=f.metadata.content_area;return[n,l,n+p,l+y]}const $a=(f,n)=>He(f,n&&n.filter(l=>l.identifier!=="source.canvas")),d2=o.ay(Zr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),h2=o.ay(Zr,["setCenter","setZoom","setBearing","setPitch"]),$g=new Set(["background","sky","slot","custom"]),Ev={version:8,layers:[],sources:{}},Gg={duration:300,delay:0};class Zs extends o.E{constructor(n,l={}){super(),this.map=n,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=o.l({},Gg),this._buildingIndex=new r2(this),this.crossTileSymbolIndex=new xv,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new tr,this.dispatcher=l.dispatcher?l.dispatcher:new o.D(o.ci(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Mn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new o.cj(n._requestManager,l.localFontFamily?o.ck.all:l.localIdeographFontFamily?o.ck.ideographs:o.ck.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new c2(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",o.cl());const p=this;this._rtlTextPluginCallback=Zs.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,S)=>{if(o.cm(v),S&&S.every(A=>A))for(const A in p._sourceCaches){const D=p._sourceCaches[A],N=D.getSource().type;N!=="vector"&&N!=="geojson"||D.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.getOwnSource(y.sourceId);if(v&&v.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===v.id&&this._validateLayer(A)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(o.f(n))return n;const l=o.cn(n);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${o.co(JSON.stringify(n))}`}_diffStyle(n,l,p){this.globalId=this._getGlobalId(n);const y=(v,S)=>{try{S(null,this.setState(v,p))}catch(A){S(A,!1)}};if(typeof n=="string"){const v=this.map._requestManager.normalizeStyleURL(n),S=this.map._requestManager.transformRequest(v,o.R.Style);o.n(S,(A,D)=>{A?this.fire(new o.y(A)):D&&y(D,l)})}else typeof n=="object"&&y(n,l)}loadURL(n,l={}){this.fire(new o.z("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!o.f(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,l.accessToken),this.resolvedImports.add(n);const y=this.importsCache.get(n);if(y)return this._load(y,p);const v=this.map._requestManager.transformRequest(n,o.R.Style);this._request=o.n(v,(S,A)=>{if(this._request=null,S)this.fire(new o.y(S));else if(A)return this.importsCache.set(n,A),this._load(A,p)})}loadJSON(n,l={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=o.q.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(Ev,!1)}_loadImports(n,l,p){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const v of n){const S=this._createFragmentStyle(v),A=new Promise(j=>{S.once("style.import.load",j),S.once("error",j)}).then(()=>this.mergeAll());if(y.push(A),this.resolvedImports.has(v.url)){S.loadEmpty();continue}const D=v.data||this.importsCache.get(v.url);D?(S.loadJSON(D,{validate:l}),this._isInternalStyle(D)&&(S.globalId=null)):v.url?S.loadURL(v.url,{validate:l}):S.loadEmpty();const N={style:S,id:v.id,config:v.config};if(p){const j=this.fragments.findIndex(({id:$})=>$===p);this.fragments=this.fragments.slice(0,j).concat(N).concat(this.fragments.slice(j))}else this.fragments.push(N)}return Promise.allSettled(y)}getImportGlobalIds(n=this,l=new Set){for(const p of n.fragments)p.style.globalId&&l.add(p.style.globalId),this.getImportGlobalIds(p.style,l);return[...l.values()]}_createFragmentStyle(n){const l=this.scope?o.aC(n.id,this.scope):n.id;let p;const y=this._initialConfig&&this._initialConfig[l];(n.config||y)&&(p=o.l({},n.config,y));const v=new Zs(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,l){const p=n.indoor?wv(n.schema):n.schema;if(this._isInternalStyle(n)){const S=o.l({},Ev,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(S,l)}if(this.updateConfig(this._config,p),l&&$a(this,nn(n)))return;this._loaded=!0,this.stylesheet=o.cp(n);const y=()=>{for(const N in n.sources)this.addSource(N,n.sources[N],{validate:!1,isInitialLoad:!0});n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const S=jg(this.stylesheet.layers);if(this._order=S.map(N=>N.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const N=this.stylesheet.lights[0];this.light=new at(N.properties,N.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new at(this.stylesheet.light)),this._layers={};for(const N of S){const j=o.cu(N,this.scope,this._styleColorTheme.lut,this.options);j.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j;const $=this.getOwnLayerSourceCache(j),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();$&&j.canCastShadows()&&V&&($.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const D=this.isRootStyle();n.imports?this._loadImports(n.imports,l).then(()=>{this._reloadImports(),this.fire(new o.z(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(D?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const S=this._evaluateColorThemeData(v);this._loadColorTheme(S).then(()=>{y()}).catch(A=>{o.w(`Couldn't load color theme from the stylesheet: ${A}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,l,p,y,v,S,A,D,N,j;const $={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(V=>{if(V.stylesheet){if(V.light!=null&&(n=V.light),V.stylesheet.lights)for(const q of V.stylesheet.lights)q.type==="ambient"&&V.ambientLight!=null&&(l=V.ambientLight),q.type==="directional"&&V.directionalLight!=null&&(p=V.directionalLight);y=this._prioritizeTerrain(y,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(v=V.fog),V.stylesheet.snow&&V.snow!=null&&(S=V.snow),V.stylesheet.rain&&V.rain!=null&&(A=V.rain),V.stylesheet.camera!=null&&(j=V.stylesheet.camera),V.stylesheet.projection!=null&&(D=V.stylesheet.projection),V.stylesheet.transition!=null&&(N=V.stylesheet.transition),$[V.scope]=V._styleColorTheme}}),this.light=n,this.ambientLight=l,this.directionalLight=p,this.fog=v,this.snow=S,this.rain=A,this._styleColorThemeForScope=$,y===null?delete this.terrain:this.terrain=y,this.camera=j||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=o.l({},Gg,N),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const l=p=>{for(const y of p.fragments)l(y.style);n(p)};l(this)}_prioritizeTerrain(n,l,p){const y=n&&n.drapeRenderMode===0;return p===null?l&&l.drapeRenderMode===0?l:y?n:null:l!=null&&(!n||y||l&&l.drapeRenderMode===1)?l:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{n=this._prioritizeTerrain(n,l.terrain,l.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(n=l.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},l={},p={};this.forEachFragmentStyle(y=>{for(const v in y._sourceCaches){const S=o.aC(v,y.scope);n[S]=y._sourceCaches[v]}for(const v in y._otherSourceCaches){const S=o.aC(v,y.scope);l[S]=y._otherSourceCaches[v]}for(const v in y._symbolSourceCaches){const S=o.aC(v,y.scope);p[S]=y._symbolSourceCaches[v]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=p}mergeLayers(){const n={},l=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const S of v._order){const A=v._layers[S];if(A.type==="slot"){const D=o.cq(S);if(n[D])continue;n[D]=[]}A.slot&&n[A.slot]?n[A.slot].push(A):l.push(A)}}),this._mergedOrder=[];const y=(v=[])=>{for(const S of v)if(S.type==="slot"){const A=o.cq(S.id);n[A]&&y(n[A]),this._mergedSlots.push(A)}else{const A=o.aC(S.id,S.scope);this._mergedOrder.push(A),p[A]=S,S.is3D()&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};y(l),this._mergedOrder.sort((v,S)=>{const A=p[v],D=p[S];return A.hasInitialOcclusionOpacityProperties?D.is3D()?1:0:A.is3D()&&D.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=o.l({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(l,p,y){const v=o.l({},p);for(const A of Object.keys(o.a3.colorTheme))v[A]===void 0&&(v[A]=o.a3.colorTheme[A].default);const S=new o.a4(u2,l,new Map(y));return S.setTransitionOrValue(v,y),S.untransitioned().possiblyEvaluate(new o.a8(0))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{const v="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let S=n;S.startsWith(v)||(S=v+S);const A="mapbox-reserved-lut",D=new Image;D.src=S,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void p();this._styleColorTheme.lutLoading=!1;const{width:N,height:j,data:$}=o.q.getImageData(D);if(j>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==j*j)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new o.r({width:N,height:j},$),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(A,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:n},p()):y(new Error("Missing LUT image."))}})}getLut(n){const l=this._styleColorThemeForScope[n];return l?l.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(l,p,y){let v,S,A;const D=o.q.devicePixelRatio>1?"@2x":"";let N=o.n(p.transformRequest(p.normalizeSpriteURL(l,D,".json"),o.R.SpriteJSON),(V,q)=>{N=null,A||(A=V,v=q,$())}),j=o.o(p.transformRequest(p.normalizeSpriteURL(l,D,".png"),o.R.SpriteImage),(V,q)=>{j=null,A||(A=V,S=q,$())});function $(){if(A)y(A);else if(v&&S){const V=o.q.getImageData(S),q={};for(const ie in v){const{width:ne,height:le,x:ce,y:fe,sdf:ve,pixelRatio:_e,stretchX:Te,stretchY:we,content:Se}=v[ie],be=new o.r({width:ne,height:le});o.r.copy(V,be,{x:ce,y:fe},{x:0,y:0},{width:ne,height:le},null),q[ie]={data:be,pixelRatio:_e,sdf:ve,stretchX:Te,stretchY:we,content:Se,usvg:!1}}y(null,q)}}return{cancel(){N&&(N.cancel(),N=null),j&&(j.cancel(),j=null)}}}(n,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new o.y(l));else if(p)for(const y in p)this.imageManager.addImage(y,this.scope,p[y]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}_loadIconset(n){if(!o.f(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const l=this.map._spriteFormat==="auto";var p,y;this._spriteRequest=(y=(v,S)=>{if(this._spriteRequest=null,v)l?this._loadSprite(n):this.fire(new o.y(v));else if(S)for(const A in S)this.imageManager.addImage(A,this.scope,S[A]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bi((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(n),o.R.Iconset),(v,S)=>{if(v)return void y(v);const A={},D=o.cg(new o.bh(S));for(const N of D.icons){const j={version:1,pixelRatio:o.q.devicePixelRatio,content:Tv(N),stretchX:N.metadata?N.metadata.stretch_x_areas:void 0,stretchY:N.metadata?N.metadata.stretch_y_areas:void 0,sdf:!1,usvg:!0,icon:N};A[N.name]=j}y(null,A)}))}_validateLayer(n){const l=this.getOwnSource(n.source);if(!l)return;const p=n.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.y(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,l)=>{const p=this.fragments[l];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const l=[];for(const p of n){const y=this._layers[p];y&&y.type!=="custom"&&l.push(y.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const l=this.getOwnLayer(n);if(l)return l;this.fire(new o.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const l=this.getOwnSource(n);if(l)return l;this.fire(new o.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,l){const p=this.map.painter;if(p)for(let y=n.minzoom||0;y<(n.maxzoom||25.5);y++){const v=n.getProgramIds();if(v)for(const S of v){const A=n.getDefaultProgramParams(S,l.zoom,this._styleColorTheme.lut);A&&(p.style=this,this.fog&&(p._fogVisible=!0,A.overrideFog=!0,p.getOrCreateProgram(S,A)),p._fogVisible=!1,A.overrideFog=!1,p.getOrCreateProgram(S,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,p.getOrCreateProgram(S,A)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const l=this.calculateLightsBrightness();n.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));const p=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:D,removedIds:N}=S[A];(D||N)&&(this._updateWorkerLayers(A,D,N),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const v={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];v[S]=A.used,A.used=!1,A.tileCoverLift=0}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(n,this._availableImages),!A.isHidden(n.zoom)){const D=this.getLayerSourceCache(A);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,n)}):this.precompilePrograms(A,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();for(const S in v){const A=this._mergedSourceCaches[S];v[S]!==A.used&&A.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new o.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,l,p){const y=this.getFragmentStyle(n);y&&this.dispatcher.broadcast("updateLayers",{layers:l?y._serializeLayers(l):[],scope:n,removedIds:p||[],options:y.options})}setState(n,l){if(this._checkLoaded(),$a(this,nn(n)))return!1;(n=o.cp(n)).layers=jg(n.layers);const p=function(S,A){if(!S)return[{command:Zr.setStyle,args:[A]}];let D=[];try{if(!o.bn(S.version,A.version))return[{command:Zr.setStyle,args:[A]}];if(o.bn(S.center,A.center)||D.push({command:Zr.setCenter,args:[A.center]}),o.bn(S.zoom,A.zoom)||D.push({command:Zr.setZoom,args:[A.zoom]}),o.bn(S.bearing,A.bearing)||D.push({command:Zr.setBearing,args:[A.bearing]}),o.bn(S.pitch,A.pitch)||D.push({command:Zr.setPitch,args:[A.pitch]}),o.bn(S.sprite,A.sprite)||D.push({command:Zr.setSprite,args:[A.sprite]}),o.bn(S.glyphs,A.glyphs)||D.push({command:Zr.setGlyphs,args:[A.glyphs]}),o.bn(S.imports,A.imports)||function(q=[],ie=[],ne){ie=ie||[];const le=(q=q||[]).map(rn),ce=ie.map(rn),fe=q.reduce(Yr,{}),ve=ie.reduce(Yr,{}),_e=le.slice();let Te,we,Se,be;for(Te=0,we=0;Te<le.length;Te++)Se=le[Te],ve.hasOwnProperty(Se)?we++:(ne.push({command:Zr.removeImport,args:[Se]}),_e.splice(_e.indexOf(Se,we),1));for(Te=0,we=0;Te<ce.length;Te++)Se=ce[ce.length-1-Te],_e[_e.length-1-Te]!==Se&&(fe.hasOwnProperty(Se)?(ne.push({command:Zr.removeImport,args:[Se]}),_e.splice(_e.lastIndexOf(Se,_e.length-we),1)):we++,be=_e[_e.length-Te],ne.push({command:Zr.addImport,args:[ve[Se],be]}),_e.splice(_e.length-Te,0,Se));for(const ke of ie){const ze=fe[ke.id];ze&&!o.bn(ze,ke)&&ne.push({command:Zr.updateImport,args:[ke.id,ke]})}}(S.imports,A.imports,D),o.bn(S.transition,A.transition)||D.push({command:Zr.setTransition,args:[A.transition]}),o.bn(S.light,A.light)||D.push({command:Zr.setLight,args:[A.light]}),o.bn(S.fog,A.fog)||D.push({command:Zr.setFog,args:[A.fog]}),o.bn(S.snow,A.snow)||D.push({command:Zr.setSnow,args:[A.snow]}),o.bn(S.rain,A.rain)||D.push({command:Zr.setRain,args:[A.rain]}),o.bn(S.projection,A.projection)||D.push({command:Zr.setProjection,args:[A.projection]}),o.bn(S.lights,A.lights)||D.push({command:Zr.setLights,args:[A.lights]}),o.bn(S.camera,A.camera)||D.push({command:Zr.setCamera,args:[A.camera]}),!o.bn(S["color-theme"],A["color-theme"]))return[{command:Zr.setStyle,args:[A]}];const N={},j=[];(function(q,ie,ne,le){let ce;for(ce in ie=ie||{},q=q||{})q.hasOwnProperty(ce)&&(ie.hasOwnProperty(ce)||Ss(ce,ne,le));for(ce in ie){if(!ie.hasOwnProperty(ce))continue;const fe=ie[ce];q.hasOwnProperty(ce)?o.bn(q[ce],fe)||(q[ce].type==="geojson"&&fe.type==="geojson"&&du(q,ie,ce)?ne.push({command:Zr.setGeoJSONSourceData,args:[ce,fe.data]}):Bg(ce,ie,ne,le)):Vf(ce,ie,ne)}})(S.sources,A.sources,j,N);const $=[];S.layers&&S.layers.forEach(q=>{q.source&&N[q.source]?D.push({command:Zr.removeLayer,args:[q.id]}):$.push(q)});let V=S.terrain;V&&N[V.source]&&(D.push({command:Zr.setTerrain,args:[void 0]}),V=void 0),D=D.concat(j),o.bn(V,A.terrain)||D.push({command:Zr.setTerrain,args:[A.terrain]}),function(q,ie,ne){ie=ie||[];const le=(q=q||[]).map(rn),ce=ie.map(rn),fe=q.reduce(Yr,{}),ve=ie.reduce(Yr,{}),_e=le.slice(),Te=Object.create(null);let we,Se,be,ke,ze,tt,Xe;for(we=0,Se=0;we<le.length;we++)be=le[we],ve.hasOwnProperty(be)?Se++:(ne.push({command:Zr.removeLayer,args:[be]}),_e.splice(_e.indexOf(be,Se),1));for(we=0,Se=0;we<ce.length;we++)be=ce[ce.length-1-we],_e[_e.length-1-we]!==be&&(fe.hasOwnProperty(be)?(ne.push({command:Zr.removeLayer,args:[be]}),_e.splice(_e.lastIndexOf(be,_e.length-Se),1)):Se++,tt=_e[_e.length-we],ne.push({command:Zr.addLayer,args:[ve[be],tt]}),_e.splice(_e.length-we,0,be),Te[be]=!0);for(we=0;we<ce.length;we++)if(be=ce[we],ke=fe[be],ze=ve[be],!Te[be]&&!o.bn(ke,ze))if(o.bn(ke.source,ze.source)&&o.bn(ke["source-layer"],ze["source-layer"])&&o.bn(ke.type,ze.type)){for(Xe in Ht(ke.layout,ze.layout,ne,be,null,Zr.setLayoutProperty),Ht(ke.paint,ze.paint,ne,be,null,Zr.setPaintProperty),o.bn(ke.slot,ze.slot)||ne.push({command:Zr.setSlot,args:[be,ze.slot]}),o.bn(ke.filter,ze.filter)||ne.push({command:Zr.setFilter,args:[be,ze.filter]}),o.bn(ke.minzoom,ze.minzoom)&&o.bn(ke.maxzoom,ze.maxzoom)||ne.push({command:Zr.setLayerZoomRange,args:[be,ze.minzoom,ze.maxzoom]}),ke)ke.hasOwnProperty(Xe)&&Xe!=="layout"&&Xe!=="paint"&&Xe!=="filter"&&Xe!=="metadata"&&Xe!=="minzoom"&&Xe!=="maxzoom"&&Xe!=="slot"&&(Xe.indexOf("paint.")===0?Ht(ke[Xe],ze[Xe],ne,be,Xe.slice(6),Zr.setPaintProperty):o.bn(ke[Xe],ze[Xe])||ne.push({command:Zr.setLayerProperty,args:[be,Xe,ze[Xe]]}));for(Xe in ze)ze.hasOwnProperty(Xe)&&!ke.hasOwnProperty(Xe)&&Xe!=="layout"&&Xe!=="paint"&&Xe!=="filter"&&Xe!=="metadata"&&Xe!=="minzoom"&&Xe!=="maxzoom"&&Xe!=="slot"&&(Xe.indexOf("paint.")===0?Ht(ke[Xe],ze[Xe],ne,be,Xe.slice(6),Zr.setPaintProperty):o.bn(ke[Xe],ze[Xe])||ne.push({command:Zr.setLayerProperty,args:[be,Xe,ze[Xe]]}))}else ne.push({command:Zr.removeLayer,args:[be]}),tt=_e[_e.lastIndexOf(be)+1],ne.push({command:Zr.addLayer,args:[ze,tt]})}($,A.layers,D)}catch(N){console.warn("Unable to compute style diff:",N),D=[{command:Zr.setStyle,args:[A]}]}return D}(this.serialize(),n).filter(S=>!(S.command in h2));if(p.length===0)return!1;const y=p.filter(S=>!(S.command in d2));if(y.length>0)throw new Error(`Unimplemented: ${y.map(S=>S.command).join(", ")}.`);const v=[];return p.forEach(S=>{v.push(this[S.command].apply(this,S.args))}),l&&Promise.all(v).then(l),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,l){return this.getImage(n)?this.fire(new o.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,l),this._afterImageUpdated(n),this)}updateImage(n,l,p=!1){this.imageManager.updateImage(n,this.scope,l),p&&this._afterImageUpdated(n)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new o.y(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,l,p={}){return this._checkLoaded(),this._validate(Ue,`models.${n}`,l,null,p)||(this.modelManager.addModel(n,l,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,l,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(mn,`sources.${n}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const y=zg(n,l,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const v=S=>{const A=(S?"symbol:":"other:")+y.id,D=o.aC(A,this.scope),N=this._sourceCaches[A]=new ws(D,y,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=N,N.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const l=this.getOwnSource(n);if(!l)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(n);for(const y of p){const v=o.cq(y.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(y.id),y.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getOwnSource(n).setData(l),this._changes.setDirty()}getOwnSource(n){const l=this.getOwnSourceCache(n);return l&&l.getSource()}getOwnSources(){const n=[];for(const l in this._otherSourceCaches){const p=this.getOwnSourceCache(l);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const l in n){const p=n[l]._tiles;for(const y in p){const v=p[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const y of n){if(this._validate(fi,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(y),v.updateTransitions(l)}else this.ambientLight=new $i(y,fn||(fn=new o.a5({color:new o.a6(o.a3.properties_light_ambient.color),"color-use-theme":new o.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a6(o.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(y),v.updateTransitions(l)}else this.directionalLight=new $i(y,_n||(_n=new o.a5({direction:new o.ak(o.a3.properties_light_directional.direction),color:new o.a6(o.a3.properties_light_directional.color),"color-use-theme":new o.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a6(o.a3.properties_light_directional.intensity),"cast-shadows":new o.a6(o.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a6(o.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a6(o.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=new o.a8(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,l=this.ambientLight;if(!n||!l)return;const p=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),y=n.properties.get("color").toRenderColor(null).toArray01(),v=n.properties.get("intensity"),S=n.properties.get("direction"),A=1-o.cb(S.x,S.y,S.z)[2]/90,D=p(y)*v*A,N=l.properties.get("color").toRenderColor(null).toArray01(),j=l.properties.get("intensity"),$=p(N)*j;return Number(((D+$)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(o.cr(n)){const l=o.cs(n),p=this.fragments.find(({id:v})=>v===l);if(!p)throw new Error(`Style import '${n}' not found`);const y=o.cq(n);return p.style.getFragmentStyle(y)}{const l=this.fragments.find(({id:p})=>p===n);if(!l)throw new Error(`Style import '${n}' not found`);return l.style}}setFeaturesetSelectors(n){if(!n)return;const l={},p=(y,v="")=>`${y}::${v}`;this.featuresetSelectors={};for(const y in n){const v=this.featuresetSelectors[y]=[];for(const S of n[y].selectors){if(S.featureNamespace){const D=this.getOwnLayer(S.layer);if(!D){o.w(`Layer is undefined for selector: ${S.layer}`);continue}const N=p(D.source,D.sourceLayer);if(N in l&&l[N]!==S.featureNamespace){o.w(`"featureNamespace ${S.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}l[N]=S.featureNamespace}let A;if(S.properties)for(const D in S.properties){const N=o.U(S.properties[D]);N.result==="success"&&(A=A||{},A[D]=N.value)}v.push({layerId:S.layer,namespace:S.featureNamespace,properties:A})}}}getFeaturesetDescriptors(n){const l=this.getFragmentStyle(n);if(!l||!l.stylesheet.featuresets)return[];const p=[];for(const y in l.stylesheet.featuresets)p.push({featuresetId:y,importId:l.scope?l.scope:void 0});return p}getFeaturesetLayers(n,l){const p=this.getFragmentStyle(l),y=p.stylesheet.featuresets;if(!y||!y[n])return this.fire(new o.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const S of y[n].selectors){const A=p.getOwnLayer(S.layer);A&&v.push(A)}return v}getConfigProperty(n,l){const p=this.getFragmentStyle(n);if(!p)return null;const y=o.aC(l,p.scope),v=p.options.get(y),S=v?v.value||v.default:null;return S?S.serialize():null}setConfigProperty(n,l,p){const y=this.getFragmentStyle(n);if(!y)return;const v=y.stylesheet.indoor?wv(y.stylesheet.schema):y.stylesheet.schema;if(!v||!v[l])return;const S=o.U(p);if(S.result!=="success")return void $a(this,S.value);const A=S.value.expression,D=o.aC(l,y.scope),N=y.options.get(D);if(!N)return;let j;const{minValue:$,maxValue:V,stepValue:q,type:ie,values:ne}=v[l],le=o.U(v[l].default);le.result==="success"&&(j=le.value.expression),j?(this.options.set(D,{...N,value:A,default:j,minValue:$,maxValue:V,stepValue:q,type:ie,values:ne}),this.updateConfigDependencies(l)):this.fire(new o.y(new Error(`No schema defined for the config option "${l}" in the "${n}" fragment.`)))}getConfig(n){const l=this.getFragmentStyle(n);if(!l)return null;const p=l.stylesheet.schema;if(!p)return null;const y={};for(const v in p){const S=o.aC(v,l.scope),A=l.options.get(S),D=A?A.value||A.default:null;y[v]=D?D.serialize():null}return y}setConfig(n,l){const p=this.getFragmentStyle(n);p&&(p.updateConfig(l,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const l=this.getFragmentStyle(n);return l?l.stylesheet.schema:null}setSchema(n,l){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=l,p.updateConfig(p._config,l),this.updateConfigDependencies())}updateConfig(n,l){if(this._config=n,n||l)if(l)for(const p in l){let y,v;const S=o.U(l[p].default);if(S.result==="success"&&(y=S.value.expression),n&&n[p]!==void 0){const V=o.U(n[p]);V.result==="success"&&(v=V.value.expression)}const{minValue:A,maxValue:D,stepValue:N,type:j,values:$}=l[p];if(y){const V=o.aC(p,this.scope);this.options.set(V,{default:y,value:v,minValue:A,maxValue:D,stepValue:N,type:j,values:$})}else this.fire(new o.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const l of this._configDependentLayers){const p=this.getLayer(l);if(p){if(n&&!p.configDependencies.has(n))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const p=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(p){const y=l._evaluateColorThemeData(p);(!l._styleColorTheme.lut&&y!==""||l._styleColorTheme.lut&&y!==l._styleColorTheme.lut.data)&&l.setColorTheme(p)}}),this._changes.setDirty()}addLayer(n,l,p={}){this._checkLoaded();const y=n.id;if(this._layers[y])return void this.fire(new o.y(new Error(`Layer with id "${y}" already exists on this map`)));let v;if(n.type==="custom"){if($a(this,o.ct(n)))return;v=o.cu(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=o.cp(n),n=o.l(n,{source:y})),this._validate(de,`layers.${y}`,n,{arrayIndex:-1},p))return;v=o.cu(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let S=this._order.length;if(l){const j=this._order.indexOf(l);if(j===-1)return void this.fire(new o.y(new Error(`Layer with id "${l}" does not exist on this map.`)));v.slot===this._layers[l].slot?S=j:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const A=this.getOwnLayerSourceCache(v),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&v.canCastShadows()&&D&&(A.castsShadows=!0);const N=this._changes.getRemovedLayer(v);if(N&&v.source&&A&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const j=o.aC(v.source,v.scope);N.type!==v.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),A.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(n,l){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===l)return;const y=this._order.indexOf(n);this._order.splice(y,1);let v=this._order.length;if(l){const S=this._order.indexOf(l);if(S===-1)return void this.fire(new o.y(new Error(`Layer with id "${l}" does not exist on this map.`)));p.slot===this._layers[l].slot?v=S:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const l=this._checkLayer(n);if(!l)return;l.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const y=this.getOwnLayerSourceCache(l);if(y&&y.castsShadows){let v=!1;for(const S in this._layers)if(this._layers[S].source===l.source&&this._layers[S].canCastShadows()){v=!0;break}y.castsShadows=v}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,p){this._checkLoaded();const y=this._checkLayer(n);y&&(y.minzoom===l&&y.maxzoom===p||(l!=null&&(y.minzoom=l),p!=null&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,l){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==l&&(p.slot=l,this._updateLayer(p))}setFilter(n,l,p={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!o.bn(y.filter,l))return l==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(xe,`layers.${y.id}.filter`,l,{layerType:y.type},p)||(y.filter=o.cp(l),this._updateLayer(y)))}getFilter(n){const l=this._checkLayer(n);if(l)return o.cp(l.filter)}setLayoutProperty(n,l,p,y={}){this._checkLoaded();const v=this._checkLayer(n);if(v&&!o.bn(v.getLayoutProperty(l),p)){if(p!=null&&(!y||y.validate!==!1)&&$a(v,Ae.call(nn,{key:`layers.${n}.layout.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:o.a3,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(l,p),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(n,l){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(l)}setPaintProperty(n,l,p,y={}){this._checkLoaded();const v=this._checkLayer(n);if(!v||o.bn(v.getPaintProperty(l),p)||p!=null&&(!y||y.validate!==!1)&&$a(v,De.call(nn,{key:`layers.${n}.paint.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:o.a3})))return;const S=v.setPaintProperty(l,p);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),S&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(n,l){const p=this._checkLayer(n);if(p)return p.getPaintProperty(l)}setFeatureState(n,l){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:D,importId:N}=n.target,j=this.getFragmentStyle(N),$=j.getFeaturesetLayers(D);for(const{source:V,sourceLayer:q}of $)j.setFeatureState({id:n.id,source:V,sourceLayer:q},l)}else if("layerId"in n.target){const{layerId:D}=n.target,N=this.getLayer(D);this.setFeatureState({id:n.id,source:N.source,sourceLayer:N.sourceLayer},l)}return}const p=n.source,y=n.sourceLayer,v=this._checkSource(p);if(!v)return;const S=v.type;if(S==="geojson"&&y)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!y)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(p);for(const D of A)D.setFeatureState(y,n.id,l)}removeFeatureState(n,l){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:D,importId:N}=n.target,j=this.getFragmentStyle(N),$=j.getFeaturesetLayers(D);for(const{source:V,sourceLayer:q}of $)j.removeFeatureState({id:n.id,source:V,sourceLayer:q},l)}else if("layerId"in n.target){const{layerId:D}=n.target,N=this.getLayer(D);this.removeFeatureState({id:n.id,source:N.source,sourceLayer:N.sourceLayer},l)}return}const p=n.source,y=this._checkSource(p);if(!y)return;const v=y.type,S=v==="vector"?n.sourceLayer:void 0;if(v==="vector"&&!S)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(p);for(const D of A)D.removeFeatureState(S,n.id,l)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let v;if("featuresetId"in n.target){const{featuresetId:S,importId:A}=n.target,D=this.getFragmentStyle(A),N=D.getFeaturesetLayers(S);for(const{source:j,sourceLayer:$}of N){const V=D.getFeatureState({id:n.id,source:j,sourceLayer:$});if(V&&!v)v=V;else if(!o.bn(v,V))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:S}=n.target,A=this.getLayer(S);v=this.getFeatureState({id:n.id,source:A.source,sourceLayer:A.sourceLayer})}return v}const l=n.source,p=n.sourceLayer,y=this._checkSource(l);if(y){if(y.type!=="vector"||p)return n.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(p,n.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=o.l({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return o.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),l=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return o.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(n){for(const l of Object.values(this._mergedLayers))n(l)&&this._updateLayer(l)}_updateLayer(n){this._changes.updateLayer(n);const l=this.getLayerSourceCache(n),p=o.aC(n.source,n.scope),y=this._changes.getUpdatedSourceCaches();n.source&&!y[p]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),l.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=A=>this._mergedLayers[A].is3D(),p=this.order,y={},v=[];for(let A=p.length-1;A>=0;A--){const D=p[A];if(l(D)){y[D]=A;for(const N of n){const j=N[D];if(j)for(const $ of j)v.push($)}}}v.sort((A,D)=>D.intersectionZ-A.intersectionZ);const S=[];for(let A=p.length-1;A>=0;A--){const D=p[A];if(l(D))for(let N=v.length-1;N>=0;N--){const j=v[N].feature;if(j.layer&&y[j.layer.id]<A)break;S.push(j),v.pop()}else for(const N of n){const j=N[D];if(j)for(const $ of j)S.push($.feature)}}return S}queryRenderedFeatures(n,l,p){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(xe,"queryRenderedFeatures.filter",l.filter,null,l),y=o.aZ(l.filter));const v={},S=j=>{if($g.has(j.type))return;const $=this.getOwnLayerSourceCache(j),V=v[$.id]=v[$.id]||{sourceCache:$,layers:{},has3DLayers:!1};j.is3D()&&(V.has3DLayers=!0),V.layers[j.fqid]=V.layers[j.fqid]||{styleLayer:j,targets:[]},V.layers[j.fqid].targets.push({filter:y})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const j of l.layers){const $=this._layers[j];if(!$)return this.fire(new o.y(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];S($)}}else for(const j in this._layers)S(this._layers[j]);const A=this._queryRenderedFeatures(n,v,p),D=this._flattenAndSortRenderedFeatures(A),N=[];for(const j of D)o.cs(j.layer.id)===this.scope&&N.push(j);return N}queryRenderedFeatureset(n,l,p){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(xe,"queryRenderedFeatures.filter",l.filter,null,l),y=o.aZ(l.filter));const v="mock",S=[];if(l&&l.target)S.push({...l,targetId:v,filter:y});else{const N=this.getFeaturesetDescriptors();for(const j of N)S.push({targetId:v,filter:y,target:j});for(const{style:j}of this.fragments){const $=j.getFeaturesetDescriptors();for(const V of $)S.push({targetId:v,filter:y,target:V})}}const A=this.queryRenderedTargets(n,S,p),D=[];for(const N of A)for(const j of N.variants[v])D.push(new o.cw(N,j));return D}queryRenderedTargets(n,l,p){const y={},v=(A,D,N,j)=>{const $=y[D.id]=y[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};$.layers[A.fqid]=$.layers[A.fqid]||{styleLayer:A,targets:[]},A.is3D()&&($.has3DLayers=!0),$.layers[A.fqid].targets.push(j?{...N,namespace:j.namespace,properties:j.properties}:N)};for(const A of l)if("featuresetId"in A.target){const{featuresetId:D,importId:N}=A.target,j=this.getFragmentStyle(N),$=j.featuresetSelectors[D];if(!$){this.fire(new o.y(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of $){const q=j.getOwnLayer(V.layerId);q&&!$g.has(q.type)&&v(q,j.getOwnLayerSourceCache(q),A,V)}}else if("layerId"in A.target){const{layerId:D}=A.target,N=this.getLayer(D);if(!N||$g.has(N.type))continue;v(N,this.getLayerSourceCache(N),A)}const S=this._queryRenderedFeatures(n,y,p);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(n,l,p){const y=[],v=!!this.map._showQueryGeometry,S=Xi.createFromScreenPoints(n,p);for(const A in l){const D=pv(S,l[A],this._availableImages,p,v);Object.keys(D).length&&y.push(D)}if(this.placement)for(const A in l){if(!l[A].sourceCache._onlySymbols)continue;const D=zf(S.screenGeometry,l[A],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(D).length&&y.push(D)}return y}querySourceFeatures(n,l){const p=l&&l.filter;p&&this._validate(xe,"querySourceFeatures.filter",p,null,l);let y=[];const v=this.getOwnSourceCaches(n);for(const S of v)y=y.concat(Xd(S,l));return y}addSourceType(n,l,p){return Zs.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(Zs.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,l,p={}){this._checkLoaded();const y=this.light.getLight();let v=!1;for(const A in n)if(!o.bn(n[A],y[A])){v=!0;break}if(!v)return;const S=this._getTransitionParameters();this.light.setLight(n,l,p),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,l=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const y=n.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const A="terrain-dem-src";this.addSource(A,p.source),p=o.cp(p),p=o.l(p,{source:A})}const v=o.l({},p),S={};if(this.terrain&&y){v.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(S.style=A.serialize())}if(this._validate(Pi,"terrain",v,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l),this.fire(new o.z("data",{dataType:"style"}))}else{const v=this.terrain,S=v.get();for(const A of Object.keys(o.a3.terrain))!p.hasOwnProperty(A)&&o.a3.terrain[A].default&&(p[A]=o.a3.terrain[A].default);for(const A in n)if(!o.bn(n[A],S[A])){v.set(n,this.options),this.stylesheet.terrain=n;const D=this._getTransitionParameters({duration:0});v.updateTransitions(D),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new gn(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_createSnow(n){const l=this.snow=new vi(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_createRain(n){const l=this.rain=new Eo(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!o.bn(l.get(),n)){l.set(n,this.options),this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!o.bn(l.get(),n)){l.set(n,this.options),this.stylesheet.snow=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!o.bn(l.get(),n)){l.set(n,this.options),this.stylesheet.rain=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void n();const p=this._evaluateColorThemeData(l);this._loadColorTheme(p).then(()=>{this.fire(new o.z("colorthemeset")),n()}).catch(y=>{o.w(`Couldn't set color theme: ${y}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,l){const p=this.getFragmentStyle(n);p&&(p._styleColorTheme.colorThemeOverride=l,p._reloadColorTheme())}_getTransitionParameters(n){return{now:o.q.now(),transition:o.l(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],l=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):l.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const p=this.terrain=new ut(n,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,p,y,v={}){if(v&&v.validate===!1)return!1;const S=o.l({},this.serialize());return $a(this,n.call(nn,o.l({key:l,style:S,value:p,styleSpec:o.a3},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const l=this.getSourceCaches(n);for(const p of l)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const l=this.getSourceCaches(n);for(const p of l)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let l;this.directionalLight&&(l=Ml(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(n,void 0,void 0,l)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,p,y,v,S,A=!1){let D=!1,N=!1;const j={},$={};for(const V of this._mergedOrder){const q=this._mergedLayers[V];if(q.type!=="symbol")continue;const ie=o.aC(q.source,q.scope);let ne=j[ie];if(!ne){const ce=this.getLayerSourceCache(q);if(!ce)continue;const fe=ce.getRenderableIds(!0).map(ve=>ce.getTileByID(ve));$[ie]=fe.slice(),ne=j[ie]=fe.sort((ve,_e)=>_e.tileID.overscaledZ-ve.tileID.overscaledZ||(ve.tileID.isLessThan(_e.tileID)?-1:1))}const le=this.crossTileSymbolIndex.addLayer(q,ne,l.center.lng,l.projection);D=D||le}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new o.z("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),l.zoom))&&(this.pauseablePlacement=new Yf(l,this._mergedOrder,A,p,y,v,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,$,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),N=!0),D&&this.pauseablePlacement.placement.setStale()),N||D){this._buildingIndex.onNewFrame(l.zoom);for(let V=0;V<this._mergedOrder.length;V++){const q=this._mergedLayers[this._mergedOrder[V]];if(q.type!=="symbol")continue;const ie=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,j[o.aC(q.source,q.scope)],V,ie?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,l){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:v})=>v===n.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!l)return p.push(n),this._loadImports([n],!0);const y=p.findIndex(({id:v})=>v===l);return y===-1&&this.fire(new o.y(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(n).concat(p.slice(y)),this._loadImports([n],!0,l)}updateImport(n,l){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(n);return y===-1?this:typeof l=="string"?(this.setImportUrl(n,l),this):(l.url&&l.url!==p[y].url&&this.setImportUrl(n,l.url),o.bn(l.config,p[y].config)||this.setImportConfig(n,l.config),o.bn(l.data,p[y].data)||this.setImportData(n,l.data),this)}moveImport(n,l){this._checkLoaded();let p=this.stylesheet.imports||[];const y=this.getImportIndex(n);if(y===-1)return this;const v=this.getImportIndex(l);if(v===-1)return this;const S=p[y],A=this.fragments[y];return p=p.filter(({id:D})=>D!==n),this.fragments=this.fragments.filter(({id:D})=>D!==n),this.stylesheet.imports=p.slice(0,v).concat(S).concat(p.slice(v)),this.fragments=this.fragments.slice(0,v).concat(A).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(n,l){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(n);if(y===-1)return this;p[y].url=l;const v=this.fragments[y];return v.style=this._createFragmentStyle(p[y]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(l),this}setImportData(n,l){this._checkLoaded();const p=this.getImportIndex(n),y=this.stylesheet.imports||[];return p===-1?this:l?(this.fragments[p].style.setState(l),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(n,y[p].url))}setImportConfig(n,l){this._checkLoaded();const p=this.getImportIndex(n),y=this.stylesheet.imports||[];if(p===-1)return this;l?y[p].config=l:delete y[p].config;const v=this.fragments[p],S=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=l,v.style.updateConfig(l,S),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const l=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(l.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const l=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return l===-1&&this.fire(new o.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),l}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const l in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[l];p&&n.push(p.getSource())}return n}getSource(n,l){const p=this.getSourceCache(n,l);return p&&p.getSource()}getLayerSource(n){const l=this.getLayerSourceCache(n);return l&&l.getSource()}getSourceCache(n,l){const p=o.aC(n,l);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const l=o.aC(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[n]&&l.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&l.push(this._mergedSymbolSourceCaches[n]),l}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const l in n){const p=n[l];p==="reload"?this.reloadSource(l):p==="clear"&&this.clearSource(l)}}updateLayers(n){const l=this._changes.getUpdatedPaintProperties();for(const p of l){const y=this.getLayer(p);y&&y.updateTransitions(n)}}getImages(n,l,p){this.imageManager.getImages(l.icons,l.scope,p),this._updateTilesForChangedImages();const y=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};y(this._otherSourceCaches[l.source]),y(this._symbolSourceCaches[l.source])}rasterizeImages(n,l,p){this.imageManager.rasterizeImages(l,p)}getGlyphs(n,l,p){this.glyphManager.getGlyphs(l.stacks,l.scope,p)}getResource(n,l,p){return o.cy(l,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this.getOwnSourceCaches(n);return l.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${n}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,l){if(!this._clipLayerPresent&&n.type!=="fill-extrusion")return!1;const p=n.type==="fill-extrusion"&&n.sourceLayer==="building";if(n.is3D()){if(p||l&&l.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zs.getSourceType=function(f){return dc[f]},Zs.setSourceType=function(f,n){dc[f]=n},Zs.registerForPluginStateChange=o.ch;var oh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Cv=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Hg=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,rp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",sh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,np=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pl=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ip=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,qg=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,yc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,xu=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const vc=[];Al(oh,vc),Al(Hg,vc),Al(Cv,vc);const xc={"_prelude_fog.vertex.glsl":np,"_prelude_terrain.vertex.glsl":sh,"_prelude_shadow.vertex.glsl":yc,"_prelude_fog.fragment.glsl":Pl,"_prelude_shadow.fragment.glsl":xu,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ip,"_prelude_raster_particle.glsl":qg},Ga={};Br("",sh),Br(Pl,np),Br(xu,yc),Br(ip,""),Br(qg,"");const ah=Br(Cv,Hg),op=oh;var Wg={background:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Br("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Br(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Br(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Br("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Br("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Br("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Br(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Br(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Br(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Br(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec2 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
halfwidth=(u_width_scale*a_z_offset_width.y)/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec2 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Br("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Br("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Br(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Br(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Br("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Br(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rp),skyboxGradient:Br(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rp),skyboxCapture:Br(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Br(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Br(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Br(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Br(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Br("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Br("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Br("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Br("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Al(f,n){const l=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=p.split(" ");for(const v of y)n.includes(v)||n.push(v)}}function Br(f,n){const l=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(N=>{const j=N.split(" ");return j[j.length-1]}),y=[...new Set(y)]);const v={},S=[],A=[];if(f=f.replace(l,(N,j)=>(A.push(j),"")),(n=n.replace(l,(N,j)=>(S.push(j),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...vc];Al(f,D),Al(n,D);for(const N of[...S,...A])xc[N]||console.error(`Undefined include: ${N}`),Ga[N]||(Ga[N]=[],Al(xc[N],Ga[N])),D=[...D,...Ga[N]];return{fragmentSource:f=f.replace(p,(N,j,$,V,q)=>(v[q]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${$} ${V} ${q};
#else
uniform ${$} ${V} u_${q};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${$} ${V} ${q} = u_${q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${$} ${V} ${q};
#endif
`:j==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(p,(N,j,$,V,q)=>{const ie=V==="float"?"vec2":V,ne=q.match(/color/)?"color":ie;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${$} ${V} a_${q};
#endif
`:v[q]?j==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${$} ${ie} a_${q};
out ${$} ${V} ${q};
#else
uniform ${$} ${V} u_${q};
#endif
`:j==="initialize"?ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${$} ${V} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${ne}(a_${q}, u_${q}_t);
#else
    ${$} ${V} ${q} = u_${q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${$} ${V} a_${q};
    out ${$} ${V} ${q};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${$} ${ie} a_${q};
#else
uniform ${$} ${V} u_${q};
#endif
`:j==="define-instanced"?ne==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${$} ${V} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${$} ${ie} a_${q};
#else
uniform ${$} ${V} u_${q};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${$} ${V} ${q} = a_${q};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${$} ${V} ${q} = a_${q};
#else
    ${$} ${V} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${$} ${V} ${q} = unpack_mix_${ne}(a_${q}, u_${q}_t);
#else
    ${$} ${V} ${q} = u_${q};
#endif
`}),staticAttributes:y,usedDefines:D,vertexIncludes:S,fragmentIncludes:A}}class lh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,p,y,v,S,A,D){this.context=n;let N=this.boundPaintVertexBuffers.length!==y.length;for(let $=0;!N&&$<y.length;$++)this.boundPaintVertexBuffers[$]!==y[$]&&(N=!0);let j=this.boundDynamicVertexBuffers.length!==A.length;for(let $=0;!j&&$<A.length;$++)this.boundDynamicVertexBuffers[$]!==A[$]&&(j=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||N||j||this.boundIndexBuffer!==v||this.boundVertexOffset!==S)this.freshBind(l,p,y,v,S,A,D);else{n.bindVertexArrayOES.set(this.vao);for(const $ of A)$&&($.bind(),D&&$.instanceCount&&$.setVertexAttribDivisor(n.gl,l,D));v&&v.dynamicDraw&&v.bind()}}freshBind(n,l,p,y,v,S,A){const D=n.numAttributes,N=this.context,j=N.gl;this.vao&&this.destroy(),this.vao=N.gl.createVertexArray(),N.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=S,l.enableAttributes(j,n),l.bind(),l.setVertexAttribPointers(j,n,v);for(const $ of p)$.enableAttributes(j,n),$.bind(),$.setVertexAttribPointers(j,n,v);for(const $ of S)$&&($.enableAttributes(j,n),$.bind(),$.setVertexAttribPointers(j,n,v),A&&$.instanceCount&&$.setVertexAttribDivisor(j,n,A));y&&y.bind(),N.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Mv(f,n){const l=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new o.aa(0,p/l).toLngLat().lat,new o.aa(0,(p+1)/l).toLngLat().lat]}function Pv(f,n,l,p,y,v,S){const A=f.context,D=A.gl,N=l.hillshadeFBO;if(!N)return;f.prepareDrawTile();const j=f.isTileAffectedByFog(n),$=f.getOrCreateProgram("hillshade",{overrideFog:j});A.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,N.colorAttachment.get());const V=((le,ce,fe,ve)=>{const _e=fe.paint.get("hillshade-shadow-color"),Te=fe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",we=fe.paint.get("hillshade-highlight-color"),Se=fe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",be=fe.paint.get("hillshade-accent-color"),ke=fe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ze=fe.paint.get("hillshade-emissive-strength");let tt=o.ai(fe.paint.get("hillshade-illumination-direction"));if(fe.paint.get("hillshade-illumination-anchor")==="viewport")tt-=le.transform.angle;else if(le.style&&le.style.enable3dLights()&&le.style.directionalLight){const Oe=le.style.directionalLight.properties.get("direction"),$e=o.cb(Oe.x,Oe.y,Oe.z);tt=o.ai($e[1])}const Xe=!le.options.moving;return{u_matrix:ve||le.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:Mv(0,ce.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),tt],u_shadow:_e.toRenderColor(Te?null:fe.lut),u_highlight:we.toRenderColor(Se?null:fe.lut),u_emissive_strength:ze,u_accent:be.toRenderColor(ke?null:fe.lut)}})(f,l,p,f.terrain?n.projMatrix:null);f.uploadCommonUniforms(A,$,n.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:ie,tileBoundsSegments:ne}=f.getTileBoundsBuffers(l);$.draw(f,D.TRIANGLES,y,v,S,mr.disabled,V,p.id,q,ie,ne)}function Zg(f,n,l){if(!n.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(l.stride);const v=l.getPixels();n.demTexture?n.demTexture.update(v,{premultiply:!1}):n.demTexture=new o.T(p,v,y.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function bu(f,n,l){const p=f.context,y=p.gl;if(!n.dem)return;const v=n.dem;if(p.activeTexture.set(y.TEXTURE1),Zg(f,n,v),!n.demTexture)return;n.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const S=v.dim;p.activeTexture.set(y.TEXTURE0);let A=n.hillshadeFBO;if(!A){const V=new o.T(p,{width:S,height:S,data:null},y.RGBA8);V.bind(y.LINEAR,y.CLAMP_TO_EDGE),A=n.hillshadeFBO=p.createFramebuffer(S,S,!0,"renderbuffer"),A.colorAttachment.set(V.texture)}p.bindFramebuffer.set(A.framebuffer),p.viewport.set([0,0,S,S]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:N,tileBoundsSegments:j}=f.getMercatorTileBoundsBuffers(),$=[];f.linearFloatFilteringSupported()&&$.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:$}).draw(f,y.TRIANGLES,sr.disabled,Er.disabled,Or.unblended,mr.disabled,((V,q)=>{const ie=q.stride,ne=o.ab.mat4.create();return o.ab.mat4.ortho(ne,0,o.ag,-o.ag,0,0,1),o.ab.mat4.translate(ne,ne,[0,-o.ag,0]),{u_matrix:ne,u_image:1,u_dimension:[ie,ie],u_zoom:V.overscaledZ}})(n.tileID,v),l.id,D,N,j),n.needsHillshadePrepare=!1}class jn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class f2 extends jn{getDefault(){return o.aj.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class p2 extends jn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class m2 extends jn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Yg extends jn{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Xg extends jn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Kg extends jn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Jg extends jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Av extends jn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Iv extends jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class g2 extends jn{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class ch extends jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class uh extends jn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class kv extends jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class Zo extends jn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Qg extends jn{getDefault(){return o.aj.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class sp extends jn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class ap extends jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class e_ extends jn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class t_ extends jn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let lp=class extends jn{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class r_ extends jn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class n_ extends jn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class cp extends jn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Rv extends jn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Dv extends jn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class wu extends jn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class _2 extends jn{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class y2 extends jn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class v2 extends jn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class x2 extends jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class b2 extends jn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class i_ extends jn{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class o_ extends i_{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class up extends i_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Lv extends i_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Su extends up{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ov=(f,n,l)=>({u_matrix:f,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:l}),s_=(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:S,u_frustum_tr:A,u_frustum_br:D,u_frustum_bl:N,u_globe_pos:j,u_globe_radius:$,u_viewport:V,u_grid_matrix:ne?Float32Array.from(ne):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:ie});function a_(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const Il=new class{constructor(){this.operations={}}newMorphing(f,n,l,p,y){if(f in this.operations){const v=this.operations[f];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[f]={startTime:p,phase:0,duration:y,from:n,to:l,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const l=this.operations[n];for(l.phase=(f-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},kl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function l_(f,n,l){if(n===0)return 0;const p=n<1&&l===514?.25/n:1;return 6*Math.pow(1.5,22-f)*Math.max(n,1)*p}function Rl(f,n){const l=1<<f.z;return!n&&(f.x===0||f.x===l-1)||f.y===0||f.y===l-1}const dh=f=>({u_matrix:f});function Tu(f,n,l,p,y){if(y>0){const v=o.q.now(),S=(v-f.timeAdded)/y,A=n?(v-n.timeAdded)/y:-1,D=l.getSource(),N=p.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),j=!n||Math.abs(n.tileID.overscaledZ-N)>Math.abs(f.tileID.overscaledZ-N),$=j&&f.refreshedUponExpiration?1:o.aw(j?S:1-A,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),n?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}class zv extends ws{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new o.D(o.ci(),null),y=zg("mock-dem",l,p,n.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class Nv extends ws{constructor(n){const l=zg("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new o.D(o.ci(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,p){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,S)=>{if(v[S.key]="",!this._tiles[S.key]){const A=new Cl(S,this._source.tileSize*S.overscaleFactor(),n.tileZoom);A.state="loaded",this._tiles[S.key]=A}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dp extends o.aG{constructor(n,l,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class hp extends o.cJ{constructor(n,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,v]=function(D){const N=new o.b4,j=new o.aU,$=131;N.reserve(17161),j.reserve(33800);const V=o.ag/128,q=o.ag+V/2,ie=q+V;for(let le=-V;le<ie;le+=V)for(let ce=-V;ce<ie;ce+=V){const fe=ce<0||ce>q||le<0||le>q?24575:0,ve=o.aw(Math.round(ce),0,o.ag),_e=o.aw(Math.round(le),0,o.ag);N.emplaceBack(ve+fe,_e)}const ne=(le,ce)=>{const fe=ce*$+le;j.emplaceBack(fe+1,fe,fe+$),j.emplaceBack(fe+$,fe+$+1,fe+1)};for(let le=1;le<129;le++)for(let ce=1;ce<129;ce++)ne(ce,le);return[0,129].forEach(le=>{for(let ce=0;ce<130;ce++)ne(ce,le),ne(le,ce)}),[N,j,32768]}(),S=n.context;this.gridBuffer=S.createVertexBuffer(p,o.b6.members),this.gridIndexBuffer=S.createIndexBuffer(y),this.gridSegments=o.b7.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=o.b7.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nv(l.map),this.orthoMatrix=o.ab.mat4.create(),o.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.ag,0,o.ag,0,1);const A=S.gl;this._overlapStencilMode=new Er({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new zv(l.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,l,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const y=n.terrain.properties,v=n.terrain.drapeRenderMode===0,S=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const A=n.terrain&&n.terrain.scope,D=y.get("source"),N=v?this._mockSourceCache:n.getSourceCache(D,A);if(!N)return void o.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=N,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(l):y.get("exaggeration"),!l.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const $=this.getScaledDemTileSize();this.sourceCache.update(l,$,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const l=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const y=l!=null?p-l:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const v=n.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(v);let A=v-this._previousZoom;const D=this._previousUpdateTimestamp;let N=v;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(v-N)>.5&&(A=.5*(v-N+A)),A*y<0&&(N+=A)),this._evaluationZoom=N;const j=S.getExaggeration(N),$=j===S.getExaggeration(Math.max(0,N-.1));if($&&Math.abs(j-this._exaggeration)<.01)return j;let V=Math.min(.1,.00375*(this._updateTimestamp-D));return($||j<.1||Math.abs(A)<1e-4)&&(V=Math.min(.2,4*V)),o.af(this._exaggeration,j,V)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.aa.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=l.getIds().map(D=>{const N=l.getTileByID(D).tileID;return N.projMatrix=p.calculateProjMatrix(N.toUnwrapped()),N});(function(D,N){const j=N.transform.pointCoordinate(N.transform.getCameraPoint()),$=new o.P(j.x,j.y);D.sort((V,q)=>{if(q.overscaledZ-V.overscaledZ)return q.overscaledZ-V.overscaledZ;const ie=new o.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),ne=new o.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),le=$.mult(1<<V.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(ie)-le.distSqr(ne)})})(y,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const D in S){const N=S[D];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,n[D],v),N.usedForTerrain))continue;const j=n[D];N.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[l.id]=y.map(D=>new dp(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const N=this.terrainTileForTile[D.key];if(!N)continue;const j=N.tileID.key;j in A||(this._visibleDemTiles.push(N),A[j]=j)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),Zg(this.painter,y,v))}}_prepareDemTileUniforms(n,l,p,y){if(!l||l.demTexture==null)return!1;const v=n.tileID.canonical,S=Math.pow(2,l.tileID.canonical.z-v.z),A=y||"";return p[`u_dem_tl${A}`]=[v.x*S%1,v.y*S%1],p[`u_dem_scale${A}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const l=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const v=y.dem.tree.minimums[0];return v>0&&n++,p+v},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new o.cK({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new o.T(n,y,l.R32F,{premultiply:!1}),v}setupElevationDraw(n,l,p){const y=this.painter.context,v=y.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let A=null,D=null,N=1;if(p&&p.morphing&&this._useVertexMorphing){const q=p.morphing.srcDemTile,ie=p.morphing.dstDemTile;N=p.morphing.phase,q&&ie&&(this._prepareDemTileUniforms(n,q,S,"_prev")&&(D=q),this._prepareDemTileUniforms(n,ie,S)&&(A=ie))}const j=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let $=null;var V;if(this.enabled?D&&A?($=A.demTexture,y.activeTexture.set(v.TEXTURE4),D.demTexture.bind(j(D),v.CLAMP_TO_EDGE),S.u_dem_lerp=N):(A=this.terrainTileForTile[n.tileID.key],$=this._prepareDemTileUniforms(n,A,S)?A.demTexture:this.emptyDEMTexture):$=this.emptyDEMTexture,y.activeTexture.set(v.TEXTURE2),$&&(S.u_dem_size=(V=$).size[0]===1?1:V.size[0]-2,$.bind(j(A),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,l,S),p&&p.useMeterToDem&&A){const q=(1<<A.tileID.canonical.z)*o.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=q}if(p&&p.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(y,S),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(y,q)}}globeUniformValues(n,l,p){const y=n.projection;return{u_tile_tl_up:y.upVector(l,0,0),u_tile_tr_up:y.upVector(l,o.ag,0),u_tile_br_up:y.upVector(l,o.ag,o.ag),u_tile_bl_up:y.upVector(l,0,o.ag),u_tile_up_scale:p?o.cL(1):y.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,v,S,A,D){if(y.transform.projection.name==="globe")(function(N,j,$,V,q){const ie=N.context,ne=ie.gl;let le,ce;const fe=N.transform,ve=o.cC(N,ie,fe),_e=(Oe,$e)=>{if(ce===$e)return;const ht=[kl[$e],"PROJECTION_GLOBE_VIEW"];ve&&ht.push("CUSTOM_ANTIALIASING");const xt=N.isTileAffectedByFog(Oe);le=N.getOrCreateProgram("globeRaster",{defines:ht,overrideFog:xt}),ce=$e},Te=N.colorModeForRenderPass(),we=new sr(ne.LEQUAL,sr.ReadWrite,N.depthRangeFor3D);Il.update(q);const Se=o.cD(fe),be=[o.at(fe.center.lng),o.aA(fe.center.lat)],ke=N.globeSharedBuffers,ze=[fe.width*o.q.devicePixelRatio,fe.height*o.q.devicePixelRatio],tt=Float32Array.from(fe.globeMatrix),Xe={useDenormalizedUpVectorScale:!0};{const Oe=N.transform,$e=l_(Oe.zoom,j.exaggeration(),j.sourceCache._source.tileSize);ce=-1;const ht=ne.TRIANGLES;for(const xt of V){const Pt=$.getTile(xt),Ye=Er.disabled,mt=j.prevTerrainTileForTile[xt.key],ot=j.terrainTileForTile[xt.key];a_(mt,ot)&&Il.newMorphing(xt.key,mt,ot,q,250),ie.activeTexture.set(ne.TEXTURE0),Pt.texture&&Pt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const Tt=Il.getMorphValuesForProxy(xt.key),gt=Tt?1:0;Tt&&o.J(Xe,{morphing:{srcDemTile:Tt.from,dstDemTile:Tt.to,phase:o.cB(Tt.phase)}});const ft=o.cE(xt.canonical),zt=o.cF(ft.getCenter().lat),Ft=o.cG(xt.canonical,ft,zt,Oe.worldSize/Oe._pixelsPerMercatorPixel),Dt=o.bb(o.cH(xt.canonical)),$t=s_(Oe.expandedFarZProjMatrix,tt,Se,Dt,o.ae(Oe.zoom),be,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,ze,$e,Oe._farZ,Ft);if(_e(xt,gt),le&&(j.setupElevationDraw(Pt,le,Xe),N.uploadCommonUniforms(ie,le,xt.toUnwrapped()),ke)){const[vr,lr,ar]=ke.getGridBuffers(zt,$e!==0);le.draw(N,ht,we,Ye,Te,mr.backCCW,$t,"globe_raster",vr,lr,ar)}}}if(ke&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const Oe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ve&&Oe.push("CUSTOM_ANTIALIASING"),le=N.getOrCreateProgram("globeRaster",{defines:Oe});for(const $e of V){const{x:ht,y:xt,z:Pt}=$e.canonical,Ye=xt===0,mt=xt===(1<<Pt)-1,[ot,Tt,gt,ft]=ke.getPoleBuffers(Pt,!1);if(ft&&(Ye||mt)){const zt=$.getTile($e);ie.activeTexture.set(ne.TEXTURE0),zt.texture&&zt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Ft=o.cI(Pt,ht,fe);const Dt=o.bb(o.cH($e.canonical)),$t=(vr,lr)=>vr.draw(N,ne.TRIANGLES,we,Er.disabled,Te,mr.disabled,s_(fe.expandedFarZProjMatrix,Ft,Ft,Dt,0,be,fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.globeCenterInViewSpace,fe.globeRadius,ze,0,fe._farZ),"globe_pole_raster",lr,gt,ft);j.setupElevationDraw(zt,le,Xe),N.uploadCommonUniforms(ie,le,$e.toUnwrapped()),Ye&&N.renderDefaultNorthPole&&$t(le,ot),mt&&N.renderDefaultSouthPole&&(Ft=o.ab.mat4.scale(o.ab.mat4.create(),Ft,[1,-1,1]),$t(le,Tt))}}}})(y,v,S,A,D);else{const N=y.context,j=N.gl;let $,V;const q=y.shadowRenderer,ie=Ua(y,y.longestCutoffRange),ne=Te=>{if(V===Te)return;const we=[];we.push(kl[Te]),ie.shouldRenderCutoff&&we.push("RENDER_CUTOFF"),q&&(we.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&we.push("NORMAL_OFFSET")),$=y.getOrCreateProgram("terrainRaster",{defines:we}),V=Te},le=y.colorModeForRenderPass(),ce=new sr(j.LEQUAL,sr.ReadWrite,y.depthRangeFor3D);Il.update(D);const fe=y.transform,ve=l_(fe.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let _e=[0,0,0];if(q){const Te=y.style.directionalLight,we=y.style.ambientLight;Te&&we&&(_e=yu(y.style,Te,we))}{V=-1;const Te=j.TRIANGLES,[we,Se]=[v.gridIndexBuffer,v.gridSegments];for(const be of A){const ke=S.getTile(be),ze=Er.disabled,tt=v.prevTerrainTileForTile[be.key],Xe=v.terrainTileForTile[be.key];a_(tt,Xe)&&Il.newMorphing(be.key,tt,Xe,D,250),N.activeTexture.set(j.TEXTURE0),ke.texture&&ke.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Oe=Il.getMorphValuesForProxy(be.key),$e=Oe?1:0;let ht;Oe&&(ht={morphing:{srcDemTile:Oe.from,dstDemTile:Oe.to,phase:o.cB(Oe.phase)}});const xt=Ov(be.projMatrix,Rl(be.canonical,fe.renderWorldCopies)?ve/10:ve,_e);if(ne($e),!$)continue;v.setupElevationDraw(ke,$,ht);const Pt=be.toUnwrapped();q&&q.setupShadows(Pt,$),y.uploadCommonUniforms(N,$,Pt,null,ie),$.draw(y,Te,ce,ze,le,mr.backCCW,xt,"terrain_raster",v.gridBuffer,we,Se)}}}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],S=this._drapedRenderBatches.shift(),A=l.style.order,D=[];let N=0;for(const j of v){const $=y.getTileByID(j.proxyTileKey),V=y.proxyCachedFBO[j.key]?y.proxyCachedFBO[j.key][n]:void 0,q=V!==void 0?y.renderCache[V]:this.pool[N++],ie=V!==void 0;if($.texture=q.tex,ie&&!q.dirty){D.push($.tileID);continue}let ne;p.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(p.clear({color:o.aj.transparent,stencil:0}),q.dirty=!1);for(let le=S.start;le<=S.end;++le){const ce=l.style._mergedLayers[A[le]];if(ce.isHidden(l.transform.zoom))continue;const fe=l.style.getLayerSourceCache(ce),ve=fe?this.proxyToSource[j.key][fe.id]:[j];if(!ve)continue;const _e=ve;p.viewport.set([0,0,q.fb.width,q.fb.height]),ne!==(fe?fe.id:null)&&(this._setupStencil(q,ve,ce,fe),ne=fe?fe.id:null),l.renderLayer(l,fe,ce,_e)}if(this._drapedRenderBatches.length===0)for(const le of this._pendingGroundEffectLayers){const ce=l.style._mergedLayers[A[le]];if(ce.isHidden(l.transform.zoom))continue;const fe=l.style.getLayerSourceCache(ce),ve=fe?this.proxyToSource[j.key][fe.id]:[j];if(!ve)continue;const _e=ve;p.viewport.set([0,0,q.fb.width,q.fb.height]),ne!==(fe?fe.id:null)&&(this._setupStencil(q,ve,ce,fe),ne=fe?fe.id:null),l.renderLayer(l,fe,ce,_e)}this.renderedToTile?(q.dirty=!0,D.push($.tileID)):ie||--N,N===5&&(N=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),S.end+1}postRender(){}isLayerOrderingCorrect(n){const l=n.order.length;let p=-1,y=l;for(let v=0;v<l;++v)this._style.isLayerDraped(n._mergedLayers[n.order[v]])?p=Math.max(p,v):y=Math.min(y,v);return y>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const S=v.tileID,A=1<<S.overscaledZ,{x:D,y:N}=S.canonical,j=D/A,$=(D+1)/A,V=N/A,q=(N+1)/A;return{minx:j,miny:V,maxx:$,maxy:q,t:v.dem.tree.raycastRoot(j,V,$,q,n,l,p),tile:v}});y.sort((v,S)=>(v.t!==null?v.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const v of y){if(v.t==null)return null;const S=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,n,l,p);if(S!=null)return S}return null}_createFBO(){const n=this.painter.context,l=n.gl,p=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const y=new o.T(n,{width:p[0],height:p[1],data:null},l.RGBA8);y.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=n.createFramebuffer(p[0],p[1],!0,null);return v.colorAttachment.set(y.texture),v.depthAttachment=new Su(n,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._mergedLayers[n],p=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof Of){n=!0;break}if(!n)return;const l={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(y);if(v&&!l[v.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof o.a9){l[v.id]=!0;for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][v.id];if(A)for(const D of A)this._clearRenderCacheForTile(v.id,D)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof cu){n=!0;break}if(!n)return;const l={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(y);if(!v||l[v.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const S=y.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const D=this.proxyToSource[A.key][v.id];if(D)for(const N of D){const j=Tu(v.getTile(N),v.findLoadedParent(N,0),v,this.painter.transform,S);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(v.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,l=n.length;if(l===0)return;const p=[];this._pendingGroundEffectLayers=[];let y,v=0,S=this._style._mergedLayers[n[v]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++v<l;)S=this._style._mergedLayers[n[v]];for(;v<l;++v){const A=this._style._mergedLayers[n[v]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?y===void 0&&(y=v):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),y!==void 0&&(p.push({start:y,end:v-1}),y=void 0)))}if(y!==void 0&&p.push({start:y,end:v-1}),p.length!==0){const A=p[p.length-1];this._pendingGroundEffectLayers.every(D=>D>A.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const S=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let A=0;A<S.length;++A){const D=Object.values(S[A]);l.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let S=p.length-1;S>=0;S--){const A=p[S];if(l.getTileByID(A.key),l.proxyCachedFBO[A.key]!==void 0){const D=n[A.key],N=this.proxyToSource[A.key];let j=0;for(const $ in N){const V=N[$],q=D[$];if(!q||q.length!==V.length||V.some((ie,ne)=>ie!==q[ne]||y[$]&&y[$].hasOwnProperty(ie.key))){j=-1;break}++j}for(const $ in l.proxyCachedFBO[A.key])l.renderCache[l.proxyCachedFBO[A.key][$]].dirty=j<0||j!==Object.values(D).length}}const v=[...this._drapedRenderBatches];v.sort((S,A)=>A.end-A.start-(S.end-S.start));for(const S of v)for(const A of p){if(l.proxyCachedFBO[A.key])continue;let D=l.renderCachePool.pop();D===void 0&&l.renderCache.length<50&&(D=l.renderCache.length,l.renderCache.push(this._createFBO())),D!==void 0&&(l.proxyCachedFBO[A.key]={},l.proxyCachedFBO[A.key][S.start]=D,l.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,S=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let A;if(p.isTileClipped())A=l.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Er.disabled}_renderTileClippingMasks(n,l){const p=this.painter,y=this.painter.context,v=y.gl;p._tileClippingMaskIDs={},y.setColorMode(Or.disabled),y.setDepthMode(sr.disabled);const S=p.getOrCreateProgram("clippingMask");for(const A of n){const D=p._tileClippingMaskIDs[A.key]=--l;S.draw(p,v.TRIANGLES,sr.disabled,new Er({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Or.disabled,mr.disabled,dh(A.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const p=[n.x,n.y,1,1];o.ab.vec4.transformMat4(p,p,l.pixelMatrixInverse),o.ab.vec4.scale(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const y=l._camera.position,v=o.bH(1,l.center.lat),S=[y[0],y[1],y[2]/v,0],A=o.ab.vec3.subtract([],p.slice(0,3),S);o.ab.vec3.normalize(A,A);const D=this.raycast(S,A,this._exaggeration);return D!==null&&D?(o.ab.vec3.scaleAndAdd(S,S,A,D),S[3]=S[2],S[2]*=v,S):null}_setupProxiedCoordsForOrtho(n,l,p){if(n.getSource()instanceof o.aJ)return this._setupProxiedCoordsForImageSource(n,l,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],v=this.proxyCoords;for(let D=0;D<v.length;D++){const N=v[D],j=this._findTileCoveringTileID(N,n);if(j){const $=this._createProxiedId(N,j,p[N.key]&&p[N.key][n.id]);y.push($),this.proxyToSource[N.key][n.id]=[$]}}let S=!1;const A=new Set;for(let D=0;D<l.length;D++){const N=n.getTile(l[D]);if(!N||!N.hasData())continue;const j=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==N.tileID.canonical.z){const $=this.proxyToSource[j.tileID.key][n.id],V=this._createProxiedId(j.tileID,N,p[j.tileID.key]&&p[j.tileID.key][n.id]);$?$.splice($.length-1,0,V):this.proxyToSource[j.tileID.key][n.id]=[V];const q=this.proxyToSource[j.tileID.key][n.id];A.has(q)||A.add(q),y.push(V),S=!0}}if(this._sourceTilesOverlap[n.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const D of A)D.sort((N,j)=>j.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(n,l,p){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],v=this.proxyCoords,S=n.getSource(),A=S.tileID;if(!A)return;const D=new o.P(A.x,A.y)._div(1<<A.z),N=S.coordinates.map(o.aa.fromLngLat).reduce(($,V)=>($.min.x=Math.min($.min.x,V.x-D.x),$.min.y=Math.min($.min.y,V.y-D.y),$.max.x=Math.max($.max.x,V.x-D.x),$.max.y=Math.max($.max.y,V.y-D.y),$),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=($,V)=>{const q=$.wrap+$.canonical.x/(1<<$.canonical.z),ie=$.canonical.y/(1<<$.canonical.z),ne=o.ag/(1<<$.canonical.z),le=V.wrap+V.canonical.x/(1<<V.canonical.z),ce=V.canonical.y/(1<<V.canonical.z);return q+ne<le+N.min.x||q>le+N.max.x||ie+ne<ce+N.min.y||ie>ce+N.max.y};for(let $=0;$<v.length;$++){const V=v[$];for(let q=0;q<l.length;q++){const ie=n.getTile(l[q]);if(!ie||!ie.hasData()||j(V,ie.tileID))continue;const ne=this._createProxiedId(V,ie,p[V.key]&&p[V.key][n.id]),le=this.proxyToSource[V.key][n.id];le?le.push(ne):this.proxyToSource[V.key][n.id]=[ne],y.push(ne)}}}_createProxiedId(n,l,p){let y=this.orthoMatrix;if(p){const v=p.find(S=>S.key===l.tileID.key);if(v)return v}if(l.tileID.key!==n.key){const v=n.canonical.z-l.tileID.canonical.z;let S,A,D;y=o.ab.mat4.create();const N=l.tileID.wrap-n.wrap<<n.overscaledZ;v>0?(S=o.ag>>v,A=S*((l.tileID.canonical.x<<v)-n.canonical.x+N),D=S*((l.tileID.canonical.y<<v)-n.canonical.y)):(S=o.ag<<-v,A=o.ag*(l.tileID.canonical.x-(n.canonical.x+N<<-v)),D=o.ag*(l.tileID.canonical.y-(n.canonical.y<<-v))),o.ab.mat4.ortho(y,0,S,0,S,0,1),o.ab.mat4.translate(y,y,[A,D,0])}return new dp(l.tileID,n.key,y)}_findTileCoveringTileID(n,l){let p=l.getTile(n);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[l.id],v=y[n.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||v===null)return p;let S=p?p.tileID:n,A=S.overscaledZ;const D=l.getSource().minzoom,N=[];if(!v){const $=l.getSource().maxzoom;if(n.canonical.z>=$){const V=n.canonical.z-$;l.getSource().reparseOverscaled?(A=Math.max(n.canonical.z+2,l.transform.tileZoom),S=new o.aG(A,n.wrap,$,n.canonical.x>>V,n.canonical.y>>V)):V!==0&&(A=$,S=new o.aG(A,n.wrap,$,n.canonical.x>>V,n.canonical.y>>V))}S.key!==n.key&&(N.push(S.key),p=l.getTile(S))}const j=$=>{N.forEach(V=>{y[V]=$}),N.length=0};for(A-=1;A>=D&&(!p||!p.hasData());A--){p&&j(p.tileID.key);const $=S.calculateScaledKey(A);if(p=l.getTileByID($),p&&p.hasData())break;const V=y[$];if(V===null)break;V===void 0?N.push($):p=l.getTileByID(V)}return j(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[l.key]=!0}}function w2(f,n,l){const p=function(A,D,N){const j=o.ab.vec3.dot(D,A),$=o.ab.vec3.dot(N,[.2126,.7152,.0722]),V=(ie,ne,le)=>(1-le)*ie+le*ne,q=V(1-.3*Math.min($,1),1,Math.min(j+1,1));return V(.92,1,Math.asin(o.aw(D[2],-1,1))/Math.PI+.5)*q}(f,[0,0,1],n),y=[0,0,0];o.ab.vec3.scale(y,l.slice(0,3),p);const v=[0,0,0];o.ab.vec3.scale(v,n.slice(0,3),f[2]);const S=[0,0,0];return o.ab.vec3.add(S,y,v),o.cf(S)}const Fv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],hh=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class jv{static cacheKey(n,l,p,y){let v=`${l}${y?y.cacheKey:""}`;for(const S of p)n.usedDefines.includes(S)&&(v+=`/${S}`);return v}constructor(n,l,p,y,v,S){const A=n.gl;this.program=A.createProgram(),this.configuration=y,this.name=l,this.fixedDefines=[...S];const D=y?y.getBinderAttributes():[],N=(p.staticAttributes||[]).concat(D);let j=y?y.defines():[];j=j.concat(S.map(le=>`#define ${le}`));const $=`#version 300 es
`;let V=$+j.concat("precision mediump float;",op,ah.fragmentSource).join(`
`);for(const le of p.fragmentIncludes)V+=`
${xc[le]}`;V+=`
${p.fragmentSource}`;let q=$+j.concat("precision highp float;",op,ah.vertexSource).join(`
`);for(const le of p.vertexIncludes)q+=`
${xc[le]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(q+=`
uniform int u_instanceID;
`),q+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(q=q.replaceAll("gl_InstanceID","u_instanceID"));const ie=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ie,V),A.compileShader(ie),A.attachShader(this.program,ie);const ne=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(ne,q),A.compileShader(ne),A.attachShader(this.program,ne),this.attributes={},this.numAttributes=N.length;for(let le=0;le<this.numAttributes;le++)if(N[le]){const ce=N[le].startsWith("a_")?N[le]:`a_${N[le]}`;A.bindAttribLocation(this.program,le,ce),this.attributes[ce]=le}A.linkProgram(this.program),A.deleteShader(ne),A.deleteShader(ie),this.fixedUniforms=v(n),this.binderUniforms=y?y.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(le=>({u_instanceID:new o.bN(le)}))(n)),(S.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(le=>({u_dem:new o.bN(le),u_dem_prev:new o.bN(le),u_dem_tl:new o.bK(le),u_dem_scale:new o.bM(le),u_dem_tl_prev:new o.bK(le),u_dem_scale_prev:new o.bM(le),u_dem_size:new o.bM(le),u_dem_lerp:new o.bM(le),u_exaggeration:new o.bM(le),u_depth:new o.bN(le),u_depth_size_inv:new o.bK(le),u_depth_range_unpack:new o.bK(le),u_occluder_half_size:new o.bM(le),u_occlusion_depth_offset:new o.bM(le),u_meter_to_dem:new o.bM(le),u_label_plane_matrix_inv:new o.bJ(le)}))(n)),S.includes("GLOBE")&&(this.globeUniforms=(le=>({u_tile_tl_up:new o.bL(le),u_tile_tr_up:new o.bL(le),u_tile_br_up:new o.bL(le),u_tile_bl_up:new o.bL(le),u_tile_up_scale:new o.bM(le)}))(n)),S.includes("FOG")&&(this.fogUniforms=(le=>({u_fog_matrix:new o.bJ(le),u_fog_range:new o.bK(le),u_fog_color:new o.ca(le),u_fog_horizon_blend:new o.bM(le),u_fog_vertical_limit:new o.bK(le),u_fog_temporal_offset:new o.bM(le),u_frustum_tl:new o.bL(le),u_frustum_tr:new o.bL(le),u_frustum_br:new o.bL(le),u_frustum_bl:new o.bL(le),u_globe_pos:new o.bL(le),u_globe_radius:new o.bM(le),u_globe_transition:new o.bM(le),u_is_globe:new o.bN(le),u_viewport:new o.bK(le)}))(n)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(le=>({u_cutoff_params:new o.ca(le)}))(n)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(le=>({u_lighting_ambient_color:new o.bL(le),u_lighting_directional_dir:new o.bL(le),u_lighting_directional_color:new o.bL(le),u_ground_radiance:new o.bL(le)}))(n)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(le=>({u_light_matrix_0:new o.bJ(le),u_light_matrix_1:new o.bJ(le),u_fade_range:new o.bK(le),u_shadow_normal_offset:new o.bL(le),u_shadow_intensity:new o.bM(le),u_shadow_texel_size:new o.bM(le),u_shadow_map_resolution:new o.bM(le),u_shadow_direction:new o.bL(le),u_shadow_bias:new o.bL(le),u_shadowmap_0:new o.bN(le),u_shadowmap_1:new o.bN(le)}))(n))}}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)p[y]&&p[y].set(this.program,y,l[y])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)p[y]&&p[y].set(this.program,y,l[y])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setCutoffUniformValues(n,l){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setLightsUniformValues(n,l){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setShadowUniformValues(n,l){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}_drawDebugWireframe(n,l,p,y,v,S,A,D,N,j){const $=n.options.wireframe;if($.terrain===!1&&$.layers2D===!1&&$.layers3D===!1)return;const V=n.context;if(!(!(!$.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!$.layers2D||n._terrain&&n._terrain.renderingToTexture||!Fv.includes(this.name))||!(!$.layers3D||!hh.includes(this.name))))return;const q=V.gl,ie=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,v,V);if(!ie)return;const ne=[...this.fixedDefines];ne.push("DEBUG_WIREFRAME");const le=n.getOrCreateProgram(this.name,{config:this.configuration,defines:ne});V.program.set(le.program);const ce=(_e,Te,we)=>{if(Te[_e]&&we[_e])for(const Se in Te[_e])we[_e][Se]&&we[_e][Se].set(we.program,Se,Te[_e][Se].current)};N&&N.setUniforms(le.program,V,le.binderUniforms,A,{zoom:D}),ce("fixedUniforms",this,le),ce("terrainUniforms",this,le),ce("globeUniforms",this,le),ce("fogUniforms",this,le),ce("lightsUniforms",this,le),ce("shadowUniforms",this,le),ie.bind(),V.setColorMode(new Or([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],o.aj.transparent,[!0,!0,!0,!1])),V.setDepthMode(new sr(l.func===q.LESS?q.LEQUAL:l.func,sr.ReadOnly,l.range)),V.setStencilMode(Er.disabled);const fe=3*S.primitiveLength*2,ve=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const _e=j||1;for(let Te=0;Te<_e;++Te)le.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),q.drawElements(q.LINES,fe,q.UNSIGNED_SHORT,ve)}else j&&j>1?q.drawElementsInstanced(q.LINES,fe,q.UNSIGNED_SHORT,ve,j):q.drawElements(q.LINES,fe,q.UNSIGNED_SHORT,ve);v.bind(),V.program.set(this.program),V.setDepthMode(l),V.setStencilMode(p),V.setColorMode(y)}checkUniforms(n,l,p){if(this.fixedDefines.includes(l)){for(const y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${y} not set but required by ${l} being defined`)}}draw(n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le){const ce=n.context,fe=ce.gl;if(this.failedToCreate)return;ce.program.set(this.program),ce.setDepthMode(p),ce.setStencilMode(y),ce.setColorMode(v),ce.setCullFace(S);for(const Te of Object.keys(this.fixedUniforms))this.fixedUniforms[Te].set(this.program,Te,A[Te]);ie&&ie.setUniforms(this.program,ce,this.binderUniforms,V,{zoom:q});const ve={[fe.POINTS]:1,[fe.LINES]:2,[fe.TRIANGLES]:3,[fe.LINE_STRIP]:1}[l];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const _e=le&&le>0?1:void 0;for(const Te of $.get()){const we=Te.vaos||(Te.vaos={});if((we[D]||(we[D]=new lh)).bind(ce,this,N,ie?ie.getPaintVertexBuffers():[],j,Te.vertexOffset,ne||[],_e),this.forceManualRenderingForInstanceIDShaders){const Se=le||1;for(let be=0;be<Se;++be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),j?fe.drawElements(l,Te.primitiveLength*ve,fe.UNSIGNED_SHORT,Te.primitiveOffset*ve*2):fe.drawArrays(l,Te.vertexOffset,Te.vertexLength)}else le&&le>1?fe.drawElementsInstanced(l,Te.primitiveLength*ve,fe.UNSIGNED_SHORT,Te.primitiveOffset*ve*2,le):j?fe.drawElements(l,Te.primitiveLength*ve,fe.UNSIGNED_SHORT,Te.primitiveOffset*ve*2):fe.drawArrays(l,Te.vertexOffset,Te.vertexLength);l===fe.TRIANGLES&&j&&this._drawDebugWireframe(n,p,y,v,j,Te,V,q,ie,le)}}}function Bv(f,n){const l=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,f.transform.tileZoom)/l,y=p*(n.tileID.canonical.x+n.tileID.wrap*l),v=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ar(n,1,f.transform.tileZoom),u_pixel_coord_upper:[y>>16,v>>16],u_pixel_coord_lower:[65535&y,65535&v]}}const fh={terrain:0,flat:1},S2=o.ab.mat4.create(),fp=(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le,ce)=>{const fe=n.style.light,ve=fe.properties.get("position"),_e=[ve.x,ve.y,ve.z],Te=o.ab.mat3.create();fe.properties.get("anchor")==="viewport"&&(o.ab.mat3.fromRotation(Te,-n.transform.angle),o.ab.vec3.transformMat3(_e,_e,Te));const we=fe.properties.get("color"),Se=n.transform,be={u_matrix:f,u_lightpos:_e,u_lightintensity:fe.properties.get("intensity"),u_lightcolor:[we.r,we.g,we.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:S2,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:fh[N],u_base_type:fh[j],u_ao:y,u_edge_radius:v,u_width_scale:S,u_flood_light_color:ie,u_vertical_scale:ne,u_flood_light_intensity:le,u_ground_shadow_factor:ce};return Se.projection.name==="globe"&&(be.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],be.u_zoom_transition=$,be.u_inv_rot_matrix=q,be.u_merc_center=V,be.u_up_dir=Se.projection.upVector(new o.bT(0,0,0),V[0]*o.ag,V[1]*o.ag),be.u_height_lift=D),be},c_=(f,n,l,p,y,v)=>({u_matrix:f,u_edge_radius:n,u_width_scale:l,u_vertical_scale:p,u_height_type:fh[y],u_base_type:fh[v]}),ph=(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le)=>{const ce=fp(f,n,l,p,y,v,S,A,N,j,$,V,q,ie,ne,le,1,[0,0,0]),fe={u_height_factor:-Math.pow(2,A.overscaledZ)/D.tileSize/8};return o.l(ce,Bv(n,D),fe)},pp=(f,n)=>({u_matrix:f,u_emissive_strength:n}),Eu=(f,n,l,p)=>o.l(pp(f,n),Bv(l,p)),Uv=(f,n,l)=>({u_matrix:f,u_world:l,u_emissive_strength:n}),mp=(f,n,l,p,y)=>o.l(Eu(f,n,l,p),{u_world:y}),gp=(f,n,l,p)=>{const y=o.ag/l.tileSize;return{u_matrix:f,u_camera_to_center_distance:n.getCameraToCenterDistance(p),u_extrude_scale:[n.pixelsToGLUnits[0]/y,n.pixelsToGLUnits[1]/y]}},_p=(f,n,l=1)=>({u_matrix:f,u_color:n.toRenderColor(null),u_overlay:0,u_overlay_scale:l}),Vv=o.ab.mat4.create(),T2=(f,n,l,p,y,v,S)=>{const A=f.transform,D=A.projection.name==="globe",N=D?o.cN(A.zoom,n.canonical)*A._pixelsPerMercatorPixel:o.ar(l,1,v),j={u_matrix:n.projMatrix,u_extrude_scale:N,u_intensity:S,u_inv_rot_matrix:Vv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){j.u_inv_rot_matrix=p,j.u_merc_center=y,j.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],j.u_zoom_transition=o.ae(A.zoom);const $=y[0]*o.ag,V=y[1]*o.ag;j.u_up_dir=A.projection.upVector(new o.bT(0,0,0),$,V)}return j};function bc(f,[n,l,p,y],[v,S]){if(v===S)return[0,0,0,0];const A=255*(f-1)/(f*(S-v));return[n*A,l*A,p*A,y*A]}function mh(f,n,[l,p]){return l===p?0:.5/f+(n-l)*(f-1)/(f*(p-l))}const qt=(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le,ce,fe,ve,_e)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:N,u_fade_t:j.mix,u_opacity:j.opacity*$.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:$.paint.get("raster-brightness-min"),u_brightness_high:$.paint.get("raster-brightness-max"),u_saturation_factor:o.cO($.paint.get("raster-saturation")),u_contrast_factor:o.cP($.paint.get("raster-contrast")),u_spin_weights:$v($.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:q,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:D,u_colorization_mix:bc(o.cQ,ne,ce),u_colorization_offset:mh(o.cQ,le,ce),u_color_ramp:ie,u_texture_offset:[ve/(fe+2*ve),fe/(fe+2*ve)],u_texture_res:[fe+2*ve,fe+2*ve],u_emissive_strength:_e});function $v(f){f*=Math.PI/180;const n=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const wc=.05,Sc=(f,n,l,p,y,v,S,A,D,N,j,$)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:N,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:$,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:D}),Tc=(f,n,l,p,y,v,S,A,D,N)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_tile_offset:l,u_velocity:p,u_color_ramp:v,u_velocity_res:y,u_max_speed:S,u_uv_offset:A,u_data_scale:[255*D[0],255*D[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[wc,wc]}),nr=(f,n,l,p,y,v,S,A,D,N)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_velocity:l,u_velocity_res:p,u_max_speed:y,u_speed_factor:v,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*D[0],255*D[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[wc,wc]}),yp=o.ab.mat4.create(),Gv=(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le,ce,fe,ve,_e,Te)=>{const we=y.transform,Se={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:we.getCameraToCenterDistance(fe),u_rotate_symbol:+l,u_aspect_ratio:we.width/we.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+N,u_elevation_from_sea:D?1:0,u_pitch_with_map:+p,u_texsize:j,u_texsize_icon:$,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:yp,u_up_vector:[0,-1,0],u_color_adj_mat:ve,u_icon_transition:_e||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(fe)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:+V,u_scale_factor:Te||1};return fe.name==="globe"&&(Se.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],Se.u_zoom_transition=ie,Se.u_inv_rot_matrix=le,Se.u_merc_center=ne,Se.u_camera_forward=we._camera.forward(),Se.u_ecef_origin=o.cR(we.globeMatrix,q.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(we.globeMatrix),Se.u_up_vector=ce),Se},Hv=(f,n,l,p)=>({u_matrix:f,u_emissive_strength:n,u_opacity:l,u_color:p}),vp=(f,n,l,p,y,v,S,A,D)=>o.l(function(N,j,$,V,q,ie){const{width:ne,height:le}=V.imageManager.getPixelSize(j),ce=Math.pow(2,ie.tileID.overscaledZ),fe=ie.tileSize*Math.pow(2,V.transform.tileZoom)/ce,ve=fe*(ie.tileID.canonical.x+ie.tileID.wrap*ce),_e=fe*ie.tileID.canonical.y;return{u_image:0,u_pattern_tl:$.tl,u_pattern_br:$.br,u_texsize:[ne,le],u_pattern_size:$.displaySize,u_pattern_units_to_pixels:q?[V.transform.width,-1*V.transform.height]:[1/o.ar(ie,1,V.transform.tileZoom),1/o.ar(ie,1,V.transform.tileZoom)],u_pixel_coord_upper:[ve>>16,_e>>16],u_pixel_coord_lower:[65535&ve,65535&_e]}}(0,v,S,p,A,D),{u_matrix:f,u_emissive_strength:n,u_opacity:l}),xp=new Float32Array(o.ab.mat4.identity([])),bp=(f,n,l,p,y,v,S,A,D,N,j,$,V,q=[0,0,0],ie)=>{const ne=y.style.light,le=ne.properties.get("position"),ce=[-le.x,-le.y,le.z],fe=o.ab.mat3.create();ne.properties.get("anchor")==="viewport"&&(o.ab.mat3.fromRotation(fe,-y.transform.angle),o.ab.vec3.transformMat3(ce,ce,fe));const ve=j.alphaMode==="MASK",_e=ne.properties.get("color").toRenderColor(null),Te=V.paint.get("model-ambient-occlusion-intensity"),we=V.paint.get("model-color").constantOr(o.aj.white).toRenderColor(null),Se=V.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:n,u_normal_matrix:l,u_node_matrix:p||xp,u_lightpos:ce,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:q,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+ve,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:D,u_roughnessFactor:N,u_baseColorTexture:to.BaseColor,u_metallicRoughnessTexture:to.MetallicRoughness,u_normalTexture:to.Normal,u_occlusionTexture:to.Occlusion,u_emissionTexture:to.Emission,u_lutTexture:to.LUT,u_color_mix:[we.r,we.g,we.b,Se],u_aoIntensity:Te,u_emissive_strength:$,u_occlusionTextureTransform:ie||[0,0,0,0]}},qv=(f,n=xp,l=xp)=>({u_matrix:f,u_instance:n,u_node_matrix:l}),E2={fillExtrusion:f=>({u_matrix:new o.bJ(f),u_lightpos:new o.bL(f),u_lightintensity:new o.bM(f),u_lightcolor:new o.bL(f),u_vertical_gradient:new o.bM(f),u_opacity:new o.bM(f),u_edge_radius:new o.bM(f),u_width_scale:new o.bM(f),u_ao:new o.bK(f),u_height_type:new o.bN(f),u_base_type:new o.bN(f),u_tile_id:new o.bL(f),u_zoom_transition:new o.bM(f),u_inv_rot_matrix:new o.bJ(f),u_merc_center:new o.bK(f),u_up_dir:new o.bL(f),u_height_lift:new o.bM(f),u_flood_light_color:new o.bL(f),u_vertical_scale:new o.bM(f),u_flood_light_intensity:new o.bM(f),u_ground_shadow_factor:new o.bL(f)}),fillExtrusionDepth:f=>({u_matrix:new o.bJ(f),u_edge_radius:new o.bM(f),u_width_scale:new o.bM(f),u_vertical_scale:new o.bM(f),u_height_type:new o.bN(f),u_base_type:new o.bN(f)}),fillExtrusionPattern:f=>({u_matrix:new o.bJ(f),u_lightpos:new o.bL(f),u_lightintensity:new o.bM(f),u_lightcolor:new o.bL(f),u_vertical_gradient:new o.bM(f),u_height_factor:new o.bM(f),u_edge_radius:new o.bM(f),u_width_scale:new o.bM(f),u_ao:new o.bK(f),u_height_type:new o.bN(f),u_base_type:new o.bN(f),u_tile_id:new o.bL(f),u_zoom_transition:new o.bM(f),u_inv_rot_matrix:new o.bJ(f),u_merc_center:new o.bK(f),u_up_dir:new o.bL(f),u_height_lift:new o.bM(f),u_image:new o.bN(f),u_texsize:new o.bK(f),u_pixel_coord_upper:new o.bK(f),u_pixel_coord_lower:new o.bK(f),u_tile_units_to_pixels:new o.bM(f),u_opacity:new o.bM(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new o.bJ(f),u_opacity:new o.bM(f),u_ao_pass:new o.bM(f),u_meter_to_tile:new o.bM(f),u_ao:new o.bK(f),u_flood_light_intensity:new o.bM(f),u_flood_light_color:new o.bL(f),u_attenuation:new o.bM(f),u_edge_radius:new o.bM(f),u_fb:new o.bN(f),u_fb_size:new o.bM(f),u_dynamic_offset:new o.bM(f)}),fill:f=>({u_matrix:new o.bJ(f),u_emissive_strength:new o.bM(f)}),fillPattern:f=>({u_matrix:new o.bJ(f),u_emissive_strength:new o.bM(f),u_image:new o.bN(f),u_texsize:new o.bK(f),u_pixel_coord_upper:new o.bK(f),u_pixel_coord_lower:new o.bK(f),u_tile_units_to_pixels:new o.bM(f)}),fillOutline:f=>({u_matrix:new o.bJ(f),u_emissive_strength:new o.bM(f),u_world:new o.bK(f)}),fillOutlinePattern:f=>({u_matrix:new o.bJ(f),u_emissive_strength:new o.bM(f),u_world:new o.bK(f),u_image:new o.bN(f),u_texsize:new o.bK(f),u_pixel_coord_upper:new o.bK(f),u_pixel_coord_lower:new o.bK(f),u_tile_units_to_pixels:new o.bM(f)}),circle:o.cS,collisionBox:f=>({u_matrix:new o.bJ(f),u_camera_to_center_distance:new o.bM(f),u_extrude_scale:new o.bK(f)}),collisionCircle:f=>({u_matrix:new o.bJ(f),u_inv_matrix:new o.bJ(f),u_camera_to_center_distance:new o.bM(f),u_viewport_size:new o.bK(f)}),debug:f=>({u_color:new o.cz(f),u_matrix:new o.bJ(f),u_overlay:new o.bN(f),u_overlay_scale:new o.bM(f)}),clippingMask:f=>({u_matrix:new o.bJ(f)}),heatmap:f=>({u_extrude_scale:new o.bM(f),u_intensity:new o.bM(f),u_matrix:new o.bJ(f),u_inv_rot_matrix:new o.bJ(f),u_merc_center:new o.bK(f),u_tile_id:new o.bL(f),u_zoom_transition:new o.bM(f),u_up_dir:new o.bL(f)}),heatmapTexture:f=>({u_image:new o.bN(f),u_color_ramp:new o.bN(f),u_opacity:new o.bM(f)}),hillshade:f=>({u_matrix:new o.bJ(f),u_image:new o.bN(f),u_latrange:new o.bK(f),u_light:new o.bK(f),u_shadow:new o.cz(f),u_highlight:new o.cz(f),u_emissive_strength:new o.bM(f),u_accent:new o.cz(f)}),hillshadePrepare:f=>({u_matrix:new o.bJ(f),u_image:new o.bN(f),u_dimension:new o.bK(f),u_zoom:new o.bM(f)}),line:o.cT,linePattern:o.cU,raster:f=>({u_matrix:new o.bJ(f),u_normalize_matrix:new o.bJ(f),u_globe_matrix:new o.bJ(f),u_merc_matrix:new o.bJ(f),u_grid_matrix:new o.cA(f),u_tl_parent:new o.bK(f),u_scale_parent:new o.bM(f),u_fade_t:new o.bM(f),u_opacity:new o.bM(f),u_image0:new o.bN(f),u_image1:new o.bN(f),u_brightness_low:new o.bM(f),u_brightness_high:new o.bM(f),u_saturation_factor:new o.bM(f),u_contrast_factor:new o.bM(f),u_spin_weights:new o.bL(f),u_perspective_transform:new o.bK(f),u_raster_elevation:new o.bM(f),u_zoom_transition:new o.bM(f),u_merc_center:new o.bK(f),u_cutoff_params:new o.ca(f),u_colorization_mix:new o.ca(f),u_colorization_offset:new o.bM(f),u_color_ramp:new o.bN(f),u_texture_offset:new o.bK(f),u_texture_res:new o.bK(f),u_emissive_strength:new o.bM(f)}),rasterParticle:f=>({u_matrix:new o.bJ(f),u_normalize_matrix:new o.bJ(f),u_globe_matrix:new o.bJ(f),u_merc_matrix:new o.bJ(f),u_grid_matrix:new o.cA(f),u_tl_parent:new o.bK(f),u_scale_parent:new o.bM(f),u_fade_t:new o.bM(f),u_opacity:new o.bM(f),u_image0:new o.bN(f),u_image1:new o.bN(f),u_raster_elevation:new o.bM(f),u_zoom_transition:new o.bM(f),u_merc_center:new o.bK(f),u_cutoff_params:new o.ca(f)}),rasterParticleTexture:f=>({u_texture:new o.bN(f),u_opacity:new o.bM(f)}),rasterParticleDraw:f=>({u_particle_texture:new o.bN(f),u_particle_texture_side_len:new o.bM(f),u_tile_offset:new o.bK(f),u_velocity:new o.bN(f),u_color_ramp:new o.bN(f),u_velocity_res:new o.bK(f),u_max_speed:new o.bM(f),u_uv_offset:new o.bK(f),u_data_scale:new o.bK(f),u_data_offset:new o.bM(f),u_particle_pos_scale:new o.bM(f),u_particle_pos_offset:new o.bK(f)}),rasterParticleUpdate:f=>({u_particle_texture:new o.bN(f),u_particle_texture_side_len:new o.bM(f),u_velocity:new o.bN(f),u_velocity_res:new o.bK(f),u_max_speed:new o.bM(f),u_speed_factor:new o.bM(f),u_reset_rate:new o.bM(f),u_rand_seed:new o.bM(f),u_uv_offset:new o.bK(f),u_data_scale:new o.bK(f),u_data_offset:new o.bM(f),u_particle_pos_scale:new o.bM(f),u_particle_pos_offset:new o.bK(f)}),symbol:f=>({u_is_size_zoom_constant:new o.bN(f),u_is_size_feature_constant:new o.bN(f),u_size_t:new o.bM(f),u_size:new o.bM(f),u_camera_to_center_distance:new o.bM(f),u_rotate_symbol:new o.bN(f),u_aspect_ratio:new o.bM(f),u_fade_change:new o.bM(f),u_matrix:new o.bJ(f),u_label_plane_matrix:new o.bJ(f),u_coord_matrix:new o.bJ(f),u_is_text:new o.bN(f),u_elevation_from_sea:new o.bN(f),u_pitch_with_map:new o.bN(f),u_texsize:new o.bK(f),u_texsize_icon:new o.bK(f),u_texture:new o.bN(f),u_texture_icon:new o.bN(f),u_gamma_scale:new o.bM(f),u_device_pixel_ratio:new o.bM(f),u_tile_id:new o.bL(f),u_zoom_transition:new o.bM(f),u_inv_rot_matrix:new o.bJ(f),u_merc_center:new o.bK(f),u_camera_forward:new o.bL(f),u_tile_matrix:new o.bJ(f),u_up_vector:new o.bL(f),u_ecef_origin:new o.bL(f),u_is_halo:new o.bN(f),u_icon_transition:new o.bM(f),u_color_adj_mat:new o.bJ(f),u_scale_factor:new o.bM(f)}),background:f=>({u_matrix:new o.bJ(f),u_emissive_strength:new o.bM(f),u_opacity:new o.bM(f),u_color:new o.cz(f)}),backgroundPattern:f=>({u_matrix:new o.bJ(f),u_emissive_strength:new o.bM(f),u_opacity:new o.bM(f),u_image:new o.bN(f),u_pattern_tl:new o.bK(f),u_pattern_br:new o.bK(f),u_texsize:new o.bK(f),u_pattern_size:new o.bK(f),u_pixel_coord_upper:new o.bK(f),u_pixel_coord_lower:new o.bK(f),u_pattern_units_to_pixels:new o.bK(f)}),terrainRaster:f=>({u_matrix:new o.bJ(f),u_image0:new o.bN(f),u_skirt_height:new o.bM(f),u_ground_shadow_factor:new o.bL(f)}),skybox:f=>({u_matrix:new o.bJ(f),u_sun_direction:new o.bL(f),u_cubemap:new o.bN(f),u_opacity:new o.bM(f),u_temporal_offset:new o.bM(f)}),skyboxGradient:f=>({u_matrix:new o.bJ(f),u_color_ramp:new o.bN(f),u_center_direction:new o.bL(f),u_radius:new o.bM(f),u_opacity:new o.bM(f),u_temporal_offset:new o.bM(f)}),skyboxCapture:f=>({u_matrix_3f:new o.cA(f),u_sun_direction:new o.bL(f),u_sun_intensity:new o.bM(f),u_color_tint_r:new o.ca(f),u_color_tint_m:new o.ca(f),u_luminance:new o.bM(f)}),globeRaster:f=>({u_proj_matrix:new o.bJ(f),u_globe_matrix:new o.bJ(f),u_normalize_matrix:new o.bJ(f),u_merc_matrix:new o.bJ(f),u_zoom_transition:new o.bM(f),u_merc_center:new o.bK(f),u_image0:new o.bN(f),u_grid_matrix:new o.cA(f),u_skirt_height:new o.bM(f),u_far_z_cutoff:new o.bM(f),u_frustum_tl:new o.bL(f),u_frustum_tr:new o.bL(f),u_frustum_br:new o.bL(f),u_frustum_bl:new o.bL(f),u_globe_pos:new o.bL(f),u_globe_radius:new o.bM(f),u_viewport:new o.bK(f)}),globeAtmosphere:f=>({u_frustum_tl:new o.bL(f),u_frustum_tr:new o.bL(f),u_frustum_br:new o.bL(f),u_frustum_bl:new o.bL(f),u_horizon:new o.bM(f),u_transition:new o.bM(f),u_fadeout_range:new o.bM(f),u_color:new o.ca(f),u_high_color:new o.ca(f),u_space_color:new o.ca(f),u_temporal_offset:new o.bM(f),u_horizon_angle:new o.bM(f)}),model:f=>({u_matrix:new o.bJ(f),u_lighting_matrix:new o.bJ(f),u_normal_matrix:new o.bJ(f),u_node_matrix:new o.bJ(f),u_lightpos:new o.bL(f),u_lightintensity:new o.bM(f),u_lightcolor:new o.bL(f),u_camera_pos:new o.bL(f),u_opacity:new o.bM(f),u_baseColorFactor:new o.ca(f),u_emissiveFactor:new o.ca(f),u_metallicFactor:new o.bM(f),u_roughnessFactor:new o.bM(f),u_baseTextureIsAlpha:new o.bN(f),u_alphaMask:new o.bN(f),u_alphaCutoff:new o.bM(f),u_baseColorTexture:new o.bN(f),u_metallicRoughnessTexture:new o.bN(f),u_normalTexture:new o.bN(f),u_occlusionTexture:new o.bN(f),u_emissionTexture:new o.bN(f),u_lutTexture:new o.bN(f),u_color_mix:new o.ca(f),u_aoIntensity:new o.bM(f),u_emissive_strength:new o.bM(f),u_occlusionTextureTransform:new o.ca(f)}),modelDepth:f=>({u_matrix:new o.bJ(f),u_instance:new o.bJ(f),u_node_matrix:new o.bJ(f)}),groundShadow:f=>({u_matrix:new o.bJ(f),u_ground_shadow_factor:new o.bL(f)}),stars:f=>({u_matrix:new o.bJ(f),u_up:new o.bL(f),u_right:new o.bL(f),u_intensity_multiplier:new o.bM(f)}),snowParticle:f=>({u_modelview:new o.bJ(f),u_projection:new o.bJ(f),u_time:new o.bM(f),u_cam_pos:new o.bL(f),u_velocityConeAperture:new o.bM(f),u_velocity:new o.bM(f),u_horizontalOscillationRadius:new o.bM(f),u_horizontalOscillationRate:new o.bM(f),u_boxSize:new o.bM(f),u_billboardSize:new o.bM(f),u_simpleShapeParameters:new o.bK(f),u_screenSize:new o.bK(f),u_thinningCenterPos:new o.bK(f),u_thinningShape:new o.bL(f),u_thinningAffectedRatio:new o.bM(f),u_thinningParticleOffset:new o.bM(f),u_particleColor:new o.ca(f),u_direction:new o.bL(f)}),rainParticle:f=>({u_modelview:new o.bJ(f),u_projection:new o.bJ(f),u_time:new o.bM(f),u_cam_pos:new o.bL(f),u_texScreen:new o.bN(f),u_velocityConeAperture:new o.bM(f),u_velocity:new o.bM(f),u_boxSize:new o.bM(f),u_rainDropletSize:new o.bK(f),u_distortionStrength:new o.bM(f),u_rainDirection:new o.bL(f),u_color:new o.ca(f),u_screenSize:new o.bK(f),u_thinningCenterPos:new o.bK(f),u_thinningShape:new o.bL(f),u_thinningAffectedRatio:new o.bM(f),u_thinningParticleOffset:new o.bM(f),u_shapeDirectionalPower:new o.bM(f),u_shapeNormalPower:new o.bM(f),u_mode:new o.bM(f)}),vignette:f=>({u_vignetteShape:new o.bL(f),u_vignetteColor:new o.ca(f)}),occlusion:f=>({u_matrix:new o.bJ(f),u_anchorPos:new o.bL(f),u_screenSizePx:new o.bK(f),u_occluderSizePx:new o.bK(f),u_color:new o.ca(f)})};class _a{constructor(n,l,p,y){this.id=_a.uniqueIdxCounter,_a.uniqueIdxCounter++,this.context=n;const v=n.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||y||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=_a.uniqueIdxCounter,_a.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}_a.uniqueIdxCounter=0;const u_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class d_{constructor(n,l,p,y,v,S){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.instanceCount=S,this.context=n;const A=n.gl;this.buffer=A.createBuffer(),n.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||v||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let p=0;p<this.attributes.length;p++){const y=l.attributes[this.attributes[p].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,l,p){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],S=l.attributes[v.name];S!==void 0&&n.vertexAttribPointer(S,v.components,n[u_[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,l,p){for(let y=0;y<this.attributes.length;y++){const v=l.attributes[this.attributes[y].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(v,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class wp{constructor(n,l,p,y,v){this.context=n,this.width=l,this.height=p;const S=this.framebuffer=n.gl.createFramebuffer();y&&(this.colorAttachment=new o_(n,S)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new up(n,S):new Lv(n,S))}destroy(){const n=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&n.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&n.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&n.deleteTexture(l)}n.deleteFramebuffer(this.framebuffer)}}class Yo{constructor(n,l){this.gl=n,this.clearColor=new f2(this),this.clearDepth=new p2(this),this.clearStencil=new m2(this),this.colorMask=new Yg(this),this.depthMask=new Xg(this),this.stencilMask=new Kg(this),this.stencilFunc=new Jg(this),this.stencilOp=new Av(this),this.stencilTest=new Iv(this),this.depthRange=new g2(this),this.depthTest=new ch(this),this.depthFunc=new uh(this),this.blend=new kv(this),this.blendFunc=new Zo(this),this.blendColor=new Qg(this),this.blendEquation=new sp(this),this.cullFace=new ap(this),this.cullFaceSide=new e_(this),this.frontFace=new t_(this),this.program=new lp(this),this.activeTexture=new r_(this),this.viewport=new n_(this),this.bindFramebuffer=new cp(this),this.bindRenderbuffer=new Rv(this),this.bindTexture=new Dv(this),this.bindVertexBuffer=new wu(this),this.bindElementBuffer=new _2(this),this.bindVertexArrayOES=new y2(this),this.pixelStoreUnpack=new v2(this),this.pixelStoreUnpackPremultiplyAlpha=new x2(this),this.pixelStoreUnpackFlipY=new b2(this),this.options=l?{...l}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l,p){return new _a(this,n,l,p)}createVertexBuffer(n,l,p,y,v){return new d_(this,n,l,p,y,v)}createRenderbuffer(n,l,p){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,n,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(n,l,p,y){return new wp(this,n,l,p,y)}clear({color:n,depth:l,stencil:p,colorMask:y}){const v=this.gl;let S=0;n&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(y||[!0,!0,!0,!0])),l!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),v.clear(S)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){o.bn(n.blendFunction,Or.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ys;function h_(f,n,l,p,y,v,S){const A=f.context,D=A.gl,N=f.transform,j=f.getOrCreateProgram("collisionBox"),$=[];let V=0,q=0;for(let _e=0;_e<p.length;_e++){const Te=p[_e],we=n.getTile(Te),Se=we.getBucket(l);if(!Se)continue;const be=pi(Te,Se,N);let ke=be;y[0]===0&&y[1]===0||(ke=f.translatePosMatrix(be,we,y,v));const ze=S?Se.textCollisionBox:Se.iconCollisionBox,tt=Se.collisionCircleArray;if(tt.length>0){const Xe=o.ab.mat4.create(),Oe=ke;o.ab.mat4.mul(Xe,Se.placementInvProjMatrix,N.glCoordMatrix),o.ab.mat4.mul(Xe,Xe,Se.placementViewportMatrix),$.push({circleArray:tt,circleOffset:q,transform:Oe,invTransform:Xe,projection:Se.getProjection()}),V+=tt.length/4,q=V}ze&&(f.terrain&&f.terrain.setupElevationDraw(we,j),j.draw(f,D.LINES,sr.disabled,Er.disabled,f.colorModeForRenderPass(),mr.disabled,gp(ke,N,we,Se.getProjection()),l.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,N.zoom,null,[ze.collisionVertexBuffer,ze.collisionVertexBufferExt]))}if(!S||!$.length)return;const ie=f.getOrCreateProgram("collisionCircle"),ne=new o.cV;ne.resize(4*V),ne._trim();let le=0;for(const _e of $)for(let Te=0;Te<_e.circleArray.length/4;Te++){const we=4*Te,Se=_e.circleArray[we+0],be=_e.circleArray[we+1],ke=_e.circleArray[we+2],ze=_e.circleArray[we+3];ne.emplace(le++,Se,be,ke,ze,0),ne.emplace(le++,Se,be,ke,ze,1),ne.emplace(le++,Se,be,ke,ze,2),ne.emplace(le++,Se,be,ke,ze,3)}(!Ys||Ys.length<2*V)&&(Ys=function(_e){const Te=2*_e,we=new o.aU;we.resize(Te),we._trim();for(let Se=0;Se<Te;Se++){const be=6*Se;we.uint16[be+0]=4*Se+0,we.uint16[be+1]=4*Se+1,we.uint16[be+2]=4*Se+2,we.uint16[be+3]=4*Se+2,we.uint16[be+4]=4*Se+3,we.uint16[be+5]=4*Se+0}return we}(V));const ce=A.createIndexBuffer(Ys,!0),fe=A.createVertexBuffer(ne,o.cW.members,!0);for(const _e of $){const Te={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(ve=N).getCameraToCenterDistance(_e.projection),u_viewport_size:[ve.width,ve.height]};ie.draw(f,D.TRIANGLES,sr.disabled,Er.disabled,f.colorModeForRenderPass(),mr.disabled,Te,l.id,fe,ce,o.b7.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,N.zoom)}var ve;fe.destroy(),ce.destroy()}const Cu=o.ab.mat4.create();function Sp(f){const n=f._camera.getWorldToCamera(f.worldSize,1),l=o.ab.mat4.multiply([],n,f.globeMatrix);o.ab.mat4.invert(l,l);const p=[0,0,0],y=[0,1,0,0];return o.ab.vec4.transformMat4(y,y,l),p[0]=y[0],p[1]=y[1],p[2]=y[2],o.ab.vec3.normalize(p,p),p}function f_({width:f,height:n,anchor:l,textOffset:p,textScale:y},v){const{horizontalAlign:S,verticalAlign:A}=o.bD(l),D=-(S-.5)*f,N=-(A-.5)*n,j=o.bC(l,p);return new o.P((D/y+j[0])*v,(N/y+j[1])*v)}function Wv(f,n,l,p,y,v,S,A,D,N,j){const $=f.text.placedSymbolArray,V=f.text.dynamicLayoutVertexArray,q=f.icon.dynamicLayoutVertexArray,ie={},ne=f.getProjection(),le=eh(A,ne,v),ce=v.elevation,fe=ne.upVectorScale(A.canonical,v.center.lat,v.worldSize).metersToTile;V.clear();for(let ve=0;ve<$.length;ve++){const _e=$.get(ve),{tileAnchorX:Te,tileAnchorY:we,numGlyphs:Se}=_e,be=_e.hidden||!_e.crossTileID||f.allowVerticalPlacement&&!_e.placedOrientation?null:p[_e.crossTileID];if(be){let ke=0,ze=0,tt=0;if(ce){const ot=ce?ce.getAtTileOffset(A,Te,we):0,[Tt,gt,ft]=ne.upVector(A.canonical,Te,we);ke=ot*Tt*fe,ze=ot*gt*fe,tt=ot*ft*fe}let[Xe,Oe,$e,ht]=On(_e.projectedAnchorX+ke,_e.projectedAnchorY+ze,_e.projectedAnchorZ+tt,l?le:S);const xt=mv(v.getCameraToCenterDistance(ne),ht);let Pt=y.evaluateSizeForFeature(f.textSizeData,N,_e)*xt/o.bw;l&&(Pt*=f.tilePixelRatio/D);const Ye=f_(be,Pt);l?({x:Xe,y:Oe,z:$e}=ne.projectTilePoint(Te+Ye.x,we+Ye.y,A.canonical),[Xe,Oe,$e]=On(Xe+ke,Oe+ze,$e+tt,S)):(n&&Ye._rotate(-v.angle),Xe+=Ye.x,Oe+=Ye.y,$e=0);const mt=f.allowVerticalPlacement&&_e.placedOrientation===o.bq.vertical?Math.PI/2:0;for(let ot=0;ot<Se;ot++)o.bt(V,Xe,Oe,$e,mt);j&&_e.associatedIconIndex>=0&&(ie[_e.associatedIconIndex]={x:Xe,y:Oe,z:$e,angle:mt})}else mc(Se,V)}if(j){q.clear();const ve=f.icon.placedSymbolArray;for(let _e=0;_e<ve.length;_e++){const Te=ve.get(_e),{numGlyphs:we}=Te,Se=ie[_e];if(Te.hidden||!Se)mc(we,q);else{const{x:be,y:ke,z:ze,angle:tt}=Se;for(let Xe=0;Xe<we;Xe++)o.bt(q,be,ke,ze,tt)}}f.icon.dynamicLayoutVertexBuffer.updateData(q)}f.text.dynamicLayoutVertexBuffer.updateData(V)}function Xo(f,n,l,p,y,v,S={}){const A=l.paint.get("icon-translate"),D=l.paint.get("text-translate"),N=l.paint.get("icon-translate-anchor"),j=l.paint.get("text-translate-anchor"),$=l.layout.get("icon-rotation-alignment"),V=l.layout.get("text-rotation-alignment"),q=l.layout.get("icon-pitch-alignment"),ie=l.layout.get("text-pitch-alignment"),ne=l.layout.get("icon-keep-upright"),le=l.layout.get("text-keep-upright"),ce=l.paint.get("icon-color-saturation"),fe=l.paint.get("icon-color-contrast"),ve=l.paint.get("icon-color-brightness-min"),_e=l.paint.get("icon-color-brightness-max"),Te=l.layout.get("symbol-elevation-reference")==="sea",we=f.context,Se=we.gl,be=f.transform,ke=$==="map",ze=V==="map",tt=q==="map",Xe=ie==="map",Oe=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let $e=!1;const ht=f.depthModeForSublayer(0,sr.ReadOnly),xt=[o.at(be.center.lng),o.aA(be.center.lat)],Pt=l.layout.get("text-variable-anchor"),Ye=be.projection.name==="globe",mt=[],ot=[0,-1,0];for(const Tt of p){const gt=n.getTile(Tt),ft=gt.getBucket(l);if(!ft||ft.projection.name==="mercator"&&Ye||ft.fullyClipped)continue;const zt=ft.projection.name==="globe",Ft=zt?o.ae(be.zoom):0,Dt=eh(Tt,ft.getProjection(),be),$t=be.calculatePixelsToTileUnitsMatrix(gt),vr=Pt&&ft.hasTextData(),lr=ft.hasIconTextFit()&&vr&&ft.hasIconData(),ar=ft.getProjection().createInversionMatrix(be,Tt.canonical),xr=hr=>{be.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||f.terrain)&&(hr.push("DEPTH_D24"),hr.push("DEPTH_OCCLUSION"))},$r=()=>{const hr=ke&&l.layout.get("symbol-placement")!=="point",en=[];xr(en);const Kn=hr||lr,Gi=l.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&tt&&en.push("PITCH_WITH_MAP_TERRAIN"),zt&&(en.push("PROJECTION_GLOBE_VIEW"),Kn&&en.push("PROJECTED_POS_ON_VIEWPORT")),Gi>0&&en.push("ICON_TRANSITION"),ft.icon.zOffsetVertexBuffer&&en.push("Z_OFFSET"),ce===0&&fe===0&&ve===0&&_e===1||en.push("COLOR_ADJUSTMENT"),ft.sdfIcons&&en.push("RENDER_SDF");const Qo=ft.icon.programConfigurations.get(l.id),po=f.getOrCreateProgram("symbol",{config:Qo,defines:en}),ki=gt.imageAtlasTexture?gt.imageAtlasTexture.size:[0,0],mi=ft.iconSizeData,oi=o.bp(mi,be.zoom),Nn=tt||be.pitch!==0,Tn=Na(Dt,gt.tileID.canonical,tt,ke,be,ft.getProjection(),$t),qr=uo(Dt,gt.tileID.canonical,tt,ke,be,ft.getProjection(),$t),ni=f.translatePosMatrix(qr,gt,A,N,!0),Ri=f.translatePosMatrix(Dt,gt,A,N),An=Kn?Cu:Tn,io=ke&&!tt&&!hr;let ls=ot;!Ye&&!be.mercatorFromTransition||ke||(ls=Sp(be));const Fo=zt?ls:ot,Xa=l.getColorAdjustmentMatrix(ce,fe,ve,_e),va=Gv(mi.kind,oi,io,tt,f,Ri,An,ni,Te,!1,ki,[0,0],!0,Tt,Ft,xt,ar,Fo,ft.getProjection(),Xa,Gi),mo=gt.imageAtlasTexture?gt.imageAtlasTexture:null,cs=l.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear,Ka=ft.sdfIcons||f.options.rotating||f.options.zooming||cs||Nn?Se.LINEAR:Se.NEAREST,Qs=ft.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,kc=f.terrain&&tt&&hr?o.ab.mat4.invert(o.ab.mat4.create(),Tn):Cu;if(hr&&ft.icon){const Ph=be.elevation,N_=Ph?Ph.getAtTileOffsetFunc(Tt,be.center.lat,be.worldSize,ft.getProjection()):null,Up=fc(Dt,gt.tileID.canonical,tt,ke,be,ft.getProjection(),$t);Gf(ft,Dt,f,!1,Up,qr,tt,ne,N_,Tt)}return{program:po,buffers:ft.icon,uniformValues:va,atlasTexture:mo,atlasTextureIcon:null,atlasInterpolation:Ka,atlasInterpolationIcon:null,isSDF:ft.sdfIcons,hasHalo:Qs,tile:gt,labelPlaneMatrixInv:kc}},Rr=()=>{const hr=ze&&l.layout.get("symbol-placement")!=="point",en=[],Kn=hr||Pt||lr;f.terrainRenderModeElevated()&&Xe&&en.push("PITCH_WITH_MAP_TERRAIN"),zt&&(en.push("PROJECTION_GLOBE_VIEW"),Kn&&en.push("PROJECTED_POS_ON_VIEWPORT")),ft.text.zOffsetVertexBuffer&&en.push("Z_OFFSET"),ft.iconsInText&&en.push("RENDER_TEXT_AND_SYMBOL"),en.push("RENDER_SDF"),xr(en);const Gi=ft.text.programConfigurations.get(l.id),Qo=f.getOrCreateProgram("symbol",{config:Gi,defines:en});let po,ki=[0,0],mi=null;const oi=ft.textSizeData;ft.iconsInText&&(ki=gt.imageAtlasTexture?gt.imageAtlasTexture.size:[0,0],mi=gt.imageAtlasTexture?gt.imageAtlasTexture:null,po=Xe||be.pitch!==0||f.options.rotating||f.options.zooming||oi.kind==="composite"||oi.kind==="camera"?Se.LINEAR:Se.NEAREST);const Nn=gt.glyphAtlasTexture?gt.glyphAtlasTexture.size:[0,0],Tn=l.layout.get("text-size-scale-range"),qr=o.aw(f.scaleFactor,Tn[0],Tn[1]),ni=o.bp(oi,be.zoom,qr),Ri=Na(Dt,gt.tileID.canonical,Xe,ze,be,ft.getProjection(),$t),An=uo(Dt,gt.tileID.canonical,Xe,ze,be,ft.getProjection(),$t),io=f.translatePosMatrix(An,gt,D,j,!0),ls=f.translatePosMatrix(Dt,gt,D,j),Fo=Kn?Cu:Ri,Xa=ze&&!Xe&&!hr;let va=ot;!Ye&&!be.mercatorFromTransition||ze||(va=Sp(be));const mo=Gv(oi.kind,ni,Xa,Xe,f,ls,Fo,io,Te,!0,Nn,ki,!0,Tt,Ft,xt,ar,zt?va:ot,ft.getProjection(),null,null,qr),cs=gt.glyphAtlasTexture?gt.glyphAtlasTexture:null,Ka=Se.LINEAR,Qs=l.paint.get("text-halo-width").constantOr(1)!==0,kc=f.terrain&&Xe&&hr?o.ab.mat4.invert(o.ab.mat4.create(),Ri):Cu;if(hr&&ft.text){const Ph=be.elevation,N_=Ph?Ph.getAtTileOffsetFunc(Tt,be.center.lat,be.worldSize,ft.getProjection()):null,Up=fc(Dt,gt.tileID.canonical,Xe,ze,be,ft.getProjection(),$t);Gf(ft,Dt,f,!0,Up,An,Xe,le,N_,Tt)}return{program:Qo,buffers:ft.text,uniformValues:mo,atlasTexture:cs,atlasTextureIcon:mi,atlasInterpolation:Ka,atlasInterpolationIcon:po,isSDF:!0,hasHalo:Qs,tile:gt,labelPlaneMatrixInv:kc}},Bn=ft.icon.segments.get().length,Pn=ft.text.segments.get().length,an=Bn&&!S.onlyText?$r():null,yn=Pn&&!S.onlyIcons?Rr():null,Dr=l.paint.get("icon-opacity").constantOr(1),Gr=l.paint.get("text-opacity").constantOr(1);if(Oe&&ft.canOverlap){$e=!0;const hr=Dr&&!S.onlyText?ft.icon.segments.get():[],en=Gr&&!S.onlyIcons?ft.text.segments.get():[];for(const Kn of hr)mt.push({segments:new o.b7([Kn]),sortKey:Kn.sortKey,state:an});for(const Kn of en)mt.push({segments:new o.b7([Kn]),sortKey:Kn.sortKey,state:yn})}else S.onlyText||mt.push({segments:Dr?ft.icon.segments:new o.b7([]),sortKey:0,state:an}),S.onlyIcons||mt.push({segments:Gr?ft.text.segments:new o.b7([]),sortKey:0,state:yn})}$e&&mt.sort((Tt,gt)=>Tt.sortKey-gt.sortKey);for(const Tt of mt){const gt=Tt.state;if(gt)if(f.terrain?f.terrain.setupElevationDraw(gt.tile,gt.program,{useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:gt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(be.depthOcclusionForSymbolsAndCircles,gt.program),we.activeTexture.set(Se.TEXTURE0),gt.atlasTexture&&gt.atlasTexture.bind(gt.atlasInterpolation,Se.CLAMP_TO_EDGE,!0),gt.atlasTextureIcon&&(we.activeTexture.set(Se.TEXTURE1),gt.atlasTextureIcon&&gt.atlasTextureIcon.bind(gt.atlasInterpolationIcon,Se.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,gt.program),gt.hasHalo){const ft=gt.uniformValues;ft.u_is_halo=1,Gn(gt.buffers,Tt.segments,l,f,gt.program,ht,y,v,ft,2),ft.u_is_halo=0}else{if(gt.isSDF){const ft=gt.uniformValues;gt.hasHalo&&(ft.u_is_halo=1,Gn(gt.buffers,Tt.segments,l,f,gt.program,ht,y,v,ft,1)),ft.u_is_halo=0}Gn(gt.buffers,Tt.segments,l,f,gt.program,ht,y,v,gt.uniformValues,1)}}}function Gn(f,n,l,p,y,v,S,A,D,N){const j=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,v,S,A,mr.disabled,D,l.id,f.layoutVertexBuffer,f.indexBuffer,n,l.paint,p.transform.zoom,f.programConfigurations.get(l.id),j,N)}function gh(f,n,l,p,y,v,S){const A=f.context.gl,D=l.paint.get("fill-pattern"),N=l.is3D(),j=N?f.stencilModeFor3D():Er.disabled,$=D&&D.constantOr(1);let V,q,ie,ne,le;S?(q=$&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=A.LINES):(q=$?"fillPattern":"fill",V=A.TRIANGLES);for(const ce of p){const fe=n.getTile(ce);if($&&!fe.patternsLoaded())continue;const ve=fe.getBucket(l);if(!ve)continue;f.prepareDrawTile();const _e=ve.programConfigurations.get(l.id),Te=f.isTileAffectedByFog(ce),we=f.getOrCreateProgram(q,{config:_e,overrideFog:Te});$&&(f.context.activeTexture.set(A.TEXTURE0),fe.imageAtlasTexture&&fe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),_e.updatePaintBuffers());const Se=D.constantOr(null);if(Se&&fe.imageAtlas){const ze=fe.imageAtlas,tt=o.A.from(Se),Xe=ze.patternPositions[tt.getSerializedPrimary()];Xe&&_e.setConstantPatternPositions(Xe)}const be=f.translatePosMatrix(ce.projMatrix,fe,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),ke=l.paint.get("fill-emissive-strength");if(S){ne=ve.indexBuffer2,le=ve.segments2;const ze=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];ie=q==="fillOutlinePattern"&&$?mp(be,ke,f,fe,ze):Uv(be,ke,ze)}else ne=ve.indexBuffer,le=ve.segments,ie=$?Eu(be,ke,f,fe):pp(be,ke);f.uploadCommonUniforms(f.context,we,ce.toUnwrapped()),we.draw(f,V,y,N?j:f.stencilModeForClipping(ce),v,mr.disabled,ie,l.id,ve.layoutVertexBuffer,ne,le,l.paint,f.transform.zoom,_e,void 0)}}function Mu(f,n,l,p,y,v,S,A){l.resetLayerRenderingStats(f);const D=f.context,N=D.gl,j=f.transform,$=l.paint.get("fill-extrusion-pattern"),V=$.constantOr(1),q=l.paint.get("fill-extrusion-opacity"),ie=f.style.enable3dLights(),ne=l.paint.get(ie&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),le=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne],ce=l.layout.get("fill-extrusion-edge-radius"),fe=ce>0&&!l.paint.get("fill-extrusion-rounded-roof"),ve=fe?0:ce,_e=j.projection.name==="globe"?o.d3():0,Te=j.projection.name==="globe",we=Te?o.ae(j.zoom):0,Se=[o.at(j.center.lng),o.aA(j.center.lat)],be=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ke=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(be?null:l.lut).toArray01().slice(0,3),ze=l.paint.get("fill-extrusion-flood-light-intensity"),tt=l.paint.get("fill-extrusion-vertical-scale"),Xe=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Oe=l.paint.get("fill-extrusion-height-alignment"),$e=l.paint.get("fill-extrusion-base-alignment"),ht=Ua(f,l.paint.get("fill-extrusion-cutoff-fade-range")),xt=[];let Pt;Te&&xt.push("PROJECTION_GLOBE_VIEW"),le[0]>0&&xt.push("FAUX_AO"),fe&&xt.push("ZERO_ROOF_RADIUS"),A&&xt.push("HAS_CENTROID"),ze>0&&xt.push("FLOOD_LIGHT"),ht.shouldRenderCutoff&&xt.push("RENDER_CUTOFF"),Xe&&xt.push("RENDER_WALL_MODE");const Ye=f.renderPass==="shadow",mt=f.shadowRenderer,ot=Ye&&!!mt;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Tt=[0,0,0];if(mt){const zt=f.style.directionalLight,Ft=f.style.ambientLight;zt&&Ft&&(Tt=yu(f.style,zt,Ft)),Ye||(xt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),mt.useNormalOffset&&xt.push("NORMAL_OFFSET")),Pt=xt.concat(["SHADOWS_SINGLE_CASCADE"])}const gt=ot?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",ft=l.getLayerRenderingStats();for(const zt of p){const Ft=n.getTile(zt),Dt=Ft.getBucket(l);if(!Dt||Dt.projection.name!==j.projection.name)continue;let $t=!1;mt&&($t=mt.getMaxCascadeForTile(zt.toUnwrapped())===0);const vr=f.isTileAffectedByFog(zt),lr=Dt.programConfigurations.get(l.id),ar=f.getOrCreateProgram(gt,{config:lr,defines:$t?Pt:xt,overrideFog:vr});if(f.terrain&&f.terrain.setupElevationDraw(Ft,ar,{useMeterToDem:!0}),!Dt.centroidVertexBuffer){const yn=ar.attributes.a_centroid_pos;yn!==void 0&&N.vertexAttrib2f(yn,0,0)}!Ye&&mt&&mt.setupShadows(Ft.tileID.toUnwrapped(),ar,"vector-tile",Ft.tileID.overscaledZ),V&&(f.context.activeTexture.set(N.TEXTURE0),Ft.imageAtlasTexture&&Ft.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),lr.updatePaintBuffers());const xr=$.constantOr(null);if(xr&&Ft.imageAtlas){const yn=Ft.imageAtlas,Dr=o.A.from(xr),Gr=yn.patternPositions[Dr.getSerializedPrimary()];Gr&&lr.setConstantPatternPositions(Gr)}const $r=l.paint.get("fill-extrusion-vertical-gradient"),Rr=1/Dt.tileToMeter;let Bn;if(Ye&&mt){if(Au(Ft.tileID,Dt,f))continue;const yn=mt.calculateShadowPassMatrixFromTile(Ft.tileID.toUnwrapped());Bn=c_(yn,ve,Rr,tt,Oe,$e)}else{const yn=f.translatePosMatrix(zt.expandedProjMatrix,Ft,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Dr=j.projection.createInversionMatrix(j,zt.canonical);Bn=V?ph(yn,f,$r,q,le,ve,Rr,zt,Ft,_e,Oe,$e,we,Se,Dr,ke,tt):fp(yn,f,$r,q,le,ve,Rr,zt,_e,Oe,$e,we,Se,Dr,ke,tt,ze,Tt)}f.uploadCommonUniforms(D,ar,zt.toUnwrapped(),null,ht);let Pn=Dt.segments;if(j.projection.name==="mercator"&&!Ye&&(Pn=Dt.getVisibleSegments(Ft.tileID,f.terrain,f.transform.getFrustum(0)),!Pn.get().length))continue;if(ft)if(Ye)for(const yn of Pn.get())ft.numRenderedVerticesInShadowPass+=yn.primitiveLength;else for(const yn of Pn.get())ft.numRenderedVerticesInTransparentPass+=yn.primitiveLength;const an=[];(f.terrain||A)&&an.push(Dt.centroidVertexBuffer),Te&&an.push(Dt.layoutVertexExtBuffer),Xe&&an.push(Dt.wallVertexBuffer),ar.draw(f,D.gl.TRIANGLES,y,v,S,mr.backCCW,Bn,l.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Pn,l.paint,f.transform.zoom,lr,an)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Ec(f,n,l,p,y,v,S,A,D,N,j,$,V,q,ie,ne,le,ce,fe){const ve=f.context,_e=ve.gl,Te=f.transform,we=f.transform.zoom,Se=[],be=Ua(f,l.paint.get("fill-extrusion-cutoff-fade-range"));N==="clear"?(Se.push("CLEAR_SUBPASS"),fe&&(Se.push("CLEAR_FROM_TEXTURE"),ve.activeTexture.set(_e.TEXTURE0),fe.bind(_e.LINEAR,_e.CLAMP_TO_EDGE))):N==="sdf"&&Se.push("SDF_SUBPASS"),le&&Se.push("HAS_CENTROID"),be.shouldRenderCutoff&&Se.push("RENDER_CUTOFF");const ke=l.layout.get("fill-extrusion-edge-radius"),ze=(tt,Xe,Oe,$e,ht)=>{const xt=Xe.programConfigurations.get(l.id),Pt=f.isTileAffectedByFog(tt),Ye=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:xt,defines:Se,overrideFog:Pt}),mt=((Tt,gt,ft,zt,Ft,Dt,$t,vr,lr,ar,xr)=>({u_matrix:gt,u_opacity:ft,u_ao_pass:zt?1:0,u_meter_to_tile:Ft,u_ao:Dt,u_flood_light_intensity:$t,u_flood_light_color:vr,u_attenuation:lr,u_edge_radius:ar,u_fb:0,u_fb_size:xr,u_dynamic_offset:1}))(0,$e,j,D,ht,[$,V*ht],q,ie,ne,we>=17?0:ke*ht,fe?fe.size[0]:0),ot=[];le&&ot.push(Xe.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ve,Ye,tt.toUnwrapped(),null,be),Ye.draw(f,ve.gl.TRIANGLES,y,v,S,A,mt,l.id,Xe.vertexBuffer,Xe.indexBuffer,Oe,l.paint,we,xt,ot)};for(const tt of p){const Xe=n.getTile(tt),Oe=Xe.getBucket(l);if(!Oe||Oe.projection.name!==Te.projection.name||!Oe.groundEffect||Oe.groundEffect&&!Oe.groundEffect.hasData())continue;const $e=Oe.groundEffect,ht=1/Oe.tileToMeter;{const xt=f.translatePosMatrix(tt.projMatrix,Xe,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Pt=$e.getDefaultSegment();ze(tt,$e,Pt,xt,ht)}if(ce)for(let xt=0;xt<4;xt++){const Pt=o.d4[xt](tt),Ye=n.getTile(Pt);if(!Ye)continue;const mt=Ye.getBucket(l);if(!mt||mt.projection.name!==Te.projection.name||!mt.groundEffect||mt.groundEffect&&!mt.groundEffect.hasData())continue;const ot=mt.groundEffect;let Tt,gt;xt===0?(Tt=[-o.ag,0,0],gt=1):xt===1?(Tt=[o.ag,0,0],gt=0):xt===2?(Tt=[0,-o.ag,0],gt=3):(Tt=[0,o.ag,0],gt=2);const ft=ot.regionSegments[gt];if(!ft)continue;const zt=new Float32Array(16);o.ab.mat4.translate(zt,tt.projMatrix,Tt),ze(tt,ot,ft,f.translatePosMatrix(zt,Xe,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),ht)}}}function Zv(f,n,l,p,y,v,S){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const A=v?v.findDEMTileFor(l):null;if(!(A&&A.dem||S))return;v&&A&&A.dem&&p.selfDEMTileTimestamp!==A.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=A.dem._timestamp);const D=ce=>new o.P(Math.ceil((ce+o.d7)*o.d8),0),N=ce=>{const fe=n.getSource().minzoom,ve=Te=>{const we=n.getTileByID(Te);if(we&&we.hasData())return we.getBucket(y)},_e=[0,-1,1];for(const Te of _e){if(ce.overscaledZ+Te<fe)continue;const we=ve(ce.calculateScaledKey(ce.overscaledZ+Te));if(we)return we}},j=[0,0,0],$=(ce,fe)=>(j[0]=Math.min(ce.min.y,fe.min.y),j[1]=Math.max(ce.max.y,fe.max.y),j[2]=o.ag-fe.min.x>ce.max.x?fe.min.x-o.ag:ce.max.x,j),V=(ce,fe)=>(j[0]=Math.min(ce.min.x,fe.min.x),j[1]=Math.max(ce.max.x,fe.max.x),j[2]=o.ag-fe.min.y>ce.max.y?fe.min.y-o.ag:ce.max.y,j),q=[(ce,fe)=>$(ce,fe),(ce,fe)=>$(fe,ce),(ce,fe)=>V(ce,fe),(ce,fe)=>V(fe,ce)],ie=(ce,fe,ve,_e,Te,we,Se)=>{if(!v)return 0;const be=[[we?ve:ce,we?ce:ve,0],[we?ve:fe,we?fe:ve,0]],ke=Se<0?o.ag+Se:Se,ze=[we?ke:(ce+fe)/2,we?(ce+fe)/2:ke,0];return ve===0&&Se<0||ve!==0&&Se>0?v.getForTilePoints(Te,[ze],!0,_e):be.push(ze),v.getForTilePoints(l,be,!0,A),Math.max(be[0][2],be[1][2],ze[2])/v.exaggeration()};for(let ce=0;ce<4;ce++){const fe=p.borderFeatureIndices[ce];if(fe.length===0)continue;const ve=o.d4[ce](l),_e=N(ve);if(!(_e&&_e instanceof o.d5))continue;const Te=v?v.findDEMTileFor(ve):null;if(!(Te&&Te.dem||S)||(v&&Te&&Te.dem&&p.borderDEMTileTimestamp[ce]!==Te.dem._timestamp&&(p.borderDoneWithNeighborZ[ce]=-1,p.borderDEMTileTimestamp[ce]=Te.dem._timestamp),p.borderDoneWithNeighborZ[ce]===_e.canonical.z))continue;_e.centroidVertexArray.length===0&&_e.createCentroidsBuffer();const we=(ce<2?1:5)-ce,Se=_e.borderDoneWithNeighborZ[we]!==p.canonical.z,be=_e.borderFeatureIndices[we];let ke=0;if(p.canonical.z!==_e.canonical.z){for(const ze of fe)p.showCentroid(p.featuresOnBorder[ze]);if(Se)for(const ze of be)_e.showCentroid(_e.featuresOnBorder[ze]);p.borderDoneWithNeighborZ[ce]=_e.canonical.z,_e.borderDoneWithNeighborZ[we]=p.canonical.z}for(const ze of fe){const tt=p.featuresOnBorder[ze],Xe=p.centroidData[tt.centroidDataIndex],Oe=tt.borders[ce];let $e;for(;ke<be.length;){$e=_e.featuresOnBorder[be[ke]];const ht=$e.borders[we];if(ht[1]>Oe[0]+3||ht[0]>Oe[0]-3)break;_e.showCentroid($e),ke++}if($e&&ke<be.length){const ht=ke;let xt=0;for(;!($e.borders[we][0]>Oe[1]-3)&&(xt++,++ke!==be.length);)$e=_e.featuresOnBorder[be[ke]];$e=_e.featuresOnBorder[be[ht]];let Pt=!1;if(xt>=1){const ot=$e.borders[we];Math.abs(Oe[0]-ot[0])<3&&Math.abs(Oe[1]-ot[1])<3&&(xt=1,Pt=!0,ke=ht+1)}else if(xt===0){p.showCentroid(tt);continue}const Ye=_e.centroidData[$e.centroidDataIndex];S&&Pt&&(((ne=Xe).flags|(le=Ye).flags)&o.d6?(ne.flags|=o.d6,le.flags|=o.d6):(ne.flags&=~o.d6,le.flags&=~o.d6));const mt=tt.intersectsCount()>1||$e.intersectsCount()>1;if(xt>1)ke=ht,Xe.centroidXY=Ye.centroidXY=new o.P(0,0);else if(Te&&Te.dem&&!mt){const ot=q[ce](Xe,Ye),Tt=ce%2?o.ag-1:0,gt=ie(ot[0],Math.min(o.ag-1,ot[1]),Tt,Te,ve,ce<2,ot[2]);Xe.centroidXY=Ye.centroidXY=D(gt)}else mt?Xe.centroidXY=Ye.centroidXY=new o.P(0,0):(Xe.centroidXY=p.encodeBorderCentroid(tt),Ye.centroidXY=_e.encodeBorderCentroid($e));p.writeCentroidToBuffer(Xe),_e.writeCentroidToBuffer(Ye)}else p.showCentroid(tt)}p.borderDoneWithNeighborZ[ce]=_e.canonical.z,_e.borderDoneWithNeighborZ[we]=p.canonical.z}var ne,le;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Yv=[1,0,0],C2=[0,1,0],Pu=[0,0,1];function Au(f,n,l){const p=l.transform,y=l.shadowRenderer;if(!y)return!0;const v=f.toUnwrapped(),S=p.tileSize*y._cascades[l.currentShadowCascade].scale;let A=n.maxHeight;if(p.elevation){const ne=p.elevation.getMinMaxForTile(f);ne&&(A+=ne.max)}const D=[...y.shadowDirection];D[2]=-D[2];const N=y.computeSimplifiedTileShadowVolume(v,A,S,D);if(!N)return!1;const j=[Yv,C2,Pu,D,[D[0],0,D[2]],[0,D[1],D[2]]],$=p.projection.name==="globe",V=p.scaleZoom(S),q=o.bR.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,V,!$),ie=y.getCurrentCascadeFrustum();return q.intersectsPrecise(N.vertices,N.planes,j)===0||ie.intersectsPrecise(N.vertices,N.planes,j)===0}function Mt(f){return[f[0]*o.d9,f[1]*o.d9,f[2]*o.d9,0]}function Ut(f,n,l,p,y,v,S,A,D){const N=p.getSource(),j=l.globeSharedBuffers;if(!j)return;let $,V,q;if(n&&($=p.getTile(n)),N instanceof o.aJ?(V=N.texture,q=o.cI(0,0,l.transform)):$&&n&&(V=$.texture,q=o.cI(n.canonical.z,n.canonical.x,l.transform)),!V||!q)return;f||(q=o.ab.mat4.scale(o.ab.mat4.create(),q,[1,-1,1]));const ie=l.context,ne=ie.gl,le=y.paint.get("raster-resampling")==="nearest"?ne.NEAREST:ne.LINEAR,ce=l.colorModeForDrapableLayerRenderPass(v),fe=S.defines;fe.push("GLOBE_POLES");const ve=new sr(ne.LEQUAL,sr.ReadWrite,l.depthRangeFor3D),_e=Float32Array.from(l.transform.expandedFarZProjMatrix),Te=Float32Array.from(o.bb(o.cH(new o.bT(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),ie.activeTexture.set(ne.TEXTURE0),V.bind(le,ne.CLAMP_TO_EDGE),ie.activeTexture.set(ne.TEXTURE1),V.bind(le,ne.CLAMP_TO_EDGE),V.useMipmap&&ie.extTextureFilterAnisotropic&&l.transform.pitch>20&&ne.texParameterf(ne.TEXTURE_2D,ie.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ie.extTextureFilterAnisotropicMax);const[we,Se,be,ke]=n?j.getPoleBuffers(n.canonical.z,!1):j.getPoleBuffers(0,!0),ze=y.paint.get("raster-elevation");let tt;f?(tt=we,l.renderDefaultNorthPole=ze!==0):(tt=Se,l.renderDefaultSouthPole=ze!==0);const Xe=Mt(S.mix),Oe=((ht,xt,Pt,Ye,mt,ot,Tt,gt,ft,zt,Ft,Dt,$t)=>qt(ht,xt,Pt,new Float32Array(16),new Float32Array(9),[0,0],Ye,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ot,[0,0],gt,2,zt,Ft,Dt,1,0,$t))(_e,Te,q,o.ae(l.transform.zoom),0,y,0,ze,0,Xe,S.offset,S.range,v),$e=l.getOrCreateProgram("raster",{defines:fe});l.uploadCommonUniforms(ie,$e,null),$e.draw(l,ne.TRIANGLES,ve,D,ce,A,Oe,y.id,tt,be,ke)}function Iu(f){const n=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-n,y=.2*f.height,v=n+y;return[n,l,(v-y-n)/p,(v-n)/p]}function ti(f,n,l,p){if(f)return n instanceof Oa&&f instanceof jf?n.getTextureDescriptor(f,l,!0):{texture:f.texture,mix:Mt(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Ke=o.da([{name:"a_index",type:"Int16",components:1}]);class Xv{constructor(n,l,p,y){const v={width:p[0],height:p[1],data:null},S=n.gl;this.targetColorTexture=new o.T(n,v,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(n,v,S.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(l,y),this.lastInvalidatedAt=0}updateParticleTexture(n,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,y=l.width*l.height;this.particleTexture0=new o.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1});const v=new o.db;v.reserve(y);for(let S=0;S<y;S++)v.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(v,Ke.members,!0),this.particleSegment=o.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Tp(f,n,l){if(!f)return null;const p=n.getTextureDescriptor(f,l,!0);if(!p)return null;let{texture:y,mix:v,offset:S,tileSize:A,buffer:D,format:N}=p;if(!y||!N)return null;let j=!1;return N==="uint32"&&(j=!0,v[3]=0,v=bc(o.dc,v,[0,l.paint.get("raster-particle-max-speed")]),S=mh(o.dc,S,[0,l.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[D/(A+2*D),A/(A+2*D)],tileSize:A,scalarData:j,scale:v,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function p_(f){const n=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-n,y=.2*f.height,v=n+y;return[n,l,(v-y-n)/p,(v-n)/p]}const Kv=new o.aj(1,0,0,1),Jv=new o.aj(0,1,0,1),Qv=new o.aj(0,0,1,1),ku=new o.aj(1,0,1,1),M2=new o.aj(0,1,1,1);function Ru(f,n,l,p,y,v,S){const A=f.context,D=f.transform,N=A.gl,j=D.projection.name==="globe",$=j?["PROJECTION_GLOBE_VIEW"]:[];let V=o.ab.mat4.clone(l.projMatrix);if(j&&o.ae(D.zoom)>0){const Xe=o.ba(l.canonical,D),Oe=o.dd(Xe);V=o.ab.mat4.multiply(new Float32Array(16),D.globeMatrix,Oe),o.ab.mat4.multiply(V,D.projMatrix,V)}const q=o.ab.mat4.create();q[12]+=2*y/(o.q.devicePixelRatio*D.width),q[13]+=2*v/(o.q.devicePixelRatio*D.height),o.ab.mat4.multiply(V,q,V);const ie=f.getOrCreateProgram("debug",{defines:$}),ne=n.getTileByID(l.key);f.terrain&&f.terrain.setupElevationDraw(ne,ie);const le=sr.disabled,ce=Er.disabled,fe=f.colorModeForRenderPass(),ve="$debug";A.activeTexture.set(N.TEXTURE0),f.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),j?ne._makeGlobeTileDebugBuffers(f.context,D):ne._makeDebugTileBoundsBuffers(f.context,D.projection);const _e=ne._tileDebugBuffer||f.debugBuffer,Te=ne._tileDebugIndexBuffer||f.debugIndexBuffer,we=ne._tileDebugSegments||f.debugSegments;if(ie.draw(f,N.LINE_STRIP,le,ce,fe,mr.disabled,_p(V,p),ve,_e,Te,we,null,null,null,[ne._globeTileDebugBorderBuffer]),S){const Xe=ne.latestRawTileData,Oe=Math.floor((Xe&&Xe.byteLength||0)/1024);let $e=l.canonical.toString();l.overscaledZ!==l.canonical.z&&($e+=` => ${l.overscaledZ}`),$e+=` ${ne.state}`,$e+=` ${Oe}kb`,function(ht,xt){ht.initDebugOverlayCanvas();const Pt=ht.debugOverlayCanvas,Ye=ht.context.gl,mt=ht.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,Pt.width,Pt.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(xt,5,5),mt.strokeText(xt,5,5),ht.debugOverlayTexture.update(Pt),ht.debugOverlayTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE)}(f,$e)}const Se=n.getTile(l).tileSize,be=512/Math.min(Se,512)*(l.overscaledZ/D.zoom)*.5,ke=ne._tileDebugTextBuffer||f.debugBuffer,ze=ne._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,tt=ne._tileDebugTextSegments||f.debugSegments;ie.draw(f,N.TRIANGLES,le,ce,Or.alphaBlended,mr.disabled,_p(V,o.aj.transparent,be),ve,ke,ze,tt,null,null,null,[ne._globeTileDebugTextBuffer])}function m_(f,n,l,p){Du(f,0,n+l/2,f.transform.width,l,p)}function _h(f,n,l,p){Du(f,n-l/2,0,l,f.transform.height,p)}function Du(f,n,l,p,y,v){const S=f.context,A=S.gl;A.enable(A.SCISSOR_TEST),A.scissor(n*o.q.devicePixelRatio,l*o.q.devicePixelRatio,p*o.q.devicePixelRatio,y*o.q.devicePixelRatio),S.clear({color:v}),A.disable(A.SCISSOR_TEST)}const ex=o.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:tx}=ex;function Xs(f,n,l,p){f.emplaceBack(n,l,p)}class yh{constructor(n){this.vertexArray=new o.de,this.indices=new o.aU,Xs(this.vertexArray,-1,-1,1),Xs(this.vertexArray,1,-1,1),Xs(this.vertexArray,-1,1,1),Xs(this.vertexArray,1,1,1),Xs(this.vertexArray,-1,-1,-1),Xs(this.vertexArray,1,-1,-1),Xs(this.vertexArray,-1,1,-1),Xs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,tx),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.b7.simpleSegment(0,0,36,12)}}function zo(f,n,l,p,y,v){const S=f.context.gl,A=n.paint.get("sky-atmosphere-color"),D=n.paint.get("sky-atmosphere-halo-color"),N=n.paint.get("sky-atmosphere-sun-intensity"),j=(($,V,q,ie,ne)=>({u_matrix_3f:$,u_sun_direction:V,u_sun_intensity:q,u_color_tint_r:[ie.r,ie.g,ie.b,ie.a],u_color_tint_m:[ne.r,ne.g,ne.b,ne.a],u_luminance:5e-5}))(o.ab.mat3.fromMat4(o.ab.mat3.create(),p),y,N,A,D);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+v,n.skyboxTexture,0),l.draw(f,S.TRIANGLES,sr.disabled,Er.disabled,Or.unblended,mr.frontCW,j,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const rx=o.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class P2{constructor(n){const l=new o.df;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new o.aU;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,rx.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=o.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const No=o.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class A2{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class vh{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Or([1,pu,1,pu],o.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Or([1,0,1,0],o.aj.transparent,[!1,!1,!1,!0]),this.params=new A2,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const l=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new P2(l);const p=this.params.sizeRange,y=this.params.intensityRange,v=function(j){const $=o.di(30),V=[];for(let q=0;q<j;++q){const ie=2*Math.PI*$(),ne=Math.acos(1-2*$())-.5*Math.PI;V.push(o.ab.vec3.fromValues(Math.cos(ne)*Math.cos(ie),Math.cos(ne)*Math.sin(ie),Math.sin(ne)))}return V}(this.params.starsCount),S=o.di(300),A=new o.dg,D=new o.aU;let N=0;for(let j=0;j<v.length;++j){const $=o.ab.vec3.scale([],v[j],200),V=Math.max(0,1+.01*p*(1*S()-.5)),q=Math.max(0,1+.01*y*(1*S()-.5));A.emplaceBack($[0],$[1],$[2],-1,-1,V,q),A.emplaceBack($[0],$[1],$[2],1,-1,V,q),A.emplaceBack($[0],$[1],$[2],1,1,V,q),A.emplaceBack($[0],$[1],$[2],-1,1,V,q),D.emplaceBack(N+0,N+1,N+2),D.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=l.createVertexBuffer(A,No.members),this.starsIdx=l.createIndexBuffer(D),this.starsSegments=o.b7.simpleSegment(0,0,A.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,l){const p=n.context,y=p.gl,v=n.transform,S=new sr(y.LEQUAL,sr.ReadOnly,[0,1]),A=o.ae(v.zoom),D=n.style.getLut(l.scope),N=l.properties.get("color-use-theme")==="none",j=l.properties.get("color").toRenderColor(N?null:D).toArray01(),$=l.properties.get("high-color-use-theme")==="none",V=l.properties.get("high-color").toRenderColor($?null:D).toArray01(),q=l.properties.get("space-color-use-theme")==="none",ie=l.properties.get("space-color").toRenderColor(q?null:D).toArray01PremultipliedAlpha(),ne=5e-4,le=o.dh(l.properties.get("horizon-blend"),0,1,ne,.25),ce=o.cC(n,p,v)&&le===ne?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,fe=n.frameCounter/1e3%1,ve=o.ab.vec3.length(v.globeCenterInViewSpace),_e=Math.sqrt(Math.pow(ve,2)-Math.pow(ce,2)),Te=Math.acos(_e/ve),we=Se=>{const be=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Se&&be.push("ALPHA_PASS");const ke=n.getOrCreateProgram("globeAtmosphere",{defines:be}),ze=((Xe,Oe,$e,ht,xt,Pt,Ye,mt,ot,Tt,gt,ft)=>({u_frustum_tl:Xe,u_frustum_tr:Oe,u_frustum_br:$e,u_frustum_bl:ht,u_horizon:xt,u_transition:Pt,u_fadeout_range:Ye,u_color:mt,u_high_color:ot,u_space_color:Tt,u_temporal_offset:gt,u_horizon_angle:ft}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,A,le,j,V,ie,fe,Te);n.uploadCommonUniforms(p,ke);const tt=this.atmosphereBuffer;tt&&ke.draw(n,y.TRIANGLES,S,Er.disabled,Se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mr.backCW,ze,Se?"atmosphere_glow_alpha":"atmosphere_glow",tt.vertexBuffer,tt.indexBuffer,tt.segments)};we(!1),we(!0)}drawStars(n,l){const p=o.aw(l.properties.get("star-intensity"),0,1);if(p===0)return;const y=n.context,v=y.gl,S=n.transform,A=n.getOrCreateProgram("stars"),D=o.ab.quat.identity([]);o.ab.quat.rotateX(D,D,-S._pitch),o.ab.quat.rotateZ(D,D,-S.angle),o.ab.quat.rotateX(D,D,o.ai(S._center.lat)),o.ab.quat.rotateY(D,D,-o.ai(S._center.lng));const N=o.ab.mat4.fromQuat(new Float32Array(16),D),j=o.ab.mat4.multiply([],S.starsProjMatrix,N),$=o.ab.mat3.fromMat4([],N),V=o.ab.mat3.invert([],$),q=[0,1,0];o.ab.vec3.transformMat3(q,q,V),o.ab.vec3.scale(q,q,this.params.sizeMultiplier);const ie=[1,0,0];o.ab.vec3.transformMat3(ie,ie,V),o.ab.vec3.scale(ie,ie,this.params.sizeMultiplier);const ne=(le=q,ce=ie,fe=p,{u_matrix:Float32Array.from(j),u_up:le,u_right:ce,u_intensity_multiplier:fe});var le,ce,fe;n.uploadCommonUniforms(y,A),this.starsVx&&this.starsIdx&&A.draw(n,v.TRIANGLES,sr.disabled,Er.disabled,this.colorModeAlphaBlendedWriteRGB,mr.disabled,ne,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function zn(f,n){const l=[...f],p=n.cameraWorldSizeForFog/n.worldSize,y=o.ab.mat4.identity([]);return o.ab.mat4.scale(y,y,[p,p,1]),o.ab.mat4.multiply(l,y,l),o.ab.mat4.multiply(l,n.worldToFogMatrix,l),l}function Qr(f,n,l,p,y){const v=l.material,S=p.context,{baseColorTexture:A,metallicRoughnessTexture:D}=v.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:j,emissionTexture:$}=v;function V(ie,ne,le){if(ie&&(f.push(ne),S.activeTexture.set(S.gl.TEXTURE0+le),ie.gfxTexture)){const{minFilter:ce,magFilter:fe,wrapS:ve,wrapT:_e}=ie.sampler;ie.gfxTexture.bindExtraParam(ce,fe,ve,_e)}}V(A,"HAS_TEXTURE_u_baseColorTexture",to.BaseColor),V(D,"HAS_TEXTURE_u_metallicRoughnessTexture",to.MetallicRoughness),V(N,"HAS_TEXTURE_u_normalTexture",to.Normal),V(j,"HAS_TEXTURE_u_occlusionTexture",to.Occlusion),V($,"HAS_TEXTURE_u_emissionTexture",to.Emission),y&&(y.texture||(y.texture=new o.dk(p.context,y.image,[y.image.height,y.image.height,y.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+to.LUT),y.texture&&y.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(l.texcoordBuffer)),l.colorBuffer&&(f.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(l.colorBuffer)),l.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(l.normalBuffer)),l.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(l.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES");const q=p.shadowRenderer;q&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&f.push("NORMAL_OFFSET"))}function xh(f,n,l,p,y,v){const S=l.paint.get("model-opacity").constantOr(1),A=n.context,D=new sr(n.context.gl.LEQUAL,sr.ReadWrite,n.depthRangeFor3D),N=n.transform,j=f.mesh,$=j.material,V=$.pbrMetallicRoughness,q=n.style.fog;let ie;ie=n.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:o.ab.mat4.multiply([],p.zScaleMatrix,f.nodeModelMatrix),o.ab.mat4.multiply(ie,p.negCameraPosMatrix,ie);const ne=o.ab.mat4.invert([],ie);o.ab.mat4.transpose(ne,ne);const le=l.paint.get("model-color-use-theme").constantOr("default")==="none",ce=l.paint.get("model-emissive-strength").constantOr(0),fe=bp(new Float32Array(f.worldViewProjection),new Float32Array(ie),new Float32Array(ne),null,n,S,V.baseColorFactor.toRenderColor(null),$.emissiveFactor,V.metallicFactor,V.roughnessFactor,$,ce,l),ve={defines:[]},_e=[],Te=n.shadowRenderer;Te&&(Te.useNormalOffset=!1),Qr(ve.defines,_e,j,n,le?null:l.lut);let we=null;if(q){const ke=zn(f.nodeModelMatrix,n.transform);if(we=new Float32Array(ke),N.projection.name!=="globe"){const ze=j.aabb.min,tt=j.aabb.max,[Xe,Oe]=q.getOpacityForBounds(ke,ze[0],ze[1],tt[0],tt[1]);ve.overrideFog=Xe>=Vt||Oe>=Vt}}const Se=Ua(n,l.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&ve.defines.push("RENDER_CUTOFF");const be=n.getOrCreateProgram("model",ve);n.uploadCommonUniforms(A,be,null,we,Se),n.renderPass!=="shadow"&&Te&&Te.setupShadowsFromMatrix(f.nodeModelMatrix,be),be.draw(n,A.gl.TRIANGLES,D,y,v,j.material.doubleSided?mr.disabled:mr.backCCW,fe,l.id,j.vertexBuffer,j.indexBuffer,j.segments,l.paint,n.transform.zoom,void 0,_e)}function Ha(f,n,l,p,y,v,S){let A;A=f.projection.name==="globe"?o.dl(l,f):[...l],o.ab.mat4.multiply(A,A,n.matrix);const D=o.ab.mat4.multiply([],p,A);if(n.meshes)for(const N of n.meshes){if(N.material.alphaMode!=="BLEND"){S.push({mesh:N,depth:0,modelIndex:y,worldViewProjection:D,nodeModelMatrix:A});continue}const j=o.ab.vec3.transformMat4([],N.centroid,D);j[2]>0&&v.push({mesh:N,depth:j[2],modelIndex:y,worldViewProjection:D,nodeModelMatrix:A})}if(n.children)for(const N of n.children)Ha(f,N,l,p,y,v,S)}function Lu(f,n,l,p){const y=l.shadowRenderer;if(!y)return;const v=y.getShadowPassDepthMode(),S=y.getShadowPassColorMode(),A=y.calculateShadowPassMatrixFromMatrix(n),D=qv(A);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,v,Er.disabled,S,mr.backCCW,D,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,l.transform.zoom,void 0,void 0)}function Ou(f,n,l){const p=n.updateZoomBasedPaintProperties(),y=function(v,S,A){let D,N,j,$=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&$>0){const V=v.terrain,q=V.findDEMTileFor(A);q&&q.dem?D=o.dn.create(V,A,q):$=0}if($===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),$===S.validForExaggeration&&($===0||D&&D._demTile&&D._demTile.tileID===S.validForDEMTile.id&&D._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const V in S.instancesPerModel){const q=S.instancesPerModel[V];for(let ie=0;ie<q.instancedDataArray.length;++ie){const ne=(D?$*D.getElevationAt(0|q.instancedDataArray.float32[16*ie],0|q.instancedDataArray.float32[16*ie+1],!0,!0):0)+q.instancesEvaluatedElevation[ie];q.instancedDataArray.float32[16*ie+6]=ne,N=N?Math.min(S.terrainElevationMin,ne):ne,j=j?Math.max(S.terrainElevationMax,ne):ne}}return S.terrainElevationMin=N||0,S.terrainElevationMax=j||0,S.validForExaggeration=$,S.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,n,l);(p||y)&&(n.uploaded=!1,n.upload(f.context))}const Cs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.cd([0,0,0],[o.ag,o.ag,0])};function g_(f,n){const l=1<<f.canonical.z,p=n.getFreeCameraOptions().position,y=n.elevation,v=f.canonical.x/l,S=(f.canonical.x+1)/l,A=f.canonical.y/l,D=(f.canonical.y+1)/l;let N=n._centerAltitude;if(y){const q=y.getMinMaxForTile(f);q&&q.max>N&&(N=q.max)}const j=o.aw(p.x,v,S)-p.x,$=o.aw(p.y,A,D)-p.y,V=o.bH(N,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(j*j+$*$+V*V))}function qa(f,n,l,p,y,v,S){const A=f.context,D=f.renderPass==="shadow",N=f.shadowRenderer,j=D&&N?N.getShadowPassDepthMode():new sr(A.gl.LEQUAL,sr.ReadWrite,f.depthRangeFor3D),$=f.isTileAffectedByFog(v);if(l.meshes)for(const V of l.meshes){const q=["MODEL_POSITION_ON_GPU"],ie=[];let ne,le,ce;p.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const fe=Ua(f,n.paint.get("model-cutoff-fade-range"));if(fe.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),D&&N)ne=f.getOrCreateProgram("modelDepth",{defines:q}),le=qv(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(l.matrix)),ce=N.getShadowPassColorMode();else{Qr(q,ie,V,f,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),ne=f.getOrCreateProgram("model",{defines:q,overrideFog:$});const _e=V.material,Te=_e.pbrMetallicRoughness,we=n.paint.get("model-opacity").constantOr(1),Se=n.paint.get("model-emissive-strength").constantOr(0);le=bp(v.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,f,we,Te.baseColorFactor.toRenderColor(null),_e.emissiveFactor,Te.metallicFactor,Te.roughnessFactor,_e,Se,n,y),N&&(S.shadowUniformsInitialized?ne.setShadowUniformValues(A,N.getShadowUniformValues()):(N.setupShadows(v.toUnwrapped(),ne,"model-tile",v.overscaledZ),S.shadowUniformsInitialized=!0)),ce=fe.shouldRenderCutoff||we<1||_e.alphaMode!=="OPAQUE"?Or.alphaBlended:Or.unblended}f.uploadCommonUniforms(A,ne,v.toUnwrapped(),null,fe);const ve=V.material.doubleSided?mr.disabled:mr.backCCW;if(p.instancedDataArray.length>20)ie.push(p.instancedDataBuffer),ne.draw(f,A.gl.TRIANGLES,j,Er.disabled,ce,ve,le,n.id,V.vertexBuffer,V.indexBuffer,V.segments,n.paint,f.transform.zoom,void 0,ie,p.instancedDataArray.length);else{const _e=D?"u_instance":"u_normal_matrix";for(let Te=0;Te<p.instancedDataArray.length;++Te)le[_e]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Te,16),ne.draw(f,A.gl.TRIANGLES,j,Er.disabled,ce,ve,le,n.id,V.vertexBuffer,V.indexBuffer,V.segments,n.paint,f.transform.zoom,void 0,ie)}}if(l.children)for(const V of l.children)qa(f,n,V,p,y,v,S)}const Dl=[1,-1,1];function Ll(f,n,l,p){if(!l.modelManager)return!0;const y=l.modelManager;if(!l.shadowRenderer)return!0;const v=l.shadowRenderer,S=n.aabb;let A=!0,D=f.maxHeight;if(D===0){let j=0;for(const $ in f.instancesPerModel){const V=y.getModel($,p);V?j=Math.max(j,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):A=!1}D=f.maxScale*j*1.41+f.maxVerticalOffset,A&&(f.maxHeight=D)}S.max[2]=D,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,o.ab.vec3.transformMat4(S.min,S.min,n.tileMatrix),o.ab.vec3.transformMat4(S.max,S.max,n.tileMatrix);const N=S.intersects(v.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=N===2),N===0}function Ep(f,n){const l=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],v=f.uniformValues.u_cutoff_params[3];return p===l||v===y?1:o.aw(((n-l)/(p-l)-y)/(v-y),0,1)}function Cp(f,n,l,p){if(n.pitch<20)return 1;const y=n.getWorldToCameraMatrix();o.ab.mat4.multiply(y,y,f);const v=o.ab.vec4.fromValues(l.min[0],l.min[1],l.min[2],1);let S=o.ab.vec4.transformMat4(o.ab.vec4.create(),v,y),A=S,D=S;v[1]=l.max[1],S=o.ab.vec4.transformMat4(o.ab.vec4.create(),v,y),A=S[1]<A[1]?S:A,D=S[1]>D[1]?S:D,v[0]=l.max[0],S=o.ab.vec4.transformMat4(o.ab.vec4.create(),v,y),A=S[1]<A[1]?S:A,D=S[1]>D[1]?S:D,v[1]=l.min[1],S=o.ab.vec4.transformMat4(o.ab.vec4.create(),v,y),A=S[1]<A[1]?S:A,D=S[1]>D[1]?S:D;const N=o.aw(p[0],0,1),j=100*n.pixelsPerMeter*o.aw(p[1],0,1),$=o.aw(p[2],0,1),V=o.ab.vec4.lerp(o.ab.vec4.create(),A,D,N),q=Math.tan(.5*n.fovX),ie=-V[2]*q;if(j===0)return V[1]<-Math.abs(ie)?$:1;const ne=(-Math.abs(ie)-V[1])/j,le=(fe,ve,_e)=>(1-_e)*fe+_e*ve,ce=o.aw(le(1,$,ne),$,1);return le(1,ce,o.aw((n.pitch-20)/20,0,1))}class __{}class y_{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,l,p){{const $=this._storage.get(l.id);if($)return $.lastUsedFrameIdx=n,$.buf}const y=p.gl,v=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),S=new ArrayBuffer(v),A=new Int16Array(S);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const D=new o.dq;for(let $=0;$<v/2;$+=3){const V=A[$],q=A[$+1],ie=A[$+2];D.emplaceBack(V,q),D.emplaceBack(q,ie),D.emplaceBack(ie,V)}const N=p.bindVertexArrayOES.current,j=new __;return j.buf=new _a(p,D),j.lastUsedFrameIdx=n,this._storage.set(l.id,j),p.bindVertexArrayOES.set(N),j.buf}update(n){for(const[l,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(l))}destroy(){for(const[n,l]of this._storage)l.buf.destroy(),this._storage.delete(n)}}class v_{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ol=o.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class x_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class bh{constructor(n,l){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const b_=o.da([{type:"Float32",name:"a_pos_2f",components:2}]);class w_{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,l){const p=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new o.dr,A=new o.aU;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),A.emplaceBack(0,1,2),A.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(S,b_.members),this.vignetteIdx=n.context.createIndexBuffer(A)}const y=o.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,p);const S={u_vignetteShape:(v={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};p.draw(n,n.context.gl.TRIANGLES,sr.disabled,Er.disabled,Or.alphaBlended,mr.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,y,{})}var v}}class no{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,l){const p=n.getFreeCameraOptions().position,y=p.toAltitude(),v=p.toLngLat(),S=o.ai(v.lng),A=o.ai(v.lat),D=n.pixelsPerMeter/l,N=S*o.ds,j=o.ds*Math.log(Math.tan(Math.PI/4+A/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const $=-this._offsetYPrev+j,V=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*D,this._accumulatedOffsetY+=$*D,this._accumulatedElevation+=V*D,this._offsetXPrev=N,this._offsetYPrev=j,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Mp(f,n){return[-(f[0]-Math.floor(f[0]/n)*n),-(f[1]-Math.floor(f[1]/n)*n),-(f[2]-Math.floor(f[2]/n)*n)]}function Pp(f){const n=o.di(1323123451230),l=[];for(let p=0;p<f;++p){const y=2*n()-1,v=2*n()-1,S=2*n()-1;l.push(o.ab.vec3.fromValues(y,v,S))}return l}function Ms(f,n,l,p,y){const v=o.aw((y-l)/(p-l),0,1);return(1-v)*f+v*n}class zl{constructor(n){this._movement=new no,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new w_,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,l){const p=n.transform;this._movement.update(p,this._ppmScaleFactor);const y=p.starsProjMatrix,v=o.ab.quat.identity([]);o.ab.quat.rotateX(v,v,o.ai(90)-p._pitch),o.ab.quat.rotateZ(v,v,-p.angle);const S=o.ab.mat4.fromQuat(new Float32Array(16),v),A=o.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=o.ab.mat4.transpose([],A),N=o.ab.mat4.multiply([],D,S),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*l,this._prevTime=j,{projectionMatrix:y,modelviewMatrix:N}}}class S_ extends zl{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new bh(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const l=n.context;if(!this.particlesVx){const p=Pp(this.particlesCount),y=new o.dt,v=new o.aU;let S=0;const A=o.di(1323123451230);for(let D=0;D<p.length;++D){const N=p[D],j=[2*A()-1,A(),A(),A()];y.emplaceBack(N[0],N[1],N[2],-1,-1,...j),y.emplaceBack(N[0],N[1],N[2],1,-1,...j),y.emplaceBack(N[0],N[1],N[2],1,1,...j),y.emplaceBack(N[0],N[1],N[2],-1,1,...j),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=l.createVertexBuffer(y,Ol.members),this.particlesIdx=l.createIndexBuffer(v)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=n.transform.zoom;if(l.revealStart>p)return;const y=Ms(0,1,l.revealStart,l.revealStart+l.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let S=[-v.direction.x,v.direction.y,-100];o.ab.vec3.normalize(S,S);const A=structuredClone(this._vignetteParams);A.strength*=y,v.overrideStyleParameters||(v.intensity=n.style.rain.state.density,v.timeFactor=n.style.rain.state.intensity,v.color=structuredClone(n.style.rain.state.color),S=structuredClone(n.style.rain.state.direction),v.screenThinning.intensity=n.style.rain.state.centerThinning,v.dropletSizeX=n.style.rain.state.dropletSize[0],v.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],v.distortionStrength=100*n.style.rain.state.distortionStrength,A.strength=1,A.color=structuredClone(n.style.rain.state.vignetteColor));const D=this.updateOnRender(n,v.timeFactor),N=n.context,j=N.gl,$=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new o.T(N,{width:n.width,height:n.height,data:null},j.RGBA8)),v.distortionStrength>0&&(N.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const V=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(N,V),N.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const q=[v.color.r,v.color.g,v.color.b,v.color.a],ie=(ne,le)=>{const ce=Mp(this._movement.getPosition(),ne),fe=v.dropletSizeX,ve=v.dropletSizeX*v.dropletSizeYScale,_e=n.width/2,Te=n.height/2,we=Ms(0,v.screenThinning.start,0,1,v.screenThinning.intensity),Se=Ms(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),be=Ms(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),ke=(ze={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ce,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:ne,rainDropletSize:[fe,ve],distortionStrength:v.distortionStrength,rainDirection:S,color:q,screenSize:[$.width,$.height],thinningCenterPos:[_e,Te],thinningShape:[we,Se,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:le?0:1},{u_modelview:Float32Array.from(ze.modelview),u_projection:Float32Array.from(ze.projection),u_time:ze.time,u_cam_pos:ze.camPos,u_texScreen:0,u_velocityConeAperture:ze.velocityConeAperture,u_velocity:ze.velocity,u_boxSize:ze.boxSize,u_rainDropletSize:ze.rainDropletSize,u_distortionStrength:ze.distortionStrength,u_rainDirection:ze.rainDirection,u_color:ze.color,u_screenSize:ze.screenSize,u_thinningCenterPos:ze.thinningCenterPos,u_thinningShape:ze.thinningShape,u_thinningAffectedRatio:ze.thinningAffectedRatio,u_thinningParticleOffset:ze.thinningParticleOffset,u_shapeDirectionalPower:ze.shapeDirectionalPower,u_shapeNormalPower:ze.shapeNormalPower,u_mode:ze.mode});var ze;const tt=Math.round(y*v.intensity*this.particlesCount),Xe=o.b7.simpleSegment(0,0,4*tt,2*tt);V.draw(n,j.TRIANGLES,sr.disabled,Er.disabled,Or.alphaBlended,mr.disabled,ke,"rain_particles",this.particlesVx,this.particlesIdx,Xe,{})};v.distortionStrength>0&&ie(v.boxSize,!0),ie(v.boxSize,!1),this._vignette.draw(n,A)}}const T_=o.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class E_ extends zl{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new bh(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const l=n.context;if(!this.particlesVx){const p=Pp(this.particlesCount),y=new o.du,v=new o.aU;let S=0;const A=o.di(1323123451230);for(let D=0;D<p.length;++D){const N=p[D],j=A(),$=A(),V=A(),q=[D/p.length,j,$,V],ie=[A(),A()];y.emplaceBack(N[0],N[1],N[2],-1,-1,...q,...ie),y.emplaceBack(N[0],N[1],N[2],1,-1,...q,...ie),y.emplaceBack(N[0],N[1],N[2],1,1,...q,...ie),y.emplaceBack(N[0],N[1],N[2],-1,1,...q,...ie),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=l.createVertexBuffer(y,T_.members),this.particlesIdx=l.createIndexBuffer(v)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const l=structuredClone(this._params);let p=[-l.direction.x,l.direction.y,-100];o.ab.vec3.normalize(p,p);const y=structuredClone(this._vignetteParams),v=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=n.transform.zoom;if(v.revealStart>S)return;const A=Ms(0,1,v.revealStart,v.revealStart+v.revealRange,S);y.strength*=A,l.overrideStyleParameters||(l.intensity=n.style.snow.state.density,l.timeFactor=n.style.snow.state.intensity,l.color=structuredClone(n.style.snow.state.color),p=structuredClone(n.style.snow.state.direction),l.screenThinning.intensity=n.style.snow.state.centerThinning,l.billboardSize=2.79*n.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(n.style.snow.state.vignetteColor));const D=this.updateOnRender(n,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const N=n.context,j=N.gl,$=n.transform,V=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(N,V),((q,ie,ne)=>{const le=Mp(this._movement.getPosition(),q),ce=$.width/2,fe=$.height/2,ve=Ms(0,ne.screenThinning.start,0,1,ne.screenThinning.intensity),_e=Ms(.001,ne.screenThinning.range,0,1,ne.screenThinning.intensity),Te=Ms(0,ne.screenThinning.particleOffset,0,1,ne.screenThinning.intensity),we=(Se={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:le,velocityConeAperture:ne.velocityConeAperture,velocity:ne.velocity,horizontalOscillationRadius:ne.horizontalOscillationRadius,horizontalOscillationRate:ne.horizontalOscillationRate,boxSize:q,billboardSize:1*ne.billboardSize,simpleShapeParameters:[ne.shapeFadeStart,ne.shapeFadePower],screenSize:[$.width,$.height],thinningCenterPos:[ce,fe],thinningShape:[ve,_e,Math.pow(10,ne.screenThinning.fadePower)],thinningAffectedRatio:ne.screenThinning.affectedRatio,thinningParticleOffset:Te,color:[ne.color.r,ne.color.g,ne.color.b,ne.color.a],direction:p},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_horizontalOscillationRadius:Se.horizontalOscillationRadius,u_horizontalOscillationRate:Se.horizontalOscillationRate,u_boxSize:Se.boxSize,u_billboardSize:Se.billboardSize,u_simpleShapeParameters:Se.simpleShapeParameters,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_particleColor:Se.color,u_direction:Se.direction});var Se;const be=Math.round(A*ne.intensity*this.particlesCount),ke=o.b7.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&V.draw(n,j.TRIANGLES,sr.disabled,Er.disabled,Or.alphaBlended,mr.disabled,we,"snow_particles",this.particlesVx,this.particlesIdx,ke,{})})(l.boxSize,0,l),this._vignette.draw(n,y)}}const Wa={symbol:function(f,n,l,p,y){if(f.renderPass!=="translucent")return;const v=Er.disabled,S=f.colorModeForRenderPass(),A=l.layout.get("text-variable-anchor"),D=l.layout.get("text-size-scale-range"),N=o.aw(f.scaleFactor,D[0],D[1]);A&&function(V,q,ie,ne,le,ce,fe,ve){const _e=q.transform,Te=le==="map",we=ce==="map";for(const Se of V){const be=ne.getTile(Se),ke=be.getBucket(ie);if(!ke||!ke.text||!ke.text.segments.get().length)continue;const ze=o.bp(ke.textSizeData,_e.zoom,ve),tt=eh(Se,ke.getProjection(),_e),Xe=_e.calculatePixelsToTileUnitsMatrix(be),Oe=Na(tt,be.tileID.canonical,we,Te,_e,ke.getProjection(),Xe),$e=ke.hasIconTextFit()&&ke.hasIconData();if(ze){const ht=Math.pow(2,_e.zoom-be.tileID.overscaledZ);Wv(ke,Te,we,fe,o.cX,_e,Oe,Se,ht,ze,$e)}}}(p,f,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),y,N);const j=l.paint.get("icon-opacity").constantOr(1)!==0,$=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||$)?Xo(f,n,l,p,v,S):(j&&Xo(f,n,l,p,v,S,{onlyIcons:!0}),$&&Xo(f,n,l,p,v,S,{onlyText:!0})),n.map.showCollisionBoxes&&(h_(f,n,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),h_(f,n,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,l,p){if(f.renderPass!=="translucent")return;const y=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),S=l.paint.get("circle-stroke-opacity"),A=l.layout.get("circle-sort-key").constantOr(1)!==void 0,D=l.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(v.constantOr(1)===0||S.constantOr(1)===0))return;const N=f.context,j=N.gl,$=f.transform,V=f.depthModeForSublayer(0,sr.ReadOnly),q=Er.disabled,ie=f.colorModeForDrapableLayerRenderPass(D),ne=$.projection.name==="globe",le=[o.at($.center.lng),o.aA($.center.lat)],ce=[];for(let ve=0;ve<p.length;ve++){const _e=p[ve],Te=n.getTile(_e),we=Te.getBucket(l);if(!we||we.projection.name!==$.projection.name)continue;const Se=we.programConfigurations.get(l.id),be=o.cY(l),ke=f.isTileAffectedByFog(_e);ne&&be.push("PROJECTION_GLOBE_VIEW"),be.push("DEPTH_D24"),f.terrain&&$.depthOcclusionForSymbolsAndCircles&&be.push("DEPTH_OCCLUSION");const ze=f.getOrCreateProgram("circle",{config:Se,defines:be,overrideFog:ke}),tt=we.layoutVertexBuffer,Xe=we.globeExtVertexBuffer,Oe=we.indexBuffer,$e=$.projection.createInversionMatrix($,_e.canonical),ht={programConfiguration:Se,program:ze,layoutVertexBuffer:tt,globeExtVertexBuffer:Xe,indexBuffer:Oe,uniformValues:o.cZ(f,_e,Te,$e,le,l),tile:Te};if(A){const xt=we.segments.get();for(const Pt of xt)ce.push({segments:new o.b7([Pt]),sortKey:Pt.sortKey,state:ht})}else ce.push({segments:we.segments,sortKey:0,state:ht})}A&&ce.sort((ve,_e)=>ve.sortKey-_e.sortKey);const fe={useDepthForOcclusion:$.depthOcclusionForSymbolsAndCircles};for(const ve of ce){const{programConfiguration:_e,program:Te,layoutVertexBuffer:we,globeExtVertexBuffer:Se,indexBuffer:be,uniformValues:ke,tile:ze}=ve.state,tt=ve.segments;f.terrain&&f.terrain.setupElevationDraw(ze,Te,fe),f.uploadCommonUniforms(N,Te,ze.tileID.toUnwrapped()),Te.draw(f,j.TRIANGLES,V,q,ie,mr.disabled,ke,l.id,we,be,tt,l.paint,$.zoom,_e,[Se])}},heatmap:function(f,n,l,p){if(l.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,v=y.gl,S=Er.disabled,A=new Or([v.ONE,v.ONE,v.ONE,v.ONE],o.aj.transparent,[!0,!0,!0,!0]);(function(q,ie,ne,le){const ce=q.gl,fe=ie.width*le,ve=ie.height*le;q.activeTexture.set(ce.TEXTURE1),q.viewport.set([0,0,fe,ve]);let _e=ne.heatmapFbo;if(!_e||_e&&(_e.width!==fe||_e.height!==ve)){_e&&_e.destroy();const Te=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Te),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),_e=ne.heatmapFbo=q.createFramebuffer(fe,ve,!0,null),function(we,Se,be,ke,ze,tt){const Xe=we.gl;Xe.texImage2D(Xe.TEXTURE_2D,0,we.extRenderToTextureHalfFloat?Xe.RGBA16F:Xe.RGBA,ze,tt,0,Xe.RGBA,we.extRenderToTextureHalfFloat?Xe.HALF_FLOAT:Xe.UNSIGNED_BYTE,null),ke.colorAttachment.set(be)}(q,0,Te,_e,fe,ve)}else ce.bindTexture(ce.TEXTURE_2D,_e.colorAttachment.get()),q.bindFramebuffer.set(_e.framebuffer)})(y,f,l,f.transform.projection.name==="globe"?.5:.25),y.clear({color:o.aj.transparent});const D=f.transform,N=D.projection.name==="globe",j=N?["PROJECTION_GLOBE_VIEW"]:[],$=N?mr.frontCCW:mr.disabled,V=[o.at(D.center.lng),o.aA(D.center.lat)];for(let q=0;q<p.length;q++){const ie=p[q];if(n.hasRenderableParent(ie))continue;const ne=n.getTile(ie),le=ne.getBucket(l);if(!le||le.projection.name!==D.projection.name)continue;const ce=f.isTileAffectedByFog(ie),fe=le.programConfigurations.get(l.id),ve=f.getOrCreateProgram("heatmap",{config:fe,defines:j,overrideFog:ce}),{zoom:_e}=f.transform;f.terrain&&f.terrain.setupElevationDraw(ne,ve),f.uploadCommonUniforms(y,ve,ie.toUnwrapped());const Te=D.projection.createInversionMatrix(D,ie.canonical);ve.draw(f,v.TRIANGLES,sr.disabled,S,A,$,T2(f,ie,ne,Te,V,_e,l.paint.get("heatmap-intensity")),l.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,l.paint,f.transform.zoom,fe,N?[le.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,v){const S=y.context,A=S.gl,D=v.heatmapFbo;if(!D)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,D.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let N=v.colorRampTexture;N||(N=v.colorRampTexture=new o.T(S,v.colorRamp,A.RGBA8)),N.bind(A.LINEAR,A.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,A.TRIANGLES,sr.disabled,Er.disabled,y.colorModeForRenderPass(),mr.disabled,((j,$,V,q)=>({u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}))(0,v),v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(f,l))},line:function(f,n,l,p){if(f.renderPass!=="translucent")return;const y=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(y.constantOr(1)===0||v.constantOr(1)===0)return;const S=l.paint.get("line-emissive-strength"),A=l.paint.get("line-occlusion-opacity"),D=l.layout.get("line-elevation-reference"),N=l.layout.get("line-width-unit")==="meters",j=D==="sea",$=f.context,V=$.gl,q=!l.isDraped();if(q&&f.transform.projection.name==="globe")return;const ie=l.layout.get("line-cross-slope"),ne=ie!==void 0,le=ie<1,ce=q?new sr(f.depthOcclusion?V.GREATER:V.LEQUAL,sr.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,sr.ReadOnly),fe=f.colorModeForDrapableLayerRenderPass(S),ve=f.terrain&&f.terrain.renderingToTexture,_e=ve?1:o.q.devicePixelRatio,Te=l.paint.get("line-dasharray"),we=Te.constantOr(1),Se=l.layout.get("line-cap"),be=Te.constantOr(null),ke=Se.constantOr(null),ze=l.paint.get("line-pattern"),tt=ze.constantOr(1),Xe=ze.constantOr(null),Oe=l.paint.get("line-opacity").constantOr(1);let $e=!tt&&Oe!==1||f.depthOcclusion&&A>0&&A<1;const ht=l.paint.get("line-gradient"),xt=tt?"linePattern":"line",Pt=o.c_(l);let Ye;if(ve&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&($e=!1),A!==0&&f.depthOcclusion){const ot=l.paint._values["line-opacity"];ot&&ot.value&&ot.value.kind==="constant"?Ye=ot.value:o.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}if(q&&(f.forceTerrainMode=!0),!q&&A!==0&&f.terrain&&!ve)return void o.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`);const mt=$e&&q?f.stencilModeFor3D():Er.disabled;q&&(Pt.push("ELEVATED"),ne&&Pt.push(le?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),j&&Pt.push("ELEVATION_REFERENCE_SEA")),v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&Pt.push("VARIABLE_LINE_WIDTH");for(const ot of p){const Tt=n.getTile(ot);if(tt&&!Tt.patternsLoaded())continue;const gt=Tt.getBucket(l);if(!gt)continue;f.prepareDrawTile();const ft=gt.programConfigurations.get(l.id),zt=f.isTileAffectedByFog(ot),Ft=f.getOrCreateProgram(xt,{config:ft,defines:Pt,overrideFog:zt,overrideRtt:!q&&void 0});if(Xe&&Tt.imageAtlas){const Rr=o.A.from(Xe),Bn=Tt.imageAtlas.patternPositions[Rr.getSerializedPrimary()];Bn&&ft.setConstantPatternPositions(Bn)}if(!tt&&be&&ke&&Tt.lineAtlas){const Rr=Tt.lineAtlas.getDash(be,ke);Rr&&ft.setConstantPatternPositions(Rr)}let[Dt,$t]=l.paint.get("line-trim-offset");(ke==="round"||ke==="square")&&Dt!==$t&&(Dt===0&&(Dt-=1),$t===1&&($t+=1));const vr=ve?ot.projMatrix:null,lr=N?1/gt.tileToMeter/o.ar(Tt,1,f.transform.zoom):1,ar=N?1/gt.tileToMeter/o.ar(Tt,1,Math.floor(f.transform.zoom)):1,xr=tt?o.c$(f,Tt,l,vr,_e,lr,ar,[Dt,$t]):o.d0(f,Tt,l,vr,gt.lineClipsArray.length,_e,lr,ar,[Dt,$t]);if(ht){const Rr=gt.gradients[l.id];let Bn=Rr.texture;if(l.gradientVersion!==Rr.version){let Pn=256;if(l.stepInterpolant){const an=n.getSource().maxzoom,yn=ot.canonical.z===an?Math.ceil(1<<f.transform.maxZoom-ot.canonical.z):1;Pn=o.aw(o.d1(gt.maxLineLength/o.ag*1024*yn),256,$.maxTextureSize)}Rr.gradient=o.d2({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Pn,image:Rr.gradient||void 0,clips:gt.lineClipsArray}),Rr.texture?Rr.texture.update(Rr.gradient):Rr.texture=new o.T($,Rr.gradient,V.RGBA8),Rr.version=l.gradientVersion,Bn=Rr.texture}$.activeTexture.set(V.TEXTURE1),Bn.bind(l.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}we&&($.activeTexture.set(V.TEXTURE0),Tt.lineAtlasTexture&&Tt.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),ft.updatePaintBuffers()),tt&&($.activeTexture.set(V.TEXTURE0),Tt.imageAtlasTexture&&Tt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ft.updatePaintBuffers()),q&&!j&&f.terrain.setupElevationDraw(Tt,Ft),f.uploadCommonUniforms($,Ft,ot.toUnwrapped());const $r=Rr=>{Ye!=null&&(Ye.value=Oe*A),Ft.draw(f,V.TRIANGLES,ce,Rr,fe,mr.disabled,xr,l.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,l.paint,f.transform.zoom,ft,[gt.layoutVertexBuffer2,gt.patternVertexBuffer,gt.zOffsetVertexBuffer]),Ye!=null&&(Ye.value=Oe)};if($e&&!q){const Rr=f.stencilModeForClipping(ot).ref;Rr===0&&ve&&$.clear({stencil:0});const Bn={func:V.EQUAL,mask:255};xr.u_alpha_discard_threshold=.8,$r(new Er(Bn,Rr,255,V.KEEP,V.KEEP,V.INVERT)),xr.u_alpha_discard_threshold=0,$r(new Er(Bn,Rr,255,V.KEEP,V.KEEP,V.KEEP))}else $e&&q&&(xr.u_alpha_discard_threshold=.001),$r(q?mt:f.stencilModeForClipping(ot))}q&&(f.forceTerrainMode=!1),$e&&(f.resetStencilClippingMasks(),ve&&$.clear({stencil:0})),A===0||f.depthOcclusion||ve||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,n,l,p){const y=l.paint.get("fill-color"),v=l.paint.get("fill-opacity"),S=l.is3D(),A=new sr(f.context.gl.LEQUAL,sr.ReadWrite,f.depthRangeFor3D);if(v.constantOr(1)===0)return;const D=l.paint.get("fill-emissive-strength"),N=f.colorModeForDrapableLayerRenderPass(D),j=l.paint.get("fill-pattern"),$=f.opaquePassEnabledForLayer()&&!j.constantOr(1)&&y.constantOr(o.aj.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===$){const V=S?A:f.depthModeForSublayer(1,f.renderPass==="opaque"?sr.ReadWrite:sr.ReadOnly);gh(f,n,l,p,V,N,!1)}if(!S&&f.renderPass==="translucent"&&l.paint.get("fill-antialias")){const V=S?A:f.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,sr.ReadOnly);gh(f,n,l,p,V,N,!0)}},"fill-extrusion":function(f,n,l,p){const y=l.paint.get("fill-extrusion-opacity"),v=f.context,S=v.gl,A=f.terrain,D=A&&A.renderingToTexture;if(y===0)return;const N=f.conflationActive&&f.style.isLayerClipped(l,n.getSource()),j=f.style.order.indexOf(l.fqid);if(N&&function($,V,q,ie,ne){for(const le of ie){const ce=V.getTile(le).getBucket(q);ce&&(ce.updateReplacement(le,$.replacementSource,ne),ce.uploadCentroid($.context))}}(f,n,l,p,j),A||N)for(const $ of p){const V=n.getTile($).getBucket(l);V&&Zv(f.context,n,$,V,l,A,N)}if(f.renderPass==="shadow"&&f.shadowRenderer){const $=f.shadowRenderer;if(A&&y<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.a9)return;const V=$.getShadowPassDepthMode(),q=$.getShadowPassColorMode();Mu(f,n,l,p,V,Er.disabled,q,N)}else if(f.renderPass==="translucent"){const $=!l.paint.get("fill-extrusion-pattern").constantOr(1),V=l.paint.get("fill-extrusion-color").constantOr(o.aj.white);if(!D&&V.a!==0){const q=new sr(f.context.gl.LEQUAL,sr.ReadWrite,f.depthRangeFor3D);y===1&&$?Mu(f,n,l,p,q,Er.disabled,Or.unblended,N):(Mu(f,n,l,p,q,Er.disabled,Or.disabled,N),Mu(f,n,l,p,q,f.stencilModeFor3D(),f.colorModeForRenderPass(),N),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&$&&(!A&&f.transform.projection.name!=="globe"||D)){const q=l.paint.get("fill-extrusion-opacity"),ie=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),le=l.paint.get("fill-extrusion-flood-light-intensity"),ce=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",fe=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(ce?null:l.lut).toArray01().slice(0,3),ve=ie>0&&ne>0,_e=le>0,Te=(Se,be,ke)=>(1-ke)*Se+ke*be,we=Se=>{const be=f.depthModeForSublayer(1,sr.ReadOnly,S.LEQUAL,!0),ke=l.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ze=Te(.1,3,ke),tt=f._showOverdrawInspector;if(!tt){const Xe=new Er({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Oe=new Or([S.ONE,S.ONE,S.ONE,S.ONE],o.aj.transparent,[!1,!1,!1,!0],S.MIN);Ec(f,n,l,p,be,Xe,Oe,mr.disabled,Se,"sdf",q,ie,ne,le,fe,ze,N,!1)}{const Xe=tt?Er.disabled:new Er({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Oe=tt?f.colorModeForRenderPass():new Or([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.aj.transparent,[!0,!0,!0,!0]);Ec(f,n,l,p,be,Xe,Oe,mr.disabled,Se,"color",q,ie,ne,le,fe,ze,N,!1)}};if(D){const Se=(be,ke,ze)=>{const tt=f.depthModeForSublayer(1,sr.ReadOnly,S.LEQUAL,!1),Xe=l.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=Te(.1,3,Xe);{const $e=new Or([S.ONE,S.ONE,S.ONE,S.ONE],o.aj.transparent,[!1,!1,!1,!0]);Ec(f,n,l,p,tt,Er.disabled,$e,mr.disabled,be,"clear",q,ie,ne,le,fe,Oe,N,ke)}{const $e=new Er({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),ht=new Or([S.ONE,S.ONE,S.ONE,S.ONE],o.aj.transparent,[!1,!1,!1,!0],S.MIN);Ec(f,n,l,p,tt,$e,ht,mr.disabled,be,"sdf",q,ie,ne,le,fe,Oe,N,ke)}{const $e=be?S.ZERO:S.ONE_MINUS_DST_ALPHA,ht=new Er({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),xt=new Or([$e,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.aj.transparent,[!0,!0,!0,!0]);Ec(f,n,l,p,tt,ht,xt,mr.disabled,be,"color",q,ie,ne,le,fe,Oe,N,ke)}{const $e=new Or([S.ONE,S.ONE,S.ONE,be?S.ZERO:S.ONE],o.aj.transparent,[!1,!1,!1,!0],be?S.FUNC_ADD:S.MAX);Ec(f,n,l,p,tt,Er.disabled,$e,mr.disabled,be,"clear",q,ie,ne,le,fe,Oe,N,ke,ze)}};if(ve||_e){let be;if(f.prepareDrawTile(),A){const ke=A.drapeBufferSize[0],ze=A.drapeBufferSize[1];be=A.framebufferCopyTexture,be&&(!be||be.size[0]===ke&&be.size[1]===ze)||(be&&be.destroy(),be=A.framebufferCopyTexture=new o.T(v,new o.r({width:ke,height:ze}),S.RGBA8)),be.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,ke,ze)}ve&&Se(!0,!1,be),_e&&Se(!1,!0,be)}}else ve&&we(!0),_e&&we(!1),(ve||_e)&&f.resetStencilClippingMasks()}}},hillshade:function(f,n,l,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const y=f.context,v=f.terrain&&f.terrain.renderingToTexture,[S,A]=f.renderPass!=="translucent"||v?[{},p]:f.stencilConfigForOverlap(p);for(const D of A){const N=n.getTile(D);if(N.needsHillshadePrepare&&f.renderPass==="offscreen")bu(f,N,l);else if(f.renderPass==="translucent"){const j=f.depthModeForSublayer(0,sr.ReadOnly),$=l.paint.get("hillshade-emissive-strength"),V=f.colorModeForDrapableLayerRenderPass($),q=v&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];Pv(f,D,N,l,j,q,V)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,l,p,y,v){if(f.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const S=f.transform.projection.name==="globe",A=l.paint.get("raster-elevation")!==0,D=A&&S;if(f.renderElevatedRasterBackface&&!D)return;const N=f.context,j=N.gl,$=n.getSource(),V=function(we,Se,be,ke){const ze=Se.paint.get("raster-color"),tt=we.type==="raster-array",Xe=[],Oe=Se.paint.get("raster-resampling"),$e=Se.paint.get("raster-color-mix");let ht=Se.paint.get("raster-color-range");const xt=[$e[0],$e[1],$e[2],0],Pt=$e[3];let Ye=Oe==="nearest"?ke.NEAREST:ke.LINEAR;if(tt&&(Xe.push("RASTER_ARRAY"),ze||Xe.push("RASTER_COLOR"),Oe==="linear"&&Xe.push("RASTER_ARRAY_LINEAR"),Ye=ke.NEAREST,!ht&&we.rasterLayers)){const mt=we.rasterLayers.find(({id:ot})=>ot===Se.sourceLayer);mt&&mt.fields&&mt.fields.range&&(ht=mt.fields.range)}if(ht=ht||[0,1],ze){Xe.push("RASTER_COLOR"),be.activeTexture.set(ke.TEXTURE2),Se.updateColorRamp(ht);let mt=Se.colorRampTexture;mt||(mt=Se.colorRampTexture=new o.T(be,Se.colorRamp,ke.RGBA8)),mt.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)}return{mix:xt,range:ht,offset:Pt,defines:Xe,resampling:Ye}}($,l,N,j);if($ instanceof o.aJ&&!p.length&&!S)return;const q=l.paint.get("raster-emissive-strength"),ie=f.colorModeForDrapableLayerRenderPass(q),ne=f.terrain&&f.terrain.renderingToTexture,le=!f.options.moving,ce=l.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if($ instanceof o.aJ&&!p.length&&($.onNorthPole||$.onSouthPole)){const we=A?f.stencilModeFor3D():Er.disabled;return void Ut(!!$.onNorthPole,null,f,n,l,q,V,mr.disabled,we)}if(!p.length)return;const[fe,ve]=$ instanceof o.aJ||ne?[{},p]:f.stencilConfigForOverlap(p),_e=ve[ve.length-1].overscaledZ;D&&V.defines.push("PROJECTION_GLOBE_VIEW"),A&&V.defines.push("RENDER_CUTOFF");const Te=(we,Se,be)=>{for(const ke of we){const ze=ke.toUnwrapped(),tt=n.getTile(ke);if(ne&&(!tt||!tt.hasData()))continue;N.activeTexture.set(j.TEXTURE0);const Xe=ti(tt,$,l,V);if(!Xe||!Xe.texture)continue;const{texture:Oe,mix:$e,offset:ht,tileSize:xt,buffer:Pt}=Xe;let Ye,mt;ne?(Ye=sr.disabled,mt=ke.projMatrix):A?(Ye=new sr(j.LEQUAL,sr.ReadWrite,f.depthRangeFor3D),mt=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(ze,le)):(Ye=f.depthModeForSublayer(ke.overscaledZ-_e,l.paint.get("raster-opacity")===1?sr.ReadWrite:sr.ReadOnly,j.LESS),mt=f.transform.calculateProjMatrix(ze,le));const ot=f.terrain&&ne?f.terrain.stencilModeForRTTOverlap(ke):fe[ke.overscaledZ],Tt=v?0:l.paint.get("raster-fade-duration");tt.registerFadeDuration(Tt);const gt=n.findLoadedParent(ke,0),ft=Tu(tt,gt,n,f.transform,Tt);let zt,Ft;f.terrain&&f.terrain.prepareDrawTile(),N.activeTexture.set(j.TEXTURE0),Oe.bind(ce,j.CLAMP_TO_EDGE),N.activeTexture.set(j.TEXTURE1),gt?(gt.texture&&gt.texture.bind(ce,j.CLAMP_TO_EDGE),zt=Math.pow(2,gt.tileID.overscaledZ-tt.tileID.overscaledZ),Ft=[tt.tileID.canonical.x*zt%1,tt.tileID.canonical.y*zt%1]):Oe.bind(ce,j.CLAMP_TO_EDGE),Oe.useMipmap&&N.extTextureFilterAnisotropic&&f.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Dt=f.transform;let $t;const vr=A?Iu(Dt):[0,0,0,0];let lr,ar,xr,$r,Rr,Bn=0;if(D&&$ instanceof o.aJ&&$.coordinates.length>3)lr=Float32Array.from(o.bb(o.cH(new o.bT(0,0,0)))),ar=Float32Array.from(Dt.globeMatrix),xr=Float32Array.from(o.cD(Dt)),$r=[o.at(Dt.center.lng),o.aA(Dt.center.lat)],$t=$.elevatedGlobePerspectiveTransform,Rr=$.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const Dr=o.cE(ke.canonical);Bn=o.cF(Dr.getCenter().lat),lr=Float32Array.from(o.bb(o.cH(ke.canonical))),ar=Float32Array.from(Dt.globeMatrix),xr=Float32Array.from(o.cD(Dt)),$r=[o.at(Dt.center.lng),o.aA(Dt.center.lat)],$t=[0,0],Rr=Float32Array.from(o.cG(ke.canonical,Dr,Bn,Dt.worldSize/Dt._pixelsPerMercatorPixel))}else $t=$ instanceof o.aJ?$.perspectiveTransform:[0,0],lr=new Float32Array(16),ar=new Float32Array(9),xr=new Float32Array(16),$r=[0,0],Rr=new Float32Array(9);const Pn=qt(mt,lr,ar,xr,Rr,Ft||[0,0],o.ae(f.transform.zoom),$r,vr,zt||1,ft,l,$t,A?l.paint.get("raster-elevation"):0,2,$e,ht,V.range,xt,Pt,q),an=f.isTileAffectedByFog(ke),yn=f.getOrCreateProgram("raster",{defines:V.defines,overrideFog:an});if(f.uploadCommonUniforms(N,yn,ze),$ instanceof o.aJ){const Dr=$.elevatedGlobeVertexBuffer,Gr=$.elevatedGlobeIndexBuffer;if(ne||!S)$.boundsBuffer&&$.boundsSegments&&yn.draw(f,j.TRIANGLES,Ye,Er.disabled,ie,mr.disabled,Pn,l.id,$.boundsBuffer,f.quadTriangleIndexBuffer,$.boundsSegments);else if(Dr&&Gr){const hr=Dt.zoom<=o.c6?$.elevatedGlobeSegments:$.getSegmentsForLongitude(Dt.center.lng);hr&&yn.draw(f,j.TRIANGLES,Ye,Er.disabled,ie,Se,Pn,l.id,Dr,Gr,hr)}}else if(D){Ye=new sr(j.LEQUAL,sr.ReadOnly,f.depthRangeFor3D);const Dr=f.globeSharedBuffers;if(Dr){const[Gr,hr,en]=Dr.getGridBuffers(Bn,!1);yn.draw(f,j.TRIANGLES,Ye,be||ot,f.colorModeForRenderPass(),Se,Pn,l.id,Gr,hr,en)}}else{const{tileBoundsBuffer:Dr,tileBoundsIndexBuffer:Gr,tileBoundsSegments:hr}=f.getTileBoundsBuffers(tt);yn.draw(f,j.TRIANGLES,Ye,ot,ie,mr.disabled,Pn,l.id,Dr,Gr,hr)}}if(!($ instanceof o.aJ)&&D)for(const ke of we){const ze=ke.canonical.y===(1<<ke.canonical.z)-1;ke.canonical.y===0&&Ut(!0,ke,f,n,l,q,V,Se,be||Er.disabled),ze&&Ut(!1,ke,f,n,l,q,V,Se===mr.frontCW?mr.backCW:mr.frontCW,be||Er.disabled)}};D?Te(ve,f.renderElevatedRasterBackface?mr.backCW:mr.frontCW,f.stencilModeFor3D()):Te(ve,mr.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,n,l,p,y,v){f.renderPass==="offscreen"&&function(S,A,D,N){if(!N.length)return;const j=S.context,$=j.gl,V=A.getSource();if(!(V instanceof Oa))return;const q=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let ie=D.particlePositionRGBAImage;if(!ie||ie.width!==q){const ve=function(_e){const Te=_e*_e,we=new Uint8Array(4*Te),Se=function(ke){return ke|=0,ke=Math.imul(2747636419^ke,2654435769),ke=Math.imul(ke^ke>>>16,2654435769),((ke=Math.imul(ke^ke>>>16,2654435769))>>>0)/4294967296},be=1/1.1;for(let ke=0;ke<Te;ke++){const ze=be*(Se(2*ke+0)+wc),tt=be*(Se(2*ke+1)+wc),Xe=255*ze%1,Oe=255*tt%1,$e=Xe,ht=tt-Oe/255,xt=Oe;we[4*ke+0]=255*(ze-Xe/255),we[4*ke+1]=255*$e,we[4*ke+2]=255*ht,we[4*ke+3]=255*xt}return we}(q);ie=D.particlePositionRGBAImage=new o.r({width:q,height:q},ve)}let ne=D.particleFramebuffer;ne?ne.width!==q&&(ne.destroy(),ne=D.particleFramebuffer=j.createFramebuffer(q,q,!0,null)):ne=D.particleFramebuffer=j.createFramebuffer(q,q,!0,null);const le=[];for(const ve of N){const _e=A.getTile(ve);if(!(_e instanceof jf))continue;const Te=Tp(_e,V,D);if(!Te)continue;const we=[_e.tileSize,_e.tileSize];let Se=D.tileFramebuffer;Se||(Se=D.tileFramebuffer=j.createFramebuffer(we[0],we[1],!0,null));let be=_e.rasterParticleState;be||(be=_e.rasterParticleState=new Xv(j,ve,we,ie));const ke=be.update(D.lastInvalidatedAt);be.particleTextureDimension!==q&&be.updateParticleTexture(ve,ie);const ze=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=ze;const tt=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=tt,le.push([ve,Te,be,ke])}if(le.length===0)return;const ce=o.q.now(),fe=D.previousDrawTimestamp?.001*(ce-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=ce,D.hasColorMap()){j.activeTexture.set($.TEXTURE0+2);let ve=D.colorRampTexture;ve||(ve=D.colorRampTexture=new o.T(j,D.colorRamp,$.RGBA8)),ve.bind($.LINEAR,$.CLAMP_TO_EDGE)}j.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(ve,_e,Te){const we=ve.context,Se=we.gl,be=_e.tileFramebuffer;we.activeTexture.set(Se.TEXTURE0);const ke={u_texture:0,u_opacity:1.05*(tt=_e.paint.get("raster-particle-fade-opacity-factor"))/(tt+.05)},ze=ve.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var tt;for(const Xe of Te){const[,,Oe,$e]=Xe;be.colorAttachment.set(Oe.targetColorTexture.texture),we.viewport.set([0,0,be.width,be.height]),we.clear({color:o.aj.transparent}),$e&&(Oe.backgroundColorTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE),ze.draw(ve,Se.TRIANGLES,sr.disabled,Er.disabled,Or.alphaBlended,mr.disabled,ke,_e.id,ve.viewportBuffer,ve.quadTriangleIndexBuffer,ve.viewportSegments))}}(S,D,le),function(ve,_e,Te,we){const Se=ve.context,be=Se.gl,ke=Te.tileFramebuffer,ze=ve.transform.projection.name==="globe",tt=Te.paint.get("raster-particle-max-speed");for(const Xe of we){const[Oe,$e,ht]=Xe;Se.activeTexture.set(be.TEXTURE0+0),$e.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),ke.colorAttachment.set(ht.targetColorTexture.texture);const xt=ve.getOrCreateProgram("rasterParticleDraw",{defines:$e.defines,overrideFog:!1});Se.activeTexture.set(be.TEXTURE0+1);const Pt=$e.scalarData?[]:[0,1,2,3].map(ot=>o.d4[ot](Oe));Pt.push(Oe);const Ye=Oe.canonical.x,mt=Oe.canonical.y;for(const ot of Pt){const Tt=_e.getTile(ze?ot.wrapped():ot);if(!Tt)continue;const gt=Tt.rasterParticleState;if(!gt)continue;const ft=ot.canonical.x+(1<<ot.canonical.z)*(ot.wrap-Oe.wrap),zt=ot.canonical.y;gt.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Ft=Tc(1,gt.particleTexture0.size[0],[ft-Ye,zt-mt],0,$e.texture.size,2,tt,$e.textureOffset,$e.scale,$e.offset);xt.draw(ve,be.POINTS,sr.disabled,Er.disabled,Or.alphaBlended,mr.disabled,Ft,Te.id,gt.particleIndexBuffer,void 0,gt.particleSegment)}}}(S,A,D,le),j.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(ve,_e,Te,we){const Se=ve.context,be=Se.gl,ke=_e.paint.get("raster-particle-max-speed"),ze=we*_e.paint.get("raster-particle-speed-factor")*.15,tt=function(Oe){return Math.pow(Oe,6)}(.01+1*_e.paint.get("raster-particle-reset-rate-factor")),Xe=_e.particleFramebuffer;Se.viewport.set([0,0,Xe.width,Xe.height]);for(const Oe of Te){const[,$e,ht]=Oe;Se.activeTexture.set(be.TEXTURE0+0),$e.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Se.activeTexture.set(be.TEXTURE0+1);const xt=ht.particleTexture0;xt.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Pt=nr(1,xt.size[0],0,$e.texture.size,ke,ze,tt,$e.textureOffset,$e.scale,$e.offset);Xe.colorAttachment.set(ht.particleTexture1.texture),Se.clear({color:o.aj.transparent}),ve.getOrCreateProgram("rasterParticleUpdate",{defines:$e.defines}).draw(ve,be.TRIANGLES,sr.disabled,Er.disabled,Or.unblended,mr.disabled,Pt,_e.id,ve.viewportBuffer,ve.quadTriangleIndexBuffer,ve.viewportSegments)}}(S,D,le,fe)}(f,n,l,p),f.renderPass==="translucent"&&(function(S,A,D,N,j){const $=S.context,V=$.gl,q=A.getSource().tileSize,ie=5*(1-o.ac(o.bY,o.bY+1,S.transform.zoom))*q+D.paint.get("raster-particle-elevation"),ne=!S.options.moving,le=S.transform.projection.name==="globe";if(!N.length)return;const[ce,fe]=S.stencilConfigForOverlap(N),ve=[];le&&ve.push("PROJECTION_GLOBE_VIEW");const _e=S.stencilModeFor3D();for(const Te of fe){const we=Te.toUnwrapped(),Se=A.getTile(Te);if(!Se.rasterParticleState)continue;const be=Se.rasterParticleState,ke=100;Se.registerFadeDuration(ke);const ze=A.findLoadedParent(Te,0),tt=Tu(Se,ze,A,S.transform,ke);let Xe,Oe;S.terrain&&S.terrain.prepareDrawTile(),$.activeTexture.set(V.TEXTURE0),be.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),$.activeTexture.set(V.TEXTURE1),ze&&ze.rasterParticleState?(ze.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Xe=Math.pow(2,ze.tileID.overscaledZ-Se.tileID.overscaledZ),Oe=[Se.tileID.canonical.x*Xe%1,Se.tileID.canonical.y*Xe%1]):be.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const $e=le?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(we,ne),ht=S.transform,xt=p_(ht),Pt=o.cE(Te.canonical),Ye=o.cF(Pt.getCenter().lat);let mt,ot,Tt,gt,ft;le?(mt=Float32Array.from(o.bb(o.cH(Te.canonical))),ot=Float32Array.from(ht.globeMatrix),Tt=Float32Array.from(o.cD(ht)),gt=[o.at(ht.center.lng),o.aA(ht.center.lat)],ft=Float32Array.from(o.cG(Te.canonical,Pt,Ye,ht.worldSize/ht._pixelsPerMercatorPixel))):(mt=new Float32Array(16),ot=new Float32Array(9),Tt=new Float32Array(16),gt=[0,0],ft=new Float32Array(9));const zt=Sc($e,mt,ot,Tt,ft,Oe||[0,0],o.ae(S.transform.zoom),gt,xt,Xe||1,tt,ie),Ft=S.isTileAffectedByFog(Te),Dt=S.getOrCreateProgram("rasterParticle",{defines:ve,overrideFog:Ft});if(S.uploadCommonUniforms($,Dt,we),le){const $t=new sr(V.LEQUAL,sr.ReadOnly,S.depthRangeFor3D),vr=0,lr=S.globeSharedBuffers;if(lr){const[ar,xr,$r]=lr.getGridBuffers(Ye,vr!==0);Dt.draw(S,V.TRIANGLES,$t,_e,Or.alphaBlended,S.renderElevatedRasterBackface?mr.frontCCW:mr.backCCW,zt,D.id,ar,xr,$r)}}else{const $t=S.depthModeForSublayer(0,sr.ReadOnly),vr=ce[Te.overscaledZ],{tileBoundsBuffer:lr,tileBoundsIndexBuffer:ar,tileBoundsSegments:xr}=S.getTileBoundsBuffers(Se);Dt.draw(S,V.TRIANGLES,$t,vr,Or.alphaBlended,mr.disabled,zt,D.id,lr,ar,xr)}}S.resetStencilClippingMasks()}(f,n,l,p),f.style.map.triggerRepaint())},background:function(f,n,l,p){const y=l.paint.get("background-color"),v=l.paint.get("background-color-use-theme").constantOr("default")==="none",S=l.paint.get("background-opacity"),A=l.paint.get("background-emissive-strength"),D=l.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const N=f.context,j=N.gl,$=f.transform,V=$.tileSize,q=l.paint.get("background-pattern");let ie;if(q!==void 0&&(q===null||(ie=f.imageManager.getPattern(q.toString(),l.scope,f.style.getLut(l.scope)),!ie)))return;const ne=!q&&y.a===1&&S===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==ne)return;const le=Er.disabled,ce=f.depthModeForSublayer(0,ne==="opaque"?sr.ReadWrite:sr.ReadOnly),fe=f.colorModeForDrapableLayerRenderPass(A),ve=q?"backgroundPattern":"background";let _e,Te=p;if(Te||(_e=f.getBackgroundTiles(),Te=Object.values(_e).map(we=>we.tileID)),q&&(N.activeTexture.set(j.TEXTURE0),f.imageManager.bind(f.context,l.scope)),D){const we=f.getOrCreateProgram(ve,{overrideFog:!1,overrideRtt:!0}),Se=new Float32Array(o.ab.mat4.identity([])),be=new o.aG(0,0,0,0,0),ke=q?vp(Se,A,S,f,0,l.scope,ie,D,{tileID:be,tileSize:V}):Hv(Se,A,S,y.toRenderColor(v?null:l.lut));we.draw(f,j.TRIANGLES,ce,le,fe,mr.disabled,ke,l.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const we of Te){const Se=f.isTileAffectedByFog(we),be=f.getOrCreateProgram(ve,{overrideFog:Se}),ke=we.toUnwrapped(),ze=p?we.projMatrix:f.transform.calculateProjMatrix(ke);f.prepareDrawTile();const tt=n?n.getTile(we):_e?_e[we.key]:new Cl(we,V,$.zoom,f),Xe=q?vp(ze,A,S,f,0,l.scope,ie,D,{tileID:we,tileSize:V}):Hv(ze,A,S,y.toRenderColor(v?null:l.lut));f.uploadCommonUniforms(N,be,ke);const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:$e,tileBoundsSegments:ht}=f.getTileBoundsBuffers(tt);be.draw(f,j.TRIANGLES,ce,le,fe,mr.disabled,Xe,l.id,Oe,$e,ht)}},sky:function(f,n,l){const p=f._atmosphere?o.ae(f.transform.zoom):1,y=l.paint.get("sky-opacity")*p;if(y===0)return;const v=f.context,S=l.paint.get("sky-type"),A=new sr(v.gl.LEQUAL,sr.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?l.needsSkyboxCapture(f)&&(function(N,j,$,V){const q=N.context,ie=q.gl;let ne=j.skyboxFbo;if(!ne){ne=j.skyboxFbo=q.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new yh(q),j.skyboxTexture=q.gl.createTexture(),ie.bindTexture(ie.TEXTURE_CUBE_MAP,j.skyboxTexture),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MAG_FILTER,ie.LINEAR);for(let ve=0;ve<6;++ve)ie.texImage2D(ie.TEXTURE_CUBE_MAP_POSITIVE_X+ve,0,ie.RGBA,32,32,0,ie.RGBA,ie.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(ne.framebuffer),q.viewport.set([0,0,32,32]);const le=j.getCenter(N,!0),ce=N.getOrCreateProgram("skyboxCapture"),fe=new Float64Array(16);o.ab.mat4.identity(fe),o.ab.mat4.rotateY(fe,fe,.5*-Math.PI),zo(N,j,ce,fe,le,0),o.ab.mat4.identity(fe),o.ab.mat4.rotateY(fe,fe,.5*Math.PI),zo(N,j,ce,fe,le,1),o.ab.mat4.identity(fe),o.ab.mat4.rotateX(fe,fe,.5*-Math.PI),zo(N,j,ce,fe,le,2),o.ab.mat4.identity(fe),o.ab.mat4.rotateX(fe,fe,.5*Math.PI),zo(N,j,ce,fe,le,3),o.ab.mat4.identity(fe),zo(N,j,ce,fe,le,4),o.ab.mat4.identity(fe),o.ab.mat4.rotateY(fe,fe,Math.PI),zo(N,j,ce,fe,le,5),q.viewport.set([0,0,N.width,N.height])}(f,l),l.markSkyboxValid(f)):f.renderPass==="sky"&&function(N,j,$,V,q){const ie=N.context,ne=ie.gl,le=N.transform,ce=N.getOrCreateProgram("skybox");ie.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_CUBE_MAP,j.skyboxTexture);const fe=((ve,_e,Te,we,Se)=>({u_matrix:ve,u_sun_direction:_e,u_cubemap:0,u_opacity:we,u_temporal_offset:Se}))(le.skyboxMatrix,j.getCenter(N,!1),0,V,q);N.uploadCommonUniforms(ie,ce),ce.draw(N,ne.TRIANGLES,$,Er.disabled,N.colorModeForRenderPass(),mr.backCW,fe,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,l,A,y,D):S==="gradient"&&f.renderPass==="sky"&&function(N,j,$,V,q){const ie=N.context,ne=ie.gl,le=N.transform,ce=N.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new yh(ie)),ie.activeTexture.set(ne.TEXTURE0);let fe=j.colorRampTexture;fe||(fe=j.colorRampTexture=new o.T(ie,j.colorRamp,ne.RGBA8)),fe.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const ve=((_e,Te,we,Se,be)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:Te,u_radius:o.ai(we),u_opacity:Se,u_temporal_offset:be}))(le.skyboxMatrix,j.getCenter(N,!1),j.paint.get("sky-gradient-radius"),V,q);N.uploadCommonUniforms(ie,ce),ce.draw(N,ne.TRIANGLES,$,Er.disabled,N.colorModeForRenderPass(),mr.backCW,ve,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,l,A,y,D)},debug:function(f,n,l,p,y,v){for(let S=0;S<l.length;S++)if(y){const N=new o.aj(p.r*.8,p.g*.8,p.b*.8,1);Ru(f,n,l[S],p,-1,-1,v),Ru(f,n,l[S],p,-1,1,v),Ru(f,n,l[S],p,1,1,v),Ru(f,n,l[S],p,1,-1,v),Ru(f,n,l[S],N,0,0,v)}else Ru(f,n,l[S],p,0,0,v)},custom:function(f,n,l,p){const y=f.context,v=l.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&l.isDraped(n)){if(f.renderPass==="offscreen"){const S=v.prerender;if(S){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const A=f.transform.pointMerc;S.call(v,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.ae(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else S.call(v,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const A=v.renderToTile;if(A){const D=p[0].canonical,N=new o.aa(D.x+p[0].wrap*(1<<D.z),D.y,D.z);y.setDepthMode(sr.disabled),y.setStencilMode(Er.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),A.call(v,y.gl,N),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(Er.disabled);const S=v.renderingMode==="3d"?new sr(f.context.gl.LEQUAL,sr.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,sr.ReadOnly);if(y.setDepthMode(S),f.transform.projection.name==="globe"){const A=f.transform.pointMerc;v.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.ae(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else v.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,n,l,p){if(f.renderPass==="opaque")return;const y=l.paint.get("model-opacity").constantOr(1);if(y===0)return;const v=l.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!v||f.terrain&&y<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof o.a9))return;const S=f.shadowRenderer,A=l.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,A||(S.enabled=!1));const D=()=>{S&&(S.useNormalOffset=!0,A||(S.enabled=!0))},N=n.getSource();if(f.renderPass==="light-beam"&&N.type!=="batched-model")return;if(N.type==="vector"||N.type==="geojson")return function(ce,fe,ve,_e,Te){const we=ce.transform;if(we.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${we.projection.name} projection is not yet implemented`);const Se=we.getFreeCameraOptions().position;if(!ce.modelManager)return;const be=ce.modelManager;ve.modelManager=be;const ke=ce.shadowRenderer;if(!ve._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ze=ve._unevaluatedLayout._values["model-id"],tt={...ve.layout.get("model-id").parameters},Xe=ce.style.order.indexOf(ve.fqid);for(const Oe of _e){const $e=fe.getTile(Oe).getBucket(ve);if(!$e||$e.projection.name!==we.projection.name)continue;const ht=$e.getModelUris();ht&&!$e.modelsRequested&&(be.addModelsFromBucket(ht,Te),$e.modelsRequested=!0);const xt=g_(Oe,we);tt.zoom=xt;const Pt=ze.possiblyEvaluate(tt);if(Ou(ce,$e,Oe),Cs.shadowUniformsInitialized=!1,Cs.useSingleShadowCascade=!!ke&&ke.getMaxCascadeForTile(Oe.toUnwrapped())===0,ce.renderPass==="shadow"&&ke){if(ce.currentShadowCascade===1&&$e.isInsideFirstShadowMapFrustum)continue;const ot=we.calculatePosMatrix(Oe.toUnwrapped(),we.worldSize);if(Cs.tileMatrix.set(ot),Cs.shadowTileMatrix=Float32Array.from(ke.calculateShadowPassMatrixFromMatrix(ot)),Cs.aabb.min.fill(0),Cs.aabb.max[0]=Cs.aabb.max[1]=o.ag,Cs.aabb.max[2]=0,Ll($e,Cs,ce,ve.scope))continue}const Ye=1<<Oe.canonical.z,mt=[((Se.x-Oe.wrap)*Ye-Oe.canonical.x)*o.ag,(Se.y*Ye-Oe.canonical.y)*o.ag,Se.z*Ye*o.ag];ce.conflationActive&&Object.keys($e.instancesPerModel).length>0&&ce.style.isLayerClipped(ve,fe.getSource())&&$e.updateReplacement(Oe,ce.replacementSource,Xe,Te)&&($e.uploaded=!1,$e.upload(ce.context));for(let ot in $e.instancesPerModel){const Tt=$e.instancesPerModel[ot];Tt.features.length>0&&(ot=Pt.evaluate(Tt.features[0].feature,{}));const gt=be.getModel(ot,Te);if(gt&&gt.uploaded)for(const ft of gt.nodes)qa(ce,ve,ft,Tt,mt,Oe,Cs)}}}(f,n,l,p,N.type==="vector"?l.scope:""),void D();if(!N.loaded())return;if(N.type==="batched-model")return function(ce,fe,ve,_e){ve.resetLayerRenderingStats(ce);const Te=ce.context,we=ce.transform,Se=ce.style.fog,be=ce.shadowRenderer;if(we.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${we.projection.name} projection is not yet implemented`);const ke=ce.transform.getFreeCameraOptions().position,ze=o.ab.vec3.scale([],[ke.x,ke.y,ke.z],ce.transform.worldSize),tt=o.ab.vec3.negate([],ze),Xe=o.ab.mat4.identity([]),Oe=o.dj(we.center.lat,we.zoom),$e=o.ab.mat4.fromScaling([],[1,1,1/Oe]);o.ab.mat4.translate(Xe,Xe,tt);const ht=ve.paint.get("model-opacity").constantOr(1),xt=new sr(Te.gl.LEQUAL,sr.ReadWrite,ce.depthRangeFor3D),Pt=new sr(Te.gl.LEQUAL,sr.ReadOnly,ce.depthRangeFor3D),Ye=new o.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),mt=ce.renderPass==="shadow",ot=mt&&be?be.getCurrentCascadeFrustum():we.getFrustum(we.scaleZoom(we.worldSize)),Tt=ve.paint.get("model-front-cutoff"),gt=Tt[2]<1,ft=Ua(ce,ve.paint.get("model-cutoff-fade-range")),zt=ve.getLayerRenderingStats();(function(Ft,Dt,$t,vr){const lr=Ft.terrain?Ft.terrain.exaggeration():0,ar=Ft.transform.zoom;for(const xr of vr){const $r=Dt.getTile(xr).getBucket($t);$r&&(Ft.conflationActive&&$r.updateReplacement(xr,Ft.replacementSource),$r.evaluateScale(Ft,$t),Ft.terrain&&lr>0&&$r.elevationUpdate(Ft.terrain,lr,xr,$t.source),$r.needsReEvaluation(Ft,ar,$t)&&$r.evaluate($t))}})(ce,fe,ve,_e),function(){let Ft,Dt,$t;gt?(Ft=_e.length-1,Dt=-1,$t=-1):(Ft=0,Dt=_e.length,$t=1);const vr=new Float64Array(16),lr=o.ab.vec3.create(),ar=new o.P(0,0);for(let xr=Ft;xr!==Dt;xr+=$t){const $r=_e[xr],Rr=fe.getTile($r).getBucket(ve);if(!Rr||!Rr.uploaded)continue;let Bn=!1;be&&(Bn=be.getMaxCascadeForTile($r.toUnwrapped())===0);const Pn=we.calculatePosMatrix($r.toUnwrapped(),we.worldSize),an=Rr.modelTraits;!mt&&gt&&(o.ab.mat4.invert(vr,Pn),o.ab.vec3.transformMat4(lr,ze,vr),ar.x=lr[0],ar.y=lr[1]);const yn=[];for(const Dr of Rr.getNodesInfo()){if(Dr.hiddenByReplacement||!Dr.node.meshes)continue;const Gr=Dr.node;let hr=0;ce.terrain&&Gr.elevation&&(hr=Gr.elevation*ce.terrain.exaggeration());const en=(()=>{const qr=Dr.aabb;return Ye.min=[...qr.min],Ye.max=[...qr.max],Ye.min[2]+=hr,Ye.max[2]+=hr,o.ab.vec3.transformMat4(Ye.min,Ye.min,Pn),o.ab.vec3.transformMat4(Ye.max,Ye.max,Pn),Ye})(),Kn=Dr.evaluatedScale;if(Kn[0]<=1&&Kn[1]<=1&&Kn[2]<=1&&en.intersects(ot)===0)continue;if(!mt&&gt){const qr=.16666666666666666;Dr.cameraCollisionOpacity=ze[0]>en.min[0]&&ze[0]<en.max[0]&&ze[1]>en.min[1]&&ze[1]<en.max[1]&&ze[2]*Oe<en.max[2]&&Gr.footprint&&o.bA(ar,Gr.footprint)?Math.max(Dr.cameraCollisionOpacity-qr,0):Math.min(1,Dr.cameraCollisionOpacity+qr)}const Gi=[...Pn],Qo=Gr.anchor?Gr.anchor[0]:0,po=Gr.anchor?Gr.anchor[1]:0;o.ab.mat4.translate(Gi,Gi,[Qo*(Kn[0]-1),po*(Kn[1]-1),hr]),o.ab.vec3.exactEquals(Kn,o.dm)||o.ab.mat4.scale(Gi,Gi,Kn);const ki=o.ab.mat4.multiply([],Gi,Gr.matrix),mi=o.ab.mat4.multiply([],we.expandedFarZProjMatrix,ki),oi=o.ab.mat4.multiply([],we.expandedFarZProjMatrix,Gi),Nn=o.ab.vec4.transformMat4([],[Qo,po,hr,1],mi)[2];Gr.hidden=!1;let Tn=ht;mt||(gt&&(Tn*=Dr.cameraCollisionOpacity,Tn*=Cp(Gi,we,Dr.aabb,Tt)),Tn*=Ep(ft,Nn)),Tn!==0?yn.push({nodeInfo:Dr,depth:Nn,opacity:Tn,wvpForNode:mi,wvpForTile:oi,nodeModelMatrix:ki,tileModelMatrix:Gi}):Gr.hidden=!0}mt||yn.sort((Dr,Gr)=>!gt||Dr.opacity===1&&Gr.opacity===1?Dr.depth<Gr.depth?-1:1:Dr.opacity===1?-1:Gr.opacity===1?1:Dr.depth>Gr.depth?-1:1);for(const Dr of yn){const Gr=Dr.nodeInfo,hr=Gr.node;let en=o.ab.mat4.multiply([],$e,Dr.tileModelMatrix);o.ab.mat4.multiply(en,Xe,en);const Kn=o.ab.mat4.invert([],en);o.ab.mat4.transpose(Kn,Kn),o.ab.mat4.scale(Kn,Kn,Dl),en=o.ab.mat4.multiply(en,en,hr.matrix);const Gi=ce.renderPass==="light-beam",Qo=ve.paint.get("model-color-use-theme").constantOr("default")==="none",po=an&o.dp.HasMapboxMeshFeatures,ki=po?0:Gr.evaluatedRMEA[0][2];for(let mi=0;mi<hr.meshes.length;++mi){const oi=hr.meshes[mi],Nn=mi===hr.lightMeshIndex;let Tn=Dr.wvpForNode;if(Nn){if(!Gi&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}Tn=Dr.wvpForTile}else if(Gi)continue;const qr={defines:[]},ni=[];if(!mt&&be&&(be.useNormalOffset=!!oi.normalBuffer),Qr(qr.defines,ni,oi,ce,Qo?null:ve.lut),po||qr.defines.push("DIFFUSE_SHADED"),Bn&&qr.defines.push("SHADOWS_SINGLE_CASCADE"),zt&&(mt?zt.numRenderedVerticesInShadowPass+=oi.vertexArray.length:zt.numRenderedVerticesInTransparentPass+=oi.vertexArray.length),mt){Lu(oi,Dr.nodeModelMatrix,ce,ve);continue}let Ri=null;if(Se){const va=zn(Dr.nodeModelMatrix,ce.transform);if(Ri=new Float32Array(va),we.projection.name!=="globe"){const mo=oi.aabb.min,cs=oi.aabb.max,[Ka,Qs]=Se.getOpacityForBounds(va,mo[0],mo[1],cs[0],cs[1]);qr.overrideFog=Ka>=Vt||Qs>=Vt}}const An=oi.material;let io;An.occlusionTexture&&An.occlusionTexture.offsetScale&&(io=An.occlusionTexture.offsetScale,qr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ls=ce.getOrCreateProgram("model",qr);!mt&&be&&be.setupShadowsFromMatrix(Dr.tileModelMatrix,ls,be.useNormalOffset),ce.uploadCommonUniforms(Te,ls,null,Ri);const Fo=An.pbrMetallicRoughness;Fo.metallicFactor=.9,Fo.roughnessFactor=.5;const Xa=bp(new Float32Array(Tn),new Float32Array(en),new Float32Array(Kn),new Float32Array(hr.matrix),ce,Dr.opacity,Fo.baseColorFactor.toRenderColor(null),An.emissiveFactor,Fo.metallicFactor,Fo.roughnessFactor,An,ki,ve,[0,0,0],io);!Nn&&(Gr.hasTranslucentParts||Dr.opacity<1)&&ls.draw(ce,Te.gl.TRIANGLES,xt,Er.disabled,Or.disabled,mr.backCCW,Xa,ve.id,oi.vertexBuffer,oi.indexBuffer,oi.segments,ve.paint,ce.transform.zoom,void 0,ni),ls.draw(ce,Te.gl.TRIANGLES,Nn?Pt:xt,Er.disabled,Nn||Dr.opacity<1||Gr.hasTranslucentParts?Or.alphaBlended:Or.unblended,mr.backCCW,Xa,ve.id,oi.vertexBuffer,oi.indexBuffer,oi.segments,ve.paint,ce.transform.zoom,void 0,ni)}}}}()}(f,n,l,p),void D();if(N.type!=="model")return;const j=N.getModels(),$=[],V=f.transform.getFreeCameraOptions().position,q=o.ab.vec3.scale([],[V.x,V.y,V.z],f.transform.worldSize);o.ab.vec3.negate(q,q);const ie=[],ne=[];let le=0;for(const ce of j){const fe=l.paint.get("model-rotation").constantOr(null),ve=l.paint.get("model-scale").constantOr(null),_e=l.paint.get("model-translation").constantOr(null);ce.computeModelMatrix(f,fe,ve,_e,!0,!0,!1);const Te=o.ab.mat4.identity([]),we=o.dj(ce.position.lat,f.transform.zoom),Se=o.ab.mat4.fromScaling([],[1,1,1/we]);o.ab.mat4.translate(Te,Te,q),$.push({zScaleMatrix:Se,negCameraPosMatrix:Te});for(const be of ce.nodes)Ha(f.transform,be,ce.matrix,f.transform.expandedFarZProjMatrix,le,ie,ne);le++}if(ie.sort((ce,fe)=>fe.depth-ce.depth),f.renderPass!=="shadow"){if(y===1)for(const ce of ne)xh(ce,f,l,$[ce.modelIndex],Er.disabled,f.colorModeForRenderPass());else{for(const ce of ne)xh(ce,f,l,$[ce.modelIndex],Er.disabled,Or.disabled);for(const ce of ne)xh(ce,f,l,$[ce.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const ce of ie)xh(ce,f,l,$[ce.modelIndex],Er.disabled,f.colorModeForRenderPass());D()}else{for(const ce of ne)Lu(ce.mesh,ce.nodeModelMatrix,f,l);for(const ce of ie)Lu(ce.mesh,ce.nodeModelMatrix,f,l);D()}}},Ap={model:function(f,n,l){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const y=p.getModels();for(const v of y)v.upload(l.context)},raster:function(f,n,l){const p=n.getSource();if(!(p instanceof Oa&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const v=f.paint.get("raster-array-band")||p.getInitialBand(y);if(v==null)return;const S=n.getIds().map(A=>n.getTileByID(A));for(const A of S)A.updateNeeded(y,v)&&p.prepareTile(A,y,v)},"raster-particle":function(f,n,l){const p=n.getSource();if(!(p instanceof Oa&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const v=f.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(v==null)return;const S=n.getIds().map(A=>n.getTileByID(A));for(const A of S)A.updateNeeded(y,v)&&p.prepareTile(A,y,v)}};class C_{constructor(n,l,p,y,v){this.context=new Yo(n,l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const D of S)this._debugParams.enabledLayers[D]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of S)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new v_(v),this.setup(),this.numSublayers=ws.maxUnderzooming+ws.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Va(this),this._wireframeDebugCache=new y_,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,A,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y}updateTerrain(n,l){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hp(this,n));const y=this._terrain;this.transform.elevation=p?y:null,y.update(n,this.transform,l),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=l.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const v=p+.78*(y-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new hp(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,l){if(this.width=n*o.q.devicePixelRatio,this.height=l*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,l=new o.b4;l.emplaceBack(0,0),l.emplaceBack(o.ag,0),l.emplaceBack(0,o.ag),l.emplaceBack(o.ag,o.ag),this.tileExtentBuffer=n.createVertexBuffer(l,o.b6.members),this.tileExtentSegments=o.b7.simpleSegment(0,0,4,2);const p=new o.b4;p.emplaceBack(0,0),p.emplaceBack(o.ag,0),p.emplaceBack(0,o.ag),p.emplaceBack(o.ag,o.ag),this.debugBuffer=n.createVertexBuffer(p,o.b6.members),this.debugSegments=o.b7.simpleSegment(0,0,4,5);const y=new o.b4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,o.b6.members),this.viewportSegments=o.b7.simpleSegment(0,0,4,2);const v=new o.aT;v.emplaceBack(0,0,0,0),v.emplaceBack(o.ag,0,o.ag,0),v.emplaceBack(0,o.ag,0,o.ag),v.emplaceBack(o.ag,o.ag,o.ag,o.ag),this.mercatorBoundsBuffer=n.createVertexBuffer(v,o.b9.members),this.mercatorBoundsSegments=o.b7.simpleSegment(0,0,4,2);const S=new o.aU;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(S);const A=new o.b5;for(const N of[0,1,3,2,0])A.emplaceBack(N);this.debugIndexBuffer=n.createIndexBuffer(A),this.emptyTexture=new o.T(n,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=o.ab.mat4.create();const D=this.context.gl;this.stencilClearMode=new Er({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,sr.disabled,this.stencilClearMode,Or.disabled,mr.disabled,dh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,p){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const D of p)if(this._tileClippingMaskIDs[D.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=l.id;const y=this.context,v=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(Or.disabled),y.setDepthMode(sr.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of p){const D=l.getTile(A),N=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:$,tileBoundsSegments:V}=this.getTileBoundsBuffers(D);S.draw(this,v.TRIANGLES,sr.disabled,new Er({func:v.ALWAYS,mask:0},N,255,v.KEEP,v.KEEP,v.REPLACE),Or.disabled,mr.disabled,dh(A.projMatrix),"$clipping",j,$,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new Er({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new Er({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,p=n.sort((S,A)=>A.overscaledZ-S.overscaledZ),y=p[p.length-1].overscaledZ,v=p[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let A=0;A<v;A++)S[A+y]=new Er({func:l.GEQUAL,mask:255},A+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[S,p]}return[{[y]:Er.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Or([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new o.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Or.unblended:Or.alphaBlended}colorModeForDrapableLayerRenderPass(n){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Or([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new o.aj(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,l,p,y=!1){if(this.depthOcclusion)return new sr(this.context.gl.GREATER,sr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return sr.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new sr(p||this.context.gl.LEQUAL,l,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,l=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),v=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&p!==0&&(this.depthFBO=new wp(this.context,l,p,!1,"texture"),this.depthTexture=new o.T(this.context,{width:l,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),n.bindTexture(n.TEXTURE_2D,v),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,l,p,0,0,l,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,l)=>n+l/this._fpsHistory.length,0))}render(n,l){const p=o.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=l;const y=this.style._mergedLayers,v=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(Oe=>{const $e=y[Oe];return!($e.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[$e.type]});let S=!1,A=!1;for(const Oe of v){const $e=y[Oe];$e.type==="circle"&&(S=!0),$e.type==="symbol"&&($e.hasInitialOcclusionOpacityProperties?A=!0:S=!0)}const D=v.map(Oe=>y[Oe]),N=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let j=0,$=!1;for(const Oe in N){const $e=N[Oe];$e.used&&($e.prepare(this.context),$e.getSource().usedInConflation&&++j)}let V=!1;for(const Oe of D)Oe.isHidden(this.transform.zoom)||(Oe.type==="clip"&&(V=!0),this.prepareLayer(Oe));const q={},ie={},ne={},le={},ce={};for(const Oe in N){const $e=N[Oe];q[Oe]=$e.getVisibleCoordinates(),ie[Oe]=q[Oe].slice().reverse(),ne[Oe]=$e.getVisibleCoordinates(!0).reverse(),le[Oe]=$e.getShadowCasterCoordinates(),ce[Oe]=$e.sortCoordinatesByDistance(q[Oe])}const fe=Oe=>{const $e=this.style.getLayerSourceCache(Oe);return $e&&$e.used?$e.getSource():null};if(j||V||this._clippingActiveLastFrame){const Oe=[],$e=[];let ht=0;for(const xt of D)this.isSourceForClippingOrConflation(xt,fe(xt))&&(Oe.push(xt),$e.push(ht)),ht++;if(Oe&&(V||Oe.length>1)||this._clippingActiveLastFrame){V=!1;const xt=[];for(let Pt=0;Pt<Oe.length;Pt++){const Ye=Oe[Pt],mt=$e[Pt],ot=this.style.getLayerSourceCache(Ye);if(!ot||!ot.used||!ot.getSource().usedInConflation&&Ye.type!=="clip")continue;let Tt=o.dx,gt=o.by.None;const ft=[];let zt=!0;if(Ye.type==="clip"){Tt=mt;for(const Ft of Ye.layout.get("clip-layer-types"))gt|=Ft==="model"?o.by.Model:Ft==="symbol"?o.by.Symbol:o.by.FillExtrusion;for(const Ft of Ye.layout.get("clip-layer-scope"))ft.push(Ft);Ye.isHidden(this.transform.zoom)?zt=!1:V=!0}zt&&xt.push({layer:Ye.fqid,cache:ot,order:Tt,clipMask:gt,clipScope:ft})}this.replacementSource.setSources(xt),$=!0}}this._clippingActiveLastFrame=V,$||this.replacementSource.clear(),this.conflationActive=$,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Oe=0;Oe<D.length;Oe++){const $e=D[Oe],ht=$e.cutoffRange();if(this.longestCutoffRange=Math.max(ht,this.longestCutoffRange),ht>0){const xt=fe($e);xt&&(this.minCutoffZoom=Math.max(xt.minzoom,this.minCutoffZoom)),$e.minzoom&&(this.minCutoffZoom=Math.max($e.minzoom,this.minCutoffZoom))}$e.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Oe),this._lastOcclusionLayer=Oe)}const ve=this.style&&this.style.fog;ve?(this._fogVisible=ve.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ve.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ne),this.opaquePassCutoff=0);const _e=this._shadowRenderer;if(_e){_e.updateShadowParameters(this.transform,this.style.directionalLight);for(const Oe in N)for(const $e of q[Oe]){let ht={min:0,max:0};this.terrain&&(ht=this.terrain.getMinMaxForTile($e)||ht),_e.addShadowReceiver($e.toUnwrapped(),ht.min,ht.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new vh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new E_(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),we&&!this._rain&&(this._rain=new S_(this)),!we&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!fr.has(this.context.gl))return;this.renderPass="offscreen";for(const Oe of D){const $e=n.getLayerSourceCache(Oe);if(!Oe.hasOffscreenPass()||Oe.isHidden(this.transform.zoom))continue;const ht=$e?ie[$e.id]:void 0;(Oe.type==="custom"||Oe.type==="raster"||Oe.type==="raster-particle"||Oe.isSky()||ht&&ht.length)&&this.renderLayer(this,$e,Oe,ht)}this.depthRangeFor3D=[0,1-(D.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,le)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),be=(()=>{if(l.showOverdrawInspector)return o.aj.black;const Oe=this.style.fog;if(Oe&&this.transform.projection.supportsFog){const $e=this.style.getLut(Oe.scope);if(!Se){const ht=Oe.properties.get("color-use-theme")==="none",xt=Oe.properties.get("color").toRenderColor(ht?null:$e).toArray01();return new o.aj(...xt)}if(Se){const ht=Oe.properties.get("space-color-use-theme")==="none",xt=Oe.properties.get("space-color").toRenderColor(ht?null:$e).toArray01();return new o.aj(...xt)}}return o.aj.transparent})();if(this.context.clear({color:be,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const Oe=D[this.currentLayer],$e=n.getLayerSourceCache(Oe);if(Oe.isSky())continue;const ht=$e?(Oe.is3D()?ce:ie)[$e.id]:void 0;this._renderTileClippingMasks(Oe,$e,ht),this.renderLayer(this,$e,Oe,ht)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const Oe=D[this.currentLayer],$e=n.getLayerSourceCache(Oe);Oe.isSky()&&this.renderLayer(this,$e,Oe,$e?ie[$e.id]:void 0)}function ke(Oe,$e){let ht;return $e&&(ht=(Oe.type==="symbol"?ne:Oe.is3D()?ce:ie)[$e.id]),ht}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const Oe=D[this.currentLayer];if(Oe.type==="raster"||Oe.type==="raster-particle"){const $e=n.getLayerSourceCache(Oe);this.renderLayer(this,$e,Oe,ke(Oe,$e))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ze=0;_e&&(ze=_e.getShadowCastingLayerCount());let tt=!1,Xe=-1;for(let Oe=0;Oe<v.length;++Oe){const $e=D[Oe];$e.isHidden(this.transform.zoom)||$e.is3D()&&(Xe=Oe)}for(A&&Xe===-1&&(S=!0);this.currentLayer<v.length;){const Oe=D[this.currentLayer],$e=n.getLayerSourceCache(Oe);if(Oe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Oe)){if(Oe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(S&&!tt&&this.terrain&&!this.transform.isOrthographic&&(tt=!0,this.blitDepth()),A&&Xe!==-1&&this.currentLayer===Xe+1&&!this.transform.isOrthographic&&this.blitDepth(),Oe.is3D()||this.terrain||this._renderTileClippingMasks(Oe,$e,$e?q[$e.id]:void 0),this.renderLayer(this,$e,Oe,ke(Oe,$e)),!this.terrain&&_e&&ze>0&&Oe.hasShadowPass()&&--ze==0&&(_e.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ht=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ht;this.currentLayer++){const xt=D[this.currentLayer];if(!xt.hasLightBeamPass())continue;const Pt=n.getLayerSourceCache(xt);this.renderLayer(this,Pt,xt,Pt?ie[Pt.id]:void 0)}this.currentLayer=ht,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ht=this.currentLayer;this.depthOcclusion=!0;for(const xt of this.layersWithOcclusionOpacity){this.currentLayer=xt;const Pt=D[this.currentLayer],Ye=n.getLayerSourceCache(Pt),mt=Ye?ie[Ye.id]:void 0;Pt.is3D()||this.terrain||this._renderTileClippingMasks(Pt,Ye,Ye?q[Ye.id]:void 0),this.renderLayer(this,Ye,Pt,mt)}this.depthOcclusion=!1,this.currentLayer=ht,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Oe=null;D.forEach($e=>{const ht=n.getLayerSourceCache($e);ht&&!$e.isHidden(this.transform.zoom)&&ht.getVisibleCoordinates().length&&(!Oe||Oe.getSource().maxzoom<ht.getSource().maxzoom)&&(Oe=ht)}),Oe&&this.options.showTileBoundaries&&Wa.debug(this,Oe,Oe.getVisibleCoordinates(),o.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Wa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Oe){const $e=Oe.transform.padding;m_(Oe,Oe.transform.height-($e.top||0),3,Kv),m_(Oe,$e.bottom||0,3,Jv),_h(Oe,$e.left||0,3,Qv),_h(Oe,Oe.transform.width-($e.right||0),3,ku);const ht=Oe.transform.centerPoint;(function(xt,Pt,Ye,mt){Du(xt,Pt-1,Ye-10,2,20,mt),Du(xt,Pt-10,Ye-1,20,2,mt)})(Oe,ht.x,Oe.transform.height-ht.y,M2)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),$||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:l}=this.transform.projection,p=!l||!l.includes(n.type);if(Ap[n.type]&&(p||this.terrain&&n.type==="custom")){const y=this.style.getLayerSourceCache(n);Ap[n.type](n,y,this)}this.gpuTimingEnd()}renderLayer(n,l,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||Wa[p.type](n,l,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,p=this.context.gl;let y=this.gpuTimers[n.id];y||(y=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(l.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=this.context.gl,p=l.createQuery();this.deferredRenderGpuTimeQueries.push(p),l.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const p in n){const y=n[p],v=this.context.extTimerQuery,S=v.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(y.query),l[p]=S}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let p=0;for(const y of n)p+=l.getQueryParameter(y,l.QUERY_RESULT)/1e6,l.deleteQuery(y);return p}translatePosMatrix(n,l,p,y,v){if(!p[0]&&!p[1])return n;const S=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(S){const N=Math.sin(S),j=Math.cos(S);p=[p[0]*j-p[1]*N,p[0]*N+p[1]*j]}const A=[v?p[0]:o.ar(l,p[0],this.transform.zoom),v?p[1]:o.ar(l,p[1],this.transform.zoom),0],D=new Float32Array(16);return o.ab.mat4.translate(D,n,A),D}saveTileTexture(n){const l=n.size[0],p=this._tileTextures[l];p?p.push(n):this._tileTextures[l]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,l,p){const y=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,v=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||y||l!==void 0&&!l||v.push("FOG","FOG_DITHERING"),y&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(n,l){this.cache=this.cache||{};const p=l&&l.defines||[],y=l&&l.config,v=this.currentGlobalDefines(n,l&&l.overrideFog,l&&l.overrideRtt).concat(p),S=jv.cacheKey(Wg[n],n,v,y);return this.cache[S]||(this.cache[S]=new jv(this.context,n,Wg[n],y,E2[n],v)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,l){if(this.style.enable3dLights()){const p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){const v=((S,A,D)=>{const N=S.properties.get("direction"),j=S.properties.get("color-use-theme")==="none",$=S.properties.get("color").toRenderColor(j?null:D.getLut(S.scope)).toArray01(),V=S.properties.get("intensity"),q=A.properties.get("color-use-theme")==="none",ie=A.properties.get("color").toRenderColor(q?null:D.getLut(A.scope)).toArray01(),ne=A.properties.get("intensity"),le=[N.x,N.y,N.z],ce=o.cM(ie,ne),fe=o.cM($,V);return{u_lighting_ambient_color:ce,u_lighting_directional_dir:le,u_lighting_directional_color:fe,u_ground_radiance:w2(le,fe,ce)}})(p,y,this.style);l.setLightsUniformValues(n,v)}}}uploadCommonUniforms(n,l,p,y,v){if(this.uploadCommonLightUniforms(n,l),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const A=S.getOpacity(this.transform.pitch),D=((N,j,$,V,q,ie,ne,le,ce,fe,ve,_e)=>{const Te=N.transform,we=j.properties.get("color-use-theme")==="none",Se=j.properties.get("color").toRenderColor(we?null:N.style.getLut(j.scope)).toArray01();Se[3]=V;const be=N.frameCounter/1e3%1,[ke,ze]=j.properties.get("vertical-range");return{u_fog_matrix:$?Te.calculateFogTileMatrix($):_e||N.identityMat,u_fog_range:j.getFovAdjustedRange(Te._fov),u_fog_color:Se,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ke,ze),ze],u_fog_temporal_offset:be,u_frustum_tl:q,u_frustum_tr:ie,u_frustum_br:ne,u_frustum_bl:le,u_globe_pos:ce,u_globe_radius:fe,u_viewport:ve,u_globe_transition:o.ae(Te.zoom),u_is_globe:+(Te.projection.name==="globe")}})(this,S,p,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],y);l.setFogUniformValues(n,D)}v&&l.setCutoffUniformValues(n,v.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)l[y.key]=n[y.key]||new Cl(y,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,l){return!(!n.is3D()||n.type!=="clip"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[n.key];return l||(this._cachedTileFogOpacities[n.key]=l=this.style.fog.getOpacityForTile(n)),l[0]>=Vt||l[1]>=Vt}setupDepthForOcclusion(n,l,p){const y=this.context,v=y.gl,S=!!p;var A;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(v.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),y.activeTexture.set(v.TEXTURE0),S||l.setTerrainUniformValues(y,p)}}function Ip(f,n){let l=!1,p=null;const y=()=>{p=null,l&&(f(),p=setTimeout(y,n),l=!1)};return()=>(l=!0,p||y(),p)}class kp{constructor(n){this._hashName=n&&encodeURIComponent(n),o.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ip(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=Rp(n);if(this._hashName){const p=this._hashName;let y=!1;const v=location.hash.slice(1).split("&").map(S=>{const A=S.split("=")[0];return A===p?(y=!0,`${A}=${l}`):S}).filter(S=>S);return y||v.push(`${p}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Rp(f,n){const l=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),S=Math.round(l.lng*v)/v,A=Math.round(l.lat*v)/v,D=f.getBearing(),N=f.getPitch();let j=n?`/${S}/${A}/${p}`:`${p}/${A}/${S}`;return(D||N)&&(j+="/"+Math.round(10*D)/10),N&&(j+=`/${Math.round(N)}`),j}const zu={linearity:.3,easing:o.dy(0,0,.3,1)},nx=o.l({deceleration:2500,maxSpeed:1400},zu),ix=o.l({deceleration:20,maxSpeed:1400},zu),ox=o.l({deceleration:1e3,maxSpeed:360},zu),sx=o.l({deceleration:1e3,maxSpeed:90},zu);class ax{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=o.q.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){const v=Sh(l.pan.mag(),p,o.l({},nx,n||{}));y.offset=l.pan.mult(v.amount/l.pan.mag()),y.center=this._map.transform.center,wh(y,v)}if(l.zoom){const v=Sh(l.zoom,p,ix);y.zoom=this._map.transform.zoom+v.amount,wh(y,v)}if(l.bearing){const v=Sh(l.bearing,p,ox);y.bearing=this._map.transform.bearing+o.aw(v.amount,-179,179),wh(y,v)}if(l.pitch){const v=Sh(l.pitch,p,sx);y.pitch=this._map.transform.pitch+v.amount,wh(y,v)}if(y.zoom||y.bearing){const v=l.pinchAround===void 0?l.around:l.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function wh(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Sh(f,n,l){const{maxSpeed:p,linearity:y,deceleration:v}=l,S=o.aw(f*y/(n/1e3),-p,p),A=Math.abs(S)/(v*y);return{easing:l.easing,duration:1e3*A,amount:S*(A/2)}}class Ko extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p,y={}){const v=Ze(l.getCanvasContainer(),p),S=l.unproject(v);super(n,o.l({point:v,lngLat:S,originalEvent:p},y)),this._defaultPrevented=!1,this.target=l}}class Th extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p){const y=n==="touchend"?p.changedTouches:p.touches,v=et(l.getCanvasContainer(),y),S=v.map(D=>l.unproject(D)),A=v.reduce((D,N,j,$)=>D.add(N.div($.length)),new o.P(0,0));super(n,{points:v,point:A,lngLats:S,lngLat:l.unproject(A),originalEvent:p}),this._defaultPrevented=!1}}class lx extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class cx{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new lx(this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new Ko(n.type,this._map,n))}mouseup(n){this._map.fire(new Ko(n.type,this._map,n))}preclick(n){const l=o.l({},n);l.type="preclick",this._map.fire(new Ko(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Ko(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Ko(n.type,this._map,n))}mouseover(n){this._map.fire(new Ko(n.type,this._map,n))}mouseout(n){this._map.fire(new Ko(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Th(n.type,this._map,n))}touchmove(n){this._map.fire(new Th(n.type,this._map,n))}touchend(n){this._map.fire(new Th(n.type,this._map,n))}touchcancel(n){this._map.fire(new Th(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ux{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Ko(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ko("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ko(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dx{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(he(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const p=l,y=this._startPos,v=this._lastPos;if(!y||!v||v.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const S=Math.min(y.x,p.x),A=Math.max(y.x,p.x),D=Math.min(y.y,p.y),N=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${D}px)`,this._box.style.width=A-S+"px",this._box.style.height=N-D+"px")})}mouseupWindow(n,l){if(!this._active)return;const p=this._startPos,y=l;if(p&&n.button===0){if(this.reset(),Ce(),p.x!==y.x||p.y!==y.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:n})),{cameraAnimation:v=>v.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ie(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new o.z(n,{originalEvent:l}))}}function M_(f,n){const l={};for(let p=0;p<f.length;p++)l[f[p].identifier]=n[p];return l}class I2{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const v=new o.P(0,0);for(const S of y)v._add(S);return v.div(y.length)}(l),this.touches=M_(p,l)))}touchmove(n,l,p){if(this.aborted||!this.centroid)return;const y=M_(p,l);for(const v in this.touches){const S=y[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(n,l,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class ri{constructor(n){this.singleTap=new I2(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,p){this.singleTap.touchstart(n,l,p)}touchmove(n,l,p){this.singleTap.touchmove(n,l,p)}touchend(n,l,p){const y=this.singleTap.touchend(n,l,p);if(y){const v=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(v&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class hx{constructor(){this._zoomIn=new ri({numTouches:1,numTaps:2}),this._zoomOut=new ri({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,p){this._zoomIn.touchstart(n,l,p),this._zoomOut.touchstart(n,l,p)}touchmove(n,l,p){this._zoomIn.touchmove(n,l,p),this._zoomOut.touchmove(n,l,p)}touchend(n,l,p){const y=this._zoomIn.touchend(n,l,p),v=this._zoomOut.touchend(n,l,p);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:n})}):v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(v)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const k2={0:1,2:2};class P_{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const p=Ge(n);this._correctButton(n,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(n,l){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&function(y,v){const S=k2[v];return y.buttons===void 0||(y.buttons&S)!==S}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(n){this._lastPoint&&Ge(n)===this._eventButton&&(this._moved&&Ce(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eh extends P_{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class A_ extends P_{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const p=.8*(l.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){n.preventDefault()}}class Dp extends P_{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const p=-.5*(l.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){n.preventDefault()}}class Lp{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(n,l,p){return this._calculateTransform(n,l,p)}touchmove(n,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,p)}}touchend(n,l,p){this._calculateTransform(n,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,p){p.length>0&&(this._active=!0);const y=M_(p,l),v=new o.P(0,0),S=new o.P(0,0);let A=0;for(const N in y){const j=y[N],$=this._touches[N];$&&(v._add(j),S._add(j.sub($)),A++,y[N]=j)}if(this._touches=y,A<this._minTouches||!S.mag())return;const D=S.div(A);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ks{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,p){return{}}touchstart(n,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,p){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[v,S]=y,A=Cc(p,l,v),D=Cc(p,l,S);if(!A||!D)return;const N=this._aroundCenter?null:A.add(D).div(2);return this._move([A,D],N,n)}touchend(n,l,p){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,S=Cc(p,l,y),A=Cc(p,l,v);S&&A||(this._active&&Ce(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Cc(f,n,l){for(let p=0;p<f.length;p++)if(f[p].identifier===l)return n[p]}function li(f,n){return Math.log(f/n)/Math.LN2}class ya extends Ks{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(li(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:li(this._distance,p),pinchAround:l}}}function Op(f,n){return 180*f.angleWith(n)/Math.PI}class zp extends Ks{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Op(this._vector,p),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=Op(n,p);return Math.abs(y)<l}}function Np(f){return Math.abs(f.y)>Math.abs(f.x)}class R2 extends Ks{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Np(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,p){const y=this._lastPoints;if(!y)return;const v=n[0].sub(y[0]),S=n[1].sub(y[1]);return this._map._cooperativeGestures&&!o.dz()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,S,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5})}gestureBeginsVertically(n,l,p){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,v=l.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const S=n.y>0==l.y>0;return Np(n)&&Np(l)&&S}}const Ch={panStep:100,bearingStep:15,pitchStep:10};class D2{constructor(){const n=Ch;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,p=0,y=0,v=0,S=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),v=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),v=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),S=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:A=>{const D=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:L2,zoom:l?Math.round(D)+l*(n.shiftKey?2:1):D,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:A.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function L2(f){return f*(2-f)}const Fp=4.000244140625,I_=1/450;class Nu{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=I_,o.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=o.q.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Fp==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Ze(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>Fp?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&j!==0&&(j=1/j);const $=l(),V=Math.pow(2,$),q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*j))),this._type==="wheel"&&(this._startZoom=$,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),y=this._startZoom,v=this._easing;let S,A=!1;if(this._type==="wheel"&&y&&v){const N=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),j=v(N);S=o.af(y,p,j),N<1?this._frameId||(this._frameId=!0):A=!0}else S=p,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=S-l();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=o.dA;if(this._prevEase){const p=this._prevEase,y=(o.q.now()-p.start)/p.duration,v=p.easing(y+.01)-p.easing(y),S=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-S*S);l=o.dy(S,A,.25,1)}return this._prevEase={start:o.q.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Fu{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Za{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Js{constructor(){this._tap=new ri({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,l,p))}touchmove(n,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=l[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(n,l,p)}touchend(n,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,l,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nl{constructor(n,l,p){this._el=n,this._mousePan=l,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mc{constructor(n,l,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fl{constructor(n,l,p,y){this._el=n,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const jp=f=>f.zoom||f.drag||f.pitch||f.rotate;class O2 extends o.z{}class z2{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const p=o.ab.vec3.sub([],l,n);this.radius=o.ab.vec3.length(p[2]<0?o.ab.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(n){o.ab.vec3.div(n,n,this.constants),o.ab.vec3.normalize(n,n),o.ab.vec3.mul(n,n,this.constants);const l=o.ab.vec3.scale([],n,this.radius);if(l[2]>0){const p=o.ab.vec3.scale([],[0,0,1],o.ab.vec3.dot(l,[0,0,1])),y=o.ab.vec3.scale([],o.ab.vec3.normalize([],[l[0],l[1],0]),this.radius),v=o.ab.vec3.add([],l,o.ab.vec3.scale([],o.ab.vec3.sub([],o.ab.vec3.add([],y,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function Bp(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class fx{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ax(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new z2,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.aP(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,v,S]of this._listeners){const A=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(v,A,S)}}destroy(){for(const[n,l,p]of this._listeners){const y=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(l,y,p)}}_addDefaultHandlers(n){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new cx(l,n));const y=l.boxZoom=new dx(l,n);this._add("boxZoom",y);const v=new hx,S=new Za;l.doubleClickZoom=new Fu(S,v),this._add("tapZoom",v),this._add("clickZoom",S);const A=new Js;this._add("tapDragZoom",A);const D=l.touchPitch=new R2(l);this._add("touchPitch",D);const N=new A_(n),j=new Dp(n);l.dragRotate=new Mc(n,N,j),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const $=new Eh(n),V=new Lp(l,n);l.dragPan=new Nl(p,$,V),this._add("mousePan",$),this._add("touchPan",V,["touchZoom","touchRotate"]);const q=new zp,ie=new ya;l.touchZoomRotate=new Fl(p,ie,q,A),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ux(l));const ne=l.scrollZoom=new Nu(l,this);this._add("scrollZoom",ne,["mousePan"]);const le=l.keyboard=new D2;this._add("keyboard",le);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ce]&&l[ce].enable(n[ce])}_add(n,l,p){this._handlers.push({handlerName:n,handler:l,allowed:p}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!jp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,p){for(const y in n)if(y!==p&&(!l||l.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const p of n)this._el.contains(p.target)&&l.push(p);return l}handleEvent(n,l){this._updatingCamera=!0;const p=n.type==="renderFrame",y=p?void 0:n,v={needsRenderFrame:!1},S={},A={},D=n.touches?this._getMapTouches(n.touches):void 0,N=D?et(this._el,D):p?void 0:Ze(this._el,n);for(const{handlerName:V,handler:q,allowed:ie}of this._handlers){if(!q.isEnabled())continue;let ne;this._blockedByActive(A,ie,V)?q.reset():q[l||n.type]&&(ne=q[l||n.type](n,N,D),this.mergeHandlerResult(v,S,ne,V,y),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||q.isActive())&&(A[V]=q)}const j={};for(const V in this._previousActiveHandlers)A[V]||(j[V]=y);this._previousActiveHandlers=A,(Object.keys(j).length||Bp(v))&&(this._changes.push([v,S,j]),this._triggerRenderFrame()),(Object.keys(A).length||Bp(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=v;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))}mergeHandlerResult(n,l,p,y,v){if(!p)return;o.l(n,p);const S={handlerName:y,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(l.zoom=S),p.panDelta!==void 0&&(l.drag=S),p.pitchDelta!==void 0&&(l.pitch=S),p.bearingDelta!==void 0&&(l.rotate=S)}_applyChanges(){const n={},l={},p={};for(const[y,v,S]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new o.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),o.l(l,v),o.l(p,S);this._updateMapTransform(n,l,p),this._changes=[]}_updateMapTransform(n,l,p){const y=this._map,v=y.transform,S=fe=>[fe.x,fe.y,fe.z];if((fe=>{const ve=this._eventsInProgress.drag;return ve&&!this._handlersById[ve.handlerName].isActive()})()&&!Bp(n)){const fe=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),fe!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&y._stop(!0),!Bp(n))return void this._fireEvents(l,p,!0);let{panDelta:A,zoomDelta:D,bearingDelta:N,pitchDelta:j,around:$,aroundCoord:V,pinchAround:q}=n;v._isCameraConstrained&&(D>0&&(D=0),v._isCameraConstrained=!1),q!==void 0&&($=q),(D||(fe=>l[fe]&&!this._eventsInProgress[fe])("drag"))&&$&&(this._dragOrigin=S(v.pointCoordinate3D($)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),$=$||y.transform.centerPoint,N&&(v.bearing+=N),j&&(v.pitch+=j),v._updateCameraState();const ie=[0,0,0];if(A)if(v.projection.name==="mercator"){const fe=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay($).dir),ve=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay($.sub(A)).dir);ie[0]=ve[0]-fe[0],ie[1]=ve[1]-fe[1]}else{const fe=v.pointCoordinate($);if(v.projection.name==="globe"){A=A.rotate(-v.angle);const ve=v._pixelsPerMercatorPixel/v.worldSize;ie[0]=-A.x*o.dB(o.aS(fe.y))*ve,ie[1]=-A.y*o.dB(v.center.lat)*ve}else{const ve=v.pointCoordinate($.sub(A));fe&&ve&&(ie[0]=ve.x-fe.x,ie[1]=ve.y-fe.y)}}const ne=v.zoom,le=[0,0,0];if(D){const fe=S(V||v.pointCoordinate3D($)),ve={dir:o.ab.vec3.normalize([],o.ab.vec3.sub([],fe,v._camera.position))};if(ve.dir[2]<0){const _e=v.zoomDeltaToMovement(fe,D);o.ab.vec3.scale(le,ve.dir,_e)}}const ce=o.ab.vec3.add(ie,ie,le);v._translateCameraConstrained(ce),D&&Math.abs(v.zoom-ne)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,p,!0)}_fireEvents(n,l,p){const y=jp(this._eventsInProgress),v=jp(n),S={};for(const j in n){const{originalEvent:$}=n[j];this._eventsInProgress[j]||(S[`${j}start`]=$),this._eventsInProgress[j]=n[j]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const j in S)this._fireEvent(j,S[j]);v&&this._fireEvent("move",v.originalEvent);for(const j in n){const{originalEvent:$}=n[j];this._fireEvent(j,$)}const A={};let D;for(const j in this._eventsInProgress){const{handlerName:$,originalEvent:V}=this._eventsInProgress[j];this._handlersById[$].isActive()||(delete this._eventsInProgress[j],D=l[$]||V,A[`${j}end`]=D)}for(const j in A)this._fireEvent(j,A[j]);const N=jp(this._eventsInProgress);if(p&&(y||v)&&!N){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;j?($(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:D})):(this._map.fire(new o.z("moveend",{originalEvent:D})),$(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new o.z(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new O2("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const fo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class k_ extends o.E{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,o.aP(["_renderFrameCallback"],this)}getCenter(){return new o.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,p){return n=o.P.convert(n).mult(-1),this.panTo(this.transform.center,o.l({offset:n},l),p)}panTo(n,l,p){return this.easeTo(o.l({center:n},l),p)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,p){return this.easeTo(o.l({zoom:n},l),p)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,p){return this.easeTo(o.l({bearing:n},l),p)}resetNorth(n,l){return this.rotateTo(0,o.l({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(o.l({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=o.az.convert(n);const p=l&&l.bearing||0,y=l&&l.pitch||0,v=n.getNorthWest(),S=n.getSouthEast();return this._cameraForBounds(this.transform,v,S,p,y,l)}_extendPadding(n){const l={top:0,right:0,bottom:0,left:0};return n==null?o.l({},l,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:o.l({},l,n)}_extendCameraOptions(n){return(n=o.l({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,l){const p=l.max[0]-l.min[0],y=l.max[1]-l.min[1];return p/y>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,p,y,v,S){const A=n.clone(),D=this._extendCameraOptions(S);A.bearing=y,A.pitch=v;const N=o.bO.convert(l),j=o.bO.convert(p),$=.5*(N.lat+j.lat),V=.5*(N.lng+j.lng),q=o.dC($,V),ie=o.ab.vec3.normalize([],q),ne=o.ab.vec3.normalize([],o.ab.vec3.cross([],ie,[0,1,0])),le=o.ab.vec3.cross([],ne,ie),ce=[ne[0],ne[1],ne[2],0,le[0],le[1],le[2],0,ie[0],ie[1],ie[2],0,0,0,0,1],fe=[q,o.dC(N.lat,N.lng),o.dC(j.lat,N.lng),o.dC(j.lat,j.lng),o.dC(N.lat,j.lng),o.dC($,N.lng),o.dC($,j.lng),o.dC(N.lat,V),o.dC(j.lat,V)];let ve=o.cd.fromPoints(fe.map(ot=>[o.ab.vec3.dot(ne,ot),o.ab.vec3.dot(le,ot),o.ab.vec3.dot(ie,ot)]));const _e=o.ab.vec3.transformMat4([],ve.center,ce);o.ab.vec3.squaredLength(_e)===0&&o.ab.vec3.set(_e,0,0,1),o.ab.vec3.normalize(_e,_e),o.ab.vec3.scale(_e,_e,o.ax),A.center=o.dD(_e);const Te=A.getWorldToCameraMatrix(),we=o.ab.mat4.invert(new Float64Array(16),Te);ve=o.cd.applyTransform(ve,o.ab.mat4.multiply([],Te,ce));const Se=this._extendAABB(ve,A,D,y);if(!Se)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Se,o.ab.vec3.transformMat4(_e,_e,Te);const be=.5*(ve.max[2]-ve.min[2]),ke=this._minimumAABBFrustumDistance(A,ve),ze=o.ab.vec3.scale([],[0,0,1],be),tt=o.ab.vec3.add(ze,_e,ze),Xe=ke+(A.pitch===0?0:o.ab.vec3.distance(_e,tt)),Oe=A.globeCenterInViewSpace,$e=o.ab.vec3.sub([],_e,[Oe[0],Oe[1],Oe[2]]);o.ab.vec3.normalize($e,$e),o.ab.vec3.scale($e,$e,Xe);const ht=o.ab.vec3.add([],_e,$e);o.ab.vec3.transformMat4(ht,ht,we);const xt=o.ds/o.ax,Pt=o.ab.vec3.length(ht),Ye=o.bH(Math.max(Pt*xt-o.ds,Number.EPSILON),0),mt=Math.min(A.zoomFromMercatorZAdjusted(Ye),D.maxZoom);return mt>.5*(o.c6+o.bY)?(A.setProjection({name:"mercator"}),A.zoom=mt,this._cameraForBounds(A,l,p,y,v,S)):{center:A.center,zoom:mt,bearing:y,pitch:v}}_extendAABB(n,l,p,y){const v=.5*((p.padding.left||0)+(p.padding.right||0)),S=.5*((p.padding.top||0)+(p.padding.bottom||0)),A=S,D=v,N=v,j=S,$=l.width-(D+N),V=l.height-(A+j),q=o.ab.vec3.sub([],n.max,n.min),ie=Math.min($/q[0],V/q[1]),ne=Math.min(l.scaleZoom(l.scale*ie),p.maxZoom);if(isNaN(ne))return null;const le=l.scale/l.zoomScale(ne),ce=new o.cd([n.min[0]-D*le,n.min[1]-j*le,n.min[2]],[n.max[0]+N*le,n.max[1]+A*le,n.max[2]]),fe=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new o.P(p.offset.x,p.offset.y):o.P.convert(p.offset)).rotate(-o.ai(y));return ce.center[0]-=fe.x*le,ce.center[1]+=fe.y*le,ce}queryTerrainElevation(n,l){const p=this.transform.elevation;return p?(l=o.l({},{exaggerated:!0},l),p.getAtPoint(o.aa.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,p,y,v,S){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,p,y,v,S);const A=n.clone(),D=this._extendCameraOptions(S);A.bearing=y,A.pitch=v;const N=o.bO.convert(l),j=o.bO.convert(p),$=new o.bO(N.lng,j.lat),V=new o.bO(j.lng,N.lat),q=A.project(N),ie=A.project(j),ne=this.queryTerrainElevation(N),le=this.queryTerrainElevation(j),ce=this.queryTerrainElevation($),fe=this.queryTerrainElevation(V),ve=[[q.x,q.y,Math.min(ne||0,le||0,ce||0,fe||0)],[ie.x,ie.y,Math.max(ne||0,le||0,ce||0,fe||0)]];let _e=o.cd.fromPoints(ve);const Te=A.getWorldToCameraMatrix(),we=o.ab.mat4.invert(new Float64Array(16),Te);_e=o.cd.applyTransform(_e,Te);const Se=this._extendAABB(_e,A,D,y);if(!Se)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=Se;const be=.5*o.ab.vec3.sub([],_e.max,_e.min)[2],ke=this._minimumAABBFrustumDistance(A,_e),ze=[0,0,1,0];o.ab.vec4.transformMat4(ze,ze,Te),o.ab.vec4.normalize(ze,ze);const tt=o.ab.vec3.scale([],ze,ke+be),Xe=o.ab.vec3.add([],_e.center,tt);o.ab.vec3.transformMat4(_e.center,_e.center,we),o.ab.vec3.transformMat4(Xe,Xe,we);const Oe=A.unproject(new o.P(_e.center[0],_e.center[1])),$e=o.dE(A.projection,Oe),ht=Math.pow(2,$e),xt=Math.min(A._zoomFromMercatorZ(Xe[2]*A.pixelsPerMeter*ht/A.worldSize),D.maxZoom);return A.mercatorFromTransition&&xt<.5*(o.c6+o.bY)?(A.setProjection({name:"globe"}),A.zoom=xt,this._cameraForBounds(A,l,p,y,v,S)):{center:Oe,zoom:xt,bearing:y,pitch:v}}fitBounds(n,l,p){const y=this.cameraForBounds(n,l);return this._fitInternal(y,l,p)}fitScreenCoordinates(n,l,p,y,v){const S=o.P.convert(n),A=o.P.convert(l),D=new o.P(Math.min(S.x,A.x),Math.min(S.y,A.y)),N=new o.P(Math.max(S.x,A.x),Math.max(S.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,A))return this;const j=this.transform.pointLocation3D(D),$=this.transform.pointLocation3D(N),V=this.transform.pointLocation3D(new o.P(D.x,N.y)),q=this.transform.pointLocation3D(new o.P(N.x,D.y)),ie=[Math.min(j.lng,$.lng,V.lng,q.lng),Math.min(j.lat,$.lat,V.lat,q.lat)],ne=[Math.max(j.lng,$.lng,V.lng,q.lng),Math.max(j.lat,$.lat,V.lat,q.lat)],le=y&&y.pitch?y.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,ie,ne,p,le,y);return this._fitInternal(ce,y,v)}_fitInternal(n,l,p){return n?(l=o.l(n,l)).linear?this.easeTo(l,p):this.flyTo(l,p):this}jumpTo(n,l){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let y=!1,v=!1,S=!1;"zoom"in n&&p.zoom!==+n.zoom&&(y=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=o.bO.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(v=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(S=!0,p.pitch=+n.pitch);const A=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(A))if(n.retainPadding===!1){const D=p.clone();D.padding=A,p.setLocationAtPoint(p.center,D.centerPoint)}else p.padding=A;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),y&&this.fire(new o.z("zoomstart",l)).fire(new o.z("zoom",l)).fire(new o.z("zoomend",l)),v&&this.fire(new o.z("rotatestart",l)).fire(new o.z("rotate",l)).fire(new o.z("rotateend",l)),S&&this.fire(new o.z("pitchstart",l)).fire(new o.z("pitch",l)).fire(new o.z("pitchend",l)),this.fire(new o.z("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(fo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return o.w(fo),this;this.stop();const y=p.zoom,v=p.pitch,S=p.bearing;p.setFreeCameraOptions(n);const A=y!==p.zoom,D=v!==p.pitch,N=S!==p.bearing;return this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),A&&this.fire(new o.z("zoomstart",l)).fire(new o.z("zoom",l)).fire(new o.z("zoomend",l)),N&&this.fire(new o.z("rotatestart",l)).fire(new o.z("rotate",l)).fire(new o.z("rotateend",l)),D&&this.fire(new o.z("pitchstart",l)).fire(new o.z("pitch",l)).fire(new o.z("pitchend",l)),this.fire(new o.z("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=o.l({offset:[0,0],duration:500,easing:o.dA},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,y=this.getZoom(),v=this.getBearing(),S=this.getPitch(),A=this.getPadding(),D="zoom"in n?+n.zoom:y,N="bearing"in n?this._normalizeBearing(n.bearing,v):v,j="pitch"in n?+n.pitch:S,$=this._extendPadding(n.padding),V=o.P.convert(n.offset);let q,ie,ne;if(p.projection.name==="globe"){const ze=o.aa.fromLngLat(p.center),tt=V.rotate(-p.angle);ze.x+=tt.x/p.worldSize,ze.y+=tt.y/p.worldSize;const Xe=ze.toLngLat(),Oe=o.bO.convert(n.center||Xe);this._normalizeCenter(Oe),q=p.centerPoint.add(tt),ie=new o.P(ze.x,ze.y).mult(p.worldSize),ne=new o.P(o.at(Oe.lng),o.aA(Oe.lat)).mult(p.worldSize).sub(ie)}else{q=p.centerPoint.add(V);const ze=p.pointLocation(q),tt=o.bO.convert(n.center||ze);this._normalizeCenter(tt),ie=p.project(ze),ne=p.project(tt).sub(ie)}const le=p.zoomScale(D-y);let ce,fe;n.around&&(ce=o.bO.convert(n.around),fe=p.locationPoint(ce));const ve=this._zooming||D!==y,_e=this._rotating||v!==N,Te=this._pitching||j!==S,we=!p.isPaddingEqual($),Se=n.retainPadding===!1?p.clone():p,be=ze=>tt=>{if(ve&&(ze.zoom=o.af(y,D,tt)),_e&&(ze.bearing=o.af(v,N,tt)),Te&&(ze.pitch=o.af(S,j,tt)),we&&(Se.interpolatePadding(A,$,tt),q=Se.centerPoint.add(V)),ce)ze.setLocationAtPoint(ce,fe);else{const Xe=ze.zoomScale(ze.zoom-y),Oe=D>y?Math.min(2,le):Math.max(.5,le),$e=Math.pow(Oe,1-tt),ht=ze.unproject(ie.add(ne.mult(tt*$e)).mult(Xe));ze.setLocationAtPoint(ze.renderWorldCopies?ht.wrap():ht,q)}return n.preloadOnly||this._fireMoveEvents(l),ze};if(n.preloadOnly){const ze=this._emulate(be,n.duration,p);return this._preloadTiles(ze),this}const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ve,this._rotating=_e,this._pitching=Te,this._padding=we,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,ke),this._ease(be(p),ze=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(l,ze)},n),this}_prepareEase(n,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||p.moving||this.fire(new o.z("movestart",n)),this._zooming&&!p.zooming&&this.fire(new o.z("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new o.z("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new o.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.z("move",n)),this._zooming&&this.fire(new o.z("zoom",n)),this._rotating&&this.fire(new o.z("rotate",n)),this._pitching&&this.fire(new o.z("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.z("zoomend",n)),y&&this.fire(new o.z("rotateend",n)),v&&this.fire(new o.z("pitchend",n)),this.fire(new o.z("moveend",n))}flyTo(n,l){if(this._prefersReducedMotion(n)){const ot=o.ay(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ot,l)}this.stop(),n=o.l({offset:[0,0],speed:1.2,curve:1.42,easing:o.dA},n);const p=this.transform,y=this.getZoom(),v=this.getBearing(),S=this.getPitch(),A=this.getPadding(),D="zoom"in n?o.aw(+n.zoom,p.minZoom,p.maxZoom):y,N="bearing"in n?this._normalizeBearing(n.bearing,v):v,j="pitch"in n?+n.pitch:S,$=this._extendPadding(n.padding),V=p.zoomScale(D-y),q=o.P.convert(n.offset);let ie=p.centerPoint.add(q);const ne=p.pointLocation(ie),le=o.bO.convert(n.center||ne);this._normalizeCenter(le);const ce=p.project(ne),fe=p.project(le).sub(ce);let ve=n.curve;const _e=Math.max(p.width,p.height),Te=_e/V,we=fe.mag();if("minZoom"in n){const ot=o.aw(Math.min(n.minZoom,y,D),p.minZoom,p.maxZoom),Tt=_e/p.zoomScale(ot-y);ve=Math.sqrt(Tt/we*2)}const Se=ve*ve;function be(ot){const Tt=(Te*Te-_e*_e+(ot?-1:1)*Se*Se*we*we)/(2*(ot?Te:_e)*Se*we);return Math.log(Math.sqrt(Tt*Tt+1)-Tt)}function ke(ot){return(Math.exp(ot)-Math.exp(-ot))/2}function ze(ot){return(Math.exp(ot)+Math.exp(-ot))/2}const tt=be(0);let Xe=function(ot){return ze(tt)/ze(tt+ve*ot)},Oe=function(ot){return _e*((ze(tt)*(ke(Tt=tt+ve*ot)/ze(Tt))-ke(tt))/Se)/we;var Tt},$e=(be(1)-tt)/ve;if(Math.abs(we)<1e-6||!isFinite($e)){if(Math.abs(_e-Te)<1e-6)return this.easeTo(n,l);const ot=Te<_e?-1:1;$e=Math.abs(Math.log(Te/_e))/ve,Oe=function(){return 0},Xe=function(Tt){return Math.exp(ot*ve*Tt)}}n.duration="duration"in n?+n.duration:1e3*$e/("screenSpeed"in n?+n.screenSpeed/ve:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const ht=v!==N,xt=j!==S,Pt=!p.isPaddingEqual($),Ye=n.retainPadding===!1?p.clone():p,mt=ot=>Tt=>{const gt=Tt*$e,ft=1/Xe(gt);ot.zoom=Tt===1?D:y+ot.scaleZoom(ft),ht&&(ot.bearing=o.af(v,N,Tt)),xt&&(ot.pitch=o.af(S,j,Tt)),Pt&&(Ye.interpolatePadding(A,$,Tt),ie=Ye.centerPoint.add(q));const zt=Tt===1?le:ot.unproject(ce.add(fe.mult(Oe(gt))).mult(ft));return ot.setLocationAtPoint(ot.renderWorldCopies?zt.wrap():zt,ie),ot._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),ot};if(n.preloadOnly){const ot=this._emulate(mt,n.duration,p);return this._preloadTiles(ot),this}return this._zooming=!0,this._rotating=ht,this._pitching=xt,this._padding=Pt,this._prepareEase(l,!1),this._ease(mt(p),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,l,p){p.animate===!1||p.duration===0?(n(1),l()):(this._easeStart=o.q.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=o.bF(n,-180,180);const p=Math.abs(n-l);return Math.abs(n-360-l)<p&&(n-=360),Math.abs(n+360-l)<p&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const p=n.lng-l.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,l,p){const y=Math.ceil(15*l/1e3),v=[],S=n(p.clone());for(let A=0;A<=y;A++){const D=S(A/y);v.push(D.clone())}return v}_preloadTiles(n,l){}}class R_{constructor(n={}){this.options=n,o.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const y=te("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=te("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(n){const p=l.reduce((y,v,S)=>(v.value&&(y+=`${v.key}=${v.value}${S<l.length-1?"&":""}`),y),"?");n.href=`${o.e.FEEDBACK_URL}/${p}#${Rp(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const l=this._map.style._mergedSourceCaches;for(const y in l){const v=l[y];if(v.used){const S=v.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n.sort((y,v)=>y.length-v.length),n=n.filter((y,v)=>{for(let S=v+1;S<n.length;S++)if(n[S].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class px{constructor(){o.aP(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=te("div","mapboxgl-ctrl");const l=te("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const p=n[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Pc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const y of p)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class D_{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=o.cB((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,p){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+p}}const Ps={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},As=["mouseenter","mouseover","mouseleave","mouseout"];class Ac extends o.z{constructor(n,l,p,y){const{point:v,lngLat:S,originalEvent:A,target:D}=n;super(n.type,{point:v,lngLat:S,originalEvent:A,target:D}),this.preventDefault=()=>{n.preventDefault()},this.id=l,this.interaction=p,this.feature=y}}class Ic{constructor(n){this.map=n,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.delegatedHandlers=new Map,this.handleType=this.handleType.bind(this)}add(n,l){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const{type:p,filter:y}=l;y&&this.filters.set(n,o.aZ(y));const v=this.interactionsByType.get(p)||new Map;if(v.size===0){if(As.includes(p)){const{mousemove:S,mouseout:A}=this._createDelegatedHandlers(n,l);this.map.on("mousemove",S),this.map.on("mouseout",A),this.delegatedHandlers.set(n,{mousemove:S,mouseout:A})}else this.map.on(p,this.handleType);this.interactionsByType.set(p,v)}v.set(n,l),this.typeById.set(n,p)}get(n){const l=this.typeById.get(n);if(!l)return;const p=this.interactionsByType.get(l);return p?p.get(n):void 0}remove(n){const l=this.typeById.get(n);if(!l)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(l);if(p){if(p.delete(n),this.delegatedHandlers.has(n)){const{mousemove:y,mouseout:v}=this.delegatedHandlers.get(n);this.map.off("mousemove",y),this.map.off("mouseout",v),this.delegatedHandlers.delete(n)}p.size===0&&this.map.off(l,this.handleType)}}queryTargets(n,l){const p=[];for(const[y,v]of l)v.target&&p.push({targetId:y,target:v.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(n,p,this.map.transform)}handleType(n,l){const p=this.interactionsByType.get(n.type),y=Array.from(p).reverse();l=l||this.queryTargets(n.point,y);let v=!1;for(const S of l){for(const[A,D]of y){if(!D.target)continue;const N=S.variants?S.variants[A]:null;if(N){for(const j of N){const $=new o.cw(S,j);if(D.handler(new Ac(n,A,D,$))!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[S,A]of y){const{handler:D,target:N}=A;if(!N&&D(new Ac(n,S,A,null))!==!1)break}}_createDelegatedHandlers(n,l){switch(l.type){case"mouseenter":case"mouseover":{let p=!1,y=new Set;return{mousemove:v=>{const S=this.queryTargets(v.point,[[n,l]]),A=new Set;if(!S.length)return p=!1,void y.clear();const D=[];for(const N of S)y.has(N.id)||(A.add(N.id),D.push(N));p&&!D.length||(p=!0,y=A,v.type=l.type,this.handleType(v,D))},mouseout:()=>{p=!1,y.clear()}}}case"mouseleave":case"mouseout":{let p=[];return{mousemove:y=>{const v=this.queryTargets(y.point,[[n,l]]);if(!v.length)return y.type=l.type,this.handleType(y,p),void(p=v);const S=[],A=new Set(v.map(D=>D.id));for(const D of p)A.has(D.id)||S.push(D);S.length&&(y.type=l.type,this.handleType(y,S)),p=v},mouseout:y=>{p.length&&(y.type=l.type,this.handleType(y,p),p=[])}}}}}}function ju(f,n){if(Array.isArray(f)&&Array.isArray(n)){const l=new Set(f),p=new Set(n);return l.size===p.size&&f.every(y=>p.has(y))}return o.bn(f,n)}const L_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Kr={showCompass:!0,showZoom:!0,visualizePitch:!1};class jl{constructor(n,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new A_({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new Dp({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),he()}move(n,l){const p=this.map,y=this.mouseRotate.mousemoveWindow(n,l),v=y&&y.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){const S=this.mousePitch.mousemoveWindow(n,l),A=S&&S.pitchDelta;A&&p.setPitch(p.getPitch()+A)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ie(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.l({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ze(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ze(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=et(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=et(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function mx(f,n,l){if(f=new o.bO(f.lng,f.lat),n){const p=new o.bO(f.lng-360,f.lat),y=new o.bO(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-l.center.lng)/360),S=l.locationPoint(f).distSqr(n),A=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(p).distSqr(n)<S&&(A||Math.abs(p.lng-l.center.lng)<v)?f=p:l.locationPoint(y).distSqr(n)<S&&(A||Math.abs(y.lng-l.center.lng)<v)&&(f=y)}for(;Math.abs(f.lng-l.center.lng)>180;){const p=l.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}const O_={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Mh extends o.E{constructor(n,l){if(super(),(n instanceof HTMLElement||l)&&(n=o.l({element:n},l)),o.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=o.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=te("div");const v=41,S=27,A=oe("svg",{display:"block",height:v*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${v}`},this._element),D=oe("radialGradient",{id:"shadowGradient"},oe("defs",{},A));oe("stop",{offset:"10%","stop-opacity":.4},D),oe("stop",{offset:"100%","stop-opacity":.05},D),oe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),oe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),oe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),oe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=o.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const p=this._element.classList;for(const v in O_)p.remove(`mapboxgl-marker-anchor-${v}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const y=n&&n.className?n.className.trim().split(/\s+/):[];p.add(...y),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.bO.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,p=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const p=n.unproject(l),y=n.getFreeCameraOptions();if(!y.position)return!1;const v=y.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(l);let y;n._showingGlobe()&&o.dH(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${O_[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!n||p!=="map")return"";if(!l._showingGlobe()){const D=l.getPitch();return D?`rotateX(${D}deg)`:""}const y=o.c4(o.dI(l.transform,this._lngLat)),v=n.sub(o.dJ(l.transform)),S=Math.abs(v.x)+Math.abs(v.y);if(S===0)return"";const A=y/S;return`rotateX(${-v.y*A}deg) rotateY(${v.x*A}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let p=0;const y=this.getRotationAlignment();if(y==="map")if(l._showingGlobe()){const v=l.project(new o.bO(this._lngLat.lng,this._lngLat.lat+.001)),S=l.project(new o.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=o.c4(Math.atan2(S.y,S.x))-90}else p=-l.getBearing();else if(y==="horizon"){const v=o.ac(4,6,l.getZoom()),S=o.dJ(l.transform);S.y+=v*l.transform.height;const A=n.sub(S),D=o.c4(Math.atan2(A.y,A.x));p=(D>90?D-270:D+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=mx(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const l=this._map;if(!l)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const v=this._clickTolerance||l._clickTolerance;if(n.point.dist(p)<v)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,p=this._pos;l&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ya={maxWidth:100,unit:"metric"},Co={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Jo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ki=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function z_(f=new o.P(0,0),n="bottom"){if(typeof f=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new o.P(0,f);case"top-left":return new o.P(l,l);case"top-right":return new o.P(-l,l);case"bottom":return new o.P(0,-f);case"bottom-left":return new o.P(l,-l);case"bottom-right":return new o.P(-l,-l);case"left":return new o.P(f,0);case"right":return new o.P(-f,0)}return new o.P(0,0)}return f instanceof o.P||Array.isArray(f)?o.P.convert(f):o.P.convert(f[n]||[0,0])}return{version:k,supported:J.supported,setRTLTextPlugin:o.dK,getRTLTextPluginStatus:o.dL,Map:class extends k_{constructor(f){z.mark(O.create);const n=f;if((f=o.l({},L_,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&o.dF(window)&&(f.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ep(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Pc,this._domRenderTaskQueue=new Pc,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aV(),this._locale=o.l({},Ps,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new D_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Wt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?{...f.contextCreateOptions}:{},typeof f.container=="string"){const l=document.getElementById(f.container);if(!l)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=l}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,o.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new x_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new fx(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||o.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new Sv(this),f.hash&&(this._hash=new kp(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const l=f.bounds;l&&(this.resize(),this.fitBounds(l,o.l({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new R_({customAttribution:f.customAttribution})),this._logoControl=new px,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.z(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.z(`${l.dataType}dataloading`,l))}),this._interactions=new Ic(this)}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.z("movestart",f)).fire(new o.z("move",f)),this.fire(new o.z("resize",f)),n&&this.fire(new o.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(o.az.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(n=>n==="auto"?navigator.language:n):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let l;n==="globe"&&f.zoom>=o.bY?(f.setMercatorFromTransition(),l=!0):n==="mercator"&&f.zoom<o.bY&&(f.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;return n=f.name==="globe"&&this.transform.zoom>=o.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(o.bO.convert(f))}unproject(f){return this.transform.pointLocation3D(o.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,l){const p=y=>{let v=[];if(Array.isArray(n)){const S=n.filter(A=>this.getLayer(A));v=S.length?this.queryRenderedFeatures(y,{layers:S}):[]}else v=this.queryRenderedFeatures(y,{target:n});return v};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:l,targets:n,delegates:{mousemove:S=>{const A=p(S.point);A.length?y||(y=!0,l.call(this,new Ko(f,this,S.originalEvent,{features:A}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:l,targets:n,delegates:{mousemove:A=>{p(A.point).length?y=!0:y&&(y=!1,l.call(this,new Ko(f,this,A.originalEvent)))},mouseout:A=>{y&&(y=!1,l.call(this,new Ko(f,this,A.originalEvent)))}}}}{const y=v=>{const S=p(v.point);S.length&&(v.features=S,l.call(this,v),delete v.features)};return{listener:l,targets:n,delegates:{[f]:y}}}}on(f,n,l){if(typeof n=="function"||l===void 0)return super.on(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,n,l){if(typeof n=="function"||l===void 0)return super.once(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,l);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,n,l){if(typeof n=="function"||l===void 0)return super.off(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(y=>{for(let v=0;v<y.length;v++){const S=y[v];if(S.listener===l&&ju(S.targets,n)){for(const A in S.delegates)this.off(A,S.delegates[A]);return y.splice(v,1),this}}})(p),this}queryRenderedFeatures(f,n){if(!this.style)return[];if(f===void 0||f instanceof o.P||Array.isArray(f)||n!==void 0||(n=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!n){const v=this.style.queryRenderedFeatures(f,void 0,this.transform),S=this.style.queryRenderedFeatureset(f,void 0,this.transform);return v.concat(S)}let l=!0;if(n.target&&(l=this._isTargetValid(n.target),l&&!n.layers))return this.style.queryRenderedFeatureset(f,n,this.transform);let p=!0;if(n.layers&&Array.isArray(n.layers)){for(const v of n.layers)if(!this._isValidId(v)){p=!1;break}if(p&&!n.target)return this.style.queryRenderedFeatures(f,n,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(f,n,this.transform))),l&&(y=y.concat(this.style.queryRenderedFeatureset(f,n,this.transform))),y}querySourceFeatures(f,n){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,n)}isPointOnSurface(f){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&o.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(f))}addInteraction(f,n){return this._interactions.add(f,n),this}removeInteraction(f){return this._interactions.remove(f),this}setStyle(f,n){return n=o.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&f&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(f,(l,p)=>{l?(o.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(f,n)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const l=o.l({},n);n&&n.config&&(l.initialConfig=n.config,delete l.config),this.style=new Zs(this,l).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.cr(f)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const n of f)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(f)}addSource(f,n){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,l)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,n,{pixelRatio:l=1,sdf:p=!1,stretchX:y,stretchY:v,content:S}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:A,height:D,data:N}=o.q.getImageData(n);this.style.addImage(f,{data:new o.r({width:A,height:D},N),pixelRatio:l,stretchX:y,stretchY:v,content:S,sdf:p,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:D}=n,N=n;this.style.addImage(f,{data:new o.r({width:A,height:D},new Uint8Array(N.data)),pixelRatio:l,stretchX:y,stretchY:v,content:S,sdf:p,usvg:!1,version:0,userImage:N}),N.onAdd&&N.onAdd(this,f)}}updateImage(f,n){this._lazyInitEmptyStyle();const l=this.style.getImage(f);if(!l)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?o.q.getImageData(n):n,{width:y,height:v,data:S}=p;if(y===void 0||v===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(l.usvg?l.icon.usvg_tree.width:l.data.width)||v!==(l.usvg?l.icon.usvg_tree.height:l.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${y}, ${v})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));const A=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let D=!1;l.usvg?(l.data=new o.r({width:y,height:v},new Uint8Array(S)),l.usvg=!1,l.icon=void 0,D=!0):l.data.replace(S,A),this.style.updateImage(f,l,D)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,n){o.o(this._requestManager.transformRequest(f,o.R.Image),(l,p)=>{n(l,p instanceof HTMLImageElement?o.q.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(f,n){this._lazyInitEmptyStyle(),this.style.addModel(f,n)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,n){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)):this}getSlot(f){const n=this.getLayer(f);return n&&n.slot||null}setSlot(f,n){return this.style.setSlot(f,n),this.style.mergeLayers(),this._update(!0)}addImport(f,n){return this.style.addImport(f,n),this}updateImport(f,n){return typeof n!="string"&&n.id!==f?(this.removeImport(f),this.addImport(n)):(this.style.updateImport(f,n),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,n){return this.style.moveImport(f,n),this._update(!0)}moveLayer(f,n){return this._isValidId(f)?(this.style.moveLayer(f,n),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const n=this.style.getOwnLayer(f);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,n,l){return this._isValidId(f)?(this.style.setLayerZoomRange(f,n,l),this._update(!0)):this}setFilter(f,n,l={}){return this._isValidId(f)?(this.style.setFilter(f,n,l),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,n,l,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,n,l,p),this._update(!0)):this}getPaintProperty(f,n){return this._isValidId(f)?this.style.getPaintProperty(f,n):null}setLayoutProperty(f,n,l,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,n,l,p),this._update(!0)):this}getLayoutProperty(f,n){return this._isValidId(f)?this.style.getLayoutProperty(f,n):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,n){return this.style.setSchema(f,n),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,n){return this.style.setConfig(f,n),this._update(!0)}getConfigProperty(f,n){return this.style.getConfigProperty(f,n)}setConfigProperty(f,n,l){return this.style.setConfigProperty(f,n,l),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const n=f[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,n),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bO.convert(f),this.transform):0}setFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,n),this._update())}removeFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,n),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,p,y,v=this._container;for(;v&&(!p||!y);){const S=window.getComputedStyle(v).transform;S&&S!=="none"&&(l=S.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(y=l[3])),v=v.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=te("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=te("div","mapboxgl-canvas-container",f);this._canvas=te("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=te("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=te("div",`mapboxgl-ctrl-${y}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const l=o.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(f),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=o.l({},J.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",f);n?(Yt(n,!0),this.painter=new C_(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.m.testSupport(n)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;this.fire(new o.z("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,p=o.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=y.createQuery(),y.beginQuery(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,j=this.transform.pitch,$=o.q.now(),V=new o.a8(N,{now:$,fadeDuration:v,pitch:j,transition:this.style.transition});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(p);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,z.mark(O.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const N=o.q.now()-p;y.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const j=y.getQueryParameter(n,y.QUERY_RESULT)/1e6;y.deleteQuery(n),this.fire(new o.z("gpu-timing-frame",{cpuTime:N,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(N);this.fire(new o.z("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(N);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:j}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(D||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(S=this._updateAverageElevation(p,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,z.mark(O.fullLoad),this._performanceMetricsCollection&&Lr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const l=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const S=Math.abs(y-v);if(S>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(v),l(v);this._averageElevation.easeTo(v,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(v),l(v)}return!!this._averageElevation.isEasing(f)&&l(this._averageElevation.getValue(f))}_authenticate(){Me(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Rt||f.status===401)){const n=this.painter.context.gl;Yt(n,!1),this._logoControl instanceof px&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&sn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function y(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const S=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,S),S}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(f,n,l){let p=l[1]-l[0];const y=f.length/4;for(let v=0;v<n.length;v++){const S=n[v];let A=0;for(let D=0;D<S.length;D+=4)S[D]===f[D]&&S[D+1]===f[D+1]&&S[D+2]===f[D+2]&&S[D+3]===f[D+3]&&(A+=1);p+=(l[v+2]-l[v+1])*(1-A/y)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),fr.delete(this.painter.context.gl),cn.remove(),rr.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=o.q.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(f){const n=this.style?this.style.getSourceCaches():[];return o.bl(n,(l,p)=>l._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,n){o.dG(f,n)}get version(){return k}},NavigationControl:class{constructor(f={}){this.options=o.l({},Kr,f),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),l=n===f.getMaxZoom(),p=n===f.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jl(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const l=te("button",f,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(f,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",l),f.firstElementChild&&f.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.E{constructor(f={}){super();const n=navigator.geolocation;this.options=o.l({geolocation:n},Bl,f),o.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ip(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,f(l)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>n(l.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),l=f.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",f)),this._finish()}}_updateCamera(f){const n=new o.bO(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,p=this._map.getBearing(),y=o.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),y,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new o.bO(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=o.bH(1,f._center.lat)*f.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=te("button","mapboxgl-ctrl-geolocate",this._container),te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te("div","mapboxgl-user-location"),this._dotElement.appendChild(te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Mh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:R_,ScaleControl:class{constructor(f={}){this.options=o.l({},Ya,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,p=n._containerWidth/2-f/2,y=n.unproject([p,l]),v=n.unproject([p+f,l]),S=y.distanceTo(v);if(this.options.unit==="imperial"){const A=3.2808*S;A>5280?this._setScale(f,A/5280,"mile"):this._setScale(f,A,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,n,l){this._map._requestDomTask(()=>{const p=function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let A=v/S;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(D){const N=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*N)/N}(A),S*A}(n),y=p/n;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${Co[l]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:o.w("Full screen control 'container' must be a DOM element.")),o.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);te("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(f){super(),this.options=o.l(Object.create(Jo),f),o.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=o.bO.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const n=document.createDocumentFragment(),l=document.createElement("body");let p;for(l.innerHTML=f;p=l.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=te("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const l=this._closeButton=te("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,p=this._pos;if(!n||!l||!p)return"bottom";const y=l.offsetWidth,v=l.offsetHeight,S=p.x<y/2,A=p.x>n.transform.width-y/2;if(p.y+f<v)return S?"top-left":A?"top-right":"top";if(p.y>n.transform.height-v){if(S)return"bottom-left";if(A)return"bottom-right"}return S?"left":A?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=te("div","mapboxgl-popup",n.getContainer()),this._tip=te("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mx(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof o.P?f:n.project(this._lngLat),v=z_(this.options.offset),S=this._anchor=this._getAnchor(v.y),A=z_(this.options.offset,S),D=y.add(A).round();n._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${O_[S]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&n._showingGlobe()){const y=o.dH(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Ki);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Mh,Style:Zs,LngLat:o.bO,LngLatBounds:o.az,Point:o.P,MercatorCoordinate:o.aa,FreeCameraOptions:gu,Evented:o.E,config:o.e,prewarm:o.dM,clearPrewarmedResources:o.dN,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(f){o.e.ACCESS_TOKEN=f},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(f){o.e.API_URL=f},get workerCount(){return o.dO.workerCount},set workerCount(f){o.dO.workerCount=f},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){o.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){o.dP(f)},get workerUrl(){return o.dQ.workerUrl},set workerUrl(f){o.dQ.workerUrl=f},get workerClass(){return o.dQ.workerClass},set workerClass(f){o.dQ.workerClass=f},get workerParams(){return o.dQ.workerParams},set workerParams(f){o.dQ.workerParams=f},get dracoUrl(){return o.dR()},set dracoUrl(f){o.dS(f)},get meshoptUrl(){return o.dT()},set meshoptUrl(f){o.dU(f)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var b=d;return b})})(EB);var mne=EB.exports;const pf=r3(mne),gne=({initialLatitude:e=-24.6282,initialLongitude:t=25.9692,onMapClick:i}={})=>{const a=Y.useRef(null),d=Y.useRef(null),[_,b]=Y.useState(!1),[o,k]=Y.useState(null);return Y.useEffect(()=>{console.log("useMap effect starting");let O=!0;const z=async()=>{if(!a.current){console.log("Map container not ready");return}if(a.current.offsetWidth===0||a.current.offsetHeight===0){console.log("Container has no dimensions:",{width:a.current.offsetWidth,height:a.current.offsetHeight});return}try{const G=await _B.getToken();if(!G){console.error("No Mapbox token available"),k("Failed to load map configuration");return}if(!O){console.log("Component unmounted during initialization");return}console.log("Initializing map with dimensions:",{width:a.current.offsetWidth,height:a.current.offsetHeight}),pf.accessToken=G;const ee=new pf.Map({container:a.current,style:"mapbox://styles/mapbox/streets-v12",center:[t,e],zoom:12});ee.on("load",()=>{console.log("Map loaded successfully"),O&&b(!0)}),ee.on("error",J=>{console.error("Map error:",J),O&&(k("Error loading map"),Jn.error("Error loading map. Please try again."))}),i&&ee.on("click",J=>{console.log("Map clicked:",J.lngLat),i(J.lngLat)}),ee.addControl(new pf.NavigationControl,"top-right"),d.current=ee}catch(G){console.error("Error initializing map:",G),O&&(k("Failed to initialize map"),Jn.error("Failed to initialize map. Please check your connection and try again."))}},F=new ResizeObserver(G=>{const ee=G[0];ee.contentRect.width>0&&ee.contentRect.height>0&&(console.log("Container dimensions ready:",ee.contentRect),z(),F.disconnect())});return a.current&&F.observe(a.current),()=>{console.log("Cleaning up map"),O=!1,F.disconnect(),d.current&&(d.current.remove(),d.current=null)}},[e,t,i]),{mapContainer:a,map:d.current,isLoaded:_,error:o}},_ne=e=>{const t=document.createElement("div");t.className="relative";const i=document.createElement("div");i.className="w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-lg";const a=document.createElement("div"),d=Math.min(Math.max(e/5,16),100);return a.style.width=`${d}px`,a.style.height=`${d}px`,a.style.position="absolute",a.style.left=`${-d/2+8}px`,a.style.top=`${-d/2+8}px`,a.className="absolute rounded-full bg-blue-500/20 animate-pulse",t.appendChild(a),t.appendChild(i),t},MB=e=>{const[t,i]=Y.useState(null),[a,d]=Y.useState(null),_=Y.useRef(null),b=Y.useRef(null);return Y.useEffect(()=>{if(console.log("useUserLocation effect running, map:",!!e),!e){console.log("Map not ready, skipping location initialization");return}if(e.loaded())o();else{console.log("Map not loaded yet, waiting for load event");const k=()=>{console.log("Map loaded, initializing location tracking"),o()};return e.once("load",k),()=>{e.off("load",k)}}function o(){if(!navigator.geolocation){console.log("Geolocation not supported"),d("Geolocation is not supported by your browser"),Jn.error("Geolocation is not supported by your browser");return}const k=z=>{const{latitude:F,longitude:G,accuracy:ee}=z.coords;console.log("User location updated:",{latitude:F,longitude:G,accuracy:ee}),i({latitude:F,longitude:G,accuracy:ee}),_.current&&_.current.remove();try{const J=_ne(ee);_.current=new pf.Marker({element:J}).setLngLat([G,F]),e&&e.loaded()&&_.current.addTo(e),e==null||e.flyTo({center:[G,F],zoom:14})}catch(J){console.error("Error creating location marker:",J)}},O=z=>{console.error("Geolocation error:",z);const F="Failed to get your location. Please check your permissions.";d(F),Jn.error(F)};b.current=navigator.geolocation.watchPosition(k,O,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}return()=>{console.log("Cleaning up user location tracking"),b.current!==null&&(navigator.geolocation.clearWatch(b.current),b.current=null),_.current&&(_.current.remove(),_.current=null)}},[e]),{userLocation:t,error:a}},yne=()=>{const e=$o(),[t,i]=Y.useState(""),[a,d]=Y.useState({startDate:void 0,endDate:void 0,vehicleType:void 0,location:"",sortBy:"distance",sortOrder:"asc"}),_=ee=>{console.log("Search query updated:",ee),i(ee)},b=ee=>{try{const J=JSON.parse(JSON.stringify(ee));console.log("Filters updated:",J),d(J)}catch(J){console.error("Error serializing filters:",J)}},o=ee=>{try{console.log("Car clicked, navigating to:",ee),e(`/cars/${ee}`)}catch(J){console.error("Error handling car click:",J)}},{mapContainer:k,map:O,isLoaded:z,error:F}=gne({onMapClick:ee=>{try{const J={lat:ee.lat,lng:ee.lng};console.log("Map clicked at:",J)}catch(J){console.error("Error handling map click:",J)}}});if(MB(O),F)return L.jsx(rne,{});const G={id:"example-car",brand:"Example",model:"Car",owner_id:"example-owner",price_per_day:100,vehicle_type:"Basic",year:2024,transmission:"automatic",fuel:"petrol",seats:5,location:"Example Location",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),description:null,image_url:null,is_available:!0,latitude:-24.6282,longitude:25.9692,registration_url:null,insurance_url:null,additional_docs_urls:null};return L.jsxs("div",{className:"h-screen flex flex-col pb-[50px]",children:[L.jsx(BF,{searchQuery:t,onSearchChange:_,onFiltersChange:b}),L.jsx("div",{className:"flex-1 relative",children:L.jsx("div",{ref:k,className:"absolute inset-0",style:{minHeight:"400px"},children:z&&L.jsx(pne,{price:G.price_per_day,brand:G.brand,model:G.model,type:G.vehicle_type,rating:4.5,distance:"2km",latitude:G.latitude,longitude:G.longitude,onClick:()=>o(G.id)})})}),L.jsx(So,{})]})},vne=()=>{const e=$o(),i=[{icon:Kz,label:"App Settings",onClick:()=>Jn.info("App Settings coming soon")},{icon:Gz,label:"Notifications",onClick:()=>Jn.info("Notifications coming soon")},{icon:eH,label:"Privacy & Security",onClick:()=>Jn.info("Privacy settings coming soon")},{icon:qG,label:"About",onClick:()=>Jn.info("About page coming soon")},{icon:UG,label:"Help & Support",onClick:()=>Jn.info("Help center coming soon")},{icon:ZG,label:"Log Out",onClick:async()=>{try{await Qt.auth.signOut(),Jn.success("Logged out successfully"),e("/login")}catch(a){console.error("Error logging out:",a),Jn.error("Failed to log out")}},className:"text-red-600"}];return L.jsxs("div",{className:"min-h-screen pb-20",children:[L.jsx("header",{className:"bg-white p-4 sticky top-0 z-10 shadow-sm",children:L.jsx("h1",{className:"text-xl font-semibold",children:"More"})}),L.jsx("main",{className:"p-4",children:L.jsx("div",{className:"space-y-2",children:i.map((a,d)=>L.jsxs("button",{onClick:a.onClick,className:`w-full flex items-center gap-3 p-4 bg-white rounded-lg shadow-sm ${a.className||"text-gray-700"}`,children:[L.jsx(a.icon,{className:"w-5 h-5"}),L.jsx("span",{children:a.label})]},d))})}),L.jsx(So,{})]})};var pP=Object.defineProperty,xne=Object.getOwnPropertyDescriptor,bne=Object.getOwnPropertyNames,wne=Object.prototype.hasOwnProperty,Sne=(e,t)=>{for(var i in t)pP(e,i,{get:t[i],enumerable:!0})},Tne=(e,t,i,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let d of bne(t))!wne.call(e,d)&&d!==i&&pP(e,d,{get:()=>t[d],enumerable:!(a=xne(t,d))||a.enumerable});return e},Ene=e=>Tne(pP({},"__esModule",{value:!0}),e),Cne=(e,t,i)=>new Promise((a,d)=>{var _=k=>{try{o(i.next(k))}catch(O){d(O)}},b=k=>{try{o(i.throw(k))}catch(O){d(O)}},o=k=>k.done?a(k.value):Promise.resolve(k.value).then(_,b);o((i=i.apply(e,t)).next())}),PB={};Sne(PB,{SessionContextProvider:()=>Ane,useSession:()=>Rne,useSessionContext:()=>Ine,useSupabaseClient:()=>kne,useUser:()=>Dne});var Mne=Ene(PB),Ea=Y,Pne=L,hv=(0,Ea.createContext)({isLoading:!0,session:null,error:null,supabaseClient:{}}),Ane=({supabaseClient:e,initialSession:t=null,children:i})=>{const[a,d]=(0,Ea.useState)(t),[_,b]=(0,Ea.useState)(!t),[o,k]=(0,Ea.useState)();(0,Ea.useEffect)(()=>{!a&&t&&d(t)},[a,t]),(0,Ea.useEffect)(()=>{let z=!0;function F(){return Cne(this,null,function*(){const{data:{session:G},error:ee}=yield e.auth.getSession();if(z){if(ee){k(ee),b(!1);return}d(G),b(!1)}})}return F(),()=>{z=!1}},[]),(0,Ea.useEffect)(()=>{const{data:{subscription:z}}=e.auth.onAuthStateChange((F,G)=>{G&&(F==="SIGNED_IN"||F==="TOKEN_REFRESHED"||F==="USER_UPDATED")&&d(G),F==="SIGNED_OUT"&&d(null)});return()=>{z.unsubscribe()}},[]);const O=(0,Ea.useMemo)(()=>_?{isLoading:!0,session:null,error:null,supabaseClient:e}:o?{isLoading:!1,session:null,error:o,supabaseClient:e}:{isLoading:!1,session:a,error:null,supabaseClient:e},[_,a,o]);return(0,Pne.jsx)(hv.Provider,{value:O,children:i})},Ine=()=>{const e=(0,Ea.useContext)(hv);if(e===void 0)throw new Error("useSessionContext must be used within a SessionContextProvider.");return e};function kne(){const e=(0,Ea.useContext)(hv);if(e===void 0)throw new Error("useSupabaseClient must be used within a SessionContextProvider.");return e.supabaseClient}var Rne=()=>{const e=(0,Ea.useContext)(hv);if(e===void 0)throw new Error("useSession must be used within a SessionContextProvider.");return e.session},Dne=()=>{var e,t;const i=(0,Ea.useContext)(hv);if(i===void 0)throw new Error("useUser must be used within a SessionContextProvider.");return(t=(e=i.session)==null?void 0:e.user)!=null?t:null};const Lne=({car:e})=>{const t=$o(),i=Mne.useUser(),a=(i==null?void 0:i.id)===e.owner_id,[d,_]=Y.useState(!1),b=()=>{t(`/cars/${e.id}/edit`)};return L.jsx("div",{className:"w-full p-4 bg-background/80 backdrop-blur-sm border-t",children:L.jsx("div",{className:"max-w-2xl mx-auto flex gap-4",children:a?L.jsx(on,{className:"w-full",variant:"outline",onClick:b,children:"Edit Car"}):L.jsxs(L.Fragment,{children:[L.jsx(on,{className:"w-full",onClick:()=>_(!0),children:"Book Now"}),L.jsx($F,{car:e,isOpen:d,onClose:()=>_(!1)})]})})})},One=({brand:e,model:t,year:i,location:a})=>L.jsx(L.Fragment,{children:L.jsxs("div",{className:"flex justify-between items-start",children:[L.jsxs("div",{children:[L.jsxs("h1",{className:"text-2xl font-semibold",children:[e," ",t]}),L.jsxs("p",{className:"text-muted-foreground",children:[i,"  ",a]})]}),L.jsx(cf,{to:"/bookings",className:"bg-white/90 backdrop-blur-sm p-2 rounded-full shadow-lg hover:bg-white transition-colors",children:L.jsx(Hz,{className:"h-5 w-5 text-primary"})})]})}),zne=({pricePerDay:e,transmission:t,seats:i})=>L.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[L.jsxs("div",{className:"p-4 bg-muted rounded-lg text-center",children:[L.jsxs("p",{className:"font-semibold",children:["BWP ",e]}),L.jsx("p",{className:"text-muted-foreground",children:"per day"})]}),L.jsxs("div",{className:"p-4 bg-muted rounded-lg text-center",children:[L.jsx("p",{className:"font-semibold",children:t}),L.jsx("p",{className:"text-muted-foreground",children:"transmission"})]}),L.jsxs("div",{className:"p-4 bg-muted rounded-lg text-center",children:[L.jsx("p",{className:"font-semibold",children:i}),L.jsx("p",{className:"text-muted-foreground",children:"seats"})]})]}),Nne=({ownerName:e,avatarUrl:t,ownerId:i,carId:a})=>{const[d,_]=Y.useState(!1);return L.jsxs(L.Fragment,{children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center gap-3",children:[L.jsx("img",{src:t,alt:e||"Car Owner",className:"w-12 h-12 rounded-full object-cover bg-muted"}),L.jsxs("div",{children:[L.jsx("p",{className:"font-semibold",children:e||"Car Owner"}),L.jsx("p",{className:"text-sm text-muted-foreground",children:"Car Owner"})]})]}),L.jsxs(on,{className:"gap-2",onClick:()=>_(!0),children:[L.jsx(KG,{className:"h-4 w-4"}),"Contact Owner"]})]}),L.jsx(fB,{isOpen:d,onClose:()=>_(!1),receiverId:i,receiverName:e,carId:a})]})},Fne=({description:e})=>e?L.jsxs("div",{children:[L.jsx("h2",{className:"font-semibold mb-2",children:"Description"}),L.jsx("p",{className:"text-muted-foreground",children:e})]}):null;function jne(e){return Object.prototype.toString.call(e)==="[object Object]"}function D4(e){return jne(e)||Array.isArray(e)}function Bne(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function mP(e,t){const i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;const d=JSON.stringify(Object.keys(e.breakpoints||{})),_=JSON.stringify(Object.keys(t.breakpoints||{}));return d!==_?!1:i.every(b=>{const o=e[b],k=t[b];return typeof o=="function"?`${o}`==`${k}`:!D4(o)||!D4(k)?o===k:mP(o,k)})}function L4(e){return e.concat().sort((t,i)=>t.name>i.name?1:-1).map(t=>t.options)}function Une(e,t){if(e.length!==t.length)return!1;const i=L4(e),a=L4(t);return i.every((d,_)=>{const b=a[_];return mP(d,b)})}function gP(e){return typeof e=="number"}function e3(e){return typeof e=="string"}function e2(e){return typeof e=="boolean"}function O4(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ni(e){return Math.abs(e)}function _P(e){return Math.sign(e)}function i0(e,t){return Ni(e-t)}function Vne(e,t){if(e===0||t===0||Ni(e)<=Ni(t))return 0;const i=i0(Ni(e),Ni(t));return Ni(i/e)}function L0(e){return O0(e).map(Number)}function _l(e){return e[fv(e)]}function fv(e){return Math.max(0,e.length-1)}function yP(e,t){return t===fv(e)}function z4(e,t=0){return Array.from(Array(e),(i,a)=>t+a)}function O0(e){return Object.keys(e)}function AB(e,t){return[e,t].reduce((i,a)=>(O0(a).forEach(d=>{const _=i[d],b=a[d],o=O4(_)&&O4(b);i[d]=o?AB(_,b):b}),i),{})}function t3(e,t){return typeof t.MouseEvent<"u"&&e instanceof t.MouseEvent}function $ne(e,t){const i={start:a,center:d,end:_};function a(){return 0}function d(k){return _(k)/2}function _(k){return t-k}function b(k,O){return e3(e)?i[e](k):e(t,k,O)}return{measure:b}}function z0(){let e=[];function t(d,_,b,o={passive:!0}){let k;if("addEventListener"in d)d.addEventListener(_,b,o),k=()=>d.removeEventListener(_,b,o);else{const O=d;O.addListener(b),k=()=>O.removeListener(b)}return e.push(k),a}function i(){e=e.filter(d=>d())}const a={add:t,clear:i};return a}function Gne(e,t,i,a){const d=z0(),_=1e3/60;let b=null,o=0,k=0;function O(){d.add(e,"visibilitychange",()=>{e.hidden&&J()})}function z(){ee(),d.clear()}function F(oe){if(!k)return;b||(b=oe);const X=oe-b;for(b=oe,o+=X;o>=_;)i(_),o-=_;const Q=o/_;a(Q),k&&t.requestAnimationFrame(F)}function G(){k||(k=t.requestAnimationFrame(F))}function ee(){t.cancelAnimationFrame(k),b=null,o=0,k=0}function J(){b=null,o=0}return{init:O,destroy:z,start:G,stop:ee,update:()=>i(_),render:a}}function Hne(e,t){const i=t==="rtl",a=e==="y",d=a?"y":"x",_=a?"x":"y",b=!a&&i?-1:1,o=z(),k=F();function O(J){const{height:te,width:oe}=J;return a?te:oe}function z(){return a?"top":i?"right":"left"}function F(){return a?"bottom":i?"left":"right"}function G(J){return J*b}return{scroll:d,cross:_,startEdge:o,endEdge:k,measureSize:O,direction:G}}function Mf(e=0,t=0){const i=Ni(e-t);function a(O){return O<e}function d(O){return O>t}function _(O){return a(O)||d(O)}function b(O){return _(O)?a(O)?e:t:O}function o(O){return i?O-i*Math.ceil((O-t)/i):O}return{length:i,max:t,min:e,constrain:b,reachedAny:_,reachedMax:d,reachedMin:a,removeOffset:o}}function IB(e,t,i){const{constrain:a}=Mf(0,e),d=e+1;let _=b(t);function b(G){return i?Ni((d+G)%d):a(G)}function o(){return _}function k(G){return _=b(G),F}function O(G){return z().set(o()+G)}function z(){return IB(e,o(),i)}const F={get:o,set:k,add:O,clone:z};return F}function qne(e,t,i,a,d,_,b,o,k,O,z,F,G,ee,J,te,oe,X,Q){const{cross:ue,direction:he}=e,Ie=["INPUT","SELECT","TEXTAREA"],Je={passive:!1},Ce=z0(),Ze=z0(),et=Mf(50,225).constrain(ee.measure(20)),Ge={mouse:300,touch:400},qe={mouse:500,touch:600},_t=J?43:25;let Rt=!1,Wt=0,wt=0,jt=!1,Ct=!1,st=!1,yt=!1;function ir(Yt){if(!Q)return;function tr(Mn){(e2(Q)||Q(Yt,Mn))&&sn(Mn)}const vt=t;Ce.add(vt,"dragstart",Mn=>Mn.preventDefault(),Je).add(vt,"touchmove",()=>{},Je).add(vt,"touchend",()=>{}).add(vt,"touchstart",tr).add(vt,"mousedown",tr).add(vt,"touchcancel",Lr).add(vt,"contextmenu",Lr).add(vt,"click",cn,!0)}function yr(){Ce.clear(),Ze.clear()}function Wr(){const Yt=yt?i:t;Ze.add(Yt,"touchmove",cr,Je).add(Yt,"touchend",Lr).add(Yt,"mousemove",cr,Je).add(Yt,"mouseup",Lr)}function rr(Yt){const tr=Yt.nodeName||"";return Ie.includes(tr)}function dn(){return(J?qe:Ge)[yt?"mouse":"touch"]}function Dn(Yt,tr){const vt=F.add(_P(Yt)*-1),Mn=z.byDistance(Yt,!J).distance;return J||Ni(Yt)<et?Mn:oe&&tr?Mn*.5:z.byIndex(vt.get(),0).distance}function sn(Yt){const tr=t3(Yt,a);yt=tr,st=J&&tr&&!Yt.buttons&&Rt,Rt=i0(d.get(),b.get())>=2,!(tr&&Yt.button!==0)&&(rr(Yt.target)||(jt=!0,_.pointerDown(Yt),O.useFriction(0).useDuration(0),d.set(b),Wr(),Wt=_.readPoint(Yt),wt=_.readPoint(Yt,ue),G.emit("pointerDown")))}function cr(Yt){if(!t3(Yt,a)&&Yt.touches.length>=2)return Lr(Yt);const vt=_.readPoint(Yt),Mn=_.readPoint(Yt,ue),hn=i0(vt,Wt),ei=i0(Mn,wt);if(!Ct&&!yt&&(!Yt.cancelable||(Ct=hn>ei,!Ct)))return Lr(Yt);const je=_.pointerMove(Yt);hn>te&&(st=!0),O.useFriction(.3).useDuration(.75),o.start(),d.add(he(je)),Yt.preventDefault()}function Lr(Yt){const vt=z.byDistance(0,!1).index!==F.get(),Mn=_.pointerUp(Yt)*dn(),hn=Dn(he(Mn),vt),ei=Vne(Mn,hn),je=_t-10*ei,dt=X+ei/50;Ct=!1,jt=!1,Ze.clear(),O.useDuration(je).useFriction(dt),k.distance(hn,!J),yt=!1,G.emit("pointerUp")}function cn(Yt){st&&(Yt.stopPropagation(),Yt.preventDefault(),st=!1)}function Me(){return jt}return{init:ir,destroy:yr,pointerDown:Me}}function Wne(e,t){let a,d;function _(F){return F.timeStamp}function b(F,G){const J=`client${(G||e.scroll)==="x"?"X":"Y"}`;return(t3(F,t)?F:F.touches[0])[J]}function o(F){return a=F,d=F,b(F)}function k(F){const G=b(F)-b(d),ee=_(F)-_(a)>170;return d=F,ee&&(a=F),G}function O(F){if(!a||!d)return 0;const G=b(d)-b(a),ee=_(F)-_(a),J=_(F)-_(d)>170,te=G/ee;return ee&&!J&&Ni(te)>.1?te:0}return{pointerDown:o,pointerMove:k,pointerUp:O,readPoint:b}}function Zne(){function e(i){const{offsetTop:a,offsetLeft:d,offsetWidth:_,offsetHeight:b}=i;return{top:a,right:d+_,bottom:a+b,left:d,width:_,height:b}}return{measure:e}}function Yne(e){function t(a){return e*(a/100)}return{measure:t}}function Xne(e,t,i,a,d,_,b){const o=[e].concat(a);let k,O,z=[],F=!1;function G(oe){return d.measureSize(b.measure(oe))}function ee(oe){if(!_)return;O=G(e),z=a.map(G);function X(Q){for(const ue of Q){if(F)return;const he=ue.target===e,Ie=a.indexOf(ue.target),Je=he?O:z[Ie],Ce=G(he?e:a[Ie]);if(Ni(Ce-Je)>=.5){oe.reInit(),t.emit("resize");break}}}k=new ResizeObserver(Q=>{(e2(_)||_(oe,Q))&&X(Q)}),i.requestAnimationFrame(()=>{o.forEach(Q=>k.observe(Q))})}function J(){F=!0,k&&k.disconnect()}return{init:ee,destroy:J}}function Kne(e,t,i,a,d,_){let b=0,o=0,k=d,O=_,z=e.get(),F=0;function G(Je){const Ce=Je/1e3,Ze=k*Ce,et=a.get()-e.get(),Ge=!k;let qe=0;return Ge?(b=0,i.set(a),e.set(a),qe=et):(i.set(e),b+=et/Ze,b*=O,z+=b,e.add(b*Ce),qe=z-F),o=_P(qe),F=z,Ie}function ee(){const Je=a.get()-t.get();return Ni(Je)<.001}function J(){return k}function te(){return o}function oe(){return b}function X(){return ue(d)}function Q(){return he(_)}function ue(Je){return k=Je,Ie}function he(Je){return O=Je,Ie}const Ie={direction:te,duration:J,velocity:oe,seek:G,settled:ee,useBaseFriction:Q,useBaseDuration:X,useFriction:he,useDuration:ue};return Ie}function Jne(e,t,i,a,d){const _=d.measure(10),b=d.measure(50),o=Mf(.1,.99);let k=!1;function O(){return!(k||!e.reachedAny(i.get())||!e.reachedAny(t.get()))}function z(ee){if(!O())return;const J=e.reachedMin(t.get())?"min":"max",te=Ni(e[J]-t.get()),oe=i.get()-t.get(),X=o.constrain(te/b);i.subtract(oe*X),!ee&&Ni(oe)<_&&(i.set(e.constrain(i.get())),a.useDuration(25).useBaseFriction())}function F(ee){k=!ee}return{shouldConstrain:O,constrain:z,toggleActive:F}}function Qne(e,t,i,a,d){const _=Mf(-t+e,0),b=F(),o=z(),k=G();function O(J,te){return i0(J,te)<1}function z(){const J=b[0],te=_l(b),oe=b.lastIndexOf(J),X=b.indexOf(te)+1;return Mf(oe,X)}function F(){return i.map((J,te)=>{const{min:oe,max:X}=_,Q=_.constrain(J),ue=!te,he=yP(i,te);return ue?X:he||O(oe,Q)?oe:O(X,Q)?X:Q}).map(J=>parseFloat(J.toFixed(3)))}function G(){if(t<=e+d)return[_.max];if(a==="keepSnaps")return b;const{min:J,max:te}=o;return b.slice(J,te)}return{snapsContained:k,scrollContainLimit:o}}function eie(e,t,i){const a=t[0],d=i?a-e:_l(t);return{limit:Mf(d,a)}}function tie(e,t,i,a){const _=t.min+.1,b=t.max+.1,{reachedMin:o,reachedMax:k}=Mf(_,b);function O(G){return G===1?k(i.get()):G===-1?o(i.get()):!1}function z(G){if(!O(G))return;const ee=e*(G*-1);a.forEach(J=>J.add(ee))}return{loop:z}}function rie(e){const{max:t,length:i}=e;function a(_){const b=_-t;return i?b/-i:0}return{get:a}}function nie(e,t,i,a,d){const{startEdge:_,endEdge:b}=e,{groupSlides:o}=d,k=F().map(t.measure),O=G(),z=ee();function F(){return o(a).map(te=>_l(te)[b]-te[0][_]).map(Ni)}function G(){return a.map(te=>i[_]-te[_]).map(te=>-Ni(te))}function ee(){return o(O).map(te=>te[0]).map((te,oe)=>te+k[oe])}return{snaps:O,snapsAligned:z}}function iie(e,t,i,a,d,_){const{groupSlides:b}=d,{min:o,max:k}=a,O=z();function z(){const G=b(_),ee=!e||t==="keepSnaps";return i.length===1?[_]:ee?G:G.slice(o,k).map((J,te,oe)=>{const X=!te,Q=yP(oe,te);if(X){const ue=_l(oe[0])+1;return z4(ue)}if(Q){const ue=fv(_)-_l(oe)[0]+1;return z4(ue,_l(oe)[0])}return J})}return{slideRegistry:O}}function oie(e,t,i,a,d){const{reachedAny:_,removeOffset:b,constrain:o}=a;function k(J){return J.concat().sort((te,oe)=>Ni(te)-Ni(oe))[0]}function O(J){const te=e?b(J):o(J),oe=t.map((Q,ue)=>({diff:z(Q-te,0),index:ue})).sort((Q,ue)=>Ni(Q.diff)-Ni(ue.diff)),{index:X}=oe[0];return{index:X,distance:te}}function z(J,te){const oe=[J,J+i,J-i];if(!e)return J;if(!te)return k(oe);const X=oe.filter(Q=>_P(Q)===te);return X.length?k(X):_l(oe)-i}function F(J,te){const oe=t[J]-d.get(),X=z(oe,te);return{index:J,distance:X}}function G(J,te){const oe=d.get()+J,{index:X,distance:Q}=O(oe),ue=!e&&_(oe);if(!te||ue)return{index:X,distance:J};const he=t[X]-Q,Ie=J+z(he,0);return{index:X,distance:Ie}}return{byDistance:G,byIndex:F,shortcut:z}}function sie(e,t,i,a,d,_,b){function o(F){const G=F.distance,ee=F.index!==t.get();_.add(G),G&&(a.duration()?e.start():(e.update(),e.render(1),e.update())),ee&&(i.set(t.get()),t.set(F.index),b.emit("select"))}function k(F,G){const ee=d.byDistance(F,G);o(ee)}function O(F,G){const ee=t.clone().set(F),J=d.byIndex(ee.get(),G);o(J)}return{distance:k,index:O}}function aie(e,t,i,a,d,_,b,o){const k={passive:!0,capture:!0};let O=0;function z(ee){if(!o)return;function J(te){if(new Date().getTime()-O>10)return;b.emit("slideFocusStart"),e.scrollLeft=0;const Q=i.findIndex(ue=>ue.includes(te));gP(Q)&&(d.useDuration(0),a.index(Q,0),b.emit("slideFocus"))}_.add(document,"keydown",F,!1),t.forEach((te,oe)=>{_.add(te,"focus",X=>{(e2(o)||o(ee,X))&&J(oe)},k)})}function F(ee){ee.code==="Tab"&&(O=new Date().getTime())}return{init:z}}function $y(e){let t=e;function i(){return t}function a(k){t=b(k)}function d(k){t+=b(k)}function _(k){t-=b(k)}function b(k){return gP(k)?k:k.get()}return{get:i,set:a,add:d,subtract:_}}function kB(e,t){const i=e.scroll==="x"?_:b,a=t.style;let d=!1;function _(F){return`translate3d(${F}px,0px,0px)`}function b(F){return`translate3d(0px,${F}px,0px)`}function o(F){d||(a.transform=i(e.direction(F)))}function k(F){d=!F}function O(){d||(a.transform="",t.getAttribute("style")||t.removeAttribute("style"))}return{clear:O,to:o,toggleActive:k}}function lie(e,t,i,a,d,_,b,o,k){const z=L0(d),F=L0(d).reverse(),G=X().concat(Q());function ee(Ce,Ze){return Ce.reduce((et,Ge)=>et-d[Ge],Ze)}function J(Ce,Ze){return Ce.reduce((et,Ge)=>ee(et,Ze)>0?et.concat([Ge]):et,[])}function te(Ce){return _.map((Ze,et)=>({start:Ze-a[et]+.5+Ce,end:Ze+t-.5+Ce}))}function oe(Ce,Ze,et){const Ge=te(Ze);return Ce.map(qe=>{const _t=et?0:-i,Rt=et?i:0,Wt=et?"end":"start",wt=Ge[qe][Wt];return{index:qe,loopPoint:wt,slideLocation:$y(-1),translate:kB(e,k[qe]),target:()=>o.get()>wt?_t:Rt}})}function X(){const Ce=b[0],Ze=J(F,Ce);return oe(Ze,i,!1)}function Q(){const Ce=t-b[0]-1,Ze=J(z,Ce);return oe(Ze,-i,!0)}function ue(){return G.every(({index:Ce})=>{const Ze=z.filter(et=>et!==Ce);return ee(Ze,t)<=.1})}function he(){G.forEach(Ce=>{const{target:Ze,translate:et,slideLocation:Ge}=Ce,qe=Ze();qe!==Ge.get()&&(et.to(qe),Ge.set(qe))})}function Ie(){G.forEach(Ce=>Ce.translate.clear())}return{canLoop:ue,clear:Ie,loop:he,loopPoints:G}}function cie(e,t,i){let a,d=!1;function _(k){if(!i)return;function O(z){for(const F of z)if(F.type==="childList"){k.reInit(),t.emit("slidesChanged");break}}a=new MutationObserver(z=>{d||(e2(i)||i(k,z))&&O(z)}),a.observe(e,{childList:!0})}function b(){a&&a.disconnect(),d=!0}return{init:_,destroy:b}}function uie(e,t,i,a){const d={};let _=null,b=null,o,k=!1;function O(){o=new IntersectionObserver(J=>{k||(J.forEach(te=>{const oe=t.indexOf(te.target);d[oe]=te}),_=null,b=null,i.emit("slidesInView"))},{root:e.parentElement,threshold:a}),t.forEach(J=>o.observe(J))}function z(){o&&o.disconnect(),k=!0}function F(J){return O0(d).reduce((te,oe)=>{const X=parseInt(oe),{isIntersecting:Q}=d[X];return(J&&Q||!J&&!Q)&&te.push(X),te},[])}function G(J=!0){if(J&&_)return _;if(!J&&b)return b;const te=F(J);return J&&(_=te),J||(b=te),te}return{init:O,destroy:z,get:G}}function die(e,t,i,a,d,_){const{measureSize:b,startEdge:o,endEdge:k}=e,O=i[0]&&d,z=J(),F=te(),G=i.map(b),ee=oe();function J(){if(!O)return 0;const Q=i[0];return Ni(t[o]-Q[o])}function te(){if(!O)return 0;const Q=_.getComputedStyle(_l(a));return parseFloat(Q.getPropertyValue(`margin-${k}`))}function oe(){return i.map((Q,ue,he)=>{const Ie=!ue,Je=yP(he,ue);return Ie?G[ue]+z:Je?G[ue]+F:he[ue+1][o]-Q[o]}).map(Ni)}return{slideSizes:G,slideSizesWithGaps:ee,startGap:z,endGap:F}}function hie(e,t,i,a,d,_,b,o,k){const{startEdge:O,endEdge:z,direction:F}=e,G=gP(i);function ee(X,Q){return L0(X).filter(ue=>ue%Q===0).map(ue=>X.slice(ue,ue+Q))}function J(X){return X.length?L0(X).reduce((Q,ue,he)=>{const Ie=_l(Q)||0,Je=Ie===0,Ce=ue===fv(X),Ze=d[O]-_[Ie][O],et=d[O]-_[ue][z],Ge=!a&&Je?F(b):0,qe=!a&&Ce?F(o):0,_t=Ni(et-qe-(Ze+Ge));return he&&_t>t+k&&Q.push(ue),Ce&&Q.push(X.length),Q},[]).map((Q,ue,he)=>{const Ie=Math.max(he[ue-1]||0);return X.slice(Ie,Q)}):[]}function te(X){return G?ee(X,i):J(X)}return{groupSlides:te}}function fie(e,t,i,a,d,_,b){const{align:o,axis:k,direction:O,startIndex:z,loop:F,duration:G,dragFree:ee,dragThreshold:J,inViewThreshold:te,slidesToScroll:oe,skipSnaps:X,containScroll:Q,watchResize:ue,watchSlides:he,watchDrag:Ie,watchFocus:Je}=_,Ce=2,Ze=Zne(),et=Ze.measure(t),Ge=i.map(Ze.measure),qe=Hne(k,O),_t=qe.measureSize(et),Rt=Yne(_t),Wt=$ne(o,_t),wt=!F&&!!Q,jt=F||!!Q,{slideSizes:Ct,slideSizesWithGaps:st,startGap:yt,endGap:ir}=die(qe,et,Ge,i,jt,d),yr=hie(qe,_t,oe,F,et,Ge,yt,ir,Ce),{snaps:Wr,snapsAligned:rr}=nie(qe,Wt,et,Ge,yr),dn=-_l(Wr)+_l(st),{snapsContained:Dn,scrollContainLimit:sn}=Qne(_t,dn,rr,Q,Ce),cr=wt?Dn:rr,{limit:Lr}=eie(dn,cr,F),cn=IB(fv(cr),z,F),Me=cn.clone(),fr=L0(i),Yt=({dragHandler:Ui,scrollBody:Zi,scrollBounds:Lo,options:{loop:Yi}},Oo)=>{Yi||Lo.constrain(Ui.pointerDown()),Zi.seek(Oo)},tr=({scrollBody:Ui,translate:Zi,location:Lo,offsetLocation:Yi,scrollLooper:Oo,slideLooper:ss,dragHandler:To,animation:La,eventHandler:Gt,scrollBounds:un,options:{loop:Fn}},nn)=>{const mn=Ui.settled(),Vi=!un.shouldConstrain(),fi=Fn?mn:mn&&Vi;fi&&!To.pointerDown()&&(La.stop(),Gt.emit("settle")),fi||Gt.emit("scroll");const Pi=Lo.get()*nn+je.get()*(1-nn);Yi.set(Pi),Fn&&(Oo.loop(Ui.direction()),ss.loop()),Zi.to(Yi.get())},vt=Gne(a,d,Ui=>Yt(Mi,Ui),Ui=>tr(Mi,Ui)),Mn=.68,hn=cr[cn.get()],ei=$y(hn),je=$y(hn),dt=$y(hn),St=$y(hn),or=Kne(ei,dt,je,St,G,Mn),Kt=oie(F,cr,dn,Lr,St),Xt=sie(vt,cn,Me,or,Kt,St,b),Ot=rie(Lr),Ur=z0(),$n=uie(t,i,b,te),{slideRegistry:Ln}=iie(wt,Q,cr,sn,yr,fr),Xn=aie(e,i,Ln,Xt,or,Ur,b,Je),Mi={ownerDocument:a,ownerWindow:d,eventHandler:b,containerRect:et,slideRects:Ge,animation:vt,axis:qe,dragHandler:qne(qe,e,a,d,St,Wne(qe,d),ei,vt,Xt,or,Kt,cn,b,Rt,ee,J,X,Mn,Ie),eventStore:Ur,percentOfView:Rt,index:cn,indexPrevious:Me,limit:Lr,location:ei,offsetLocation:dt,previousLocation:je,options:_,resizeHandler:Xne(t,b,d,i,qe,ue,Ze),scrollBody:or,scrollBounds:Jne(Lr,dt,St,or,Rt),scrollLooper:tie(dn,Lr,dt,[ei,dt,je,St]),scrollProgress:Ot,scrollSnapList:cr.map(Ot.get),scrollSnaps:cr,scrollTarget:Kt,scrollTo:Xt,slideLooper:lie(qe,_t,dn,Ct,st,Wr,cr,dt,i),slideFocus:Xn,slidesHandler:cie(t,b,he),slidesInView:$n,slideIndexes:fr,slideRegistry:Ln,slidesToScroll:yr,target:St,translate:kB(qe,t)};return Mi}function pie(){let e={},t;function i(O){t=O}function a(O){return e[O]||[]}function d(O){return a(O).forEach(z=>z(t,O)),k}function _(O,z){return e[O]=a(O).concat([z]),k}function b(O,z){return e[O]=a(O).filter(F=>F!==z),k}function o(){e={}}const k={init:i,emit:d,off:b,on:_,clear:o};return k}const mie={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function gie(e){function t(_,b){return AB(_,b||{})}function i(_){const b=_.breakpoints||{},o=O0(b).filter(k=>e.matchMedia(k).matches).map(k=>b[k]).reduce((k,O)=>t(k,O),{});return t(_,o)}function a(_){return _.map(b=>O0(b.breakpoints||{})).reduce((b,o)=>b.concat(o),[]).map(e.matchMedia)}return{mergeOptions:t,optionsAtMedia:i,optionsMediaQueries:a}}function _ie(e){let t=[];function i(_,b){return t=b.filter(({options:o})=>e.optionsAtMedia(o).active!==!1),t.forEach(o=>o.init(_,e)),b.reduce((o,k)=>Object.assign(o,{[k.name]:k}),{})}function a(){t=t.filter(_=>_.destroy())}return{init:i,destroy:a}}function rw(e,t,i){const a=e.ownerDocument,d=a.defaultView,_=gie(d),b=_ie(_),o=z0(),k=pie(),{mergeOptions:O,optionsAtMedia:z,optionsMediaQueries:F}=_,{on:G,off:ee,emit:J}=k,te=qe;let oe=!1,X,Q=O(mie,rw.globalOptions),ue=O(Q),he=[],Ie,Je,Ce;function Ze(){const{container:fr,slides:Yt}=ue;Je=(e3(fr)?e.querySelector(fr):fr)||e.children[0];const vt=e3(Yt)?Je.querySelectorAll(Yt):Yt;Ce=[].slice.call(vt||Je.children)}function et(fr){const Yt=fie(e,Je,Ce,a,d,fr,k);if(fr.loop&&!Yt.slideLooper.canLoop()){const tr=Object.assign({},fr,{loop:!1});return et(tr)}return Yt}function Ge(fr,Yt){oe||(Q=O(Q,fr),ue=z(Q),he=Yt||he,Ze(),X=et(ue),F([Q,...he.map(({options:tr})=>tr)]).forEach(tr=>o.add(tr,"change",qe)),ue.active&&(X.translate.to(X.location.get()),X.animation.init(),X.slidesInView.init(),X.slideFocus.init(Me),X.eventHandler.init(Me),X.resizeHandler.init(Me),X.slidesHandler.init(Me),X.options.loop&&X.slideLooper.loop(),Je.offsetParent&&Ce.length&&X.dragHandler.init(Me),Ie=b.init(Me,he)))}function qe(fr,Yt){const tr=yr();_t(),Ge(O({startIndex:tr},fr),Yt),k.emit("reInit")}function _t(){X.dragHandler.destroy(),X.eventStore.clear(),X.translate.clear(),X.slideLooper.clear(),X.resizeHandler.destroy(),X.slidesHandler.destroy(),X.slidesInView.destroy(),X.animation.destroy(),b.destroy(),o.clear()}function Rt(){oe||(oe=!0,o.clear(),_t(),k.emit("destroy"),k.clear())}function Wt(fr,Yt,tr){!ue.active||oe||(X.scrollBody.useBaseFriction().useDuration(Yt===!0?0:ue.duration),X.scrollTo.index(fr,tr||0))}function wt(fr){const Yt=X.index.add(1).get();Wt(Yt,fr,-1)}function jt(fr){const Yt=X.index.add(-1).get();Wt(Yt,fr,1)}function Ct(){return X.index.add(1).get()!==yr()}function st(){return X.index.add(-1).get()!==yr()}function yt(){return X.scrollSnapList}function ir(){return X.scrollProgress.get(X.location.get())}function yr(){return X.index.get()}function Wr(){return X.indexPrevious.get()}function rr(){return X.slidesInView.get()}function dn(){return X.slidesInView.get(!1)}function Dn(){return Ie}function sn(){return X}function cr(){return e}function Lr(){return Je}function cn(){return Ce}const Me={canScrollNext:Ct,canScrollPrev:st,containerNode:Lr,internalEngine:sn,destroy:Rt,off:ee,on:G,emit:J,plugins:Dn,previousScrollSnap:Wr,reInit:te,rootNode:cr,scrollNext:wt,scrollPrev:jt,scrollProgress:ir,scrollSnapList:yt,scrollTo:Wt,selectedScrollSnap:yr,slideNodes:cn,slidesInView:rr,slidesNotInView:dn};return Ge(t,i),setTimeout(()=>k.emit("init"),0),Me}rw.globalOptions=void 0;function vP(e={},t=[]){const i=Y.useRef(e),a=Y.useRef(t),[d,_]=Y.useState(),[b,o]=Y.useState(),k=Y.useCallback(()=>{d&&d.reInit(i.current,a.current)},[d]);return Y.useEffect(()=>{mP(i.current,e)||(i.current=e,k())},[e,k]),Y.useEffect(()=>{Une(a.current,t)||(a.current=t,k())},[t,k]),Y.useEffect(()=>{if(Bne()&&b){rw.globalOptions=vP.globalOptions;const O=rw(b,i.current,a.current);return _(O),()=>O.destroy()}else _(void 0)},[b,_]),[o,d]}vP.globalOptions=void 0;const RB=Y.createContext(null);function t2(){const e=Y.useContext(RB);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}const DB=Y.forwardRef(({orientation:e="horizontal",opts:t,setApi:i,plugins:a,className:d,children:_,...b},o)=>{const[k,O]=vP({...t,axis:e==="horizontal"?"x":"y"},a),[z,F]=Y.useState(!1),[G,ee]=Y.useState(!1),J=Y.useCallback(Q=>{Q&&(F(Q.canScrollPrev()),ee(Q.canScrollNext()))},[]),te=Y.useCallback(()=>{O==null||O.scrollPrev()},[O]),oe=Y.useCallback(()=>{O==null||O.scrollNext()},[O]),X=Y.useCallback(Q=>{Q.key==="ArrowLeft"?(Q.preventDefault(),te()):Q.key==="ArrowRight"&&(Q.preventDefault(),oe())},[te,oe]);return Y.useEffect(()=>{!O||!i||i(O)},[O,i]),Y.useEffect(()=>{if(O)return J(O),O.on("reInit",J),O.on("select",J),()=>{O==null||O.off("select",J)}},[O,J]),L.jsx(RB.Provider,{value:{carouselRef:k,api:O,opts:t,orientation:e||((t==null?void 0:t.axis)==="y"?"vertical":"horizontal"),scrollPrev:te,scrollNext:oe,canScrollPrev:z,canScrollNext:G},children:L.jsx("div",{ref:o,onKeyDownCapture:X,className:_r("relative",d),role:"region","aria-roledescription":"carousel",...b,children:_})})});DB.displayName="Carousel";const LB=Y.forwardRef(({className:e,...t},i)=>{const{carouselRef:a,orientation:d}=t2();return L.jsx("div",{ref:a,className:"overflow-hidden",children:L.jsx("div",{ref:i,className:_r("flex",d==="horizontal"?"-ml-4":"-mt-4 flex-col",e),...t})})});LB.displayName="CarouselContent";const OB=Y.forwardRef(({className:e,...t},i)=>{const{orientation:a}=t2();return L.jsx("div",{ref:i,role:"group","aria-roledescription":"slide",className:_r("min-w-0 shrink-0 grow-0 basis-full",a==="horizontal"?"pl-4":"pt-4",e),...t})});OB.displayName="CarouselItem";const zB=Y.forwardRef(({className:e,variant:t="outline",size:i="icon",...a},d)=>{const{orientation:_,scrollPrev:b,canScrollPrev:o}=t2();return L.jsxs(on,{ref:d,variant:t,size:i,className:_r("absolute  h-8 w-8 rounded-full",_==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!o,onClick:b,...a,children:[L.jsx(Z0,{className:"h-4 w-4"}),L.jsx("span",{className:"sr-only",children:"Previous slide"})]})});zB.displayName="CarouselPrevious";const NB=Y.forwardRef(({className:e,variant:t="outline",size:i="icon",...a},d)=>{const{orientation:_,scrollNext:b,canScrollNext:o}=t2();return L.jsxs(on,{ref:d,variant:t,size:i,className:_r("absolute h-8 w-8 rounded-full",_==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!o,onClick:b,...a,children:[L.jsx($z,{className:"h-4 w-4"}),L.jsx("span",{className:"sr-only",children:"Next slide"})]})});NB.displayName="CarouselNext";const yie=({carId:e,mainImageUrl:t})=>{const{data:i,isLoading:a}=Ro({queryKey:["car-images",e],queryFn:async()=>{console.log("Fetching images for car:",e);const{data:d,error:_}=await Qt.from("car_images").select("*").eq("car_id",e);if(_)throw console.error("Error fetching car images:",_),_;const b=t?[{id:"main",image_url:t},...d||[]]:d||[];return console.log("Retrieved images:",b),b}});return a?L.jsx(oo,{className:"w-full h-64 rounded-lg"}):i!=null&&i.length?L.jsxs(DB,{className:"w-full",children:[L.jsx(LB,{children:i.map(d=>L.jsx(OB,{children:L.jsx("img",{src:d.image_url,alt:"Car",className:"w-full h-64 object-cover rounded-lg"})},d.id))}),L.jsx(zB,{className:"left-2"}),L.jsx(NB,{className:"right-2"})]}):L.jsx("div",{className:"w-full h-64 bg-muted rounded-lg flex items-center justify-center",children:L.jsx("p",{className:"text-muted-foreground",children:"No images available"})})},vie=({car:e})=>{const[t,i]=Y.useState(!1),[a,d]=Y.useState(0),[_,b]=Y.useState(""),{toast:o}=Tl(),{data:k,isLoading:O}=Ro({queryKey:["car-reviews",e.id],queryFn:async()=>{console.log("Fetching reviews for car:",e.id);const{data:F,error:G}=await Qt.from("reviews").select(`
          *,
          reviewer:profiles!reviewer_id (
            full_name,
            avatar_url
          )
        `).eq("car_id",e.id).eq("review_type","car").order("created_at",{ascending:!1});if(G)throw console.error("Error fetching reviews:",G),G;return console.log("Retrieved reviews:",F),F}}),z=async()=>{try{const{data:{session:F}}=await Qt.auth.getSession();if(!(F!=null&&F.user)){o({title:"Error",description:"You must be logged in to submit a review.",variant:"destructive"});return}const{data:G}=await Qt.from("bookings").select("id").eq("car_id",e.id).eq("renter_id",F.user.id).eq("status","completed").order("end_date",{ascending:!1}).limit(1).single();if(!G){o({title:"Error",description:"You can only review cars after completing a booking.",variant:"destructive"});return}const ee=new Date().toISOString(),{error:J}=await Qt.from("reviews").insert({car_id:e.id,reviewer_id:F.user.id,reviewee_id:e.owner_id,booking_id:G.id,rating:a,comment:_,review_type:"car",created_at:ee,updated_at:ee});if(J)throw J;o({title:"Review submitted",description:"Thank you for your feedback!"}),i(!1),d(0),b("")}catch(F){console.error("Error submitting review:",F),o({title:"Error",description:"Could not submit the review. Please try again.",variant:"destructive"})}};return O?L.jsx("div",{children:"Loading reviews..."}):L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsx("h2",{className:"font-semibold",children:"Reviews"}),L.jsxs(UF,{open:t,onOpenChange:i,children:[L.jsx(BQ,{asChild:!0,children:L.jsx(on,{variant:"outline",children:"Write a Review"})}),L.jsxs(ZM,{children:[L.jsx(YM,{children:L.jsx(XM,{children:"Write a Review"})}),L.jsxs("div",{className:"space-y-4",children:[L.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(F=>L.jsx(on,{variant:"ghost",size:"sm",className:F<=a?"text-yellow-500":"",onClick:()=>d(F),children:L.jsx(bC,{className:"h-5 w-5"})},F))}),L.jsx(Jw,{placeholder:"Share your experience...",value:_,onChange:F=>b(F.target.value)}),L.jsx(on,{onClick:z,disabled:a===0,children:"Submit Review"})]})]})]})]}),L.jsxs("div",{className:"space-y-4",children:[k==null?void 0:k.map(F=>L.jsxs("div",{className:"border rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[L.jsx("div",{className:"flex gap-0.5",children:Array.from({length:F.rating}).map((G,ee)=>L.jsx(bC,{className:"h-4 w-4 text-yellow-500",fill:"currentColor"},ee))}),L.jsxs("span",{className:"text-sm text-muted-foreground",children:["by ",F.reviewer.full_name]})]}),F.comment&&L.jsx("p",{className:"text-sm text-muted-foreground",children:F.comment})]},F.id)),(k==null?void 0:k.length)===0&&L.jsx("p",{className:"text-center text-muted-foreground",children:"No reviews yet"})]})]})},xie=({initialLatitude:e,initialLongitude:t,mapboxToken:i,isAdjusting:a})=>{const d=Y.useRef(null),_=Y.useRef(null),[b,o]=Y.useState(null),[k,O]=Y.useState(!1);return Y.useEffect(()=>{if(!i||!d.current){console.log("Missing map initialization requirements:",{hasToken:!!i,hasContainer:!!d.current});return}console.log("Initializing map with:",{initialLatitude:e,initialLongitude:t,hasToken:!!i});try{pf.accessToken=i;const z=new pf.Map({container:d.current,style:"mapbox://styles/mapbox/streets-v12",center:[t,e],zoom:15});_.current=z,z.on("load",()=>{console.log("Map loaded successfully"),O(!0)}),z.on("error",F=>{console.error("Map error:",F),Jn.error("Error loading map. Please try again.")}),z.addControl(new pf.NavigationControl,"top-right"),a&&z.on("click",F=>{console.log("Map clicked:",F.lngLat),o({lat:F.lngLat.lat,lng:F.lngLat.lng})})}catch(z){console.error("Error initializing map:",z),Jn.error("Failed to initialize map. Please check your connection and try again.")}return()=>{_.current&&(console.log("Cleaning up map instance"),_.current.remove(),_.current=null)}},[d,i,e,t,a]),{mapContainer:d,map:_,newCoordinates:b,setNewCoordinates:o,isMapLoaded:k}},bie=async(e,t,i)=>{console.log("Attempting to update car location:",{carId:e,latitude:t,longitude:i});try{const{error:a}=await Qt.from("cars").update({latitude:t,longitude:i,updated_at:new Date().toISOString()}).eq("id",e);return a?(console.error("Error updating car location:",a),a.code==="PGRST116"?Jn.error("You don't have permission to update this car's location"):Jn.error("Failed to update location"),!1):(console.log("Location update successful"),Jn.success("Location updated successfully"),!0)}catch(a){return console.error("Unexpected error updating location:",a),Jn.error("Failed to update location"),!1}},wie=()=>{const[e,t]=Y.useState(null),[i,a]=Y.useState(!0),[d,_]=Y.useState(null);return Y.useEffect(()=>{(async()=>{try{console.log("Starting Mapbox token fetch...");const{data:o,error:k}=await Qt.functions.invoke("get-mapbox-token");if(k){console.error("Error fetching token:",k),_(k.message),Jn.error("Failed to load map configuration");return}if(!(o!=null&&o.token)){console.log("No token found in response:",o),_("No Mapbox token found"),Jn.error("Map configuration is missing");return}console.log("Successfully retrieved Mapbox token"),t(o.token)}catch(o){console.error("Error in fetchToken:",o);const k=o instanceof Error?o.message:"Failed to fetch token";_(k),Jn.error("Failed to load map configuration")}finally{console.log("Token fetch completed"),a(!1)}})()},[]),{token:e,isLoading:i,error:d}},Sie=({latitude:e,longitude:t,location:i})=>{const[a,d]=Y.useState(!1),{id:_}=q0(),b=wg(),{token:o,isLoading:k}=wie(),{mapContainer:O,map:z,newCoordinates:F,setNewCoordinates:G,isMapLoaded:ee}=xie({initialLatitude:e||0,initialLongitude:t||0,mapboxToken:o,isAdjusting:a});MB(z==null?void 0:z.current);const J=()=>{d(!0),Jn.info("Click anywhere on the map to adjust the location. Click 'Save Location' when done.")},te=async()=>{if(!F||!_){console.log("Missing required data for location update:",{newCoordinates:F,carId:_}),Jn.error("Please select a new location first");return}console.log("Saving new location:",F),await bie(_,F.lat,F.lng)&&(console.log("Location update successful, invalidating queries"),await b.invalidateQueries({queryKey:["car",_]}),d(!1),G(null))};return k?(console.log("Loading token state:",{isTokenLoading:k,token:o}),L.jsx("div",{children:"Loading map configuration..."})):o?!e||!t?L.jsxs("div",{children:[L.jsx("h2",{className:"font-semibold mb-2",children:"Location"}),L.jsx("p",{className:"text-muted-foreground",children:i})]}):L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsx("h2",{className:"font-semibold",children:"Location"}),L.jsx("div",{className:"space-x-2",children:a?L.jsx(on,{variant:"default",size:"sm",onClick:te,children:"Save Location"}):L.jsx(on,{variant:"outline",size:"sm",onClick:J,children:"Adjust Location"})})]}),L.jsx("p",{className:"text-muted-foreground mb-2",children:i}),L.jsxs("div",{className:"relative w-full h-[300px] rounded-lg overflow-hidden",children:[L.jsx("div",{ref:O,className:"absolute inset-0"}),!ee&&L.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80",children:L.jsx("div",{className:"animate-pulse text-primary",children:"Loading map..."})})]}),L.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[L.jsxs("p",{children:["Current coordinates: ",e.toFixed(6),", ",t.toFixed(6)]}),F&&L.jsxs("p",{children:["New coordinates: ",F.lat.toFixed(6),", ",F.lng.toFixed(6)]})]})]}):(console.log("Token state check:",{token:o,isTokenLoading:k}),L.jsx("div",{className:"text-muted-foreground",children:"Map configuration required"}))},Tie=()=>{var _,b;const{id:e}=q0(),{data:t,isLoading:i,error:a}=Ro({queryKey:["car",e],queryFn:async()=>{if(console.log("Fetching car details for ID:",e),e==="af67919d-012e-418a-a183-0d390caeef1f"){const{error:O}=await Qt.from("cars").update({latitude:-24.6527,longitude:25.9088}).eq("id",e);O&&console.error("Error updating car coordinates:",O)}const{data:o,error:k}=await Qt.from("cars").select(`
          *,
          profiles:owner_id (
            full_name,
            avatar_url
          )
        `).eq("id",e).maybeSingle();if(k)throw console.error("Error fetching car:",k),k;return console.log("Car details fetched:",o),o}});if(i)return L.jsxs("div",{className:"min-h-screen bg-background",children:[L.jsxs("div",{className:"space-y-4 p-4",children:[L.jsx(oo,{className:"h-64 w-full"}),L.jsx(oo,{className:"h-8 w-3/4"}),L.jsx(oo,{className:"h-4 w-1/2"}),L.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[L.jsx(oo,{className:"h-20"}),L.jsx(oo,{className:"h-20"}),L.jsx(oo,{className:"h-20"})]})]}),L.jsx(So,{})]});if(a||!t)return L.jsxs("div",{className:"min-h-screen bg-background",children:[L.jsxs("div",{className:"p-4 text-center",children:[L.jsx("h2",{className:"text-xl font-semibold text-red-500",children:"Error loading car details"}),L.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),L.jsx(So,{})]});const d=(_=t.profiles)!=null&&_.avatar_url?Qt.storage.from("avatars").getPublicUrl(t.profiles.avatar_url).data.publicUrl:"/placeholder.svg";return L.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[L.jsxs("div",{className:"space-y-4 p-4",children:[L.jsx(yie,{carId:t.id,mainImageUrl:t.image_url}),L.jsx(One,{brand:t.brand,model:t.model,year:t.year,location:t.location}),L.jsx(zne,{pricePerDay:t.price_per_day,transmission:t.transmission,seats:t.seats}),L.jsx(Fne,{description:t.description}),L.jsx(Sie,{latitude:t.latitude,longitude:t.longitude,location:t.location}),L.jsx(Nne,{ownerName:((b=t.profiles)==null?void 0:b.full_name)||"Car Owner",avatarUrl:d,ownerId:t.owner_id,carId:t.id}),L.jsx(vie,{car:t}),L.jsx(Lne,{car:t})]}),L.jsx(So,{})]})},FB=({formData:e,onInputChange:t,onSelectChange:i})=>L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"brand",children:"Brand"}),L.jsx(lo,{id:"brand",name:"brand",value:e.brand,onChange:t,required:!0})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"model",children:"Model"}),L.jsx(lo,{id:"model",name:"model",value:e.model,onChange:t,required:!0})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"year",children:"Year"}),L.jsx(lo,{id:"year",name:"year",type:"number",value:e.year,onChange:t,required:!0})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"vehicle_type",children:"Vehicle Type"}),L.jsxs(I0,{value:e.vehicle_type,onValueChange:a=>i("vehicle_type",a),children:[L.jsx(pg,{children:L.jsx(k0,{placeholder:"Select type"})}),L.jsx(mg,{children:["Basic","Standard","Executive","4x4","SUV","Electric","Exotic"].map(a=>L.jsx(hl,{value:a,children:a},a))})]})]})]}),jB=({formData:e,onInputChange:t,onSelectChange:i})=>L.jsxs(L.Fragment,{children:[L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"price_per_day",children:"Price per Day (BWP)"}),L.jsx(lo,{id:"price_per_day",name:"price_per_day",type:"number",value:e.price_per_day,onChange:t,required:!0})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"location",children:"Location"}),L.jsx(lo,{id:"location",name:"location",value:e.location,onChange:t,required:!0})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"transmission",children:"Transmission"}),L.jsxs(I0,{value:e.transmission,onValueChange:a=>i("transmission",a),children:[L.jsx(pg,{children:L.jsx(k0,{placeholder:"Select transmission"})}),L.jsxs(mg,{children:[L.jsx(hl,{value:"Auto",children:"Automatic"}),L.jsx(hl,{value:"Manual",children:"Manual"})]})]})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"fuel",children:"Fuel Type"}),L.jsxs(I0,{value:e.fuel,onValueChange:a=>i("fuel",a),children:[L.jsx(pg,{children:L.jsx(k0,{placeholder:"Select fuel type"})}),L.jsxs(mg,{children:[L.jsx(hl,{value:"Petrol",children:"Petrol"}),L.jsx(hl,{value:"Diesel",children:"Diesel"}),L.jsx(hl,{value:"Electric",children:"Electric"}),L.jsx(hl,{value:"Hybrid",children:"Hybrid"})]})]})]})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"seats",children:"Number of Seats"}),L.jsx(lo,{id:"seats",name:"seats",type:"number",value:e.seats,onChange:t,required:!0})]})]}),BB=({description:e,onChange:t})=>L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"description",children:"Description"}),L.jsx(Jw,{id:"description",name:"description",value:e,onChange:t,className:"h-32"})]}),nw=({onImageChange:e})=>L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"image",children:"Car Image"}),L.jsx(lo,{id:"image",type:"file",accept:"image/*",onChange:e})]}),Eie=({onDocumentChange:e})=>L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"registration",className:"text-base",children:"Car Registration Document"}),L.jsx(lo,{id:"registration",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:t=>e(t,"registration")})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"insurance",className:"text-base",children:"Insurance Document (First Page)"}),L.jsx(lo,{id:"insurance",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:t=>e(t,"insurance")})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(ao,{htmlFor:"additional",className:"text-base",children:"Additional Documents"}),L.jsx(lo,{id:"additional",type:"file",accept:".pdf,.jpg,.jpeg,.png",multiple:!0,onChange:t=>e(t,"additional")})]})]}),Cie=()=>{const e=$o(),{toast:t}=Tl(),[i,a]=Y.useState(!1),[d,_]=Y.useState(null),[b,o]=Y.useState({}),[k,O]=Y.useState(null),[z,F]=Y.useState({brand:"",model:"",year:new Date().getFullYear(),vehicle_type:"",price_per_day:"",location:"",transmission:"",fuel:"",seats:"",description:""});Y.useEffect(()=>{(async()=>{const{data:{session:Q}}=await Qt.auth.getSession();if(!(Q!=null&&Q.user)){e("/login");return}O(Q.user.id)})()},[e]);const G=X=>{const{name:Q,value:ue}=X.target;F(he=>({...he,[Q]:ue}))},ee=(X,Q)=>{F(X==="vehicle_type"?ue=>({...ue,[X]:Q}):ue=>({...ue,[X]:Q}))},J=X=>{X.target.files&&X.target.files[0]&&_(X.target.files[0])},te=(X,Q)=>{X.target.files&&o(Q==="additional"?ue=>({...ue,[Q]:X.target.files}):ue=>({...ue,[Q]:X.target.files[0]}))},oe=async X=>{if(X.preventDefault(),console.log("Starting car submission process..."),!k){t({title:"Error",description:"You must be logged in to add a car",variant:"destructive"});return}a(!0);try{let Q=null;if(d){console.log("Uploading main car image...");const he=d.name.split(".").pop(),Je=`${`${crypto.randomUUID()}.${he}`}`,{error:Ce}=await Qt.storage.from("car-images").upload(Je,d);if(Ce)throw console.error("Error uploading car image:",Ce),Ce;const{data:{publicUrl:Ze}}=Qt.storage.from("car-images").getPublicUrl(Je);Q=Ze,console.log("Car image uploaded successfully:",Q)}console.log("Inserting car data into database...");const{error:ue}=await Qt.from("cars").insert({owner_id:k,image_url:Q,price_per_day:parseFloat(z.price_per_day),year:parseInt(z.year.toString()),seats:parseInt(z.seats),brand:z.brand,model:z.model,vehicle_type:z.vehicle_type,location:z.location,transmission:z.transmission,fuel:z.fuel,description:z.description,is_available:!0});if(ue)throw console.error("Error inserting car data:",ue),ue;console.log("Car listed successfully!"),t({title:"Success",description:"Your car has been listed successfully!"}),e("/")}catch(Q){console.error("Error adding car:",Q),t({title:"Error",description:"Failed to add your car. Please try again.",variant:"destructive"})}finally{a(!1)}};return L.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[L.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[L.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[L.jsx(on,{variant:"ghost",size:"icon",onClick:()=>e(-1),className:"hover:bg-gray-100",children:L.jsx(Z0,{className:"h-5 w-5"})}),L.jsx("h1",{className:"text-2xl font-semibold",children:"List Your Car"})]}),L.jsxs("form",{onSubmit:oe,className:"space-y-6",children:[L.jsx(FB,{formData:z,onInputChange:G,onSelectChange:ee}),L.jsx(jB,{formData:z,onInputChange:G,onSelectChange:ee}),L.jsx(BB,{description:z.description,onChange:G}),L.jsx(nw,{onImageChange:J}),L.jsx(Eie,{onDocumentChange:te}),L.jsx(on,{type:"submit",className:"w-full",disabled:i,children:i?"Adding Car...":"Add Car"})]})]}),L.jsx(So,{})]})},Mie=()=>{const e=$o(),{toast:t}=Tl(),[i,a]=Y.useState(null),[d,_]=Y.useState(null),b=fj({defaultValues:{license_number:"",country_of_issue:"",phone_number:""}}),o=z=>{var F;(F=z.target.files)!=null&&F[0]&&a(z.target.files[0])},k=z=>{var F;(F=z.target.files)!=null&&F[0]&&_(z.target.files[0])},O=async z=>{try{const{data:{user:F}}=await Qt.auth.getUser();if(!F)throw new Error("No user found");t({title:"Success",description:"Driver's license information saved successfully"}),e("/")}catch(F){console.error("Error saving driver's license:",F),t({title:"Error",description:"Failed to save driver's license information",variant:"destructive"})}};return L.jsxs("div",{className:"container mx-auto px-4 py-8",children:[L.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Driver License Information"}),L.jsx(pj,{...b,children:L.jsxs("form",{onSubmit:b.handleSubmit(O),className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{className:"space-y-4",children:[L.jsx(mm,{control:b.control,name:"license_number",render:({field:z})=>L.jsxs(Gh,{children:[L.jsx(Bc,{children:"License Number"}),L.jsx(Hh,{children:L.jsx(lo,{...z,placeholder:"Enter license number"})}),L.jsx(qh,{})]})}),L.jsx(mm,{control:b.control,name:"country_of_issue",render:({field:z})=>L.jsxs(Gh,{children:[L.jsx(Bc,{children:"Country of Issue"}),L.jsx(Hh,{children:L.jsx(lo,{...z,placeholder:"Enter country of issue"})}),L.jsx(qh,{})]})}),L.jsx(mm,{control:b.control,name:"phone_number",render:({field:z})=>L.jsxs(Gh,{children:[L.jsx(Bc,{children:"Phone Number"}),L.jsx(Hh,{children:L.jsx(lo,{...z,placeholder:"Enter phone number",type:"tel"})}),L.jsx(qh,{})]})})]}),L.jsxs("div",{className:"space-y-4",children:[L.jsx(mm,{control:b.control,name:"expiry_date",render:({field:z})=>L.jsxs(Gh,{className:"flex flex-col",children:[L.jsx(Bc,{children:"Expiry Date"}),L.jsxs(FC,{children:[L.jsx(jC,{asChild:!0,children:L.jsx(Hh,{children:L.jsxs(on,{variant:"outline",className:_r("w-full pl-3 text-left font-normal",!z.value&&"text-muted-foreground"),children:[z.value?In(z.value,"PPP"):L.jsx("span",{children:"Pick a date"}),L.jsx(xC,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),L.jsx(qb,{className:"w-auto p-0",align:"start",children:L.jsx(M0,{mode:"single",selected:z.value,onSelect:z.onChange,disabled:F=>F<new Date,initialFocus:!0})})]}),L.jsx(qh,{})]})}),L.jsx(mm,{control:b.control,name:"date_of_birth",render:({field:z})=>L.jsxs(Gh,{className:"flex flex-col",children:[L.jsx(Bc,{children:"Date of Birth"}),L.jsxs(FC,{children:[L.jsx(jC,{asChild:!0,children:L.jsx(Hh,{children:L.jsxs(on,{variant:"outline",className:_r("w-full pl-3 text-left font-normal",!z.value&&"text-muted-foreground"),children:[z.value?In(z.value,"PPP"):L.jsx("span",{children:"Pick a date"}),L.jsx(xC,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),L.jsx(qb,{className:"w-auto p-0",align:"start",children:L.jsx(M0,{mode:"single",selected:z.value,onSelect:z.onChange,disabled:F=>F>new Date,initialFocus:!0})})]}),L.jsx(qh,{})]})})]})]}),L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{children:[L.jsx(Bc,{children:"Front of License"}),L.jsx(nw,{onImageChange:o})]}),L.jsxs("div",{children:[L.jsx(Bc,{children:"Back of License"}),L.jsx(nw,{onImageChange:k})]})]}),L.jsx(on,{type:"submit",className:"w-full",children:"Save License Information"})]})})]})},Pie=()=>{const{id:e}=q0(),t=$o(),{toast:i}=Tl(),[a,d]=Y.useState(!1),[_,b]=Y.useState(null);Y.useState({});const{data:o,isLoading:k}=Ro({queryKey:["car",e],queryFn:async()=>{const{data:te,error:oe}=await Qt.from("cars").select("*").eq("id",e).single();if(oe)throw oe;return te}}),[O,z]=Y.useState({brand:"",model:"",year:new Date().getFullYear(),vehicle_type:"",price_per_day:"",location:"",transmission:"",fuel:"",seats:"",description:""});Y.useEffect(()=>{o&&z({brand:o.brand,model:o.model,year:o.year,vehicle_type:o.vehicle_type,price_per_day:o.price_per_day.toString(),location:o.location,transmission:o.transmission,fuel:o.fuel,seats:o.seats.toString(),description:o.description||""})},[o]);const F=te=>{const{name:oe,value:X}=te.target;z(Q=>({...Q,[oe]:X}))},G=(te,oe)=>{z(te==="vehicle_type"?X=>({...X,[te]:oe}):X=>({...X,[te]:oe}))},ee=te=>{te.target.files&&te.target.files[0]&&b(te.target.files[0])},J=async te=>{te.preventDefault(),d(!0);try{let oe=o==null?void 0:o.image_url;if(_){const Q=_.name.split(".").pop(),ue=`${crypto.randomUUID()}.${Q}`,{error:he}=await Qt.storage.from("car-images").upload(ue,_);if(he)throw he;const{data:{publicUrl:Ie}}=Qt.storage.from("car-images").getPublicUrl(ue);oe=Ie}const{error:X}=await Qt.from("cars").update({image_url:oe,price_per_day:parseFloat(O.price_per_day),year:parseInt(O.year.toString()),seats:parseInt(O.seats.toString()),brand:O.brand,model:O.model,vehicle_type:O.vehicle_type,location:O.location,transmission:O.transmission,fuel:O.fuel,description:O.description}).eq("id",e);if(X)throw X;i({title:"Success",description:"Your car has been updated successfully!"}),t(`/cars/${e}`)}catch(oe){console.error("Error updating car:",oe),i({title:"Error",description:"Failed to update your car. Please try again.",variant:"destructive"})}finally{d(!1)}};return k?L.jsxs("div",{className:"min-h-screen bg-gray-50",children:[L.jsx("div",{className:"max-w-2xl mx-auto p-4",children:L.jsxs("div",{className:"animate-pulse space-y-4",children:[L.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),L.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}),L.jsx(So,{})]}):L.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[L.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[L.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Edit Car"}),L.jsxs("form",{onSubmit:J,className:"space-y-6",children:[L.jsx(FB,{formData:O,onInputChange:F,onSelectChange:G}),L.jsx(jB,{formData:O,onInputChange:F,onSelectChange:G}),L.jsx(BB,{description:O.description,onChange:F}),L.jsx(nw,{onImageChange:ee}),L.jsx(on,{type:"submit",className:"w-full",disabled:a,children:a?"Updating Car...":"Update Car"})]})]}),L.jsx(So,{})]})},UB=Y.forwardRef(({className:e,...t},i)=>L.jsx("div",{className:"relative w-full overflow-auto",children:L.jsx("table",{ref:i,className:_r("w-full caption-bottom text-sm",e),...t})}));UB.displayName="Table";const VB=Y.forwardRef(({className:e,...t},i)=>L.jsx("thead",{ref:i,className:_r("[&_tr]:border-b",e),...t}));VB.displayName="TableHeader";const $B=Y.forwardRef(({className:e,...t},i)=>L.jsx("tbody",{ref:i,className:_r("[&_tr:last-child]:border-0",e),...t}));$B.displayName="TableBody";const Aie=Y.forwardRef(({className:e,...t},i)=>L.jsx("tfoot",{ref:i,className:_r("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));Aie.displayName="TableFooter";const xP=Y.forwardRef(({className:e,...t},i)=>L.jsx("tr",{ref:i,className:_r("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));xP.displayName="TableRow";const gm=Y.forwardRef(({className:e,...t},i)=>L.jsx("th",{ref:i,className:_r("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));gm.displayName="TableHead";const _m=Y.forwardRef(({className:e,...t},i)=>L.jsx("td",{ref:i,className:_r("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));_m.displayName="TableCell";const Iie=Y.forwardRef(({className:e,...t},i)=>L.jsx("caption",{ref:i,className:_r("mt-4 text-sm text-muted-foreground",e),...t}));Iie.displayName="TableCaption";const kie=({booking:e,onCancelBooking:t})=>L.jsxs(xP,{children:[L.jsx(_m,{children:L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("img",{src:e.cars.image_url||"/placeholder.svg",alt:`${e.cars.brand} ${e.cars.model}`,className:"w-12 h-12 object-cover rounded"}),L.jsx("div",{children:L.jsxs("p",{className:"font-medium",children:[e.cars.brand," ",e.cars.model]})})]})}),L.jsxs(_m,{children:[L.jsx("p",{children:In(new Date(e.start_date),"PPP")}),L.jsxs("p",{className:"text-muted-foreground",children:["to ",In(new Date(e.end_date),"PPP")]})]}),L.jsx(_m,{children:L.jsx("span",{className:"capitalize",children:e.status})}),L.jsxs(_m,{children:["BWP ",e.total_price]}),L.jsx(_m,{children:e.status==="pending"&&L.jsx(on,{variant:"outline",onClick:()=>t(e.id),children:"Cancel"})})]}),Rie=({bookings:e,onCancelBooking:t})=>L.jsx("div",{className:"rounded-md border",children:L.jsxs(UB,{children:[L.jsx(VB,{children:L.jsxs(xP,{children:[L.jsx(gm,{children:"Car"}),L.jsx(gm,{children:"Dates"}),L.jsx(gm,{children:"Status"}),L.jsx(gm,{children:"Price"}),L.jsx(gm,{children:"Actions"})]})}),L.jsx($B,{children:e==null?void 0:e.map(i=>L.jsx(kie,{booking:i,onCancelBooking:t},i.id))})]})}),Die=()=>{const{toast:e}=Tl(),t=wg(),{data:i,isLoading:a}=Ro({queryKey:["bookings"],queryFn:async()=>{console.log("Fetching user bookings");const{data:b,error:o}=await Qt.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            image_url,
            owner_id
          )
        `).order("created_at",{ascending:!1});if(o)throw console.error("Error fetching bookings:",o),o;return console.log("Bookings fetched:",b),b}}),d=async b=>{var k;const{data:o}=await Qt.auth.getSession();(k=o.session)!=null&&k.user&&await Qt.from("notifications").insert([{user_id:b.cars.owner_id,type:"booking_cancelled",content:`Booking for ${b.cars.brand} ${b.cars.model} from ${In(new Date(b.start_date),"PPP")} to ${In(new Date(b.end_date),"PPP")} has been cancelled.`,related_car_id:b.car_id,related_booking_id:b.id},{user_id:o.session.user.id,type:"booking_cancelled",content:`Your booking for ${b.cars.brand} ${b.cars.model} from ${In(new Date(b.start_date),"PPP")} to ${In(new Date(b.end_date),"PPP")} has been cancelled.`,related_car_id:b.car_id,related_booking_id:b.id}])},_=async b=>{try{const o=i==null?void 0:i.find(O=>O.id===b);if(!o)return;const{error:k}=await Qt.from("bookings").update({status:"cancelled"}).eq("id",b);if(k)throw console.error("Error updating booking:",k),k;await d(o),await t.invalidateQueries({queryKey:["bookings"]}),e({title:"Success",description:"Booking cancelled successfully"})}catch(o){console.error("Error cancelling booking:",o),e({title:"Error",description:"Failed to cancel booking",variant:"destructive"}),t.invalidateQueries({queryKey:["bookings"]})}};return a?L.jsxs("div",{className:"min-h-screen bg-background",children:[L.jsxs("div",{className:"container py-4 space-y-4",children:[L.jsx("h1",{className:"text-2xl font-bold",children:"My Bookings"}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(oo,{className:"h-12 w-full"}),L.jsx(oo,{className:"h-12 w-full"}),L.jsx(oo,{className:"h-12 w-full"})]})]}),L.jsx(So,{})]}):L.jsxs("div",{className:"min-h-screen bg-background",children:[L.jsxs("div",{className:"container py-4 space-y-4",children:[L.jsx("h1",{className:"text-2xl font-bold",children:"My Bookings"}),L.jsx(Rie,{bookings:i,onCancelBooking:_})]}),L.jsx(So,{})]})},Lie=()=>{const{data:e=[],isLoading:t,error:i}=Ro({queryKey:["saved-cars-full"],queryFn:async()=>{console.log("Fetching saved cars...");const{data:{session:a}}=await Qt.auth.getSession();if(!a)return console.log("No active session found"),[];const{data:d,error:_}=await Qt.from("saved_cars").select(`
          car_id,
          cars:cars(*)
        `).eq("user_id",a.user.id);if(_)throw console.error("Error fetching saved cars:",_),_;if(console.log("Raw saved cars data:",d),!Array.isArray(d))return console.log("savedCars is not an array, returning empty array"),[];const b=d.filter(o=>o.cars).map(o=>({...o.cars,isSaved:!0}));return console.log("Processed cars:",b),b}});return L.jsxs("div",{className:"min-h-screen pb-20",children:[L.jsx("header",{className:"bg-white p-4 sticky top-0 z-10 shadow-sm",children:L.jsx("h1",{className:"text-xl font-semibold",children:"Saved Cars"})}),L.jsx("main",{className:"container mx-auto px-4 py-8",children:L.jsx(GF,{cars:e,isLoading:t,error:i,loadMoreRef:()=>{},isFetchingNextPage:!1})}),L.jsx(So,{})]})},Oie=()=>{const{id:e}=q0(),t=$o(),{data:i,isLoading:a}=Ro({queryKey:["notification",e],queryFn:async()=>{console.log("Fetching notification details for ID:",e);const{data:d,error:_}=await Qt.from("notifications").select("*").eq("id",e).single();if(_)throw _;return await Qt.from("notifications").update({is_read:!0}).eq("id",e),d}});return a?L.jsx("div",{className:"container mx-auto px-4 py-8",children:L.jsxs("div",{className:"animate-pulse space-y-4",children:[L.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"}),L.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})}):L.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[L.jsxs(on,{variant:"ghost",className:"mb-6",onClick:()=>t(-1),children:[L.jsx(Z0,{className:"mr-2 h-4 w-4"}),"Back"]}),L.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[L.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Notification Details"}),i?L.jsxs("div",{className:"space-y-4",children:[L.jsx("p",{className:"text-gray-600",children:i.content}),L.jsxs("p",{className:"text-sm text-gray-400",children:["Received on: ",new Date(i.created_at).toLocaleDateString()]}),i.type==="booking_request"&&i.related_booking_id&&L.jsxs(on,{className:"w-full mt-4",onClick:()=>t(`/booking-requests/${i.related_booking_id}`),children:["View Booking Request",L.jsx($z,{className:"ml-2 h-4 w-4"})]})]}):L.jsx("p",{className:"text-gray-600",children:"Notification not found"})]}),L.jsx(So,{})]})},zie=()=>{const{id:e}=q0(),t=$o(),{toast:i}=Tl(),a=wg(),{data:d,isLoading:_}=Ro({queryKey:["booking-request",e],queryFn:async()=>{console.log("Fetching booking request details for ID:",e);const{data:z,error:F}=await Qt.from("bookings").select(`
          *,
          renter:profiles!renter_id (
            full_name,
            avatar_url
          ),
          car:cars (
            brand,
            model,
            image_url,
            location,
            price_per_day
          )
        `).eq("id",e).single();if(F)throw F;return z}}),{data:b}=Ro({queryKey:["renter-rating",d==null?void 0:d.renter_id],queryFn:async()=>{if(!(d!=null&&d.renter_id))return null;const{data:z}=await Qt.rpc("calculate_user_rating",{user_uuid:d.renter_id});return z},enabled:!!(d!=null&&d.renter_id)}),o=G7({mutationFn:async({status:z})=>{console.log("Updating booking status:",z);const{error:F}=await Qt.from("bookings").update({status:z}).eq("id",e);if(F)throw F},onSuccess:(z,F)=>{const G=F.status==="confirmed"?"approved":"cancelled";i({title:`Booking ${G}`,description:`The booking request has been successfully ${G}.`}),a.invalidateQueries({queryKey:["booking-request",e]})},onError:z=>{console.error("Error updating booking status:",z),i({title:"Error",description:"Failed to update the booking status. Please try again.",variant:"destructive"})}}),k=()=>{o.mutate({status:"confirmed"})},O=()=>{o.mutate({status:"cancelled"})};return _?L.jsx("div",{className:"container mx-auto px-4 py-8",children:L.jsxs("div",{className:"animate-pulse space-y-4",children:[L.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"}),L.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})}):d?L.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[L.jsxs(on,{variant:"ghost",className:"mb-6",onClick:()=>t(-1),children:[L.jsx(Z0,{className:"mr-2 h-4 w-4"}),"Back"]}),L.jsx("div",{className:"space-y-6",children:L.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[L.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Booking Request Details"}),L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Renter Information"}),L.jsxs("div",{className:"flex items-center gap-4",children:[L.jsx("img",{src:d.renter.avatar_url?Qt.storage.from("avatars").getPublicUrl(d.renter.avatar_url).data.publicUrl:"/placeholder.svg",alt:d.renter.full_name,className:"w-16 h-16 rounded-full object-cover"}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium",children:d.renter.full_name}),typeof b=="number"&&L.jsxs("div",{className:"flex items-center gap-1 text-yellow-500",children:[L.jsx(bC,{className:"h-4 w-4 fill-current"}),L.jsx("span",{children:b.toFixed(1)})]})]})]})]}),L.jsxs("div",{children:[L.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Requested Car"}),L.jsxs("div",{className:"flex gap-4",children:[L.jsx("img",{src:d.car.image_url||"/placeholder.svg",alt:`${d.car.brand} ${d.car.model}`,className:"w-32 h-24 object-cover rounded-lg"}),L.jsxs("div",{children:[L.jsxs("p",{className:"font-medium",children:[d.car.brand," ",d.car.model]}),L.jsx("p",{className:"text-sm text-gray-600",children:d.car.location}),L.jsxs("p",{className:"text-sm font-medium",children:["BWP ",d.car.price_per_day," per day"]})]})]})]}),L.jsxs("div",{children:[L.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Booking Dates"}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600",children:"Start Date"}),L.jsx("p",{className:"font-medium",children:In(new Date(d.start_date),"PPP")})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600",children:"End Date"}),L.jsx("p",{className:"font-medium",children:In(new Date(d.end_date),"PPP")})]})]})]}),L.jsx("div",{className:"border-t pt-4",children:L.jsxs("div",{className:"flex justify-between items-center",children:[L.jsx("p",{className:"font-semibold",children:"Total Price"}),L.jsxs("p",{className:"text-xl font-bold",children:["BWP ",d.total_price]})]})}),d.status==="pending"&&L.jsxs("div",{className:"flex gap-4 justify-end border-t pt-6",children:[L.jsxs(on,{variant:"outline",className:"flex items-center gap-2",onClick:O,disabled:o.isPending,children:[L.jsx(VG,{className:"h-4 w-4"}),"Cancel Request"]}),L.jsxs(on,{className:"flex items-center gap-2",onClick:k,disabled:o.isPending,children:[L.jsx(jG,{className:"h-4 w-4"}),"Approve Request"]})]}),d.status!=="pending"&&L.jsx("div",{className:"border-t pt-4",children:L.jsxs("p",{className:"text-sm font-medium",children:["Status: ",L.jsx("span",{className:"capitalize",children:d.status})]})})]})]})}),L.jsx(So,{})]}):L.jsx("div",{className:"container mx-auto px-4 py-8",children:L.jsx("p",{className:"text-gray-600",children:"Booking request not found"})})},Nie=()=>{const e=$o();return L.jsx("div",{className:"flex items-center justify-between mb-6",children:L.jsxs("div",{className:"flex items-center gap-4",children:[L.jsx(on,{variant:"ghost",size:"icon",onClick:()=>e(-1),children:L.jsx(Z0,{className:"h-4 w-4"})}),L.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard"})]})})},Fie=()=>{const{data:e,isLoading:t}=Ro({queryKey:["renter-bookings"],queryFn:async()=>{const{data:{user:_}}=await Qt.auth.getUser();if(!_)throw new Error("No user found");console.log("Fetching renter bookings");const{data:b,error:o}=await Qt.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            location,
            image_url
          )
        `).eq("renter_id",_.id).order("start_date",{ascending:!0});if(o)throw o;return console.log("Renter bookings:",b),b}});if(t)return L.jsxs("div",{className:"space-y-4",children:[L.jsx(oo,{className:"h-32 w-full"}),L.jsx(oo,{className:"h-32 w-full"})]});const i=e==null?void 0:e.filter(_=>_.status==="confirmed"&&new Date(_.end_date)>=new Date),a=e==null?void 0:e.filter(_=>_.status==="pending"),d=e==null?void 0:e.filter(_=>_.status==="completed"||new Date(_.end_date)<new Date);return L.jsx("div",{className:"space-y-6",children:L.jsxs(Zw,{defaultValue:"active",children:[L.jsxs(dv,{children:[L.jsx(gl,{value:"active",children:"Active Rentals"}),L.jsx(gl,{value:"upcoming",children:"Upcoming"}),L.jsx(gl,{value:"past",children:"Past Rentals"})]}),L.jsx(Zc,{value:"active",children:L.jsx("div",{className:"grid gap-4",children:i==null?void 0:i.map(_=>L.jsxs(Ld,{children:[L.jsx(uf,{children:L.jsxs(df,{className:"text-lg",children:[_.cars.brand," ",_.cars.model]})}),L.jsx(hf,{children:L.jsxs("div",{className:"space-y-2",children:[L.jsxs("p",{className:"text-sm text-muted-foreground",children:["Location: ",_.cars.location]}),L.jsxs("p",{className:"text-sm",children:["Pickup: ",In(new Date(_.start_date),"PPP")]}),L.jsxs("p",{className:"text-sm",children:["Return: ",In(new Date(_.end_date),"PPP")]})]})})]},_.id))})}),L.jsx(Zc,{value:"upcoming",children:L.jsx("div",{className:"grid gap-4",children:a==null?void 0:a.map(_=>L.jsxs(Ld,{children:[L.jsx(uf,{children:L.jsxs(df,{className:"text-lg",children:[_.cars.brand," ",_.cars.model]})}),L.jsx(hf,{children:L.jsxs("div",{className:"space-y-2",children:[L.jsxs("p",{className:"text-sm text-muted-foreground",children:["Location: ",_.cars.location]}),L.jsxs("p",{className:"text-sm",children:["Pickup: ",In(new Date(_.start_date),"PPP")]}),L.jsxs("p",{className:"text-sm",children:["Return: ",In(new Date(_.end_date),"PPP")]}),L.jsxs("p",{className:"text-sm font-medium",children:["Status: ",_.status]})]})})]},_.id))})}),L.jsx(Zc,{value:"past",children:L.jsx("div",{className:"grid gap-4",children:d==null?void 0:d.map(_=>L.jsxs(Ld,{children:[L.jsx(uf,{children:L.jsxs(df,{className:"text-lg",children:[_.cars.brand," ",_.cars.model]})}),L.jsx(hf,{children:L.jsxs("div",{className:"space-y-2",children:[L.jsxs("p",{className:"text-sm text-muted-foreground",children:["Location: ",_.cars.location]}),L.jsxs("p",{className:"text-sm",children:["Pickup: ",In(new Date(_.start_date),"PPP")]}),L.jsxs("p",{className:"text-sm",children:["Return: ",In(new Date(_.end_date),"PPP")]})]})})]},_.id))})})]})})},jie=()=>{const{data:e,isLoading:t}=Ro({queryKey:["host-dashboard"],queryFn:async()=>{const{data:{user:d}}=await Qt.auth.getUser();if(!d)throw new Error("No user found");console.log("Fetching host data");const[_,b]=await Promise.all([Qt.from("cars").select("*").eq("owner_id",d.id),Qt.from("bookings").select(`
            *,
            cars (
              brand,
              model,
              location
            ),
            renter:profiles!renter_id (
              full_name
            )
          `).eq("cars.owner_id",d.id).order("start_date",{ascending:!0})]);if(_.error)throw _.error;if(b.error)throw b.error;return console.log("Host cars:",_.data),console.log("Host bookings:",b.data),{cars:_.data,bookings:b.data}}});if(t)return L.jsxs("div",{className:"space-y-4",children:[L.jsx(oo,{className:"h-32 w-full"}),L.jsx(oo,{className:"h-32 w-full"})]});const i=e==null?void 0:e.bookings.filter(d=>d.status==="confirmed"&&new Date(d.end_date)>=new Date),a=e==null?void 0:e.bookings.filter(d=>d.status==="pending");return L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"flex justify-between items-center",children:[L.jsx("h2",{className:"text-xl font-semibold",children:"Your Cars"}),L.jsx(cf,{to:"/add-car",children:L.jsxs(on,{className:"gap-2",children:[L.jsx(Xz,{className:"h-4 w-4"}),"Add New Car"]})})]}),L.jsxs(Zw,{defaultValue:"cars",children:[L.jsxs(dv,{children:[L.jsx(gl,{value:"cars",children:"Listed Cars"}),L.jsx(gl,{value:"active",children:"Active Rentals"}),L.jsx(gl,{value:"requests",children:"Requests"})]}),L.jsx(Zc,{value:"cars",children:L.jsx("div",{className:"grid gap-4",children:e==null?void 0:e.cars.map(d=>L.jsxs(Ld,{children:[L.jsx(uf,{children:L.jsxs(df,{className:"text-lg",children:[d.brand," ",d.model]})}),L.jsx(hf,{children:L.jsxs("div",{className:"space-y-2",children:[L.jsxs("p",{className:"text-sm text-muted-foreground",children:["Location: ",d.location]}),L.jsxs("p",{className:"text-sm",children:["Price: BWP ",d.price_per_day," per day"]}),L.jsx(cf,{to:`/edit-car/${d.id}`,children:L.jsx(on,{variant:"outline",size:"sm",children:"Edit Car"})})]})})]},d.id))})}),L.jsx(Zc,{value:"active",children:L.jsx("div",{className:"grid gap-4",children:i==null?void 0:i.map(d=>L.jsxs(Ld,{children:[L.jsx(uf,{children:L.jsxs(df,{className:"text-lg",children:[d.cars.brand," ",d.cars.model]})}),L.jsx(hf,{children:L.jsxs("div",{className:"space-y-2",children:[L.jsxs("p",{className:"text-sm",children:["Renter: ",d.renter.full_name]}),L.jsxs("p",{className:"text-sm text-muted-foreground",children:["Location: ",d.cars.location]}),L.jsxs("p",{className:"text-sm",children:["Pickup: ",In(new Date(d.start_date),"PPP")]}),L.jsxs("p",{className:"text-sm",children:["Return: ",In(new Date(d.end_date),"PPP")]})]})})]},d.id))})}),L.jsx(Zc,{value:"requests",children:L.jsx("div",{className:"grid gap-4",children:a==null?void 0:a.map(d=>L.jsxs(Ld,{children:[L.jsx(uf,{children:L.jsxs(df,{className:"text-lg",children:[d.cars.brand," ",d.cars.model]})}),L.jsx(hf,{children:L.jsxs("div",{className:"space-y-2",children:[L.jsxs("p",{className:"text-sm",children:["Renter: ",d.renter.full_name]}),L.jsxs("p",{className:"text-sm text-muted-foreground",children:["Location: ",d.cars.location]}),L.jsxs("p",{className:"text-sm",children:["Pickup: ",In(new Date(d.start_date),"PPP")]}),L.jsxs("p",{className:"text-sm",children:["Return: ",In(new Date(d.end_date),"PPP")]}),L.jsx(cf,{to:`/booking-requests/${d.id}`,children:L.jsx(on,{variant:"outline",size:"sm",children:"View Request"})})]})})]},d.id))})})]})]})},Bie=()=>{const[e,t]=Y.useState(null);return Y.useEffect(()=>{(async()=>{const{data:{user:a}}=await Qt.auth.getUser();if(!a)return;console.log("Fetching user role for dashboard");const{data:d}=await Qt.from("profiles").select("role").eq("id",a.id).single();d!=null&&d.role&&(console.log("User role:",d.role),t(d.role))})()},[]),e?L.jsxs("div",{className:"container mx-auto px-4 py-8 pb-20",children:[L.jsx(Nie,{}),e==="renter"?L.jsx(Fie,{}):L.jsx(jie,{}),L.jsx(So,{})]}):L.jsxs("div",{className:"container mx-auto px-4 py-8",children:[L.jsx(oo,{className:"h-8 w-48 mb-6"}),L.jsxs("div",{className:"space-y-4",children:[L.jsx(oo,{className:"h-32 w-full"}),L.jsx(oo,{className:"h-32 w-full"})]}),L.jsx(So,{})]})},ba=({children:e})=>{const[t,i]=Y.useState(!0),[a,d]=Y.useState(!1),_=qd();Y.useEffect(()=>{console.log("ProtectedRoute: Initializing"),b();const{data:{subscription:o}}=Qt.auth.onAuthStateChange(async(k,O)=>{if(console.log("Auth state changed:",k,!!O),k==="SIGNED_OUT"){console.log("User signed out"),d(!1),i(!1);return}k==="TOKEN_REFRESHED"&&(console.log("Token refresh attempt completed"),O?(console.log("Token refresh successful"),d(!0)):(console.log("Token refresh failed - clearing auth state"),await Qt.auth.signOut(),d(!1),Jn.error("Your session has expired. Please sign in again.")),i(!1))});return()=>{console.log("ProtectedRoute: Cleaning up subscription"),o.unsubscribe()}},[]);const b=async()=>{try{console.log("ProtectedRoute: Checking auth status");const{data:{session:o},error:k}=await Qt.auth.getSession();if(k){console.error("Error checking auth status:",k),await Qt.auth.signOut(),Jn.error("Authentication error. Please sign in again."),d(!1);return}if(!o){console.log("No active session found"),d(!1);return}const{data:{user:O}}=await Qt.auth.getUser();if(!O){console.log("Session exists but user data is invalid"),await Qt.auth.signOut(),d(!1);return}console.log("Valid session found"),d(!0)}catch(o){console.error("Error in checkAuth:",o),await Qt.auth.signOut(),d(!1)}finally{i(!1)}};return t?L.jsx("div",{className:"flex items-center justify-center min-h-screen",children:L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):a?L.jsx(L.Fragment,{children:e}):(console.log("User not authenticated, redirecting to login"),L.jsx(k$,{to:"/login",state:{from:_},replace:!0}))},Uie=()=>L.jsx(U$,{children:L.jsxs(D$,{children:[L.jsx(hs,{path:"/",element:L.jsx(nee,{})}),L.jsx(hs,{path:"/login",element:L.jsx(fte,{})}),L.jsx(hs,{path:"/profile",element:L.jsx(ba,{children:L.jsx(tne,{})})}),L.jsx(hs,{path:"/dashboard",element:L.jsx(ba,{children:L.jsx(Bie,{})})}),L.jsx(hs,{path:"/map",element:L.jsx(ba,{children:L.jsx(yne,{})})}),L.jsx(hs,{path:"/more",element:L.jsx(ba,{children:L.jsx(vne,{})})}),L.jsx(hs,{path:"/cars/:id",element:L.jsx(ba,{children:L.jsx(Tie,{})})}),L.jsx(hs,{path:"/add-car",element:L.jsx(ba,{children:L.jsx(Cie,{})})}),L.jsx(hs,{path:"/driver-license",element:L.jsx(ba,{children:L.jsx(Mie,{})})}),L.jsx(hs,{path:"/edit-car/:id",element:L.jsx(ba,{children:L.jsx(Pie,{})})}),L.jsx(hs,{path:"/bookings",element:L.jsx(ba,{children:L.jsx(Die,{})})}),L.jsx(hs,{path:"/saved-cars",element:L.jsx(ba,{children:L.jsx(Lie,{})})}),L.jsx(hs,{path:"/notifications/:id",element:L.jsx(ba,{children:L.jsx(Oie,{})})}),L.jsx(hs,{path:"/booking-requests/:id",element:L.jsx(ba,{children:L.jsx(zie,{})})})]})}),Vie=new P7;sz(document.getElementById("root")).render(L.jsx(D7,{client:Vie,children:L.jsx(Uie,{})}));export{r3 as g};

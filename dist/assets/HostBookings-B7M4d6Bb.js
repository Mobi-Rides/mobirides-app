import{j as e,a as oe,u as me}from"./query-vendor-Bsfdn-Hb.js";import{u as ae,r as u}from"./react-vendor-mnpoGfEl.js";import{D as xe,b as ue,d as he,e as pe,B as h,i as je,j as fe,k as ge,V as le,ad as ve,n as F,l as Ne,s as A,q as we,an as Ce,I as ye,af as _e,ag as Se,ah as T,ai as E}from"./index-CEKMvnhM.js";import{C as Re,N as De}from"./Navigation-DrpfU0Fc.js";import{S as Z,a as ee,b as se,c as te,d as j}from"./select-BAtoiU29.js";import{C as D,a as q,b as $,d as z}from"./card-DVWWM3IP.js";import{C as Be}from"./checkbox-D02rbZPb.js";import{S as Me}from"./separator-CNMPkK_g.js";import{R as re}from"./receipt-D8OU_YBc.js";import{C as ne}from"./calendar-BxEe8nw1.js";import{M as ce}from"./map-pin-DSx0xkt_.js";import{U as be}from"./user-C-qQU3Ry.js";import{C as Ae}from"./car-CVWSXvWw.js";import{D as H}from"./download-CEMLbiBI.js";import{a as P,e as Fe}from"./date-vendor-Dhms5dOu.js";import{D as ie}from"./dollar-sign-CUzFtw-3.js";import{C as Pe}from"./circle-x-CJywVQTJ.js";import{C as Te}from"./car-front-B7_hUbft.js";import{C as Ee}from"./clock-BYxaZ7Am.js";import{T as Le}from"./trending-up-DokilxVN.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./bell-B1Cg_jQL.js";import"./index-DXD4kVr2.js";const qe=({isOpen:a,onClose:c,booking:i})=>{var f;const r=()=>{window.print()},C=()=>{console.log("Download receipt for booking:",i.id)},p=i.total_price||0,v=p*.1,o=p-v;return e.jsx(xe,{open:a,onOpenChange:c,children:e.jsxs(ue,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(he,{children:e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Rental Receipt"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(D,{children:e.jsxs(q,{children:[e.jsx($,{className:"text-center text-xl",children:"MobiRides Receipt"}),e.jsxs("p",{className:"text-center text-muted-foreground",children:["Receipt #",i.id.slice(-8).toUpperCase()]})]})}),e.jsxs(D,{children:[e.jsx(q,{children:e.jsx($,{className:"text-lg",children:"Booking Details"})}),e.jsx(z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Rental Period"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[P(new Date(i.start_date),"MMM dd, yyyy")," - ",P(new Date(i.end_date),"MMM dd, yyyy")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Pickup Location"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.cars.location||"Location not specified"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Renter"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((f=i.renter)==null?void 0:f.full_name)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Vehicle"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.cars.brand," ",i.cars.model]})]})]})]})})]}),e.jsxs(D,{children:[e.jsx(q,{children:e.jsx($,{className:"text-lg",children:"Payment Summary"})}),e.jsxs(z,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rental Subtotal"}),e.jsxs("span",{children:["BWP ",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Service Fee"}),e.jsxs("span",{children:["BWP ",v.toFixed(2)]})]}),e.jsx(Me,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["BWP ",p.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Payment completed on ",P(new Date(i.created_at),"MMM dd, yyyy")]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(h,{variant:"outline",onClick:r,children:"Print Receipt"}),e.jsxs(h,{onClick:C,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Download PDF"]})]})]})]})})},L=({booking:a,isSelected:c,onSelect:i,onAction:r})=>{var I,N,d,y,M;const C=ae(),[p,v]=u.useState(!1),[o,f]=u.useState(null),m=async g=>{f(g),await r(a.id,g),f(null)},n=g=>{const w={pending:{label:"Pending",variant:"secondary",color:"bg-orange-100 text-orange-800"},confirmed:{label:"Confirmed",variant:"default",color:"bg-green-100 text-green-800"},completed:{label:"Completed",variant:"default",color:"bg-blue-100 text-blue-800"},cancelled:{label:"Cancelled",variant:"destructive",color:"bg-red-100 text-red-800"},expired:{label:"Expired",variant:"outline",color:"bg-gray-100 text-gray-800"}},R=w[g]||w.pending;return e.jsx(F,{variant:R.variant,className:`${R.color} animate-fade-in`,children:R.label})},B=Fe(new Date(a.end_date),new Date(a.start_date))+1,S=a.total_price*(1-.15);return e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"hover:shadow-lg transition-all duration-200 animate-fade-in",children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[a.status==="pending"&&e.jsx(Be,{checked:c,onCheckedChange:i,className:"mt-1"}),e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:a.cars.image_url||"/placeholder.svg",alt:`${a.cars.brand} ${a.cars.model}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h3",{className:"font-semibold text-lg leading-tight",children:[a.cars.brand," ",a.cars.model]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ce,{className:"h-3 w-3"}),a.cars.location]})]}),n(a.status)]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-muted/50 rounded-lg",children:[e.jsxs(je,{className:"h-8 w-8",children:[e.jsx(fe,{src:(I=a.renter)==null?void 0:I.avatar_url}),e.jsx(ge,{children:((d=(N=a.renter)==null?void 0:N.full_name)==null?void 0:d.charAt(0))||"R"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:((y=a.renter)==null?void 0:y.full_name)||"Unknown Renter"}),((M=a.renter)==null?void 0:M.phone_number)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a.renter.phone_number})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ne,{className:"h-3 w-3"}),e.jsx("span",{children:"Duration"})]}),e.jsxs("p",{className:"font-medium",children:[P(new Date(a.start_date),"MMM dd")," - ",P(new Date(a.end_date),"MMM dd")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[B," days"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ie,{className:"h-3 w-3"}),e.jsx("span",{children:"Earnings"})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"font-bold text-primary text-base",children:["BWP ",S.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground line-through",children:["BWP ",a.total_price.toFixed(2)," total"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{size:"sm",onClick:()=>m("approve"),disabled:o==="approve",className:"flex-1 sm:flex-none animate-scale-in",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),o==="approve"?"Approving...":"Approve"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>m("decline"),disabled:o==="decline",className:"flex-1 sm:flex-none",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),o==="decline"?"Declining...":"Decline"]})]}),a.status==="confirmed"&&e.jsx(h,{size:"sm",variant:"outline",onClick:()=>m("cancel"),disabled:o==="cancel",className:"hover-scale",children:o==="cancel"?"Cancelling...":"Cancel"}),a.status==="completed"&&e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>v(!0),className:"hover-scale",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Receipt"]}),e.jsxs(h,{size:"sm",variant:"ghost",onClick:()=>{var g,w;return C("/messages",{state:{recipientId:(g=a.renter)==null?void 0:g.id,recipientName:((w=a.renter)==null?void 0:w.full_name)||"Renter"}})},className:"hover-scale",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Message"]})]})]})]})})}),e.jsx(qe,{isOpen:p,onClose:()=>v(!1),booking:a})]})},$e=({bookings:a})=>{const c=u.useMemo(()=>{if(!a)return{totalBookings:0,activeRentals:0,pendingRequests:0,completedRentals:0,totalRevenue:0,netRevenue:0};const r=new Date,C=.15,p=a.filter(n=>n.status==="confirmed"&&new Date(n.start_date)<=r&&new Date(n.end_date)>=r).length,v=a.filter(n=>n.status==="pending").length,o=a.filter(n=>n.status==="completed"||n.status==="confirmed"&&new Date(n.end_date)<r).length,f=a.filter(n=>n.status==="completed"||n.status==="confirmed").reduce((n,B)=>n+B.total_price,0),m=f*(1-C);return{totalBookings:a.length,activeRentals:p,pendingRequests:v,completedRentals:o,totalRevenue:f,netRevenue:m}},[a]),i=[{title:"Total Bookings",value:c.totalBookings,icon:Te,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Active Rentals",value:c.activeRentals,icon:Re,color:"text-green-600",bgColor:"bg-green-100"},{title:"Pending Requests",value:c.pendingRequests,icon:Ee,color:"text-orange-600",bgColor:"bg-orange-100"},{title:"Completed",value:c.completedRentals,icon:le,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Total Revenue",value:`BWP ${c.totalRevenue.toFixed(2)}`,icon:ie,color:"text-emerald-600",bgColor:"bg-emerald-100"},{title:"Net Earnings",value:`BWP ${c.netRevenue.toFixed(2)}`,icon:Le,color:"text-primary",bgColor:"bg-primary/10"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:i.map(r=>e.jsxs(D,{className:"hover:shadow-md transition-shadow animate-fade-in",children:[e.jsxs(q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium text-muted-foreground",children:r.title}),e.jsx("div",{className:`p-2 rounded-full ${r.bgColor}`,children:e.jsx(r.icon,{className:`h-4 w-4 ${r.color}`})})]}),e.jsx(z,{children:e.jsx("div",{className:`text-2xl font-bold ${r.color}`,children:r.value})})]},r.title))})},ds=()=>{var w,R,V,W,Q,K,O,k,X,G,J,Y;const a=ae(),{toast:c}=Ne(),i=oe(),[r,C]=u.useState(""),[p,v]=u.useState("all"),[o,f]=u.useState("date_desc"),[m,n]=u.useState([]),[B,U]=u.useState("active"),{data:S,isLoading:I}=me({queryKey:["host-bookings"],queryFn:async()=>{const{data:{user:s}}=await A.auth.getUser();if(!s)throw new Error("No user found");const{data:t,error:l}=await A.from("cars").select("id").eq("owner_id",s.id);if(l)throw l;if(!t.length)return[];const x=t.map(de=>de.id),{data:_,error:b}=await A.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            location,
            image_url,
            owner_id,
            price_per_day
          ),
          renter:profiles!renter_id (
            id,
            full_name,
            avatar_url,
            phone_number
          )
        `).in("car_id",x).order("created_at",{ascending:!1});if(b)throw b;return _}}),N=u.useMemo(()=>{if(!S)return[];const s=S.filter(t=>{var _,b;const l=r===""||t.cars.brand.toLowerCase().includes(r.toLowerCase())||t.cars.model.toLowerCase().includes(r.toLowerCase())||((b=(_=t.renter)==null?void 0:_.full_name)==null?void 0:b.toLowerCase().includes(r.toLowerCase()))||t.cars.location.toLowerCase().includes(r.toLowerCase()),x=p==="all"||t.status===p;return l&&x});return s.sort((t,l)=>{var x,_;switch(o){case"date_asc":return new Date(t.start_date).getTime()-new Date(l.start_date).getTime();case"date_desc":return new Date(l.start_date).getTime()-new Date(t.start_date).getTime();case"earnings_asc":return t.total_price-l.total_price;case"earnings_desc":return l.total_price-t.total_price;case"status":return t.status.localeCompare(l.status);case"renter":return(((x=t.renter)==null?void 0:x.full_name)||"").localeCompare(((_=l.renter)==null?void 0:_.full_name)||"");default:return 0}}),s},[S,r,p,o]),d=u.useMemo(()=>{if(!N)return{};const s=new Date;return{active:N.filter(t=>t.status==="confirmed"&&new Date(t.start_date)<=s&&new Date(t.end_date)>=s),pending:N.filter(t=>t.status==="pending"),expired:N.filter(t=>t.status==="expired"),completed:N.filter(t=>t.status==="completed"||t.status==="confirmed"&&new Date(t.end_date)<s)}},[N]),y=u.useCallback(async(s,t)=>{try{const l=t==="approve"?"confirmed":"cancelled",{error:x}=await A.from("bookings").update({status:l}).eq("id",s);if(x)throw x;await i.invalidateQueries({queryKey:["host-bookings"]}),c({title:"Success",description:`Booking ${t}d successfully`})}catch{c({title:"Error",description:`Failed to ${t} booking`,variant:"destructive"})}},[i,c]),M=u.useCallback(async s=>{if(m.length!==0)try{const t=s==="approve"?"confirmed":"cancelled",{error:l}=await A.from("bookings").update({status:t}).in("id",m);if(l)throw l;await i.invalidateQueries({queryKey:["host-bookings"]}),n([]),c({title:"Success",description:`${m.length} bookings ${s}d successfully`})}catch{c({title:"Error",description:`Failed to ${s} selected bookings`,variant:"destructive"})}},[m,i,c]),g=u.useCallback(s=>{c({title:"Export Started",description:`Exporting data as ${s.toUpperCase()}...`})},[c]);return e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>a(-1),children:e.jsx(we,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"My Bookings (Host)"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your rental bookings"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>g("csv"),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"CSV"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>g("pdf"),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),e.jsx($e,{bookings:S}),e.jsxs(D,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"Search by renter, car, or location...",value:r,onChange:s=>C(s.target.value),className:"pl-10"})]}),e.jsxs(Z,{value:p,onValueChange:s=>v(s),children:[e.jsx(ee,{className:"w-full sm:w-48",children:e.jsx(se,{placeholder:"Filter by status"})}),e.jsxs(te,{children:[e.jsx(j,{value:"all",children:"All Status"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"confirmed",children:"Confirmed"}),e.jsx(j,{value:"completed",children:"Completed"}),e.jsx(j,{value:"cancelled",children:"Cancelled"}),e.jsx(j,{value:"expired",children:"Expired"})]})]}),e.jsxs(Z,{value:o,onValueChange:s=>f(s),children:[e.jsx(ee,{className:"w-full sm:w-48",children:e.jsx(se,{placeholder:"Sort by"})}),e.jsxs(te,{children:[e.jsx(j,{value:"date_desc",children:"Newest First"}),e.jsx(j,{value:"date_asc",children:"Oldest First"}),e.jsx(j,{value:"earnings_desc",children:"Highest Earnings"}),e.jsx(j,{value:"earnings_asc",children:"Lowest Earnings"}),e.jsx(j,{value:"status",children:"Status"}),e.jsx(j,{value:"renter",children:"Renter Name"})]})]})]}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsxs("span",{className:"text-sm",children:[m.length," selected"]}),e.jsx(h,{size:"sm",onClick:()=>M("approve"),children:"Approve Selected"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>M("decline"),children:"Decline Selected"}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>n([]),children:"Clear"})]})]}),e.jsxs(_e,{value:B,onValueChange:U,className:"space-y-4",children:[e.jsxs(Se,{className:"grid w-full grid-cols-4",children:[e.jsxs(T,{value:"active",className:"relative",children:["Active Rentals",((w=d.active)==null?void 0:w.length)>0&&e.jsx(F,{variant:"secondary",className:"ml-2 h-5 px-1.5 text-xs",children:d.active.length})]}),e.jsxs(T,{value:"pending",className:"relative",children:["Requests",((R=d.pending)==null?void 0:R.length)>0&&e.jsx(F,{variant:"destructive",className:"ml-2 h-5 px-1.5 text-xs",children:d.pending.length})]}),e.jsxs(T,{value:"expired",children:["Expired",((V=d.expired)==null?void 0:V.length)>0&&e.jsx(F,{variant:"outline",className:"ml-2 h-5 px-1.5 text-xs",children:d.expired.length})]}),e.jsxs(T,{value:"completed",children:["Past Rentals",((W=d.completed)==null?void 0:W.length)>0&&e.jsx(F,{variant:"outline",className:"ml-2 h-5 px-1.5 text-xs",children:d.completed.length})]})]}),e.jsxs(E,{value:"active",className:"space-y-4",children:[(Q=d.active)==null?void 0:Q.map(s=>e.jsx(L,{booking:s,isSelected:m.includes(s.id),onSelect:t=>{n(t?l=>[...l,s.id]:l=>l.filter(x=>x!==s.id))},onAction:y},s.id)),((K=d.active)==null?void 0:K.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No active rentals"})]}),e.jsxs(E,{value:"pending",className:"space-y-4",children:[(O=d.pending)==null?void 0:O.map(s=>e.jsx(L,{booking:s,isSelected:m.includes(s.id),onSelect:t=>{n(t?l=>[...l,s.id]:l=>l.filter(x=>x!==s.id))},onAction:y},s.id)),((k=d.pending)==null?void 0:k.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No pending requests"})]}),e.jsxs(E,{value:"expired",className:"space-y-4",children:[(X=d.expired)==null?void 0:X.map(s=>e.jsx(L,{booking:s,isSelected:!1,onSelect:()=>{},onAction:y},s.id)),((G=d.expired)==null?void 0:G.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No expired requests"})]}),e.jsxs(E,{value:"completed",className:"space-y-4",children:[(J=d.completed)==null?void 0:J.map(s=>e.jsx(L,{booking:s,isSelected:!1,onSelect:()=>{},onAction:y},s.id)),((Y=d.completed)==null?void 0:Y.length)===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No completed rentals"})]})]})]}),e.jsx(De,{})]})};export{ds as HostBookings,ds as default};

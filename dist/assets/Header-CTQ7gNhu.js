import{j as e,u as A}from"./query-vendor-Bsfdn-Hb.js";import{u as q,f as V,r as x}from"./react-vendor-mnpoGfEl.js";import{c as D,B as N,n as B,V as H,a3 as M,s as k,z as G,i as F,j as O,k as P,an as R,A as K}from"./index-P3CM6KeI.js";import{S as T,a as J,b as Q}from"./sheet-vE9wKzjl.js";import{S as W}from"./SearchFilters-0EB3aHvQ.js";import{u as X}from"./useVerificationStatus-fqM8qHb1.js";import{C as L}from"./clock-BMQl8Y3I.js";import{C as Y}from"./circle-alert-CnS2w5gW.js";import{S as Z}from"./shield-CXGhqkUx.js";import{N as ee}from"./navigation-B09EdzYM.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=D("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),te=({showText:m=!0,variant:b="badge",size:h="md"})=>{const{isVerified:n,isLoading:o,verificationData:a}=X(),j=q(),c=()=>{j("/verification")},t=o?{icon:e.jsx(L,{className:"h-3 w-3"}),text:"Checking...",variant:"outline",className:"border-blue-300 text-blue-600 hover:bg-blue-50",clickable:!1}:n?{icon:e.jsx(H,{className:"h-3 w-3"}),text:"Verified",variant:"secondary",className:"bg-green-100 text-green-700 border-green-200",clickable:!1}:a&&a.overall_status==="pending_review"?{icon:e.jsx(L,{className:"h-3 w-3"}),text:"Under Review",variant:"secondary",className:"bg-blue-100 text-blue-700 border-blue-200",clickable:!0}:a&&a.current_step?{icon:e.jsx(Y,{className:"h-3 w-3"}),text:"In Progress",variant:"secondary",className:"bg-orange-100 text-orange-700 border-orange-200",clickable:!0}:{icon:e.jsx(Z,{className:"h-3 w-3"}),text:"Not Verified",variant:"outline",className:"border-gray-300 text-gray-600 hover:bg-gray-50",clickable:!0};return b==="button"&&t.clickable?e.jsxs(N,{variant:"outline",size:h==="md"?"default":h,onClick:c,className:`flex items-center space-x-2 ${t.className||""}`,children:[t.icon,m&&e.jsx("span",{children:t.text})]}):e.jsxs(B,{variant:t.variant,className:`flex items-center space-x-1 cursor-pointer ${t.className||""}`,onClick:t.clickable?c:void 0,children:[t.icon,m&&e.jsx("span",{children:t.text})]})},he=({searchQuery:m,onSearchChange:b,onFiltersChange:h})=>{const n=q(),o=V(),{user:a}=M(),[j,c]=x.useState(!1),[C,t]=x.useState("signin"),[f,g]=x.useState({city:"Gaborone",country:"Botswana",loading:!0,error:null});x.useEffect(()=>{const s=async()=>{try{const r=await navigator.permissions.query({name:"geolocation"});r.state==="granted"?await l():r.state==="denied"?await v():await v()}catch{try{await l()}catch{await v()}}},l=async()=>{var r,i;try{const d=await new Promise(($,I)=>{navigator.geolocation.getCurrentPosition($,I,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),p=await fetch(`https://api.opencagedata.com/geocode/v1/json?q=${d.coords.latitude}+${d.coords.longitude}&key=4382106d8cc34d2e9c95f4dc83f23736`);if(!p.ok)throw new Error("Failed to fetch location data");const u=(i=(r=(await p.json()).results)==null?void 0:r[0])==null?void 0:i.components;u&&g({city:u.city||u.town||u.state||u.county||"Unknown",country:u.country||"Unknown",loading:!1,error:null})}catch(d){console.error("Location error:",d),g(p=>({...p,loading:!1,error:d instanceof Error?d.message:"Failed to get location"}))}},v=async()=>{try{const r=await fetch("https://ipapi.co/json/");if(!r.ok)throw new Error("Failed to fetch location data");const i=await r.json();g({city:i.city||"Gaborone",country:i.country_name||"Botswana",loading:!1,error:null})}catch{g(i=>({...i,loading:!1,error:null,city:"Gaborone",country:"Botswana"}))}};s()},[]);const{data:y}=A({queryKey:["profile"],queryFn:async()=>{if(!a)return null;const{data:s}=await k.from("profiles").select("avatar_url, full_name").eq("id",a.id).single();return s},enabled:!!a}),{data:w}=A({queryKey:["notification-count"],queryFn:async()=>{if(!a)return 0;const{count:s}=await k.from("notifications").select("id",{count:"exact"}).eq("user_id",a.id).eq("is_read",!1);return s||0},refetchInterval:3e4,enabled:!!a}),S=y!=null&&y.avatar_url?k.storage.from("avatars").getPublicUrl(y.avatar_url).data.publicUrl:null,_=s=>{console.log("Filters changed:",s),h({...s,searchQuery:m})},z=()=>{a?n("/profile"):(t("signin"),c(!0),n(`${o.pathname}?auth=signin`,{replace:!0}))},U=()=>{c(!1),n(o.pathname,{replace:!0})};x.useEffect(()=>{const l=new URLSearchParams(o.search).get("auth");(l==="signin"||l==="signup")&&(t(l),c(!0))},[o.search]);const E=f.loading?"Loading location...":f.error?"Gaborone, Botswana":`${f.city}, ${f.country}`;return e.jsxs("header",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-900 sticky top-0 z-10 shadow-sm p-6 md:p-8 rounded-b-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsx("img",{src:"/lovable-uploads/a065be26-80b7-4e50-b683-b6afb0add925.png",alt:"Mobirides Logo",className:"h-14 w-14 cursor-pointer",onClick:()=>n("/")}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-center gap-1 text-center",children:[e.jsx(ee,{className:"text-white h-4 w-4 flex-shrink-0"}),e.jsx("h3",{className:"text-xs md:text-sm lg:text-base font-normal text-gray-500 dark:text-white truncate",children:E})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{variant:"outline",size:"icon",className:"rounded-2xl  md:size-auto md:px-4 md:py-2 md:flex md:items-center md:gap-2",onClick:()=>n("/add-car"),children:[e.jsx(G,{className:"h-4 w-4 text-[#581CFA] dark:text-white"}),e.jsx("span",{className:"hidden md:inline-block",children:e.jsx("p",{className:"text-[#581CFA] dark:text-white text-xs md:text-sm lg:text-base font-semibold",children:"Add A Car"})})]}),a&&e.jsx("div",{className:"hidden sm:block",children:e.jsx(te,{variant:"button",size:"sm"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"rounded-full bg-gray-100 flex items-center justify-center",onClick:z,children:S&&a?e.jsxs(F,{className:"h-10 w-10",children:[e.jsx(O,{src:S,alt:"Profile"}),e.jsx(P,{children:"ðŸ‘¤"})]}):e.jsx(F,{className:"h-10 w-10",children:e.jsx(P,{children:"ðŸ‘¤"})})}),w&&w>0&&a&&e.jsx(B,{variant:"destructive",className:"absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 text-xs",children:w})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-8",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#581CFA] h-4 w-4 md:h-5 md:w-5  lg:h-6 lg:w-6"}),e.jsx("input",{type:"text",placeholder:"Search cars...",value:m,onChange:s=>b(s.target.value),className:"w-full h-12 md:h-14 pl-10 pr-4 py-2 rounded-2xl border border-gray-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 focus:outline-none focus:border-primary dark:focus:border-primary text-xs md:text-sm lg:text-base placeholder:text-xs md:placeholder:text-sm lg:placeholder:text-base dark:placeholder:text-gray-400"})]}),e.jsxs(T,{children:[e.jsx(J,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",className:"rounded-2xl w-12 md:w-14 h-12 md:h-14 flex items-center justify-center",children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsx(Q,{children:e.jsx(W,{onFiltersChange:_})})]})]}),e.jsx(K,{isOpen:j,onClose:U,defaultTab:C,idPrefix:"header"})]})};export{he as H};

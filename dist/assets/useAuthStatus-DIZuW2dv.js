import{r as s,s as n,J as h}from"./index-BAM2AQzj.js";const y=()=>{const[c,a]=s.useState(!1),[f,u]=s.useState(null),[d,l]=s.useState(!0),[g,i]=s.useState(null);return s.useEffect(()=>{(async()=>{try{console.log("Checking auth status...");const{data:{session:r},error:e}=await n.auth.getSession();if(e){console.error("Session error in useAuthStatus:",e),a(!1);return}const o=!!r;console.log("Auth status:",o?"Authenticated":"Not authenticated"),a(o),r!=null&&r.user&&(i(r.user.id),console.log("User ID set:",r.user.id))}catch(r){console.error("Error checking auth:",r),a(!1)}})();const{data:{subscription:t}}=n.auth.onAuthStateChange((r,e)=>{const o=!!e;console.log("Auth state changed:",o?"Authenticated":"Not authenticated"),a(o),e!=null&&e.user?(i(e.user.id),console.log("User ID updated:",e.user.id)):i(null)});return()=>t.unsubscribe()},[]),s.useEffect(()=>{(async()=>{try{if(!c){console.log("Not authenticated, skipping role fetch"),l(!1);return}l(!0),console.log("Fetching user role...");const{data:{session:t},error:r}=await n.auth.getSession();if(r){console.error("Session error in fetchUserRole:",r),h.error("Failed to fetch user session. Please try refreshing the page."),u(null),l(!1);return}if(!(t!=null&&t.user)){console.log("No active session or user"),u(null),l(!1);return}console.log("Fetching role for user ID:",t.user.id);const{data:e,error:o}=await n.from("profiles").select("role").eq("id",t.user.id).single();if(o){console.error("Profile error:",o);const A=o.message||"Failed to fetch user profile. Please try refreshing the page.";h.error(A),u(null)}else e&&(console.log("User role fetched:",e.role),u(e.role))}catch(t){console.error("Error fetching user role:",t),h.error("An unexpected error occurred. Please try refreshing the page.")}finally{l(!1)}})()},[c]),{isAuthenticated:c,userRole:f,isLoadingRole:d,userId:g}};export{y as u};

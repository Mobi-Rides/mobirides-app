import{j as e,u as F,a as Be,b as K}from"./query-vendor-C7aRRP05.js";import{r as N,u as ve}from"./react-vendor-mnpoGfEl.js";import{c as G,a2 as $e,a0 as $,aX as Me,a1 as Ve,D as ye,b as we,d as _e,e as be,f as z,I as J,S as Oe,g as He,h as Ke,i as ze,k as I,B as L,s as p,J as T,o as Ie,p as Qe,q as Je,v as y,an as Ae,P as Ce,T as se,ap as ae,ar as Ge,as as We,at as k,au as R,ao as Xe,ay as Ye}from"./index-D9LOOiBY.js";import{T as te,a as re,b as Q,c as A,d as ne,e as U}from"./table-CKvx3W7Q.js";import{C as x,a as h,b as _,c as b}from"./card-0dd-x2VS.js";import{S as D}from"./skeleton-BU-Dv0JS.js";import"./mapbox-vendor-fnXFVHMy.js";import{C as W}from"./calendar-hLJryCgl.js";import{S as Ze}from"./star-BwZJAYBL.js";import{M as es,U as ie}from"./user-check-DnjYO_2J.js";import{M as Se}from"./map-pin-BtopcvdL.js";import{C as De}from"./car-DvspwSJC.js";import{D as X}from"./dollar-sign-B1jdaRIG.js";import{E as ss,T as as}from"./trending-down-OHGdRO4h.js";import{W as le}from"./wallet-BZG54vbr.js";import{T as ts}from"./trending-up-x4PQ0P51.js";import{U as rs}from"./user-B9gAMDWP.js";import{F as ns}from"./file-text-CHck1lj0.js";import{C as is}from"./circle-check-big-rGt2oTzx.js";import{C as ls}from"./circle-x-D8kas66U.js";import{C as cs}from"./clock-CFBaLxjz.js";import{S as ce}from"./switch-xEB2jxfp.js";import{A as de,b as oe,c as me,d as xe,e as he,f as ue,g as je,h as pe}from"./alert-dialog-DENOFHqF.js";import{S as fe}from"./shield-Tr4U0OA6.js";import{C as ds}from"./chevron-left-D__dulFx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=G("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=G("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=G("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),xs=async(s,a)=>{try{const n=await $e();if(!n)return console.warn("No Mapbox token available, falling back to coordinates"),`Lat: ${s.toFixed(6)}, Lng: ${a.toFixed(6)}`;const o=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${a},${s}.json?access_token=${n}`);if(!o.ok)throw new Error(`Geocoding API error: ${o.status}`);const t=await o.json();return t.features&&t.features.length>0?t.features[0].place_name:`Lat: ${s.toFixed(6)}, Lng: ${a.toFixed(6)}`}catch(n){return console.error("Error in reverse geocoding:",n),`Lat: ${s.toFixed(6)}, Lng: ${a.toFixed(6)}`}},Le=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:$("mx-auto flex w-full justify-center",s),...a});Le.displayName="Pagination";const Te=N.forwardRef(({className:s,...a},n)=>e.jsx("ul",{ref:n,className:$("flex flex-row items-center gap-1",s),...a}));Te.displayName="PaginationContent";const O=N.forwardRef(({className:s,...a},n)=>e.jsx("li",{ref:n,className:$("",s),...a}));O.displayName="PaginationItem";const H=({className:s,isActive:a,size:n="icon",...o})=>e.jsx("a",{"aria-current":a?"page":void 0,className:$(Me({variant:a?"outline":"ghost",size:n}),s),...o});H.displayName="PaginationLink";const Fe=({className:s,...a})=>e.jsxs(H,{"aria-label":"Go to previous page",size:"default",className:$("gap-1 pl-2.5",s),...a,children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});Fe.displayName="PaginationPrevious";const Pe=({className:s,...a})=>e.jsxs(H,{"aria-label":"Go to next page",size:"default",className:$("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(Ve,{className:"h-4 w-4"})]});Pe.displayName="PaginationNext";const qe=({user:s,isOpen:a,onClose:n,onSuccess:o})=>{const[t,r]=N.useState(!1),[l,i]=N.useState(s.full_name||""),[m,j]=N.useState(s.role),[c,d]=N.useState(s.phone_number||""),v=async f=>{f.preventDefault(),r(!0);try{const{error:g}=await p.from("profiles").update({full_name:l.trim()||null,role:m,phone_number:c.trim()||null}).eq("id",s.id);if(g)throw g;o()}catch(g){console.error("Error updating user:",g),T.error("Failed to update user")}finally{r(!1)}};return e.jsx(ye,{open:a,onOpenChange:n,children:e.jsxs(we,{className:"sm:max-w-[425px]",children:[e.jsx(_e,{children:e.jsx(be,{children:"Edit User"})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"fullName",children:"Full Name"}),e.jsx(J,{id:"fullName",value:l,onChange:f=>i(f.target.value),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"role",children:"Role"}),e.jsxs(Oe,{value:m,onValueChange:f=>j(f),children:[e.jsx(He,{children:e.jsx(Ke,{placeholder:"Select a role"})}),e.jsxs(ze,{children:[e.jsx(I,{value:"renter",children:"Renter"}),e.jsx(I,{value:"host",children:"Host"}),e.jsx(I,{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(J,{id:"phoneNumber",value:c,onChange:f=>d(f.target.value),placeholder:"Enter phone number"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(L,{type:"button",variant:"outline",onClick:n,disabled:t,children:"Cancel"}),e.jsx(L,{type:"submit",disabled:t,children:t?"Updating...":"Update User"})]})]})]})})},hs=s=>F({queryKey:["user-profile",s],queryFn:async()=>{const{data:a,error:n}=await p.from("profiles").select("*").eq("id",s).single();if(n)throw n;return a}}),us=s=>F({queryKey:["user-stats",s],queryFn:async()=>{const{data:a,error:n}=await p.from("bookings").select("status").eq("renter_id",s);if(n)throw n;const{data:o,error:t}=await p.from("cars").select("id").eq("owner_id",s);if(t)throw t;const{data:r,error:l}=await p.from("reviews").select("rating").eq("reviewee_id",s);if(l)throw l;const i=(a==null?void 0:a.length)||0,m=(a==null?void 0:a.filter(c=>c.status==="completed").length)||0,j=r!=null&&r.length?r.reduce((c,d)=>c+d.rating,0)/r.length:0;return{totalBookings:i,completedBookings:m,hostedCars:(o==null?void 0:o.length)||0,averageRating:Number(j.toFixed(1)),totalReviews:(r==null?void 0:r.length)||0}}}),js=({user:s,onUpdate:a})=>{var v;const[n,o]=N.useState(!1),[t,r]=N.useState(null),{data:l,isLoading:i}=hs(s.id),{data:m,isLoading:j}=us(s.id),c=f=>{switch(f){case"admin":return"destructive";case"host":return"default";case"renter":return"secondary";default:return"outline"}};N.useEffect(()=>{(async()=>{if(l!=null&&l.latitude&&(l!=null&&l.longitude))try{const g=await xs(l.latitude,l.longitude);r(g)}catch(g){console.error("Failed to fetch address:",g),r(`${l.latitude.toFixed(4)}, ${l.longitude.toFixed(4)}`)}else r(null)})()},[l==null?void 0:l.latitude,l==null?void 0:l.longitude]);const d=()=>{o(!1),a==null||a()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(Ie,{className:"h-20 w-20",children:[e.jsx(Qe,{src:(l==null?void 0:l.avatar_url)||""}),e.jsx(Je,{className:"text-lg",children:((v=s.full_name)==null?void 0:v.charAt(0))||"U"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.full_name||"Unnamed User"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{variant:c(s.role),children:s.role}),(l==null?void 0:l.is_sharing_location)&&e.jsx(y,{variant:"outline",className:"text-green-600",children:"Location Sharing"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",new Date(s.created_at).toLocaleDateString()]})]}),(m==null?void 0:m.averageRating)>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ze,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsxs("span",{children:[m.averageRating," (",m.totalReviews," reviews)"]})]})]})]})]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>o(!0),children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Edit Profile"]})]})})}),e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Contact Information"})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.phone_number||"Not provided"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(es,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"Email not available"})]}),(l==null?void 0:l.latitude)&&(l==null?void 0:l.longitude)&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Location: ",t||"Loading address...",l.location_sharing_scope&&e.jsx(y,{variant:"outline",className:"ml-2",children:l.location_sharing_scope})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:j?"...":(m==null?void 0:m.totalBookings)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Bookings"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j?"...":(m==null?void 0:m.completedBookings)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Completed"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j?"...":(m==null?void 0:m.hostedCars)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cars Hosted"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:j?"...":(m==null?void 0:m.averageRating)||"0.0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Avg Rating"})]})})]})]}),n&&e.jsx(qe,{user:s,isOpen:n,onClose:()=>o(!1),onSuccess:d})]})},ps=s=>F({queryKey:["user-bookings",s],queryFn:async()=>{const{data:a,error:n}=await p.from("bookings").select(`
          *,
          cars (
            id, brand, model, image_url, owner_id,
            profiles:owner_id (full_name)
          )
        `).eq("renter_id",s).order("created_at",{ascending:!1});if(n)throw n;const{data:o,error:t}=await p.from("bookings").select(`
          *,
          cars!inner (
            id, brand, model, image_url, owner_id
          ),
          profiles:renter_id (full_name)
        `).eq("cars.owner_id",s).order("created_at",{ascending:!1});if(t)throw t;return{asRenter:a||[],asHost:o||[]}}}),fs=s=>{switch(s){case"confirmed":return"default";case"completed":return"secondary";case"cancelled":return"destructive";case"pending":return"outline";default:return"outline"}},gs=({userId:s})=>{var i,m,j,c;const a=ve(),{data:n,isLoading:o,error:t}=ps(s),r=d=>{a(`/admin/bookings?booking=${d}`)};if(o)return e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((d,v)=>e.jsx(D,{className:"h-32 w-full"},v))});if(t)return e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load bookings"})})});const l=[...((i=n==null?void 0:n.asRenter)==null?void 0:i.map(d=>({...d,role:"renter"})))||[],...((m=n==null?void 0:n.asHost)==null?void 0:m.map(d=>({...d,role:"host"})))||[]].sort((d,v)=>new Date(v.created_at).getTime()-new Date(d.created_at).getTime());return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:((j=n==null?void 0:n.asRenter)==null?void 0:j.length)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"As Renter"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((c=n==null?void 0:n.asHost)==null?void 0:c.length)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"As Host"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.filter(d=>d.status==="completed").length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Completed"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:l.filter(d=>d.status==="cancelled").length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cancelled"})]})})]}),e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Recent Bookings"})}),e.jsx(h,{children:l.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No bookings found"}):e.jsx("div",{className:"space-y-4",children:l.slice(0,10).map(d=>{var v,f,g;return e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-muted flex items-center justify-center",children:(v=d.cars)!=null&&v.image_url?e.jsx("img",{src:d.cars.image_url,alt:"Car",className:"w-full h-full object-cover rounded-lg"}):e.jsx(De,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("h4",{className:"font-semibold",children:[(f=d.cars)==null?void 0:f.brand," ",(g=d.cars)==null?void 0:g.model]}),e.jsx(y,{variant:fs(d.status),children:d.status}),e.jsxs(y,{variant:d.role==="renter"?"default":"secondary",children:["As ",d.role]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs("span",{children:[new Date(d.start_date).toLocaleDateString()," -",new Date(d.end_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("span",{children:["P",d.total_price]})]})]}),d.role==="renter"&&d.cars&&"profiles"in d.cars&&d.cars.profiles&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Host: ",d.cars.profiles.full_name||"Unknown"]}),d.role==="host"&&"profiles"in d&&d.profiles&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Renter: ",d.profiles.full_name||"Unknown"]})]})]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>r(d.id),children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"View"]})]})},d.id)})})})]})]})},Ns=s=>F({queryKey:["user-wallet",s],queryFn:async()=>{const{data:a,error:n}=await p.from("host_wallets").select("*").eq("host_id",s).single(),{data:o,error:t}=await p.from("wallet_transactions").select(`
          *,
          host_wallets!inner (host_id)
        `).eq("host_wallets.host_id",s).order("created_at",{ascending:!1}).limit(20);return{wallet:n?null:a,transactions:t?[]:o||[]}}}),vs=s=>{switch(s){case"topup":case"payment_received":return e.jsx(ts,{className:"h-4 w-4 text-green-600"});case"deduction":case"commission":return e.jsx(as,{className:"h-4 w-4 text-red-600"});default:return e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})}},ys=s=>{switch(s){case"topup":case"payment_received":return"default";case"deduction":case"commission":return"destructive";default:return"outline"}},ws=({userId:s})=>{var j;const{data:a,isLoading:n,error:o}=Ns(s);if(n)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(3)].map((c,d)=>e.jsx(D,{className:"h-24 w-full"},d))}),e.jsx(D,{className:"h-64 w-full"})]});if(o)return e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load wallet data"})})});const{wallet:t,transactions:r}=a||{},l=(r==null?void 0:r.length)||0,i=(r==null?void 0:r.filter(c=>c.transaction_type==="topup").length)||0,m=(r==null?void 0:r.filter(c=>c.transaction_type==="deduction").length)||0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(le,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["P",((j=t==null?void 0:t.balance)==null?void 0:j.toFixed(2))||"0.00"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Current Balance"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Transactions"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Top-ups"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:m}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Deductions"})]})})]}),e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Transaction History"})}),e.jsx(h,{children:t?(r==null?void 0:r.length)===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No transactions found"}):e.jsx("div",{className:"space-y-3",children:r==null?void 0:r.map(c=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[vs(c.transaction_type),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:c.description||c.transaction_type}),e.jsx(y,{variant:ys(c.transaction_type),children:c.transaction_type})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[new Date(c.created_at).toLocaleString(),c.booking_reference&&e.jsxs("span",{className:"ml-2",children:["Booking: ",c.booking_reference]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-bold ${c.transaction_type==="topup"||c.transaction_type==="payment_received"?"text-green-600":"text-red-600"}`,children:[c.transaction_type==="topup"||c.transaction_type==="payment_received"?"+":"-","P",Math.abs(c.amount).toFixed(2)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Balance: P",c.balance_after.toFixed(2)]})]})]})},c.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No wallet found for this user"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"User needs to have host role to have a wallet"})]})})]})]})},_s=s=>F({queryKey:["user-verification",s],queryFn:async()=>{const{data:a,error:n}=await p.from("user_verifications").select("*").eq("user_id",s).single(),{data:o,error:t}=await p.from("license_verifications").select("*").eq("user_id",s).single();return{verification:n?null:a,license:t?null:o}}}),Ne=s=>s===!0||s==="completed"||s==="verified"?e.jsx(is,{className:"h-5 w-5 text-green-600"}):s===!1||s==="rejected"?e.jsx(ls,{className:"h-5 w-5 text-red-600"}):e.jsx(cs,{className:"h-5 w-5 text-yellow-600"}),B=s=>s===!0||s==="completed"||s==="verified"?e.jsx(y,{variant:"default",children:"Verified"}):s===!1||s==="rejected"?e.jsx(y,{variant:"destructive",children:"Rejected"}):e.jsx(y,{variant:"outline",children:"Pending"}),bs=({userId:s})=>{const{data:a,isLoading:n,error:o}=_s(s);if(n)return e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((l,i)=>e.jsx(D,{className:"h-32 w-full"},i))});if(o)return e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load verification data"})})});const{verification:t,license:r}=a||{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Verification Status Overview"})}),e.jsx(h,{children:t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[Ne(t.overall_status),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Overall Status"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current step: ",t.current_step]})]})]}),B(t.overall_status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Personal Info"})]}),B(t.personal_info_completed)]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Phone Verified"})]}),B(t.phone_verified)]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Documents"})]}),B(t.documents_completed)]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Address Confirmed"})]}),B(t.address_confirmed)]})]}),t.rejection_reasons&&t.rejection_reasons.length>0&&e.jsxs(x,{className:"border-red-200",children:[e.jsx(_,{children:e.jsx(b,{className:"text-red-600",children:"Rejection Reasons"})}),e.jsx(h,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.rejection_reasons.map((l,i)=>e.jsx("li",{className:"text-sm text-red-600",children:l},i))})})]}),t.admin_notes&&e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Admin Notes"})}),e.jsx(h,{children:e.jsx("p",{className:"text-sm",children:t.admin_notes})})]})]}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No verification process started"})})]}),e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Driver's License Verification"})}),e.jsx(h,{children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[Ne(r.status),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"License Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.license_number?`License: ${r.license_number}`:"No license number"})]})]}),B(r.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-medium",children:"Personal Details"}),e.jsxs("div",{className:"text-sm space-y-1",children:[r.date_of_birth&&e.jsxs("p",{children:["Date of Birth: ",new Date(r.date_of_birth).toLocaleDateString()]}),r.country_of_issue&&e.jsxs("p",{children:["Country: ",r.country_of_issue]}),r.expiry_date&&e.jsxs("p",{children:["Expires: ",new Date(r.expiry_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-medium",children:"Documents"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Front Image"}),e.jsx(y,{variant:r.front_image_path?"default":"outline",children:r.front_image_path?"Uploaded":"Missing"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Back Image"}),e.jsx(y,{variant:r.back_image_path?"default":"outline",children:r.back_image_path?"Uploaded":"Missing"})]})]})]})]}),r.rejection_reason&&e.jsxs(x,{className:"border-red-200",children:[e.jsx(_,{children:e.jsx(b,{className:"text-red-600",children:"Rejection Reason"})}),e.jsx(h,{children:e.jsx("p",{className:"text-sm text-red-600",children:r.rejection_reason})})]})]}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No license verification submitted"})})]}),e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Verification Timeline"})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-3",children:[t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3 p-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Verification Started"}),e.jsx("span",{className:"text-muted-foreground ml-2",children:new Date(t.created_at).toLocaleString()})]})]}),t.last_updated_at!==t.created_at&&e.jsxs("div",{className:"flex items-center space-x-3 p-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Last Updated"}),e.jsx("span",{className:"text-muted-foreground ml-2",children:new Date(t.last_updated_at).toLocaleString()})]})]}),t.completed_at&&e.jsxs("div",{className:"flex items-center space-x-3 p-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Verification Completed"}),e.jsx("span",{className:"text-muted-foreground ml-2",children:new Date(t.completed_at).toLocaleString()})]})]})]}),r&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center space-x-3 p-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"License Submitted"}),e.jsx("span",{className:"text-muted-foreground ml-2",children:new Date(r.created_at).toLocaleString()})]})]})})]})})]})]})},As=s=>F({queryKey:["admin-status",s],queryFn:async()=>{const{data:a,error:n}=await p.from("admins").select("*").eq("id",s).single();return n?null:a}}),Cs=({user:s,onUpdate:a})=>{const n=ve(),o=Be(),[t,r]=N.useState(!1),[l,i]=N.useState(!1),[m,j]=N.useState(!1),{data:c,isLoading:d}=As(s.id),v=K({mutationFn:async({isSuperAdmin:w})=>{const{error:S}=await p.from("admins").insert({id:s.id,email:"email@example.com",full_name:s.full_name,is_super_admin:w});if(S)throw S},onSuccess:()=>{o.invalidateQueries({queryKey:["admin-status",s.id]}),o.invalidateQueries({queryKey:["admin-users"]}),T.success("User added as admin successfully"),a==null||a(),i(!1)},onError:w=>{console.error("Error adding admin:",w),T.error("Failed to add user as admin")}}),f=K({mutationFn:async()=>{const{error:w}=await p.from("admins").delete().eq("id",s.id);if(w)throw w},onSuccess:()=>{o.invalidateQueries({queryKey:["admin-status",s.id]}),o.invalidateQueries({queryKey:["admin-users"]}),T.success("Admin access removed successfully"),a==null||a(),r(!1)},onError:w=>{console.error("Error removing admin:",w),T.error("Failed to remove admin access")}}),g=K({mutationFn:async({isSuperAdmin:w})=>{const{error:S}=await p.from("admins").update({is_super_admin:w}).eq("id",s.id);if(S)throw S},onSuccess:()=>{o.invalidateQueries({queryKey:["admin-status",s.id]}),T.success("Admin privileges updated successfully"),a==null||a()},onError:w=>{console.error("Error updating admin:",w),T.error("Failed to update admin privileges")}}),P=()=>{v.mutate({isSuperAdmin:m})},M=()=>{f.mutate()},V=w=>{g.mutate({isSuperAdmin:w})},q=()=>{n(`/admin/management?user=${s.id}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(_,{children:e.jsxs(b,{className:"flex items-center space-x-2",children:[e.jsx(fe,{className:"h-5 w-5"}),e.jsx("span",{children:"Admin Access Status"})]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-muted",children:c?e.jsx(ie,{className:"h-5 w-5 text-green-600"}):e.jsx(ge,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Admin Access"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c?"User has admin access":"User does not have admin access"})]})]}),e.jsx(y,{variant:c?"default":"outline",children:c?"Admin":"No Access"})]}),c&&e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-muted",children:e.jsx(ms,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Super Admin"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Can manage other admins and system settings"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{checked:c.is_super_admin||!1,onCheckedChange:V,disabled:g.isPending}),e.jsx(y,{variant:c.is_super_admin?"destructive":"outline",children:c.is_super_admin?"Super Admin":"Regular Admin"})]})]})]})})]}),c&&e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Admin Details"})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Added:"}),e.jsx("span",{children:new Date(c.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Updated:"}),e.jsx("span",{children:new Date(c.updated_at).toLocaleString()})]}),c.last_sign_in_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Sign In:"}),e.jsx("span",{children:new Date(c.last_sign_in_at).toLocaleString()})]})]})]}),e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Admin Actions"})}),e.jsxs(h,{className:"space-y-3",children:[c?e.jsxs(L,{variant:"destructive",onClick:()=>r(!0),disabled:f.isPending,className:"w-full",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),f.isPending?"Removing...":"Remove Admin Access"]}):e.jsxs(L,{onClick:()=>i(!0),disabled:v.isPending,className:"w-full",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),v.isPending?"Adding...":"Add as Admin"]}),e.jsxs(L,{variant:"outline",onClick:q,className:"w-full",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"View in Admin Management"]})]})]}),e.jsx(de,{open:l,onOpenChange:i,children:e.jsxs(oe,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Add Admin Access"}),e.jsxs(he,{children:["Are you sure you want to give ",s.full_name||"this user"," admin access to the platform?"]})]}),e.jsx("div",{className:"my-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:"super-admin",checked:m,onCheckedChange:j}),e.jsx("label",{htmlFor:"super-admin",className:"text-sm font-medium",children:"Make Super Admin (can manage other admins)"})]})}),e.jsxs(ue,{children:[e.jsx(je,{children:"Cancel"}),e.jsx(pe,{onClick:P,children:"Add Admin"})]})]})}),e.jsx(de,{open:t,onOpenChange:r,children:e.jsxs(oe,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Remove Admin Access"}),e.jsxs(he,{children:["Are you sure you want to remove admin access for ",s.full_name||"this user","? This will revoke all admin privileges."]})]}),e.jsxs(ue,{children:[e.jsx(je,{children:"Cancel"}),e.jsx(pe,{onClick:M,className:"bg-destructive text-destructive-foreground",children:"Remove Access"})]})]})})]})},Ss=s=>F({queryKey:["user-activity",s],queryFn:async()=>{const a=[];try{const{data:n}=await p.from("bookings").select(`
            id, status, created_at, updated_at, total_price,
            cars (brand, model)
          `).or(`renter_id.eq.${s},cars.owner_id.eq.${s}`).order("updated_at",{ascending:!1}).limit(10);n==null||n.forEach(i=>{var m,j;a.push({id:`booking-${i.id}`,type:"booking",title:`Booking ${i.status}`,description:`${(m=i.cars)==null?void 0:m.brand} ${(j=i.cars)==null?void 0:j.model} - P${i.total_price}`,timestamp:i.updated_at,status:i.status,icon:W})});const{data:o}=await p.from("cars").select("id, brand, model, created_at, updated_at, is_available").eq("owner_id",s).order("updated_at",{ascending:!1}).limit(5);o==null||o.forEach(i=>{a.push({id:`car-${i.id}`,type:"car",title:"Car listing updated",description:`${i.brand} ${i.model} - ${i.is_available?"Available":"Unavailable"}`,timestamp:i.updated_at,status:i.is_available?"active":"inactive",icon:De})});const{data:t}=await p.from("wallet_transactions").select(`
            id, transaction_type, amount, created_at, description,
            host_wallets!inner (host_id)
          `).eq("host_wallets.host_id",s).order("created_at",{ascending:!1}).limit(5);t==null||t.forEach(i=>{a.push({id:`transaction-${i.id}`,type:"transaction",title:`Wallet ${i.transaction_type}`,description:i.description||`P${i.amount}`,timestamp:i.created_at,status:i.transaction_type,icon:X})});const{data:r}=await p.from("conversation_messages").select(`
            id, 
            content, 
            created_at, 
            message_type,
            sender_id,
            conversation:conversations!conversation_id (
              participants:conversation_participants (
                user_id
              )
            )
          `).eq("sender_id",s).order("created_at",{ascending:!1}).limit(5);r==null||r.forEach(i=>{a.push({id:`message-${i.id}`,type:"message",title:"Message sent",description:i.content.substring(0,50)+"...",timestamp:i.created_at,status:i.message_type,icon:ae})});const{data:l}=await p.from("conversation_messages").select(`
            id, 
            content, 
            created_at, 
            message_type,
            sender_id,
            conversation:conversations!conversation_id (
              participants:conversation_participants (
                user_id
              )
            )
          `).neq("sender_id",s).order("created_at",{ascending:!1}).limit(5);return l==null||l.forEach(i=>{var j,c;((c=(j=i.conversation)==null?void 0:j.participants)==null?void 0:c.some(d=>d.user_id===s))&&a.push({id:`received-message-${i.id}`,type:"message",title:"Message received",description:i.content.substring(0,50)+"...",timestamp:i.created_at,status:i.message_type,icon:ae})}),a.sort((i,m)=>new Date(m.timestamp).getTime()-new Date(i.timestamp).getTime())}catch(n){return console.error("Error fetching user activity:",n),[]}}}),Ds=(s,a)=>{switch(s){case"booking":switch(a){case"confirmed":return"default";case"completed":return"secondary";case"cancelled":return"destructive";default:return"outline"}case"transaction":switch(a){case"topup":return"default";case"deduction":return"destructive";default:return"outline"}case"car":return a==="active"?"default":"outline";default:return"outline"}},Ls=({userId:s})=>{const{data:a,isLoading:n,error:o}=Ss(s);return n?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((t,r)=>e.jsx(D,{className:"h-20 w-full"},r))}):o?e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2 text-destructive",children:[e.jsx(se,{className:"h-5 w-5"}),e.jsx("span",{children:"Failed to load activity data"})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:(a==null?void 0:a.filter(t=>t.type==="booking").length)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Booking Events"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(a==null?void 0:a.filter(t=>t.type==="car").length)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Car Updates"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(a==null?void 0:a.filter(t=>t.type==="transaction").length)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Transactions"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:(a==null?void 0:a.filter(t=>t.type==="message").length)||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Messages"})]})})]}),e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"Recent Activity"})}),e.jsx(h,{children:!a||a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(os,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No recent activity found"})]}):e.jsx("div",{className:"space-y-4",children:a.slice(0,20).map(t=>{const r=t.icon;return e.jsxs("div",{className:"flex items-start space-x-4 p-4 border rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-full bg-muted",children:e.jsx(r,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium truncate",children:t.title}),e.jsx(y,{variant:Ds(t.type,t.status),children:t.type})]}),e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:new Date(t.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 truncate",children:t.description})]})]},t.id)})})})]}),e.jsxs(x,{children:[e.jsx(_,{children:e.jsx(b,{children:"System Logs"})}),e.jsx(h,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(se,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"System logs integration coming soon"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This will show error logs, login attempts, and system interactions"})]})})]})]})},Ts=({user:s,isOpen:a,onClose:n,onUserUpdate:o})=>{const[t,r]=N.useState("overview");return s?e.jsx(ye,{open:a,onOpenChange:n,children:e.jsxs(we,{className:"max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx(_e,{children:e.jsxs(be,{className:"text-xl font-bold",children:[s.full_name||"Unnamed User"," - User Profile"]})}),e.jsxs(Ge,{value:t,onValueChange:r,className:"flex-1 overflow-hidden",children:[e.jsxs(We,{className:"grid w-full grid-cols-6",children:[e.jsx(k,{value:"overview",children:"Overview"}),e.jsx(k,{value:"bookings",children:"Bookings"}),e.jsx(k,{value:"transactions",children:"Transactions"}),e.jsx(k,{value:"verification",children:"Verification"}),e.jsx(k,{value:"admin",children:"Admin"}),e.jsx(k,{value:"activity",children:"Activity"})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[70vh] mt-4",children:[e.jsx(R,{value:"overview",className:"mt-0",children:e.jsx(js,{user:s,onUpdate:o})}),e.jsx(R,{value:"bookings",className:"mt-0",children:e.jsx(gs,{userId:s.id})}),e.jsx(R,{value:"transactions",className:"mt-0",children:e.jsx(ws,{userId:s.id})}),e.jsx(R,{value:"verification",className:"mt-0",children:e.jsx(bs,{userId:s.id})}),e.jsx(R,{value:"admin",className:"mt-0",children:e.jsx(Cs,{user:s,onUpdate:o})}),e.jsx(R,{value:"activity",className:"mt-0",children:e.jsx(Ls,{userId:s.id})})]})]})]})}):null},Fs=()=>F({queryKey:["admin-users"],queryFn:async()=>{const{data:s,error:a}=await p.from("profiles").select(`
          id, full_name, role, phone_number, created_at, avatar_url
        `).order("created_at",{ascending:!1});if(a)throw a;return s||[]}}),ta=({isPreview:s=!1,maxItems:a=5})=>{const[n,o]=N.useState(""),[t,r]=N.useState(null),[l,i]=N.useState(!1),[m,j]=N.useState(!1),{data:c,isLoading:d,error:v,refetch:f}=Fs(),g=(c==null?void 0:c.filter(u=>{var C,E;return((C=u.full_name)==null?void 0:C.toLowerCase().includes(n.toLowerCase()))||u.role.toLowerCase().includes(n.toLowerCase())||((E=u.phone_number)==null?void 0:E.includes(n))}))||[],[P,M]=N.useState(1),V=10,q=s?g.slice(0,a):g,w=s?q:q.slice((P-1)*V,P*V),S=Math.ceil(q.length/V),Ee=u=>{switch(u){case"admin":return"destructive";case"host":return"default";case"renter":return"secondary";default:return"outline"}},Ue=u=>{switch(u){case"verified":return"default";case"pending":return"secondary";case"rejected":return"destructive";default:return"outline"}},ke=u=>{r(u),i(!0)},Y=u=>{r(u),j(!0)},Z=()=>{f(),i(!1),j(!1),r(null),T.success("User updated successfully")},Re=()=>{j(!1),r(null)},ee=u=>e.jsxs(Q,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Y(u),children:[e.jsx(U,{className:"font-medium",children:u.full_name||"No name"}),e.jsx(U,{children:e.jsx(y,{variant:Ee(u.role),children:u.role})}),e.jsx(U,{children:e.jsx(y,{variant:"default",children:"Active"})}),e.jsx(U,{children:e.jsx(y,{variant:Ue("not_started"),children:"not started"})}),e.jsx(U,{children:u.phone_number||"N/A"}),e.jsx(U,{children:new Date(u.created_at).toLocaleDateString()}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:C=>{C.stopPropagation(),Y(u)},title:"View User Details",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:C=>{C.stopPropagation(),ke(u)},title:"Edit User",children:e.jsx(Ae,{className:"h-4 w-4"})})]})})]},u.id);return v?e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load users"})})}):s?d?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((u,C)=>e.jsx(D,{className:"h-16 w-full"},C))}):q.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No users found"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsxs(Q,{children:[e.jsx(A,{children:"Name"}),e.jsx(A,{children:"Role"}),e.jsx(A,{children:"Account Status"}),e.jsx(A,{children:"KYC Status"}),e.jsx(A,{children:"Phone"}),e.jsx(A,{children:"Joined"}),e.jsx(A,{children:"Actions"})]})}),e.jsx(ne,{children:q.map(u=>ee(u))})]})}),t&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{user:t,isOpen:l,onClose:()=>i(!1),onSuccess:Z}),e.jsx(Ts,{user:t,isOpen:m,onClose:Re,onUserUpdate:()=>{f(),Z()}})]})]}):e.jsxs(x,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs(b,{children:["Users (",g.length,")"]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(Xe,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Search users...",value:n,onChange:u=>o(u.target.value),className:"pl-8"})]})]})}),e.jsxs(h,{children:[d?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((u,C)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(D,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{className:"h-4 w-[200px]"}),e.jsx(D,{className:"h-4 w-[100px]"})]})]},C))}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsxs(Q,{children:[e.jsx(A,{children:"Name"}),e.jsx(A,{children:"Role"}),e.jsx(A,{children:"Account Status"}),e.jsx(A,{children:"KYC Status"}),e.jsx(A,{children:"Phone"}),e.jsx(A,{children:"Joined"}),e.jsx(A,{children:"Actions"})]})}),e.jsx(ne,{children:w.map(u=>ee(u))})]})}),!s&&S>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(Le,{children:e.jsxs(Te,{children:[e.jsx(O,{children:e.jsx(Fe,{onClick:()=>M(u=>Math.max(u-1,1)),className:P===1?"pointer-events-none opacity-50":"cursor-pointer"})}),[...Array(Math.min(S,5))].map((u,C)=>{const E=C+1;return e.jsx(O,{children:e.jsx(H,{onClick:()=>M(E),isActive:P===E,className:"cursor-pointer",children:E})},E)}),e.jsx(O,{children:e.jsx(Pe,{onClick:()=>M(u=>Math.min(u+1,S)),className:P===S?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]}),!d&&g.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No users found"})]})]})};export{Le as P,ta as U,Te as a,O as b,Fe as c,H as d,Pe as e};

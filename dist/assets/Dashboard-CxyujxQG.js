import{c as Q,p as Y,j as e,B as k,u as N,b as R,s as p,am as F,an as E,ao as f,ap as j,r as B}from"./index-BAM2AQzj.js";import{C as $,N as M}from"./Navigation-DcFnTla_.js";import{M as G,S as J}from"./sun-mP04Mqnv.js";import{A as O}from"./arrow-left-ZSxCSMqd.js";import{a as w}from"./useQuery-BBHzqejZ.js";import{S as g}from"./skeleton-nH5YszIf.js";import{C as X}from"./car-BcLi7tRD.js";import{C as L}from"./circle-check-big-CU0Wzt6B.js";import{C as S}from"./clock-DcRTzakL.js";import{C as H,a as U,b as W,d as z}from"./card-C82ETfr4.js";import{u as _,W as Z}from"./WalletBalanceIndicator-D8z27UAG.js";import{M as ee}from"./map-pin-CoQHT-KY.js";import{F as K}from"./file-text-CCBm04K0.js";import{f as C}from"./format-BOBWS5Wu.js";import{C as se}from"./circle-alert-CkQrh4MB.js";import{w as te}from"./TopUpModal-BwRCNlbi.js";import{A as ae,a as re}from"./alert-7WYzCt2j.js";import{T as le}from"./triangle-alert-ey-Y21ny.js";import"./badge-La64XLSg.js";import"./wallet-Bu1-cXfs.js";import"./plus-bFfdWSCz.js";import"./info-Bq3MZNaT.js";import"./credit-card-C7ZeWo_M.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=Q("CarFront",[["path",{d:"m21 8-2 2-1.5-3.7A2 2 0 0 0 15.646 5H8.4a2 2 0 0 0-1.903 1.257L5 10 3 8",key:"1imjwt"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 14h.01",key:"7oqj8z"}],["rect",{width:"18",height:"8",x:"3",y:"10",rx:"2",key:"a7itu8"}],["path",{d:"M5 18v2",key:"ppbyun"}],["path",{d:"M19 18v2",key:"gy7782"}]]);function ce(){const{theme:s,toggleTheme:a}=Y();return e.jsx(k,{variant:"ghost",size:"icon",onClick:a,"aria-label":"Toggle theme",className:"rounded-full",children:s==="light"?e.jsx(G,{className:"h-5 w-5"}):e.jsx(J,{className:"h-5 w-5"})})}const de=()=>{const s=N();return e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"py-2 flex items-center gap-4",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>s(-1),children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-foreground",children:"Dashboard"})]}),e.jsx(ce,{})]})},h=({title:s,value:a,icon:i,description:r,className:n,iconClassName:m})=>e.jsxs("div",{className:R("rounded-lg border bg-card p-4 shadow-sm dark:bg-card dark:border-border",n),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-sm text-muted-foreground",children:s}),e.jsx("div",{className:R("rounded-full p-2",m||"bg-primary/10"),children:e.jsx(i,{className:R("h-4 w-4",m?"text-white":"text-primary")})})]}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:a}),r&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r})]}),ie=()=>{const{data:s,isLoading:a}=w({queryKey:["renter-stats"],queryFn:async()=>{const{data:{user:i}}=await p.auth.getUser();if(!i)throw new Error("No user found");const{data:r,error:n}=await p.from("bookings").select("status").eq("renter_id",i.id);if(n)throw n;const m=r.length,x=r.filter(d=>d.status==="confirmed").length,l=r.filter(d=>d.status==="completed").length,t=r.filter(d=>d.status==="cancelled").length,o=r.filter(d=>d.status==="pending").length;return{total:m,active:x,completed:l,cancelled:t,pending:o}}});return a?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((i,r)=>e.jsx(g,{className:"h-24 w-full"},r))}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(h,{title:"Total Bookings",value:(s==null?void 0:s.total)||0,icon:X}),e.jsx(h,{title:"Active Trips",value:(s==null?void 0:s.active)||0,icon:$,iconClassName:"bg-blue-500"}),e.jsx(h,{title:"Completed Trips",value:(s==null?void 0:s.completed)||0,icon:L,iconClassName:"bg-green-500"}),e.jsx(h,{title:"Pending Bookings",value:(s==null?void 0:s.pending)||0,icon:S,iconClassName:"bg-amber-500"})]})},T=({bookings:s,tabType:a,emptyMessage:i,onCardClick:r})=>{const n=N(),m=_();if(!(s!=null&&s.length))return e.jsx("p",{className:"text-muted-foreground text-center py-4",children:i});const x=t=>{switch(t){case"confirmed":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"completed":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400"}},l=t=>{switch(t){case"active":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"upcoming":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400";case"past":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400"}};return e.jsx("div",{className:"grid gap-4",children:s.map(t=>e.jsx(H,{className:"cursor-pointer hover:shadow-md transition-shadow dark:bg-card dark:border-border overflow-hidden",onClick:()=>r(t.id),children:e.jsxs("div",{className:"grid grid-cols-[100px_1fr] xs:grid-cols-[120px_1fr] sm:grid-cols-[180px_1fr]",children:[e.jsx("div",{className:"h-full max-h-[100px] xs:max-h-[120px] sm:max-h-none",children:e.jsx("img",{src:t.cars.image_url,alt:`${t.cars.brand} ${t.cars.model}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(U,{className:"pb-1 sm:pb-2 p-2 sm:p-4",children:e.jsxs(W,{className:"text-sm sm:text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"truncate pr-2",children:[t.cars.brand," ",t.cars.model]}),e.jsx("span",{className:`text-xs font-normal px-2 py-1 rounded-full ${a==="active"?l("active"):x(t.status)}`,children:a==="active"?"Active":t.status})]})}),e.jsx(z,{className:"p-2 sm:p-4 pt-0",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-red-500 flex items-center gap-1",children:[e.jsx(ee,{size:16})," ",e.jsx("span",{className:"text-foreground",children:t.cars.location})]}),e.jsxs("p",{className:"text-xs sm:text-sm font-medium text-primary",children:["BWP ",t.total_price]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 sm:gap-2 pt-0 sm:pt-1",children:[e.jsxs("div",{className:"bg-muted/50 rounded-md p-1 sm:p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Pickup"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:C(new Date(t.start_date),"PP")})]}),e.jsxs("div",{className:"bg-muted/50 rounded-md p-1 sm:p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"Return"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:C(new Date(t.end_date),"PP")})]})]}),a==="past"&&t.status==="completed"&&e.jsx("div",{className:"flex justify-end pt-1",children:e.jsxs(k,{variant:"outline",size:m?"sm":"default",className:"text-xs sm:text-sm h-7 sm:h-9",onClick:o=>{o.stopPropagation(),n(`/rental-details/${t.id}?print=true`)},children:[e.jsx(K,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Receipt"})]})})]})})]})]})},t.id))})},oe=()=>{const s=N();_();const{data:a,isLoading:i}=w({queryKey:["renter-bookings"],queryFn:async()=>{const{data:{user:t}}=await p.auth.getUser();if(!t)throw new Error("No user found");console.log("Fetching renter bookings");const{data:o,error:d}=await p.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            location,
            image_url,
            owner_id,
            price_per_day
          ),
          reviews!reviews_booking_id_fkey (
            id
          )
        `).eq("renter_id",t.id).order("start_date",{ascending:!0});if(d)throw d;return console.log("Renter bookings:",o),o}});if(i)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((t,o)=>e.jsx(g,{className:"h-24 w-full"},o))}),e.jsx(g,{className:"h-32 w-full"}),e.jsx(g,{className:"h-32 w-full"})]});const r=new Date,n=a==null?void 0:a.filter(t=>{const o=new Date(t.end_date),d=t.reviews&&t.reviews.length>0;return t.status==="confirmed"&&new Date(t.start_date)<=r&&(o>=r||!d)}),m=a==null?void 0:a.filter(t=>(t.status==="pending"||t.status==="confirmed")&&new Date(t.start_date)>r),x=a==null?void 0:a.filter(t=>{const o=new Date(t.end_date),d=t.reviews&&t.reviews.length>0;return t.status==="completed"||t.status==="cancelled"||o<r&&d}),l=t=>{s(`/rental-details/${t}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{}),e.jsxs(F,{defaultValue:"active",className:"bg-card rounded-lg p-3 sm:p-4 shadow-sm dark:border dark:border-border",children:[e.jsxs(E,{className:"mb-4 w-full justify-start overflow-x-auto scrollbar-none",children:[e.jsx(f,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"active",children:"Active Rentals"}),e.jsx(f,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"upcoming",children:"Upcoming"}),e.jsx(f,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"past",children:"Past Rentals"})]}),e.jsx(j,{value:"active",children:e.jsx(T,{bookings:n,tabType:"active",emptyMessage:"No active rentals",onCardClick:l})}),e.jsx(j,{value:"upcoming",children:e.jsx(T,{bookings:m,tabType:"upcoming",emptyMessage:"No upcoming rentals",onCardClick:l})}),e.jsx(j,{value:"past",children:e.jsx(T,{bookings:x,tabType:"past",emptyMessage:"No past rentals",onCardClick:l})})]})]})},me=()=>{const{data:s,isLoading:a}=w({queryKey:["host-stats"],queryFn:async()=>{const{data:{user:i}}=await p.auth.getUser();if(!i)throw new Error("No user found");const{data:r,error:n}=await p.from("cars").select("id").eq("owner_id",i.id);if(n)throw n;if(!r.length)return{total:0,confirmed:0,completed:0,cancelled:0,pending:0};const m=r.map(u=>u.id),{data:x,error:l}=await p.from("bookings").select("status").in("car_id",m);if(l)throw l;const t=x.length,o=x.filter(u=>u.status==="confirmed").length,d=x.filter(u=>u.status==="pending").length,q=x.filter(u=>u.status==="completed").length,v=x.filter(u=>u.status==="cancelled").length;return{total:t,confirmed:o,completed:q,cancelled:v,pending:d}}});return a?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((i,r)=>e.jsx(g,{className:"h-24 w-full"},r))}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(h,{title:"Total Bookings",value:(s==null?void 0:s.total)||0,icon:ne}),e.jsx(h,{title:"Active Rentals",value:(s==null?void 0:s.confirmed)||0,icon:$,iconClassName:"bg-blue-500"}),e.jsx(h,{title:"Completed",value:(s==null?void 0:s.completed)||0,icon:L,iconClassName:"bg-green-500"}),e.jsx(h,{title:"Pending Requests",value:(s==null?void 0:s.pending)||0,icon:S,iconClassName:"bg-amber-500"})]})},b=({bookings:s,tabType:a,emptyMessage:i,onCardClick:r})=>{const n=N(),m=_();if(!(s!=null&&s.length))return e.jsx("p",{className:"text-muted-foreground text-center py-4",children:i});const x=l=>{switch(l){case"active":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"expired":return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400";case"completed":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400"}};return e.jsx("div",{className:"grid gap-4",children:s.map(l=>{var t;return e.jsx(H,{className:"cursor-pointer hover:shadow-md transition-shadow dark:bg-card dark:border-border overflow-hidden",onClick:()=>r(l.id),children:e.jsxs("div",{className:"grid grid-cols-[100px_1fr] xs:grid-cols-[120px_1fr] sm:grid-cols-[180px_1fr]",children:[e.jsx("div",{className:"h-full max-h-[100px] xs:max-h-[120px] sm:max-h-none",children:e.jsx("img",{src:l.cars.image_url,alt:`${l.cars.brand} ${l.cars.model}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(U,{className:"pb-1 sm:pb-2 p-2 sm:p-4",children:e.jsxs(W,{className:"text-sm sm:text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"truncate pr-2",children:[l.cars.brand," ",l.cars.model]}),e.jsxs("span",{className:`text-xs font-normal px-2 py-1 rounded-full ${x(a)}`,children:[a==="active"&&"Active",a==="pending"&&"Pending",a==="expired"&&"Expired",a==="completed"&&"Completed"]})]})}),e.jsx(z,{className:"p-2 sm:p-4 pt-0",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Rented by: ",e.jsx("span",{className:"text-foreground",children:((t=l.renter)==null?void 0:t.full_name)||"Unknown"})]}),e.jsxs("p",{className:"text-xs sm:text-sm font-medium text-primary",children:["BWP ",l.total_price]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 sm:gap-2 pt-0 sm:pt-1",children:[e.jsxs("div",{className:"bg-muted/50 rounded-md p-1 sm:p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"From"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:C(new Date(l.start_date),"PP")})]}),e.jsxs("div",{className:"bg-muted/50 rounded-md p-1 sm:p-2",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:"To"}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:C(new Date(l.end_date),"PP")})]})]}),a==="expired"&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mt-2",children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Request expired without response"})]}),a==="completed"&&l.status==="completed"&&e.jsx("div",{className:"flex justify-end pt-1",children:e.jsxs(k,{variant:"outline",size:m?"sm":"default",className:"text-xs sm:text-sm h-7 sm:h-9",onClick:o=>{o.stopPropagation(),n(`/rental-details/${l.id}?print=true`)},children:[e.jsx(K,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Receipt"})]})})]})})]})]})},l.id)})})},xe=()=>{const s=N();_();const{data:a,isLoading:i}=w({queryKey:["host-bookings"],queryFn:async()=>{const{data:{user:c}}=await p.auth.getUser();if(!c)throw new Error("No user found");console.log("Fetching host bookings");const{data:y,error:D}=await p.from("cars").select("id").eq("owner_id",c.id);if(D)throw D;if(!y.length)return[];const I=y.map(V=>V.id),{data:P,error:A}=await p.from("bookings").select(`
          *,
          cars (
            brand,
            model,
            location,
            image_url,
            owner_id,
            price_per_day
          ),
          renter:profiles!renter_id (
            full_name
          )
        `).in("car_id",I).order("created_at",{ascending:!1});if(A)throw A;return console.log("Host bookings:",P),P}}),{data:r}=w({queryKey:["current-user"],queryFn:async()=>{const{data:{user:c}}=await p.auth.getUser();return c}}),{data:n}=w({queryKey:["wallet-balance",r==null?void 0:r.id],queryFn:async()=>r!=null&&r.id?await te.getWalletBalance(r.id):null,enabled:!!(r!=null&&r.id)});if(i)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[...Array(5)].map((c,y)=>e.jsx(g,{className:"h-24 w-full"},y))}),e.jsx(g,{className:"h-32 w-full"})]});const m=new Date,x=a==null?void 0:a.filter(c=>c.status==="confirmed"&&new Date(c.start_date)<=m&&new Date(c.end_date)>=m),l=a==null?void 0:a.filter(c=>c.status==="pending"),t=a==null?void 0:a.filter(c=>c.status==="expired"),o=a==null?void 0:a.filter(c=>c.status==="completed"||c.status==="confirmed"&&new Date(c.end_date)<m),d=c=>{s(`/rental-details/${c}`)},q=c=>{s(`/booking-requests/${c}`)},v=(n==null?void 0:n.balance)||0,u=v<50;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(me,{}),u&&e.jsxs(ae,{variant:"destructive",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsxs(re,{children:["Low wallet balance (P",v.toFixed(2),"). You may not be able to accept new booking requests.",e.jsx("span",{className:"underline cursor-pointer ml-1",onClick:()=>s("/wallet"),children:"Top up your wallet"})]})]}),e.jsx("div",{className:"bg-card rounded-lg p-4 shadow-sm dark:border dark:border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Wallet Balance"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Available for booking commissions"})]}),e.jsx(Z,{compact:!0})]})}),e.jsxs(F,{defaultValue:"active",className:"bg-card rounded-lg p-3 sm:p-4 shadow-sm dark:border dark:border-border",children:[e.jsxs(E,{className:"mb-4 w-full justify-start overflow-x-auto scrollbar-none",children:[e.jsx(f,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"active",children:"Active Rentals"}),e.jsx(f,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"pending",children:"Booking Requests"}),e.jsx(f,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"expired",children:"Expired Requests"}),e.jsx(f,{className:"px-2 sm:px-3 text-xs sm:text-sm whitespace-nowrap",value:"completed",children:"Past Rentals"})]}),e.jsx(j,{value:"active",children:e.jsx(b,{bookings:x,tabType:"active",emptyMessage:"No active rentals",onCardClick:d})}),e.jsx(j,{value:"pending",children:e.jsx(b,{bookings:l,tabType:"pending",emptyMessage:"No booking requests",onCardClick:q})}),e.jsx(j,{value:"expired",children:e.jsx(b,{bookings:t,tabType:"expired",emptyMessage:"No expired requests",onCardClick:d})}),e.jsx(j,{value:"completed",children:e.jsx(b,{bookings:o,tabType:"completed",emptyMessage:"No completed rentals",onCardClick:d})})]})]})},Ee=()=>{const[s,a]=B.useState(null);return B.useEffect(()=>{(async()=>{const{data:{user:r}}=await p.auth.getUser();if(!r)return;console.log("Fetching user role for dashboard");const{data:n}=await p.from("profiles").select("role").eq("id",r.id).single();n!=null&&n.role&&(console.log("User role:",n.role),a(n.role))})()},[]),s?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 py-3 sm:py-4 pb-20",children:[e.jsx(de,{}),e.jsx("div",{className:"mt-2",children:s==="renter"?e.jsx(oe,{}):e.jsx(xe,{})}),e.jsx(M,{})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(g,{className:"h-8 w-48 mb-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((i,r)=>e.jsx(g,{className:"h-24 w-full"},r))}),e.jsx(g,{className:"h-32 w-full"}),e.jsx(g,{className:"h-32 w-full"})]})]}),e.jsx(M,{})]})};export{Ee as default};

import{j as t}from"./query-vendor-BOSMW7hd.js";import{u as w,r as i}from"./react-vendor-DmU5vXC9.js";import{l as F,u as U,B as I,q as V,s as a}from"./index-ahmQo-Zq.js";import{N as k}from"./Navigation-DgaHbxsQ.js";import{C as L}from"./CarForm-DlvkD3j4.js";import{V as Y}from"./VerificationRequiredDialog-DSKmhISw.js";import{u as A}from"./useVerificationStatus-5lh3U-on.js";import"./supabase-vendor-B3A6ooRR.js";import"./mapbox-vendor-ueN8uhVJ.js";import"./date-vendor-Dhms5dOu.js";import"./map-pin-BTmNqwoj.js";import"./bell-D3eElkfC.js";import"./user-7MMf2PMh.js";import"./select-BGtNurN5.js";import"./index-CEVvJeOa.js";import"./chevron-down-BDcPfNun.js";import"./ImageUpload-BCsrutM3.js";import"./camera-D85mMN_S.js";import"./separator-DIiRVttn.js";import"./checkbox-CaDJ_hBv.js";import"./shield-DYICiwOR.js";import"./file-text-Cdr2LMFF.js";import"./circle-check-big-uJiWdFVJ.js";import"./arrow-right-B6hAkUh0.js";const le=()=>{const o=w(),{toast:n}=F(),{theme:O}=U(),[f,d]=i.useState(!1),[m,h]=i.useState(null),[x,b]=i.useState([]),[y,p]=i.useState(!1),{isVerified:v,isLoading:S}=A(),_={brand:"",model:"",year:new Date().getFullYear(),vehicle_type:"",price_per_day:"",location:"",transmission:"",fuel:"",seats:0,description:"",latitude:0,longitude:0,features:[]};i.useEffect(()=>{(async()=>{const{data:{session:s}}=await a.auth.getSession();if(!(s!=null&&s.user)){o("/login");return}h(s.user.id)})()},[o]);const j=async(e,s,P,c)=>{if(console.log("Starting car submission process..."),console.log("Selected features:",c),!m){n({title:"Error",description:"You must be logged in to add a car",variant:"destructive"});return}if(!v&&!S){p(!0);return}d(!0);try{let r=null;if(s){console.log("Uploading main car image...");const E=s.name.split(".").pop(),g=`${`${crypto.randomUUID()}.${E}`}`,{error:u}=await a.storage.from("car-images").upload(g,s);if(u)throw console.error("Error uploading car image:",u),u;const{data:{publicUrl:N}}=a.storage.from("car-images").getPublicUrl(g);r=N,console.log("Car image uploaded successfully:",r)}console.log("Inserting car data into database..."),console.log("Features to insert:",c);const{error:l}=await a.from("cars").insert({owner_id:m,image_url:r,price_per_day:parseFloat(e.price_per_day),year:parseInt(e.year.toString()),seats:e.seats,brand:e.brand,model:e.model,vehicle_type:e.vehicle_type,location:e.location,transmission:e.transmission,fuel:e.fuel,description:e.description,features:c||[],is_available:!0});if(l)throw console.error("Error inserting car data:",l),l;console.log("Car listed successfully!"),n({title:"Success",description:"Your car has been listed successfully!"}),o("/")}catch(r){console.error("Error adding car:",r),n({title:"Error",description:"Failed to add your car. Please try again.",variant:"destructive"})}finally{d(!1)}},C=e=>{console.log("Features changed in AddCar:",e),b(e)};return t.jsxs("div",{className:"min-h-screen bg-background text-foreground pb-20",children:[t.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(I,{variant:"ghost",size:"icon",onClick:()=>o(-1),className:"shrink-0",children:t.jsx(V,{className:"h-5 w-5"})}),t.jsx("h1",{className:"text-2xl font-semibold",children:"List Your Car"})]}),t.jsx(L,{initialData:_,selectedFeatures:x,onFeaturesChange:C,onSubmit:j,isSubmitting:f})]}),t.jsx(k,{}),t.jsx(Y,{isOpen:y,onClose:()=>p(!1),action:"listing"})]})};export{le as default};

import{j as e}from"./query-vendor-C7aRRP05.js";import{h as j,u as N,r as a}from"./react-vendor-mnpoGfEl.js";import{aA as x,s as w,J as v}from"./index-BG7cKZ7G.js";import{C}from"./circle-x-D9G79Nca.js";import{L as g}from"./loader-circle-CiyBGv-L.js";import{M as E}from"./mail-DGP65GzA.js";import{C as P}from"./circle-check-big-CAiBy3AQ.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";const B=()=>{const[f]=j(),t=N(),[h,i]=a.useState("loading"),[m,r]=a.useState(""),[l,p]=a.useState(""),[c,d]=a.useState(!1),n=f.get("token"),u=a.useCallback(async()=>{if(n)try{const s=await x.confirmEmail(n);if(s.success&&s.userData){i("success"),r("Your email has been confirmed successfully! Signing you in...");try{const{error:o}=await w.auth.signInWithPassword({email:s.userData.email,password:s.userData.password});o?(console.error("Auto sign-in failed:",o),r("Email confirmed successfully! Please sign in to your account."),setTimeout(()=>{t("/auth?tab=signin")},3e3)):(v.success("Welcome to MobiRides! You are now signed in."),setTimeout(()=>{t("/dashboard")},2e3))}catch(o){console.error("Auto sign-in error:",o),r("Email confirmed successfully! Please sign in to your account."),setTimeout(()=>{t("/auth?tab=signin")},3e3)}}else i("error"),r(s.error||"Failed to confirm email. Please try again.")}catch(s){console.error("Error confirming email:",s),i("error"),r("An unexpected error occurred. Please try again.")}},[n,t,i,r]);a.useEffect(()=>{if(!n){i("error"),r("Invalid confirmation link. Please check your email and try again.");return}u()},[n,u]);const y=async()=>{if(!l.trim()){alert("Please enter your email address");return}d(!0);try{const s=await x.resendConfirmation(l);s.success?alert("Confirmation email sent! Please check your inbox."):alert(s.error||"Failed to resend confirmation email.")}catch(s){console.error("Error resending confirmation:",s),alert("An unexpected error occurred. Please try again.")}finally{d(!1)}},b=()=>{switch(h){case"loading":return e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"w-16 h-16 text-purple-600 animate-spin mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Confirming your email..."}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we verify your email address."})]});case"success":return e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Email Confirmed!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:m}),e.jsx("p",{className:"text-sm text-gray-500",children:"Redirecting you to dashboard..."})]});case"error":return e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"w-16 h-16 text-red-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Confirmation Failed"}),e.jsx("p",{className:"text-gray-600 mb-6",children:m}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Need help?"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter your email to resend confirmation:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",id:"email",value:l,onChange:s=>p(s.target.value),placeholder:"your@email.com",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),e.jsxs("button",{onClick:y,disabled:c,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[c?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(E,{className:"w-4 h-4"}),c?"Sending...":"Resend"]})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsx("button",{onClick:()=>t("/auth?tab=signup"),className:"w-full px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Back to Sign Up"})})]})]})]});default:return null}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsx("div",{className:"text-center",children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Welcome to ",e.jsx("span",{className:"text-purple-600",children:"MobiRides"})]})}),e.jsx("div",{className:"bg-white shadow-lg rounded-lg p-8",children:b()})]})})};export{B as default};

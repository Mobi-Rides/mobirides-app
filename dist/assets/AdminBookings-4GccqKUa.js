import{j as e,u as L}from"./query-vendor-BOSMW7hd.js";import{T,a as S,b as f,c as n,d as A,e as c,A as D,f as F}from"./table-2B-J3H-b.js";import{r as R}from"./react-vendor-DmU5vXC9.js";import{an as $,I as b,n as k,B as o,s as y,J as w}from"./index-BZNlRMb5.js";import{C as v,d as C,a as q,b as z}from"./card-B-j8bacD.js";import{S as m}from"./skeleton-CFM6Me78.js";import"./separator-DMJBHfrz.js";import"./sheet-DJBFNrft.js";import"./car-DZKAUCoq.js";import"./credit-card-BMie6ekS.js";import"./message-square-C383hf7k.js";import"./house-D8QY98bG.js";import"./settings-BE9fjUFx.js";import"./log-out-Bd_HTe8K.js";import"./useIsAdmin-DUkFuP_R.js";import"./supabase-vendor-B3A6ooRR.js";import"./mapbox-vendor-ueN8uhVJ.js";import"./date-vendor-Dhms5dOu.js";const E=()=>L({queryKey:["admin-bookings"],queryFn:async()=>{const{data:r,error:i}=await y.from("bookings").select(`
          id, start_date, end_date, total_price, status, created_at, renter_id, car_id,
          cars:car_id (brand, model, year),
          renter:renter_id (full_name)
        `).order("created_at",{ascending:!1});if(i)throw i;return r||[]}}),H=()=>{const[r,i]=R.useState(""),{data:l,isLoading:N,error:_,refetch:g}=E(),x=(l==null?void 0:l.filter(s=>{var a,t,u,h,p,j;return((t=(a=s.cars)==null?void 0:a.brand)==null?void 0:t.toLowerCase().includes(r.toLowerCase()))||((h=(u=s.cars)==null?void 0:u.model)==null?void 0:h.toLowerCase().includes(r.toLowerCase()))||((j=(p=s.renter)==null?void 0:p.full_name)==null?void 0:j.toLowerCase().includes(r.toLowerCase()))||s.status.toLowerCase().includes(r.toLowerCase())}))||[],B=s=>{switch(s){case"confirmed":return"default";case"pending":return"secondary";case"completed":return"outline";case"cancelled":return"destructive";default:return"outline"}},d=async(s,a)=>{try{const{error:t}=await y.from("bookings").update({status:a}).eq("id",s);if(t)throw t;g(),w.success(`Booking ${a} successfully`)}catch(t){console.error("Error updating booking:",t),w.error("Failed to update booking")}};return _?e.jsx(v,{children:e.jsx(C,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load bookings"})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx($,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(b,{placeholder:"Search bookings...",value:r,onChange:s=>i(s.target.value),className:"pl-8"})]})}),e.jsxs(v,{children:[e.jsx(q,{children:e.jsxs(z,{children:["Bookings (",x.length,")"]})}),e.jsx(C,{children:N?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(m,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"h-4 w-[200px]"}),e.jsx(m,{className:"h-4 w-[100px]"})]})]},a))}):e.jsxs(T,{children:[e.jsx(S,{children:e.jsxs(f,{children:[e.jsx(n,{children:"Vehicle"}),e.jsx(n,{children:"Renter"}),e.jsx(n,{children:"Dates"}),e.jsx(n,{children:"Total"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Created"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(A,{children:x.map(s=>{var a;return e.jsxs(f,{children:[e.jsx(c,{className:"font-medium",children:s.cars?`${s.cars.brand} ${s.cars.model} (${s.cars.year})`:"Unknown Vehicle"}),e.jsx(c,{children:((a=s.renter)==null?void 0:a.full_name)||"Unknown"}),e.jsx(c,{children:e.jsxs("div",{className:"text-sm",children:[new Date(s.start_date).toLocaleDateString()," -",new Date(s.end_date).toLocaleDateString()]})}),e.jsxs(c,{children:["P",s.total_price]}),e.jsx(c,{children:e.jsx(k,{variant:B(s.status),children:s.status})}),e.jsx(c,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>d(s.id,"confirmed"),children:"Approve"}),e.jsx(o,{variant:"destructive",size:"sm",onClick:()=>d(s.id,"cancelled"),children:"Cancel"})]}),s.status==="confirmed"&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>d(s.id,"completed"),children:"Complete"})]})})]},s.id)})})]})})]})]})},te=()=>e.jsx(D,{children:e.jsx(F,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Booking Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor all bookings, manage disputes, and track rental activity"})]}),e.jsx(H,{})]})})});export{te as default};

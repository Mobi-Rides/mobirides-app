import{j as s}from"./query-vendor-C7aRRP05.js";import{r as t,u as A}from"./react-vendor-mnpoGfEl.js";import{s as c,J as u,o as $,p as k,q as I,f as v,I as j,S as L,g as V,h as q,i as B,j as J,k as O,B as R}from"./index-CfXH57CA.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";const T=({profileData:e})=>{const[d,m]=t.useState(!1),[l,g]=t.useState((e==null?void 0:e.full_name)||""),[a,i]=t.useState(e!=null&&e.phone_number?e.phone_number.slice(4):""),[o,N]=t.useState(e!=null&&e.phone_number?e.phone_number.slice(0,4):"+267"),[x,p]=t.useState((e==null?void 0:e.avatar_url)||""),[y,w]=t.useState(!1),P=A();t.useEffect(()=>{e&&(g(e.full_name||""),i(e!=null&&e.phone_number?e.phone_number.slice(4):""),N(e!=null&&e.phone_number?e.phone_number.slice(0,4):"+267"),p(e.avatar_url||""))},[e]);const f=r=>r.replace(/[^\d+]/g,""),C=async()=>{try{m(!0);const r=f(`${o}${a}`),n={id:e==null?void 0:e.id,full_name:l,phone_number:r,updated_at:new Date().toISOString(),avatar_url:x},{error:h}=await c.from("profiles").upsert(n);if(h)throw h;u.success("Profile updated successfully!"),P("/profile")}catch(r){console.error("Error updating profile:",r),u.error("Failed to update profile")}finally{m(!1)}},E=async r=>{try{if(w(!0),!r.target.files||r.target.files.length===0)throw new Error("You must select an image to upload.");const n=r.target.files[0],h=n.name.split(".").pop(),b=`${`${e==null?void 0:e.id}.${h}`}`,{error:_}=await c.storage.from("avatars").upload(b,n,{cacheControl:"3600",upsert:!1});if(_)throw _;const{data:U}=c.storage.from("avatars").getPublicUrl(b);p(U.publicUrl);const F={id:e==null?void 0:e.id,full_name:l,phone_number:f(`${o}${a}`),updated_at:new Date().toISOString(),avatar_url:b},{error:S}=await c.from("profiles").upsert(F);if(S)throw S;u.success("Avatar updated successfully!")}catch(n){console.error("Error uploading avatar:",n),u.error("Failed to upload avatar")}finally{w(!1)}};return s.jsx("div",{className:"container mx-auto mt-8 p-4",children:s.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[s.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Edit Profile"}),s.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[s.jsx($,{className:"h-24 w-24 rounded-full overflow-hidden mb-2",children:x?s.jsx(k,{src:x,alt:"Avatar"}):s.jsx(I,{children:e!=null&&e.full_name?e.full_name[0].toUpperCase():"ðŸ‘¤"})}),s.jsxs(v,{htmlFor:"avatar",className:"cursor-pointer",children:[y?"Uploading...":"Change Avatar",s.jsx(j,{type:"file",id:"avatar",accept:"image/*",className:"hidden",onChange:E,disabled:y})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(v,{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),s.jsx(j,{type:"text",id:"fullName",value:l,onChange:r=>g(r.target.value),className:"mt-1 p-2 w-full border rounded-md"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(v,{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(L,{value:o,onValueChange:N,children:[s.jsx(V,{className:"w-[140px]",children:s.jsx(q,{placeholder:"Country"})}),s.jsx(B,{children:J.map(({code:r,country:n})=>s.jsxs(O,{value:r,children:[n," (",r,")"]},r))})]}),s.jsx(j,{type:"tel",id:"phone",value:a,onChange:r=>i(f(r.target.value)),className:"mt-1 p-2 w-full border rounded-md flex-1"})]})]}),s.jsx(R,{onClick:C,disabled:d,className:"w-full bg-primary text-white rounded-md p-2 hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50",children:d?"Updating...":"Update Profile"})]})})},W=()=>{const[e,d]=t.useState(null),[m,l]=t.useState(!0);return t.useEffect(()=>{(async()=>{try{l(!0);const{data:{user:a}}=await c.auth.getUser();if(!a){console.error("User not found"),u.error("User not found. Please sign in.");return}const{data:i,error:o}=await c.from("profiles").select("*").eq("id",a.id).single();if(o)throw o;d(i)}catch(a){console.error("Error fetching profile:",a),u.error("Failed to fetch profile. Please try again.")}finally{l(!1)}})()},[]),s.jsx("div",{children:m?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("p",{children:"Loading profile..."})}):s.jsx(T,{profileData:e})})};export{W as default};

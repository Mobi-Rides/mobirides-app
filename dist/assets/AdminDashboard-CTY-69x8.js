import{j as e,u as E}from"./query-vendor-C7aRRP05.js";import{T as R,a as L,b as _,c as n,d as M,e as f,A as ie,f as le}from"./table-B-4Dv_Oi.js";import{A as ce}from"./AdminStats-BGHaKzKG.js";import{r as p,u as oe}from"./react-vendor-mnpoGfEl.js";import{B as y,as as F,I as O,at as X,a1 as Z,s as S,J as b,v as ee,N as de,O as xe,aK as he,V as q,R as me,aM as ue,W as pe,aV as je,aW as fe,aX as ve}from"./index-DJr5SZzu.js";import{C as T,d as A,a as I,b as V}from"./card-DMFn2_TK.js";import{S as g}from"./skeleton-BhL2eYwv.js";import{P as ge,a as Ne,b as k,c as we,d as Ce,e as ye,U as $}from"./UserManagementTable-czOTf7JY.js";import{C as se}from"./circle-x-BzAfHmNJ.js";import{T as _e}from"./trending-up-DmzRO2nt.js";import{T as be,E as Se}from"./trending-down-BTx43Lfo.js";import"./separator-Bx5yWe5w.js";import"./sheet-ButSOKiq.js";import"./car-DLlpGS8d.js";import"./credit-card-Df8bEvff.js";import"./message-square-CtIehbg2.js";import"./house-Q4mvWeIi.js";import"./settings-B977msXK.js";import"./log-out-AdTcjjsC.js";import"./useIsAdmin-CVYKFXdF.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";import"./calendar-DXV6iOkH.js";import"./star-DQurhe2X.js";import"./user-check-Co8k53nQ.js";import"./map-pin-ZtPByMlX.js";import"./dollar-sign-pFeiRHgp.js";import"./wallet-DMAM-jtb.js";import"./user-CCMNZbkj.js";import"./file-text-kSIK8kmv.js";import"./clock-B-BcoQFY.js";import"./switch-B9wK1Y5N.js";import"./alert-dialog-ClsozF6L.js";import"./shield-CWWsRMeH.js";import"./chevron-left-B1nGMQIr.js";function Te({data:r,itemsPerPage:i=10,renderItem:o,renderHeader:m,className:c="",showLoadMore:x=!1}){const[u,h]=p.useState(1),[d,j]=p.useState(i),v=Math.ceil(r.length/i),N=p.useMemo(()=>{if(x)return r.slice(0,d);const s=(u-1)*i;return r.slice(s,s+i)},[r,u,i,x,d]),a=()=>{j(s=>Math.min(s+i,r.length))},t=x&&d<r.length;return r.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No data available"}):e.jsxs("div",{className:c,children:[m&&m(),e.jsx("div",{className:"space-y-2",children:N.map((s,l)=>o(s,l))}),x?t&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs(y,{variant:"outline",onClick:a,size:"sm",children:["Load More (",Math.min(i,r.length-d)," more)"]})}):v>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(ge,{children:e.jsxs(Ne,{children:[e.jsx(k,{children:e.jsx(we,{onClick:()=>h(s=>Math.max(s-1,1)),className:u===1?"pointer-events-none opacity-50":"cursor-pointer"})}),[...Array(Math.min(v,5))].map((s,l)=>{const w=l+1;return e.jsx(k,{children:e.jsx(Ce,{onClick:()=>h(w),isActive:u===w,className:"cursor-pointer",children:w})},w)}),e.jsx(k,{children:e.jsx(ye,{onClick:()=>h(s=>Math.min(s+1,v)),className:u===v?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})}const Ae=()=>E({queryKey:["pending-cars"],queryFn:async()=>{const{data:r,error:i}=await S.from("cars").select(`
          id, brand, model, year, price_per_day, location, 
          is_available, created_at, owner_id,
          profiles:owner_id (full_name)
        `).eq("is_available",!1).order("created_at",{ascending:!1}).limit(10);if(i)throw i;return r||[]}}),H=({isPreview:r=!1,maxItems:i=5})=>{const[o,m]=p.useState(""),{data:c,isLoading:x,error:u,refetch:h}=Ae(),d=(c==null?void 0:c.filter(t=>{var s,l;return t.brand.toLowerCase().includes(o.toLowerCase())||t.model.toLowerCase().includes(o.toLowerCase())||((l=(s=t.profiles)==null?void 0:s.full_name)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))}))||[],j=r?d.slice(0,i):d,v=async t=>{try{const{error:s}=await S.from("cars").update({is_available:!0}).eq("id",t);if(s)throw s;h(),b.success("Car approved successfully")}catch(s){console.error("Error approving car:",s),b.error("Failed to approve car")}},N=async t=>{try{const{error:s}=await S.from("cars").delete().eq("id",t);if(s)throw s;h(),b.success("Car rejected and removed")}catch(s){console.error("Error rejecting car:",s),b.error("Failed to reject car")}},a=t=>{var s;return e.jsxs(_,{children:[e.jsx(f,{className:"font-medium",children:t.brand}),e.jsx(f,{children:t.model}),e.jsx(f,{children:t.year}),e.jsx(f,{children:((s=t.profiles)==null?void 0:s.full_name)||"Unknown"}),e.jsx(f,{children:new Date(t.created_at).toLocaleDateString()}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>v(t.id),children:e.jsx(Z,{className:"h-4 w-4 text-green-600"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>N(t.id),children:e.jsx(se,{className:"h-4 w-4 text-destructive"})})]})})]},t.id)};return u?e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load pending cars"})})}):r?x?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((t,s)=>e.jsx(g,{className:"h-16 w-full"},s))}):j.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No pending car verifications"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"Make"}),e.jsx(n,{children:"Model"}),e.jsx(n,{children:"Year"}),e.jsx(n,{children:"Seller"}),e.jsx(n,{children:"Submitted At"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(M,{children:j.map(t=>a(t))})]})}):e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs(V,{children:["Car Verification Queue (",d.length,")"]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(F,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search cars...",value:o,onChange:t=>m(t.target.value),className:"pl-8"})]})]})}),e.jsxs(A,{children:[x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((t,s)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(g,{className:"h-12 w-12"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"h-4 w-[200px]"}),e.jsx(g,{className:"h-4 w-[100px]"})]})]},s))}):e.jsx(Te,{data:j,itemsPerPage:10,renderItem:t=>a(t),renderHeader:()=>e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"Make"}),e.jsx(n,{children:"Model"}),e.jsx(n,{children:"Year"}),e.jsx(n,{children:"Seller"}),e.jsx(n,{children:"Submitted At"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(M,{})]}),className:"overflow-x-auto"}),!x&&d.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No pending car verifications"})]})]})},Re=()=>E({queryKey:["pending-verifications"],queryFn:async()=>{const{data:r,error:i}=await S.from("user_verifications").select(`
          id, user_id, overall_status, current_step, created_at, personal_info
        `).in("overall_status",["pending","submitted"]).order("created_at",{ascending:!1});if(i)throw i;return r||[]}}),Q=({isPreview:r=!1,maxItems:i=5})=>{const[o,m]=p.useState(""),{data:c,isLoading:x,error:u,refetch:h}=Re(),d=(c==null?void 0:c.filter(s=>{var l;return((l=s.user_id)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))||s.overall_status.toLowerCase().includes(o.toLowerCase())}))||[],j=r?d.slice(0,i):d,v=async s=>{try{const{error:l}=await S.from("user_verifications").update({overall_status:"verified",completed_at:new Date().toISOString()}).eq("id",s);if(l)throw l;h(),b.success("Verification approved successfully")}catch(l){console.error("Error approving verification:",l),b.error("Failed to approve verification")}},N=async s=>{try{const{error:l}=await S.from("user_verifications").update({overall_status:"rejected",rejection_reasons:["Manual review rejection"]}).eq("id",s);if(l)throw l;h(),b.success("Verification rejected")}catch(l){console.error("Error rejecting verification:",l),b.error("Failed to reject verification")}},a=s=>{switch(s){case"verified":return"default";case"pending":return"secondary";case"rejected":return"destructive";case"submitted":return"outline";default:return"outline"}},t=s=>e.jsxs(_,{children:[e.jsxs(f,{className:"font-medium",children:[s.user_id.substring(0,8),"..."]}),e.jsx(f,{children:"N/A"}),e.jsx(f,{children:e.jsx(ee,{variant:a(s.overall_status),children:s.overall_status})}),e.jsx(f,{children:s.current_step}),e.jsx(f,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>v(s.id),children:e.jsx(Z,{className:"h-4 w-4 text-green-600"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>N(s.id),children:e.jsx(se,{className:"h-4 w-4 text-destructive"})})]})})]},s.id);return u?e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load pending verifications"})})}):r?x?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,l)=>e.jsx(g,{className:"h-16 w-full"},l))}):j.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No pending KYC verifications"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Current Step"}),e.jsx(n,{children:"Submitted"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(M,{children:j.map(s=>t(s))})]})}):e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs(V,{children:["KYC Verification Queue (",d.length,")"]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(F,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search verifications...",value:o,onChange:s=>m(s.target.value),className:"pl-8"})]})]})}),e.jsxs(A,{children:[x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,l)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(g,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"h-4 w-[200px]"}),e.jsx(g,{className:"h-4 w-[100px]"})]})]},l))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Current Step"}),e.jsx(n,{children:"Submitted"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(M,{children:j.map(s=>t(s))})]})}),!x&&d.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No pending KYC verifications"})]})]})},Le=()=>E({queryKey:["recent-transactions"],queryFn:async()=>{const{data:r,error:i}=await S.from("wallet_transactions").select(`
          id, transaction_type, amount, description, created_at, status, wallet_id,
          host_wallets:wallet_id (
            host_id,
            profiles:host_id (full_name)
          )
        `).order("created_at",{ascending:!1}).limit(10);if(i)throw i;return r||[]}}),W=({isPreview:r=!1,maxItems:i=5})=>{const[o,m]=p.useState(""),{data:c,isLoading:x,error:u}=Le(),h=(c==null?void 0:c.filter(a=>{var t,s,l,w;return((l=(s=(t=a.host_wallets)==null?void 0:t.profiles)==null?void 0:s.full_name)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))||a.transaction_type.toLowerCase().includes(o.toLowerCase())||((w=a.description)==null?void 0:w.toLowerCase().includes(o.toLowerCase()))}))||[],d=r?h.slice(0,i):h,j=a=>a==="credit"||a==="top_up"?e.jsx(_e,{className:"h-4 w-4 text-green-600"}):e.jsx(be,{className:"h-4 w-4 text-red-600"}),v=a=>a==="credit"||a==="top_up"?"text-green-600":"text-red-600",N=a=>{var t,s;return e.jsxs(_,{children:[e.jsx(f,{className:"font-medium",children:((s=(t=a.host_wallets)==null?void 0:t.profiles)==null?void 0:s.full_name)||"Unknown"}),e.jsx(f,{children:new Date(a.created_at).toLocaleDateString()}),e.jsx(f,{children:a.description||a.transaction_type}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[j(a.transaction_type),e.jsx(ee,{variant:a.transaction_type==="credit"||a.transaction_type==="top_up"?"default":"destructive",children:a.transaction_type==="commission_deduction"?"Debit":"Credit"})]})}),e.jsx(f,{children:e.jsxs("span",{className:`font-semibold ${v(a.transaction_type)}`,children:[a.transaction_type==="commission_deduction"?"-":"+","P",Math.abs(a.amount).toFixed(2)]})})]},a.id)};return u?e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("p",{className:"text-destructive",children:"Failed to load recent transactions"})})}):r?x?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((a,t)=>e.jsx(g,{className:"h-16 w-full"},t))}):d.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No recent transactions"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Description"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Amount"})]})}),e.jsx(M,{children:d.map(a=>N(a))})]})}):e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs(V,{children:["Recent Transactions (",h.length,")"]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(F,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search transactions...",value:o,onChange:a=>m(a.target.value),className:"pl-8"})]})]})}),e.jsxs(A,{children:[x?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((a,t)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(g,{className:"h-6 w-6"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"h-4 w-[200px]"}),e.jsx(g,{className:"h-4 w-[100px]"})]}),e.jsx(g,{className:"h-4 w-[80px] ml-auto"})]},t))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(_,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Description"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Amount"})]})}),e.jsx(M,{children:d.map(a=>N(a))})]})}),!x&&h.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No recent transactions"})]})]})};var U="Collapsible",[Me,vs]=xe(U),[De,z]=Me(U),re=p.forwardRef((r,i)=>{const{__scopeCollapsible:o,open:m,defaultOpen:c,disabled:x,onOpenChange:u,...h}=r,[d=!1,j]=de({prop:m,defaultProp:c,onChange:u});return e.jsx(De,{scope:o,disabled:x,contentId:he(),open:d,onOpenToggle:p.useCallback(()=>j(v=>!v),[j]),children:e.jsx(q.div,{"data-state":B(d),"data-disabled":x?"":void 0,...h,ref:i})})});re.displayName=U;var te="CollapsibleTrigger",ae=p.forwardRef((r,i)=>{const{__scopeCollapsible:o,...m}=r,c=z(te,o);return e.jsx(q.button,{type:"button","aria-controls":c.contentId,"aria-expanded":c.open||!1,"data-state":B(c.open),"data-disabled":c.disabled?"":void 0,disabled:c.disabled,...m,ref:i,onClick:me(r.onClick,c.onOpenToggle)})});ae.displayName=te;var K="CollapsibleContent",ne=p.forwardRef((r,i)=>{const{forceMount:o,...m}=r,c=z(K,r.__scopeCollapsible);return e.jsx(ue,{present:o||c.open,children:({present:x})=>e.jsx(Pe,{...m,ref:i,present:x})})});ne.displayName=K;var Pe=p.forwardRef((r,i)=>{const{__scopeCollapsible:o,present:m,children:c,...x}=r,u=z(K,o),[h,d]=p.useState(m),j=p.useRef(null),v=pe(i,j),N=p.useRef(0),a=N.current,t=p.useRef(0),s=t.current,l=u.open||h,w=p.useRef(l),D=p.useRef();return p.useEffect(()=>{const C=requestAnimationFrame(()=>w.current=!1);return()=>cancelAnimationFrame(C)},[]),je(()=>{const C=j.current;if(C){D.current=D.current||{transitionDuration:C.style.transitionDuration,animationName:C.style.animationName},C.style.transitionDuration="0s",C.style.animationName="none";const Y=C.getBoundingClientRect();N.current=Y.height,t.current=Y.width,w.current||(C.style.transitionDuration=D.current.transitionDuration,C.style.animationName=D.current.animationName),d(m)}},[u.open,m]),e.jsx(q.div,{"data-state":B(u.open),"data-disabled":u.disabled?"":void 0,id:u.contentId,hidden:!l,...x,ref:v,style:{"--radix-collapsible-content-height":a?`${a}px`:void 0,"--radix-collapsible-content-width":s?`${s}px`:void 0,...r.style},children:l&&c})});function B(r){return r?"open":"closed"}var Ie=re;const G=Ie,J=ae,Ve=ne,P=({title:r,children:i,previewContent:o,itemCount:m,onViewAll:c,defaultOpen:x=!1,showViewAllButton:u=!0})=>{const[h,d]=p.useState(x);return e.jsxs(T,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-lg",children:r}),e.jsxs("div",{className:"flex items-center gap-2",children:[m!==void 0&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[m," items"]}),u&&c&&e.jsxs(y,{variant:"outline",size:"sm",onClick:c,className:"gap-1",children:[e.jsx(Se,{className:"h-3 w-3"}),"View All"]})]})]})}),e.jsxs(A,{children:[o&&!h&&e.jsxs("div",{className:"space-y-3",children:[o,e.jsx(G,{open:h,onOpenChange:d,children:e.jsx(J,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"w-full gap-2",children:["Show More",e.jsx(fe,{className:"h-4 w-4"})]})})})]}),e.jsx(G,{open:h,onOpenChange:d,children:e.jsxs(Ve,{children:[i,o&&e.jsx(J,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"w-full gap-2 mt-3",children:["Show Less",e.jsx(ve,{className:"h-4 w-4"})]})})]})})]})]})},gs=()=>{const r=oe();return e.jsx(ie,{children:e.jsx(le,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Welcome to the Mobi Rides admin panel"})]}),e.jsx(ce,{}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(P,{title:"Car Verification Queue",onViewAll:()=>r("/admin/cars"),previewContent:e.jsx(H,{isPreview:!0,maxItems:3}),children:e.jsx(H,{})}),e.jsx(P,{title:"KYC Verification",onViewAll:()=>r("/admin/verifications"),previewContent:e.jsx(Q,{isPreview:!0,maxItems:3}),children:e.jsx(Q,{})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(P,{title:"User Management",onViewAll:()=>r("/admin/users"),previewContent:e.jsx($,{isPreview:!0,maxItems:3}),children:e.jsx($,{})}),e.jsx(P,{title:"Recent Transactions",onViewAll:()=>r("/admin/transactions"),previewContent:e.jsx(W,{isPreview:!0,maxItems:3}),children:e.jsx(W,{})})]})]})})})};export{gs as default};

var ue=Object.defineProperty;var pe=(a,i,s)=>i in a?ue(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var re=(a,i,s)=>pe(a,typeof i!="symbol"?i+"":i,s);import{j as e}from"./query-vendor-C7aRRP05.js";import{c as ne,aD as fe,ad as je,B as y,a8 as le,f as O,I as _,aw as ge,J as N,a9 as ee,v as D,m as $,n as z,y as J,ay as ce,aE as Ne,P as Q,z as be,aF as ve,U as ae,aG as S,X as ye,ax as V,T as we,aH as Ce}from"./index-D9LOOiBY.js";import{r as d,R as H,u as se}from"./react-vendor-mnpoGfEl.js";import{C as P,a as k,b as R,c as F,d as Se}from"./card-0dd-x2VS.js";import{P as oe}from"./progress-C3ND9g4r.js";import"./separator-YD7IlT-d.js";import{A as Pe,a as ke,b as Te,c as Ee,d as Re,e as Fe,f as Ve,g as Ie,h as Oe}from"./alert-dialog-DENOFHqF.js";import{U as te}from"./user-B9gAMDWP.js";import{A as Y}from"./arrow-right-Cq7LsR6u.js";import{C}from"./circle-check-big-rGt2oTzx.js";import{C as q}from"./camera-D2heBayn.js";import{U as Z}from"./upload-B1qRMY9V.js";import{C as E}from"./circle-alert-DI0VRaYv.js";import{F as de}from"./file-text-CHck1lj0.js";import{R as K}from"./rotate-ccw-BF-94sUb.js";import{M as _e}from"./message-square-CV0BuuVY.js";import{C as X}from"./clock-CFBaLxjz.js";import{M as me,U as Ae}from"./user-check-DnjYO_2J.js";import{S as W}from"./shield-Tr4U0OA6.js";import{S as xe}from"./star-BwZJAYBL.js";import{D as De}from"./download-kFjsDqqC.js";import{C as ie}from"./car-DvspwSJC.js";import{C as Ue}from"./calendar-hLJryCgl.js";import{H as Me}from"./house-CukzEskp.js";import"./supabase-vendor-BOn0LdFJ.js";import"./mapbox-vendor-fnXFVHMy.js";import"./date-vendor-Dhms5dOu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=ne("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=ne("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);function L(){const a=d.useContext(fe);if(a===void 0)throw new Error("useVerification must be used within a VerificationProvider");return a}const Be=({onNext:a})=>{const{verificationData:i,updatePersonalInfo:s,isLoading:m,refreshData:x}=L(),[n,o]=d.useState({fullName:"",dateOfBirth:"",nationalIdNumber:"",phoneNumber:"",email:"",address:{street:"",area:"",city:"",postalCode:""}}),[h,f]=d.useState(!1);d.useEffect(()=>{var l,g,w,c;if(i!=null&&i.personal_info){const t=i.personal_info,r={fullName:String((t==null?void 0:t.fullName)||""),dateOfBirth:String((t==null?void 0:t.dateOfBirth)||""),nationalIdNumber:String((t==null?void 0:t.nationalIdNumber)||""),phoneNumber:String((t==null?void 0:t.phoneNumber)||""),email:String((t==null?void 0:t.email)||""),address:{street:String(((l=t==null?void 0:t.address)==null?void 0:l.street)||""),area:String(((g=t==null?void 0:t.address)==null?void 0:g.area)||""),city:String(((w=t==null?void 0:t.address)==null?void 0:w.city)||""),postalCode:String(((c=t==null?void 0:t.address)==null?void 0:c.postalCode)||"")}};o(r);const u=t.fullName||t.phoneNumber||t.email;f(!!u)}},[i]);const b=async l=>{if(l.preventDefault(),!n.fullName||!n.dateOfBirth||!n.nationalIdNumber){N.error("Please fill in all required fields");return}try{await s(n),N.success("Personal information saved successfully!"),a()}catch(g){console.error("Failed to save personal information:",g),N.error("Failed to save personal information")}},p=(l,g)=>{if(l.includes("address.")){const w=l.split(".")[1];o(c=>({...c,address:{...c.address,[w]:g}}))}else o(w=>({...w,[l]:g}))},j=async()=>{if(i!=null&&i.user_id)try{await ge.refreshFromProfile(i.user_id)?(await x(),N.success("Profile data refreshed successfully!")):N.error("Failed to refresh profile data")}catch(l){console.error("Failed to refresh from profile:",l),N.error("Failed to refresh profile data")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Personal Information"}),e.jsx("p",{className:"text-muted-foreground",children:"Please provide your personal details for verification"})]}),h&&e.jsx(P,{className:"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(je,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Profile Data Imported"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"We've pre-filled some fields from your profile. Please review and update as needed."}),e.jsxs(y,{type:"button",variant:"outline",size:"sm",onClick:j,className:"text-blue-700 border-blue-300 hover:bg-blue-100 dark:text-blue-300 dark:border-blue-700 dark:hover:bg-blue-900",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Refresh from Profile"]})]})]})})}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(F,{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-5 w-5"}),e.jsx("span",{children:"Basic Information"})]})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"fullName",children:"Full Name *"}),e.jsx(_,{id:"fullName",value:n.fullName,onChange:l=>p("fullName",l.target.value),placeholder:"Enter your full name",required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"dateOfBirth",children:"Date of Birth *"}),e.jsx(_,{id:"dateOfBirth",type:"date",value:n.dateOfBirth,onChange:l=>p("dateOfBirth",l.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"nationalIdNumber",children:"National ID Number *"}),e.jsx(_,{id:"nationalIdNumber",value:n.nationalIdNumber,onChange:l=>p("nationalIdNumber",l.target.value),placeholder:"Enter your Omang number",required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(_,{id:"phoneNumber",type:"tel",value:n.phoneNumber,onChange:l=>p("phoneNumber",l.target.value),placeholder:"+267 XX XXX XXX"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"email",children:"Email Address"}),e.jsx(_,{id:"email",type:"email",value:n.email,onChange:l=>p("email",l.target.value),placeholder:"your.email@example.com"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Address Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"street",children:"Street Address"}),e.jsx(_,{id:"street",value:n.address.street,onChange:l=>p("address.street",l.target.value),placeholder:"Street address"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"area",children:"Area/Suburb"}),e.jsx(_,{id:"area",value:n.address.area,onChange:l=>p("address.area",l.target.value),placeholder:"Area or suburb"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"city",children:"City"}),e.jsx(_,{id:"city",value:n.address.city,onChange:l=>p("address.city",l.target.value),placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"postalCode",children:"Postal Code"}),e.jsx(_,{id:"postalCode",value:n.address.postalCode,onChange:l=>p("address.postalCode",l.target.value),placeholder:"Postal code"})]})]})]}),e.jsx("div",{className:"flex justify-end pt-6",children:e.jsxs(y,{type:"submit",disabled:m,className:"flex items-center space-x-2",children:[e.jsx("span",{children:m?"Saving...":"Continue to Documents"}),e.jsx(Y,{className:"h-4 w-4"})]})})]})})]})]})},$e=({onPhotoCapture:a,photoUrl:i,onRetake:s,documentTitle:m})=>{const x=d.useRef(null),n=d.useRef(null),[o,h]=d.useState(null),[f,b]=d.useState(!1),[p,j]=d.useState(!1),l=d.useCallback(async()=>{try{h(null);const c=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"}});x.current&&(x.current.srcObject=c,x.current.onloadedmetadata=()=>{j(!0)})}catch(c){console.error("Camera initialization error:",c);let t="Unable to access camera.";c.name==="NotAllowedError"?t="Camera access denied. Please allow camera permissions and try again.":c.name==="NotFoundError"?t="No camera found. Please ensure your device has a camera.":(c.name==="SecurityError"||window.location.protocol!=="https:")&&(t="Camera access requires HTTPS. Please use HTTPS or upload manually."),h(t)}},[]),g=d.useCallback(()=>{var c;(c=x.current)!=null&&c.srcObject&&x.current.srcObject.getTracks().forEach(r=>r.stop())},[]),w=d.useCallback(async()=>{if(!(!x.current||!n.current||!p)){b(!0);try{const c=x.current,t=n.current,r=t.getContext("2d");if(!r)return;t.width=c.videoWidth,t.height=c.videoHeight,r.drawImage(c,0,0,t.width,t.height),t.toBlob(u=>{u&&(a(u),N.success(`${m} captured successfully!`))},"image/jpeg",.9)}catch(c){console.error("Photo capture error:",c),N.error("Failed to capture photo")}finally{b(!1)}}},[p,a,m]);return d.useEffect(()=>(i||l(),g),[i,l,g]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative bg-gray-900 rounded-lg overflow-hidden aspect-[4/3] max-w-md mx-auto",children:o?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(E,{className:"h-8 w-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-red-600 mb-2",children:o}),e.jsx(y,{onClick:l,size:"sm",children:"Try Again"})]})}):i?e.jsx("img",{src:i,alt:`Captured ${m}`,className:"w-full h-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:x,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:e.jsx("div",{className:"absolute inset-4 border-2 border-white/50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx(de,{className:"h-8 w-8 mx-auto mb-2"}),e.jsxs("p",{className:"text-sm",children:["Position ",m," in frame"]})]})})})]})}),e.jsx("canvas",{ref:n,className:"hidden"}),e.jsx("div",{className:"flex justify-center space-x-3",children:i?e.jsxs(y,{variant:"outline",onClick:s,className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Retake"})]}):e.jsxs(y,{onClick:w,disabled:f||!p,className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:f?"Capturing...":"Take Photo"})]})})]})},ze=({onFileSelect:a,photoUrl:i,onRetake:s,documentTitle:m})=>{const x=d.useRef(null),n=h=>{var b;const f=(b=h.target.files)==null?void 0:b[0];if(f){if(!f.type.startsWith("image/")&&f.type!=="application/pdf"){N.error("Please select an image or PDF file");return}if(f.size>10*1024*1024){N.error("File size must be less than 10MB");return}a(f)}},o=()=>{var h;(h=x.current)==null||h.click()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg overflow-hidden aspect-[4/3] max-w-md mx-auto",children:i?e.jsx("img",{src:i,alt:`Uploaded ${m}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(he,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Upload ",m]}),e.jsxs(y,{onClick:o,size:"sm",className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Choose File"})]})]})})}),e.jsx("input",{ref:x,type:"file",accept:"image/*,.pdf",onChange:n,className:"hidden"}),i&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(y,{variant:"outline",onClick:s,className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Choose Different File"})]})})]})},He=({onNext:a,onPrevious:i})=>{const{isLoading:s,completeDocumentUpload:m}=L(),{user:x}=ee(),[n,o]=d.useState({}),[h,f]=d.useState({}),b=[{id:"national_id_front",title:"National ID (Front)",description:"Front side of your Botswana National ID (Omang)"},{id:"national_id_back",title:"National ID (Back)",description:"Back side of your Botswana National ID (Omang)"},{id:"driving_license_front",title:"Driving License (Front)",description:"Front side of your valid driving license"},{id:"proof_of_address",title:"Proof of Address",description:"Utility bill or bank statement (max 3 months old)"}],p=d.useCallback((r,u)=>{const v=URL.createObjectURL(u),T={id:r,blob:u,url:v,method:"camera"};o(A=>({...A,[r]:T}))},[]),j=d.useCallback((r,u)=>{var A;const v=URL.createObjectURL(u),T={id:r,blob:u,url:v,method:"upload"};o(B=>({...B,[r]:T})),N.success(`${(A=b.find(B=>B.id===r))==null?void 0:A.title} uploaded successfully!`)},[b]),l=d.useCallback(r=>{o(u=>{const v={...u};return v[r]&&(URL.revokeObjectURL(v[r].url),delete v[r]),v})},[]),g=d.useCallback((r,u)=>{f(v=>({...v,[r]:u})),l(r)},[l]),w=async(r,u)=>new Promise(v=>{setTimeout(()=>{N.success(`${r.name} uploaded successfully`),v(!0)},1e3)}),c=async()=>{if(Object.keys(n).length<b.length){N.error("Please upload all required documents");return}try{for(const[u,v]of Object.entries(n)){const T=new File([v.blob],`${u}.jpg`,{type:"image/jpeg"});await w(T,u)}await m((x==null?void 0:x.id)||""),a()}catch(u){console.error("Document upload completion error:",u),N.error("Failed to complete document upload")}},t=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia;return e.jsxs("div",{className:"max-w-2xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Document Upload"}),e.jsx("p",{className:"text-gray-600",children:"Please upload the following documents to verify your identity"})]}),e.jsx("div",{className:"space-y-8",children:b.map(r=>{const u=n[r.id],v=h[r.id]||(t?"camera":"upload");return e.jsxs("div",{className:"border rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:r.title}),e.jsx("p",{className:"text-sm text-gray-600",children:r.description})]}),u&&e.jsxs(D,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Uploaded"]})]}),t&&e.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>g(r.id,"camera"),className:`flex-1 flex items-center justify-center space-x-2 py-2 px-4 rounded-md text-sm font-medium transition-colors ${v==="camera"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Take Photo"})]}),e.jsxs("button",{onClick:()=>g(r.id,"upload"),className:`flex-1 flex items-center justify-center space-x-2 py-2 px-4 rounded-md text-sm font-medium transition-colors ${v==="upload"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Upload File"})]})]}),v==="camera"?e.jsx($e,{onPhotoCapture:T=>p(r.id,T),photoUrl:(u==null?void 0:u.url)||null,onRetake:()=>l(r.id),documentTitle:r.title}):e.jsx(ze,{onFileSelect:T=>j(r.id,T),photoUrl:(u==null?void 0:u.url)||null,onRetake:()=>l(r.id),documentTitle:r.title}),!t&&e.jsxs($,{className:"mt-4",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(z,{children:"Camera not available. Please upload files manually."})]})]},r.id)})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 pt-6",children:[e.jsxs(y,{variant:"outline",onClick:i,className:"flex items-center justify-center space-x-2 w-full sm:w-auto min-h-[48px] sm:min-h-[40px]",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]}),e.jsxs(y,{onClick:c,disabled:s||Object.keys(n).length<b.length,className:"flex items-center justify-center space-x-2 w-full sm:w-auto min-h-[48px] sm:min-h-[40px]",children:[s?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:s?"Processing...":"Continue"})]})]})]})},Ye=({onCapture:a,onRetake:i,isCapturing:s,hasPhoto:m})=>e.jsx("div",{className:"flex justify-center space-x-4 mt-6",children:m?e.jsx("div",{className:"flex space-x-3",children:e.jsxs(y,{variant:"outline",onClick:i,className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Retake"})]})}):e.jsxs(y,{onClick:a,disabled:s,size:"lg",className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{children:s?"Capturing...":"Take Selfie"})]})}),qe=({onFileSelect:a,photoUrl:i,onRetake:s})=>{const m=d.useRef(null),x=o=>{var f;const h=(f=o.target.files)==null?void 0:f[0];if(h){if(!h.type.startsWith("image/")){N.error("Please select an image file");return}if(h.size>10*1024*1024){N.error("File size must be less than 10MB");return}a(h)}},n=()=>{var o;(o=m.current)==null||o.click()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg overflow-hidden aspect-[4/3] max-w-md mx-auto",children:i?e.jsx("img",{src:i,alt:"Uploaded selfie",className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(he,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Upload a clear selfie photo"}),e.jsxs(y,{onClick:n,className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Choose File"})]})]})})}),e.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:x,className:"hidden"}),i&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(y,{variant:"outline",onClick:s,className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Choose Different Photo"})]})})]})},We=()=>e.jsxs(P,{className:"mb-6",children:[e.jsx(R,{children:e.jsxs(F,{className:"flex items-center space-x-2 text-lg",children:[e.jsx(te,{className:"h-5 w-5"}),e.jsx("span",{children:"Selfie Guidelines"})]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-green-600 flex items-center space-x-2",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{children:"Do This"})]}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(ce,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Look directly at the camera"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Have a neutral expression"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Ensure good lighting on your face"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Remove sunglasses and hats"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Face the camera directly"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-red-600 flex items-center space-x-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Avoid This"})]}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(E,{className:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Don't cover your face"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(E,{className:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Don't take photos in dark lighting"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(E,{className:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Don't blur the image"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(E,{className:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Don't include other people"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(E,{className:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Don't tilt your head significantly"})]})]})]})]})})]}),Xe=({onPhotoCapture:a,photoUrl:i,onRetake:s})=>{const m=d.useRef(null),x=d.useRef(null),[n,o]=d.useState(null),[h,f]=d.useState(!1),[b,p]=d.useState(!1),j=d.useCallback(async()=>{try{o(null);const c=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});m.current&&(m.current.srcObject=c,m.current.onloadedmetadata=()=>{p(!0)})}catch(c){console.error("Camera initialization error:",c);let t="Unable to access camera.";c.name==="NotAllowedError"?t="Camera access denied. Please allow camera permissions in your browser settings and try again.":c.name==="NotFoundError"?t="No camera found. Please ensure your device has a camera connected.":c.name==="NotReadableError"?t="Camera is already in use by another application. Please close other apps using the camera.":c.name==="SecurityError"||window.location.protocol!=="https:"?t="Camera access requires a secure connection (HTTPS). Please use HTTPS or try uploading a selfie manually.":c.name==="NotSupportedError"&&(t="Camera not supported on this device or browser. Please try a different browser or upload a selfie manually."),o(t)}},[]),l=d.useCallback(()=>{var c;(c=m.current)!=null&&c.srcObject&&m.current.srcObject.getTracks().forEach(r=>r.stop())},[]),g=d.useCallback(async()=>{if(!(!m.current||!x.current||!b)){f(!0);try{const c=m.current,t=x.current,r=t.getContext("2d");if(!r)return;t.width=c.videoWidth,t.height=c.videoHeight,r.drawImage(c,0,0,t.width,t.height),t.toBlob(u=>{u&&(a(u),N.success("Selfie captured successfully!"))},"image/jpeg",.8)}catch(c){console.error("Photo capture error:",c),N.error("Failed to capture photo")}finally{f(!1)}}},[b,a]),w=d.useCallback(()=>{s(),b||j()},[s,b,j]);return d.useEffect(()=>(i||j(),l),[i,j,l]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative bg-gray-900 rounded-lg overflow-hidden aspect-[4/3] max-w-md mx-auto",children:n?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(E,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-red-600 mb-4",children:n}),e.jsx(y,{onClick:j,size:"sm",children:"Try Again"})]})}):i?e.jsx("img",{src:i,alt:"Captured selfie",className:"w-full h-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-48 h-48 border-2 border-white/50 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-44 h-44 border border-white/30 rounded-full"})})}),e.jsx("div",{className:"absolute top-4 left-4 right-4",children:e.jsx("div",{className:"bg-black/50 text-white text-center py-2 px-4 rounded",children:e.jsx("p",{className:"text-sm",children:b?"Position your face in the circle":"Loading camera..."})})})]})})]})}),e.jsx("canvas",{ref:x,className:"hidden"}),e.jsx(Ye,{onCapture:g,onRetake:w,isCapturing:h,hasPhoto:!!i})]})},Ge=({onNext:a,onPrevious:i})=>{const{verificationData:s,completeSelfieVerification:m,isLoading:x}=L(),[n,o]=d.useState(null),[h,f]=d.useState(null),[b,p]=d.useState(!1),[j,l]=d.useState("camera"),g=d.useCallback(v=>{o(v);const T=URL.createObjectURL(v);f(T)},[]),w=d.useCallback(()=>{h&&URL.revokeObjectURL(h),o(null),f(null)},[h]),c=d.useCallback(v=>{const T=new Blob([v],{type:v.type});o(T);const A=URL.createObjectURL(T);f(A),N.success("Photo uploaded successfully!")},[]),t=async()=>{if(!n){N.error("Please take a selfie first");return}try{p(!0),await m(),N.success("Selfie verification completed!"),setTimeout(()=>{a()},1e3)}catch(v){console.error("Failed to submit selfie:",v),N.error("Failed to submit selfie verification")}finally{p(!1)}},u=!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia?{supported:!1,error:"Your browser doesn't support camera access. Please use a modern browser (Chrome, Firefox, Safari, Edge) or upload a selfie manually."}:window.location.protocol!=="https:"&&window.location.hostname!=="localhost"?{supported:!1,error:"Camera access requires a secure connection (HTTPS). Please access this page via HTTPS or upload a selfie manually."}:{supported:!0,error:null};return d.useEffect(()=>{u.supported||l("upload")},[u.supported]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Take Your Verification Selfie"}),e.jsx("p",{className:"text-muted-foreground",children:"We need to verify that you're the same person as in your ID documents"})]}),e.jsx(We,{}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(F,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Capture Your Selfie"}),h&&e.jsxs(D,{variant:"secondary",className:"bg-green-100 text-green-700",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Photo Captured"]})]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-1 mb-6 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>l("camera"),disabled:!u.supported,className:`flex-1 min-h-[48px] sm:min-h-[40px] py-3 sm:py-2 px-4 rounded-md text-sm sm:text-base font-medium transition-colors flex items-center justify-center ${j==="camera"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"} ${u.supported?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx(q,{className:"h-4 w-4 flex-shrink-0 mr-2"}),e.jsx("span",{className:"truncate",children:"Use Camera"})]}),e.jsxs("button",{onClick:()=>l("upload"),className:`flex-1 min-h-[48px] sm:min-h-[40px] py-3 sm:py-2 px-4 rounded-md text-sm sm:text-base font-medium transition-colors flex items-center justify-center ${j==="upload"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Z,{className:"h-4 w-4 flex-shrink-0 mr-2"}),e.jsx("span",{className:"truncate",children:"Upload Photo"})]})]}),!u.supported&&j==="camera"&&e.jsxs($,{className:"mb-4",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsxs(z,{children:[e.jsx("strong",{children:"Camera Access Issue:"})," ",u.error,window.location.protocol!=="https:"&&window.location.hostname!=="localhost"&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded",children:[e.jsx("strong",{children:"💡 Quick Fix:"})," Try accessing this page with ",e.jsx("code",{children:"https://"})," instead of ",e.jsx("code",{children:"http://"})]})]})]}),j==="camera"&&u.supported?e.jsx(Xe,{onPhotoCapture:g,photoUrl:h,onRetake:w}):e.jsx(qe,{onFileSelect:c,photoUrl:h,onRetake:w})]})]}),e.jsxs($,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsxs(z,{children:[e.jsx("strong",{children:"Privacy Notice:"})," Your selfie is used only for identity verification and is processed securely. We do not use your photo for any other purposes."]})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-between gap-3 sm:gap-0 pt-6",children:[e.jsxs(y,{variant:"outline",onClick:i,className:"flex items-center justify-center space-x-2 min-h-[48px] sm:min-h-[40px] w-full sm:w-auto",children:[e.jsx(J,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Previous"})]}),e.jsxs(y,{onClick:t,disabled:!h||b||x,className:"flex items-center justify-center space-x-2 min-h-[48px] sm:min-h-[40px] w-full sm:w-auto",children:[e.jsx("span",{className:"truncate",children:b?"Submitting...":"Continue to Phone Verification"}),e.jsx(Y,{className:"h-4 w-4 flex-shrink-0"})]})]})]})},Je=({onNext:a,onPrevious:i})=>{const{updatePhoneVerification:s,isLoading:m}=L(),[x,n]=d.useState(""),[o,h]=d.useState(""),[f,b]=d.useState(!1),[p,j]=d.useState(!1),l=async()=>{if(!x){N.error("Please enter your phone number");return}setTimeout(()=>{b(!0),N.success("Verification code sent to your phone")},1e3)},g=async()=>{if(!o){N.error("Please enter the verification code");return}o==="123456"||o.length===6?(j(!0),await s({phoneNumber:x,countryCode:"+267",verificationCode:o,isVerified:!0}),N.success("Phone number verified successfully!")):N.error("Invalid verification code")},w=()=>{if(!p){N.error("Please verify your phone number first");return}a()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Phone Verification"}),e.jsx("p",{className:"text-muted-foreground",children:"Verify your phone number to secure your account"})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(F,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-5 w-5"}),e.jsx("span",{children:"Phone Number Verification"})]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{id:"phoneNumber",type:"tel",value:x,onChange:c=>n(c.target.value),placeholder:"+267 XX XXX XXX",disabled:f}),e.jsx(y,{onClick:l,disabled:f||!x,variant:"outline",children:f?"Code Sent":"Send Code"})]})]}),f&&!p&&e.jsxs("div",{children:[e.jsxs(O,{htmlFor:"verificationCode",children:[e.jsx(_e,{className:"h-4 w-4 inline mr-2"}),"Verification Code"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{id:"verificationCode",value:o,onChange:c=>h(c.target.value),placeholder:"Enter 6-digit code",maxLength:6}),e.jsx(y,{onClick:g,disabled:!o,children:"Verify"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Enter the 6-digit code sent to your phone"})]}),p&&e.jsxs("div",{className:"flex items-center justify-center p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(Q,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsx("span",{className:"text-green-700",children:"Phone number verified successfully!"})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-6",children:[e.jsxs(y,{variant:"outline",onClick:i,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Previous"]}),e.jsxs(y,{onClick:w,disabled:m||!p,children:[e.jsx("span",{children:"Continue to Address"}),e.jsx(Y,{className:"h-4 w-4 ml-2"})]})]})]})},Ze=({onNext:a,onPrevious:i})=>{var b,p,j;const{verificationData:s,submitForReview:m,isLoading:x}=L(),[n,o]=d.useState(!1),h=async()=>{try{o(!0),await m(),N.success("Verification submitted for review!"),a()}catch(l){console.error("Failed to submit verification:",l),N.error("Failed to submit verification")}finally{o(!1)}},f=[{title:"Personal Information",completed:!!((b=s==null?void 0:s.personal_info)!=null&&b.fullName),details:String(((p=s==null?void 0:s.personal_info)==null?void 0:p.fullName)||"Not completed")},{title:"Document Upload",completed:!0,details:"All required documents uploaded"},{title:"Selfie Verification",completed:!0,details:"Selfie photo captured"},{title:"Phone Verification",completed:!0,details:String(((j=s==null?void 0:s.personal_info)==null?void 0:j.phoneNumber)||"Phone verified")},{title:"Address Confirmation",completed:!0,details:"Address confirmed"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Review & Submit"}),e.jsx("p",{className:"text-muted-foreground",children:"Review your information before submitting for verification"})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(F,{children:"Verification Summary"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:f.map((l,g)=>e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:`h-5 w-5 ${l.completed?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.details})]})]})},g))})})]}),e.jsx(P,{children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"What happens next?"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Your verification will be reviewed by our team"}),e.jsx("li",{children:"You'll receive email updates on the status"}),e.jsx("li",{children:"Processing typically takes 1-3 business days"}),e.jsx("li",{children:"You can check progress anytime in your profile"})]})]})})}),e.jsxs("div",{className:"flex justify-between pt-6",children:[e.jsxs(y,{variant:"outline",onClick:i,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Previous"]}),e.jsxs(y,{onClick:h,disabled:x||n,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:n?"Submitting...":"Submit for Review"})]})]})]})},Ke=({title:a,description:i,icon:s,status:m,estimatedTime:x})=>{const n=()=>{switch(m){case"completed":return"text-green-600";case"in_progress":return"text-blue-600";default:return"text-gray-400"}},o=()=>{switch(m){case"completed":return e.jsxs(D,{variant:"secondary",className:"bg-green-100 text-green-700",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Complete"]});case"in_progress":return e.jsxs(D,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Processing"]});default:return e.jsx(D,{variant:"outline",children:"Pending"})}};return e.jsxs("div",{className:"flex items-start space-x-4 p-4 border rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-full ${m==="completed"?"bg-green-100":m==="in_progress"?"bg-blue-100":"bg-gray-100"}`,children:e.jsx("div",{className:n(),children:s})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-medium",children:a}),o()]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:i}),m==="in_progress"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Processing..."})]}),x&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Estimated time: ",x]})]})]})]})},Qe=({onNext:a})=>{const{user:i}=ee(),{verificationData:s,refreshData:m}=L(),[x,n]=d.useState(25),[o,h]=d.useState(0),[f,b]=d.useState(!1),p=[{title:"Document Review",description:"Our team is reviewing your uploaded documents for authenticity and completeness",icon:e.jsx(Le,{className:"h-5 w-5"}),estimatedTime:"2-4 hours"},{title:"Identity Verification",description:"Verifying your identity against official databases and cross-referencing documents",icon:e.jsx(Ae,{className:"h-5 w-5"}),estimatedTime:"4-8 hours"},{title:"Address Confirmation",description:"Confirming your residential address and proof of address documents",icon:e.jsx(ce,{className:"h-5 w-5"}),estimatedTime:"1-2 hours"},{title:"Final Approval",description:"Final review and approval of your verification application",icon:e.jsx(W,{className:"h-5 w-5"}),estimatedTime:"30 minutes"}];d.useEffect(()=>{const r=setInterval(()=>{n(u=>{const v=Math.min(u+8,100);return v>=25&&o<1&&h(1),v>=50&&o<2&&h(2),v>=75&&o<3&&h(3),v})},2e3);return()=>clearInterval(r)},[o]),d.useEffect(()=>{if(x>=100){const r=setTimeout(()=>{console.log("[ProcessingStatusStep] Auto-advancing to completion step"),a()},3e3);return()=>clearTimeout(r)}},[x,a]),d.useEffect(()=>{const r=setInterval(()=>{m()},1e4);return()=>clearInterval(r)},[m]);const j=r=>r<o?"completed":r===o?"in_progress":"pending",l=()=>{const r=new Date,u=Math.max(1,Math.ceil((100-x)/10));return new Date(r.getTime()+u*60*60*1e3).toLocaleString("en-BW",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},g=(s==null?void 0:s.overall_status)==="completed",[w]=H.useState(Date.now()),[c,t]=H.useState(!1);return H.useEffect(()=>{const r=setInterval(()=>{Date.now()-w>36e5&&t(!0)},6e4);return()=>clearInterval(r)},[w]),H.useEffect(()=>{if(g){const r=setTimeout(()=>{console.log("[ProcessingStatusStep] Verification already complete, advancing"),a()},1e3);return()=>clearTimeout(r)}},[g,a]),g?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(C,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-green-700 mb-2",children:"Verification Complete!"}),e.jsx("p",{className:"text-muted-foreground",children:"Redirecting to completion step..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Verification in Progress"}),e.jsx("p",{className:"text-muted-foreground",children:"Your verification is being processed by our team"})]}),c&&e.jsxs("div",{className:"p-4 bg-yellow-100 border border-yellow-300 rounded text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," Verification processing is taking longer than usual. If you have any concerns, please contact our support team with your reference number."]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(F,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Overall Progress"}),e.jsxs(D,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Processing"]})]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Verification Progress"}),e.jsxs("span",{children:[x,"%"]})]}),e.jsx(oe,{value:x,className:"h-3"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Estimated Completion"}),e.jsx("p",{className:"text-muted-foreground",children:l()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Reference Number"}),e.jsx("p",{className:"text-muted-foreground font-mono",children:s!=null&&s.user_id?`VER-${s.user_id.slice(-8).toUpperCase()}`:"Generating..."})]})]})]})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(F,{children:"Processing Stages"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:p.map((r,u)=>e.jsx(Ke,{title:r.title,description:r.description,icon:r.icon,status:j(u),estimatedTime:j(u)==="in_progress"?r.estimatedTime:void 0},u))})})]}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(F,{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-5 w-5"}),e.jsx("span",{children:"Status Updates"})]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 rounded-lg",children:[e.jsx(C,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-700",children:"Verification Submitted"}),e.jsx("p",{className:"text-sm text-green-600",children:s!=null&&s.created_at?new Date(s.created_at).toLocaleString():"Just now"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx(X,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-700",children:"Review in Progress"}),e.jsx("p",{className:"text-sm text-blue-600",children:"Our verification team is currently reviewing your documents"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs($,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsxs(z,{children:[e.jsx("strong",{children:"What happens next?"})," You'll receive email notifications for any status updates. You can close this page and return anytime to check progress."]})]}),e.jsxs($,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsxs(z,{children:[e.jsx("strong",{children:"Need help?"})," If you have questions about your verification, contact our support team with your reference number."]})]})]}),!1]})},es=({verificationData:a})=>{const i=a!=null&&a.user_id?`VER-${a.user_id.slice(-8).toUpperCase()}`:"Unknown",s=a!=null&&a.completed_at?new Date(a.completed_at).toLocaleDateString():new Date().toLocaleDateString(),m=()=>{navigator.clipboard.writeText(i),N.success("Verification ID copied to clipboard")};return e.jsxs(P,{className:"border-green-200 bg-green-50",children:[e.jsxs(R,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"h-16 w-16 text-green-600 mx-auto"}),e.jsx(C,{className:"h-6 w-6 text-green-600 absolute -bottom-1 -right-1 bg-white rounded-full"})]})}),e.jsx(F,{className:"text-green-700",children:"Verification Complete!"})]}),e.jsx(k,{className:"space-y-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs(D,{variant:"secondary",className:"bg-green-100 text-green-700 mb-4",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Verified User"]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Verification ID"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("code",{className:"text-green-600 font-mono",children:i}),e.jsx(y,{variant:"ghost",size:"icon",onClick:m,className:"h-6 w-6",children:e.jsx(ve,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Completion Date"}),e.jsx("p",{className:"text-green-600",children:s})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"User Role"}),e.jsx("p",{className:"text-green-600 capitalize",children:(a==null?void 0:a.user_role)||"Renter"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Status"}),e.jsx("p",{className:"text-green-600",children:"Active"})]})]})]})]})})]})},ss=({userRole:a})=>{const i=se(),x=a==="host"?[{title:"Add Your First Car",description:"List your vehicle and start earning",icon:e.jsx(ie,{className:"h-5 w-5 text-blue-500"}),action:()=>i("/add-car"),buttonText:"Add Car"},{title:"Set Up Hosting Profile",description:"Complete your hosting profile and preferences",icon:e.jsx(ae,{className:"h-5 w-5 text-purple-500"}),action:()=>i("/profile"),buttonText:"Setup Profile"},{title:"View Dashboard",description:"Monitor your bookings and earnings",icon:e.jsx(xe,{className:"h-5 w-5 text-orange-500"}),action:()=>i("/dashboard"),buttonText:"Open Dashboard"}]:[{title:"Browse Available Cars",description:"Explore cars available for rent in your area",icon:e.jsx(ie,{className:"h-5 w-5 text-blue-500"}),action:()=>i("/"),buttonText:"Browse Cars"},{title:"Complete Your Profile",description:"Add a profile photo and additional details",icon:e.jsx(ae,{className:"h-5 w-5 text-purple-500"}),action:()=>i("/profile"),buttonText:"Edit Profile"},{title:"Make Your First Booking",description:"Find and book your first rental car",icon:e.jsx(Ue,{className:"h-5 w-5 text-green-500"}),action:()=>i("/"),buttonText:"Start Booking"}];return e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(F,{children:"What's Next?"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:x.map((n,o)=>e.jsxs("div",{className:"flex items-start space-x-4 p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-full",children:n.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium mb-1",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:n.description}),e.jsxs(y,{onClick:n.action,size:"sm",className:"flex items-center space-x-2",children:[e.jsx("span",{children:n.buttonText}),e.jsx(Y,{className:"h-3 w-3"})]})]})]},o))})})]})},ts=()=>{const{verificationData:a}=L(),i=se(),[s,m]=H.useState(3);if(d.useEffect(()=>{const h=setTimeout(()=>{i("/?verification_success=true")},3e3);return()=>clearTimeout(h)},[i]),d.useEffect(()=>{const h=setInterval(()=>{m(f=>f<=1?(clearInterval(h),0):f-1)},1e3);return()=>clearInterval(h)},[]),!a)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No verification data found"})});const x=()=>{a.user_role==="host"?i("/dashboard"):i("/")},n=()=>{N.success("Certificate download started (Feature coming soon)")},o=a.user_role==="host"?"host":"renter";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mx-auto mb-6",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"animate-bounce",children:e.jsx(C,{className:"h-20 w-20 text-green-500 mx-auto"})})})}),e.jsx("h1",{className:"text-3xl font-bold text-green-700 mb-2",children:"🎉 Verification Complete!"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-4",children:"Welcome to MobiRides! Your identity has been successfully verified."}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 inline-block",children:e.jsxs("p",{className:"text-blue-700 font-medium",children:["Redirecting to explore cars in ",s," second",s!==1?"s":"","..."]})})]}),e.jsx(es,{verificationData:a}),e.jsxs(P,{children:[e.jsx(R,{children:e.jsxs(F,{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Your Verification Benefits"})]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Trusted Member Badge"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Show other users you're verified"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Full Platform Access"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Book cars and access all features"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Priority Support"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get faster help when needed"})]})]}),a.user_role==="host"&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Host Privileges"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"List cars and start earning"})]})]})]})]})})]}),e.jsx(ss,{userRole:o}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs($,{children:[e.jsx(me,{className:"h-4 w-4"}),e.jsxs(z,{children:[e.jsx("strong",{children:"Email Confirmation:"})," A verification certificate has been sent to your email address. Keep this for your records."]})]}),e.jsxs($,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs(z,{children:[e.jsx("strong",{children:"Security Notice:"})," Your verification is valid indefinitely. Contact support if you need to update any verified information."]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[e.jsxs(y,{onClick:n,variant:"outline",className:"flex items-center space-x-2 flex-1",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{children:"Download Certificate"})]}),e.jsxs(y,{onClick:x,className:"flex items-center space-x-2 flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx("span",{children:a.user_role==="host"?"Go to Dashboard":"Start Using MobiRides"}),e.jsx(Y,{className:"h-4 w-4"})]})]})]})},G={[S.PERSONAL_INFO]:{title:"Personal Information",description:"Provide your basic details",icon:te,component:Be},[S.DOCUMENT_UPLOAD]:{title:"Document Upload",description:"Upload required documents",icon:de,component:He},[S.SELFIE_VERIFICATION]:{title:"Selfie Verification",description:"Take a verification selfie",icon:q,component:Ge},[S.PHONE_VERIFICATION]:{title:"Phone Verification",description:"Verify your phone number",icon:Q,component:Je},[S.REVIEW_SUBMIT]:{title:"Review & Submit",description:"Review and submit verification",icon:C,component:Ze},[S.PROCESSING_STATUS]:{title:"Processing",description:"Verification in progress",icon:X,component:Qe},[S.COMPLETION]:{title:"Completed",description:"Verification complete",icon:W,component:ts}},rs=({currentStep:a,stepStatuses:i,onStepClick:s,canNavigateToStep:m})=>{const x=Object.values(S);return e.jsxs("div",{className:"w-full mb-8",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex items-center gap-6 overflow-x-auto pb-4 mb-4 scrollbar-hide",children:e.jsx("div",{className:"flex items-center gap-6 min-w-max px-4",children:x.map((n,o)=>{const h=G[n],f=h.icon,b=i[n],p=n===a,j=b===V.COMPLETED,l=m(n);let g="bg-gray-700",w="text-gray-300",c="",t="bg-white",r="text-gray-700";return j?(g="bg-green-500 hover:bg-green-600",w="text-white",t="bg-white",r="text-green-700"):p&&(g="bg-blue-600",w="text-white",c="ring-2 ring-blue-400 ring-offset-2",t="bg-white",r="text-blue-700"),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(y,{variant:"outline",size:"icon",className:`
                          h-12 w-12 rounded-full mb-2
                          ${g} ${w} ${c}
                          ${!l&&!p&&!j?"opacity-50 cursor-not-allowed":""}
                        `,onClick:()=>l&&s(n),disabled:!l&&!p&&!j,children:j?e.jsx(C,{className:"h-6 w-6 text-white"}):e.jsx(f,{className:`h-6 w-6 ${w}`})}),e.jsx(D,{variant:"secondary",className:`absolute -top-1 -right-1 h-5 w-5 p-0 text-xs ${t} ${r} border border-gray-200`,children:o+1})]}),e.jsx("div",{className:"text-center max-w-[80px]",children:e.jsx("p",{className:`text-xs font-medium ${p?"text-blue-600":j?"text-green-600":"text-gray-400"}`,children:h.title})})]}),o<x.length-1&&e.jsx("div",{className:`
                      w-8 h-0.5 mx-2 mb-8
                      ${j?"bg-green-500":p?"bg-blue-600":"bg-gray-700"}
                    `})]},n)})})}),e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("div",{className:"flex space-x-1",children:Array.from({length:Math.ceil(x.length/3)}).map((n,o)=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"},o))})})]}),e.jsx("div",{className:"hidden sm:flex items-center justify-between mb-4",children:x.map((n,o)=>{const h=G[n],f=h.icon,b=i[n],p=n===a,j=b===V.COMPLETED,l=m(n);let g="bg-gray-700",w="text-gray-300",c="",t="bg-white",r="text-gray-700";return j?(g="bg-green-500 hover:bg-green-600",w="text-white",t="bg-white",r="text-green-700"):p&&(g="bg-blue-600",w="text-white",c="ring-2 ring-blue-400 ring-offset-2",t="bg-white",r="text-blue-700"),e.jsxs("div",{className:"contents",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(y,{variant:"outline",size:"icon",className:`
                      h-12 w-12 rounded-full mb-2
                      ${g} ${w} ${c}
                      ${!l&&!p&&!j?"opacity-50 cursor-not-allowed":""}
                    `,onClick:()=>l&&s(n),disabled:!l&&!p&&!j,children:j?e.jsx(C,{className:"h-6 w-6 text-white"}):e.jsx(f,{className:`h-6 w-6 ${w}`})}),e.jsx(D,{variant:"secondary",className:`absolute -top-1 -right-1 h-5 w-5 p-0 text-xs ${t} ${r} border border-gray-200`,children:o+1})]}),e.jsxs("div",{className:"text-center max-w-[80px]",children:[e.jsx("p",{className:`text-xs font-medium ${p?"text-blue-600":j?"text-green-600":"text-gray-400"}`,children:h.title}),e.jsx("p",{className:"text-xs text-muted-foreground hidden sm:block",children:h.description})]})]}),o<x.length-1&&e.jsx("div",{className:`
                  flex-1 h-0.5 mx-2 mb-8
                  ${j?"bg-green-500":p?"bg-blue-600":"bg-gray-700"}
                `})]},n)})})]})},as=()=>{const{user:a}=ee(),i=se(),{verificationData:s,isLoading:m,error:x,isInitialized:n,initializeVerification:o,navigateToStep:h,canNavigateToStep:f,getStepProgress:b,resetVerification:p}=L(),[j,l]=d.useState(!1),[g,w]=d.useState(!1);d.useEffect(()=>{if(!(a!=null&&a.id)){console.log("[VerificationHub] No user ID available");return}if(n||m||s)return;(async()=>{var U;try{const M=((U=a.user_metadata)==null?void 0:U.role)||"renter";console.log("[VerificationHub] Initializing verification for user:",a.id,"Role:",M),await o(a.id,M)}catch(M){console.error("[VerificationHub] Failed to initialize verification:",M),N.error("Failed to initialize verification process")}})()},[a==null?void 0:a.id,n,m,s]),H.useEffect(()=>{s&&s.overall_status==="completed"&&s.current_step!=="completion"&&h(S.COMPLETION)},[s==null?void 0:s.overall_status,s==null?void 0:s.current_step,h]);const c=I=>{if(!f(I)){N.error("Please complete the previous steps first");return}h(I)},t=()=>{if(!s)return;const I=Object.values(S),U=I.indexOf(s.current_step);if(U<I.length-1){const M=I[U+1];c(M)}},r=()=>{if(!s)return;const I=Object.values(S),U=I.indexOf(s.current_step);if(U>0){const M=I[U-1];h(M)}},u=()=>{N.info("Verification canceled. You can resume anytime from your profile."),i("/")},v=()=>{i("/")},T=()=>{if(!s)return null;const I=G[s.current_step].component;return e.jsx(I,{onNext:t,onPrevious:r})};if(x)return e.jsx("div",{className:"min-h-screen p-4 flex items-center justify-center",style:{backgroundColor:"#020817"},children:e.jsxs(P,{className:"w-full max-w-md",children:[e.jsxs(R,{className:"text-center",children:[e.jsx(E,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx(F,{className:"text-red-600",children:"Verification Error"})]}),e.jsxs(k,{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:x}),e.jsx(y,{onClick:()=>window.location.reload(),children:"Try Again"})]})]})});if(m||!s)return e.jsx("div",{className:"min-h-screen p-4 flex items-center justify-center",style:{backgroundColor:"#020817"},children:e.jsx(P,{className:"w-full max-w-md",children:e.jsxs(k,{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Initializing verification..."})]})})});const A=b(),B=G[s==null?void 0:s.current_step];return e.jsx("div",{className:"min-h-screen p-4",style:{backgroundColor:"#020817"},children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 p-4 bg-white/10 rounded-lg border border-white/20",children:[e.jsxs(y,{variant:"outline",onClick:v,className:"flex items-center gap-2 bg-white/90 hover:bg-white text-gray-900",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"}),e.jsx("span",{className:"sm:hidden",children:"Home"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-white/80 text-sm",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Secure verification process"}),e.jsx("span",{className:"sm:hidden",children:"Secure process"})]}),e.jsxs(Pe,{open:g,onOpenChange:w,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"flex items-center gap-2 bg-white/90 hover:bg-white text-gray-900 border-red-200 hover:border-red-300",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancel Verification"}),e.jsx("span",{className:"sm:hidden",children:"Cancel"})]})}),e.jsxs(Te,{children:[e.jsxs(Ee,{children:[e.jsx(Re,{children:"Cancel Verification?"}),e.jsx(Fe,{children:"Are you sure you want to cancel the verification process? Your progress will be saved and you can resume later from your profile."})]}),e.jsxs(Ve,{children:[e.jsx(Ie,{children:"Continue Verification"}),e.jsx(Oe,{onClick:u,children:"Yes, Cancel"})]})]})]})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Identity Verification"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-4",children:"Complete your verification to start using MobiRides"}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Overall Progress"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[A.completed," of ",A.total," steps"]})]}),e.jsx(oe,{value:A.percentage,className:"h-2"})]})]}),e.jsx(rs,{currentStep:s==null?void 0:s.current_step,stepStatuses:{[S.PERSONAL_INFO]:s!=null&&s.personal_info_completed?V.COMPLETED:V.NOT_STARTED,[S.DOCUMENT_UPLOAD]:s!=null&&s.documents_completed?V.COMPLETED:V.NOT_STARTED,[S.SELFIE_VERIFICATION]:s!=null&&s.selfie_completed?V.COMPLETED:V.NOT_STARTED,[S.PHONE_VERIFICATION]:s!=null&&s.phone_verified?V.COMPLETED:V.NOT_STARTED,[S.REVIEW_SUBMIT]:V.NOT_STARTED,[S.PROCESSING_STATUS]:V.NOT_STARTED,[S.COMPLETION]:V.NOT_STARTED},onStepClick:c,canNavigateToStep:f}),e.jsxs(P,{className:"mb-8",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B.icon,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx(F,{children:B.title}),e.jsx("p",{className:"text-muted-foreground",children:B.description})]})]})}),e.jsx(k,{children:T()})]}),!1]})})};class is extends d.Component{constructor(){super(...arguments);re(this,"state",{hasError:!1})}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,m){console.error("Verification error boundary caught an error:",s,m)}render(){var s;return this.state.hasError?e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:e.jsxs(P,{className:"border-destructive",children:[e.jsxs(R,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(we,{className:"h-12 w-12 text-destructive"})}),e.jsx(F,{className:"text-destructive",children:"Verification Error"}),e.jsx(Se,{children:"Something went wrong during the verification process. This has been logged and our team will investigate."})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsx("p",{className:"text-sm font-mono text-muted-foreground",children:((s=this.state.error)==null?void 0:s.message)||"An unexpected error occurred"})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(y,{onClick:()=>this.setState({hasError:!1}),variant:"outline",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Try Again"]}),e.jsx(y,{onClick:()=>window.location.href="/dashboard",variant:"default",children:"Return to Dashboard"})]})]})]})}):this.props.children}}const Os=()=>e.jsx(is,{children:e.jsx(Ce,{children:e.jsx(as,{})})});export{Os as default};

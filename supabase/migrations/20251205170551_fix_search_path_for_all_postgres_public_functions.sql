-- Fix search_path for all postgres-owned public functions
-- Generated from exact function signatures in database

CREATE OR REPLACE FUNCTION pg_temp.safe_set_search_path(sig text) RETURNS void AS $$
BEGIN
  EXECUTE 'ALTER FUNCTION ' || sig || ' SET search_path = public';
EXCEPTION 
  WHEN undefined_function THEN
    RAISE NOTICE 'Function % not found, skipping.', sig;
  WHEN OTHERS THEN
    RAISE NOTICE 'Error altering %: %. Skipping.', sig, SQLERRM;
END;
$$ LANGUAGE plpgsql;
SELECT pg_temp.safe_set_search_path('public.add_conversation_creator_as_participant()'); SELECT pg_temp.safe_set_search_path('public.analyze_conversation_query_performance()'); SELECT pg_temp.safe_set_search_path('public.auth_uid_test()'); SELECT pg_temp.safe_set_search_path('public.check_circular_reply()'); SELECT pg_temp.safe_set_search_path('public.check_circular_reply_conversation()'); SELECT pg_temp.safe_set_search_path('public.check_column_exists(table_name text, column_name text)'); SELECT pg_temp.safe_set_search_path('public.check_conversation_access(p_conversation_id uuid, p_user_id uuid)'); SELECT pg_temp.safe_set_search_path('public.check_verification_completion(user_uuid uuid)'); SELECT pg_temp.safe_set_search_path('public.check_verification_completion()'); SELECT pg_temp.safe_set_search_path('public.clean_expired_locations()'); SELECT pg_temp.safe_set_search_path('public.cleanup_expired_bypass_sessions()'); SELECT pg_temp.safe_set_search_path('public.cleanup_expired_confirmations()'); SELECT pg_temp.safe_set_search_path('public.cleanup_expired_notifications()'); SELECT pg_temp.safe_set_search_path('public.cleanup_expired_notifications_enhanced()'); SELECT pg_temp.safe_set_search_path('public.cleanup_expired_tokens()'); SELECT pg_temp.safe_set_search_path('public.cleanup_rate_limits()'); SELECT pg_temp.safe_set_search_path('public.count_unread_notifications()'); SELECT pg_temp.safe_set_search_path('public.create_booking_notification(p_booking_id uuid, p_renter_notification_type notification_type, p_host_notification_type notification_type, p_title text, p_description text, p_metadata jsonb, p_role_target notification_role)'); SELECT pg_temp.safe_set_search_path('public.create_booking_notification(p_booking_id uuid, p_renter_notification_type notification_type, p_host_notification_type notification_type, p_title text, p_description text, p_metadata jsonb)'); SELECT pg_temp.safe_set_search_path('public.create_check_column_function()'); SELECT pg_temp.safe_set_search_path('public.create_conversation_with_participants(p_created_by uuid, p_participant_ids uuid[], p_title text, p_type text)'); SELECT pg_temp.safe_set_search_path('public.create_handover_notification(p_user_id uuid, p_handover_type text, p_car_brand text, p_car_model text, p_location text, p_status text, p_step_name text, p_progress_percentage integer)'); SELECT pg_temp.safe_set_search_path('public.create_handover_progress_notification(p_handover_session_id uuid)'); SELECT pg_temp.safe_set_search_path('public.create_handover_progress_notification(p_handover_session_id uuid, p_completed_steps integer, p_total_steps integer)'); SELECT pg_temp.safe_set_search_path('public.create_handover_step_notification(p_handover_session_id uuid, p_step_name text, p_completed_by uuid)'); SELECT pg_temp.safe_set_search_path('public.create_handover_step_notification(p_handover_session_id uuid, p_step_name text, p_step_status text)'); SELECT pg_temp.safe_set_search_path('public.create_notification_with_expiration(p_user_id uuid, p_type notification_type, p_title text, p_description text, p_content text, p_role_target notification_role, p_related_booking_id uuid, p_related_car_id uuid, p_related_user_id uuid, p_priority integer, p_metadata jsonb, p_custom_expiration_hours integer)'); SELECT pg_temp.safe_set_search_path('public.create_wallet_notification(p_wallet_transaction_id uuid, p_user_id uuid, p_type notification_type, p_title text, p_description text, p_metadata jsonb, p_role_target notification_role)'); SELECT pg_temp.safe_set_search_path('public.decrypt_message_content(p_cipher bytea)'); SELECT pg_temp.safe_set_search_path('public.delete_old_notifications(p_days_old integer)'); SELECT pg_temp.safe_set_search_path('public.encrypt_message_content(p_text text)'); SELECT pg_temp.safe_set_search_path('public.ensure_conversation_integrity()'); SELECT pg_temp.safe_set_search_path('public.generate_audit_hash(event_type audit_event_type, actor_id uuid, target_id uuid, action_details jsonb, event_timestamp timestamp with time zone, previous_hash text)'); SELECT pg_temp.safe_set_search_path('public.get_bypass_statistics(p_start_date timestamp with time zone, p_end_date timestamp with time zone)'); SELECT pg_temp.safe_set_search_path('public.get_conversation_messages(p_conversation_id uuid, p_user_id uuid)'); SELECT pg_temp.safe_set_search_path('public.get_encryption_key()'); SELECT pg_temp.safe_set_search_path('public.get_notification_expiration_info(p_notification_type notification_type)'); SELECT pg_temp.safe_set_search_path('public.get_public_profile(user_uuid uuid)'); SELECT pg_temp.safe_set_search_path('public.get_reply_chain(p_message_id uuid, p_max_depth integer)'); SELECT pg_temp.safe_set_search_path('public.get_reply_counts(conversation_id_param uuid, message_ids uuid[])'); SELECT pg_temp.safe_set_search_path('public.get_user_conversations(p_user_id uuid)'); SELECT pg_temp.safe_set_search_path('public.get_user_conversations(p_page integer, p_page_size integer, p_search_term text)'); SELECT pg_temp.safe_set_search_path('public.get_user_notifications(p_page integer, p_page_size integer, p_only_unread boolean)'); SELECT pg_temp.safe_set_search_path('public.handle_handover_completion()'); SELECT pg_temp.safe_set_search_path('public.handle_handover_step_completion()'); SELECT pg_temp.safe_set_search_path('public.handle_new_message_notification()'); SELECT pg_temp.safe_set_search_path('public.handle_new_user(user_id uuid)'); SELECT pg_temp.safe_set_search_path('public.handle_user_restrictions_updated_at()'); SELECT pg_temp.safe_set_search_path('public.has_active_bypass_session(p_user_id uuid)'); SELECT pg_temp.safe_set_search_path('public.initialize_conversation(p_title text, p_type character varying, p_participant_ids uuid[])'); SELECT pg_temp.safe_set_search_path('public.log_audit_event(p_event_type audit_event_type, p_severity audit_severity, p_actor_id uuid, p_target_id uuid, p_session_id text, p_ip_address inet, p_user_agent text, p_location_data jsonb, p_action_details jsonb, p_resource_type text, p_resource_id uuid, p_reason text, p_anomaly_flags jsonb, p_compliance_tags text[])'); SELECT pg_temp.safe_set_search_path('public.log_bypass_session_creation()'); SELECT pg_temp.safe_set_search_path('public.log_bypass_session_deactivation()'); SELECT pg_temp.safe_set_search_path('public.log_bypass_session_usage()'); SELECT pg_temp.safe_set_search_path('public.log_notification_creation()'); SELECT pg_temp.safe_set_search_path('public.mark_notifications_read(p_notification_ids bigint[])'); SELECT pg_temp.safe_set_search_path('public.migrate_legacy_messages()'); SELECT pg_temp.safe_set_search_path('public.migrate_legacy_messages_to_conversations()'); SELECT pg_temp.safe_set_search_path('public.prevent_audit_log_modification()'); SELECT pg_temp.safe_set_search_path('public.remove_message_operation()'); SELECT pg_temp.safe_set_search_path('public.send_conversation_message(p_conversation_id uuid, p_content text, p_message_type text, p_related_car_id uuid, p_reply_to_message_id uuid, p_metadata jsonb)'); SELECT pg_temp.safe_set_search_path('public.sync_message_operation()'); SELECT pg_temp.safe_set_search_path('public.trigger_cleanup_expired_confirmations()'); SELECT pg_temp.safe_set_search_path('public.update_campaign_delivery_logs_updated_at()'); SELECT pg_temp.safe_set_search_path('public.update_last_updated_at_column()'); SELECT pg_temp.safe_set_search_path('public.update_message_delivery_status()'); SELECT pg_temp.safe_set_search_path('public.update_message_operations_updated_at()'); SELECT pg_temp.safe_set_search_path('public.update_notification_expiration_policy(p_notification_type notification_type, p_expiration_hours integer, p_auto_cleanup_enabled boolean)'); SELECT pg_temp.safe_set_search_path('public.update_notification_preferences_timestamp()'); SELECT pg_temp.safe_set_search_path('public.update_updated_at_column()'); SELECT pg_temp.safe_set_search_path('public.update_user_location(user_id uuid, lat numeric, lng numeric)'); SELECT pg_temp.safe_set_search_path('public.update_user_public_keys_updated_at()'); SELECT pg_temp.safe_set_search_path('public.update_user_verification_timestamp()'); SELECT pg_temp.safe_set_search_path('public.update_verification_columns()'); SELECT pg_temp.safe_set_search_path('public.update_verification_step(user_uuid uuid, new_step verification_step)'); SELECT pg_temp.safe_set_search_path('public.user_owns_verification(verification_uuid uuid)'); SELECT pg_temp.safe_set_search_path('public.validate_conversation_creation()'); SELECT pg_temp.safe_set_search_path('public.verify_audit_chain_integrity()'); SELECT pg_temp.safe_set_search_path('public.verify_conversation_policies()'); SELECT pg_temp.safe_set_search_path('public.verify_no_recursion_policies()'); SELECT pg_temp.safe_set_search_path('public.verify_no_recursive_policies()');
